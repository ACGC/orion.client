var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."){if(t){p=p.slice(0,p.length-1);e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h==="."){e.splice(l,1);l-=1}else if(h===".."){if(l===1&&(e[2]===".."||e[0]==="..")){break}else if(l>0){e.splice(l-1,2);l-=2}}}e=e.join("/")}else if(e.indexOf("./")===0){e=e.substring(2)}}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p){for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i;o=l;break}}}}if(s){break}if(!a&&v&&v[r]){a=v[r];f=l}}if(!s&&a){s=a;o=f}if(s){n.splice(0,o,s);e=n.join("/")}}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n];a[n]=true;t.apply(e,r)}if(!c(s,n)&&!c(a,n)){throw new Error("No "+n)}return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;if(n>-1){t=e.substring(0,n);e=e.substring(n+1,e.length)}return[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];e=r[1];if(i){i=h(i,t);n=m(i)}if(i){if(n&&n.normalize){e=n.normalize(e,d(t))}else{e=h(e,t)}}else{e=h(e,t);r=g(e);i=r[0];e=r[1];if(i){n=m(i)}}return{f:i?i+"!"+e:e,n:e,pr:i,p:n}};i={require:function(e){return p(e)},exports:function(e){var t=s[e];if(typeof t!=="undefined"){return t}else{return s[e]={}}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}};t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f);h=g.f;if(h==="require"){b[y]=i.require(t)}else if(h==="exports"){b[y]=i.exports(t);w=true}else if(h==="module"){l=b[y]=i.module(t)}else if(c(s,h)||c(o,h)||c(a,h)){b[y]=m(h)}else if(g.p){g.p.load(g.n,p(f,true),v(h),{});b[y]=s[h]}else{throw new Error(t+" missing "+h)}}d=u.apply(s[t],b);if(t){if(l&&l.exports!==e&&l.exports!==s[t]){s[t]=l.exports}else if(d!==e||!w){s[t]=d}}}else if(t){s[t]=u}};requirejs=require=n=function(s,o,a,f,l){if(typeof s==="string"){if(i[s]){return i[s](o)}return m(r(s,o).f)}else if(!s.splice){u=s;if(o.splice){s=o;o=a;a=null}else{s=e}}o=o||function(){};if(typeof a==="function"){a=f;f=l}if(f){t(e,s,o,a)}else{setTimeout(function(){t(e,s,o,a)},4)}return n};n.config=function(e){u=e;return n};define=function(e,t,n){if(!t.splice){n=t;t=[]}if(!c(s,e)&&!c(o,e)){o[e]=[e,t,n]}};define.amd={jQuery:true}})();define("almond",function(){});define("orion/PageUtil",[],function(){function e(){var e=window.location.href.split("#")[1];e=e?"#"+e:"";return e}function t(e){e=e||window.location.toString();var t={resource:""};var n=e.indexOf("#");if(n!==-1){var r=e.substring(n+1);if(r.length!==0){var i=r.split(",");t.resource=decodeURIComponent(i[0]);for(var s=1;s<i.length;s++){var o=i[s];var u=/([^=]*)(=?)(.*)/.exec(o);var a=decodeURIComponent(u[1]||"");var f=decodeURIComponent(u[3]||"");if(a!==""&&a!=="resource"){t[a]=f}}}}return t}function r(e,t){var r=e;if(e.indexOf("://")===-1){var i=document.createElement("a");i.href=e;r=i.href}var s=false;if(t){s=t.some(function(e){return(new RegExp("^"+e+":","i")).test(r)})}else{s=n.test(r)}if(s){return e}else{console.log("Illegal URL Scheme: '"+e+"'");return""}}var n=new RegExp("^http[s]?","i");return{hash:e,matchResourceParameters:t,validateURLScheme:r}});(function(){function t(e,t,n,r,i,s){if(t[e]){n.push(e);if(t[e]===true||t[e]===1){r.push(i+e+"/"+s)}}}function n(e,t,n,r,i){var s=r+t+"/"+i;if(require._fileExists(e.toUrl(s+".js"))){n.push(s)}}function r(e,t,n){var i;for(i in t){if(t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)){e[i]=t[i]}else if(typeof t[i]==="object"){r(e[i],t[i],n)}}}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.1+",load:function(i,o,u,a){a=a||{};if(a.locale){s.locale=a.locale}var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";if(l[5]){c=l[1];f=c+p}else{f=i;p=l[4];h=s.locale;if(!h){h=s.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()}d=h.split("-")}if(a.isBuild){v.push(f);n(o,"root",v,c,p);for(g=0;g<d.length;g++){y=d[g];b+=(b?"-":"")+y;n(o,b,v,c,p)}o(v,function(){u()})}else{o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++){i=d[g];b+=(b?"-":"")+i;t(b,e,n,v,c,p)}o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t];i=e[s];if(i===true||i===1){i=o(c+s+"/"+p)}r(m,i)}u(m)})})}}}})})();define("orion/i18n",{load:function(e,t,n,r){if(t.specified&&t.specified("orion/bootstrap")){t(["orion/i18n!"+e],function(e){n(e)})}else{n({})}}});define("orion/edit/nls/root/messages",{Editor:"Editor",switchEditor:"Switch Editor",Fetching:"Fetching: ${0}",confirmUnsavedChanges:"There are unsaved changes.  Do you still want to navigate away?",searchFiles:"Search Files",searchTerm:"Enter search term:",unsavedChanges:"There are unsaved changes.",Save:"Save",Saved:"Saved",Blame:"Blame",BlameTooltip:"Show blame annotations",saveOutOfSync:"Resource is out of sync with the server. Do you want to save it anyway?",loadOutOfSync:"Resource is out of sync with the server. Do you want to load it anyway? This will overwrite your local changes.",ReadingMetadata:"Reading metadata of ${0}",Reading:"Reading ${0}",readonly:"Read Only.",saveFile:"Save this file",gotoLine:"Go to Line",gotoLineTooltip:"Go to specified line number",gotoLinePrompt:"Go to line:",Undo:"Undo",Redo:"Redo",Find:"Find",noResponse:"No response from server.  Check your internet connection and try again.",savingFile:"Saving file ${0}",running:"Running ${0}","Saving...":"Saving...",View:"View",ViewTooltip:"View",Actions:"Actions",Navigator:"Navigator",FolderNavigator:"Folder Navigator",Project:"Project",New:"New",Add:"Add",NoFile:"Use the ${0} to create new files and folders. Click a file to start coding.",LocalEditorSettings:"Local Editor Settings",NoProject:"${0} is not a project. To convert it to a project use ${1}.",NoProjects:"There are no projects in your workspace. Use ${0} to create projects.",disconnected:"(disconnected)",ChooseFS:"Choose Filesystem",ChooseFSTooltip:"Choose the filesystem you want to view.",FSTitle:"${0} (${1})",Deploy:"Deploy",ImportExport:"Import/Export",OpenWith:"Open with...",Extensions:"Extensions"});define("orion/edit/nls/messages",["orion/i18n!orion/edit/nls/messages","orion/edit/nls/root/messages"],function(e,t){var n={root:t};Object.keys(e).forEach(function(t){if(typeof n[t]==="undefined"){n[t]=e[t]}});return n});(function(e,t){if(typeof define==="function"&&define.amd){define("orion/Deferred",t)}else if(typeof exports==="object"){module.exports=t()}else{e.orion=e.orion||{};e.orion.Deferred=t()}})(this,function(){function n(){var n;while(n=e.shift()){n()}t=false}function r(r){e.push(r);if(!t){t=true;setTimeout(n,0)}}function i(e){return function(){e.apply(undefined,arguments)}}function s(){function f(){var r;while(r=o.shift()){var s=r.deferred;var u=n==="fulfilled"?"resolve":"reject";if(typeof r[u]==="function"){try{var a=r[u];var f=a(t);var l=f&&(typeof f==="object"||typeof f==="function")&&f.then;if(typeof l==="function"){if(f===s.promise){s.reject(new TypeError)}else{var c=f.cancel;if(typeof c==="function"){s._protected(e).parentCancel=c.bind(f)}else{delete s._protected(e).parentCancel}l.call(f,i(s.resolve),i(s.reject),i(s.progress))}}else{s.resolve(f)}}catch(h){s.reject(h)}}else{s[u](t)}}}function l(e){delete a.parentCancel;n="rejected";t=e;if(o.length){r(f)}}function c(e){function h(e){return function(t){if(!i){i=true;e(t)}}}var i=false;delete a.parentCancel;try{var p=e&&(typeof e==="object"||typeof e==="function")&&e.then;if(typeof p==="function"){if(e===u){l(new TypeError)}else{n="assumed";var d=e&&e.cancel;if(typeof d!=="function"){var v=new s;e=v.promise;try{p(v.resolve,v.reject,v.progress)}catch(m){v.reject(m)}d=e.cancel;p=e.then}t=e;p.call(e,h(c),h(l));a.parentCancel=d.bind(e)}}else{n="fulfilled";t=e;if(o.length){r(f)}}}catch(g){h(l)(g)}}function h(){var e=a.parentCancel;if(e){delete a.parentCancel;e()}else if(!n){var t=new Error("Cancel");t.name="Cancel";l(t)}}var t,n,o=[],u=this,a={};Object.defineProperty(this,"_protected",{value:function(t){if(t!==e){throw new Error("protected")}return a}});this.resolve=function(e){if(!n){c(e)}return u};this.reject=function(e){if(!n){l(e)}return u};this.progress=function(e){if(!n){o.forEach(function(t){if(t.progress){try{t.progress(e)}catch(n){}}})}return u.promise};this.cancel=function(){if(a.parentCancel){setTimeout(h,0)}else{h()}return u};this.then=function(t,i,a){var l={resolve:t,reject:i,progress:a,deferred:new s};o.push(l);l.deferred._protected(e).parentCancel=u.promise.cancel.bind(u);if(n==="fulfilled"||n==="rejected"){r(f)}return l.deferred.promise};this.promise={then:u.then,cancel:u.cancel}}var e=[],t=false;s.all=function(e,t){function u(e,t){if(!i){r[e]=t;if(--n===0){o.resolve(r)}}}function a(e,n){if(!i){if(t){try{u(e,t(n));return}catch(r){n=r}}o.reject(n)}}var n=e.length,r=[],i=false,o=new s;o.then(undefined,function(){i=true;e.forEach(function(e){if(e.cancel){e.cancel()}})});if(n===0){o.resolve(r)}else{e.forEach(function(e,t){e.then(u.bind(undefined,t),a.bind(undefined,t))})}return o.promise};s.when=function(e,t,n,r){var i,o;if(e&&typeof e.then==="function"){i=e}else{o=new s;o.resolve(e);i=o.promise}return i.then(t,n,r)};return s});define("orion/i18nUtil",["require","orion/Deferred"],function(e,t){function r(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function i(e){var t=localStorage.getItem("orion/messageBundle/"+e);if(t){var n=JSON.parse(t);if(n._expires&&n._expires>(new Date).getTime()){delete n._expires;return n}}return null}function s(e,t){t._expires=(new Date).getTime()+1e3*900;localStorage.setItem("orion/messageBundle/"+e,JSON.stringify(t));delete t._expires}function o(r){function a(){e(["i18n!"+r],function(e){if(e){s(r,e)}o.resolve(e)})}if(n[r]){return n[r]}var o=new t;n[r]=o;var u=i(r);if(u){o.resolve(u);return o}try{e([r],a)}catch(f){e(["orion/i18n!"+r],a)}return o}var n={};return{getMessageBundle:o,formatMessage:r}});define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}e.prototype={dispatchEvent:function(e){if(!e.type){throw new Error("unspecified type")}var t=this._namedListeners[e.type];if(t){t.forEach(function(t){try{if(typeof t==="function"){t(e)}else{t.handleEvent(e)}}catch(n){if(typeof console!=="undefined"){console.log(n)}}})}return!e.defaultPrevented},addEventListener:function(e,t){if(typeof t==="function"||t.handleEvent){this._namedListeners[e]=this._namedListeners[e]||[];this._namedListeners[e].push(t)}},removeEventListener:function(e,t){var n=this._namedListeners[e];if(n){for(var r=0;r<n.length;r++){if(n[r]===t){if(n.length===1){delete this._namedListeners[e]}else{n.splice(r,1)}break}}}}};e.prototype.constructor=e;e.attach=function(t){var n=new e;t.dispatchEvent=n.dispatchEvent.bind(n);t.addEventListener=n.addEventListener.bind(n);t.removeEventListener=n.removeEventListener.bind(n)};return e});define("orion/objects",[],function(){function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n){if(Object.prototype.hasOwnProperty.call(n,r)){e[r]=n[r]}}}return e}return{clone:function(t){if(Array.isArray(t)){return Array.prototype.slice.call(t)}var n=Object.create(Object.getPrototypeOf(t));e(n,t);return n},mixin:e,toArray:function(e){return Array.isArray(e)?e:[e]}}});define("orion/inputManager",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/Deferred","orion/EventTarget","orion/objects","orion/PageUtil"],function(e,t,n,r,i,s){function o(e){this._document=e.document||document;this._timeout=e.timeout;var t=["keypress","keydown","keyup","mousemove","mousedown","mousemove"];var n=function(e){this._resetTimer()}.bind(this);for(var i=0;i<t.length;i++){var s=t[i];this._document.addEventListener(s,n,true)}r.attach(this)}function u(t,n){if(!t){window.console.log(n);return}if(n.status===0){n={Severity:"Error",Message:e.noResponse}}else{var r=n.responseText;if(r){try{n=JSON.parse(r)}catch(i){n={Severity:"Error",Message:r}}}}t.setProgressResult(n)}function a(e){r.attach(this);this.serviceRegistry=e.serviceRegistry;this.fileClient=e.fileClient;this.progressService=e.progressService;this.contentTypeRegistry=e.contentTypeRegistry;this.selection=e.selection;this._input=this._title="";this.dispatcher=null;this._unsavedChanges=[]}o.prototype={_resetTimer:function(){var e=this._document.defaultView||this._document.parentWindow;if(this._timer){e.clearTimeout(this._timer);this._timer=null}if(this._timeout!==-1){this._timer=e.setTimeout(function(){this.onIdle({type:"Idle"});this._timer=null;this._resetTimer()}.bind(this),this._timeout)}},onIdle:function(e){return this.dispatchEvent(e)},setTimeout:function(e){this._timeout=e;this._resetTimer()}};i.mixin(a.prototype,{_maybeLoadWorkspace:function(e){var t=this.fileClient;if(e===t.fileServiceRootURL(e)){return t.loadWorkspace(e).then(function(e){return e.Location})}return(new n).resolve(e)},_read:function(e){var t=this.fileClient;var n=Array.prototype.slice.call(arguments,1);return this._maybeLoadWorkspace(e).then(function(e){return t.read.apply(t,[e].concat(n))})},load:function(){var n=this.getInput();if(!n){return}var r=this.fileClient;var i=this._parsedLocation.resource;var s=this.progressService;var o=function(e,n,r){if(!s){return e}return s.progress(e,t.formatMessage(n,r))};var a=this.getEditor();if(this._fileMetadata){if(!this._saving&&!this._fileMetadata.Directory&&!this._readonly){o(r.read(i,true),e.ReadingMetadata,n).then(function(t){if(this._fileMetadata&&this._fileMetadata.Location===t.Location&&this._fileMetadata.ETag!==t.ETag){this._fileMetadata=t;if(!a.isDirty()||window.confirm(e.loadOutOfSync)){o(r.read(i),e.Reading,n).then(function(e){a.setInput(n,null,e);this._unsavedChanges=[]}.bind(this))}}}.bind(this))}}else{var f=i;if(f.indexOf("/gitapi/commit/")===0){var l=f.indexOf("/file");var c=f.indexOf("?",l);if(c===-1){c=f.length}f=f.substring(l,c);this._readonly=true}var h=window.setTimeout(function(){h=null;this.reportStatus(t.formatMessage(e.Fetching,n))}.bind(this),800);var p=function(){this.reportStatus("");if(h){window.clearTimeout(h)}}.bind(this);var d=function(e){p();var t=null;if(this.serviceRegistry){t=this.serviceRegistry.getService("orion.page.message")}u(t,e);this._setNoInput()}.bind(this);this._acceptPatch=null;o(this._read(f,true),e.ReadingMetadata,f).then(function(t){if(t.Directory){o(r.fetchChildren(t.ChildrenLocation),e.Reading,n).then(function(e){p();t.Children=e;this._setInputContents(this._parsedLocation,n,e,t)}.bind(this),d)}else{if(this._isText(t)){o(r.read(i,false,true),e.Reading,n).then(function(e){p();if(typeof e!=="string"){this._acceptPatch=e.acceptPatch;e=e.result}this._setInputContents(this._parsedLocation,n,e,t)}.bind(this),d)}else{p();this._setInputContents(this._parsedLocation,n,null,t)}}}.bind(this),d)}},processParameters:function(e){var t=this.getEditor();if(t&&t.processParameters){t.processParameters(e)}},getEditor:function(){return this.editor},getInput:function(){return this._input},getTitle:function(){return this._title},getFileMetadata:function(){return this._fileMetadata},getReadOnly:function(){var e=this._fileMetadata;return this._readonly||!e||e.Attributes&&e.Attributes.ReadOnly},getContentType:function(){return this._contentType},onFocus:function(e){if(this._autoSaveEnabled&&this._errorSaving){this.save();return}if(this._autoLoadEnabled){this.load()}},onChanging:function(e){if(!this._getSaveDiffsEnabled()){return}var t=this._unsavedChanges.length;var n=e.addedCharCount;var r=e.removedCharCount;var i=e.start;var s=e.start+r;var o=0;if(n===0){o=-1}else if(r===0){o=1}if(t>0){if(o===this.previousChangeType){var u=this._unsavedChanges[t-1];if(r===0&&i===u.end+u.text.length){u.text+=e.text;return}if(e.addedCharCount===0&&s===u.start){u.start=i;return}}}this.previousChangeType=o;this._unsavedChanges.push({start:i,end:s,text:e.text})},reportStatus:function(e){if(this.statusReporter){this.statusReporter(e)}else if(this.editor){this.editor.reportStatus(e)}},save:function(){function y(t){if(i===g.getInput()){g.getFileMetadata().ETag=t.ETag;n.setInput(i,null,s,true)}g.reportStatus("");if(r&&m){m.setProgressResult({Message:e.Saved,Severity:"Normal"})}if(g.afterSave){g.afterSave()}g._saving=false}function b(e){g.reportStatus("");u(m,e);g._saving=false;g._errorSaving=true}if(this._saving){return}var n=this.getEditor();if(!n||!n.isDirty()||this.getReadOnly()){return}var r=this._errorSaving;this._saving=true;var i=this.getInput();this.reportStatus(e["Saving..."]);this.dispatchEvent({type:"Saving",inputManager:this});n.markClean();var s=n.getText();var o=s;if(this._getSaveDiffsEnabled()&&!this._errorSaving){var a=this._unsavedChanges;var f=0;for(var l=0;l<a.length;l++){f+=a[l].text.length}if(s.length>f){o={diff:a}}}this._unsavedChanges=[];this._errorSaving=false;var c=this.getFileMetadata().ETag;var h={ETag:c};var p=this._parsedLocation.resource;var d=this.fileClient.write(p,o,h);var v=this.progressService;var m=null;if(this.serviceRegistry){m=this.serviceRegistry.getService("orion.page.message")}if(v){d=v.progress(d,t.formatMessage(e.savingFile,i))}var g=this;d.then(y,function(n){if(n.status===412){var r=window.confirm(e.saveOutOfSync);if(r){var o=g.fileClient.write(p,s);if(v){o=v.progress(o,t.formatMessage(e.savingFile,i))}o.then(y,b)}else{g._saving=false}}else{b(n)}})},setAutoLoadEnabled:function(e){this._autoLoadEnabled=e},setAutoSaveTimeout:function(e){this._autoSaveEnabled=e!==-1;if(!this._idle){var t={document:document,timeout:e};this._idle=new o(t);this._idle.addEventListener("Idle",function(){if(!this._errorSaving){this.save()}}.bind(this))}else{this._idle.setTimeout(e)}},setContentType:function(e){this._contentType=e},setInput:function(t){if(this._ignoreInput){return}if(!t){t=s.hash()}if(typeof t!=="string"){return}var n=this.getEditor();if(t&&t[0]!=="#"){t="#"+t}var r=s.matchResourceParameters(t),i=this._parsedLocation||{};if(n&&n.isDirty()){var o=this._location;var u=i.resource;var a=r.resource;if(u!==a){if(this._autoSaveEnabled){this.save()}else if(!window.confirm(e.confirmUnsavedChanges)){window.location.hash=o;return}}}var f=n&&i.editor!==r.editor;this._location=t;this._parsedLocation=r;this._ignoreInput=true;if(this.selection){this.selection.setSelections(t)}this._ignoreInput=false;var l=r.resource;if(l){if(l===this._input){if(f){this.reportStatus("");this._setInputContents(r,l,null,this._fileMetadata,this._isText(this._fileMetadata))}else{this.processParameters(r)}}else{this._input=l;this._readonly=false;this._fileMetadata=null;this.load()}}else{this._setNoInput(true)}},setTitle:function(e){var t=e.lastIndexOf("/");var n=e;if(t!==-1){n=n.substring(t+1)}this._title=n},setSaveDiffsEnabled:function(e){this._saveDiffsEnabled=e},_getSaveDiffsEnabled:function(){return this._saveDiffsEnabled&&this._acceptPatch!==null&&this._acceptPatch.indexOf("application/json-patch")!==-1},_isText:function(e){var t=this.contentTypeRegistry.getFileContentType(e);if(!t){return true}var n=this.contentTypeRegistry.getContentType("text/plain");return this.contentTypeRegistry.isExtensionOf(t,n)},_setNoInput:function(e){if(e){this.fileClient.loadWorkspace("").then(function(e){this._input=e.ChildrenLocation;this._setInputContents(e.ChildrenLocation,null,e,e)}.bind(this));return}this._input=this._title=this._fileMetadata=null;this.setContentType(null);this.dispatchEvent({type:"InputChanged",input:null})},_setInputContents:function(e,t,n,r,i){var s,o=false;if(r){this._fileMetadata=r;this.setTitle(r.Location||String(r));this.setContentType(this.contentTypeRegistry.getFileContentType(r));s=r.Name;o=r.Directory}else{this._fileMetadata=null;this.setTitle(t);this.setContentType(this.contentTypeRegistry.getFilenameContentType(this.getTitle()));s=this.getTitle()}var u=this.getEditor();if(this._focusListener){if(u&&u.getTextView&&u.getTextView()){u.getTextView().removeEventListener("Focus",this._focusListener)}this._focusListener=null}if(this._changingListener){if(u&&u.getModel&&u.getModel()){u.getModel().removeEventListener("Changing",this._changingListener)}this._changingListener=null}var a={type:"InputChanged",input:e,name:s,title:t,contentType:this.getContentType(),metadata:r,location:window.location,contents:n};this.dispatchEvent(a);this.editor=u=a.editor;if(!o){if(u&&u.getTextView&&u.getTextView()){u.getTextView().addEventListener("Focus",this._focusListener=this.onFocus.bind(this))}if(u&&u.getModel&&u.getModel()){u.getModel().addEventListener("Changing",this._changingListener=this.onChanging.bind(this))}if(!i){u.setInput(t,null,n)}this._unsavedChanges=[];this.processParameters(e)}}});return{InputManager:a}});define("orion/util",[],function(){function v(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function g(e,t){if(e.createElementNS){return e.createElementNS(m,t)}return e.createElement(t)}var e=navigator.userAgent;var t=e.indexOf("MSIE")!==-1||e.indexOf("Trident")!==-1?document.documentMode:undefined;var n=parseFloat(e.split("Firefox/")[1]||e.split("Minefield/")[1])||undefined;var r=e.indexOf("Opera")!==-1?parseFloat(e.split("Version/")[1]):undefined;var i=parseFloat(e.split("Chrome/")[1])||undefined;var s=e.indexOf("Safari")!==-1&&!i;var o=parseFloat(e.split("WebKit/")[1])||undefined;var u=e.indexOf("Android")!==-1;var a=e.indexOf("iPad")!==-1;var f=e.indexOf("iPhone")!==-1;var l=a||f;var c=navigator.platform.indexOf("Mac")!==-1;var h=navigator.platform.indexOf("Win")!==-1;var p=navigator.platform.indexOf("Linux")!==-1;var d=h?"\r\n":"\n";var m="http://www.w3.org/1999/xhtml";return{formatMessage:v,createElement:g,isIE:t,isFirefox:n,isOpera:r,isChrome:i,isSafari:s,isWebkit:o,isAndroid:u,isIPad:a,isIPhone:f,isIOS:l,isMac:c,isWindows:h,isLinux:p,platformDelimiter:d}});define("orion/webui/littlelib",["orion/util"],function(e){function t(e,t){if(!t){t=document}return t.querySelector(e)}function n(e,t){if(!t){t=document}return t.querySelectorAll(e)}function r(e,t){return Array.prototype.slice.call(n(e,t))}function i(e){var t=e;if(typeof e==="string"){t=document.getElementById(e)}return t}function s(e,t){if(!e||!t){return false}if(e===t){return true}var n=e.compareDocumentPosition(t);return Boolean(n&16)}function o(e){var t=e.getBoundingClientRect();return{left:t.left+document.documentElement.scrollLeft,top:t.top+document.documentElement.scrollTop,width:t.width,height:t.height}}function u(e){while(e.hasChildNodes()){var t=e.firstChild;e.removeChild(t)}}function a(e){if(e.tabIndex>=0){return e}if(e.hasChildNodes()){for(var t=0;t<e.childNodes.length;t++){var n=a(e.childNodes[t]);if(n){return n}}}return null}function f(e){if(e.tabIndex>=0){return e}if(e.hasChildNodes()){for(var t=e.childNodes.length-1;t>=0;t--){var n=f(e.childNodes[t]);if(n){return n}}}return null}function c(e,t){if(e.nodeType===3){var n=l.exec(e.nodeValue);if(n&&n.length>1){t(e,n)}}if(e.hasChildNodes()){for(var r=0;r<e.childNodes.length;r++){c(e.childNodes[r],t)}}}function h(e,t){c(e,function(e,n){var r=t[n[1]]||n[1];e.parentNode.replaceChild(document.createTextNode(r),e)})}function p(e,t){c(e,function(e,n){var r=t[n[1]];if(r){var i=document.createRange();var s=n.index;i.setStart(e,s);i.setEnd(e,s+n[0].length);i.deleteContents();i.insertNode(r)}})}function v(t,n){function r(e){d.forEach(function(t){var n=false;var r=t.excludeNodes.some(function(t){if(document.body.contains(t)){n=true;return t.contains(e.target)}return false});if(n&&!r){try{t.dismiss(e)}catch(i){if(typeof console!=="undefined"&&console){console.error(i&&i.message)}}}});d=d.filter(function(e){return e.excludeNodes.some(function(e){return document.body.contains(e)})})}if(d===null){d=[];document.addEventListener("click",r,true);if(e.isIOS){document.addEventListener("touchend",function(e){function t(){e.target.removeEventListener("click",t)}if(e.touches.length===0){e.target.addEventListener("click",t)}},false)}}d.push({excludeNodes:t,dismiss:n})}function m(e){d=d.filter(function(t){return e!==t.dismiss})}function g(e){if(window.document.all){e.keyCode=0}if(e.preventDefault){e.preventDefault();e.stopPropagation()}}function y(e){var t=document.getElementsByTagName("iframe");for(var n=0;n<t.length;n++){t[n].parentNode.style.pointerEvents=e?"":"none"}}var l=/\$\{([^\}]+)\}/;var d=null;var b={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46};return{$:t,$$:n,$$array:r,node:i,contains:s,bounds:o,empty:u,firstTabbable:a,lastTabbable:f,stop:g,processTextNodes:h,processDOMNodes:p,addAutoDismiss:v,setFramesEnabled:y,removeAutoDismiss:m,KEY:b}});define("orion/breadcrumbs",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}n.prototype={_init:function(e){var n=t.node(e.container);if(!n){throw"no parent container"}this._container=n;n.classList.remove("currentLocation");this._id=e.id||"eclipse.breadcrumbs";this._resource=e.resource||null;this._rootSegmentName=e.rootSegmentName;this._workspaceRootSegmentName=e.workspaceRootSegmentName;this._workspaceRootURL=e.workspaceRootURL;this._makeHref=e.makeHref;this._makeFinalHref=e.makeFinalHref;this._maxLength=e.maxLength;this.path="";this.measure();this.render()},getNavigatorWorkspaceRootSegment:function(){if(this._workspaceRootSegmentName){var n;if(this._resource&&this._resource.Parents){n=document.createElement("a");var r=this._workspaceRootURL?this._workspaceRootURL:"";if(this._makeHref){this._makeHref(n,r)}else{n.href=e.toUrl("edit/edit.html")+"#"+r}}else{n=document.createElement("span")}t.empty(n);n.appendChild(document.createTextNode(this._workspaceRootSegmentName));return n}return null},MAX_LENGTH:500,INCLUDE_FIRST_SECTION:true,segments:[],buildSegment:function(e){var t=document.createElement("a");t.classList.add("breadcrumb");t.appendChild(document.createTextNode(e));return t},addSegmentHref:function(t,n){if(this._makeHref){this._makeHref(t,n.Location,n)}else{t.href=e.toUrl("edit/edit.html")+"#"+n.ChildrenLocation}},buildSegments:function(e,t){if(this._resource.Parents){var n=this._resource.Parents.slice(0);var r;var i;if(n){var s=n.slice(0);if(t==="reverse"){s=s.reverse().slice(0)}s.forEach(function(t){if(e){i=e;e=null}else{i=t.Name}r=this.buildSegment(i);this.path+=t.Name;this.addSegmentHref(r,t);r.include=false;this.segments.push(r)}.bind(this))}}},addDivider:function(){var e=document.createElement("span");e.appendChild(document.createTextNode(" / "));this.path+="/";e.classList.add("breadcrumbSeparator");this.append(e)},refresh:function(){this.crumbs=t.node(this._id);if(this.crumbs){t.empty(this.crumbs)}else{this.crumbs=document.createElement("span");this.crumbs.id=this._id;this._container.appendChild(this.crumbs);this.dirty=document.createElement("span");this.dirty.id="dirty";this.dirty.className="modifiedFileMarker";this._container.appendChild(this.dirty)}this.crumbs.style.width="auto";this.crumbs.style.visibility="visible";this.crumbs.parentNode.className="currentLocation";this.crumbs.parentNode.style.width="auto"},append:function(e){this.crumbs.appendChild(e)},addTitle:function(e,t){var n=t||document.title;if(this.crumbs.childNodes.length===0){e=document.createElement("span");e.appendChild(document.createTextNode(n));e.classList.add("breadcrumb");e.classList.add("currentLocation");this.append(e)}},finalSegment:function(e,t){var n;if(t){n=t}else{n=this._resource.Name}if(this._makeFinalHref){e=this.buildSegment(n);this.addSegmentHref(e,this._resource)}else{e=document.createElement("span");e.appendChild(document.createTextNode(n))}e.classList.add("currentLocation");this.path+=this._resource.Name;this.append(e)},firstSegment:function(e){if(e){this.append(e);if(this._resource&&this._resource.Parents){e.classList.add("breadcrumb");this.addDivider()}else{e.href="";e.classList.add("currentLocation");return}}},drawSegments:function(){if(this._resource.Parents){var e=this.segments.slice(0);e.forEach(function(e){if(e.include===true){this.append(e);this.addDivider()}}.bind(this))}},measureSegments:function(){this.INCLUDE_FIRST_SECTION=true;if(this._resource.Parents){var e=this.segments.slice(0).reverse();e.forEach(function(e){this.append(e);this.addDivider();if(this.crumbs.offsetWidth<this.MAX_LENGTH){e.include=true}else{this.INCLUDE_FIRST_SECTION=false}}.bind(this));this.segments=e.reverse()}},measure:function(){var e=this._container;e.style.width="auto";if(this._maxLength){this.MAX_LENGTH=this._maxLength}else{this.MAX_LENGTH=e.offsetWidth}this.refresh();this.segments=[];this.crumbs.style.visibility="hidden";var t=this.getNavigatorWorkspaceRootSegment();var n=this._rootSegmentName;if(n){this.addTitle(t,n)}else{this.finalSegment(t,n);if(this._resource&&this._resource.Parents){this.buildSegments(n,"reverse");this.measureSegments();this.firstSegment(t)}if(this.crumbs.offsetWidth>=this.MAX_LENGTH){this.INCLUDE_FIRST_SECTION=false}}},render:function(){this.refresh();var e=this.getNavigatorWorkspaceRootSegment();var t=this._rootSegmentName;if(t){this.addTitle(e,t)}else{if(this.INCLUDE_FIRST_SECTION===true){this.firstSegment(e)}if(this._resource&&this._resource.Parents){this.drawSegments();this.finalSegment(e,t)}}this.crumbs.parentNode.style.width=this.crumbs.offsetWidth+20+"px"}};n.prototype.constructor=n;return{BreadCrumbs:n}});define("orion/navigate/nls/root/messages",{"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.":"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.","Toggle Left Pane":"Toggle Left Pane","Open or close the left pane":"Open or close the left pane",Navigator:"Navigator","Strings Xtrnalizr":"Strings Xtrnalizr","Externalize Strings from JavaScript files in this folder":"Externalize Strings from JavaScript files in this folder","Choose a Folder":"Choose a Folder","Copy of ${0}":"Copy of ${0}","Enter a new name for '${0}'":"Enter a new name for '${0}'","Choose folder...":"Choose folder...",Rename:"Rename","Rename the selected files or folders":"Rename the selected files or folders","Compare with each other":"Compare with each other","Compare the selected 2 files with each other":"Compare the selected 2 files with each other","Compare with...":"Compare with...","Compare the selected folder with a specified folder":"Compare the selected folder with a specified folder",Delete:"Delete","Unknown item":"Unknown item","Are you sure you want to delete these ${0} items?":"Are you sure you want to delete these ${0} items?","Are you sure you want to delete '${0}'?":"Are you sure you want to delete '${0}'?","Export as zip":"Export as zip","Create a zip file of the folder contents and download it":"Create a zip file of the folder contents and download it","New File":"New File","Create a new file":"Create a new file","Name:":"Name:","New Folder":"New Folder","Folder name:":"Folder name:","Create a new folder":"Create a new folder","Creating folder":"Creating folder",Folder:"Folder","Create an empty folder":"Create an empty folder","Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.":"Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.","Sample HTML5 Site":"Sample HTML5 Site","Generate a sample":"Generate a sample",'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.':'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.',"Creating a folder for ${0}":"Creating a folder for ${0}","SFTP Import":"SFTP Import","Import content from SFTP":"Import content from SFTP","Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.":"Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.","Imported Content":"Imported Content","Upload a Zip":"Upload a Zip","Upload content from a local zip file":"Upload content from a local zip file","Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.":"Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.","Uploaded Content":"Uploaded Content","Creating an upload folder for ":"Creating an upload folder for ","Clone Git Repository":"Clone Git Repository","Clone a git repository":"Clone a git repository","Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.":"Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.","Link to Server":"Link to Server","Link to existing content on the server":"Link to existing content on the server","Create a folder that links to an existing folder on the server.":"Create a folder that links to an existing folder on the server.","Server path:":"Server path:","The name and server location were not specified.":"The name and server location were not specified.","Go Up":"Go Up","Move up to the parent folder":"Move up to the parent folder","Go Into":"Go Into","Move into the selected folder":"Move into the selected folder","Import local file...":"Import local file...","Copy files and folders from your local file system":"Copy files and folders from your local file system","SFTP from...":"SFTP from...","Copy files and folders from a specified SFTP connection":"Copy files and folders from a specified SFTP connection","Importing from ${0}":"Importing from ${0}","SFTP to...":"SFTP to...","Copy files and folders to a specified SFTP location":"Copy files and folders to a specified SFTP location",Exporting:"Exporting to ${0}","Pasting ${0}":"Pasting ${0}","Copy to":"Copy to","Move to":"Move to","Copying ${0}":"Copying ${0}","Moving ${0}":"Moving ${0}","Renaming ${0}":"Renaming ${0}","Deleting ${0}":"Deleting ${0}","Creating ${0}":"Creating ${0}","Linking to ${0}":"Linking to ${0}","Move files and folders to a new location":"Move files and folders to a new location",Cut:"Cut",Copy:"Copy","Fetching children of ":"Fetching children of ",Paste:"Paste","Cannot paste into the Workspace root":"Cannot paste into the Workspace root","Open With":"Open With","Loading ":"Loading ",New:"New",Actions:"Actions","Orion Content":"Orion Content"," is not supported in this file system":" is not supported in this file system","Create new content":"Create new content","Import from HTTP...":"Import from HTTP...","File URL:":"File URL:","Copy a file from a URL and optionally unzip it":"Copy a file from a URL and optionally unzip it","Unzip *.zip files:":"Unzip *.zip files:","Extracted from:":"Extracted from:","Did not drop ${0}.  Folder drop is not supported in this browser.":"Did not drop ${0}.  Folder drop is not supported in this browser.","You cannot copy files directly into the workspace.  Create a folder first.":"You cannot copy files directly into the workspace.  Create a folder first.","Unzip ${0}?":"Unzip ${0}?",NoFile:"Use the ${0} to create new files and folders. Click a file to start coding."});define("orion/navigate/nls/messages",["orion/i18n!orion/navigate/nls/messages","orion/navigate/nls/root/messages"],function(e,t){var n={root:t};Object.keys(e).forEach(function(t){if(typeof n[t]==="undefined"){n[t]=e[t]}});return n});define("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Shell:"Shell","Get Plugins":"Get Plugins",Global:"Global",Editor:"Editor","Filter bindings":"Filter bindings","Orion Editor":"Orion Editor","Orion Image Viewer":"Orion Image Viewer","Orion Markdown Viewer":"Orion Markdown Viewer","Orion JSON Editor":"Orion JSON Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion","Show a list of all the keybindings on this page":"Show a list of all the keybindings on this page","Show Keys":"Show Keys","Hide or show the page banner and footer":"Hide or show the page banner and footer","Toggle banner and footer":"Toggle banner and footer","Choose a file by name and open an editor on it":"Choose a file by name and open an editor on it","Find File Named...":"Find File Named...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown","Unknown item":"Unknown item","Can't search: no search service is available":"Can't search: no search service is available","could not find banner parent, id was ":"could not find banner parent, id was ",Related:"Related",Options:"Options",FAQ:"FAQ","Report a Bug":"Bugs","Privacy Policy":"Privacy","Terms of Use":"Terms","Copyright Agent":"Copyright","Orion Logo":"Orion Logo","Orion is in Beta. Please try it out but BEWARE your data may be lost.":"@buildLabel@","LOG: ":"LOG: ",View:"View","no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ","Resource is out of sync with the server. Do you want to save it anyway?":"Resource is out of sync with the server. Do you want to save it anyway?",Operations:"Operations","Operations running":"Operations running","Some operations finished with warning":"Some operations finished with warning","Some operations finished with error":"Some operations finished with error","no service registry":"no service registry",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",More:"More","Saved searches":"Saved searches","Recent searches":"Recent searches","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Sidebar":"Toggle Sidebar","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.","Sample Orion Plugin":"Sample Orion Plugin","Generate a sample plugin for integrating with Orion.":"Generate a sample plugin for integrating with Orion.",Browser:"Web Browser",OutlineProgress:"Getting outline for ${0} from ${1}",UnknownError:"An unknown error occurred.",UnknownWarning:"An unknown warning occurred.",Filter:"Filter (* = any string, ? = any character)","To view the browser's context menu, trigger the context menu again.":"To view the browser's context menu, trigger the context menu again."});define("orion/nls/messages",["orion/i18n!orion/nls/messages","orion/nls/root/messages"],function(e,t){var n={root:t};Object.keys(e).forEach(function(t){if(typeof n[t]==="undefined"){n[t]=e[t]}});return n});(function(){function v(e){if(typeof e!=="string"){throw new TypeError}}function m(e){return e?e.split("&"):[]}function g(e){if(e.length===0){return""}return e.join("&")}function y(e){var t=/([^=]*)(?:=?)(.*)/.exec(e);var n=t[1]?decodeURIComponent(t[1]):"";var r=t[2]?decodeURIComponent(t[2]):"";return[n,r]}function b(e){var t=encodeURIComponent(e[0]);if(e[1]){t+="="+encodeURIComponent(e[1])}return t}function w(e,t){var n="";var r=[];var i=0;return{next:function(){if(n!==e.query){n=e.query;r=m(n)}if(i<r.length){var s=y(r[i++]);switch(t){case"keys":return s[0];case"values":return s[1];case"keys+values":return[s[0],s[1]];default:throw new TypeError}}throw p}}}function E(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function S(e,t){if(!e.scheme&&t){e.scheme=t.scheme;if(!e.host&&t.host){e.userinfo=t.userinfo;e.host=t.host;e.port=t.port;e.pathRelative=true}}if(e.pathRelative){if(!e.path){e.path=t.path}else if(e.path[0]!=="/"){var n=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=n+e.path}}}function x(e){return e.toLowerCase()}function T(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function N(e){var t=[];e.split("/").forEach(function(e){if(e===".."){t.pop()}else if(e!=="."){t.push(e)}});return t.join("/")}function C(e){if(e.scheme){e.scheme=x(e.scheme)}if(e.port){e.port=T(e.port)}if(e.host&&e.path){e.path=N(e.path)}}function k(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function L(e,t){if(typeof e!=="string"){throw new TypeError}e=k(e);var i=n.exec(e);if(!i){return null}var u={};u.scheme=i[1]||"";if(u.scheme&&!s.test(u.scheme)){return null}var a=i[2];if(a){var f=r.exec(a);u.userinfo=f[1];u.host=f[2];u.port=f[3];if(u.port&&!o.test(u.port)){return null}}u.path=i[3];u.query=i[4];u.fragment=i[5];S(u,t);C(u);return u}function A(e){var t=e.scheme?e.scheme+":":"";if(e.host){t+="//";if(e.userinfo){t+=e.userinfo+"@"}t+=e.host;if(e.port){t+=":"+e.port}}t+=e.path;if(e.query){t+="?"+e.query}if(e.fragment){t+="#"+e.fragment}return t}function O(e,t){var n;if(t){t=t.href||t;n=L(t);if(!n||!n.scheme){throw new SyntaxError}Object.defineProperty(this,"_baseURL",{value:n})}var r=L(e,n);if(!r){throw new SyntaxError}Object.defineProperty(this,"_input",{value:e,writable:true});Object.defineProperty(this,"_url",{value:r,writable:true});var i=new E(this);Object.defineProperty(this,"query",{get:function(){return this._url?i:null},enumerable:true})}try{var e;if(typeof window.URL==="function"&&window.URL.length!==0&&(e=new window.URL("http://www.w3.org?q")).protocol==="http:"&&e.query){return}}catch(t){}var n=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;var r=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/;var i=/^\S*$/;var s=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/;var o=/^\d*$/;var u=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/;var a=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/;var f=/^([^?#\s]*)$/;var l=/^([^\s]*)$/;var c=i;var h=/([^:]*):?(.*)/;var p=typeof StopIteration!=="undefined"?StopIteration:new Error("Stop Iteration");var d={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(E.prototype,{get:{value:function(e){v(e);var t;var n=m(this._url.query);n.some(function(n){var r=y(n);if(r[0]===e){t=r[1];return true}});return t},enumerable:true},set:{value:function(e,t){v(e);v(t);var n=m(this._url.query);var r=n.some(function(r,i){var s=y(r);if(s[0]===e){s[1]=t;n[i]=b(s);return true}});if(!r){n.push(b([e,t]))}this._url.query=g(n)},enumerable:true},has:{value:function(e){v(e);var t=m(this._url.query);return t.some(function(t){var n=y(t);if(n[0]===e){return true}})},enumerable:true},"delete":{value:function(e){v(e);var t=m(this._url.query);var n=t.filter(function(t){var n=y(t);return n[0]!==e});if(n.length!==t.length){this._url.query=g(n);return true}return false},enumerable:true},clear:{value:function(){this._url.query=""},enumerable:true},forEach:{value:function(e,t){if(typeof e!=="function"){throw new TypeError}var n=w(this._url,"keys+values");try{while(true){var r=n.next();e.call(t,r[1],r[0],this)}}catch(i){if(i!==p){throw i}}},enumerable:true},keys:{value:function(){return w(this._url,"keys")},enumerable:true},values:{value:function(){return w(this._url,"values")},enumerable:true},items:{value:function(){return w(this._url,"keys+values")}},size:{get:function(){return m(this._url.query).length},enumerable:true},getAll:{value:function(e){v(e);var t=[];var n=m(this._url.query);n.forEach(function(n){var r=y(n);if(r[0]===e){t.push(r[1])}});return t},enumerable:true},append:{value:function(e,t){v(e);v(t);var n=m(this._url.query);n.push(b([e,t]));this._url.query=g(n)},enumerable:true}});Object.defineProperties(O.prototype,{href:{get:function(){return this._url?A(this._url):this._input},set:function(e){v(e);this._input=e;this._url=L(this._input,this._baseURL)},enumerable:true},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:true},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(e){v(e);if(!this._url){return}var t=e.slice(-1)===":"?e.substring(0,e.length-1):e;if(t===""||s.test(t)){this._url.scheme=x(t)}},enumerable:true},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(e){v(e);if(!this._url){return}this._url.userinfo=e}},username:{get:function(){if(!this._url){return""}var e=h.exec(this._userinfo);var t=decodeURIComponent(e[1]||"");return t},set:function(e){v(e);if(!this._url){return}var t=h.exec(this._userinfo);var n=[encodeURIComponent(e||"")];if(t[2]){n.push(t[2])}this._userinfo=n.join(":")},enumerable:true},password:{get:function(){if(!this._url){return""}var e=h.exec(this._userinfo);var t=decodeURIComponent(e[2]||"");return t},set:function(e){v(e);if(!this._url){return}var t=h.exec(this._userinfo);var n=[t[1]||""];if(e){n.push(encodeURIComponent(e))}this._userinfo=n.join(":")},enumerable:true},host:{get:function(){var e="";if(this._url&&this._url.host){e+=this._url.host;if(this._url.port){e+=":"+this._url.port}}return e},set:function(e){v(e);if(!this._url){return}var t=a.exec(e);if(t){this._url.host=t[1];this._url.port=T(t[2])}},enumerable:true},hostname:{get:function(){return this._url?this._url.host:""},set:function(e){v(e);if(!this._url){return}var t=u.exec(e);if(t){this._url.host=e}},enumerable:true},port:{get:function(){var e=this._url?this._url.port||"":"";if(e&&e===d[this.protocol]){e=""}return e},set:function(e){v(e);if(!this._url){return}var t=o.exec(e);if(t){this._url.port=T(e)}},enumerable:true},pathname:{get:function(){return this._url?this._url.path:""},set:function(e){v(e);if(!this._url){return}var t=f.exec(e);if(t){if(this._url.host&&e&&e[0]!=="/"){e="/"+e}this._url.path=e?N(e):""}},enumerable:true},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(e){v(e);if(!this._url){return}if(e&&e[0]==="?"){e=e.substring(1)}var t=l.exec(e);if(t){this._url.query=e}},enumerable:true},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(e){v(e);if(!this._url){return}if(e&&e[0]==="#"){e=e.substring(1)}var t=c.exec(e);if(t){this._url.fragment=e}},enumerable:true}});var M=window.URL||window.webkitURL;if(M&&M.createObjectURL){Object.defineProperty(O,"createObjectURL",{value:M.createObjectURL.bind(M),enumerable:false});Object.defineProperty(O,"revokeObjectURL",{value:M.revokeObjectURL.bind(M),enumerable:false})}window.URL=O})();define("orion/URL-shim",function(){});define("orion/fileUtils",["require","i18n!orion/nls/messages","orion/URL-shim"],function(e,t){function n(e){if(!e){return e}var t=window.location.protocol+"//"+window.location.host;if(e.indexOf(t)===0){return e.substring(t.length)}return e}function r(t){if(!t){return false}if(t==="/workspace"){return true}var n=new URL(e.toUrl("workspace"),window.location.href);var r=new URL(t,window.location.href);return r.href.indexOf(n.href)===0}return{makeRelative:n,isAtRoot:r}});define("orion/webui/treetable",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}n.prototype={_init:function(n){var r=n.parent;var i=this;r=t.node(r);if(!r){throw e["no parent"]}if(!n.model){throw e["no tree model"]}if(!n.renderer){throw e["no renderer"]}this._parent=r;this._treeModel=n.model;this._onComplete=n.onComplete;this._renderer=n.renderer;this._showRoot=n.showRoot===undefined?false:n.showRoot;this._indent=n.indent===undefined?16:n.indent;this._onCollapse=n.onCollapse;this._labelColumnIndex=n.labelColumnIndex===undefined?0:n.labelColumnIndex;this._id=n.id===undefined?"treetable":n.id;this._tableStyle=n.tableStyle;this._tableElement=n.tableElement||"table";this._tableBodyElement=n.tableBodyElement||"tbody";this._tableRowElement=n.tableRowElement||"tr";this._root=this._treeModel.getRoot(function(e){if(i._showRoot){e._depth=0;i._generate([e],0)}else{i._treeModel.getChildren(e,function(e){if(i.destroyed){return}i._generate(e,0)})}})},destroy:function(){this.destroyed=true},_generate:function(e,n){t.empty(this._parent);var r=document.createElement("div");if(this._renderer.wrapperCallback){this._renderer.wrapperCallback(r)}var i=document.createElement(this._tableElement);if(this._renderer.tableCallback){this._renderer.tableCallback(i)}i.id=this._id;if(this._tableStyle){i.classList.add(this._tableStyle)}this._renderer.initTable(i,this);this._bodyElement=document.createElement(this._tableBodyElement);if(this._renderer.bodyCallback){this._renderer.bodyCallback(this._bodyElement)}this._bodyElement.id=this._id+"tbody";if(e.length===0){if(this._renderer.emptyCallback){this._renderer.emptyCallback(this._bodyElement)}}else{this._generateChildren(e,n)}i.appendChild(this._bodyElement);r.appendChild(i);this._parent.appendChild(r);this._rowsChanged();if(this._onComplete){this._onComplete(this)}},_generateChildren:function(e,t,n){for(var r=0;r<e.length;r++){var i=document.createElement(this._tableRowElement);i.id=this._treeModel.getId(e[r]);i._depth=t;i._item=e[r];this._renderer.render(e[r],i);var s=this._indent*t;i.childNodes[this._labelColumnIndex].style.paddingLeft=s+"px";if(this._renderer.rowCallback){this._renderer.rowCallback(i,e[r])}if(n){this._bodyElement.insertBefore(i,n.nextSibling);if(n){n=i}}else{this._bodyElement.appendChild(i)}}},_rowsChanged:function(){if(this._renderer.rowsChanged){this._renderer.rowsChanged()}},getSelected:function(){return this._renderer.getSelected()},refresh:function(n,r,i){var s=this._treeModel.getId(n);var o;if(s===this._id){this._removeChildRows(s);this._generateChildren(r,0);this._rowsChanged()}else{var u=t.node(s);if(u){u._item=n;if(u&&(i||u._expanded)){this._removeChildRows(s);if(r){u._expanded=true;this._renderer.updateExpandVisuals(u,true);this._generateChildren(r,u._depth+1,u);this._rowsChanged()}else{o=this;this._renderer.updateExpandVisuals(u,"progress");r=this._treeModel.getChildren(u._item,function(e){if(o.destroyed){return}o._renderer.updateExpandVisuals(u,true);if(!u._expanded){u._expanded=true;o._generateChildren(e,u._depth+1,u);o._rowsChanged()}})}}else{this._renderer.updateExpandVisuals(u,false)}}else{console.log(e["could not find table row "]+s)}}},getItem:function(e){var n=t.node(e);if(n&&n._item){return n._item}return e},toggle:function(e){var n=t.node(e);if(n){if(n._expanded){this.collapse(e)}else{this.expand(e)}}},isExpanded:function(e){var n=typeof e==="string"?e:this._treeModel.getId(e);var r=t.node(n);if(r){return r._expanded}return false},expand:function(e,n,r){var i=typeof e==="string"?e:this._treeModel.getId(e);var s=t.node(i);if(s){if(s._expanded){if(n){n.apply(o,r)}return}var o=this;this._renderer.updateExpandVisuals(s,"progress");this._treeModel.getChildren(s._item,function(e){if(o.destroyed){return}o._renderer.updateExpandVisuals(s,true);if(!s._expanded){s._expanded=true;o._generateChildren(e,s._depth+1,s);o._rowsChanged()}if(n){n.apply(o,r)}})}},_removeChildRows:function(e){var n=e===this._id;var r=false;var i=-1;var s=[];var o=t.$$array(".treeTableRow",this._parent);for(var u=0;u<o.length;u++){var a=o[u];if(r){break}if(n){if(a._depth>i){s.push(a)}else{r=true}}else{if(a.id===e){n=true;i=a._depth}}}for(var f=0;f<s.length;f++){var l=s[f];l.parentNode.removeChild(l)}},collapse:function(e){var n=typeof e==="string"?e:this._treeModel.getId(e);var r=t.node(n);if(r){if(!r._expanded){return}r._expanded=false;this._renderer.updateExpandVisuals(r,false);this._removeChildRows(n);this._rowsChanged()}if(this._onCollapse){this._onCollapse(r._item)}}};n.prototype.constructor=n;return{TableTree:n}});define("orion/treeModelIterator",[],function(){var e={};e.TreeModelIterator=function(){function e(e,t){this.firstLevelChildren=e;this.reset();this._init(t)}e.prototype={_init:function(e){if(!e){return}this.isExpanded=e.isExpanded;this.isExpandable=e.isExpandable;this.forceExpandFunc=e.forceExpandFunc;this.getChildrenFunc=e.getChildrenFunc},topLevel:function(e){return e.parent?e.parent===this.root:true},_getChildren:function(e){if(typeof this.getChildrenFunc==="function"){return this.getChildrenFunc(e)}return e?e.children:null},_expanded:function(e){if(!e){return true}var t=this._getChildren(e);var n=t&&t.length>0;if(this.isExpanded&&n){n=this.isExpanded(e)}return n},_expandable:function(e){if(!e){return true}if(this.isExpandable){return this.isExpandable(e)}return false},_diveIn:function(e){if(this._expanded(e)){var t=this._getChildren(e);this.setCursor(t[0]);return this.cursor()}return null},_drillToLast:function(e){if(this._expanded(e)){var t=this._getChildren(e);return this._drillToLast(t[t.length-1])}return e},_forward:function(e){if(!this._cursor){return null}var t=this._diveIn(this._cursor);if(!t){if(e&&this._expandable(this._cursor)&&this.forceExpandFunc){var n=this;return this.forceExpandFunc(this._cursor,"first",function(e){if(e){n.setCursor(e)}})}t=this._findSibling(this._cursor,true);if(t){this.setCursor(t)}}return t},_backward:function(e){if(!this._cursor){return null}var t=this._findSibling(this._cursor,false);if(t&&t!==this._cursor.parent){t=this._drillToLast(t)}if(e&&t&&this._expandable(t)&&this.forceExpandFunc&&t!==this._cursor.parent){var n=this;return this.forceExpandFunc(t,"last",function(e){if(e){n.setCursor(e)}})}if(t){this.setCursor(t)}return t},_findSibling:function(e,t){var n=this.topLevel(e);var r=this._getChildren(e.parent);var i=n?this.firstLevelChildren:r;for(var s=0;s<i.length;s++){if(i[s]===e){if(s===0&&!t){return n?null:e.parent}else if(s===i.length-1&&t){return n?null:this._findSibling(e.parent,t)}else{return t?i[s+1]:i[s-1]}}}return null},_inParentChain:function(e,t){var n=e.parent;while(n){if(n===t){return true}n=n.parent}return false},_getTopLevelParent:function(e){if(this.topLevel(e)){return e}var t=e.parent;while(t){if(this.topLevel(t)){return t}t=t.parent}return null},_onCollapse:function(e){if(this._expanded(e.parent)){return e}return this._onCollapse(e.parent)},_scan:function(e,t,n){this.setCursor(t);var r=[];r.push(t);while(true){if(this.iterate(e)){r.push(this.cursor())}else{break}if(n===this.cursor()){return r}}r=[];return null},setCursor:function(e){this._prevCursor=this._cursor;this._cursor=e},setTree:function(e){this.firstLevelChildren=e;if(this.firstLevelChildren.length>0){this.root=this.firstLevelChildren[0].parent}},scan:function(e,t){var n=this.cursor();var r=this._scan(true,e,t);if(!r){r=this._scan(false,e,t)}this.setCursor(n);return r},iterate:function(e,t){return e?this._forward(t):this._backward(t)},iterateOnTop:function(e,t){var n=this._findSibling(this._getTopLevelParent(this.cursor()),e);if(n){this.setCursor(n)}else if(t&&this.firstLevelChildren.length>0){this.setCursor(e?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])}},collapse:function(e){if(!this._cursor){return null}if(this._inParentChain(this._cursor,e)){this.setCursor(e);return this._cursor}return null},reset:function(){this._cursor=null;this._prevCursor=null;this.root=null;if(this.firstLevelChildren.length>0){this._cursor=this.firstLevelChildren[0];this.root=this.firstLevelChildren[0].parent}},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}};return e}();return e});define("orion/uiUtils",["orion/webui/littlelib"],function(e){function t(t){var n="";var r=navigator.platform.indexOf("Mac")!==-1;if(t.mod1){if(r){n+="Cmd+"}else{n+="Ctrl+"}}if(t.mod2){n+="Shift+"}if(t.mod3){n+="Alt+"}if(t.mod4&&r){n+="Ctrl+"}if(t.alphaKey){return n+t.alphaKey}if(t.type==="keypress"){return n+t.keyCode}for(var i in e.KEY){if(typeof (e.KEY[i]==="number")){if(e.KEY[i]===t.keyCode){return n+i}}}var s;switch(t.keyCode){case 59:s=t.mod2?":":";";break;case 61:s=t.mod2?"+":"=";break;case 188:s=t.mod2?"<":",";break;case 190:s=t.mod2?">":".";break;case 191:s=t.mod2?"?":"/";break;case 192:s=t.mod2?"~":"`";break;case 219:s=t.mod2?"{":"[";break;case 220:s=t.mod2?"|":"\\";break;case 221:s=t.mod2?"}":"]";break;case 222:s=t.mod2?'"':"'";break}if(s){return n+s}if(t.keyCode>=112&&t.keyCode<=123){return n+"F"+(t.keyCode-111)}return n+String.fromCharCode(t.keyCode)}function n(e){var n="";var r=e.getKeys();for(var i=0;i<r.length;i++){if(i!==0){n+=" "}n+=t(r[i])}return n}function r(t,n,r,i,s,o,u,a,f){var l=false;var c=function(u){return function(a){if(l){return}var c=e.node(t),h=c.value;if(!c){return}if(u&&a.keyCode===e.KEY.ESCAPE){if(r){n.style.display="inline"}l=true;c.parentNode.removeChild(c);if(o){o()}return}if(u&&a.keyCode!==e.KEY.ENTER){return}else if(h.length===0||!f&&h===i){if(r){n.style.display="inline"}l=true}else{s(h);if(r&&n.parentNode){n.style.display="inline"}l=true}if(c.parentNode){c.parentNode.removeChild(c)}if(o){o()}}};var h=document.createElement("input");h.id=t;h.value=i||"";n.parentNode.insertBefore(h,n.nextSibling);h.classList.add("userEditBoxPrompt");if(r){n.style.display="none"}h.addEventListener("keydown",c(true),false);h.addEventListener("blur",c(false),false);window.setTimeout(function(){h.focus();if(i){var n=e.node(t);var r=a?i.indexOf(a):-1;if(r>0){if(n.createTextRange){var s=n.createTextRange();s.collapse(true);s.moveStart("character",0);s.moveEnd("character",r);s.select()}else if(n.setSelectionRange){n.setSelectionRange(0,r)}else if(n.selectionStart!==undefined){n.selectionStart=0;n.selectionEnd=r}}else{n.select()}}},0)}function i(e){var t=window.navigator.platform.indexOf("Mac")!==-1;return t&&e.metaKey||!t&&e.ctrlKey}function s(e,t){if(t&&i(t)){window.open(e)}else{window.location=e}}function o(t,n){var r=document.createElement("button");r.className="orionButton commandButton commandMargins";r.addEventListener("click",function(t){n();e.stop(t)},false);if(t){r.appendChild(document.createTextNode(t))}return r}function u(e,t,n){}function a(e){switch(e.tagName.toLowerCase()){case"button":case"fieldset":case"form":case"input":case"keygen":case"label":case"legend":case"meter":case"optgroup":case"output":case"progress":case"select":case"textarea":return true}return false}return{getUserKeyString:n,getUserText:r,openInNewWindow:i,followLink:s,createButton:o,createDropdownButton:u,isFormElement:a}});define("orion/explorers/explorerNavHandler",["orion/webui/littlelib","orion/treeModelIterator","orion/uiUtils"],function(e,t,n){var r={};var i=navigator.userAgent;var s=i.indexOf("iPad")!==-1;var o=window.navigator.platform.indexOf("Mac")!==-1;r.ExplorerNavHandler=function(){function r(r,i,s){this.explorer=r;this.model=this.explorer.model;this._navDict=i;this._listeners=[];this._selections=[];this._currentColumn=0;var o=this._getEventListeningDiv();o.tabIndex=0;o.classList.add("selectionModelContainer");var u=this;this._modelIterator=new t.TreeModelIterator([],{isExpanded:this.isExpanded.bind(this),getChildrenFunc:s.getChildrenFunc,isExpandable:this.explorer.renderer.isExpandable?function(e){return u.explorer.renderer.isExpandable(e)}:function(e){return u.isExpandable(e)},forceExpandFunc:this.explorer.forceExpandFunc?function(e,t,n){return u.explorer.forceExpandFunc(e,t,n)}:undefined});this._init(s);if(!s||s.setFocus!==false){o.focus()}var a=function(t){if(n.isFormElement(t.target)){return true}if(u.explorer.preventDefaultFunc&&u.explorer.preventDefaultFunc(t,u._modelIterator.cursor())){return true}if(t.keyCode===e.KEY.DOWN){return u.onDownArrow(t)}else if(t.keyCode===e.KEY.UP){return u.onUpArrow(t)}else if(t.keyCode===e.KEY.RIGHT){return u.onRightArrow(t)}else if(t.keyCode===e.KEY.LEFT){return u.onLeftArrow(t)}else if(t.keyCode===e.KEY.SPACE){return u.onSpace(t)}else if(t.keyCode===e.KEY.ENTER){return u.onEnter(t)}};o.addEventListener("keydown",a,false);this._listeners.push({type:"keydown",listener:a});var f=function(e){if(u.explorer.onFocus){u.explorer.onFocus(false)}else{u.toggleCursor(null,false)}};o.addEventListener("blur",f,false);this._listeners.push({type:"blur",listener:f});var l=function(e){if(u.explorer.onFocus){u.explorer.onFocus(true)}else{u.toggleCursor(null,true)}};o.addEventListener("focus",l,false);this._listeners.push({type:"focus",listener:l});this._parentDiv=o}r.prototype={destroy:function(){this._parentDiv.classList.remove("selectionModelContainer");this.removeListeners()},_init:function(e){this._linearGridMove=false;if(!e){return}this._selectionPolicy=e.selectionPolicy;this.gridClickSelectionPolicy=e.gridClickSelectionPolicy||"none";this.preventDefaultFunc=e.preventDefaultFunc;this.postDefaultFunc=e.postDefaultFunc},_ctrlKeyOn:function(e){return o?e.metaKey:e.ctrlKey},removeListeners:function(){if(this._listeners){for(var e=0;e<this._listeners.length;e++){this._parentDiv.removeEventListener(this._listeners[e].type,this._listeners[e].listener,false)}}},focus:function(){var e=this._getEventListeningDiv();if(e){e.focus()}},_getEventListeningDiv:function(t){if(this.explorer.keyEventListeningDiv&&typeof this.explorer.keyEventListeningDiv==="function"){return this.explorer.keyEventListeningDiv(t)}return e.node(this.explorer._parentId)},isExpandable:function(t){if(!t){return false}var n=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));return n?true:false},isExpanded:function(e){if(!e){return false}return this.explorer.myTree.isExpanded(this.model.getId(e))},refreshSelection:function(e,t){var n=this;if(this.explorer.selection){this.explorer.selection.getSelections(function(r){n._clearSelection(t);for(var i=0;i<r.length;i++){n._selections.push(r[i])}if(n._selections.length>0){n.cursorOn(n._selections[0],true,false,e)}else{n.cursorOn(null,false,false,e)}if(!(n._shiftSelectionAnchor&&n._inSelection(n._shiftSelectionAnchor)>=0)){n._shiftSelectionAnchor=null}})}},refreshModel:function(e,t,n,r){this._currentColumn=0;this.topIterationNodes=[];this.model=t;this._navDict=e;if(this.model.getTopIterationNodes){this.topIterationNodes=this.model.getTopIterationNodes()}else if(n){this.topIterationNodes=n}this._modelIterator.setTree(this.topIterationNodes);if(!r&&this.explorer.selection){this.toggleCursor(this._modelIterator.cursor(),false);this._modelIterator.reset()}this.refreshSelection(true)},getTopLevelNodes:function(){return this._modelIterator.firstLevelChildren},_inSelection:function(e){var t=this.model.getId(e);for(var n=0;n<this._selections.length;n++){if(t===this.model.getId(this._selections[n])){return n}}return-1},_clearSelection:function(e){if(e){for(var t=0;t<this._selections.length;t++){this._checkRow(this._selections[t],true)}}this._selections=[]},getSelectionPolicy:function(){return this._selectionPolicy},setSelectionPolicy:function(e){if(this._selectionPolicy===e){return}this._selectionPolicy=e;if(this._selectionPolicy==="cursorOnly"){this._clearSelection(true)}},setSelection:function(e,t,n){if(this._selectionPolicy==="cursorOnly"){if(t&&this.explorer.renderer._useCheckboxSelection){this._checkRow(e,true)}return}if(!this._isRowSelectable(e)){return}if(!t||this._selectionPolicy==="singleSelection"){this._clearSelection(true);this._checkRow(e,false);this._selections.push(e);this._lastSelection=e}else{var r=this._inSelection(e);if(r>=0){this._checkRow(e,true);this._selections.splice(r,1)}else{this._checkRow(e,false);this._selections.push(e);this._lastSelection=e}}if(n){this._shiftSelectionAnchor=this._lastSelection}if(this.explorer.selection){this.explorer.renderer.storeSelections();this.explorer.selection.setSelections(this._selections)}},moveColumn:function(e,t){if(!e){e=this.currentModel()}var n=this._getGridChildren(e);if(n&&n.length>1||t===0&&n){if(t!==0){this.toggleCursor(e,false)}var r=this._currentColumn;var i=true;r=r+t;if(r<0){if(this._linearGridMove&&t!==0){if(this._modelIterator.iterate(false)){e=this.currentModel()}else{i=false}}r=i?n.length-1:this._currentColumn}else if(r>=n.length){if(this._linearGridMove&&t!==0){if(this._modelIterator.iterate(true)){e=this.currentModel()}else{i=false}}r=i?0:this._currentColumn}this._currentColumn=r;if(t!==0){this.toggleCursor(e,true)}return true}return false},_getGridChildren:function(e){if(this._navDict){return this._navDict.getGridNavHolder(e)}return null},getCurrentGrid:function(e){if(!e){e=this.currentModel()}var t=this._getGridChildren(e);if(t&&t.length>0){return t[this._currentColumn]}return null},getAriaContainerElement:function(e){var t=this._parentDiv,n;while(e&&e!==t&&(n=e.getAttribute("role"))!=="grid"&&n!=="tree"&&n!=="treegrid"){e=e.parentNode}return e===t?null:e},toggleCursor:function(e,t){var n=this.getRowDiv(e);var r=this.getCurrentGrid(e);if(r){if(n){if(t){n.classList.add("treeIterationCursorRow")}else{n.classList.remove("treeIterationCursorRow")}}if(r.domNode){var i=this.getAriaContainerElement(r.domNode);if(t){r.domNode.classList.add("treeIterationCursor");if(i){var s=r.domNode.id;i.setAttribute("aria-activedescendant",s)}}else{r.domNode.classList.remove("treeIterationCursor")}}}else{if(n){if(t){n.classList.add("treeIterationCursorRow_Dotted")}else{n.classList.remove("treeIterationCursorRow_Dotted")}}}},currentModel:function(){return this._modelIterator.cursor()},cursorOn:function(e,t,n,r){var i,s;if(e||t){if(s===this._modelIterator.cursor()){return}i=this._modelIterator.cursor();s=e;this._modelIterator.setCursor(s)}else{i=this._modelIterator.prevCursor();s=this._modelIterator.cursor()}if(i===s&&!t){return}this.toggleCursor(i,false);if(t&&!s){return}this.moveColumn(null,0);this.toggleCursor(s,true);var o=this.getRowDiv();if(o&&!r){var u=o.parentNode,a=document.documentElement;while(u&&u!==a){var f=window.getComputedStyle(u,null);if(!f){break}var l=f.getPropertyValue("overflow-y");if(l==="auto"||l==="scroll"){break}u=u.parentNode}var c=true;if(o.offsetTop<=u.scrollTop){c=false;if(n===undefined){n=false}}else if(o.offsetTop+o.offsetHeight>=u.scrollTop+u.clientHeight){c=false;if(n===undefined){n=true}}if(!c){o.scrollIntoView(!n)}}if(this.explorer.onCursorChanged){this.explorer.onCursorChanged(i,s)}},getSelection:function(){return this._selections},getSelectionIds:function(){var e=[];for(var t=0;t<this._selections.length;t++){e.push(this.model.getId(this._selections[t]))}return e},getRowDiv:function(t){var n=t?t:this._modelIterator.cursor();if(!n){return null}var r=this.model.getId(n);var i=this._navDict.getValue(r);return i&&i.rowDomNode?i.rowDomNode:e.node(r)},iterate:function(e,t,n,r){var i=null;if(!this.topIterationNodes||this.topIterationNodes.length===0){return}if(r){var s=this.currentModel();i=this._modelIterator.iterate(e,t);if(i){this._setCursorOnItem(e,n)}while(i&&i.isNotSelectable){i=this._modelIterator.iterate(e,t);if(i){this._setCursorOnItem(e,n)}}if(!i){this.cursorOn(s,true,false,true);this._setCursorOnItem(e,n)}}else{i=this._modelIterator.iterate(e,t);if(i){this._setCursorOnItem(e,n)}}},_setCursorOnItem:function(e,t){this.cursorOn(null,false,e);if(t){var n=this._inSelection(this._modelIterator.prevCursor());var r=this._inSelection(this._modelIterator.cursor());if(n>=0&&r>=0){this.setSelection(this._modelIterator.prevCursor(),true)}else{this.setSelection(this.currentModel(),true)}}},_checkRow:function(t,n){if(this.explorer.renderer._useCheckboxSelection){var r=this.getRowDiv(t);if(!r){return}var i=e.node(this.explorer.renderer.getCheckBoxId(r.id));var s=n?!i.checked:true;if(s!==i.checked){this.explorer.renderer.onCheck(r,i,s,true)}}else{this._select(t,n)}},_select:function(e,t){if(!e){e=this._modelIterator.cursor()}var n=this.getRowDiv(e);if(n){if(this._inSelection(e)<0){n.classList.add("checkedRow")}else{n.classList.remove("checkedRow")}}},_onModelGrid:function(e,t){var n=this._getGridChildren(e);if(n){for(var r=0;r<n.length;r++){if(t.target===n[r].domNode){return true}}}return false},onClick:function(t,n){if(this.isDisabled(this.getRowDiv(t))){e.stop(n)}else{var r=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));if(n.target===r){return}if(this.gridClickSelectionPolicy==="none"&&this._onModelGrid(t,n)){return}this.cursorOn(t,true,false,true);if(s){this.setSelection(t,true)}else if(this._ctrlKeyOn(n)){this.setSelection(t,true,true)}else if(n.shiftKey&&this._shiftSelectionAnchor){var i=this._modelIterator.scan(this._shiftSelectionAnchor,t);if(i){this._clearSelection(true);for(var o=0;o<i.length;o++){this.setSelection(i[o],true)}}}else{this.setSelection(t,false,true)}}},onCollapse:function(e){if(this._modelIterator.collapse(e)){this.cursorOn()}},onUpArrow:function(e){this.iterate(false,false,e.shiftKey,true);if(!this._ctrlKeyOn(e)&&!e.shiftKey){this.setSelection(this.currentModel(),false,true)}e.preventDefault();return false},onDownArrow:function(e){this.iterate(true,false,e.shiftKey,true);if(!this._ctrlKeyOn(e)&&!e.shiftKey){this.setSelection(this.currentModel(),false,true)}e.preventDefault();return false},_shouldMoveColumn:function(e){var t=this.currentModel();var n=this._getGridChildren(t);if(n&&n.length>1){if(this.isExpandable(t)){return this._ctrlKeyOn(e)}return true}else{return false}},onLeftArrow:function(e){if(this._shouldMoveColumn(e)){this.moveColumn(null,-1);e.preventDefault();return true}var t=this._modelIterator.cursor();if(!t){return false}if(this.isExpandable(t)){if(this.isExpanded(t)){this.explorer.myTree.collapse(t);e.preventDefault();return true}}if(!this._modelIterator.topLevel(t)){this.cursorOn(t.parent);this.setSelection(t.parent,false,true)}else if(this.explorer.scopeUp&&typeof this.explorer.scopeUp==="function"){this.explorer.scopeUp()}},onRightArrow:function(e){if(this._shouldMoveColumn(e)){this.moveColumn(null,1);e.preventDefault();return true}var t=this._modelIterator.cursor();if(!t){return false}if(this.isExpandable(t)){if(!this.isExpanded(t)){this.explorer.myTree.expand(t);if(this.explorer.postUserExpand){this.explorer.postUserExpand(this.model.getId(t))}e.preventDefault();return false}}},_isRowSelectable:function(e){return this.explorer.isRowSelectable?this.explorer.isRowSelectable(e):true},onSpace:function(e){this.setSelection(this.currentModel(),true,true);e.preventDefault()},onEnter:function(e){var t=this.getCurrentGrid(this._modelIterator.cursor());if(t){if(t.widget){if(typeof t.onClick==="function"){t.onClick()}else if(typeof t.widget.focus==="function"){t.widget.focus()}}else{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",true,true,window,0,0,0,0,0,this._ctrlKeyOn(e),false,false,false,0,null);t.domNode.dispatchEvent(n)}return}var r=this._modelIterator.cursor();if(!r){return}if(this.explorer.renderer.getRowActionElement){var i=this.explorer.renderer.getRowActionElement(this.model.getId(r));if(i.href){if(this._ctrlKeyOn(e)){window.open(i.href)}else{window.location.href=i.href}}}if(this.explorer.renderer.performRowAction){this.explorer.renderer.performRowAction(e,r);e.preventDefault();return false}},setIsNotSelectable:function(e,t){e.isNotSelectable=t},disableItem:function(e){var t=this.getRowDiv(e);if(this.isExpandable(e)&&this.isExpanded(e)){this._modelIterator.collapse(e);this.explorer.myTree.toggle(t.id)}t.classList.remove("checkedRow");t.classList.add("disabledNavRow");this.setIsNotSelectable(e,true)},isDisabled:function(e){return e.classList.contains("disabledNavRow")},enableItem:function(e){var t=this.getRowDiv(e);if(t){t.classList.remove("disabledNavRow");this.setIsNotSelectable(e,false)}}};return r}();r.ExplorerNavDict=function(){function e(e){this._dict={};this._model=e}e.prototype={addRow:function(e,t){var n=this._model.getId(e);this._dict[n]={model:e,rowDomNode:t}},getValue:function(e){return this._dict[e]},getGridNavHolder:function(e,t){if(!e){return null}var n=this._model.getId(e);if(this._dict[n]){if(!this._dict[n].gridChildren&&t){this._dict[n].gridChildren=[]}return this._dict[n].gridChildren}return null},initGridNavHolder:function(e){if(!e){return null}var t=this._model.getId(e);if(this._dict[t]){this._dict[t].gridChildren=null}}};return e}();return r});define("orion/webui/dropdown",["require","orion/webui/littlelib","orion/EventTarget"],function(e,t,n){function r(e){n.attach(this);this._init(e)}r.prototype={_init:function(e){this._dropdownNode=t.node(e.dropdown);if(!this._dropdownNode){throw"no dom node for dropdown found"}this._populate=e.populate;this._selectionClass=e.selectionClass;this._parentDropdown=e.parentDropdown;if(!this._parentDropdown){var n=this._dropdownNode.parentNode;while(n&&document!==n){if(n.classList&&n.classList.contains("dropdownMenu")){this._parentDropdown=n.dropdown;break}n=n.parentNode}}if(e.triggerNode){this._triggerNode=e.triggerNode}else{this._triggerNode=t.$(".dropdownTrigger",this._dropdownNode.parentNode)}if(!this._triggerNode){throw"no dom node for dropdown trigger found"}if(!e.skipTriggerEventListeners){var r=this;this._triggerNode.addEventListener("click",function(e){if(r.toggle(e)){t.stop(e)}},false);if(this._triggerNode.tagName.toLowerCase()==="span"){this._triggerNode.addEventListener("keydown",function(e){if(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE){r.toggle();t.stop(e)}},false)}}this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),false)},toggle:function(e){if(this.isVisible()){return this.close()}else{return this.open(e)}},isVisible:function(){return this._isVisible},open:function(e){var n=false;if(!this.isVisible()){this.dispatchEvent({type:"triggered",dropdown:this,event:e});t.setFramesEnabled(false);if(this._populate){this.empty();this._populate(this._dropdownNode)}var r=this.getItems();if(r.length>0){if(!this._hookedAutoDismiss){if(this._boundAutoDismiss){t.removeAutoDismiss(this._boundAutoDismiss)}else{this._boundAutoDismiss=this._autoDismiss.bind(this)}var i=t.$$array(".dropdownSubMenu",this._dropdownNode);t.addAutoDismiss([this._triggerNode].concat(i),this._boundAutoDismiss);this._hookedAutoDismiss=true}this._triggerNode.classList.add("dropdownTriggerOpen");if(this._selectionClass){this._triggerNode.classList.add(this._selectionClass)}this._dropdownNode.classList.add("dropdownMenuOpen");this._isVisible=true;this._positionDropdown(e);r[0].focus();n=true;if(this._parentDropdown){this._parentDropdown.submenuOpen(this)}}}return n},_autoDismiss:function(e){if(this.close(false)){if(this._dropdownNode.contains(e.target)){var t=this._parentDropdown;while(t){t.close(false);t=t._parentDropdown}}}},_positionDropdown:function(e){this._dropdownNode.style.left="";this._dropdownNode.style.top="";var n=t.bounds(this._dropdownNode);var r=t.bounds(document.body);if(n.left+n.width>r.left+r.width){if(this._triggerNode.classList.contains("dropdownMenuItem")){this._dropdownNode.style.left=-n.width+"px"}else{var i=t.bounds(this._boundingNode(this._triggerNode));var s=t.bounds(this._triggerNode);this._dropdownNode.style.left=s.left-i.left-n.width+s.width+"px"}}var o=n.top+n.height-(r.top+r.height);if(0<o){this._dropdownNode.style.top=Math.floor(this._dropdownNode.style.top-o)+"px"}},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(t===null){return e}var n=t.getPropertyValue("position");if(n==="absolute"||!e.parentNode||e===document.body){return e}return this._boundingNode(e.parentNode)},close:function(e){var n=false;if(this.isVisible()){this._triggerNode.classList.remove("dropdownTriggerOpen");if(this._selectionClass){this._triggerNode.classList.remove(this._selectionClass)}this._dropdownNode.classList.remove("dropdownMenuOpen");t.setFramesEnabled(true);if(e){this._triggerNode.focus()}this._isVisible=false;n=true}return n},getItems:function(){var e=t.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,true);var n=[];var r=this;e.forEach(function(e){if(e.parentNode.parentNode===r._dropdownNode){n.push(e)}});n.forEach(function(e){if(!e._hasDropdownMouseover){e.addEventListener("mouseover",function(n){if(e.dropdown){e.dropdown.open(n)}else{r._closeSelectedSubmenu();t.stop(n)}});e._hasDropdownMouseover=true}});return n},empty:function(){var e=t.$$array("li",this._dropdownNode);var n=this;e.forEach(function(e){if(e.parentNode===n._dropdownNode){e.parentNode.removeChild(e)}});this._hookedAutoDismiss=false},_dropdownKeyDown:function(e){if(e.keyCode===t.KEY.UP||e.keyCode===t.KEY.DOWN||e.keyCode===t.KEY.RIGHT||e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.LEFT){var n=this.getItems();var r=document.activeElement;if(n.length&&n.length>0&&r){var i=n.indexOf(r);if(i<0){i=n.indexOf(r.parentNode)}if(i>=0){if(e.keyCode===t.KEY.UP&&i>0){i--;n[i].focus()}else if(e.keyCode===t.KEY.DOWN&&i<n.length-1){i++;n[i].focus()}else if(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.RIGHT){if(r.classList.contains("dropdownTrigger")&&r.dropdown){r.dropdown.open()}}else if(e.keyCode===t.KEY.LEFT&&r.parentNode.parentNode.classList.contains("dropdownMenuOpen")){this.close(true)}t.stop(e)}}}else if(e.keyCode===t.KEY.ESCAPE){this.close(true);t.stop(e)}},submenuOpen:function(e){if(e!==this._selectedSubmenu){this._closeSelectedSubmenu();this._selectedSubmenu=e}},_closeSelectedSubmenu:function(){var e=this._selectedSubmenu;while(e){e.close();e=e._selectedSubmenu}},destroy:function(){this.empty();if(this._boundAutoDismiss){t.removeAutoDismiss(this._boundAutoDismiss)}}};r.prototype.constructor=r;return{Dropdown:r}});define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!=="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);if(t){e=t[1]}}else{e=""}return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else if(typeof ActiveXObject!=="undefined"){for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}}return e},parseName:function(e){var t,n,r,i=false,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;if(s!==-1&&(!o||s>1)){t=e.substring(0,s);n=e.substring(s+1,e.length)}else{t=e}r=n||t;s=r.indexOf("!");if(s!==-1){i=r.substring(s+1)==="strip";r=r.substring(0,s);if(n){n=r}else{t=r}}return{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);if(!a){return true}s=a[2];o=a[3];o=o.split(":");u=o[1];o=o[0];return(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)},finishLoad:function(e,n,r,i){r=n?t.strip(r):r;if(c.isBuild){l[e]=r}i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;if(!o||p(h,u,a,f)){t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){if(r.error){r.error(e)}})}else{n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})}},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)};t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!=="undefined"&&process.versions&&!!process.versions.node){n=require.nodeRequire("fs");t.get=function(e,t){var r=n.readFileSync(e,"utf8");if(r.indexOf("﻿")===0){r=r.substring(1)}t(r)}}else if(c.env==="xhr"||!c.env&&t.createXhr()){t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,true);if(i){for(o in i){if(i.hasOwnProperty(o)){s.setRequestHeader(o.toLowerCase(),i[o])}}}if(c.onXhr){c.onXhr(s,e)}s.onreadystatechange=function(t){var i,o;if(s.readyState===4){i=s.status;if(i>399&&i<600){o=new Error(e+" HTTP status: "+i);o.xhr=s;r(o)}else{n(s.responseText)}}};s.send(null)}}else if(c.env==="rhino"||!c.env&&typeof Packages!=="undefined"&&typeof java!=="undefined"){t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer;r=u.readLine();if(r&&r.length()&&r.charAt(0)===65279){r=r.substring(1)}n.append(r);while((r=u.readLine())!==null){n.append(o);n.append(r)}a=String(n.toString())}finally{u.close()}t(a)}}return t});define("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'<button class="dropdownTrigger">${ButtonText}<span class="dropdownArrowDown core-sprite-openarrow"></span></button><ul class="dropdownMenu"></ul>'});define("text!orion/webui/submenutriggerbutton.html",[],function(){return'<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0">${ButtonText}<span class="dropdownArrowRight core-sprite-closedarrow"></span></span><ul class="dropdownMenu"></ul></li>'});define("text!orion/webui/checkedmenuitem.html",[],function(){return'<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>'});define("orion/webui/tooltip",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}n.prototype={_init:function(e){this._node=t.node(e.node);if(!this._node){throw"no dom node for tooltip found"}this._position=e.position||["right","above","below","left"];this._text=e.text;this._hideDelay=e.hideDelay===undefined?200:e.hideDelay;this._tailSize=e.tailSize||10;this._trigger=e.trigger||"mouseover";this._afterShowing=e.afterShowing;this._afterHiding=e.afterHiding;var n=this;if(this._trigger==="click"){this._showDelay=0;this._node.addEventListener("click",this._clickHandler=function(e){if(e.target===n._node){n.show();t.stop(e)}},false)}else if(this._trigger==="mouseover"){this._showDelay=e.showDelay===undefined?500:e.showDelay;var r=["mouseout","click"];this._node.addEventListener("mouseover",this._mouseoverHandler=function(e){if(t.contains(n._node,e.target)){n.show();t.stop(e)}},false);this._leaveHandler=function(e){if(t.contains(n._node,e.target)){n.hide()}};for(var i=0;i<r.length;i++){this._node.addEventListener(r[i],this._leaveHandler,false)}}},_makeTipNode:function(){if(!this._tip){this._tip=document.createElement("span");this._tip.classList.add("tooltipContainer");this._tipInner=document.createElement("div");this._tipInner.classList.add("tooltip");if(this._text){this._tipTextContent=document.createElement("div");this._tipTextContent.classList.add("textContent");this._tipInner.appendChild(this._tipTextContent);var e=document.createTextNode(this._text);this._tipTextContent.appendChild(e)}this._tip.appendChild(this._tipInner);document.body.appendChild(this._tip);var n=this;t.addAutoDismiss([this._tip,this._node],function(){n.hide()});if(this._trigger==="mouseover"){this._tipInner.role="tooltip";this._tipInner.id="tooltip"+(new Date).getTime().toString();this._node.setAttribute("aria-describedby",this._tipInner.id);this._tip.addEventListener("mouseover",function(e){if(n._timeout){window.clearTimeout(n._timeout);n._timeout=null}n._tip.addEventListener("mouseout",function(e){if(t.contains(n._tip,e.target)){n.hide();t.stop(e)}},false)},false)}}return this._tip},_positionTip:function(e,n){this._makeTipNode();if(e==="left"){this._tipInner.classList.add("left")}else{this._tipInner.classList.remove("left")}var r=this._node;var i;for(i=t.bounds(r);r&&!i.width&&!i.height;r=r.parentNode){i=t.bounds(r)}var s=t.bounds(this._tipInner);var o,u;switch(e){case"above":o=i.top-s.height-this._tailSize-1;u=i.left-this._tailSize;break;case"below":o=i.top+i.height+this._tailSize+1;u=i.left-this._tailSize;break;case"left":o=i.top-this._tailSize/2;u=i.left-s.width-this._tailSize-1;break;default:o=i.top-this._tailSize/2;u=i.left+i.width+this._tailSize+1;break}var a=t.bounds(document.documentElement);if(o+s.height>a.height){if(n){o=a.height-s.height-1}else{return false}}if(u+s.width>a.width){if(n){u=a.width-s.width-1}else{return false}}if(u<0){if(n){u=4}else{return false}}if(o<0){if(n){o=4}else{return false}}if(this._tail&&this._tail.previousPosition!==e){this._tip.removeChild(this._tail);this._tail=null}if(!this._tail){this._tail=document.createElement("span");this._tail.classList.add("tooltipTailFrom"+e);if(e==="above"||e==="left"){this._tip.appendChild(this._tail)}else{this._tip.insertBefore(this._tail,this._tipInner)}if(e==="left"){this._tail.style.left=s.width+"px"}this._tail.previousPosition=e}this._tip.style.top=o+"px";this._tip.style.left=u+"px";return true},contentContainer:function(){this._makeTipNode();return this._tipInner},show:function(){if(this._tip&&this._tip.classList.contains("tooltipShowing")){return}if(this._timeout){window.clearTimeout(this._timeout);this._timeout=null}if(this._showDelay){this._timeout=window.setTimeout(this._showImmediately.bind(this),this._showDelay)}else{this._showImmediately()}},_showImmediately:function(){var e=false;var t=0;while(!e&&t<this._position.length){e=this._positionTip(this._position[t]);t++}if(!e){this._positionTip(this._position[0],true)}this._tip.classList.add("tooltipShowing");if(this._afterShowing){this._afterShowing()}},hide:function(e){if(this._timeout){window.clearTimeout(this._timeout);this._timeout=null}if(!this._tip||!this._tip.classList.contains("tooltipShowing")){return}if(e===undefined){e=this._hideDelay}var t=this;this._timeout=window.setTimeout(function(){t._tip.classList.remove("tooltipShowing");t._tip.removeAttribute("style");if(t._afterHiding){t._afterHiding()}},e)},destroy:function(){if(this._timeout){window.clearTimeout(this._timeout);this._timeout=null}if(this._tip){document.body.removeChild(this._tip);this._tip=null;this._tipInner=null;this._tipTextContent=null;this._tail=null}if(this._node){this._node.removeEventListener("click",this._clickHandler,false);this._node.removeEventListener("mouseover",this._mouseoverHandler,false);var e=["mouseout","click"];for(var t=0;t<e.length;t++){this._node.removeEventListener(e[t],this._leaveHandler,false)}}}};n.prototype.constructor=n;return{Tooltip:n}});define("orion/commands",["require","orion/util","orion/webui/littlelib","orion/webui/dropdown","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/submenutriggerbutton.html","text!orion/webui/checkedmenuitem.html","orion/webui/tooltip"],function(e,t,n,r,i,s,o,u){function l(e){a=e}function c(e){var t=e.invocation;if(t){var n=e.command;if(n.hrefCallback){var r=n.hrefCallback.call(t.handler||window,t);if(r.then){r.then(function(e){window.open(e)})}else{window.open(r)}return true}else if(t.commandRegistry){t.commandRegistry._invoke(t);return true}else if(n.onClick||n.callback){window.setTimeout(function(){(n.onClick||n.callback).call(t.handler||window,t)},0);return true}}return false}function h(e,t){for(var r in t){if(t[r]&&t[r].keyBinding&&t[r].command){if(t[r].keyBinding.match(e)){var i=t[r];var s=i.keyBinding;if(!s.domScope||n.contains(n.node(s.domScope),e.target)){if(c(i)){n.stop(e);return}}}}}}function p(){var e={};if(a){var t,n,r;n=Object.keys(f);for(t=0;t<n.length;t++){r=n[t];e[r]=f[r]}var i=a();n=Object.keys(i);for(t=0;t<n.length;t++){r=n[t];e[r]=i[r]}}else{e=f}return e}function d(e){h(e,p())}function v(e,n){function r(e){if(t.isMac){if(e.metaKey&&!e.altKey){if(!e.shiftKey&&!e.ctrlKey&&(e.keyCode===65||e.keyCode===67||e.keyCode===86||e.keyCode===88||e.keyCode===90)){return true}return false}if(e.ctrlKey){return false}}else{if(e.ctrlKey&&!e.altKey){if(!e.shiftKey&&(e.keyCode===65||e.keyCode===67||e.keyCode===86||e.keyCode===88||e.keyCode===90)){return true}return false}if(e.altKey&&!e.ctrlKey){return false}}if(e["char"]){return e["char"].length>0}else if(e.charCode||e.keyCode){var n=e.charCode||e.keyCode;switch(n){case 8:case 9:case 13:case 46:return true;default:return n>=32&&n<112||n>123}}return false}e=e||window.event;if(r(e)){if(e.target.contentEditable==="true"){return}var i=e.target.nodeName.toLowerCase();if(i==="input"){var s=e.target.type.toLowerCase();switch(s){case"text":case"password":case"search":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"range":case"tel":case"time":case"url":case"week":return}}else if(i==="textarea"){return}}if(n){n(e)}else{d(e)}}function m(){this._init()}function g(e,t,n){t.classList.add("commandImage");var r;if(e.imageClass){if(e.addImageClassToElement){t.classList.add(e.imageClass)}else{r=document.createElement("span");t.appendChild(r);r.classList.add(e.spriteClass);r.classList.add(e.imageClass)}}else{r=new Image;r.alt=e.name;r.name=n;r.id=n;r.src=e.image;t.appendChild(r)}return r}function y(e,t,s,o,u,a,f){e=n.node(e);if(!e){throw"no parent node was specified"}var l=document.createRange();l.selectNode(e);var c=l.createContextualFragment(i);n.processTextNodes(c,{ButtonText:t});e.appendChild(c);var h=e.lastChild;var p=h.previousSibling;if(o){p.classList.add(o)}else{p.classList.add("orionButton");p.classList.add("commandButton")}if(u){if(!a){p.textContent="";p.setAttribute("aria-label",t)}g({spriteClass:"commandSprite",imageClass:u},p,t);p.classList.add("orionButton")}p.dropdown=new r.Dropdown({dropdown:h,populate:s,selectionClass:f});h.dropdown=p.dropdown;return{menuButton:p,menu:h,dropdown:p.dropdown}}function b(e,t,r,i){e=n.node(e);if(!e){throw"no parent node was specified"}var s=document.createRange();s.selectNode(e);var u=s.createContextualFragment(o);n.processTextNodes(u,{ItemText:t});e.appendChild(u);var a=e.lastChild;var f=n.$(".checkedMenuItem",a);f.checked=r;f.addEventListener("change",i,false);return f}function w(e,t,n,r,i,s,o){var a;s=s||!t.name&&t.hasImage();if(t.hrefCallback){a=document.createElement("a");a.id=r;if(s&&t.hasImage()){g(t,a,r)}else{a.className="commandLink";a.appendChild(document.createTextNode(t.name))}var l=t.hrefCallback.call(n.handler,n);if(l.then){l.then(function(e){a.href=e})}else if(l){a.href=l}else{a.href="#"}}else{a=document.createElement("button");a.className="orionButton";if(s){if(t.hasImage()){g(t,a,r);if(t.name){a.setAttribute("aria-label",t.name)}}else{a.classList.add("commandButton");a.classList.add("commandMissingImageButton");a.appendChild(document.createTextNode(t.name))}}else{a.classList.add("commandButton");var c=document.createTextNode(t.name);a.appendChild(c)}var h=o||t.callback;if(h){t.onClick=h;a.addEventListener("click",function(e){h.call(n.handler,n)},false)}}if(e.nodeName.toLowerCase()==="ul"){var p=document.createElement("li");e.appendChild(p);e=p}else{a.classList.add("commandMargins")}e.appendChild(a);if(t.tooltip){a.commandTooltip=new u.Tooltip({node:a,text:t.tooltip,position:["above","below","right","left"]})}if(i){f[t.id]={keyBinding:i,command:t,invocation:n}}return a}function E(e,t,r,i,s){var o;var u=e.dropdown;if(t.hrefCallback){o=document.createElement("a");o.appendChild(document.createTextNode(t.name));var a=t.hrefCallback.call(r.handler,r);if(a.then){a.then(function(e){o.href=e})}else if(a){o.href=a}else{o.href="#"}o.addEventListener("keydown",function(e){if(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE){o.click()}},false)}else{o=document.createElement("span");o.tabIndex=0;o.appendChild(document.createTextNode(t.name));var l=s||t.callback;if(l){t.onClick=l;o.addEventListener("click",function(e){u.close(true);l.call(r.handler,r)},false);o.addEventListener("keydown",function(e){if(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE){e.preventDefault();o.click()}},false)}}o.className="dropdownMenuItem";o.role="menuitem";var c=document.createElement("li");e.appendChild(c);c.appendChild(o);if(i){f[t.id]={keyBinding:i,command:t,invocation:r}}return o}function S(e,t,n,r,i){this.commandRegistry=i;this.handler=e;this.items=t;this.userData=n;this.command=r;if(r.parameters){this.parameters=r.parameters.makeCopy()}this.id=r.id}function x(e){this._init(e)}var a=null;var f={};m.prototype={setProxy:function(e){this.proxy=e},setKeyBindings:function(e){this.bindings=e},_init:function(){var e=this;document.addEventListener("keydown",function(t){return v(t,function(t){var r=e.proxy;var i=e.bindings;if(!i||!r){return}for(var s=0;s<i.length;s++){if(i[s].match(t)){r.processKey({type:t.type,keyCode:t.keyCode,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey});n.stop(t)}}})})}};window.document.addEventListener("keydown",v,false);S.prototype={collectsParameters:function(){return this.commandRegistry&&this.commandRegistry.collectsParameters()},makeCopy:function(e){var t=new S(this.handler,this.items,this.userData,this.command,this.commandRegistry);t.domNode=this.domNode;t.domParent=this.domParent;if(e){t.parameters=e.makeCopy()}else if(this.parameters){t.parameters=this.parameters.makeCopy()}return t}};S.prototype.constructor=S;x.prototype={_init:function(t){this.id=t.id;this.name=t.name;this.tooltip=t.tooltip;this.callback=t.callback;this.hrefCallback=t.hrefCallback;this.choiceCallback=t.choiceCallback;this.image=t.image||e.toUrl("images/none.png");this.imageClass=t.imageClass;this.addImageClassToElement=t.addImageClassToElement;this.selectionClass=t.selectionClass;this.spriteClass=t.spriteClass||"commandSprite";this.visibleWhen=t.visibleWhen;this.parameters=t.parameters;this.isEditor=t.isEditor},populateChoicesMenu:function(e,t,r,i,s){var o=this.getChoices(t,r,i);o.forEach(function(r){if(r.name){var i=document.createElement("li");e.appendChild(i);var o=document.createElement("span");o.tabIndex=0;o.role="menuitem";o.classList.add("dropdownMenuItem");var u=document.createTextNode(r.name);o.appendChild(u);i.appendChild(o);o.choice=r;o.addEventListener("click",function(e){if(e.target.choice){e.target.choice.callback.call(e.target.choice,t)}},false);o.addEventListener("keydown",function(e){if(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE){if(e.target.choice){e.target.choice.callback.call(e.target.choice,t)}}},false)}else{s._generateMenuSeparator(e)}})},getChoices:function(e,t,n){if(this.choiceCallback){return this.choiceCallback.call(t,e,n)}return null},makeChoiceCallback:function(e,t){return function(n){if(e.callback){e.callback.call(e,t,n)}}},hasImage:function(){return this.imageClass||this.image!==e.toUrl("images/none.png")}};x.prototype.constructor=x;return{Command:x,CommandInvocation:S,createDropdownMenu:y,createCheckedMenuItem:b,createCommandItem:w,createCommandMenuItem:E,executeBinding:c,setKeyBindingProvider:l,localKeyBindings:f,CommandsProxy:m,getKeyBindings:p,processKey:d,_testMethodProcessKey:h}});define("orion/explorers/explorer",["i18n!orion/nls/messages","require","orion/webui/littlelib","orion/webui/treetable","orion/explorers/explorerNavHandler","orion/commands"],function(e,t,n,r,i,s){var o={};o.Explorer=function(){function e(e,t,n,r){this.registry=e;this.renderer=n;this.selection=t;this.commandService=r;if(this.renderer){this.renderer.explorer=this}this.myTree=null}e.prototype={destroy:function(){if(this._navHandler){this._navHandler.destroy()}if(this.model){this.model.destroy()}if(this.myTree){this.myTree.destroy()}this.destroyed=true},changedItem:function(e,t){if(this.myTree){this.myTree.refresh.bind(this.myTree)(e,t,true)}},updateCommands:function(e){if(this.myTree){this.myTree._renderer.updateCommands.bind(this.myTree._renderer)(e)}},makeNewItemPlaceHolder:function(e,t,r){var i=this.getRow(e);var s;if(r){i=i.childNodes[r];i.appendChild(document.createElement("br"));var o=document.createElement("span");o.id=t+"placeHolderRow";i.appendChild(o);return{tempNode:o,refNode:o}}if(i){var u=document.createElement("tr");u.id=t+"placeHolderRow";var a=document.createElement("td");a.id=t+"placeHolderCol";u.appendChild(a);i.appendChild(u);s=n.node(t+"placeHolderRow");i=n.node(t+"placeHolderCol");if(s&&i){return{tempNode:s,refNode:i}}}return null},getRow:function(e){var t=this.model.getId(e);if(t){return n.node(t)}},collapseAll:function(){var e=this._navHandler.getTopLevelNodes();for(var t=0;t<e.length;t++){this.myTree.collapse(e[t])}},expandAll:function(e){if(e){this._expandRecursively(e)}else{if(!this._navHandler){return}var t=this._navHandler.getTopLevelNodes();for(var n=0;n<t.length;n++){this._expandRecursively(t[n])}}},_expandRecursively:function(e){if(!this._navHandler||!this._navHandler.isExpandable(e)){return}var t=this;this.myTree.expand(e,function(){t.model.getChildren(e,function(e){if(e===undefined||e===null){return}var n=e.length;for(var r=0;r<n;r++){t._expandRecursively(e[r])}})})},createTree:function(e,t,s){e=typeof e==="string"?e:e.id||e;if(this.selection){this.selection.setSelections([])}if(this.getNavHandler()){this.getNavHandler()._clearSelection()}var o=e+"innerTree";var u=n.node(o);if(u){n.empty(u)}if(t){t.rootId=o}this.model=t;this._parentId=e;this._treeOptions=s;var a=!s||s&&!s.noSelection;if(a){this.selectionPolicy=s?s.selectionPolicy:"";this._navDict=new i.ExplorerNavDict(this.model)}this.myTree=new r.TableTree({id:o,model:t,parent:e,onComplete:s?s.onComplete:undefined,labelColumnIndex:this.renderer.getLabelColumnIndex(),renderer:this.renderer,showRoot:s?!!s.showRoot:false,indent:s?s.indent:undefined,onCollapse:s?s.onCollapse:undefined,navHandlerFactory:s?s.navHandlerFactory:undefined,tableElement:s?s.tableElement:undefined,tableBodyElement:s?s.tableBodyElement:undefined,tableRowElement:s?s.tableRowElement:undefined});this.renderer._initializeUIState();if(this.selectionPolicy==="cursorOnly"){this.initNavHandler()}},getNavHandler:function(){return this._navHandler},getNavDict:function(){return this._navDict},refreshSelection:function(){if(this.selection){var e=this.getNavHandler();var t=[];if(e&&this.getNavDict()){var n=e.getSelection();for(var r=0;r<n.length;r++){var i=e.getRowDiv(n[r]);if(i&&i.parentNode){var s=this.getNavDict().getValue(this.model.getId(n[r]));if(s.model){t.push(s.model)}}}}this.selection.setSelections(t)}},getRootPath:function(){if(this.model&&this.model.root){return this.model.root.Location}return null},initNavHandler:function(){var e=this._treeOptions;var t=!e||e&&!e.noSelection;if(!t){return}if(!this.getNavHandler()){if(e&&e.navHandlerFactory&&typeof e.navHandlerFactory.createNavHandler==="function"){this._navHandler=e.navHandlerFactory.createNavHandler(this,this._navDict,e)}else{var n=e?e.getChildrenFunc:null;this._navHandler=new i.ExplorerNavHandler(this,this._navDict,{getChildrenFunc:n,setFocus:e&&e.setFocus,selectionPolicy:e?e.selectionPolicy:null})}}var r=this;this.model.getRoot(function(t){if(t instanceof Array){r.getNavHandler().refreshModel(r.getNavDict(),r.model,t)}else if(t.children&&t.children instanceof Array){r.getNavHandler().refreshModel(r.getNavDict(),r.model,t.children)}if(e&&e.setFocus){r.getNavHandler().cursorOn(null,false,false,true)}})},_lastHash:null,checkbox:false};return e}();o.createExplorerCommands=function(t,n){function r(e){if(typeof e.getItemCount==="function"){if(e.getItemCount()>0){return n?n(e):true}return false}return false}var i=new s.Command({tooltip:e["Expand all"],imageClass:"core-sprite-expandAll",id:"orion.explorer.expandAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return r(e)},callback:function(e){e.items.expandAll()}});var o=new s.Command({tooltip:e["Collapse all"],imageClass:"core-sprite-collapseAll",id:"orion.explorer.collapseAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return r(e)},callback:function(e){e.items.collapseAll()}});t.addCommand(i);t.addCommand(o)};o.ExplorerModel=function(){function e(e,t,n){this.rootPath=e;this.fetchItems=t;this.idPrefix=n||""}e.prototype={destroy:function(){this.destroyed=true},getRoot:function(e){var t=this;this.fetchItems(this.rootPath).then(function(n){t.root=n;e(n)})},getChildren:function(e,t){if(e.Children){t(e.Children)}else if(e.ChildrenLocation){this.fetchItems(e.ChildrenLocation).then(function(n){e.Children=n;t(n)})}else{t([])}},getId:function(e){if(e.Location===this.root.Location){return this.rootId}var t=e.Location.replace(/[\\\/]/g,"");var n=this.idPrefix;for(var r=0;r<t.length;r++){if(t[r].match(/[^\.\:\-\_0-9A-Za-z]/g)){n+=t.charCodeAt(r)}else{n+=t[r]}}return n}};return e}();o.ExplorerFlatModel=function(){function e(e,t,n){this.rootPath=e;this.fetchItems=t;this.root=n}e.prototype=new o.ExplorerModel;e.prototype.getRoot=function(e){if(this.root){e(this.root)}else{var t=this;this.fetchItems(this.rootPath).then(function(n){t.root=n;e(n)})}};e.prototype.getChildren=function(e,t){if(e===this.root){t(this.root)}else{t([])}};return e}();o.ExplorerRenderer=function(){function e(e,t){this.explorer=t;this._init(e);this._expandImageClass="core-sprite-openarrow";this._collapseImageClass="core-sprite-closedarrow";this._progressImageClass="core-sprite-progress";this._twistieSpriteClass="modelDecorationSprite"}e.prototype={_init:function(e){if(e){this._useCheckboxSelection=e.checkbox===undefined?false:e.checkbox;this.selectionPolicy=e.singleSelection?"singleSelection":"";this._cachePrefix=e.cachePrefix;this.getCheckedFunc=e.getCheckedFunc;this.onCheckedFunc=e.onCheckedFunc;this._highlightSelection=true;this._treeTableClass=e.treeTableClass||"treetable";if(e.highlightSelection===false){this._highlightSelection=false}if(!this.actionScopeId){this.actionScopeId=e.actionScopeId}if(!this.commandService){this.commandService=e.commandService}}},getLabelColumnIndex:function(){return this.explorer.checkbox?1:0},initTable:function(e,t){this.tableTree=t;n.empty(e);if(this._treeTableClass){e.classList.add(this._treeTableClass)}this.renderTableHeader(e)},getActionsColumn:function(e,t,n,r,i){n=n||"tool";var s=document.createElement("td");s.id=t.id+"actionswrapper";if(r){s.classList.add(r)}if(this.actionScopeId&&this.commandService){this.commandService.renderCommands(this.actionScopeId,s,e,this.explorer,n,null,i&&this.explorer.getNavDict()?this.explorer.getNavDict().getGridNavHolder(e,true):null)}else{window.console.log("Warning, no command service or action scope was specified.  No commands rendered.")}return s},initCheckboxColumn:function(e){if(this._useCheckboxSelection){var t=document.createElement("th");return t}},getCheckboxColumn:function(e,t){if(this._useCheckboxSelection){var n=document.createElement("td");var r=document.createElement("span");r.id=this.getCheckBoxId(t.id);r.classList.add("core-sprite-check");r.classList.add("selectionCheckmarkSprite");r.rowId=t.id;if(this.getCheckedFunc){r.checked=this.getCheckedFunc(e);if(r.checked){if(this._highlightSelection){t.classList.add("checkedRow")}r.classList.add("core-sprite-check_on")}else{if(this._highlightSelection){t.classList.remove("checkedRow")}r.classList.remove("core-sprite-check_on")}}n.appendChild(r);var i=this;r.addEventListener("click",function(e){var n=e.target.checked?false:true;i.onCheck(t,e.target,n,true)},false);return n}},getCheckBoxId:function(e){return e+"selectedState"},onCheck:function(e,t,n,r,i){t.checked=n;if(n){t.classList.add("core-sprite-check_on")}else{t.classList.remove("core-sprite-check_on")}if(this.onCheckedFunc){this.onCheckedFunc(t.rowId,n,r)}if(this.explorer.getNavHandler()&&i){this.explorer.getNavHandler().setSelection(this.explorer.getNavDict().getValue(e.id).model,true)}},storeSelections:function(){if(this.explorer.getNavHandler()){var e=this.explorer.getNavHandler().getSelectionIds();var t=this._getUIStatePreferencePath();if(t&&window.sessionStorage){window.sessionStorage[t+"selection"]=JSON.stringify(e)}}},_restoreSelections:function(e){var t=this.explorer.getNavDict();var r=this.explorer.getNavHandler();if(!r||!t||r.getSelectionPolicy()==="cursorOnly"){return}var i=window.sessionStorage[e+"selection"];if(typeof i==="string"){if(i.length>0){i=JSON.parse(i)}else{i=null}}var s;if(i){var o=[];for(s=0;s<i.length;s++){var u=t.getValue(i[s]);if(u&&u.rowDomNode&&u.model){o.push(u.model);if(this._highlightSelection){u.rowDomNode.classList.add("checkedRow")}var a=n.node(this.getCheckBoxId(u.rowDomNode.id));if(a){a.checked=true;a.classList.add("core-sprite-check_on")}}}if(this.explorer.selection){this.explorer.selection.setSelections(o);if(this.explorer.getNavHandler()){this.explorer.getNavHandler().refreshSelection()}}}},_storeExpansions:function(e){window.sessionStorage[e+"expanded"]=JSON.stringify(this._expanded)},_restoreExpansions:function(e){var t=false;var r=window.sessionStorage[e+"expanded"];if(typeof r==="string"){if(r.length>0){r=JSON.parse(r)}else{r=null}}var i;if(r){for(i=0;i<r.length;i++){var s=n.node(r[i]);if(s){this._expanded.push(r[i]);var o=this;this.tableTree.expand(r[i],function(){o._restoreSelections(e)});t=true}}}return!t},_getUIStatePreferencePath:function(){if(this.explorer){var e=this.explorer.getRootPath();if(this._cachePrefix&&e){var t=e.replace(/[^\.\:\-\_0-9A-Za-z]/g,"");return"/"+this._cachePrefix+"/"+t+"/uiState"}}return null},expandCollapseImageId:function(e){return e+"__expand"},updateExpandVisuals:function(e,t){var r=n.node(this.expandCollapseImageId(e.id));if(r){r.classList.remove(this._expandImageClass);r.classList.remove(this._collapseImageClass);r.classList.remove(this._progressImageClass);r.classList.add(t==="progress"?this._progressImageClass:t?this._expandImageClass:this._collapseImageClass)}},getExpandImage:function(e,t,n,r){var i=document.createElement("span");i.id=this.expandCollapseImageId(e.id);t.appendChild(i);i.classList.add(this._twistieSpriteClass);i.classList.add(this._collapseImageClass);if(n){var s=document.createElement("span");t.appendChild(s);s.classList.add(r||"imageSprite");s.classList.add(n)}var o=this;i.onclick=function(t){if(!o.explorer.getNavHandler().isDisabled(e)){o.tableTree.toggle(e.id);var n=o.tableTree.isExpanded(e.id);if(n){o._expanded.push(e.id);if(o.explorer.postUserExpand){o.explorer.postUserExpand(e.id)}}else{for(var r in o._expanded){if(o._expanded[r]===e.id){o._expanded.splice(r,1);break}}}var i=o._getUIStatePreferencePath();if(i&&window.sessionStorage){o._storeExpansions(i)}}};return i},render:function(e,t){t.classList.add("navRow");this.renderRow(e,t)},rowsChanged:function(){if(this.explorer.selectionPolicy!=="cursorOnly"){this.explorer.refreshSelection();this.explorer.initNavHandler()}},updateCommands:function(){if(this.commandService){var e=n.$$array(".treeTableRow");for(var t=0;t<e.length;t++){var r=e[t];var i=r.id+"actionswrapper";var s=n.node(i);this.commandService.destroy(s);if(this.actionScopeId){this.commandService.renderCommands(this.actionScopeId,s,r._item,this.explorer,"tool")}}}},_initializeUIState:function(){this._expanded=[];var e=this._getUIStatePreferencePath();if(e&&window.sessionStorage){if(this._restoreExpansions(e)){this._restoreSelections(e)}}}};return e}();o.SelectionRenderer=function(){function e(e,t){this._init(e);this.explorer=t}e.prototype=new o.ExplorerRenderer;e.prototype.renderTableHeader=function(e){var t=document.createElement("thead");var n=document.createElement("tr");t.classList.add("navTableHeading");if(this._useCheckboxSelection){n.appendChild(this.initCheckboxColumn(e))}var r=0;var i=this.getCellHeaderElement(r);while(i){if(i.innerHTML.length>0){i.classList.add("navColumn")}n.appendChild(i);i=this.getCellHeaderElement(++r)}t.appendChild(n);if(r>0){e.appendChild(t)}};e.prototype.renderRow=function(e,t){t.verticalAlign="baseline";t.classList.add("treeTableRow");var n=this.explorer.getNavDict();if(n){n.addRow(e,t);var r=this;t.addEventListener("click",function(t){if(r.explorer.getNavHandler()){r.explorer.getNavHandler().onClick(e,t)}},false)}var i=this.getCheckboxColumn(e,t);if(i){i.classList.add("checkColumn");t.appendChild(i)}var s=0;var o=this.getCellElement(s,e,t);while(o){t.appendChild(o);if(s===0){if(this.getPrimColumnStyle){o.classList.add(this.getPrimColumnStyle(e))}else{o.classList.add("navColumn")}}else{if(this.getSecondaryColumnStyle){o.classList.add(this.getSecondaryColumnStyle())}else{o.classList.add("secondaryColumn")}}o=this.getCellElement(++s,e,t)}};e.prototype.getCellHeaderElement=function(e){};e.prototype.getCellElement=function(e,t,n){};return e}();o.SimpleFlatModel=function(){function e(e,t,n){this.items=e;this.getKey=n;this.idPrefix=t;this.root={children:e}}e.prototype=new o.ExplorerModel;e.prototype.getRoot=function(e){e(this.root)};e.prototype.getId=function(e){var t=this.getKey(e);var n=t.replace(/[\\\/]/g,"");var r="";for(var i=0;i<n.length;i++){if(n[i].match(/[^\.\:\-\_0-9A-Za-z]/g)){r+=n.charCodeAt(i)}else{r+=n[i]}}return this.idPrefix+r};e.prototype.getChildren=function(e,t){if(e===this.root){t(this.items)}else{t([])}};return e}();return o});define("orion/explorers/explorer-table",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/webui/littlelib","orion/i18nUtil","orion/fileUtils","orion/explorers/explorer","orion/EventTarget","orion/objects","orion/util"],function(e,t,n,r,i,s,o,u,a){function f(e,t,n,r,i,s){this.registry=e;this.root=t;this.fileClient=n;this.idPrefix=r||"";this.excludeFiles=!!i;this.excludeFolders=!!s}function l(e){o.attach(this);this.registry=e.serviceRegistry;this.treeRoot=e.treeRoot;this.selection=e.selection;this.fileClient=e.fileClient;this.excludeFiles=e.excludeFiles;this.excludeFolders=e.excludeFolders;this.navHandlerFactory=e.navHandlerFactory;this.parentId=e.parentId;this.renderer=e.rendererFactory(this);this.dragAndDrop=e.dragAndDrop;this.setFocus=e.setFocus;this.model=null;this.myTree=null;this.checkbox=false;this._hookedDrag=false;var t=e.modelEventDispatcher?e.modelEventDispatcher:new o;this.modelEventDispatcher=t;var r=this;this._modelListeners={};["copy","copyMultiple","create","delete","deleteMultiple","import","move","moveMultiple"].forEach(function(e){t.addEventListener(e,r._modelListeners[e]=r.modelHandler[e].bind(r))});this._clickListener=function(e){if(e.target.tagName==="A"){var t=e.target;while(t){if(t._item){break}t=t.parentNode}if(t&&t._item){r.onLinkClick({type:"linkClick",item:t._item})}}};var i=n.node(this.parentId);if(i){i.addEventListener("click",this._clickListener)}var s=this.renderer;if(this.registry){this.registry.registerService("orion.cm.managedservice",{updated:function(e){var t;if(e&&e["links.newtab"]!=="undefined"){t=e["links.newtab"]?"_blank":"_self"}else{t="_self"}if(s.setTarget){s.setTarget(t)}}},{pid:"nav.config"})}}f.prototype=new s.ExplorerModel;u.mixin(f.prototype,{getRoot:function(e){e(this.root)},processParent:function(e,t){if(this.excludeFiles||this.excludeFolders){var n=[];for(var r in t){var i=t[r].Directory?this.excludeFolders:this.excludeFiles;if(!i){n.push(t[r]);t[r].parent=e}}t=n}else{for(var s in t){t[s].parent=e}}e.children=t;e.children.sort(function(e,t){var n=e.Directory;var r=t.Directory;if(n!==r){return n?-1:1}var i=e.Name&&e.Name.toLowerCase();var s=t.Name&&t.Name.toLowerCase();if(i<s){return-1}if(i>s){return 1}return 0});return t},getChildren:function(t,n){var r=this;if(t.children){n(t.children)}else if(t.Directory!==undefined&&t.Directory===false){n([])}else if(t.Location){var i=null;if(this.registry){i=this.registry.getService("orion.page.progress")}(i?i.progress(this.fileClient.fetchChildren(t.ChildrenLocation),e["Fetching children of "]+t.Name):this.fileClient.fetchChildren(t.ChildrenLocation)).then(function(e){if(r.destroyed){return}n(r.processParent(t,e))},function(){n([])})}else{n([])}},hasChildren:function(){var e=false;if(this.root.Children){e=this.root.Children.length>0}return e}});f.prototype.constructor=f;var c,h;l.prototype=Object.create(s.Explorer.prototype);u.mixin(l.prototype,{destroy:function(){var e=this;Object.keys(this._modelListeners).forEach(function(t){e.modelEventDispatcher.removeEventListener(t,e._modelListeners[t])});var t=n.node(this.parentId);if(t){t.removeEventListener("click",this._clickListener)}s.Explorer.prototype.destroy.call(this)},onLinkClick:function(e){this.dispatchEvent(e)},onModelCreate:function(e){return this.changedItem(e.parent,true)},onModelCopy:function(e){var n=this,r={};(e.items||[e]).forEach(function(e){var t=e.parent;t=t||n.treeRoot;r[t.Location]=t});return t.all(Object.keys(r).map(function(e){return n.changedItem(r[e],true)}))},onModelMove:function(e){var n=this,r={};(e.items||[e]).forEach(function(e){if(n.treeRoot.Location===e.Location){var i=n.treeRoot;var s=e.newValue;var o=s.ChildrenLocation?s:this.fileClient.read(s.ContentLocation,true);return t.when(o,function(e){n.dispatchEvent({type:"rootMoved",oldValue:i,newValue:e});n.loadResourceList(e)})}var u=e.oldValue.parent;u=u||n.treeRoot;r[u.Location]=u;u=e.parent;u=u||n.treeRoot;r[u.Location]=u;if(e.oldValue.Directory&&e.newValue&&n.isExpanded(e.oldValue)){r[e.newValue.Location]=e.newValue}});return t.all(Object.keys(r).map(function(e){return n.changedItem(r[e],true)}))},onModelDelete:function(e){var n=e.items||[e];var r=this;var i;var s=n.some(function(e){if(e.oldValue.Location===r.treeRoot.Location){i=e.parent;return true}return false});if(s){return this.loadResourceList(i)}else{var o={};n.forEach(function(e){var t=e.parent;o[t.Location]=t});return t.all(Object.keys(o).map(function(e){return r.changedItem(o[e],true)}))}},modelHandler:{copy:function(e){if(e.count){return}return this.onModelCopy(e)},copyMultiple:function(e){return this.onModelCopy(e)},create:function(e){return this.onModelCreate(e)},"delete":function(e){if(e.count){return}return this.onModelDelete(e)},deleteMultiple:function(e){return this.onModelDelete(e)},"import":function(e){var t=e.target;return this.changedItem(t,true)},move:function(e){if(e.count){return}return this.onModelMove(e)},moveMultiple:function(e){return this.onModelMove(e)}},_makeDropTarget:function(t,s,o){function u(n,s,o,a,f,l){s=s||"";if(n.isFile){if(i.isAtRoot(o.Location)){if(a.registry){a.registry.getService("orion.page.message").setProgressResult({Severity:"Error",Message:e["You cannot copy files directly into the workspace.  Create a folder first."]})}}else{n.file(function(t){f(o,t,a,t.name.indexOf(".zip")===t.name.length-4&&window.confirm(r.formatMessage(e["Unzip ${0}?"],t.name)))})}}else if(n.isDirectory){var c=n.createReader();var h=function(e){c.readEntries(function(t){for(var r=0;r<t.length;r++){u(t[r],s+n.name+"/",e,a,f,l)}})};var p=null;if(a.registry){p=a.registry.getService("orion.page.progress")}if(i.isAtRoot(o.Location)){(p?p.progress(l.createProject(o.ChildrenLocation,n.name),r.formatMessage(e["Creating ${0}"],n.name)):l.createProject(o.ChildrenLocation,n.name)).then(function(t){a.loadResourceList(a.treeRoot.Path,true);(p?p.progress(l.read(t.ContentLocation,true),e["Loading "]+t.name):l.read(t.ContentLocation,true)).then(function(e){h(e)})})}else{(p?p.progress(l.createFolder(o.Location,n.name),r.formatMessage(e["Creating ${0}"],n.name)):l.createFolder(o.Location,n.name)).then(function(e){var n=a.modelEventDispatcher;n.dispatchEvent({type:"create",parent:t,newValue:e});h(e)})}}}if(this.dragAndDrop){var f=this;var l=this.dragAndDrop;var p=function(e){c=e.target};if(o){if(this._oldDragStart){s.removeEventListener("dragstart",this._oldDragStart,false)}this._oldDragStart=p}s.addEventListener("dragstart",p,false);var d=function(e){c=null};if(o){if(this._oldDragEnd){s.removeEventListener("dragend",this._oldDragEnd,false)}this._oldDragEnd=d}s.addEventListener("dragend",d,false);var v=function(e){s.classList.remove("dragOver");e.preventDefault();e.stopPropagation()};if(o){if(this._oldDragLeave){s.removeEventListener("dragleave",this._oldDragLeave,false)}this._oldDragLeave=v}s.addEventListener("dragleave",v,false);var m=function(e){if(c){var t=a.isMac?e.altKey:e.ctrlKey;h=e.dataTransfer.dropEffect=t?"copy":"move"}else{if(!a.isIE&&(e.dataTransfer.effectAllowed==="all"||e.dataTransfer.effectAllowed==="uninitialized"||e.dataTransfer.effectAllowed.indexOf("copy")>=0)){e.dataTransfer.dropEffect="copy"}}s.classList.add("dragOver");n.stop(e)};if(o){if(this._oldDragEnter){s.removeEventListener("dragenter",this._oldDragEnter,false)}this._oldDragEnter=m}s.addEventListener("dragenter",m,false);var g=function(e){if(c){var t=a.isMac?e.altKey:e.ctrlKey;h=e.dataTransfer.dropEffect=t?"copy":"move"}else{if(!a.isIE&&(e.dataTransfer.effectAllowed==="all"||e.dataTransfer.effectAllowed==="uninitialized"||e.dataTransfer.effectAllowed.indexOf("copy")>=0)){e.dataTransfer.dropEffect="copy"}}n.stop(e)};if(o&&!this._oldDragOver){s.addEventListener("dragover",g,false);this._oldDragOver=g}var y=function(o){var a;s.classList.remove("dragOver");if(c){var p=f.fileClient;var d=c;var v;while(d){if(d._item){v=d._item;break}d=d.parentNode}if(!v){return}var m=null;if(f.registry){m=f.registry.getService("orion.page.progress")}var g=h==="copy";var y=g?p.copyFile:p.moveFile;(m?m.showWhile(y.apply(p,[v.Location,t.Location]),r.formatMessage(e[g?"Copying ${0}":"Moving ${0}"],v.Location)):y.apply(p,[v.Location,t.Location])).then(function(e){var n=f.modelEventDispatcher;n.dispatchEvent({type:g?"copy":"move",oldValue:v,newValue:e,parent:t})},function(e){if(m){m.setProgressResult(e)}else{window.console.log(e)}})}else if(o.dataTransfer.items&&o.dataTransfer.items.length>0){for(a=0;a<o.dataTransfer.items.length;a++){var b=null;if(typeof o.dataTransfer.items[a].getAsEntry==="function"){b=o.dataTransfer.items[a].getAsEntry()}else if(typeof o.dataTransfer.items[a].webkitGetAsEntry==="function"){b=o.dataTransfer.items[a].webkitGetAsEntry()}if(b){u(b,null,t,f,l,f.fileClient)}}}else if(o.dataTransfer.files&&o.dataTransfer.files.length>0){for(a=0;a<o.dataTransfer.files.length;a++){var w=o.dataTransfer.files[a];if(!w.length&&(!w.type||w.type==="")){if(f.registry){f.registry.getService("orion.page.message").setProgressResult({Severity:"Error",Message:r.formatMessage(e["Did not drop ${0}.  Folder drop is not supported in this browser."],w.name)})}}else if(i.isAtRoot(t.Location)){if(f.registry){f.registry.getService("orion.page.message").setProgressResult({Severity:"Error",Message:e["You cannot copy files directly into the workspace.  Create a folder first."]})}}else{l(t,w,f,w.name.indexOf(".zip")===w.name.length-4&&window.confirm(r.formatMessage(e["Unzip ${0}?"],w.name)))}}}n.stop(o)};if(o){if(this._oldDrop){s.removeEventListener("drop",this._oldDrop,false)}this._oldDrop=y}s.addEventListener("drop",y,false)}},createModel:function(){return new f(this.registry,this.treeRoot,this.fileClient,this.parentId,this.excludeFiles,this.excludeFolders)},changedItem:function(e,n){if(this.treeRoot&&this.treeRoot.Location===e.Location){return this.loadResourceList(this.treeRoot,n)}var r=this;var i=new t;e.children=null;this.model.getChildren(e,function(t){if(r.getNavHandler()){}r.myTree.refresh.bind(r.myTree)(e,t,n);i.resolve(t)});return i},showItem:function(e,n){var r=new t;if(!e||!this.model||!this.myTree||!this.myTree.showRoot&&e.Location===this.treeRoot.Location){return r.reject()}var i=this.getRow(e);if(i){r.resolve(i._item||e)}else if(e.Parents&&e.Parents.length>0){e.Parents[0].Parents=e.Parents.slice(1);return this.expandItem(e.Parents[0],n).then(function(n){var r=this.getRow(e);if(!r){return this.changedItem(n,true).then(function(){var n=this.getRow(e);return n?n._item:(new t).reject()}.bind(this))}return r._item||e}.bind(this))}else{if(n===undefined||n){return this.reroot(e)}return r.reject()}return r},expandItem:function(e,n){var r=new t;this.showItem(e,n).then(function(e){if(this.myTree.isExpanded(e)){r.resolve(e)}else{this.myTree.expand(this.model.getId(e),function(){r.resolve(e)})}}.bind(this),r.reject);return r},reveal:function(e,t){return this.showItem(e,t).then(function(e){var t=this.getNavHandler();if(t){t.cursorOn(e,true);t.setSelection(e)}return e}.bind(this))},reroot:function(e){return(new t).reject()},isExpanded:function(e){var t=this.model.getId(e);return this.renderer.tableTree.isExpanded(t)},getNameNode:function(e){var t=this.model.getId(e);if(t){return n.node(t+"NameLink")}},scopeUp:function(){},scopeDown:function(e){},loadResourceList:function(n,r,s){if(n&&typeof n==="object"){n=n.ChildrenLocation||n.ContentLocation}n=i.makeRelative(n);if(!r&&n===this._lastPath){return(new t).resolve(this.treeRoot)}this._lastPath=n;var o=this;if(r||n!==this.treeRoot.Path){return this.load(this.fileClient.loadWorkspace(n),e["Loading "]+n).then(function(e){o.treeRoot.Path=n;if(typeof s==="function"){s()}o.dispatchEvent({type:"rootChanged",root:o.treeRoot});return(new t).resolve(o.treeRoot)},function(e){o.treeRoot.Path=null;o.dispatchEvent({type:"rootChanged",root:o.treeRoot});return(new t).reject(e)})}return(new t).resolve(o.treeRoot)},load:function(e,r,i){var s=n.node(this.parentId);var o=n.node("progress");if(!o){o=document.createElement("div");o.id="progress";n.empty(s);s.appendChild(o)}n.empty(o);var u=setTimeout(function(){n.empty(o);o.appendChild(document.createTextNode(r))},500);var a=this;return t.when(e,function(e){clearTimeout(u);if(a.destroyed){return}a.treeRoot={};for(var n in e){a.treeRoot[n]=e[n]}a.model=a.createModel();if(a.dragAndDrop){if(a._hookedDrag){a._makeDropTarget(a.treeRoot,s,true)}else{var r=s&&("draggable"in s||"ondragstart"in s&&"ondrop"in s);r=r&&!!(window.File&&window.FileList&&window.FileReader);a._hookedDrag=true;if(r){a._makeDropTarget(a.treeRoot,s,true)}else{a.dragAndDrop=null;window.console.log("Local file drag and drop is not supported in this browser.")}}}var o=new t;a.createTree(a.parentId,a.model,{onComplete:function(e){o.resolve(e)},navHandlerFactory:a.navHandlerFactory,setFocus:typeof a.setFocus==="undefined"?true:a.setFocus,selectionPolicy:a.renderer.selectionPolicy,onCollapse:function(e){if(a.getNavHandler()){a.getNavHandler().onCollapse(e)}}});return o.then(function(){if(typeof i==="function"){try{i()}catch(e){if(a.registry){a.registry.getService("orion.page.message").setErrorMessage(e)}}}if(typeof a.onchange==="function"){a.onchange(a.treeRoot)}return a.treeRoot})},function(e){clearTimeout(u);if(a.registry){a.registry.getService("orion.page.message").setProgressResult(e)}return(new t).reject(e)})},onchange:function(e){}});l.prototype.constructor=l;return{FileExplorer:l,FileModel:f}});define("orion/explorers/navigationUtils",[],function(){function n(e,n,r,i){if(t){return}if(!e){return}e.push({domNode:n});n.tabIndex=-1;n.style.outline="none"}function r(e,t,r){if(!e){return}var i=e.getGridNavHolder(t,true);if(i){n(i,r)}}function i(e,t){if(!e){return}for(var n=0;n<e.length;n++){if(e[n].domNode===t){e.splice(n,1);return}}}var e=navigator.userAgent;var t=e.indexOf("iPad")!==-1;return{addNavGrid:r,generateNavGrid:n,removeNavGrid:i}});define("orion/regex",[],function(){function e(e){return e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")}function t(e){var t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(e);if(t){return{pattern:t[1],flags:t[2]}}return null}return{escape:e,parse:t}});define("orion/contentTypes",[],function(){function r(e,t){return e.indexOf(t)!==-1}function i(e,t){function n(e,t,n,i){var s=t.filename.indexOf(n)>=0;var o=r(t.extension,i.toLowerCase());if(s||o){if(!e||s&&r(e.extension,i.toLowerCase())){return t}}return e}if(typeof e!=="string"){return null}var i=e&&e.split(".").pop();var s=null;for(var o=0;o<t.length;o++){var u=t[o];if(n(s,u,e,i)===u){s=u}}return s}function s(e){if(e===null||typeof e==="undefined"){return[]}return Array.isArray(e)?e:[e]}function o(e){return s(e).map(function(e){return String.prototype.toLowerCase.call(e)})}function u(e){return{id:e.id,name:e.name,image:e.image,imageClass:e.imageClass,"extends":e["extends"],extension:o(e.extension),filename:s(e.filename)}}function a(e){var t=Object.create(null);e.map(u).forEach(function(e){if(!Object.prototype.hasOwnProperty.call(t,e.id)){t[e.id]=e}});return t}function f(e){var r=e.getServiceReferences(t).concat(e.getServiceReferences(n));var i=[];for(var o=0;o<r.length;o++){var u=r[o],f=s(u.getProperty("contentTypes"));for(var l=0;l<f.length;l++){i.push(f[l])}}return a(i)}function l(t){if(t&&t.registerService){this.serviceRegistry=t;this.map=f(t);t.registerService(e,this)}else if(Array.isArray(t)){this.serviceRegistry=null;this.map=a(t)}else{throw new Error("Invalid parameter")}}var e="orion.core.contentTypeRegistry";var t="orion.core.contenttype";var n="orion.file.contenttype";l.prototype={getContentTypes:function(){var e=this.getContentTypesMap();var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t.push(e[n])}}return t},getContentTypesMap:function(){return this.map},getFileContentType:function(e){return i(e.Name,this.getContentTypes())},getFilenameContentType:function(e){return i(e,this.getContentTypes())},getContentType:function(e){return this.map[e]||null},isExtensionOf:function(e,t){e=typeof e==="string"?this.getContentType(e):e;t=typeof t==="string"?this.getContentType(t):t;if(!e||!t){return false}if(e.id===t.id){return true}else{var n=e,r={};while(n&&(n=this.getContentType(n["extends"]))){if(n.id===t.id){return true}if(r[n.id]){throw new Error("Cycle: "+n.id)}r[n.id]=true}}return false},isSomeExtensionOf:function(e,t){for(var n=0;n<t.length;n++){if(this.isExtensionOf(e,t[n])){return true}}return false}};return{ContentTypeRegistry:l,getFilenameContentType:i}});define("orion/URITemplate",[],function(){function r(e){this._text=e}function i(e){return e.replace("%25","%")}function s(e,t){if(t==="U"){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}if(t==="U+R"){return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(n,i)}if(t==="U+R-,"){return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C")}throw new Error("Unknown allowed character set: "+t)}function o(e,t,n){var r=[];for(var i=0;i<e.length;i++){if(typeof e[i]!=="undefined"){r.push(s(e[i],t))}}return r.join(n)}function u(e,t,n,r){var i=Object.keys(e);var o=[];for(var u=0;u<i.length;u++){if(typeof e[i[u]]!=="undefined"){o.push(s(i[u],t)+n+s(e[i[u]],t))}}return o.join(r)}function a(e){var n=[];var r=e.split(",");for(var i=0;i<r.length;i++){var s=r[i].match(t);if(s===null){throw new Error("Bad VarSpec: "+e)}n.push({name:s[1],explode:!!s[2],prefix:s[3]?parseInt(s[3],10):-1})}return n}function f(t){if(t.length===0){throw new Error("Invalid Expression: 0 length expression")}this._operator=e[t[0]];if(this._operator){t=t.substring(1)}else{this._operator=e.NUL}this._varSpecList=a(t)}function l(e){var t=[];var n=0;var i=e.indexOf("{",n);while(i!==-1){t.push(new r(e.substring(n,i)));var s=e.indexOf("}",i+1);if(s===-1){throw new Error("Invalid template: "+e)}t.push(new f(e.substring(i+1,s)));n=s+1;i=e.indexOf("{",n)}t.push(new r(e.substring(n)));return t}function c(e){this._templateComponents=l(e)}var e={NUL:{first:"",sep:",",named:false,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:false,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:false,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:false,ifemp:"",allow:"U"},";":{first:";",sep:";",named:true,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:true,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:true,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:false,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:false,ifemp:"",allow:"U+R-,"}};var t=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/;var n=/%25[0-9A-F][0-9A-F]/g;r.prototype={expand:function(e){return encodeURI(this._text)}};f.prototype={expand:function(e){var t=[];for(var n=0;n<this._varSpecList.length;n++){var r=this._varSpecList[n];var i=r.name;var a=e[i];var f=typeof a;if(f!=="undefined"&&a!==null){var l=t.length===0?this._operator.first:this._operator.sep;var c=l;if(f==="string"){if(this._operator.named){c+=s(i,"U+R");c+=a.length===0?this._operator.ifemp:"="}if(r.prefix!==-1&&r.prefix<a.length){a=a.substring(0,r.prefix)}c+=s(a,this._operator.allow)}else if(Array.isArray(a)){if(!r.explode){if(this._operator.named){c+=s(i,"U+R");c+=a.length===0?this._operator.ifemp:"="}c+=o(a,this._operator.allow,",")}else{c+=o(a,this._operator.allow,this._operator.sep)}}else if(f==="object"){if(!r.explode){if(this._operator.named){c+=s(i,"U+R");c+=Object.keys(a).length===0?this._operator.ifemp:"="}c+=u(a,this._operator.allow,",",",")}else{c+=u(a,this._operator.allow,"=",this._operator.sep)}}else{throw new Error("bad param type: "+i+" : "+f)}if(c!==l||n<this._varSpecList.length-1){t.push(c)}}}return t.join("")}};c.prototype={expand:function(e){var t=[];for(var n=0;n<this._templateComponents.length;n++){t.push(this._templateComponents[n].expand(e))}return t.join("")}};return c});define("orion/PageLinks",["require","orion/Deferred","orion/PageUtil","orion/URITemplate","orion/i18nUtil","orion/URL-shim"],function(e,t,n,r,i){function s(){if(!e.toUrl){return(new URL("/",window.location.href)).href.slice(0,-1)}else{return(new URL(e.toUrl("orion/../"),window.location.href)).href.slice(0,-1)}}function o(e,o){o=o||"orion.page.link";var u=e.getServiceReferences(o);var a=n.matchResourceParameters(window.location.href);var f=s();var l={OrionHome:f,Location:a.resource};var c=[];u.forEach(function(e){var s={};e.getPropertyKeys().forEach(function(t){s[t]=e.getProperty(t)});if(s.uriTemplate&&s.nls&&(s.name||s.nameKey)){var o=new t;i.getMessageBundle(s.nls).then(function(e){var t=new r(s.uriTemplate);var i=t.expand(l);i=n.validateURLScheme(i);s.href=i;s.textContent=s.nameKey?e[s.nameKey]:s.name;o.resolve(s)});c.push(o)}else if(s.uriTemplate&&s.name){var u=new r(s.uriTemplate);var a=u.expand(l);a=n.validateURLScheme(a);s.href=a;s.textContent=s.name;c.push((new t).resolve(s))}});return t.all(c)}function u(e,t,n){var r=document.createElement("a");r.href=e;r.target=t;r.classList.add("targetSelector");r.textContent=n;return r}function a(e,t){return o(e,t).then(function(e){e.sort(function(e,t){var n=e.textContent&&e.textContent.toLowerCase();var r=t.textContent&&t.textContent.toLowerCase();if(n<r){return-1}if(n>r){return 1}return 0});return e.map(function(e){return u(e.href,"_self",e.textContent)})})}return{createPageLinks:a,getPageLinksInfo:o,getOrionHome:s}});define("orion/extensionCommands",["require","orion/Deferred","orion/commands","orion/regex","orion/contentTypes","orion/URITemplate","orion/i18nUtil","orion/URL-shim","orion/PageLinks","i18n!orion/edit/nls/messages"],function(e,t,n,r,i,s,o,u,a,f){function h(e){var t={};var n=e.getPropertyKeys();n.forEach(function(n){t[n]=e.getProperty(n)});return t}function p(e){return e.id||e.name}var l={};var c=a.getOrionHome();l._cloneItemWithoutChildren=function v(e){if(e===null||typeof e!=="object"){return e}var t=e.constructor();for(var n in e){if(n!=="children"&&n!=="Children"){t[n]=v(e[n])}}return t};l._getOpenWithNavCommandExtensions=function(e,t){function n(){var t=e.getServiceReferences("orion.edit.editor");var n=[];for(var r=0;r<t.length;r++){var i=t[r],s=i.getProperty("id");n.push({id:s,name:i.getProperty("name"),nameKey:i.getProperty("nameKey"),nls:i.getProperty("nls"),uriTemplate:i.getProperty("orionTemplate")||i.getProperty("uriTemplate"),validationProperties:i.getProperty("validationProperties")||[]})}return n}function r(e,t){var n=e.getServiceReferences("orion.navigate.openWith");var r=[];var i=[];for(var s=0;s<n.length;s++){var o=n[s];if(o.getProperty("editor")===t.id){var u=o.getProperty("contentType");if(u instanceof Array){r=r.concat(u)}else if(u!==null&&typeof u!=="undefined"){r.push(u)}var a=o.getProperty("excludedContentTypes");if(a instanceof Array){i=i.concat(a)}else if(a!==null&&typeof a!=="undefined"){i.push(a)}}}if(0===r.length){r=null}if(0===i.length){i=null}return{contentTypes:r,excludedContentTypes:i}}function i(e){var t=null;var n=e.getServiceReferences("orion.navigate.openWith.default");if(0<n.length){t=h(n[0])}return t}var s=n(),o=i(e);var u=[];for(var a=0;a<s.length;a++){var f=s[a];var l=o&&o.editor===f.id;var c=r(e,f);var p=c.contentTypes;var d=c.excludedContentTypes;var v={name:f.name||f.id,nameKey:f.nameKey,id:"eclipse.openWithCommand."+f.id,contentType:p,excludedContentTypes:d,uriTemplate:f.uriTemplate,nls:f.nls,forceSingleItem:true,isEditor:l?"default":"editor",validationProperties:f.validationProperties};u.push({properties:v,service:{}})}return u};l._makeValidator=function(e,t,n,r){function o(e,t,n,r,i){var s=false;var o;if(t.charAt(0)==="!"){return typeof e[t.substring(1)]==="undefined"}if(typeof e[t]!=="undefined"){if(typeof n==="undefined"){o=e[t];s=true}else if(typeof n==="string"){if(!typeof (e[t]==="string")){return false}if(r.variableName){var u=(new RegExp(n)).exec(e[t]);if(u){var a=u[0];if(r.variableMatchPosition==="before"){o=e[t].substring(0,u.index)}else if(r.variableMatchPosition==="after"){o=e[t].substring(u.index+a.length)}else if(r.variableMatchPosition==="only"){o=a}else{o=e[t]}s=true}}else{return(new RegExp(n)).test(e[t])}}else{if(e[t]===n){o=e[t];s=true}}if(s&&r.variableName){i[r.variableName]=o;i.itemCached=e;if(r.replacements){for(var f=0;f<r.replacements.length;f++){var l=false;if(r.replacements[f].pattern){var c=r.replacements[f].pattern;var h=r.replacements[f].replacement||"";i[r.variableName]=i[r.variableName].replace(new RegExp(c),h)}else{l=true}if(l){window.console.log("Invalid replacements specified in validation property.  "+r.replacements[f])}}}}return s}return false}function u(e,t,n,r){var i=n.match;var s,a;if(t.indexOf("[")===0){if(t.indexOf("]")<0){return false}if(!Array.isArray(e)){return false}s=t.replace("[","").replace("]","");for(var f=0;f<e.length;f++){if(u(e[f],s,n,r)){return true}}}else if(t.indexOf("|")>=0){s=t.substring(0,t.indexOf("|"));a=t.substring(t.indexOf("|")+1);if(u(e,s,n,r)){return true}else{return u(e,a,n,r)}}else if(t.indexOf(":")>=0){s=t.substring(0,t.indexOf(":"));a=t.substring(t.indexOf(":")+1);if(e[s]){return u(e[s],a,n,r)}else{return false}}else{return o(e,t,i,n,r)}}function a(t,n,r){if(r.info.validationProperties){for(var s=0;s<r.info.validationProperties.length;s++){var o=r.info.validationProperties[s];if(typeof o.source!=="undefined"){var a=u(t,o.source,o,r);if(!a){return false}}else{window.console.log("Invalid validationProperties in "+e.id+".  No source property specified.");return false}}}var f=true;var l=null;if(r.info.excludedContentTypes&&n){l=i.getFilenameContentType(t.Name,n);if(l){f=r.info.excludedContentTypes.every(function(e){var t=e.replace(/([*?])/g,".$1");if(-1!==l.id.search(t)){return false}return true})}}if(f&&r.info.contentType&&n){f=false;l=i.getFilenameContentType(t.Name,n);if(l){for(var s=0;s<r.info.contentType.length;s++){if(l.id===r.info.contentType[s]){f=true;break}}}}return f}var f={info:e};f.validationFunction=function(e){if(typeof r==="function"){e=r.call(this,e)}if(e){if(Array.isArray(e)){if((this.info.forceSingleItem||this.info.uriTemplate)&&e.length!==1){return false}if(e.length<1){return false}}else{e=[e]}for(var t=0;t<e.length;t++){if(!a(e[t],n,this)){return false}}return true}return false};f.generatesURI=function(){return!!this.info.uriTemplate};f.getURI=function(e){if(this.info.uriTemplate){var t={};for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t[n]=e[n]}}if(this.info.validationProperties){for(var r=0;r<this.info.validationProperties.length;r++){var i=this.info.validationProperties[r];if(i.source&&i.variableName){var o=this.itemCached===e&&this[i.variableName];if(!o){u(e,i.source,i,this)}if(!e[i.variableName]){t[i.variableName]=this[i.variableName]}else{window.console.log("Variable name "+i.variableName+" in the extension "+this.info.id+" conflicts with an existing property in the item metadata.")}}}}t.OrionHome=c;var a=new s(this.info.uriTemplate);return a.expand(t)}return null};return f};l._createCommandOptions=function(e,n,r,i,s,u){function f(t,o){var a=l._makeValidator(e,r,i,u);t.visibleWhen=a.validationFunction.bind(a);if(s){if(a.generatesURI.bind(a)()){t.hrefCallback=function(e){var t=Array.isArray(e.items)?e.items[0]:e.items;return a.getURI.bind(a)(t)}}else{var f=e;t.callback=function(e){var i;if(f.forceSingleItem){var s=Array.isArray(e.items)?e.items[0]:e.items;i=l._cloneItemWithoutChildren(s)}else{if(Array.isArray(e.items)){i=[];for(var o=0;o<e.items.length;o++){i.push(l._cloneItemWithoutChildren(e.items[o]))}}else{i=l._cloneItemWithoutChildren(e.items)}}if(r){var u=r.getService("orion.page.progress")}if(n.run){if(u){u.progress(n.run(i),"Running command: "+t.name)}else{n.run(i)}}else if(r){if(u){u.progress(r.getService(n).run(i),"Running command: "+t.name)}else{r.getService(n).run(i)}}}}}o.resolve(t)}var a=new t;if(e.nls){o.getMessageBundle(e.nls).then(function(t){var n={name:e.nameKey?t[e.nameKey]:e.name,image:e.image,id:p(e),tooltip:e.tooltipKey?t[e.tooltipKey]:e.tooltip,isEditor:e.isEditor,showGlobally:e.showGlobally};f(n,a)})}else{var c={name:e.name,image:e.image,id:p(e),tooltip:e.tooltip,isEditor:e.isEditor,showGlobally:e.showGlobally};f(c,a)}return a};l.getOpenWithCommands=function(e){var t=[];for(var n in e._commandList){var r=e._commandList[n];if(r.isEditor){t.push(r)}}return t};var d;l.createAndPlaceFileCommandsExtension=function(e,t,n,r,i,s){var o=s?"all":undefined;var u=!!s;return l.createFileCommands(e,null,o,u,t).then(function(e){if(i&&0<e.length){t.addCommandGroup(n,"eclipse.openWith",1e3,f["OpenWith"],i,null,null,null,"dropdownSelection");t.addCommandGroup(n,"eclipse.fileCommandExtensions",1e3,f["Extensions"],i)}e.forEach(function(e){var s=null;if(i){if(e.isEditor){s=i+"/eclipse.openWith"}else{s=i+"/eclipse.fileCommandExtensions"}}t.registerCommandContribution(n,e.id,r,s)});return{}})};l.createFileCommands=function(e,r,i,s,o){function a(){var n=e.getService("orion.core.contentTypeRegistry")||r;return d||t.when(n.getContentTypes(),function(e){d=e;return d})}i=i===undefined?"global":i;s=s===undefined?true:s;var u=[];if(!l._cachedFileCommands){l._createCachedFileCommands(e)}if(i==="all"||i==="global"){l._cachedFileCommands.forEach(function(e){var t=e.properties;if(i==="all"||t.forceSingleItem&&t.showGlobally){u.push(e)}})}return t.when(a(),function(){if(s){if(!l._cachedOpenWithExtensions){l._cachedOpenWithExtensions=l._getOpenWithNavCommandExtensions(e,d)}u=u.concat(l._cachedOpenWithExtensions);o._addedOpenWithCommands=s}var r=u.map(function(r){var i=r.properties;var s=r.service;var u=o.findCommand(p(i));if(u){return(new t).resolve(u)}else{return l._createCommandOptions(i,s,e,d,true).then(function(e){var t=new n.Command(e);o.addCommand(t);return t})}});return t.all(r,function(e){return{_error:e}}).then(function(e){return e})})};l._createCachedFileCommands=function(e){var t=e.getServiceReferences("orion.navigate.command");l._cachedFileCommands=[];for(var n=0;n<t.length;n++){var r=t[n].getProperty("id");if(r!=="orion.navigateFromMetadata"){var i=e.getService(t[n]);var s=h(t[n]);l._cachedFileCommands.push({properties:s,service:i})}}};l.getFileCommandIds=function(){var e=[];if(!l._cachedFileCommands){throw"extensionCommandUtils._cachedFileCommands is not initialized"}else if(l._cachedFileCommands.length){e=l._cachedFileCommands.map(function(e){return e.properties.id})}return e};l.createOpenWithCommands=function(e,n,r){if(r&&r._addedOpenWithCommands){return(new t).resolve(l.getOpenWithCommands(r))}return l.createFileCommands(e,n,"none",true,r)};return l});define("orion/explorers/navigatorRenderer",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/explorers/explorer","orion/explorers/navigationUtils","orion/extensionCommands","orion/objects","orion/URITemplate","orion/webui/littlelib"],function(e,t,n,r,i,s,o,u){function a(e){switch(e&&e.id){case"image/jpeg":case"image/png":case"image/gif":case"image/ico":case"image/tiff":case"image/svg":return true}return false}function f(e,t,n,r){if(e){var i,s=e.imageClass,o=e.image;if(s){i=document.createElement("span");i.className+=s;i.classList.add("thumbnail")}else if(o){i=document.createElement("img");i.src=o;i.classList.add("thumbnail")}if(i){t.replaceChild(i,r)}}}function c(e,n,r,u,c,h,p,d,v,m){n=s.clone(n);var g;if(n.Directory){g=document.createElement("a");g.className="navlinkonpage";g.href=!e?l:(new o(e+"#{,resource,params*}")).expand({resource:n.ChildrenLocation});if(n.Name){g.appendChild(document.createTextNode(n.Name))}}else{var y;if(!c){c=i.getOpenWithCommands(r)}if(!h){for(y=0;y<c.length;y++){if(c[y].isEditor==="default"){h=c[y]}}}g=document.createElement("a");g.className="navlink targetSelector";if(p&&typeof p==="object"){Object.keys(p).forEach(function(e){g[e]=p[e]})}var b=null,w=null;if(v){b=v.holderDom}else{b=g}if(b){w=document.createElement("span");w.className="core-sprite-file modelDecorationSprite thumbnail";b.appendChild(w)}if(n.Name){g.appendChild(document.createTextNode(n.Name))}var E=false;var S=n.Location;if(d&&typeof d==="object"){n.params={};s.mixin(n.params,d)}for(y=0;y<c.length;y++){var x=c[y];if(x.visibleWhen(n)){S=x.hrefCallback({items:n});E=true;break}}t.when(u.getFileContentType(n),function(e){if(!E&&h&&!a(e)){S=h.hrefCallback({items:n})}if(b){f(e,b,n.Location,w)}g.href=S;if(m&&typeof m.updateFileNode==="function"){m.updateFileNode(n,g,a(e))}})}return g}function h(e,t,n,r){this.explorer=t;this.commandService=n;this.contentTypeService=r;this.openWithCommands=null;this.actionScopeId=e.actionScopeId;this._init(e);this.target="_self"}var l=new o("#{,resource,params*}");h.prototype=new n.SelectionRenderer;h.prototype.wrapperCallback=function(e){e.setAttribute("role","tree")};h.prototype.tableCallback=function(t){t.setAttribute("aria-label",e["Navigator"]);t.setAttribute("role","presentation")};h.prototype.rowCallback=function(e,t){e.setAttribute("role","treeitem")};h.prototype.emptyCallback=function(t){var n=document.createElement("tr");var r=document.createElement("td");r.colSpan=this.oneColumn?1:3;var i=document.createElement("div");i.classList.add("noFile");i.textContent=e["NoFile"];var s=document.createElement("span");s.classList.add("core-sprite-addcontent");s.classList.add("icon-inline");s.classList.add("imageSprite");u.processDOMNodes(i,[s]);r.appendChild(i);n.appendChild(r);t.appendChild(n)};h.prototype.getCellHeaderElement=function(e){if(this.oneColumn&&e!==0){return null}switch(e){case 0:case 1:case 2:var t=document.createElement("th");t.style.height="8px"}};h.prototype.setTarget=function(e){this.target=e};h.prototype.getFolderImage=function(e){if(!this.showFolderImage){return null}var t=document.createElement("span");t.className="core-sprite-folder modelDecorationSprite";return t};h.prototype.createFolderNode=function(e){var t;if(this.showFolderLinks){t=c(this.folderLink||"",e,this.commandService,this.contentTypeService);var n=this.getFolderImage(e);if(n){t.insertBefore(n,t.firstChild)}}else{t=document.createElement("span");t.textContent=e.Name}return t};h.prototype.updateFileNode=function(e,t,n){};h.prototype.showFolderLinks=true;h.prototype.getCellElement=function(e,t,n){switch(e){case 0:var s=document.createElement("td");var o=document.createElement("span");o.id=n.id+"MainCol";o.setAttribute("role","presentation");s.appendChild(o);s.setAttribute("role","presentation");o.className="mainNavColumn";var u;if(t.Directory){var a=this.getExpandImage(n,o);u=this.createFolderNode(t);o.appendChild(u);this.explorer._makeDropTarget(t,u);this.explorer._makeDropTarget(t,n)}else{var f;if(!this.openWithCommands){this.openWithCommands=i.getOpenWithCommands(this.commandService);for(f=0;f<this.openWithCommands.length;f++){if(this.openWithCommands[f].isEditor==="default"){this.defaultEditor=this.openWithCommands[f]}}}u=c("",t,this.commandService,this.contentTypeService,this.openWithCommands,this.defaultEditor,{target:this.target},null,null,this);o.appendChild(u)}if(u){u.id=n.id+"NameLink";if(u.nodeType===1){r.addNavGrid(this.explorer.getNavDict(),t,u);u.setAttribute("role","link");u.setAttribute("tabindex","-1")}}if(this.actionScopeId){this.commandService.renderCommands(this.actionScopeId,o,t,this.explorer,"tool",null,true)}return s;case 1:if(this.oneColumn){return null}var l=document.createElement("td");if(t.LocalTimeStamp){var h=new Date(t.LocalTimeStamp);l.textContent=h.toLocaleString()}return l;case 2:if(this.oneColumn){return null}var p=document.createElement("td");if(!t.Directory&&typeof t.Length==="number"){var d=parseInt(t.Length,10),v=d/1024;p.textContent=Math.ceil(v).toLocaleString()+" KB"}p.style.textAlign="right";return p}};h.prototype.constructor=h;return{NavigatorRenderer:h,isImage:a,createLink:c}});(function(){function t(t){this.tokens=[];this.tokens.links={};this.options=t||f.defaults;this.rules=e.normal;if(this.options.gfm){if(this.options.tables){this.rules=e.tables}else{this.rules=e.gfm}}}function r(e,t){this.options=t||f.defaults;this.links=e;this.rules=n.normal;if(!this.links){throw new Error("Tokens array requires a `links` property.")}if(this.options.gfm){if(this.options.breaks){this.rules=n.breaks}else{this.rules=n.gfm}}else if(this.options.pedantic){this.rules=n.pedantic}}function i(e){this.tokens=[];this.token=null;this.options=e||f.defaults}function s(e,t){return e.replace(!t?/&(?!#?\w+;)/g:/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(e,t){e=e.source;t=t||"";return function n(r,i){if(!r)return new RegExp(e,t);i=i.source||i;i=i.replace(/(^|[^\[])\^/g,"$1");e=e.replace(r,i);return n}}function u(){}function a(e){var t=1,n,r;for(;t<arguments.length;t++){n=arguments[t];for(r in n){if(Object.prototype.hasOwnProperty.call(n,r)){e[r]=n[r]}}}return e}function f(e,n,r){if(r||typeof n==="function"){if(!r){r=n;n=null}if(n)n=a({},f.defaults,n);var o=n.highlight,u,l,c=0;try{u=t.lex(e,n)}catch(h){return r(h)}l=u.length;var p=function(e){var t,s;if(e!==true){delete n.highlight}try{t=i.parse(u,n)}catch(a){s=a}n.highlight=o;return s?r(s):r(null,t)};if(!o||o.length<3){return p(true)}if(!l)return p();for(;c<u.length;c++){(function(e){if(e.type!=="code"){return--l||p()}return o(e.text,e.lang,function(t,n){if(n==null||n===e.text){return--l||p()}e.text=n;e.escaped=true;--l||p()})})(u[c])}return}try{if(n)n=a({},f.defaults,n);return i.parse(t.lex(e,n),n)}catch(h){h.message+="\nPlease report this to https://github.com/chjj/marked.";if((n||f.defaults).silent){return"<p>An error occured:</p><pre>"+s(h.message+"",true)+"</pre>"}throw h}}var e={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:u,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:u,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:u,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};e.bullet=/(?:[*+-]|\d+\.)/;e.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;e.item=o(e.item,"gm")(/bull/g,e.bullet)();e.list=o(e.list)(/bull/g,e.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();e._tag="(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code"+"|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo"+"|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";e.html=o(e.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,e._tag)();e.paragraph=o(e.paragraph)("hr",e.hr)("heading",e.heading)("lheading",e.lheading)("blockquote",e.blockquote)("tag","<"+e._tag)("def",e.def)();e.normal=a({},e);e.gfm=a({},e.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});e.gfm.paragraph=o(e.paragraph)("(?!","(?!"+e.gfm.fences.source.replace("\\1","\\2")+"|")();e.tables=a({},e.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});t.rules=e;t.lex=function(e,n){var r=new t(n);return r.lex(e)};t.prototype.lex=function(e){e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(e,true)};t.prototype.token=function(t,n){var t=t.replace(/^ +$/gm,""),r,i,s,o,u,a,f,l,c;while(t){if(s=this.rules.newline.exec(t)){t=t.substring(s[0].length);if(s[0].length>1){this.tokens.push({type:"space"})}}if(s=this.rules.code.exec(t)){t=t.substring(s[0].length);s=s[0].replace(/^ {4}/gm,"");this.tokens.push({type:"code",text:!this.options.pedantic?s.replace(/\n+$/,""):s});continue}if(s=this.rules.fences.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"code",lang:s[2],text:s[3]});continue}if(s=this.rules.heading.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"heading",depth:s[1].length,text:s[2]});continue}if(n&&(s=this.rules.nptable.exec(t))){t=t.substring(s[0].length);a={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/\n$/,"").split("\n")};for(l=0;l<a.align.length;l++){if(/^ *-+: *$/.test(a.align[l])){a.align[l]="right"}else if(/^ *:-+: *$/.test(a.align[l])){a.align[l]="center"}else if(/^ *:-+ *$/.test(a.align[l])){a.align[l]="left"}else{a.align[l]=null}}for(l=0;l<a.cells.length;l++){a.cells[l]=a.cells[l].split(/ *\| */)}this.tokens.push(a);continue}if(s=this.rules.lheading.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"heading",depth:s[2]==="="?1:2,text:s[1]});continue}if(s=this.rules.hr.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"hr"});continue}if(s=this.rules.blockquote.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"blockquote_start"});s=s[0].replace(/^ *> ?/gm,"");this.token(s,n);this.tokens.push({type:"blockquote_end"});continue}if(s=this.rules.list.exec(t)){t=t.substring(s[0].length);o=s[2];this.tokens.push({type:"list_start",ordered:o.length>1});s=s[0].match(this.rules.item);r=false;c=s.length;l=0;for(;l<c;l++){a=s[l];f=a.length;a=a.replace(/^ *([*+-]|\d+\.) +/,"");if(~a.indexOf("\n ")){f-=a.length;a=!this.options.pedantic?a.replace(new RegExp("^ {1,"+f+"}","gm"),""):a.replace(/^ {1,4}/gm,"")}if(this.options.smartLists&&l!==c-1){u=e.bullet.exec(s[l+1])[0];if(o!==u&&!(o.length>1&&u.length>1)){t=s.slice(l+1).join("\n")+t;l=c-1}}i=r||/\n\n(?!\s*$)/.test(a);if(l!==c-1){r=a[a.length-1]==="\n";if(!i)i=r}this.tokens.push({type:i?"loose_item_start":"list_item_start"});this.token(a,false);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"});continue}if(s=this.rules.html.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:s[1]==="pre"||s[1]==="script",text:s[0]});continue}if(n&&(s=this.rules.def.exec(t))){t=t.substring(s[0].length);this.tokens.links[s[1].toLowerCase()]={href:s[2],title:s[3]};continue}if(n&&(s=this.rules.table.exec(t))){t=t.substring(s[0].length);a={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(l=0;l<a.align.length;l++){if(/^ *-+: *$/.test(a.align[l])){a.align[l]="right"}else if(/^ *:-+: *$/.test(a.align[l])){a.align[l]="center"}else if(/^ *:-+ *$/.test(a.align[l])){a.align[l]="left"}else{a.align[l]=null}}for(l=0;l<a.cells.length;l++){a.cells[l]=a.cells[l].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */)}this.tokens.push(a);continue}if(n&&(s=this.rules.paragraph.exec(t))){t=t.substring(s[0].length);this.tokens.push({type:"paragraph",text:s[1][s[1].length-1]==="\n"?s[1].slice(0,-1):s[1]});continue}if(s=this.rules.text.exec(t)){t=t.substring(s[0].length);this.tokens.push({type:"text",text:s[0]});continue}if(t){throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}}return this.tokens};var n={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:u,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:u,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};n._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/;n._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/;n.link=o(n.link)("inside",n._inside)("href",n._href)();n.reflink=o(n.reflink)("inside",n._inside)();n.normal=a({},n);n.pedantic=a({},n.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});n.gfm=a({},n.normal,{escape:o(n.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:o(n.text)("]|","~]|")("|","|https?://|")()});n.breaks=a({},n.gfm,{br:o(n.br)("{2,}","*")(),text:o(n.gfm.text)("{2,}","*")()});r.rules=n;r.output=function(e,t,n){var i=new r(t,n);return i.output(e)};r.prototype.output=function(e){var t="",n,r,i,o;while(e){if(o=this.rules.escape.exec(e)){e=e.substring(o[0].length);t+=o[1];continue}if(o=this.rules.autolink.exec(e)){e=e.substring(o[0].length);if(o[2]==="@"){r=o[1][6]===":"?this.mangle(o[1].substring(7)):this.mangle(o[1]);i=this.mangle("mailto:")+r}else{r=s(o[1]);i=r}t+='<a href="'+i+'">'+r+"</a>";continue}if(o=this.rules.url.exec(e)){e=e.substring(o[0].length);r=s(o[1]);i=r;t+='<a href="'+i+'">'+r+"</a>";continue}if(o=this.rules.tag.exec(e)){e=e.substring(o[0].length);t+=this.options.sanitize?s(o[0]):o[0];continue}if(o=this.rules.link.exec(e)){e=e.substring(o[0].length);t+=this.outputLink(o,{href:o[2],title:o[3]});continue}if((o=this.rules.reflink.exec(e))||(o=this.rules.nolink.exec(e))){e=e.substring(o[0].length);n=(o[2]||o[1]).replace(/\s+/g," ");n=this.links[n.toLowerCase()];if(!n||!n.href){t+=o[0][0];e=o[0].substring(1)+e;continue}t+=this.outputLink(o,n);continue}if(o=this.rules.strong.exec(e)){e=e.substring(o[0].length);t+="<strong>"+this.output(o[2]||o[1])+"</strong>";continue}if(o=this.rules.em.exec(e)){e=e.substring(o[0].length);t+="<em>"+this.output(o[2]||o[1])+"</em>";continue}if(o=this.rules.code.exec(e)){e=e.substring(o[0].length);t+="<code>"+s(o[2],true)+"</code>";continue}if(o=this.rules.br.exec(e)){e=e.substring(o[0].length);t+="<br>";continue}if(o=this.rules.del.exec(e)){e=e.substring(o[0].length);t+="<del>"+this.output(o[1])+"</del>";continue}if(o=this.rules.text.exec(e)){e=e.substring(o[0].length);t+=s(this.smartypants(o[0]));continue}if(e){throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}}return t};r.prototype.outputLink=function(e,t){if(e[0][0]!=="!"){return'<a href="'+s(t.href)+'"'+(t.title?' title="'+s(t.title)+'"':"")+">"+this.output(e[1])+"</a>"}else{return'<img src="'+s(t.href)+'" alt="'+s(e[1])+'"'+(t.title?' title="'+s(t.title)+'"':"")+">"}};r.prototype.smartypants=function(e){if(!this.options.smartypants)return e;return e.replace(/--/g,"—").replace(/'([^']*)'/g,"‘$1’").replace(/"([^"]*)"/g,"“$1”").replace(/\.{3}/g,"…")};r.prototype.mangle=function(e){var t="",n=e.length,r=0,i;for(;r<n;r++){i=e.charCodeAt(r);if(Math.random()>.5){i="x"+i.toString(16)}t+="&#"+i+";"}return t};i.parse=function(e,t){var n=new i(t);return n.parse(e)};i.prototype.parse=function(e){this.inline=new r(e.links,this.options);this.tokens=e.reverse();var t="";while(this.next()){t+=this.tok()}return t};i.prototype.next=function(){return this.token=this.tokens.pop()};i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};i.prototype.parseText=function(){var e=this.token.text;while(this.peek().type==="text"){e+="\n"+this.next().text}return this.inline.output(e)};i.prototype.tok=function(){switch(this.token.type){case"space":{return""};case"hr":{return"<hr>\n"};case"heading":{return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n"};case"code":{if(this.options.highlight){var e=this.options.highlight(this.token.text,this.token.lang);if(e!=null&&e!==this.token.text){this.token.escaped=true;this.token.text=e}}if(!this.token.escaped){this.token.text=s(this.token.text,true)}return"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n"};case"table":{var t="",n,r,i,o,u;t+="<thead>\n<tr>\n";for(r=0;r<this.token.header.length;r++){n=this.inline.output(this.token.header[r]);t+=this.token.align[r]?'<th align="'+this.token.align[r]+'">'+n+"</th>\n":"<th>"+n+"</th>\n"}t+="</tr>\n</thead>\n";t+="<tbody>\n";for(r=0;r<this.token.cells.length;r++){i=this.token.cells[r];t+="<tr>\n";for(u=0;u<i.length;u++){o=this.inline.output(i[u]);t+=this.token.align[u]?'<td align="'+this.token.align[u]+'">'+o+"</td>\n":"<td>"+o+"</td>\n"}t+="</tr>\n"}t+="</tbody>\n";return"<table>\n"+t+"</table>\n"};case"blockquote_start":{var t="";while(this.next().type!=="blockquote_end"){t+=this.tok()}return"<blockquote>\n"+t+"</blockquote>\n"};case"list_start":{var a=this.token.ordered?"ol":"ul",t="";while(this.next().type!=="list_end"){t+=this.tok()}return"<"+a+">\n"+t+"</"+a+">\n"};case"list_item_start":{var t="";while(this.next().type!=="list_item_end"){t+=this.token.type==="text"?this.parseText():this.tok()}return"<li>"+t+"</li>\n"};case"loose_item_start":{var t="";while(this.next().type!=="list_item_end"){t+=this.tok()}return"<li>"+t+"</li>\n"};case"html":{return!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text};case"paragraph":{return"<p>"+this.inline.output(this.token.text)+"</p>\n"};case"text":{return"<p>"+this.parseText()+"</p>\n"}}};u.exec=u;f.options=f.setOptions=function(e){a(f.defaults,e);return f};f.defaults={gfm:true,tables:true,breaks:false,pedantic:false,sanitize:false,smartLists:false,silent:false,highlight:null,langPrefix:"lang-",smartypants:false};f.Parser=i;f.parser=i.parse;f.Lexer=t;f.lexer=t.lex;f.InlineLexer=r;f.inlineLexer=r.output;f.parse=f;if(typeof exports==="object"){module.exports=f}else if(typeof define==="function"&&define.amd){define("marked/marked",[],function(){return f})}else{this.marked=f}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());define("orion/editor/i18n",{load:function(e,t,n,r){if(t.specified&&t.specified("orion/bootstrap")){t(["orion/i18n!"+e],function(e){n(e)})}else{n({})}}});define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(e,t){var n={root:t};for(var r in e){if(e.hasOwnProperty(r)){if(typeof n[r]==="undefined"){n[r]=e[r]}}}return n});define("orion/editor/eventTarget",[],function(){function e(){}e.addMixin=function(t){var n=e.prototype;for(var r in n){if(n.hasOwnProperty(r)){t[r]=n[r]}}};e.prototype={addEventListener:function(e,t,n){if(!this._eventTypes){this._eventTypes={}}var r=this._eventTypes[e];if(!r){r=this._eventTypes[e]={level:0,listeners:[]}}var i=r.listeners;i.push({listener:t,useCapture:n})},dispatchEvent:function(e){var t=e.type;this._dispatchEvent("pre"+t,e);this._dispatchEvent(t,e);this._dispatchEvent("post"+t,e)},_dispatchEvent:function(e,t){var n=this._eventTypes?this._eventTypes[e]:null;if(n){var r=n.listeners;try{n.level++;if(r){for(var i=0,s=r.length;i<s;i++){if(r[i]){var o=r[i].listener;if(typeof o==="function"){o.call(this,t)}else if(o.handleEvent&&typeof o.handleEvent==="function"){o.handleEvent(t)}}}}}finally{n.level--;if(n.compact&&n.level===0){for(var u=r.length-1;u>=0;u--){if(!r[u]){r.splice(u,1)}}if(r.length===0){delete this._eventTypes[e]}n.compact=false}}}},isListening:function(e){if(!this._eventTypes){return false}return this._eventTypes[e]!==undefined},removeEventListener:function(e,t,n){if(!this._eventTypes){return}var r=this._eventTypes[e];if(r){var i=r.listeners;for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u&&u.listener===t&&u.useCapture===n){if(r.level!==0){i[s]=null;r.compact=true}else{i.splice(s,1)}break}}if(i.length===0){delete this._eventTypes[e]}}}};return{EventTarget:e}});define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(e,t,n){function r(e,t){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(e);this.setLineDelimiter(t)}r.prototype={destroy:function(){},find:function(e){if(this._text.length>1){this._text=[this._text.join("")]}var n=e.string;var r=e.regex;var i=n;var s="";var o=e.caseInsensitive;if(i){if(r){var u=t.parse(i);if(u){i=u.pattern;s=u.flags}}else{i=n.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&");if(o){i=i.replace(/[iI\u0130\u0131]/g,"[Iiİı]")}}}var a=null,f;if(i){var l=e.reverse;var c=e.wrap;var h=e.wholeWord;var p=e.start||0;var d=e.end;var v=d!==null&&d!==undefined;if(s.indexOf("g")===-1){s+="g"}if(s.indexOf("m")===-1){s+="m"}if(o){if(s.indexOf("i")===-1){s+="i"}}if(h){i="\\b"+i+"\\b"}var m=this._text[0],g,y,b=0;if(v){var w=p<d?p:d;var E=p<d?d:p;m=m.substring(w,E);b=w}var S=new RegExp(i,s);if(l){f=function(){var e=null;S.lastIndex=0;while(true){y=S.lastIndex;g=S.exec(m);if(y===S.lastIndex){return null}if(g){if(g.index+b<p){e={start:g.index+b,end:S.lastIndex+b}}else{if(!c||e){break}p=m.length+b;e={start:g.index+b,end:S.lastIndex+b}}}else{break}}if(e){p=e.start}return e}}else{if(!v){S.lastIndex=p}f=function(){while(true){y=S.lastIndex;g=S.exec(m);if(y===S.lastIndex){return null}if(g){return{start:g.index+b,end:S.lastIndex+b}}if(y!==0){if(c){continue}}break}return null}}a=f()}return{next:function(){var e=a;if(e){a=f()}return e},hasNext:function(){return a!==null}}},getCharCount:function(){var e=0;for(var t=0;t<this._text.length;t++){e+=this._text[t].length}return e},getLine:function(e,t){var n=this.getLineCount();if(!(0<=e&&e<n)){return null}var r=this._lineOffsets[e];if(e+1<n){var i=this.getText(r,this._lineOffsets[e+1]);if(t){return i}var s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13){s--}return i.substring(0,s)}else{return this.getText(r)}},getLineAtOffset:function(e){var t=this.getCharCount();if(!(0<=e&&e<=t)){return-1}var n=this.getLineCount();if(e===t){return n-1}var r,i;var s=this._lastLineIndex;if(0<=s&&s<n){r=this._lineOffsets[s];i=s+1<n?this._lineOffsets[s+1]:t;if(r<=e&&e<i){return s}}var o=n;var u=-1;while(o-u>1){s=Math.floor((o+u)/2);r=this._lineOffsets[s];i=s+1<n?this._lineOffsets[s+1]:t;if(e<=r){o=s}else if(e<i){o=s;break}else{u=s}}this._lastLineIndex=o;return o},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(e,t){var n=this.getLineCount();if(!(0<=e&&e<n)){return-1}if(e+1<n){var r=this._lineOffsets[e+1];if(t){return r}var i=this.getText(Math.max(this._lineOffsets[e],r-2),r);var s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13){s--}return r-(i.length-s)}else{return this.getCharCount()}},getLineStart:function(e){if(!(0<=e&&e<this.getLineCount())){return-1}return this._lineOffsets[e]},getText:function(e,t){if(e===undefined){e=0}if(t===undefined){t=this.getCharCount()}if(e===t){return""}var n=0,r=0,i;while(r<this._text.length){i=this._text[r].length;if(e<=n+i){break}n+=i;r++}var s=n;var o=r;while(r<this._text.length){i=this._text[r].length;if(t<=n+i){break}n+=i;r++}var u=n;var a=r;if(o===a){return this._text[o].substring(e-s,t-u)}var f=this._text[o].substring(e-s);var l=this._text[a].substring(0,t-u);return f+this._text.slice(o+1,a).join("")+l},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,t){if(e==="auto"){e=undefined;if(this.getLineCount()>1){e=this.getText(this.getLineEnd(0),this.getLineEnd(0,true))}}this._lineDelimiter=e?e:n.platformDelimiter;if(t){var r=this.getLineCount();if(r>1){var i=new Array(r);for(var s=0;s<r;s++){i[s]=this.getLine(s)}this.setText(i.join(this._lineDelimiter))}}},setText:function(e,t,n){if(e===undefined){e=""}if(t===undefined){t=0}if(n===undefined){n=this.getCharCount()}if(t===n&&e===""){return}var r=this.getLineAtOffset(t);var i=this.getLineAtOffset(n);var s=t;var o=n-t;var u=i-r;var a=e.length;var f=0;var l=this.getLineCount();var c=0,h=0,p=0;var d=[];while(true){if(c!==-1&&c<=p){c=e.indexOf("\r",p)}if(h!==-1&&h<=p){h=e.indexOf("\n",p)}if(h===-1&&c===-1){break}if(c!==-1&&h!==-1){if(c+1===h){p=h+1}else{p=(c<h?c:h)+1}}else if(c!==-1){p=c+1}else{p=h+1}d.push(t+p);f++}var v={type:"Changing",text:e,start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(v);if(d.length===0){var m=this.getLineStart(r),g;if(i+1<l){g=this.getLineStart(i+1)}else{g=this.getCharCount()}if(t!==m){e=this.getText(m,t)+e;t=m}if(n!==g){e=e+this.getText(n,g);n=g}}var y=a-o;for(var b=r+u+1;b<l;b++){this._lineOffsets[b]+=y}var w=5e4;var E=w,S;if(d.length<E){S=[r+1,u].concat(d);Array.prototype.splice.apply(this._lineOffsets,S)}else{p=r+1;this._lineOffsets.splice(p,u);for(var x=0;x<d.length;x+=E){S=[p,0].concat(d.slice(x,Math.min(d.length,x+E)));Array.prototype.splice.apply(this._lineOffsets,S);p+=E}}var T=0,N=0,C;while(N<this._text.length){C=this._text[N].length;if(t<=T+C){break}T+=C;N++}var k=T;var L=N;while(N<this._text.length){C=this._text[N].length;if(n<=T+C){break}T+=C;N++}var A=T;var O=N;var M=this._text[L];var _=this._text[O];var D=M.substring(0,t-k);var P=_.substring(n-A);var H=[L,O-L+1];if(D){H.push(D)}if(e){H.push(e)}if(P){H.push(P)}Array.prototype.splice.apply(this._text,H);if(this._text.length===0){this._text=[""]}var B={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(B)}};e.EventTarget.addMixin(r.prototype);return{TextModel:r}});define("orion/keyBinding",["orion/util"],function(e){function t(e,t,n,r,i,s){this.type=s||"keydown";if(typeof e==="string"&&this.type==="keydown"){this.keyCode=e.toUpperCase().charCodeAt(0)}else{this.keyCode=e}this.mod1=t!==undefined&&t!==null?t:false;this.mod2=n!==undefined&&n!==null?n:false;this.mod3=r!==undefined&&r!==null?r:false;this.mod4=i!==undefined&&i!==null?i:false}function n(e){this.keys=e}t.prototype={getKeys:function(){return[this]},match:function(t,n){if(n!==undefined){if(n!==0){return false}}else{if(t instanceof Array){if(t.length>1){return false}t=t[0]}}if(t.type!==this.type){return false}if(this.keyCode===t.keyCode||this.keyCode===String.fromCharCode(e.isOpera?t.which:t.charCode!==undefined?t.charCode:t.keyCode)){var r=e.isMac?t.metaKey:t.ctrlKey;if(this.mod1!==r){return false}if(this.type==="keydown"){if(this.mod2!==t.shiftKey){return false}}if(this.mod3!==t.altKey){return false}if(e.isMac&&this.mod4!==t.ctrlKey){return false}return true}return false},equals:function(e){if(!e){return false}if(this.keyCode!==e.keyCode){return false}if(this.mod1!==e.mod1){return false}if(this.mod2!==e.mod2){return false}if(this.mod3!==e.mod3){return false}if(this.mod4!==e.mod4){return false}if(this.type!==e.type){return false}return true}};n.prototype={getKeys:function(){return this.keys.slice(0)},match:function(e,t){var n=this.keys;if(t!==undefined){if(t>n.length){return false}if(n[t].match(e)){if(t===n.length-1){return true}return t+1}return false}else{if(!(e instanceof Array)){e=[e]}if(e.length>n.length){return false}var r;for(r=0;r<e.length;r++){if(!n[r].match(e[r])){return false}}if(r===n.length){return true}return r}},equals:function(e){if(!e.keys){return false}if(e.keys.length!==this.keys.length){return false}for(var t=0;t<e.keys.length;t++){if(!e.keys[t].equals(this.keys[t])){return false}}return true}};return{KeyBinding:t,KeyStroke:t,KeySequence:n}});define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(e,t){function n(e){if(!e){return}this._view=e;this._keyBindings=this.createKeyBindings();this._keyBindingIndex=0}function r(e){n.call(this,e)}n.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(e){var t=[];var n=this._keyBindings;for(var r=0;r<n.length;r++){if(n[r].actionID===e){t.push(n[r].keyBinding)}}return t},getView:function(){return this._view},isActive:function(){return this._view.getKeyModes().indexOf(this)!==-1},match:function(e){if(e.type==="keydown"){switch(e.keyCode){case 16:case 17:case 18:case 91:return undefined}}var t=this._keyBindingIndex;var n=this._matchingKeyBindings||this._keyBindings;var r=[];for(var i=0;i<n.length;i++){var s=n[i];var o=s.keyBinding;var u=o.match(e,t);if(u===true){this._keyBindingIndex=0;this._matchingKeyBindings=null;return s.actionID}else if(typeof u==="number"){r.push(s)}}if(r.length===0){this._keyBindingIndex=0;this._matchingKeyBindings=null}else{this._keyBindingIndex++;this._matchingKeyBindings=r;return"noop"}return undefined},setKeyBinding:function(e,t){var n=this._keyBindings;for(var r=0;r<n.length;r++){var i=n[r];if(i.keyBinding.equals(e)){if(t){i.actionID=t}else{if(i.predefined){i.actionID="noop"}else{n.splice(r,1)}}return}}if(t){n.push({keyBinding:e,actionID:t})}},setView:function(e){this._view=e}};r.prototype=new n;r.prototype.createKeyBindings=function(){var n=e.KeyBinding;var r=[];r.push({actionID:"lineUp",keyBinding:new n(38),predefined:true});r.push({actionID:"lineDown",keyBinding:new n(40),predefined:true});r.push({actionID:"charPrevious",keyBinding:new n(37),predefined:true});r.push({actionID:"charNext",keyBinding:new n(39),predefined:true});if(t.isMac){r.push({actionID:"scrollPageUp",keyBinding:new n(33),predefined:true});r.push({actionID:"scrollPageDown",keyBinding:new n(34),predefined:true});r.push({actionID:"pageUp",keyBinding:new n(33,null,null,true),predefined:true});r.push({actionID:"pageDown",keyBinding:new n(34,null,null,true),predefined:true});r.push({actionID:"lineStart",keyBinding:new n(37,true),predefined:true});r.push({actionID:"lineEnd",keyBinding:new n(39,true),predefined:true});r.push({actionID:"wordPrevious",keyBinding:new n(37,null,null,true),predefined:true});r.push({actionID:"wordNext",keyBinding:new n(39,null,null,true),predefined:true});r.push({actionID:"scrollTextStart",keyBinding:new n(36),predefined:true});r.push({actionID:"scrollTextEnd",keyBinding:new n(35),predefined:true});r.push({actionID:"textStart",keyBinding:new n(38,true),predefined:true});r.push({actionID:"textEnd",keyBinding:new n(40,true),predefined:true});r.push({actionID:"scrollPageUp",keyBinding:new n(38,null,null,null,true),predefined:true});r.push({actionID:"scrollPageDown",keyBinding:new n(40,null,null,null,true),predefined:true});r.push({actionID:"lineStart",keyBinding:new n(37,null,null,null,true),predefined:true});r.push({actionID:"lineEnd",keyBinding:new n(39,null,null,null,true),predefined:true});r.push({actionID:"lineStart",keyBinding:new n(38,null,null,true),predefined:true});r.push({actionID:"lineEnd",keyBinding:new n(40,null,null,true),predefined:true})}else{r.push({actionID:"pageUp",keyBinding:new n(33),predefined:true});r.push({actionID:"pageDown",keyBinding:new n(34),predefined:true});r.push({actionID:"lineStart",keyBinding:new n(36),predefined:true});r.push({actionID:"lineEnd",keyBinding:new n(35),predefined:true});r.push({actionID:"wordPrevious",keyBinding:new n(37,true),predefined:true});r.push({actionID:"wordNext",keyBinding:new n(39,true),predefined:true});r.push({actionID:"textStart",keyBinding:new n(36,true),predefined:true});r.push({actionID:"textEnd",keyBinding:new n(35,true),predefined:true})}if(t.isFirefox&&t.isLinux){r.push({actionID:"lineUp",keyBinding:new n(38,true),predefined:true});r.push({actionID:"lineDown",keyBinding:new n(40,true),predefined:true})}if(t.isWindows){r.push({actionID:"scrollLineUp",keyBinding:new n(38,true),predefined:true});r.push({actionID:"scrollLineDown",keyBinding:new n(40,true),predefined:true})}r.push({actionID:"selectLineUp",keyBinding:new n(38,null,true),predefined:true});r.push({actionID:"selectLineDown",keyBinding:new n(40,null,true),predefined:true});r.push({actionID:"selectCharPrevious",keyBinding:new n(37,null,true),predefined:true});r.push({actionID:"selectCharNext",keyBinding:new n(39,null,true),predefined:true});r.push({actionID:"selectPageUp",keyBinding:new n(33,null,true),predefined:true});r.push({actionID:"selectPageDown",keyBinding:new n(34,null,true),predefined:true});if(t.isMac){r.push({actionID:"selectLineStart",keyBinding:new n(37,true,true),predefined:true});r.push({actionID:"selectLineEnd",keyBinding:new n(39,true,true),predefined:true});r.push({actionID:"selectWordPrevious",keyBinding:new n(37,null,true,true),predefined:true});r.push({actionID:"selectWordNext",keyBinding:new n(39,null,true,true),predefined:true});r.push({actionID:"selectTextStart",keyBinding:new n(36,null,true),predefined:true});r.push({actionID:"selectTextEnd",keyBinding:new n(35,null,true),predefined:true});r.push({actionID:"selectTextStart",keyBinding:new n(38,true,true),predefined:true});r.push({actionID:"selectTextEnd",keyBinding:new n(40,true,true),predefined:true});r.push({actionID:"selectLineStart",keyBinding:new n(37,null,true,null,true),predefined:true});r.push({actionID:"selectLineEnd",keyBinding:new n(39,null,true,null,true),predefined:true});r.push({actionID:"selectLineStart",keyBinding:new n(38,null,true,true),predefined:true});r.push({actionID:"selectLineEnd",keyBinding:new n(40,null,true,true),predefined:true})}else{if(t.isLinux){r.push({actionID:"selectWholeLineUp",keyBinding:new n(38,true,true),predefined:true});r.push({actionID:"selectWholeLineDown",keyBinding:new n(40,true,true),predefined:true})}r.push({actionID:"selectLineStart",keyBinding:new n(36,null,true),predefined:true});r.push({actionID:"selectLineEnd",keyBinding:new n(35,null,true),predefined:true});r.push({actionID:"selectWordPrevious",keyBinding:new n(37,true,true),predefined:true});r.push({actionID:"selectWordNext",keyBinding:new n(39,true,true),predefined:true});r.push({actionID:"selectTextStart",keyBinding:new n(36,true,true),predefined:true});r.push({actionID:"selectTextEnd",keyBinding:new n(35,true,true),predefined:true})}r.push({actionID:"undo",keyBinding:new e.KeyBinding("z",true),predefined:true});if(t.isMac){r.push({actionID:"redo",keyBinding:new e.KeyBinding("z",true,true),predefined:true})}else{r.push({actionID:"redo",keyBinding:new e.KeyBinding("y",true),predefined:true})}r.push({actionID:"deletePrevious",keyBinding:new n(8),predefined:true});r.push({actionID:"deletePrevious",keyBinding:new n(8,null,true),predefined:true});r.push({actionID:"deleteNext",keyBinding:new n(46),predefined:true});r.push({actionID:"deleteWordPrevious",keyBinding:new n(8,true),predefined:true});r.push({actionID:"deleteWordPrevious",keyBinding:new n(8,true,true),predefined:true});r.push({actionID:"deleteWordNext",keyBinding:new n(46,true),predefined:true});r.push({actionID:"tab",keyBinding:new n(9),predefined:true});r.push({actionID:"shiftTab",keyBinding:new n(9,null,true),predefined:true});r.push({actionID:"enter",keyBinding:new n(13),predefined:true});r.push({actionID:"enter",keyBinding:new n(13,null,true),predefined:true});r.push({actionID:"selectAll",keyBinding:new n("a",true),predefined:true});r.push({actionID:"toggleTabMode",keyBinding:new n("m",true),predefined:true});if(t.isMac){r.push({actionID:"deleteNext",keyBinding:new n(46,null,true),predefined:true});r.push({actionID:"deleteWordPrevious",keyBinding:new n(8,null,null,true),predefined:true});r.push({actionID:"deleteWordNext",keyBinding:new n(46,null,null,true),predefined:true})}r.push({actionID:"toggleWrapMode",keyBinding:new e.KeyBinding("w",true,false,true)});r.push({actionID:"toggleOverwriteMode",keyBinding:new e.KeyBinding(45)});if(!t.isFirefox){var i=t.isMac&&t.isChrome;r.push({actionID:"noop",keyBinding:new n("u",!i,false,false,i),predefined:true});r.push({actionID:"noop",keyBinding:new n("i",!i,false,false,i),predefined:true});r.push({actionID:"noop",keyBinding:new n("b",!i,false,false,i),predefined:true})}if(t.isFirefox){r.push({actionID:"copy",keyBinding:new n(45,true),predefined:true});r.push({actionID:"paste",keyBinding:new n(45,null,true),predefined:true});r.push({actionID:"cut",keyBinding:new n(46,null,true),predefined:true})}if(t.isMac){r.push({actionID:"lineStart",keyBinding:new n("a",false,false,false,true),predefined:true});r.push({actionID:"lineEnd",keyBinding:new n("e",false,false,false,true),predefined:true});r.push({actionID:"lineUp",keyBinding:new n("p",false,false,false,true),predefined:true});r.push({actionID:"lineDown",keyBinding:new n("n",false,false,false,true),predefined:true});r.push({actionID:"charPrevious",keyBinding:new n("b",false,false,false,true),predefined:true});r.push({actionID:"charNext",keyBinding:new n("f",false,false,false,true),predefined:true});r.push({actionID:"deletePrevious",keyBinding:new n("h",false,false,false,true),predefined:true});r.push({actionID:"deleteNext",keyBinding:new n("d",false,false,false,true),predefined:true});r.push({actionID:"deleteLineEnd",keyBinding:new n("k",false,false,false,true),predefined:true});if(t.isFirefox){r.push({actionID:"scrollPageDown",keyBinding:new n("v",false,false,false,true),predefined:true});r.push({actionID:"deleteLineStart",keyBinding:new n("u",false,false,false,true),predefined:true});r.push({actionID:"deleteWordPrevious",keyBinding:new n("w",false,false,false,true),predefined:true})}else{r.push({actionID:"pageDown",keyBinding:new n("v",false,false,false,true),predefined:true});r.push({actionID:"centerLine",keyBinding:new n("l",false,false,false,true),predefined:true});r.push({actionID:"enterNoCursor",keyBinding:new n("o",false,false,false,true),predefined:true})}}return r};return{KeyMode:n,DefaultKeyMode:r}});define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(e,t,n){function s(e){e=e||{};this._document=e.document||document}var r="orion-theme-";var i={};s.getTheme=function(e){e=e||"default";var t=i[e];if(!t){t=i[e]=new s}return t};s.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(e,t){var n=this;var r=n._themeClass;n._themeClass=e;this._load(e,t,function(){n.onThemeChanged({type:"ThemeChanged",oldValue:r,newValue:n.getThemeClass()})})},onThemeChanged:function(e){return this.dispatchEvent(e)},buildStyleSheet:function(e,t){function r(t,r,i){if(r){n.push("."+e+" ."+t+" {");n.push("	"+(i?"background-color":"color")+": "+r+";");n.push("}")}}var n=[];n.push("");n.push("."+e+" {");if(t.fontFamily){n.push("	font-family: "+t.fontFamily+";")}if(t.fontSize){n.push("	font-size: "+t.fontSize+";")}if(t.fontSize){n.push("	color: "+t.text+";")}n.push("}");n.push("."+e+".textview {");if(t.background){n.push("	background-color: "+t.background+";")}n.push("}");r("ruler.annotations",t.annotationRuler,true);r("ruler.lines",t.annotationRuler,true);r("ruler.folding",t.annotationRuler,true);r("ruler.overview",t.overviewRuler,true);r("rulerLines",t.lineNumber,false);r("rulerLines.even",t.lineNumberEven,false);r("rulerLines.odd",t.lineNumberOdd,false);r("annotationLine.currentLine",t.currentLine,true);r("entity-name-tag",t.keyword,false);r("entity-other-attribute-name",t.attribute,false);r("string-quoted",t.string,false);r("line_caret",t.currentLine,true);r("keyword",t.keyword,false);r("string",t.string,false);r("comment",t.comment,false);r("comment.block.documentation",t.comment,false);r("keyword.other.documentation.markup",t.comment,false);return n.join("\n")},_createStyle:function(e,t,i,s){var o=this._document;var u=r+e;var a=o.getElementById(u);if(a){if(s||a.firstChild.data===t){return}a.removeChild(a.firstChild);a.appendChild(o.createTextNode(t))}else{if(s){a=n.createElement(o,"link");a.rel="stylesheet";a.type="text/css";a.href=t;a.addEventListener("load",function(){i()})}else{a=n.createElement(o,"style");a.appendChild(o.createTextNode(t))}a.id=u;var f=o.getElementsByTagName("head")[0]||o.documentElement;f.appendChild(a)}if(!s){i()}},_load:function(t,n,r){if(!t){r();return}if(typeof n==="string"){this._createStyle(t,n,r);return}var i=n.href;var s=".css";if(i.substring(i.length-s.length)!==s){i+=s}if(/^\//.test(i)||/[a-zA-Z0-9]+:\/\//i.test(i)||!e.toUrl){this._createStyle(t,i,r,true)}else{var o=this;e(["text!"+i],function(e){o._createStyle(t,e,r,false)})}}};t.EventTarget.addMixin(s.prototype);return{TextTheme:s}});define("orion/editor/util",[],function(){function e(e,t,n,r){if(typeof e.addEventListener==="function"){e.addEventListener(t,n,r===true)}else{e.attachEvent("on"+t,n)}}function t(e,t,n,r){if(typeof e.removeEventListener==="function"){e.removeEventListener(t,n,r===true)}else{e.detachEvent("on"+t,n)}}function n(e,t){if(!t){return false}if(!e.compareDocumentPosition){var n=t;while(n){if(e===n){return true}n=n.parentNode}return false}return e===t||(e.compareDocumentPosition(t)&16)!==0}return{contains:n,addEventListener:e,removeEventListener:t}});define("orion/editor/textView",["i18n!orion/editor/nls/messages","orion/editor/textModel","orion/editor/keyModes","orion/editor/eventTarget","orion/editor/textTheme","orion/editor/util","orion/util"],function(e,t,n,r,i,s,o){function u(e){return e.defaultView||e.parentWindow}function l(e,t,n){if(n){t.className="";var r=t.attributes;for(var i=r.length;i-->0;){if(!o.isIE||o.isIE>=9||o.isIE<9&&r[i].specified){t.removeAttribute(r[i].name)}}}if(!e){return}if(e.styleClass){t.className=e.styleClass}var s=e.style;if(s){for(var u in s){if(s.hasOwnProperty(u)){t.style[u]=s[u]}}}var a=e.attributes;if(a){for(var f in a){if(a.hasOwnProperty(f)){t.setAttribute(f,a[f])}}}}function c(e){if(e instanceof Array){return e.slice(0)}return e}function h(e,t){if(!e){return t}if(!t){return e}for(var n in t){if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n)){e[n]=t[n]}}}return e}function p(e,t){if(e===t){return true}if(e&&!t||!e&&t){return false}if(e&&e.constructor===String||t&&t.constructor===String){return false}if(e instanceof Array||t instanceof Array){if(!(e instanceof Array&&t instanceof Array)){return false}if(e.length!==t.length){return false}for(var n=0;n<e.length;n++){if(!p(e[n],t[n])){return false}}return true}if(!(e instanceof Object)||!(t instanceof Object)){return false}var r;for(r in e){if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)){return false}if(!p(e[r],t[r])){return false}}}for(r in t){if(!e.hasOwnProperty(r)){return false}}return true}function d(e,t,n){var r=0,i=0,s=0,o=e.length;while(s<o){if(r!==-1&&r<=s){r=e.indexOf("\r",s)}if(i!==-1&&i<=s){i=e.indexOf("\n",s)}var u=s,a;if(i===-1&&r===-1){t(e.substring(s));break}if(r!==-1&&i!==-1){if(r+1===i){a=r;s=i+1}else{a=r<i?r:i;s=(r<i?r:i)+1}}else if(r!==-1){a=r;s=r+1}else{a=i;s=i+1}t(e.substring(u,a));n()}}function v(e){var t,n,r,i;var s=u(e.ownerDocument);if(s.getComputedStyle){var o=s.getComputedStyle(e,null);t=o.getPropertyValue("border-left-width");n=o.getPropertyValue("border-top-width");r=o.getPropertyValue("border-right-width");i=o.getPropertyValue("border-bottom-width")}else if(e.currentStyle){t=e.currentStyle.borderLeftWidth;n=e.currentStyle.borderTopWidth;r=e.currentStyle.borderRightWidth;i=e.currentStyle.borderBottomWidth}return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(i,10)||0}}function m(e){var t,n,r,i;var s=u(e.ownerDocument);if(s.getComputedStyle){var o=s.getComputedStyle(e,null);t=o.getPropertyValue("padding-left");n=o.getPropertyValue("padding-top");r=o.getPropertyValue("padding-right");i=o.getPropertyValue("padding-bottom")}else if(e.currentStyle){t=e.currentStyle.paddingLeft;n=e.currentStyle.paddingTop;r=e.currentStyle.paddingRight;i=e.currentStyle.paddingBottom}return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(i,10)||0}}function g(e){var t=e._trim;if(!t){t=m(e);var n=v(e);t.left+=n.left;t.top+=n.top;t.right+=n.right;t.bottom+=n.bottom;e._trim=t}return t}function b(e,t,n){this.start=e;this.end=t;this.caret=n}function w(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom}function E(e,t,n){this.view=e;this.lineIndex=t;this._lineDiv=n}function S(e){this._init(e||{})}var a=s.addEventListener;var f=s.removeEventListener;var y=function(){function e(e){this.options=e}e.prototype.play=function(){function l(){u=u===-1?(new Date).getTime():u;var t=(new Date).getTime(),l=(t-u)/e;if(l<1){var c=n(l);a=i+c*o;r(a)}else{r(s);f.stop()}}var e=typeof this.options.duration==="number"?this.options.duration:350,t=typeof this.options.rate==="number"?this.options.rate:20,n=this.options.easing||this.defaultEasing,r=this.options.onAnimate||function(){},i=this.options.curve[0],s=this.options.curve[1],o=s-i,u=-1,a,f=this;this.interval=this.options.window.setInterval(l,t)};e.prototype.stop=function(){this.options.window.clearInterval(this.interval);var e=this.options.onEnd||function(){};e()};e.prototype.defaultEasing=function(e){return Math.sin(e*(Math.PI/2))};return e}();b.prototype={clone:function(){return new b(this.start,this.end,this.caret)},collapse:function(){if(this.caret){this.end=this.start}else{this.start=this.end}},extend:function(e){if(this.caret){this.start=e}else{this.end=e}if(this.start>this.end){var t=this.start;this.start=this.end;this.end=t;this.caret=!this.caret}},setCaret:function(e){this.start=e;this.end=e;this.caret=false},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&this.start===e.start&&this.end===e.end}};w.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};E.prototype={create:function(e,t){if(this._lineDiv){return}var n=this._lineDiv=this._createLine(e,t,this.lineIndex);n._line=this;return n},_createLine:function(e,t,n){var r=this.view;var i=r._model;var s=i.getLine(n);var u=i.getLineStart(n);var a={type:"LineStyle",textView:r,lineIndex:n,lineText:s,lineStart:u};if(s.length<2e3){r.onLineStyle(a)}var f=t||o.createElement(e.ownerDocument,"div");if(!t||!p(t.viewStyle,a.style)){l(a.style,f,t);if(t){t._trim=null}f.viewStyle=a.style;f.setAttribute("role","presentation")}f.lineIndex=n;var c=[];var h={tabOffset:0,ranges:c};this._createRanges(a.ranges,s,0,s.length,u,h);var d=" ";if(!r._fullSelection&&o.isIE<9){d="﻿"}var v={text:d,style:r._metrics.largestFontStyle,ignoreChars:1};if(c.length===0||!c[c.length-1].style||c[c.length-1].style.tagName!=="div"){c.push(v)}else{c.splice(c.length-1,0,v)}var m,g,y,b,w,E,S=0,x=0,T;var N,C;if(t){var k=t.modelChangedEvent;if(k){if(k.removedLineCount===0&&k.addedLineCount===0){C=k.start-u;N=k.addedCharCount-k.removedCharCount}else{C=-1}t.modelChangedEvent=undefined}y=t.firstChild}for(var L=0;L<c.length;L++){v=c[L];w=v.text;S+=w.length;g=v.style;if(y){E=y.firstChild.data;b=y.viewStyle;if(E===w&&p(g,b)){x+=E.length;y._rectsCache=undefined;m=y=y.nextSibling;continue}else{while(y){if(C!==-1){var A=S;if(A>=C){A-=N}var O=y.firstChild.data;var M=O?O.length:0;if(x+M>A){break}x+=M}T=y.nextSibling;f.removeChild(y);y=T}}}m=this._createSpan(f,w,g,v.ignoreChars);if(y){f.insertBefore(m,y)}else{f.appendChild(m)}if(t){t.lineWidth=undefined}}if(t){var _=m?m.nextSibling:null;while(_){T=_.nextSibling;t.removeChild(_);_=T}}else{e.appendChild(f)}return f},_createRanges:function(e,t,n,r,i,s){if(n>r){return}if(e){for(var o=0;o<e.length;o++){var u=e[o];if(u.end<i+n){continue}var a=Math.max(i+n,u.start)-i;if(a>r){break}var f=Math.min(i+r,u.end)-i;if(a<=f){a=Math.max(n,a);f=Math.min(r,f);if(n<a){this._createRange(t,n,a,null,s)}if(!u.style||!u.style.unmergeable){while(o+1<e.length&&e[o+1].start-i===f&&p(u.style,e[o+1].style)){u=e[o+1];f=Math.min(i+r,u.end)-i;o++}}this._createRange(t,a,f,u.style,s);n=f}}}if(n<r){this._createRange(t,n,r,null,s)}},_createRange:function(e,t,n,r,i){if(t>n){return}var s=this.view._customTabSize,o;if(s&&s!==8){var u=e.indexOf("	",t);while(u!==-1&&u<n){if(t<u){o={text:e.substring(t,u),style:r};i.ranges.push(o);i.tabOffset+=o.text.length}var a=s-i.tabOffset%s;if(a>0){var f=" ";for(var l=1;l<a;l++){f+=" "}o={text:f,style:r,ignoreChars:a-1};i.ranges.push(o);i.tabOffset+=o.text.length}t=u+1;if(t===n){return}u=e.indexOf("	",t)}}if(t<=n){o={text:e.substring(t,n),style:r};i.ranges.push(o);i.tabOffset+=o.text.length}},_createSpan:function(e,t,n,r){var i=this.view;var s="span";if(n&&n.tagName){s=n.tagName.toLowerCase()}var u=s==="a";if(u){e.hasLink=true}if(u&&!i._linksVisible){s="span"}var f=e.ownerDocument;var c=o.createElement(e.ownerDocument,s);if(n&&n.html){c.innerHTML=n.html;c.ignore=true}else if(n&&n.node){c.appendChild(n.node);c.ignore=true}else{c.appendChild(f.createTextNode(n&&n.text?n.text:t))}l(n,c);if(s==="a"){var h=i._getWindow();a(c,"click",function(e){return i._handleLinkClick(e?e:h.event)},false)}c.viewStyle=n;if(r){c.ignoreChars=r}return c},_ensureCreated:function(){if(this._lineDiv){return this._lineDiv}return this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,t){var n=this._ensureCreated();var r=this.view;if(e===undefined){return this._getLineBoundingClientRect(n,true)}var i=r._model;var s=n.ownerDocument;var a=this.lineIndex;var f=null;if(e<i.getLineEnd(a)){var l=i.getLineStart(a);var c=n.firstChild;while(c){if(c.ignore){c=c.nextSibling;continue}var h=c.firstChild;var p=h.length;if(c.ignoreChars){p-=c.ignoreChars}if(l+p>e){var d=e-l;var v;if(h.length===1){f=new w(c.getBoundingClientRect())}else if(r._isRangeRects){v=s.createRange();v.setStart(h,d);v.setEnd(h,d+1);f=new w(v.getBoundingClientRect())}else if(o.isIE){v=s.body.createTextRange();v.moveToElementText(c);v.collapse();var m=d===0&&o.isIE===8;if(m){d=1}v.moveEnd("character",d+1);v.moveStart("character",d);f=new w(v.getBoundingClientRect());if(m){f.left=c.getClientRects()[0].left}}else{var g=h.data;c.removeChild(h);c.appendChild(s.createTextNode(g.substring(0,d)));var y=o.createElement(s,"span");y.appendChild(s.createTextNode(g.substring(d,d+1)));c.appendChild(y);c.appendChild(s.createTextNode(g.substring(d+1)));f=new w(y.getBoundingClientRect());c.innerHTML="";c.appendChild(h);if(!this._createdDiv){var b=r._getSelection();if(l<=b.start&&b.start<l+p||l<=b.end&&b.end<l+p){r._updateDOMSelection()}}}if(o.isIE){var E=u(n.ownerDocument);var S=E.screen.logicalXDPI/E.screen.deviceXDPI;var x=E.screen.logicalYDPI/E.screen.deviceYDPI;f.left=f.left*S;f.right=f.right*S;f.top=f.top*x;f.bottom=f.bottom*x}break}l+=p;c=c.nextSibling}}var T=this.getBoundingClientRect();if(!f){if(r._wrapMode){var N=this.getClientRects();f=N[N.length-1];f.left=f.right;f.left+=T.left;f.top+=T.top;f.right+=T.left;f.bottom+=T.top}else{f=new w(T);f.left=f.right}}if(t||t===undefined){f.left-=T.left;f.top-=T.top;f.right-=T.left;f.bottom-=T.top}return f},_getClientRects:function(e,t){var n,r,i,s;if(!e._rectsCache){n=e.getClientRects();r=new Array(n.length);for(s=0;s<n.length;s++){i=r[s]=new w(n[s]);i.left-=t.left;i.top-=t.top;i.right-=t.left;i.bottom-=t.top}e._rectsCache=r}n=e._rectsCache;r=[n.length];for(s=0;s<n.length;s++){r[s]=new w(n[s])}return r},getClientRects:function(e){if(!this.view._wrapMode){return[this.getBoundingClientRect()]}var t=this._ensureCreated();var n=[];var r=t.firstChild,i,s,o=t.getBoundingClientRect();while(r){if(r.ignore){r=r.nextSibling;continue}var u=this._getClientRects(r,o);for(i=0;i<u.length;i++){var a=u[i],f;if(a.top===a.bottom){continue}var l=a.top+(a.bottom-a.top)/2;for(f=0;f<n.length;f++){s=n[f];if(s.top<=l&&l<s.bottom){break}}if(f===n.length){n.push(a)}else{if(a.left<s.left){s.left=a.left}if(a.top<s.top){s.top=a.top}if(a.right>s.right){s.right=a.right}if(a.bottom>s.bottom){s.bottom=a.bottom}}}r=r.nextSibling}if(e!==undefined){return n[e]}return n},_getLineBoundingClientRect:function(e,t){var n=new w(e.getBoundingClientRect());if(this.view._wrapMode){}else{n.right=n.left;var r=e.lastChild;while(r&&r.ignoreChars===r.firstChild.length){r=r.previousSibling}if(r){var i=r.getBoundingClientRect();n.right=i.right+g(e).right}}if(t){var s=g(e);n.left=n.left+s.left;n.right=n.right-s.right}return n},getLineCount:function(){if(!this.view._wrapMode){return 1}return this.getClientRects().length},getLineIndex:function(e){if(!this.view._wrapMode){return 0}var t=this.getClientRects();var n=this.getBoundingClientRect(e);var r=n.top+(n.bottom-n.top)/2;for(var i=0;i<t.length;i++){if(t[i].top<=r&&r<t[i].bottom){return i}}return t.length-1},getLineStart:function(e){if(!this.view._wrapMode||e===0){return this.view._model.getLineStart(e)}var t=this.getClientRects();return this.getOffset(t[e].left+1,t[e].top+1)},getOffset:function(e,t){var n=this.view;var r=n._model;var i=this.lineIndex;var s=r.getLineStart(i);var a=r.getLineEnd(i);if(s===a){return s}var f=this._ensureCreated();var l=this.getBoundingClientRect(),c,h;if(n._wrapMode){c=this.getClientRects();if(t<c[0].top){t=c[0].top}for(var p=0;p<c.length;p++){h=c[p];if(h.top<=t&&t<h.bottom){break}}if(e<h.left){e=h.left}if(e>h.right){e=h.right-1}}else{if(e<0){e=0}if(e>l.right-l.left){e=l.right-l.left}}var d=f.ownerDocument;var v=u(d);var m=o.isIE?v.screen.logicalXDPI/v.screen.deviceXDPI:1;var g=o.isIE?v.screen.logicalYDPI/v.screen.deviceYDPI:1;var y=s;var b=f.firstChild;e:while(b){if(b.ignore){b=b.nextSibling;continue}var w=b.firstChild;var E=w.length;if(b.ignoreChars){E-=b.ignoreChars}var S,x,T,N;c=this._getClientRects(b,l);for(var C=0;C<c.length;C++){h=c[C];if(h.left<=e&&e<h.right&&(!n._wrapMode||h.top<=t&&t<h.bottom)){var k,L,A;var O=h.left+l.left,M;if(o.isIE||n._isRangeRects){k=n._isRangeRects?d.createRange():d.body.createTextRange();var _=E;var D=-1;while(_-D>1){var P=Math.floor((_+D)/2);L=D+1;A=P===E-1&&b.ignoreChars?w.length:P+1;M=L===0&&o.isIE===8;if(n._isRangeRects){k.setStart(w,L);k.setEnd(w,A)}else{if(M){L=1}k.moveToElementText(b);k.move("character",L);k.moveEnd("character",A-L)}c=k.getClientRects();var H=false;for(var B=0;B<c.length;B++){h=c[B];S=(M?O:h.left)*m-l.left;T=h.right*m-l.left;x=h.top*g-l.top;N=h.bottom*g-l.top;if(S<=e&&e<T&&(!n._wrapMode||x<=t&&t<N)){H=true;break}}if(H){_=P}else{D=P}}y+=_;L=_;A=_===E-1&&b.ignoreChars?w.length:Math.min(_+1,w.length);if(n._isRangeRects){k.setStart(w,L);k.setEnd(w,A)}else{k.moveToElementText(b);k.move("character",L);k.moveEnd("character",A-L)}c=k.getClientRects();var j=false;if(c.length>0){h=c[0];S=(M?O:h.left)*m-l.left;T=h.right*m-l.left;j=e>S+(T-S)/2}var F=y-s;var I=r.getLine(i);var q=I.charCodeAt(F);if(55296<=q&&q<=56319&&j){if(F<I.length){q=I.charCodeAt(F+1);if(56320<=q&&q<=57343){y+=1}}}else if(56320<=q&&q<=57343&&!j){if(F>0){q=I.charCodeAt(F-1);if(55296<=q&&q<=56319){y-=1}}}if(j){y++}}else{var R=[];for(var U=0;U<E;U++){R.push("<span>");if(U===E-1){R.push(w.data.substring(U))}else{R.push(w.data.substring(U,U+1))}R.push("</span>")}b.innerHTML=R.join("");var z=b.firstChild;while(z){h=z.getBoundingClientRect();S=h.left-l.left;T=h.right-l.left;if(S<=e&&e<T){if(e>S+(T-S)/2){y++}break}y++;z=z.nextSibling}if(!this._createdDiv){b.innerHTML="";b.appendChild(w);var W=n._getSelection();if(y<=W.start&&W.start<y+E||y<=W.end&&W.end<y+E){n._updateDOMSelection()}}}break e}}y+=E;b=b.nextSibling}return Math.min(a,Math.max(s,y))},getNextOffset:function(e,t){if(t.unit==="line"){var n=this.view;var r=n._model;var i=r.getLineAtOffset(e);if(t.count>0){t.count--;return r.getLineEnd(i)}t.count++;return r.getLineStart(i)}if(t.unit==="wordend"||t.unit==="wordWS"||t.unit==="wordendWS"){return this._getNextOffset_W3C(e,t)}return o.isIE?this._getNextOffset_IE(e,t):this._getNextOffset_W3C(e,t)},_getNextOffset_W3C:function(e,t){function n(e){return 33<=e&&e<=47||58<=e&&e<=64||91<=e&&e<=94||e===96||123<=e&&e<=126}function r(e){return e===32||e===9}var i=this.view;var s=i._model;var o=s.getLineAtOffset(e);var u=s.getLine(o);var a=s.getLineStart(o);var f=s.getLineEnd(o);var l=u.length;var c=e-a;var h;var p=t.count<0?-1:1;if(t.unit==="word"||t.unit==="wordend"||t.unit==="wordWS"||t.unit==="wordendWS"){var d,v,m,g;while(t.count!==0){if(t.count>0){if(c===l){return f}h=u.charCodeAt(c);d=n(h);v=!d&&!r(h);c++;while(c<l){h=u.charCodeAt(c);if(t.unit!=="wordWS"&&t.unit!=="wordendWS"){m=n(h);if(t.unit==="wordend"){if(!m&&d){break}}else{if(m&&!d){break}}g=!m&&!r(h)}else{g=!r(h)}if(t.unit==="wordend"||t.unit==="wordendWS"){if(!g&&v){break}}else{if(g&&!v){break}}v=g;d=m;c++}}else{if(c===0){return a}c--;h=u.charCodeAt(c);d=n(h);v=!d&&!r(h);while(0<c){h=u.charCodeAt(c-1);if(t.unit!=="wordWS"&&t.unit!=="wordendWS"){m=n(h);if(t.unit==="wordend"){if(m&&!d){break}}else{if(!m&&d){break}}g=!m&&!r(h)}else{g=!r(h)}if(t.unit==="wordend"||t.unit==="wordendWS"){if(g&&!v){break}}else{if(!g&&v){break}}v=g;d=m;c--}if(c===0){}}t.count-=p}}else{while(t.count!==0&&0<=c+p&&c+p<=l){c+=p;h=u.charCodeAt(c);if(56320<=h&&h<=57343){if(c>0){h=u.charCodeAt(c-1);if(55296<=h&&h<=56319){c+=p}}}t.count-=p}}return a+c},_getNextOffset_IE:function(e,t){var n=this._ensureCreated();var r=this.view;var i=r._model;var s=this.lineIndex;var o=0,u,a;var f=i.getLineStart(s);var l=n.ownerDocument;var c;var h=t.count<0?-1:1;if(e===i.getLineEnd(s)){c=n.lastChild;while(c&&c.ignoreChars===c.firstChild.length){c=c.previousSibling}if(!c){return f}u=l.body.createTextRange();u.moveToElementText(c);a=u.text.length;u.moveEnd(t.unit,h);o=e+u.text.length-a}else if(e===f&&t.count<0){o=f}else{c=n.firstChild;while(c){var p=c.firstChild;var d=p.length;if(c.ignoreChars){d-=c.ignoreChars}if(f+d>e){u=l.body.createTextRange();if(e===f&&t.count<0){u.moveToElementText(c.previousSibling)}else{u.moveToElementText(c);u.collapse();u.moveEnd("character",e-f)}a=u.text.length;u.moveEnd(t.unit,h);o=e+u.text.length-a;break}f=d+f;c=c.nextSibling}}t.count-=h;return o},destroy:function(){var e=this._createdDiv;if(e){e.parentNode.removeChild(e);this._createdDiv=null}}};S.prototype={addKeyMode:function(e,t){var n=this._keyModes;if(t!==undefined){n.splice(t,0,e)}else{n.push(e)}if(e._modeAdded){e._modeAdded()}},addRuler:function(e,t){e.setView(this);var n=this._rulers;if(t!==undefined){var r,i;for(r=0,i=0;r<n.length&&i<t;r++){if(e.getLocation()===n[r].getLocation()){i++}}n.splice(i,0,e);t=i}else{n.push(e)}this._createRuler(e,t);this._update()},computeSize:function(){var e=0,t=0;var n=this._model,r=this._clientDiv;if(!r){return{width:e,height:t}}var i=r.style.width;if(o.isWebkit){r.style.width="0x7fffffffpx"}var s=n.getLineCount();for(var u=0;u<s;u++){var a=this._getLine(u);var f=a.getBoundingClientRect();e=Math.max(e,f.right-f.left);t+=f.bottom-f.top;a.destroy()}if(o.isWebkit){r.style.width=i}var l=this._getViewPadding();e+=l.right+l.left+this._metrics.scrollWidth;t+=l.bottom+l.top+this._metrics.scrollWidth;return{width:e,height:t}},convert:function(e,t,n){if(!this._clientDiv){return}var r=this._getScroll();var i=this._getViewPadding();var s=this._viewDiv.getBoundingClientRect();if(t==="document"){if(e.x!==undefined){e.x+=-r.x+s.left+i.left}if(e.y!==undefined){e.y+=-r.y+s.top+i.top}}if(n==="document"){if(e.x!==undefined){e.x+=r.x-s.left-i.left}if(e.y!==undefined){e.y+=r.y-s.top-i.top}}return e},destroy:function(){for(var e=0;e<this._rulers.length;e++){this._rulers[e].setView(null)}this.rulers=null;this._destroyView();var t={type:"Destroy"};this.onDestroy(t);this._parent=null;if(this._model&&this._model.destroy){this._model.destroy()}this._model=null;this._theme=null;this._selection=null;this._doubleClickSelection=null;this._keyModes=null;this._actions=null},focus:function(){if(!this._clientDiv){return}this._updateDOMSelection();this._clientDiv.focus();this._updateDOMSelection()},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){var t=this._actions[e];if(t){return t.actionDescription}return undefined},getActions:function(e){var t=[];var n=this._actions;for(var r in n){if(n.hasOwnProperty(r)){if(!e&&n[r].defaultHandler){continue}t.push(r)}}return t},getBottomIndex:function(e){if(!this._clientDiv){return 0}return this._getBottomIndex(e)},getBottomPixel:function(){if(!this._clientDiv){return 0}return this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){var e=this._getSelection();return e.getCaret()},getClientArea:function(){if(!this._clientDiv){return{x:0,y:0,width:0,height:0}}var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){if(!this._clientDiv){return 0}return this._getScroll().x},getKeyBindings:function(e){var t=[];var n=this._keyModes;for(var r=0;r<n.length;r++){t=t.concat(n[r].getKeyBindings(e))}return t},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(e){if(!this._clientDiv){return 0}return this._getLineHeight(e)},getLineIndex:function(e){if(!this._clientDiv){return 0}return this._getLineIndex(e)},getLinePixel:function(e){if(!this._clientDiv){return 0}return this._getLinePixel(e)},getLocationAtOffset:function(e){if(!this._clientDiv){return{x:0,y:0}}var t=this._model;e=Math.min(Math.max(0,e),t.getCharCount());var n=t.getLineAtOffset(e);var r=this._getLine(n);var i=r.getBoundingClientRect(e);r.destroy();var s=i.left;var o=this._getLinePixel(n)+i.top;return{x:s,y:o}},getNextOffset:function(e,t){var n=new b(e,e,false);this._doMove(t,n);return n.getCaret()},getOptions:function(){var e;if(arguments.length===0){e=this._defaultOptions()}else if(arguments.length===1){var t=arguments[0];if(typeof t==="string"){return c(this["_"+t])}e=t}else{e={};for(var n in arguments){if(arguments.hasOwnProperty(n)){e[arguments[n]]=undefined}}}for(var r in e){if(e.hasOwnProperty(r)){e[r]=c(this["_"+r])}}return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,t){if(!this._clientDiv){return 0}var n=this._getLineIndex(t);var r=this._getLine(n);var i=r.getOffset(e,t-this._getLinePixel(n));r.destroy();return i},getLineAtOffset:function(e){this.getModel().getLineAtOffset(e)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var e=this._getSelection();return{start:e.start,end:e.end}},getText:function(e,t){var n=this._model;return n.getText(e,t)},getTopIndex:function(e){if(!this._clientDiv){return 0}return this._getTopIndex(e)},getTopPixel:function(){if(!this._clientDiv){return 0}return this._getScroll().y},invokeAction:function(e,t,n){if(!this._clientDiv){return}var r=this._actions[e];if(r){if(!t&&r.handler){if(r.handler(n)){return true}}if(r.defaultHandler){return typeof r.defaultHandler(n)==="boolean"}}return false},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onKeyDown:function(e){return this.dispatchEvent(e)},onKeyPress:function(e){return this.dispatchEvent(e)},onKeyUp:function(e){return this.dispatchEvent(e)},onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},redraw:function(){if(this._redrawCount>0){return}var e=this._model.getLineCount();this.redrawRulers(0,e);this.redrawLines(0,e)},redrawRulers:function(e,t){if(this._redrawCount>0){return}var n=this.getRulers();for(var r=0;r<n.length;r++){this.redrawLines(e,t,n[r])}},redrawLines:function(e,t,n){if(this._redrawCount>0){return}if(e===undefined){e=0}if(t===undefined){t=this._model.getLineCount()}if(e===t){return}var r=this._clientDiv;if(!r){return}if(n){var i=this._getRulerParent(n);r=i.firstChild;while(r){if(r._ruler===n){break}r=r.nextSibling}}if(n){r.rulerChanged=true}else{if(this._lineHeight){this._resetLineHeight(e,t)}}if(!n||n.getOverview()==="page"){var s=r.firstChild;while(s){var o=s.lineIndex;if(e<=o&&o<t){s.lineChanged=true}s=s.nextSibling}}if(!n){if(!this._wrapMode){if(e<=this._maxLineIndex&&this._maxLineIndex<t){this._checkMaxLineIndex=this._maxLineIndex;this._maxLineIndex=-1;this._maxLineWidth=0}}}this._queueUpdate()},redrawRange:function(e,t){if(this._redrawCount>0){return}var n=this._model;if(e===undefined){e=0}if(t===undefined){t=n.getCharCount()}var r=n.getLineAtOffset(e);var i=n.getLineAtOffset(Math.max(e,t-1))+1;this.redrawLines(r,i)},removeKeyMode:function(e){var t=this._keyModes;for(var n=0;n<t.length;n++){if(t[n]===e){t.splice(n,1);break}}if(e._modeRemoved){e._modeRemoved()}},removeRuler:function(e){var t=this._rulers;for(var n=0;n<t.length;n++){if(t[n]===e){t.splice(n,1);e.setView(null);this._destroyRuler(e);this._update();break}}},resize:function(){if(!this._clientDiv){return}this._handleResize(null)},setAction:function(e,t,n){if(!e){return}var r=this._actions;var i=r[e];if(!i){i=r[e]={}}i.handler=t;if(n!==undefined){i.actionDescription=n}},setKeyBinding:function(e,t){this._keyModes[0].setKeyBinding(e,t)},setCaretOffset:function(e,t,n){var r=this._model.getCharCount();e=Math.max(0,Math.min(e,r));var i=new b(e,e,false);this._setSelection(i,t===undefined||t,true,n)},setHorizontalPixel:function(e){if(!this._clientDiv){return}e=Math.max(0,e);this._scrollView(e-this._getScroll().x,0)},setRedraw:function(e){if(e){if(--this._redrawCount===0){this.redraw()}}else{this._redrawCount++}},setModel:function(e){if(!e){return}if(e===this._model){return}this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var t=this._model.getLineCount();var n=this._model.getCharCount();var r=e.getLineCount();var i=e.getCharCount();var s=e.getText();var o={type:"ModelChanging",text:s,start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r};this.onModelChanging(o);this._model=e;o={type:"ModelChanged",start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r};this.onModelChanged(o);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()},setOptions:function(e){var t=this._defaultOptions();for(var n in e){if(e.hasOwnProperty(n)){var r=e[n],i=this["_"+n];if(p(i,r)){continue}var s=t[n]?t[n].update:null;if(s){s.call(this,r);continue}this["_"+n]=c(r)}}},setSelection:function(e,t,n,r){var i=e>t;if(i){var s=e;e=t;t=s}var o=this._model.getCharCount();e=Math.max(0,Math.min(e,o));t=Math.max(0,Math.min(t,o));var u=new b(e,t,i);this._setSelection(u,n===undefined||n,true,r)},setText:function(e,t,n){var r=t===undefined&&n===undefined;if(t===undefined){t=0}if(n===undefined){n=this._model.getCharCount()}if(r){this._variableLineHeight=false}this._modifyContent({text:e,start:t,end:n,_code:true},!r);if(r){this._columnX=-1;this._setSelection(new b(0,0,false),true);if(o.isFirefox){this._fixCaret()}}},setTopIndex:function(e){if(!this._clientDiv){return}this._scrollView(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y)},setTopPixel:function(e){if(!this._clientDiv){return}this._scrollView(0,Math.max(0,e)-this._getScroll().y)},showSelection:function(){return this._showCaret(true)},update:function(e,t){if(!this._clientDiv){return}if(e){this._updateStyle()}if(t===undefined||t){this._update()}else{this._queueUpdate()}},_handleRootMouseDown:function(e){if(this._ignoreEvent(e)){return}if(o.isFirefox&&e.which===1){this._clientDiv.contentEditable=false;(this._overlayDiv||this._clientDiv).draggable=true;this._ignoreBlur=true}var t=this._overlayDiv||this._clientDiv;if(o.isIE<9){t=this._viewDiv}var n=e.target?e.target:e.srcElement;while(n){if(t===n){return}n=n.parentNode}if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}if(!this._isW3CEvents){var r=this;var i=this._getWindow();i.setTimeout(function(){r._clientDiv.focus()},0)}},_handleRootMouseUp:function(e){if(this._ignoreEvent(e)){return}if(o.isFirefox&&e.which===1){this._clientDiv.contentEditable=true;(this._overlayDiv||this._clientDiv).draggable=false;this._fixCaret();this._ignoreBlur=false}},_handleBlur:function(e){if(this._ignoreBlur){return}this._hasFocus=false;if(o.isIE<9){if(!this._getSelection().isEmpty()){var t=this._rootDiv;var n=o.createElement(t.ownerDocument,"div");t.appendChild(n);t.removeChild(n)}}if(this._cursorDiv){this._cursorDiv.style.display="none"}if(this._selDiv1){var r="lightgray";this._selDiv1.style.background=r;this._selDiv2.style.background=r;this._selDiv3.style.background=r;var i;var s=this._getWindow();var u=this._selDiv1.ownerDocument;if(s.getSelection){var a=s.getSelection();i=a.anchorNode;while(i){if(i===this._clientDiv){if(a.rangeCount>0){a.removeAllRanges()}break}i=i.parentNode}}else if(u.selection){this._ignoreSelect=false;i=u.selection.createRange().parentElement();while(i){if(i===this._clientDiv){u.selection.empty();break}i=i.parentNode}this._ignoreSelect=true}}if(!this._ignoreFocus){this.onBlur({type:"Blur"})}},_handleContextMenu:function(e){if(this._ignoreEvent(e)){return}if(o.isIE&&this._lastMouseButton===3){this._updateDOMSelection()}var t=false;if(this.isListening("ContextMenu")){var n=this._createMouseEvent("ContextMenu",e);n.screenX=e.screenX;n.screenY=e.screenY;this.onContextMenu(n);t=n.defaultPrevented}else if(o.isMac&&o.isFirefox&&e.button===0){t=true}if(t){if(e.preventDefault){e.preventDefault()}return false}},_handleCopy:function(e){if(this._ignoreEvent(e)){return}if(this._ignoreCopy){return}if(this._doCopy(e)){if(e.preventDefault){e.preventDefault()}return false}},_handleCut:function(e){if(this._ignoreEvent(e)){return}if(this._doCut(e)){if(e.preventDefault){e.preventDefault()}return false}},_handleDataModified:function(e){if(this._ignoreEvent(e)){return}this._startIME()},_handleDblclick:function(e){if(this._ignoreEvent(e)){return}var t=e.timeStamp?e.timeStamp:(new Date).getTime();this._lastMouseTime=t;if(this._clickCount!==2){this._clickCount=2;this._handleMouse(e)}},_handleDragStart:function(e){if(this._ignoreEvent(e)){return}if(o.isFirefox){var t=this;var n=this._getWindow();n.setTimeout(function(){t._clientDiv.contentEditable=true;t._clientDiv.draggable=false;t._ignoreBlur=false},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1){this._isMouseDown=false;this.onDragStart(this._createMouseEvent("DragStart",e));this._dragOffset=-1}else{if(e.preventDefault){e.preventDefault()}return false}},_handleDrag:function(e){if(this._ignoreEvent(e)){return}if(this.isListening("Drag")){this.onDrag(this._createMouseEvent("Drag",e))}},_handleDragEnd:function(e){if(this._ignoreEvent(e)){return}this._dropTarget=false;this._dragOffset=-1;if(this.isListening("DragEnd")){this.onDragEnd(this._createMouseEvent("DragEnd",e))}if(o.isFirefox){this._fixCaret();if(e.dataTransfer.dropEffect==="none"&&!e.dataTransfer.mozUserCancelled){this._fixCaret()}}},_handleDragEnter:function(e){if(this._ignoreEvent(e)){return}var t=true;this._dropTarget=true;if(this.isListening("DragEnter")){t=false;this.onDragEnter(this._createMouseEvent("DragEnter",e))}if(o.isWebkit||t){if(e.preventDefault){e.preventDefault()}return false}},_handleDragOver:function(e){if(this._ignoreEvent(e)){return}var t=true;if(this.isListening("DragOver")){t=false;this.onDragOver(this._createMouseEvent("DragOver",e))}if(o.isWebkit||t){if(t){e.dataTransfer.dropEffect="none"}if(e.preventDefault){e.preventDefault()}return false}},_handleDragLeave:function(e){if(this._ignoreEvent(e)){return}this._dropTarget=false;if(this.isListening("DragLeave")){this.onDragLeave(this._createMouseEvent("DragLeave",e))}},_handleDrop:function(e){if(this._ignoreEvent(e)){return}this._dropTarget=false;if(this.isListening("Drop")){this.onDrop(this._createMouseEvent("Drop",e))}if(e.preventDefault){e.preventDefault()}return false},_handleFocus:function(e){this._hasFocus=true;if(o.isIOS&&this._lastTouchOffset!==undefined){this.setCaretOffset(this._lastTouchOffset,true);this._lastTouchOffset=undefined}else{this._updateDOMSelection()}if(this._cursorDiv){this._cursorDiv.style.display="block"}if(this._selDiv1){var t=this._highlightRGB;this._selDiv1.style.background=t;this._selDiv2.style.background=t;this._selDiv3.style.background=t}if(!this._ignoreFocus){this.onFocus({type:"Focus"})}},_handleKeyDown:function(e){if(this._ignoreEvent(e)){return}if(this.isListening("KeyDown")){var t=this._createKeyEvent("KeyDown",e);this.onKeyDown(t);if(t.defaultPrevented){if(o.isFirefox){this._keyDownPrevented=true}e.preventDefault();return}}var n=false;switch(e.keyCode){case 16:case 17:case 18:case 91:n=true;break;default:this._setLinksVisible(false)}if(e.keyCode===229){if(this._readonly){if(e.preventDefault){e.preventDefault()}return false}var r=true;if(o.isSafari&&o.isMac){if(e.ctrlKey){r=false;e.keyCode=129}}if(r){this._startIME()}}else{if(!n){this._commitIME()}}if((o.isMac||o.isLinux)&&o.isFirefox<4||o.isOpera<12.16){this._keyDownEvent=e;return true}if(this._doAction(e)){if(e.preventDefault){e.preventDefault();e.stopPropagation()}else{e.cancelBubble=true;e.returnValue=false;e.keyCode=0}return false}},_handleKeyPress:function(e){if(this._ignoreEvent(e)){return}if(this._keyDownPrevented){if(e.preventDefault){e.preventDefault();e.stopPropagation()}this._keyDownPrevented=undefined;return}if(o.isMac&&o.isWebkit){if(63232<=e.keyCode&&e.keyCode<=63487||e.keyCode===13||e.keyCode===8){if(e.preventDefault){e.preventDefault()}return false}}if((o.isMac||o.isLinux)&&o.isFirefox<4||o.isOpera<12.16){if(this._doAction(this._keyDownEvent)){if(e.preventDefault){e.preventDefault()}return false}}var t=o.isMac?e.metaKey:e.ctrlKey;if(e.charCode!==undefined){if(t){switch(e.charCode){case 99:case 118:case 120:return true}}}if(this.isListening("KeyPress")){var n=this._createKeyEvent("KeyPress",e);this.onKeyPress(n);if(n.defaultPrevented){e.preventDefault();return}}if(this._doAction(e)){if(e.preventDefault){e.preventDefault();e.stopPropagation()}else{e.cancelBubble=true;e.returnValue=false;e.keyCode=0}return false}var r=false;if(o.isMac){if(e.ctrlKey||e.metaKey){r=true}}else{if(o.isFirefox){if(e.ctrlKey||e.altKey){r=true}}else{if(e.ctrlKey^e.altKey){r=true}}}if(!r){var i=o.isOpera?e.which:e.charCode!==undefined?e.charCode:e.keyCode;if(i>31){this._doContent(String.fromCharCode(i));if(e.preventDefault){e.preventDefault()}return false}}},_handleDocKeyUp:function(e){var t=o.isMac?e.metaKey:e.ctrlKey;if(!t){this._setLinksVisible(false)}},_handleKeyUp:function(e){if(this._ignoreEvent(e)){return}if(this.isListening("KeyUp")){var t=this._createKeyEvent("KeyUp",e);this.onKeyUp(t);if(t.defaultPrevented){e.preventDefault();return}}this._handleDocKeyUp(e);if(e.keyCode===13){this._commitIME()}},_handleLinkClick:function(e){var t=o.isMac?e.metaKey:e.ctrlKey;if(!t){if(e.preventDefault){e.preventDefault()}return false}},_handleMouse:function(e){var t=this._getWindow();var n=true;var r=t;if(o.isIE||o.isFirefox&&!this._overlayDiv){r=this._clientDiv}if(this._overlayDiv){if(this._hasFocus){this._ignoreFocus=true}var i=this;t.setTimeout(function(){i.focus();i._ignoreFocus=false},0)}if(this._clickCount===1){n=this._setSelectionTo(e.clientX,e.clientY,e.shiftKey,(!o.isOpera||o.isOpera>=12.16)&&this._hasFocus&&this.isListening("DragStart"));if(n){this._setGrab(r)}}else{if(this._isW3CEvents){this._setGrab(r)}this._doubleClickSelection=null;this._setSelectionTo(e.clientX,e.clientY,e.shiftKey);this._doubleClickSelection=this._getSelection()}return n},_handleMouseDown:function(e){if(this._ignoreEvent(e)){return}if(this._linksVisible){var t=e.target||e.srcElement;if(t.tagName!=="A"){this._setLinksVisible(false)}else{return}}this._commitIME();var n=e.which;if(!n){if(e.button===4){n=2}if(e.button===2){n=3}if(e.button===1){n=1}}var r=n!==2&&e.timeStamp?e.timeStamp:(new Date).getTime();var i=r-this._lastMouseTime;var s=Math.abs(this._lastMouseX-e.clientX);var u=Math.abs(this._lastMouseY-e.clientY);var a=this._lastMouseButton===n;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._lastMouseTime=r;this._lastMouseButton=n;if(n===1){this._isMouseDown=true;if(a&&i<=this._clickTime&&s<=this._clickDist&&u<=this._clickDist){this._clickCount++}else{this._clickCount=1}}if(this.isListening("MouseDown")){var f=this._createMouseEvent("MouseDown",e);this.onMouseDown(f);if(f.defaultPrevented){e.preventDefault();return}}if(n===1){if(this._handleMouse(e)&&(o.isIE>=9||o.isOpera||o.isChrome||o.isSafari||o.isFirefox&&!this._overlayDiv)){if(!this._hasFocus){this.focus()}e.preventDefault()}}if(o.isFirefox&&this._lastMouseButton===3){this._updateDOMSelection()}},_handleMouseOver:function(e){if(this._ignoreEvent(e)){return}if(this._animation){return}if(this.isListening("MouseOver")){this.onMouseOver(this._createMouseEvent("MouseOver",e))}},_handleMouseOut:function(e){if(this._ignoreEvent(e)){return}if(this._animation){return}if(this.isListening("MouseOut")){this.onMouseOut(this._createMouseEvent("MouseOut",e))}},_handleMouseMove:function(e){if(this._animation){return}var t=this._isClientDiv(e);if(this.isListening("MouseMove")){if(t){this.onMouseMove(this._createMouseEvent("MouseMove",e))}}if(this._dropTarget){return}var n=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;this._lastMouseMoveX=e.clientX;this._lastMouseMoveY=e.clientY;this._setLinksVisible(n&&!this._isMouseDown&&(o.isMac?e.metaKey:e.ctrlKey));if(!this._isW3CEvents){if(e.button===0){this._setGrab(null);return true}if(!this._isMouseDown&&e.button===1&&(this._clickCount&1)!==0&&t){this._clickCount=2;return this._handleMouse(e,this._clickCount)}}if(!this._isMouseDown||this._dragOffset!==-1){return}var r=e.clientX;var i=e.clientY;var s=this._getViewPadding();var u=this._viewDiv.getBoundingClientRect();var a=this._getClientWidth(),f=this._getClientHeight();var l=u.left+s.left;var c=u.top+s.top;var h=u.left+s.left+a;var p=u.top+s.top+f;if(i<c){this._doAutoScroll("up",r,i-c)}else if(i>p){this._doAutoScroll("down",r,i-p)}else if(r<l&&!this._wrapMode){this._doAutoScroll("left",r-l,i)}else if(r>h&&!this._wrapMode){this._doAutoScroll("right",r-h,i)}else{this._endAutoScroll();this._setSelectionTo(r,i,true)}},_isClientDiv:function(e){var t=this._overlayDiv||this._clientDiv;var n=e.target?e.target:e.srcElement;while(n){if(t===n){return true}n=n.parentNode}return false},_createKeyEvent:function(e,t){return{type:e,event:t,preventDefault:function(){this.defaultPrevented=true}}},_createMouseEvent:function(e,t){var n=this.convert({x:t.clientX,y:t.clientY},"page","document");return{type:e,event:t,clickCount:this._clickCount,x:n.x,y:n.y,preventDefault:function(){this.defaultPrevented=true}}},_handleMouseUp:function(e){var t=e.which?e.button===0:e.button===1;if(this.isListening("MouseUp")){if(this._isClientDiv(e)||t&&this._isMouseDown){this.onMouseUp(this._createMouseEvent("MouseUp",e))}}if(this._linksVisible){return}if(t&&this._isMouseDown){if(this._dragOffset!==-1){var n=this._getSelection();n.extend(this._dragOffset);n.collapse();this._setSelection(n,true,true);this._dragOffset=-1}this._isMouseDown=false;this._endAutoScroll();if(this._isW3CEvents){this._setGrab(null)}if(o.isFirefox){e.preventDefault()}}},_handleMouseWheel:function(e){var t=this._getLineHeight();var n=0,r=0;if(o.isIE||o.isOpera){r=-e.wheelDelta/40*t}else if(o.isFirefox){var i;if(o.isMac){i=e.detail*3}else{var s=256;i=Math.max(-s,Math.min(s,e.detail))*t}if(e.axis===e.HORIZONTAL_AXIS){n=i}else{r=i}}else{if(o.isMac){var u,a;var f=e.timeStamp-this._wheelTimeStamp;this._wheelTimeStamp=e.timeStamp;if(e.wheelDeltaX%120!==0){u=1}else{u=f<40?40/(40-f):40}if(e.wheelDeltaY%120!==0){a=1}else{a=f<40?40/(40-f):40}n=Math.ceil(-e.wheelDeltaX/u);if(-1<n&&n<0){n=-1}if(0<n&&n<1){n=1}r=Math.ceil(-e.wheelDeltaY/a);if(-1<r&&r<0){r=-1}if(0<r&&r<1){r=1}}else{n=-e.wheelDeltaX;var l=8;r=-e.wheelDeltaY/120*l*t}}if(o.isSafari){var c=e.target;while(c&&c.lineIndex===undefined){c=c.parentNode}this._mouseWheelLine=c}var h=this._getScroll();this._scrollView(n,r);var p=this._getScroll();if(h.x!==p.x||h.y!==p.y){if(e.preventDefault){e.preventDefault()}return false}},_handlePaste:function(e){if(this._ignoreEvent(e)){return}if(this._ignorePaste){return}if(this._doPaste(e)){if(o.isIE){var t=this;this._ignoreFocus=true;var n=this._getWindow();n.setTimeout(function(){t._updateDOMSelection();t._ignoreFocus=false},0)}if(e.preventDefault){e.preventDefault()}return false}},_handleResize:function(e){var t=this._rootDiv.clientWidth;var n=this._rootDiv.clientHeight;if(this._rootWidth!==t||this._rootHeight!==n){if(this._rootWidth!==t&&this._wrapMode){this._resetLineHeight()}this._rootWidth=t;this._rootHeight=n;var r=o.isIE<9;var i=this._calculateMetrics();if(!p(i,this._metrics)){if(this._variableLineHeight){this._variableLineHeight=false;this._resetLineHeight()}this._metrics=i;r=true}if(r){this._queueUpdate()}else{this._update()}}},_handleRulerEvent:function(e){var t=e.target?e.target:e.srcElement;var n=t.lineIndex;var r=t;while(r&&!r._ruler){if(n===undefined&&r.lineIndex!==undefined){n=r.lineIndex}r=r.parentNode}var i=r?r._ruler:null;if(n===undefined&&i&&i.getOverview()==="document"){var s=this._getClientHeight();var o=this._model.getLineCount();var u=this._getViewPadding();var a=this._viewDiv.getBoundingClientRect();var f=s+u.top+u.bottom-2*this._metrics.scrollWidth;n=Math.floor((e.clientY-a.top-this._metrics.scrollWidth)*o/f);if(!(0<=n&&n<o)){n=undefined}}if(i){switch(e.type){case"click":if(i.onClick){i.onClick(n,e)}break;case"dblclick":if(i.onDblClick){i.onDblClick(n,e)}break;case"mousemove":if(i.onMouseMove){i.onMouseMove(n,e)}break;case"mouseover":if(i.onMouseOver){i.onMouseOver(n,e)}break;case"mouseout":if(i.onMouseOut){var l=e.relatedTarget;while(l&&l!==this._rootDiv){if(l===r){return}l=l.parentNode}i.onMouseOut(n,e)}break}}},_handleScroll:function(){var e=this._getScroll(false);var t=this._hScroll;var n=this._vScroll;if(t!==e.x||n!==e.y){this._hScroll=e.x;this._vScroll=e.y;this._commitIME();this._update(n===e.y);var r={type:"Scroll",oldValue:{x:t,y:n},newValue:e};this.onScroll(r)}},_handleSelectStart:function(e){if(this._ignoreSelect){if(e&&e.preventDefault){e.preventDefault()}return false}},_getModelOffset:function(e,t){if(!e){return}var n;if(e.tagName==="DIV"){n=e}else{n=e.parentNode.parentNode}var r=0;var i=n.lineIndex;if(e.tagName!=="DIV"){var s=n.firstChild;while(s){var o=s.firstChild;if(o===e){if(s.ignoreChars){r-=s.ignoreChars}r+=t;break}if(s.ignoreChars){r-=s.ignoreChars}r+=o.data.length;s=s.nextSibling}}return Math.max(0,r)+this._model.getLineStart(i)},_updateSelectionFromDOM:function(){var e=this._getWindow();var t=e.getSelection();var n=this._getModelOffset(t.anchorNode,t.anchorOffset);var r=this._getModelOffset(t.focusNode,t.focusOffset);if(n===undefined||r===undefined){return}this._setSelection(new b(n,r),false,false)},_handleSelectionChange:function(e){if(this._imeOffset!==-1){return}if(o.isAndroid){var t=this._getWindow();if(this._selTimer){t.clearTimeout(this._selTimer)}var n=this;this._selTimer=t.setTimeout(function(){if(!n._clientDiv){return}n._selTimer=null;n._updateSelectionFromDOM()},250)}else{this._updateSelectionFromDOM()}},_handleTextInput:function(e){if(this._ignoreEvent(e)){return}this._imeOffset=-1;var t=this._getWindow().getSelection();if(t.anchorNode!==this._anchorNode||t.focusNode!==this._focusNode||t.anchorOffset!==this._anchorOffset||t.focusOffset!==this._focusOffset){var n=t.anchorNode;while(n){if(n.lineIndex!==undefined){break}n=n.parentNode}if(n){var r=this._model;var i=n.lineIndex;var s=r.getLine(i),o=s;var u=0;var a=r.getLineStart(i);if(t.rangeCount>0){t.getRangeAt(0).deleteContents();var f=n.ownerDocument.createTextNode(e.data);t.getRangeAt(0).insertNode(f);var l=this._getDOMText(n,f);o=l.text;u=l.offset;f.parentNode.removeChild(f)}n.lineRemoved=true;var c=0;while(s.charCodeAt(c)===o.charCodeAt(c)&&c<u){c++}var h=s.length-1,p=o.length-s.length;while(s.charCodeAt(h)===o.charCodeAt(h+p)&&h+p>=u+e.data.length){h--}h++;var d=o.substring(c,h+p);c+=a;h+=a;this._modifyContent({text:d,start:c,end:h,_ignoreDOMSelection:true},true)}}else{this._doContent(e.data)}e.preventDefault()},_handleTouchStart:function(e){this._commitIME();var t=this._getWindow();if(this._touchScrollTimer){this._vScrollDiv.style.display="none";this._hScrollDiv.style.display="none";t.clearInterval(this._touchScrollTimer);this._touchScrollTimer=null}var n=e.touches;if(n.length===1){var r=n[0];var i=r.clientX,s=r.clientY;this._touchStartX=i;this._touchStartY=s;if(o.isAndroid){if(s<r.pageY-t.pageYOffset||i<r.pageX-t.pageXOffset){i=r.pageX-t.pageXOffset;s=r.pageY-t.pageYOffset}}var u=this.convert({x:i,y:s},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(u.x,u.y);this._touchStartTime=e.timeStamp;this._touching=true}},_handleTouchMove:function(e){var t=e.touches;if(t.length===1){var n=t[0];this._touchCurrentX=n.clientX;this._touchCurrentY=n.clientY;var r=10;if(!this._touchScrollTimer&&e.timeStamp-this._touchStartTime<r*20){this._vScrollDiv.style.display="block";if(!this._wrapMode){this._hScrollDiv.style.display="block"}var i=this;var s=this._getWindow();this._touchScrollTimer=s.setInterval(function(){var e=0,t=0;if(i._touching){e=i._touchStartX-i._touchCurrentX;t=i._touchStartY-i._touchCurrentY;i._touchSpeedX=e/r;i._touchSpeedY=t/r;i._touchStartX=i._touchCurrentX;i._touchStartY=i._touchCurrentY}else{if(Math.abs(i._touchSpeedX)<.1&&Math.abs(i._touchSpeedY)<.1){i._vScrollDiv.style.display="none";i._hScrollDiv.style.display="none";s.clearInterval(i._touchScrollTimer);i._touchScrollTimer=null;return}else{e=i._touchSpeedX*r;t=i._touchSpeedY*r;i._touchSpeedX*=.95;i._touchSpeedY*=.95}}i._scrollView(e,t)},r)}if(this._touchScrollTimer){e.preventDefault()}}},_handleTouchEnd:function(e){var t=e.touches;if(t.length===0){this._touching=false}},_doAction:function(e){var t,n;var r=this._keyModes;for(n=r.length-1;n>=0;n--){t=r[n];if(typeof t.match==="function"){var i=t.match(e);if(i!==undefined){return this.invokeAction(i)}}}return false},_doMove:function(e,t){var n=this._model;var r=t.getCaret();var i=n.getLineAtOffset(r);if(!e.count){e.count=1}while(e.count!==0){var s=n.getLineStart(i);if(e.count<0&&r===s){if(i>0){if(e.unit==="character"){e.count++}i--;t.extend(n.getLineEnd(i))}else{break}}else if(e.count>0&&r===n.getLineEnd(i)){if(i+1<n.getLineCount()){if(e.unit==="character"){e.count--}i++;t.extend(n.getLineStart(i))}else{break}}else{var o=false;if(e.expandTab&&e.unit==="character"&&(r-s)%this._tabSize===0){var u=n.getText(s,r);o=!/[^ ]/.test(u)}if(o){t.extend(r-this._tabSize);e.count+=e.count<0?1:-1}else{var a=this._getLine(i);t.extend(a.getNextOffset(r,e));a.destroy()}}r=t.getCaret()}return t},_doBackspace:function(e){var t=this._getSelection();if(t.isEmpty()){if(!e.count){e.count=1}e.count*=-1;e.expandTab=this._expandTab;this._doMove(e,t)}this._modifyContent({text:"",start:t.start,end:t.end},true);return true},_doCase:function(e){var t=this._getSelection();this._doMove(e,t);var n=this.getText(t.start,t.end);this._setSelection(t,true);switch(e.type){case"lower":n=n.toLowerCase();break;case"capitalize":n=n.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});break;case"reverse":var r="";for(var i=0;i<n.length;i++){var s=n[i];var o=s.toLowerCase();if(o!==s){s=o}else{s=s.toUpperCase()}r+=s}n=r;break;default:n=n.toUpperCase();break}this._doContent(n);return true},_doContent:function(e){var t=this._getSelection();if(this._overwriteMode&&t.isEmpty()){var n=this._model;var r=n.getLineAtOffset(t.end);if(t.end<n.getLineEnd(r)){var i=this._getLine(r);t.extend(i.getNextOffset(t.getCaret(),{unit:"character",count:1}));i.destroy()}}this._modifyContent({text:e,start:t.start,end:t.end,_ignoreDOMSelection:true},true)},_doCopy:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._setClipboardText(n,e)}return true},_doCursorNext:function(e){var t=this._getSelection();if(!t.isEmpty()&&!e.select){t.start=t.end}else{this._doMove(e,t)}if(!e.select){t.collapse()}this._setSelection(t,true);return true},_doCursorPrevious:function(e){var t=this._getSelection();if(!t.isEmpty()&&!e.select){t.end=t.start}else{if(!e.count){e.count=1}e.count*=-1;this._doMove(e,t)}if(!e.select){t.collapse()}this._setSelection(t,true);return true},_doCut:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);this._doContent("");return this._setClipboardText(n,e)}return true},_doDelete:function(e){var t=this._getSelection();if(t.isEmpty()){this._doMove(e,t)}this._modifyContent({text:"",start:t.start,end:t.end},true);return true},_doEnd:function(e){var t=this._getSelection();var n=this._model;var r;if(e.ctrl){t.extend(n.getCharCount());r=function(){}}else{var i=t.getCaret();var s=n.getLineAtOffset(i);if(this._wrapMode){var o=this._getLine(s);var u=o.getLineIndex(i);if(u===o.getLineCount()-1){i=n.getLineEnd(s)}else{i=o.getLineStart(u+1)-1}o.destroy()}else{if(e.count&&e.count>0){s=Math.min(s+e.count-1,n.getLineCount()-1)}i=n.getLineEnd(s)}t.extend(i)}if(!e.select){t.collapse()}this._setSelection(t,true,true,r);return true},_doEnter:function(e){var t=this._model;var n=this._getSelection();this._doContent(t.getLineDelimiter());if(e&&e.noCursor){n.end=n.start;this._setSelection(n,true)}return true},_doHome:function(e){var t=this._getSelection();var n=this._model;var r;if(e.ctrl){t.extend(0);r=function(){}}else{var i=t.getCaret();var s=n.getLineAtOffset(i);if(this._wrapMode){var o=this._getLine(s);var u=o.getLineIndex(i);i=o.getLineStart(u);o.destroy()}else{i=n.getLineStart(s)}t.extend(i)}if(!e.select){t.collapse()}this._setSelection(t,true,true,r);return true},_doLineDown:function(e){var t=this._model;var n=this._getSelection();var r=n.getCaret();var i=t.getLineAtOffset(r),s;var u=this._getLine(i);var a=this._columnX,f=1,l=false;if(a===-1||e.wholeLine||e.select&&o.isIE){var c=e.wholeLine?t.getLineEnd(i+1):r;a=u.getBoundingClientRect(c).left}if((s=u.getLineIndex(r))<u.getLineCount()-1){f=u.getClientRects(s+1).top+1}else{var h=t.getLineCount()-1;l=i===h;if(e.count&&e.count>0){i=Math.min(i+e.count,h)}else{i++}}var p=false;if(l){if(e.select||o.isMac||o.isLinux){n.extend(t.getCharCount());p=true}}else{if(u.lineIndex!==i){u.destroy();u=this._getLine(i)}n.extend(u.getOffset(a,f));p=true}if(p){if(!e.select){n.collapse()}this._setSelection(n,true,true)}this._columnX=a;u.destroy();return true},_doLineUp:function(e){var t=this._model;var n=this._getSelection();var r=n.getCaret();var i=t.getLineAtOffset(r),s;var u=this._getLine(i);var a=this._columnX,f=false,l;if(a===-1||e.wholeLine||e.select&&o.isIE){var c=e.wholeLine?t.getLineStart(i-1):r;a=u.getBoundingClientRect(c).left}if((s=u.getLineIndex(r))>0){l=u.getClientRects(s-1).top+1}else{f=i===0;if(!f){if(e.count&&e.count>0){i=Math.max(i-e.count,0)}else{i--}l=this._getLineHeight(i)-1}}var h=false;if(f){if(e.select||o.isMac||o.isLinux){n.extend(0);h=true}}else{if(u.lineIndex!==i){u.destroy();u=this._getLine(i)}n.extend(u.getOffset(a,l));h=true}if(h){if(!e.select){n.collapse()}this._setSelection(n,true,true)}this._columnX=a;u.destroy();return true},_doNoop:function(){return true},_doPageDown:function(e){var t=this;var n=this._model;var r=this._getSelection();var i=r.getCaret();var s=n.getLineAtOffset(i);var u=n.getLineCount();var a=this._getScroll();var f=this._getClientHeight(),l,c;if(this._lineHeight){l=this._columnX;var h=this._getBoundsAtOffset(i);if(l===-1||e.select&&o.isIE){l=h.left}var p=this._getLineIndex(h.top+f);c=this._getLine(p);var d=this._getLinePixel(p);var v=h.top+f-d;i=c.getOffset(l,v);var m=c.getBoundingClientRect(i);c.destroy();r.extend(i);if(!e.select){r.collapse()}this._setSelection(r,true,true,function(){t._columnX=l},m.top+d-h.top);return true}if(s<u-1){var g=this._getLineHeight();var y=Math.floor(f/g);var b=Math.min(u-s-1,y);b=Math.max(1,b);l=this._columnX;if(l===-1||e.select&&o.isIE){c=this._getLine(s);l=c.getBoundingClientRect(i).left;c.destroy()}c=this._getLine(s+b);r.extend(c.getOffset(l,0));c.destroy();if(!e.select){r.collapse()}var w=u*g;var E=a.y+b*g;if(E+f>w){E=w-f}this._setSelection(r,true,true,function(){t._columnX=l},E-a.y)}return true},_doPageUp:function(e){var t=this;var n=this._model;var r=this._getSelection();var i=r.getCaret();var s=n.getLineAtOffset(i);var u=this._getScroll();var a=this._getClientHeight(),f,l;if(this._lineHeight){f=this._columnX;var c=this._getBoundsAtOffset(i);if(f===-1||e.select&&o.isIE){f=c.left}var h=this._getLineIndex(c.bottom-a);l=this._getLine(h);var p=this._getLinePixel(h);var d=c.bottom-a-p;i=l.getOffset(f,d);var v=l.getBoundingClientRect(i);l.destroy();r.extend(i);if(!e.select){r.collapse()}this._setSelection(r,true,true,function(){t._columnX=f},v.top+p-c.top);return true}if(s>0){var m=this._getLineHeight();var g=Math.floor(a/m);var y=Math.max(1,Math.min(s,g));f=this._columnX;if(f===-1||e.select&&o.isIE){l=this._getLine(s);f=l.getBoundingClientRect(i).left;l.destroy()}l=this._getLine(s-y);r.extend(l.getOffset(f,this._getLineHeight(s-y)-1));l.destroy();if(!e.select){r.collapse()}var b=Math.max(0,u.y-y*m);this._setSelection(r,true,true,function(){t._columnX=f},b-u.y)}return true},_doPaste:function(e){var t=this;var n=this._getClipboardText(e,function(e){if(e){if(o.isLinux&&t._lastMouseButton===2){var n=(new Date).getTime()-t._lastMouseTime;if(n<=t._clickTime){t._setSelectionTo(t._lastMouseX,t._lastMouseY)}}t._doContent(e)}});return n!==null},_doScroll:function(e){var t=e.type;var n=this._model;var r=n.getLineCount();var i=this._getClientHeight();var s=this._getLineHeight();var o=r*s;var u=this._getScroll().y;var a;switch(t){case"textStart":a=0;break;case"textEnd":a=o-i;break;case"pageDown":a=u+i;break;case"pageUp":a=u-i;break;case"lineDown":a=u+s;break;case"lineUp":a=u-s;break;case"centerLine":var f=this._getSelection();var l=n.getLineAtOffset(f.start);var c=n.getLineAtOffset(f.end);var h=(c-l+1)*s;a=l*s-i/2+h/2;break}if(a!==undefined){a=Math.min(Math.max(0,a),o-i);this._scrollViewAnimated(0,a-u,function(){})}return true},_doSelectAll:function(e){var t=this._model;var n=this._getSelection();n.setCaret(0);n.extend(t.getCharCount());this._setSelection(n,false);return true},_doTab:function(e){if(!this._tabMode||this._readonly){return}var t="	";if(this._expandTab){var n=this._model;var r=this._getSelection().getCaret();var i=n.getLineAtOffset(r);var s=n.getLineStart(i);var o=this._tabSize-(r-s)%this._tabSize;t=(new Array(o+1)).join(" ")}this._doContent(t);return true},_doShiftTab:function(e){if(!this._tabMode||this._readonly){return}return true},_doOverwriteMode:function(e){if(this._readonly){return}this.setOptions({overwriteMode:!this.getOptions("overwriteMode")});return true},_doTabMode:function(e){this._tabMode=!this._tabMode;return true},_doWrapMode:function(e){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return true},_autoScroll:function(){var e=this._model;var t=this._getSelection();var n=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document");var r=t.getCaret();var i=e.getLineCount();var s=e.getLineAtOffset(r),u,a;if(this._autoScrollDir==="up"||this._autoScrollDir==="down"){var f=this._autoScrollY/this._getLineHeight();f=f<0?Math.floor(f):Math.ceil(f);u=s;u=Math.max(0,Math.min(i-1,u+f))}else if(this._autoScrollDir==="left"||this._autoScrollDir==="right"){u=this._getLineIndex(n.y);a=this._getLine(s);n.x+=a.getBoundingClientRect(r,false).left;a.destroy()}if(u===0&&(o.isMac||o.isLinux)){t.extend(0)}else if(u===i-1&&(o.isMac||o.isLinux)){t.extend(e.getCharCount())}else{a=this._getLine(u);t.extend(a.getOffset(n.x,n.y-this._getLinePixel(u)));a.destroy()}this._setSelection(t,true)},_autoScrollTimer:function(){this._autoScroll();var e=this;var t=this._getWindow();this._autoScrollTimerID=t.setTimeout(function(){e._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(e){if(!this._lineHeight){return}if(this._calculateLHTimer){return}var t=this._model.getLineCount(),n=0;if(e){var r=0;var i=100;var s=(new Date).getTime(),o=0;while(n<t){if(!this._lineHeight[n]){r++;if(!o){o=n}this._lineHeight[n]=this._calculateLineHeight(n)}n++;if((new Date).getTime()-s>i){break}}this.redrawRulers(0,t);this._queueUpdate()}var u=this._getWindow();if(n!==t){var a=this;this._calculateLHTimer=u.setTimeout(function(){a._calculateLHTimer=null;a._calculateLineHeightTimer(true)},0);return}if(this._calculateLHTimer){u.clearTimeout(this._calculateLHTimer);this._calculateLHTimer=undefined}},_calculateLineHeight:function(e){var t=this._getLine(e);var n=t.getBoundingClientRect();t.destroy();return Math.max(1,n.bottom-n.top)},_calculateMetrics:function(){var e=this._clientDiv;var t=e.ownerDocument;var n=" ";var r=o.createElement(t,"div");r.style.lineHeight="normal";var i=this._model;var s=i.getLine(0);var u={type:"LineStyle",textView:this,0:0,lineText:s,lineStart:0};this.onLineStyle(u);l(u.style,r);r.style.position="fixed";r.style.left="-1000px";var a=o.createElement(t,"span");a.appendChild(t.createTextNode(n));r.appendChild(a);var f=o.createElement(t,"span");f.style.fontStyle="italic";f.appendChild(t.createTextNode(n));r.appendChild(f);var c=o.createElement(t,"span");c.style.fontWeight="bold";c.appendChild(t.createTextNode(n));r.appendChild(c);var h=o.createElement(t,"span");h.style.fontWeight="bold";h.style.fontStyle="italic";h.appendChild(t.createTextNode(n));r.appendChild(h);e.appendChild(r);var p=r.getBoundingClientRect();var d=a.getBoundingClientRect();var v=f.getBoundingClientRect();var y=c.getBoundingClientRect();var b=h.getBoundingClientRect();var w=d.bottom-d.top;var E=v.bottom-v.top;var S=y.bottom-y.top;var x=b.bottom-b.top;var T=0;var N=p.bottom-p.top<=0;var C=Math.max(1,p.bottom-p.top);if(E>w){T=1}if(S>E){T=2}if(x>S){T=3}var k;if(T!==0){k={style:{}};if((T&1)!==0){k.style.fontStyle="italic"}if((T&2)!==0){k.style.fontWeight="bold"}}var L=g(r);e.removeChild(r);var A=m(this._viewDiv);var O=o.createElement(t,"div");O.style.position="fixed";O.style.left="-1000px";O.style.paddingLeft=A.left+"px";O.style.paddingTop=A.top+"px";O.style.paddingRight=A.right+"px";O.style.paddingBottom=A.bottom+"px";O.style.width="100px";O.style.height="100px";var M=o.createElement(t,"div");M.style.width="100%";M.style.height="100%";O.appendChild(M);e.appendChild(O);var _=O.getBoundingClientRect();var D=M.getBoundingClientRect();var P=0;if(!this._singleMode){O.style.overflow="hidden";M.style.height="200px";var H=O.clientWidth;O.style.overflow="scroll";var B=O.clientWidth;P=H-B}e.removeChild(O);A={left:D.left-_.left,top:D.top-_.top,right:_.right-D.right,bottom:_.bottom-D.bottom};var j=0,F=0;if(!N){if(this._wrapOffset||this._marginOffset){O=o.createElement(t,"div");O.style.position="fixed";O.style.left="-1000px";O.innerHTML=(new Array(this._wrapOffset+1)).join(" ");e.appendChild(O);_=O.getBoundingClientRect();j=Math.ceil(_.right-_.left);O.innerHTML=(new Array(this._marginOffset+1)).join(" ");D=O.getBoundingClientRect();F=Math.ceil(D.right-D.left);e.removeChild(O)}}return{lineHeight:C,largestFontStyle:k,lineTrim:L,viewPadding:A,scrollWidth:P,wrapWidth:j,marginWidth:F,invalid:N}},_cancelAnimation:function(){if(this._animation){this._animation.stop();this._animation=null}},_clearSelection:function(e){var t=this._getSelection();if(t.isEmpty()){return false}if(e==="next"){t.start=t.end}else{t.end=t.start}this._setSelection(t,true);return true},_commitIME:function(){if(this._imeOffset===-1){return}this._scrollDiv.focus();this._clientDiv.focus();var e=this._model;var t=e.getLineAtOffset(this._imeOffset);var n=e.getLineStart(t);var r=this._getDOMText(this._getLineNode(t)).text;var i=e.getLine(t);var s=this._imeOffset-n;var o=s+r.length-i.length;if(s!==o){var u=r.substring(s,o);this._doContent(u)}this._imeOffset=-1},_createActions:function(){this.addKeyMode(new n.DefaultKeyMode(this));var t=this;this._actions={noop:{defaultHandler:function(){return t._doNoop()}},lineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:false}))},actionDescription:{name:e.lineUp}},lineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:false}))},actionDescription:{name:e.lineDown}},lineStart:{defaultHandler:function(e){return t._doHome(h(e,{select:false,ctrl:false}))},actionDescription:{name:e.lineStart}},lineEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:false,ctrl:false}))},actionDescription:{name:e.lineEnd}},charPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:false,unit:"character"}))},actionDescription:{name:e.charPrevious}},charNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:false,unit:"character"}))},actionDescription:{name:e.charNext}},pageUp:{defaultHandler:function(e){return t._doPageUp(h(e,{select:false}))},actionDescription:{name:e.pageUp}},pageDown:{defaultHandler:function(e){return t._doPageDown(h(e,{select:false}))},actionDescription:{name:e.pageDown}},scrollPageUp:{defaultHandler:function(e){return t._doScroll(h(e,{type:"pageUp"}))},actionDescription:{name:e.scrollPageUp}},scrollPageDown:{defaultHandler:function(e){return t._doScroll(h(e,{type:"pageDown"}))},actionDescription:{name:e.scrollPageDown}},scrollLineUp:{defaultHandler:function(e){return t._doScroll(h(e,{type:"lineUp"}))},actionDescription:{name:e.scrollLineUp}},scrollLineDown:{defaultHandler:function(e){return t._doScroll(h(e,{type:"lineDown"}))},actionDescription:{name:e.scrollLineDown}},wordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:false,unit:"word"}))},actionDescription:{name:e.wordPrevious}},wordNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:false,unit:"word"}))},actionDescription:{name:e.wordNext}},textStart:{defaultHandler:function(e){return t._doHome(h(e,{select:false,ctrl:true}))},actionDescription:{name:e.textStart}},textEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:false,ctrl:true}))},actionDescription:{name:e.textEnd}},scrollTextStart:{defaultHandler:function(e){return t._doScroll(h(e,{type:"textStart"}))},actionDescription:{name:e.scrollTextStart}},scrollTextEnd:{defaultHandler:function(e){return t._doScroll(h(e,{type:"textEnd"}))},actionDescription:{name:e.scrollTextEnd}},centerLine:{defaultHandler:function(e){return t._doScroll(h(e,{type:"centerLine"}))},actionDescription:{name:e.centerLine}},selectLineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:true}))},actionDescription:{name:e.selectLineUp}},selectLineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:true}))},actionDescription:{name:e.selectLineDown}},selectWholeLineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:true,wholeLine:true}))},actionDescription:{name:e.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:true,wholeLine:true}))},actionDescription:{name:e.selectWholeLineDown}},selectLineStart:{defaultHandler:function(e){return t._doHome(h(e,{select:true,ctrl:false}))},actionDescription:{name:e.selectLineStart}},selectLineEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:true,ctrl:false}))},actionDescription:{name:e.selectLineEnd}},selectCharPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:true,unit:"character"}))},actionDescription:{name:e.selectCharPrevious}},selectCharNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:true,unit:"character"}))},actionDescription:{name:e.selectCharNext}},selectPageUp:{defaultHandler:function(e){return t._doPageUp(h(e,{select:true}))},actionDescription:{name:e.selectPageUp}},selectPageDown:{defaultHandler:function(e){return t._doPageDown(h(e,{select:true}))},actionDescription:{name:e.selectPageDown}},selectWordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:true,unit:"word"}))},actionDescription:{name:e.selectWordPrevious}},selectWordNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:true,unit:"word"}))},actionDescription:{name:e.selectWordNext}},selectTextStart:{defaultHandler:function(e){return t._doHome(h(e,{select:true,ctrl:true}))},actionDescription:{name:e.selectTextStart}},selectTextEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:true,ctrl:true}))},actionDescription:{name:e.selectTextEnd}},deletePrevious:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"character"}))},actionDescription:{name:e.deletePrevious}},deleteNext:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"character"}))},actionDescription:{name:e.deleteNext}},deleteWordPrevious:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"word"}))},actionDescription:{name:e.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"word"}))},actionDescription:{name:e.deleteWordNext}},deleteLineStart:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"line"}))},actionDescription:{name:e.deleteLineStart}},deleteLineEnd:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"line"}))},actionDescription:{name:e.deleteLineEnd}},tab:{defaultHandler:function(e){return t._doTab()},actionDescription:{name:e.tab}},shiftTab:{defaultHandler:function(e){return t._doShiftTab()},actionDescription:{name:e.shiftTab}},enter:{defaultHandler:function(e){return t._doEnter()},actionDescription:{name:e.enter}},enterNoCursor:{defaultHandler:function(e){return t._doEnter(h(e,{noCursor:true}))},actionDescription:{name:e.enterNoCursor}},selectAll:{defaultHandler:function(e){return t._doSelectAll()},actionDescription:{name:e.selectAll}},copy:{defaultHandler:function(e){return t._doCopy()},actionDescription:{name:e.copy}},cut:{defaultHandler:function(e){return t._doCut()},actionDescription:{name:e.cut}},paste:{defaultHandler:function(e){return t._doPaste()},actionDescription:{name:e.paste}},uppercase:{defaultHandler:function(e){return t._doCase(h(e,{type:"upper"}))},actionDescription:{name:e.uppercase}},lowercase:{defaultHandler:function(e){return t._doCase(h(e,{type:"lower"}))},actionDescription:{name:e.lowercase}},capitalize:{defaultHandler:function(e){return t._doCase(h(e,{unit:"word",type:"capitalize"}))},actionDescription:{name:e.capitalize}},reversecase:{defaultHandler:function(e){return t._doCase(h(e,{type:"reverse"}))},actionDescription:{name:e.reversecase}},toggleOverwriteMode:{defaultHandler:function(e){return t._doOverwriteMode()},actionDescription:{name:e.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(e){return t._doTabMode()},actionDescription:{name:e.toggleTabMode}},toggleWrapMode:{defaultHandler:function(e){return t._doWrapMode()},actionDescription:{name:e.toggleWrapMode}}}},_createRulerParent:function(e){var t=o.createElement(document,"div");t.className=e;t.tabIndex=-1;t.style.overflow="hidden";t.style.MozUserSelect="none";t.style.WebkitUserSelect="none";t.style.position="absolute";t.style.top="0px";t.style.bottom="0px";t.style.cursor="default";t.style.display="none";t.setAttribute("aria-hidden","true");this._rootDiv.appendChild(t);return t},_createRuler:function(e,t){if(!this._clientDiv){return}var n=this._getRulerParent(e);if(!n){return}if(n!==this._marginDiv||this._marginOffset){n.style.display="block"}var r=o.createElement(n.ownerDocument,"div");r._ruler=e;r.rulerChanged=true;r.style.position="relative";r.style.cssFloat="left";r.style.styleFloat="left";r.style.outline="none";if(t===undefined||t<0||t>=n.children.length){n.appendChild(r)}else{var i=n.firstChild;while(i&&t-->0){i=i.nextSibling}n.insertBefore(r,i)}},_createView:function(){if(this._clientDiv){return}var e=this._parent;while(e.hasChildNodes()){e.removeChild(e.lastChild)}var t=e.ownerDocument;var n=o.createElement(t,"div");this._rootDiv=n;n.tabIndex=-1;n.style.position="relative";n.style.overflow="hidden";n.style.width="100%";n.style.height="100%";n.style.overflow="hidden";n.style.WebkitTextSizeAdjust="100%";n.setAttribute("role","application");e.appendChild(n);var r=this._createRulerParent("textviewLeftRuler");this._leftDiv=r;var i=o.createElement(t,"div");i.className="textviewScroll";this._viewDiv=i;i.tabIndex=-1;i.style.position="absolute";i.style.top="0px";i.style.bottom="0px";i.style.borderWidth="0px";i.style.margin="0px";i.style.outline="none";i.style.background="transparent";if(o.isMac&&o.isWebkit){i.style.pointerEvents="none";i.style.zIndex="2"}n.appendChild(i);var s=this._createRulerParent("textviewRightRuler");this._rightDiv=s;s.style.right="0px";var u=o.createElement(t,"div");this._scrollDiv=u;u.style.margin="0px";u.style.borderWidth="0px";u.style.padding="0px";i.appendChild(u);var a=this._marginDiv=this._createRulerParent("textviewMarginRuler");a.style.zIndex="4";if(!o.isIE&&!o.isIOS){var f=o.createElement(t,"div");this._clipDiv=f;f.style.position="absolute";f.style.overflow="hidden";f.style.margin="0px";f.style.borderWidth="0px";f.style.padding="0px";f.style.background="transparent";n.appendChild(f);var l=o.createElement(t,"div");this._clipScrollDiv=l;l.style.position="absolute";l.style.height="1px";l.style.top="-1000px";l.style.background="transparent";f.appendChild(l)}this._setFullSelection(this._fullSelection,true);var c=o.createElement(t,"div");c.className="textviewContent";this._clientDiv=c;c.tabIndex=0;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.zIndex="1";c.style.WebkitUserSelect="text";c.setAttribute("spellcheck","false");if(o.isIOS||o.isAndroid){c.style.WebkitTapHighlightColor="transparent"}(this._clipDiv||n).appendChild(c);if(o.isIOS||o.isAndroid){var h=o.createElement(t,"div");this._vScrollDiv=h;h.style.position="absolute";h.style.borderWidth="1px";h.style.borderColor="white";h.style.borderStyle="solid";h.style.borderRadius="4px";h.style.backgroundColor="black";h.style.opacity="0.5";h.style.margin="0px";h.style.padding="0px";h.style.outline="none";h.style.zIndex="3";h.style.width="8px";h.style.display="none";n.appendChild(h);var p=o.createElement(t,"div");this._hScrollDiv=p;p.style.position="absolute";p.style.borderWidth="1px";p.style.borderColor="white";p.style.borderStyle="solid";p.style.borderRadius="4px";p.style.backgroundColor="black";p.style.opacity="0.5";p.style.margin="0px";p.style.padding="0px";p.style.outline="none";p.style.zIndex="3";p.style.height="8px";p.style.display="none";n.appendChild(p)}if(o.isFirefox&&!c.setCapture){var d=o.createElement(t,"div");this._overlayDiv=d;d.style.position=c.style.position;d.style.borderWidth=c.style.borderWidth;d.style.margin=c.style.margin;d.style.padding=c.style.padding;d.style.cursor="text";d.style.zIndex="2";(this._clipDiv||n).appendChild(d)}c.contentEditable="true";c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,true);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,true);this._setTabSize(this._tabSize,true);this._setMarginOffset(this._marginOffset,true);this._hookEvents();var v=this._rulers;for(var m=0;m<v.length;m++){this._createRuler(v[m])}this._update()},_defaultOptions:function(){return{parent:{value:undefined,update:null},model:{value:undefined,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:false,update:this._setReadOnly},fullSelection:{value:true,update:this._setFullSelection},tabMode:{value:true,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:false,update:null},singleMode:{value:false,update:this._setSingleMode},overwriteMode:{value:false,update:this._setOverwriteMode},blockCursorVisible:{value:false,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:false,update:this._setWrapMode},wrappable:{value:false,update:null},theme:{value:i.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:undefined,update:this._setThemeClass}}},_destroyRuler:function(e){var t=this._getRulerParent(e);if(t){var n=t.firstChild;while(n){if(n._ruler===e){n._ruler=undefined;t.removeChild(n);if(t.children.length===0&&(t!==this._marginDiv||!this._marginOffset)){t.style.display="none"}break}n=n.nextSibling}}},_destroyView:function(){var e=this._clientDiv;if(!e){return}this._setGrab(null);this._unhookEvents();var t=this._getWindow();if(this._autoScrollTimerID){t.clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=null}if(this._updateTimer){t.clearTimeout(this._updateTimer);this._updateTimer=null}var n=this._rootDiv;n.parentNode.removeChild(n);this._selDiv1=null;this._selDiv2=null;this._selDiv3=null;this._clipboardDiv=null;this._rootDiv=null;this._scrollDiv=null;this._viewDiv=null;this._clipDiv=null;this._clipScrollDiv=null;this._clientDiv=null;this._overlayDiv=null;this._leftDiv=null;this._rightDiv=null;this._marginDiv=null;this._cursorDiv=null;this._vScrollDiv=null;this._hScrollDiv=null},_doAutoScroll:function(e,t,n){this._autoScrollDir=e;this._autoScrollX=t;this._autoScrollY=n;if(!this._autoScrollTimerID){this._autoScrollTimer()}},_endAutoScroll:function(){if(this._autoScrollTimerID){var e=this._getWindow();e.clearTimeout(this._autoScrollTimerID)}this._autoScrollDir=undefined;this._autoScrollTimerID=undefined},_fixCaret:function(){var e=this._clientDiv;if(e){var t=this._hasFocus;this._ignoreFocus=true;if(t){e.blur()}e.contentEditable=false;e.contentEditable=true;if(t){e.focus()}this._ignoreFocus=false}},_getBaseText:function(e,t){var n=this._model;if(n.getBaseModel){e=n.mapOffset(e);t=n.mapOffset(t);n=n.getBaseModel()}return n.getText(e,t)},_getBottomIndex:function(e){var t=this._bottomChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect();var r=this._clientDiv.getBoundingClientRect();if(n.bottom>r.bottom){t=this._getLinePrevious(t)||t}}return t.lineIndex},_getBoundsAtOffset:function(e){var t=this._model;var n=this._getLine(t.getLineAtOffset(e));var r=n.getBoundingClientRect(e);var i=this._getLinePixel(n.lineIndex);r.top+=i;r.bottom+=i;n.destroy();return r},_getClientHeight:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-e.top-e.bottom)},_getClientWidth:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-e.left-e.right)},_getClipboardText:function(e,t){var n=this._model.getLineDelimiter();var r,i;var s=this._getWindow();var u=s.clipboardData;if(!u&&e){u=e.clipboardData}if(u){r=[];i=u.getData(o.isIE?"Text":"text/plain");d(i,function(e){r.push(e)},function(){r.push(n)});i=r.join("");if(t){t(i)}return i}if(o.isFirefox){this._ignoreFocus=true;var a=this._clipboardDiv;var f=this._rootDiv.ownerDocument;if(!a){a=o.createElement(f,"div");this._clipboardDiv=a;a.style.position="fixed";a.style.whiteSpace="pre";a.style.left="-1000px";this._rootDiv.appendChild(a)}a.innerHTML="<pre contenteditable=''></pre>";a.firstChild.focus();var l=this;var c=function(){var e=l._getTextFromElement(a);a.innerHTML="";r=[];d(e,function(e){r.push(e)},function(){r.push(n)});return r.join("")};var h=false;this._ignorePaste=true;if(!o.isLinux||this._lastMouseButton!==2){try{h=f.execCommand("paste",false,null)}catch(p){h=a.childNodes.length>1||a.firstChild&&a.firstChild.childNodes.length>0}}this._ignorePaste=false;if(!h){if(e){s.setTimeout(function(){l.focus();i=c();if(i&&t){t(i)}l._ignoreFocus=false},0);return null}else{this.focus();this._ignoreFocus=false;return""}}this.focus();this._ignoreFocus=false;i=c();if(i&&t){t(i)}return i}return""},_getDOMText:function(e,t){var n=e.firstChild;var r="",i=0;while(n){var s;if(n.ignore){n=n.nextSibling;continue}if(n.ignoreChars){s=n.lastChild;var o=0,u=[],a=-1;while(s){var f=s.data;if(f){for(var l=f.length-1;l>=0;l--){var c=f.substring(l,l+1);if(o<n.ignoreChars&&(c===" "||c==="​"||c==="﻿")){o++}else{u.push(c===" "?"	":c)}}}if(t===s){a=u.length}s=s.previousSibling}u=u.reverse().join("");if(a!==-1){i=r.length+u.length-a}r+=u}else{s=n.firstChild;while(s){if(t===s){i=r.length}r+=s.data;s=s.nextSibling}}n=n.nextSibling}return{text:r,offset:i}},_getTextFromElement:function(e){var t=e.ownerDocument;var n=t.defaultView;if(!n.getSelection){return e.innerText||e.textContent}var r=t.createRange();r.selectNode(e);var i=n.getSelection();var s=[],o;for(o=0;o<i.rangeCount;o++){s.push(i.getRangeAt(o))}this._ignoreSelect=true;i.removeAllRanges();i.addRange(r);var u=i.toString();i.removeAllRanges();for(o=0;o<s.length;o++){i.addRange(s[o])}this._ignoreSelect=false;return u},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(e){var t=this._getLineNode(e);if(t&&!t.lineChanged&&!t.lineRemoved){return t._line}return new E(this,e)},_getLineHeight:function(e,t){if(e!==undefined&&this._lineHeight){var n=this._lineHeight[e];if(n){return n}if(t||t===undefined){var r=this._lineHeight[e]=this._calculateLineHeight(e);return r}}return this._metrics.lineHeight},_getLineNode:function(e){var t=this._clientDiv;var n=t.firstChild;while(n){if(e===n.lineIndex){return n}n=n.nextSibling}return undefined},_getLineNext:function(e){var t=e?e.nextSibling:this._clientDiv.firstChild;while(t&&t.lineIndex===-1){t=t.nextSibling}return t},_getLinePrevious:function(e){var t=e?e.previousSibling:this._clientDiv.lastChild;while(t&&t.lineIndex===-1){t=t.previousSibling}return t},_getLinePixel:function(e){e=Math.min(Math.max(0,e),this._model.getLineCount());if(this._lineHeight){var t=this._getTopIndex();var n=-this._topIndexY+this._getScroll().y,r;if(e>t){for(r=t;r<e;r++){n+=this._getLineHeight(r)}}else{for(r=t-1;r>=e;r--){n-=this._getLineHeight(r)}}return n}var i=this._getLineHeight();return i*e},_getLineIndex:function(e){var t,n=0;var r=this._model.getLineCount();if(this._lineHeight){n=this._getTopIndex();var i=-this._topIndexY+this._getScroll().y;if(e!==i){if(e<i){while(e<i&&n>0){e+=this._getLineHeight(--n)}}else{t=this._getLineHeight(n);while(e-t>=i&&n<r-1){e-=t;t=this._getLineHeight(++n)}}}}else{t=this._getLineHeight();n=Math.floor(e/t)}return Math.max(0,Math.min(r-1,n))},_getRulerParent:function(e){switch(e.getLocation()){case"left":return this._leftDiv;case"right":return this._rightDiv;case"margin":return this._marginDiv}return null},_getScroll:function(e){if(e===undefined||e){this._cancelAnimation()}var t=this._viewDiv;return{x:t.scrollLeft,y:t.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(e){var t=this._topChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect();var r=this._getViewPadding();var i=this._viewDiv.getBoundingClientRect();if(n.top<i.top+r.top){t=this._getLineNext(t)||t}}return t.lineIndex},_hookEvents:function(){var e=this;this._modelListener={onChanging:function(t){e._onModelChanging(t)},onChanged:function(t){e._onModelChanged(t)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(t){e._setThemeClass(e._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var t=this._handlers=[];var n=this._clientDiv,r=this._viewDiv,i=this._rootDiv;var s=this._overlayDiv||n;var u=n.ownerDocument;var f=this._getWindow();var l=o.isIE?u:f;t.push({target:f,type:"resize",handler:function(t){return e._handleResize(t?t:f.event)}});t.push({target:n,type:"blur",handler:function(t){return e._handleBlur(t?t:f.event)}});t.push({target:n,type:"focus",handler:function(t){return e._handleFocus(t?t:f.event)}});t.push({target:r,type:"focus",handler:function(e){n.focus()}});t.push({target:r,type:"scroll",handler:function(t){return e._handleScroll(t?t:f.event)}});t.push({target:n,type:"textInput",handler:function(t){return e._handleTextInput(t?t:f.event)}});t.push({target:n,type:"keydown",handler:function(t){return e._handleKeyDown(t?t:f.event)}});t.push({target:n,type:"keypress",handler:function(t){return e._handleKeyPress(t?t:f.event)}});t.push({target:n,type:"keyup",handler:function(t){return e._handleKeyUp(t?t:f.event)}});if(o.isIE){t.push({target:u,type:"keyup",handler:function(t){return e._handleDocKeyUp(t?t:f.event)}})}t.push({target:n,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}});t.push({target:n,type:"copy",handler:function(t){return e._handleCopy(t?t:f.event)}});t.push({target:n,type:"cut",handler:function(t){return e._handleCut(t?t:f.event)}});t.push({target:n,type:"paste",handler:function(t){return e._handlePaste(t?t:f.event)}});if(o.isIOS||o.isAndroid){t.push({target:u,type:"selectionchange",handler:function(t){return e._handleSelectionChange(t?t:f.event)}});t.push({target:n,type:"touchstart",handler:function(t){return e._handleTouchStart(t?t:f.event)}});t.push({target:n,type:"touchmove",handler:function(t){return e._handleTouchMove(t?t:f.event)}});t.push({target:n,type:"touchend",handler:function(t){return e._handleTouchEnd(t?t:f.event)}})}else{t.push({target:n,type:"selectstart",handler:function(t){return e._handleSelectStart(t?t:f.event)}});t.push({target:n,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}});t.push({target:n,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}});t.push({target:n,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}});t.push({target:l,type:"mouseup",handler:function(t){return e._handleMouseUp(t?t:f.event)}});t.push({target:l,type:"mousemove",handler:function(t){return e._handleMouseMove(t?t:f.event)}});t.push({target:i,type:"mousedown",handler:function(t){return e._handleRootMouseDown(t?t:f.event)}});t.push({target:i,type:"mouseup",handler:function(t){return e._handleRootMouseUp(t?t:f.event)}});t.push({target:s,type:"dragstart",handler:function(t){return e._handleDragStart(t?t:f.event)}});t.push({target:s,type:"drag",handler:function(t){return e._handleDrag(t?t:f.event)}});t.push({target:s,type:"dragend",handler:function(t){return e._handleDragEnd(t?t:f.event)}});t.push({target:s,type:"dragenter",handler:function(t){return e._handleDragEnter(t?t:f.event)}});t.push({target:s,type:"dragover",handler:function(t){return e._handleDragOver(t?t:f.event)}});t.push({target:s,type:"dragleave",handler:function(t){return e._handleDragLeave(t?t:f.event)}});t.push({target:s,type:"drop",handler:function(t){return e._handleDrop(t?t:f.event)}});t.push({target:this._clientDiv,type:o.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}});if(this._clipDiv){t.push({target:this._clipDiv,type:o.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}})}if(o.isFirefox&&(!o.isWindows||o.isFirefox>=15)){var c=f.MutationObserver||f.MozMutationObserver;if(c){this._mutationObserver=new c(function(t){e._handleDataModified(t)});this._mutationObserver.observe(n,{subtree:true,characterData:true})}else{t.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(t){return e._handleDataModified(t?t:f.event)}})}}if(this._overlayDiv){t.push({target:this._overlayDiv,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}});t.push({target:this._overlayDiv,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}});t.push({target:this._overlayDiv,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}});t.push({target:this._overlayDiv,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}})}if(!this._isW3CEvents){t.push({target:this._clientDiv,type:"dblclick",handler:function(t){return e._handleDblclick(t?t:f.event)}})}}this._hookRulerEvents(this._leftDiv,t);this._hookRulerEvents(this._rightDiv,t);this._hookRulerEvents(this._marginDiv,t);for(var h=0;h<t.length;h++){var p=t[h];a(p.target,p.type,p.handler,p.capture)}},_hookRulerEvents:function(e,t){if(!e){return}var n=this;var r=this._getWindow();if(o.isIE){t.push({target:e,type:"selectstart",handler:function(){return false}})}t.push({target:e,type:o.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(e){return n._handleMouseWheel(e?e:r.event)}});t.push({target:e,type:"click",handler:function(e){n._handleRulerEvent(e?e:r.event)}});t.push({target:e,type:"dblclick",handler:function(e){n._handleRulerEvent(e?e:r.event)}});t.push({target:e,type:"mousemove",handler:function(e){n._handleRulerEvent(e?e:r.event)}});t.push({target:e,type:"mouseover",handler:function(e){n._handleRulerEvent(e?e:r.event)}});t.push({target:e,type:"mouseout",handler:function(e){n._handleRulerEvent(e?e:r.event)}})},_getWindow:function(){return u(this._parent.ownerDocument)},_ignoreEvent:function(e){var t=e.target;while(t&&t!==this._clientDiv){if(t.ignore){return true}t=t.parentNode}return false},_init:function(e){var n=e.parent;if(typeof n==="string"){n=(e.document||document).getElementById(n)}if(!n){throw"no parent"}e.parent=n;e.model=e.model||new t.TextModel;var r=this._defaultOptions();for(var i in r){if(r.hasOwnProperty(i)){var s;if(e[i]!==undefined){s=e[i]}else{s=r[i].value}this["_"+i]=s}}this._keyModes=[];this._rulers=[];this._selection=new b(0,0,false);this._linksVisible=false;this._redrawCount=0;this._maxLineWidth=0;this._maxLineIndex=-1;this._ignoreSelect=true;this._ignoreFocus=false;this._hasFocus=false;this._columnX=-1;this._dragOffset=-1;this._isRangeRects=(!o.isIE||o.isIE>=9)&&typeof n.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=n.addEventListener;this._autoScrollX=null;this._autoScrollY=null;this._autoScrollTimerID=null;this._AUTO_SCROLL_RATE=50;this._grabControl=null;this._moseMoveClosure=null;this._mouseUpClosure=null;this._lastMouseX=0;this._lastMouseY=0;this._lastMouseTime=0;this._clickCount=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=false;this._doubleClickSelection=null;this._hScroll=0;this._vScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(e,t){if(this._readonly&&!e._code){return}e.type="Verify";this.onVerify(e);if(e.text===null||e.text===undefined){return}var n=this._model;try{if(e._ignoreDOMSelection){this._ignoreDOMSelection=true}n.setText(e.text,e.start,e.end)}finally{if(e._ignoreDOMSelection){this._ignoreDOMSelection=false}}if(t){var r=this._getSelection();r.setCaret(e.start+e.text.length);this._setSelection(r,true)}this.onModify({type:"Modify"})},_onModelChanged:function(e){e.type="ModelChanged";this.onModelChanged(e);e.type="Changed";var t=e.start;var n=e.addedCharCount;var r=e.removedCharCount;var i=e.addedLineCount;var s=e.removedLineCount;var o=this._getSelection();if(o.end>t){if(o.end>t&&o.start<t+r){o.setCaret(t+n)}else{o.start+=n-r;o.end+=n-r}this._setSelection(o,false,false)}var u=this._model;var a=u.getLineAtOffset(t);var f=this._getLineNext();while(f){var l=f.lineIndex;if(a<=l&&l<=a+s){if(a===l&&!f.modelChangedEvent&&!f.lineRemoved){f.modelChangedEvent=e;f.lineChanged=true}else{f.lineRemoved=true;f.lineChanged=false;f.modelChangedEvent=null}}if(l>a+s){f.lineIndex=l+i-s;f._line.lineIndex=f.lineIndex}f=this._getLineNext(f)}if(this._lineHeight){var c=[a,s].concat(new Array(i));Array.prototype.splice.apply(this._lineHeight,c)}if(!this._wrapMode){if(a<=this._maxLineIndex&&this._maxLineIndex<=a+s){this._checkMaxLineIndex=this._maxLineIndex;this._maxLineIndex=-1;this._maxLineWidth=0}}this._update()},_onModelChanging:function(e){e.type="ModelChanging";this.onModelChanging(e);e.type="Changing"},_queueUpdate:function(){if(this._updateTimer||this._ignoreQueueUpdate){return}var e=this;var t=this._getWindow();this._updateTimer=t.setTimeout(function(){e._updateTimer=null;e._update()},0)},_resetLineHeight:function(e,t){if(this._wrapMode||this._variableLineHeight){if(e!==undefined&&t!==undefined){for(var n=e;n<t;n++){this._lineHeight[n]=undefined}}else{this._lineHeight=new Array(this._model.getLineCount())}this._calculateLineHeightTimer()}else{this._lineHeight=null}},_resetLineWidth:function(){var e=this._clientDiv;if(e){var t=e.firstChild;while(t){t.lineWidth=undefined;t=t.nextSibling}}},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._topChild=null;this._bottomChild=null;this._topIndexY=0;this._variableLineHeight=false;this._resetLineHeight();this._setSelection(new b(0,0,false),false,false);if(this._viewDiv){this._viewDiv.scrollLeft=0;this._viewDiv.scrollTop=0}var e=this._clientDiv;if(e){var t=e.firstChild;while(t){t.lineRemoved=true;t=t.nextSibling}if(o.isFirefox){this._ignoreFocus=false;var n=this._hasFocus;if(n){e.blur()}e.contentEditable=false;e.contentEditable=true;if(n){e.focus()}this._ignoreFocus=false}}},_scrollViewAnimated:function(e,t,n){var r=this._getWindow();if(n&&this._scrollAnimation){var i=this;this._animation=new y({window:r,duration:this._scrollAnimation,curve:[t,0],onAnimate:function(e){var n=t-Math.floor(e);i._scrollView(0,n);t-=n},onEnd:function(){i._animation=null;i._scrollView(e,t);if(n){r.setTimeout(n,0)}}});this._animation.play()}else{this._scrollView(e,t);if(n){r.setTimeout(n,0)}}},_scrollView:function(e,t){this._ensureCaretVisible=false;var n=this._viewDiv;if(e){n.scrollLeft+=e}if(t){n.scrollTop+=t}},_setClipboardText:function(e,t){var n;var r=this._getWindow();var i=r.clipboardData;if(!i&&t){i=t.clipboardData}if(i){n=[];d(e,function(e){n.push(e)},function(){n.push(o.platformDelimiter)});if(i.setData(o.isIE?"Text":"text/plain",n.join(""))){return true}}var s=this._parent.ownerDocument;var u=o.createElement(s,"pre");u.style.position="fixed";u.style.left="-1000px";d(e,function(e){u.appendChild(s.createTextNode(e))},function(){u.appendChild(o.createElement(s,"br"))});u.appendChild(s.createTextNode(" "));this._clientDiv.appendChild(u);var a=s.createRange();a.setStart(u.firstChild,0);a.setEndBefore(u.lastChild);var f=r.getSelection();if(f.rangeCount>0){f.removeAllRanges()}f.addRange(a);var l=this;var c=function(){if(u&&u.parentNode===l._clientDiv){l._clientDiv.removeChild(u)}l._updateDOMSelection()};var h=false;this._ignoreCopy=true;try{h=s.execCommand("copy",false,null)}catch(p){}this._ignoreCopy=false;if(!h){if(t){r.setTimeout(c,0);return false}}c();return true},_setDOMSelection:function(e,t,n,r,i){var s,u,a,f;var l=0;var c=e.firstChild;var h,p,d=this._model;var v=d.getLine(e.lineIndex).length;while(c){if(c.ignore){c=c.nextSibling;continue}h=c.firstChild;p=h.length;if(c.ignoreChars){p-=c.ignoreChars}if(l+p>t||l+p>=v){s=h;u=t-l;if(c.ignoreChars&&p>0&&u===p){u+=c.ignoreChars}break}l+=p;c=c.nextSibling}l=0;c=n.firstChild;var m=this._model.getLine(n.lineIndex).length;while(c){if(c.ignore){c=c.nextSibling;continue}h=c.firstChild;p=h.length;if(c.ignoreChars){p-=c.ignoreChars}if(p+l>r||l+p>=m){a=h;f=r-l;if(c.ignoreChars&&p>0&&f===p){f+=c.ignoreChars}break}l+=p;c=c.nextSibling}this._setDOMFullSelection(e,t,v,n,r,m);var g;var y=this._getWindow();var b=this._parent.ownerDocument;if(y.getSelection){var w=y.getSelection();g=b.createRange();g.setStart(s,u);g.setEnd(a,f);if(this._hasFocus&&(w.anchorNode!==s||w.anchorOffset!==u||w.focusNode!==a||w.focusOffset!==f||w.anchorNode!==a||w.anchorOffset!==f||w.focusNode!==s||w.focusOffset!==u)){this._anchorNode=s;this._anchorOffset=u;this._focusNode=a;this._focusOffset=f;this._ignoreSelect=false;if(w.rangeCount>0){w.removeAllRanges()}w.addRange(g);this._ignoreSelect=true}if(this._cursorDiv){g=b.createRange();if(i){g.setStart(s,u);g.setEnd(s,u)}else{g.setStart(a,f);g.setEnd(a,f)}var E=g.getClientRects()[0];var S=this._cursorDiv.parentNode;var x=S.getBoundingClientRect();if(E&&x){this._cursorDiv.style.top=E.top-x.top+S.scrollTop+"px";this._cursorDiv.style.left=E.left-x.left+S.scrollLeft+"px"}}}else if(b.selection){if(!this._hasFocus){return}var T=b.body;var N=o.createElement(b,"div");T.appendChild(N);T.removeChild(N);g=T.createTextRange();g.moveToElementText(s.parentNode);g.moveStart("character",u);var C=T.createTextRange();C.moveToElementText(a.parentNode);C.moveStart("character",f);g.setEndPoint("EndToStart",C);this._ignoreSelect=false;g.select();this._ignoreSelect=true}},_setDOMFullSelection:function(e,t,n,r,i,s){if(!this._selDiv1){return}var o=this._selDiv1;o.style.width="0px";o.style.height="0px";o=this._selDiv2;o.style.width="0px";o.style.height="0px";o=this._selDiv3;o.style.width="0px";o.style.height="0px";if(e===r&&t===i){return}var u=this._model;var a=this._getViewPadding();var f=this._clientDiv.getBoundingClientRect();var l=this._viewDiv.getBoundingClientRect();var c=l.left+a.left;var h=f.right;var p=l.top+a.top;var d=f.bottom;var v=0,m=0;if(this._clipDiv){var g=this._clipDiv.getBoundingClientRect();v=g.left-this._clipDiv.scrollLeft;m=g.top}else{var y=this._rootDiv.getBoundingClientRect();v=y.left;m=y.top}this._ignoreDOMSelection=true;var b=new E(this,e.lineIndex,e);var w=b.getBoundingClientRect(u.getLineStart(e.lineIndex)+t,false);var S=w.left;var x=new E(this,r.lineIndex,r);var T=x.getBoundingClientRect(u.getLineStart(r.lineIndex)+i,false);var N=T.left;this._ignoreDOMSelection=false;var C=this._selDiv1;var k=Math.min(h,Math.max(c,S));var L=Math.min(d,Math.max(p,w.top));var A=h;var O=Math.min(d,Math.max(p,w.bottom));C.style.left=k-v+"px";C.style.top=L-m+"px";C.style.width=Math.max(0,A-k)+"px";C.style.height=Math.max(0,O-L)+"px";if(e.lineIndex===r.lineIndex){A=Math.min(N,h);C.style.width=Math.max(0,A-k)+"px"}else{var M=c;var _=Math.min(d,Math.max(p,T.top));var D=Math.min(h,Math.max(c,N));var P=Math.min(d,Math.max(p,T.bottom));var H=this._selDiv3;H.style.left=M-v+"px";H.style.top=_-m+"px";H.style.width=Math.max(0,D-M)+"px";H.style.height=Math.max(0,P-_)+"px";if(Math.abs(e.lineIndex-r.lineIndex)>1){var B=this._selDiv2;B.style.left=c-v+"px";B.style.top=O-m+"px";B.style.width=Math.max(0,h-c)+"px";B.style.height=Math.max(0,_-O)+"px"}}},_setGrab:function(e){if(e===this._grabControl){return}if(e){if(e.setCapture){e.setCapture()}this._grabControl=e}else{if(this._grabControl.releaseCapture){this._grabControl.releaseCapture()}this._grabControl=null}},_setLinksVisible:function(e){if(this._linksVisible===e){return}this._linksVisible=e;if(o.isIE&&e){this._hadFocus=this._hasFocus}var t=this._clientDiv;t.contentEditable=!e;if(this._hadFocus&&!e){t.focus()}if(this._overlayDiv){this._overlayDiv.style.zIndex=e?"-1":"1"}var n=this._getLineNext();while(n){if(n.hasLink){var r=n.firstChild;while(r){if(r.ignore){r=r.nextSibling;continue}var i=r.nextSibling;var s=r.viewStyle;if(s&&s.tagName&&s.tagName.toLowerCase()==="a"){n.replaceChild(n._line._createSpan(n,r.firstChild.data,s),r)}r=i}}n=this._getLineNext(n)}this._updateDOMSelection()},_setSelection:function(e,t,n,r,i){if(e){this._columnX=-1;if(n===undefined){n=true}var s=this._selection;this._selection=e;if(t!==false){this._showCaret(false,r,t,i)}if(n){this._updateDOMSelection()}if(!s.equals(e)){var o={type:"Selection",oldValue:{start:s.start,end:s.end},newValue:{start:e.start,end:e.end}};this.onSelection(o)}}},_setSelectionTo:function(e,t,n,r){var i=this._model,s;var o=this._getSelection();var u=this.convert({x:e,y:t},"page","document");var a=this._getLineIndex(u.y),f;if(this._clickCount===1){f=this._getLine(a);s=f.getOffset(u.x,u.y-this._getLinePixel(a));f.destroy();if(r&&!n){if(o.start<=s&&s<o.end){this._dragOffset=s;return false}}o.extend(s);if(!n){o.collapse()}}else{var l=(this._clickCount&1)===0;var c,h;if(l){f=this._getLine(a);s=f.getOffset(u.x,u.y-this._getLinePixel(a));if(this._doubleClickSelection){if(s>=this._doubleClickSelection.start){c=this._doubleClickSelection.start;h=f.getNextOffset(s,{unit:"wordend",count:1})}else{c=f.getNextOffset(s,{unit:"word",count:-1});h=this._doubleClickSelection.end}}else{c=f.getNextOffset(s,{unit:"word",count:-1});h=f.getNextOffset(c,{unit:"wordend",count:1})}f.destroy()}else{if(this._doubleClickSelection){var p=i.getLineAtOffset(this._doubleClickSelection.start);if(a>=p){c=i.getLineStart(p);h=i.getLineEnd(a)}else{c=i.getLineStart(a);h=i.getLineEnd(p)}}else{c=i.getLineStart(a);h=i.getLineEnd(a)}}o.setCaret(c);o.extend(h)}this._setSelection(o,true,true);return true},_setFullSelection:function(e,t){this._fullSelection=e;if(o.isWebkit){this._fullSelection=true}var n=this._clipDiv||this._rootDiv;if(!n){return}if(!this._fullSelection){if(this._selDiv1){n.removeChild(this._selDiv1);this._selDiv1=null}if(this._selDiv2){n.removeChild(this._selDiv2);this._selDiv2=null}if(this._selDiv3){n.removeChild(this._selDiv3);this._selDiv3=null}return}if(!this._selDiv1&&this._fullSelection&&!o.isIOS){var r=n.ownerDocument;this._highlightRGB=o.isWebkit?"transparent":"Highlight";var i=o.createElement(r,"div");this._selDiv1=i;i.style.position="absolute";i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.background=this._highlightRGB;i.style.width="0px";i.style.height="0px";i.style.zIndex="0";n.appendChild(i);var s=o.createElement(r,"div");this._selDiv2=s;s.style.position="absolute";s.style.borderWidth="0px";s.style.margin="0px";s.style.padding="0px";s.style.outline="none";s.style.background=this._highlightRGB;s.style.width="0px";s.style.height="0px";s.style.zIndex="0";n.appendChild(s);var u=o.createElement(r,"div");this._selDiv3=u;u.style.position="absolute";u.style.borderWidth="0px";u.style.margin="0px";u.style.padding="0px";u.style.outline="none";u.style.background=this._highlightRGB;u.style.width="0px";u.style.height="0px";u.style.zIndex="0";n.appendChild(u);if(o.isFirefox&&o.isMac){var a=this._getWindow();var f=a.getComputedStyle(u,null);var l=f.getPropertyValue("background-color");switch(l){case"rgb(119, 141, 168)":l="rgb(199, 208, 218)";break;case"rgb(127, 127, 127)":l="rgb(198, 198, 198)";break;case"rgb(255, 193, 31)":l="rgb(250, 236, 115)";break;case"rgb(243, 70, 72)":l="rgb(255, 176, 139)";break;case"rgb(255, 138, 34)":l="rgb(255, 209, 129)";break;case"rgb(102, 197, 71)":l="rgb(194, 249, 144)";break;case"rgb(140, 78, 184)":l="rgb(232, 184, 255)";break;default:l="rgb(180, 213, 255)";break}this._highlightRGB=l;i.style.background=l;s.style.background=l;u.style.background=l}if(!t){this._updateDOMSelection()}}},_setBlockCursor:function(e){this._blockCursorVisible=e;this._updateBlockCursorVisible()},_setOverwriteMode:function(e){this._overwriteMode=e;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var e=o.createElement(document,"div");e.className="textviewBlockCursor";this._cursorDiv=e;e.tabIndex=-1;e.style.zIndex="2";e.style.color="transparent";e.style.position="absolute";e.style.pointerEvents="none";e.innerHTML="&nbsp;";this._viewDiv.appendChild(e);this._updateDOMSelection()}}else{if(this._cursorDiv){this._cursorDiv.parentNode.removeChild(this._cursorDiv);this._cursorDiv=null}}},_setMarginOffset:function(e,t){this._marginOffset=e;this._marginDiv.style.display=e?"block":"none";if(!t){this._metrics=this._calculateMetrics();this._queueUpdate()}},_setWrapOffset:function(e,t){this._wrapOffset=e;if(!t){this._metrics=this._calculateMetrics();this._queueUpdate()}},_setReadOnly:function(e){this._readonly=e;this._clientDiv.setAttribute("aria-readonly",e?"true":"false")},_setSingleMode:function(e,t){this._singleMode=e;this._updateOverflow();this._updateStyle(t)},_setTabSize:function(e,t){this._tabSize=e;this._customTabSize=undefined;var n=this._clientDiv;if(o.isOpera){if(n){n.style.OTabSize=this._tabSize+""}}else if(o.isWebkit>=537.1){if(n){n.style.tabSize=this._tabSize+""}}else if(o.isFirefox>=4){if(n){n.style.MozTabSize=this._tabSize+""}}else if(this._tabSize!==8){this._customTabSize=this._tabSize}if(!t){this.redrawLines();this._resetLineWidth()}},_setTheme:function(e){if(this._theme){this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged)}this._theme=e;if(this._theme){this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged)}this._setThemeClass(this._themeClass)},_setThemeClass:function(e,t){this._themeClass=e;var n="textview";var r=this._theme.getThemeClass();if(r){n+=" "+r}if(this._themeClass&&r!==this._themeClass){n+=" "+this._themeClass}this._rootDiv.className=n;this._updateStyle(t)},_setWrapMode:function(e,t){this._wrapMode=e&&this._wrappable;var n=this._clientDiv;if(this._wrapMode){n.style.whiteSpace="pre-wrap";n.style.wordWrap="break-word"}else{n.style.whiteSpace="pre";n.style.wordWrap="normal"}this._updateOverflow();if(!t){this.redraw();this._resetLineWidth()}this._resetLineHeight()},_showCaret:function(e,t,n,r){if(!this._clientDiv){return}var i=this._model;var s=this._getSelection();var o=this._getScroll();var u=s.getCaret();var a=s.start;var f=s.end;var l=i.getLineAtOffset(f);var c=Math.max(Math.max(a,i.getLineStart(l)),f-1);var h=this._getClientWidth();var p=this._getClientHeight();var d=h/4;var v=this._getBoundsAtOffset(u===a?a:c);var m=v.left;var g=v.right;var y=v.top;var b=v.bottom;if(e&&!s.isEmpty()){v=this._getBoundsAtOffset(u===f?a:c);if(v.top===y){if(u===a){g=m+Math.min(v.right-m,h)}else{m=g-Math.min(g-v.left,h)}}else{if(u===a){b=y+Math.min(v.bottom-y,p)}else{y=b-Math.min(b-v.top,p)}}}var w=0;if(m<o.x){w=Math.min(m-o.x,-d)}if(g>o.x+h){w=Math.max(g-o.x-h,d)}var E=0;if(y<o.y){E=y-o.y}else if(b>o.y+p){E=b-o.y-p}if(r){if(r>0){if(E>0){E=Math.max(E,r)}}else{if(E<0){E=Math.min(E,r)}}}if(w!==0||E!==0){if(E!==0&&typeof n==="number"){if(n<0){n=0}if(n>1){n=1}E+=Math.floor(E>0?n*p:-n*p)}this._scrollViewAnimated(w,E,t);if(p!==this._getClientHeight()||h!==this._getClientWidth()){this._showCaret()}else{this._ensureCaretVisible=true}return true}else{if(t){t()}}return false},_startIME:function(){if(this._imeOffset!==-1){return}var e=this._getSelection();if(!e.isEmpty()){this._modifyContent({text:"",start:e.start,end:e.end},true)}this._imeOffset=e.start},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var e=0;e<this._handlers.length;e++){var t=this._handlers[e];f(t.target,t.type,t.handler)}this._handlers=null;if(this._mutationObserver){this._mutationObserver.disconnect();this._mutationObserver=null}},_updateDOMSelection:function(){if(this._redrawCount>0){return}if(this._ignoreDOMSelection){return}if(!this._clientDiv){return}var e=this._getSelection();var t=this._model;var n=t.getLineAtOffset(e.start);var r=t.getLineAtOffset(e.end);var i=this._getLineNext();if(!i){return}var s=this._getLinePrevious();var o,u,a,f;if(n<i.lineIndex){o=i;a=0}else if(n>s.lineIndex){o=s;a=0}else{o=this._getLineNode(n);a=e.start-t.getLineStart(n)}if(r<i.lineIndex){u=i;f=0}else if(r>s.lineIndex){u=s;f=0}else{u=this._getLineNode(r);f=e.end-t.getLineStart(r)}this._setDOMSelection(o,a,u,f,e.caret)},_update:function(e){if(this._redrawCount>0){return}if(this._updateTimer){var t=this._getWindow();t.clearTimeout(this._updateTimer);this._updateTimer=null;e=false}var n=this._clientDiv;var r=this._viewDiv;if(!n){return}if(this._metrics.invalid){this._ignoreQueueUpdate=true;this._updateStyle();this._ignoreQueueUpdate=false}var i=this._model;var s=this._getScroll(false);var u=this._getViewPadding();var a=i.getLineCount();var f=this._getLineHeight();var l=false;var c=false,h=false;var p=this._metrics.scrollWidth;if(this._wrapMode){n.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px"}var d,v,m,g,y,b,w,S,x,T,N=0,C=0,k;if(this._lineHeight){while(C<a){k=this._getLineHeight(C);if(N+k>s.y){break}N+=k;C++}d=C;v=Math.max(0,d-1);g=m=s.y-N;if(d>0){m+=this._getLineHeight(d-1)}}else{var L=Math.max(0,s.y)/f;d=Math.floor(L);v=Math.max(0,d-1);m=Math.round((L-v)*f);g=Math.round((L-d)*f);T=a*f}this._topIndexY=g;var A=this._rootDiv;var O=A.clientWidth;var M=A.clientHeight;if(e){y=0;if(this._leftDiv){b=this._leftDiv.getBoundingClientRect();y=b.right-b.left}w=this._getClientWidth();S=this._getClientHeight();x=w;if(this._wrapMode){if(this._metrics.wrapWidth){x=this._metrics.wrapWidth}}else{x=Math.max(this._maxLineWidth,x)}while(C<a){k=this._getLineHeight(C,false);N+=k;C++}T=N}else{S=this._getClientHeight();var _=Math.floor((S+g)/f);var D=Math.min(d+_,a-1);var P=Math.min(D+1,a-1);var H,B;var j=n.firstChild;while(j){H=j.lineIndex;var F=j.nextSibling;if(!(v<=H&&H<=P)||j.lineRemoved||j.lineIndex===-1){if(this._mouseWheelLine===j){j.style.display="none";j.lineIndex=-1}else{n.removeChild(j)}}j=F}j=this._getLineNext();var I=r.ownerDocument;var q=I.createDocumentFragment();for(H=v;H<=P;H++){if(!j||j.lineIndex>H){(new E(this,H)).create(q,null)}else{if(q.firstChild){n.insertBefore(q,j);q=I.createDocumentFragment()}if(j&&j.lineChanged){j=(new E(this,H)).create(q,j);j.lineChanged=false}j=this._getLineNext(j)}}if(q.firstChild){n.insertBefore(q,j)}if(o.isWebkit&&!this._wrapMode){n.style.width="0x7fffffffpx"}var R;j=this._getLineNext();var U=S+m;var z=false;while(j){B=j.lineWidth;if(B===undefined){R=j._line.getBoundingClientRect();B=j.lineWidth=Math.ceil(R.right-R.left);var W=R.bottom-R.top;if(this._lineHeight){this._lineHeight[j.lineIndex]=W}else if(f!==0&&W!==0&&Math.ceil(f)!==Math.ceil(W)){this._variableLineHeight=true;this._lineHeight=[];this._lineHeight[j.lineIndex]=W}}if(this._lineHeight&&!z){U-=this._lineHeight[j.lineIndex];if(U<0){D=j.lineIndex;z=true}}if(!this._wrapMode){if(B>=this._maxLineWidth){this._maxLineWidth=B;this._maxLineIndex=j.lineIndex}if(this._checkMaxLineIndex===j.lineIndex){this._checkMaxLineIndex=-1}}if(j.lineIndex===d){this._topChild=j}if(j.lineIndex===D){this._bottomChild=j}j=this._getLineNext(j)}if(this._checkMaxLineIndex!==-1){H=this._checkMaxLineIndex;this._checkMaxLineIndex=-1;if(0<=H&&H<a){var X=new E(this,H);R=X.getBoundingClientRect();B=R.right-R.left;if(B>=this._maxLineWidth){this._maxLineWidth=B;this._maxLineIndex=H}X.destroy()}}while(C<a){k=this._getLineHeight(C,C<=D);N+=k;C++}T=N;this._updateRuler(this._leftDiv,d,P,M);this._updateRuler(this._rightDiv,d,P,M);this._updateRuler(this._marginDiv,d,P,M);y=0;if(this._leftDiv){b=this._leftDiv.getBoundingClientRect();y=b.right-b.left}var V=0;if(this._rightDiv){var $=this._rightDiv.getBoundingClientRect();V=$.right-$.left}r.style.left=y+"px";r.style.right=V+"px";var J=this._scrollDiv;J.style.height=T+"px";w=this._getClientWidth();if(!this._singleMode&&!this._wrapMode){var K=S,Q=S;var G=r.style.overflowX==="scroll";if(G){K+=p}else{Q-=p}var Y=w,Z=w;var et=r.style.overflowY==="scroll";if(et){Y+=p}else{Z-=p}S=K;w=Y;if(T>S){h=true;w=Z}if(this._maxLineWidth>w){c=true;S=Q;if(T>S){h=true;w=Z}}if(G!==c){r.style.overflowX=c?"scroll":"hidden"}if(et!==h){r.style.overflowY=h?"scroll":"hidden"}l=G!==c||et!==h}var tt=w;if(this._wrapMode){if(this._metrics.wrapWidth){tt=this._metrics.wrapWidth}}else{tt=Math.max(this._maxLineWidth,tt)}x=tt;if((!o.isIE||o.isIE>=9)&&this._maxLineWidth>w){tt+=u.right+u.left}J.style.width=tt+"px";if(this._clipScrollDiv){this._clipScrollDiv.style.width=tt+"px"}s=this._getScroll(false)}if(this._vScrollDiv){var nt=S-8;var rt=Math.max(15,Math.ceil(Math.min(1,nt/(T+u.top+u.bottom))*nt));this._vScrollDiv.style.left=y+w-8+"px";this._vScrollDiv.style.top=Math.floor(Math.max(0,s.y*nt/T))+"px";this._vScrollDiv.style.height=rt+"px"}if(!this._wrapMode&&this._hScrollDiv){var it=w-8;var st=Math.max(15,Math.ceil(Math.min(1,it/(this._maxLineWidth+u.left+u.right))*it));this._hScrollDiv.style.left=y+Math.floor(Math.max(0,Math.floor(s.x*it/this._maxLineWidth)))+"px";this._hScrollDiv.style.top=S-9+"px";this._hScrollDiv.style.width=st+"px"}var ot=s.x;var ut=this._clipDiv;var at=this._overlayDiv;var ft=this._marginDiv;var lt,ct;if(ft){ft.style.left=-ot+y+this._metrics.marginWidth+u.left+"px";ft.style.bottom=(r.style.overflowX==="scroll"?p:0)+"px"}if(ut){ut.scrollLeft=ot;ut.scrollTop=0;lt=y+u.left;ct=u.top;var ht=w;var pt=S;var dt=0,vt=-m;if(s.x===0){lt-=u.left;ht+=u.left;dt=u.left}if(s.x+w===x){ht+=u.right}if(s.y===0){ct-=u.top;pt+=u.top;vt+=u.top}if(s.y+S===T){pt+=u.bottom}ut.style.left=lt+"px";ut.style.top=ct+"px";ut.style.right=O-ht-lt+"px";ut.style.bottom=M-pt-ct+"px";n.style.left=dt+"px";n.style.top=vt+"px";n.style.width=x+"px";n.style.height=S+m+"px";if(at){at.style.left=n.style.left;at.style.top=n.style.top;at.style.width=n.style.width;at.style.height=n.style.height}}else{lt=ot;ct=m;var mt=ot+w;var gt=m+S;if(lt===0){lt-=u.left}if(ct===0){ct-=u.top}if(mt===x){mt+=u.right}if(s.y+S===T){gt+=u.bottom}n.style.clip="rect("+ct+"px,"+mt+"px,"+gt+"px,"+lt+"px)";n.style.left=-ot+y+u.left+"px";n.style.width=(this._wrapMode||o.isWebkit?x:w+ot)+"px";if(!e){n.style.top=-m+u.top+"px";n.style.height=S+m+"px"}if(at){at.style.clip=n.style.clip;at.style.left=n.style.left;at.style.width=n.style.width;if(!e){at.style.top=n.style.top;at.style.height=n.style.height}}}this._updateDOMSelection();if(l){var yt=this._ensureCaretVisible;this._ensureCaretVisible=false;if(yt){this._showCaret()}this._queueUpdate()}},_updateOverflow:function(){var e=this._viewDiv;if(this._wrapMode){e.style.overflowX="hidden";e.style.overflowY="scroll"}else{e.style.overflow="hidden"}},_updateRuler:function(e,t,n,r){if(!e){return}var i=this._parent.ownerDocument;var s=this._getLineHeight();var u=this._getViewPadding();var a=e.firstChild;while(a){var f=a._ruler;var c=s;var h=f.getOverview();if(h==="page"){c+=this._topIndexY}a.style.top=-c+"px";a.style.height=r+c+"px";if(a.rulerChanged){l(f.getRulerStyle(),a)}var p;var d=a.firstChild;if(d){p=d;d=d.nextSibling}else{p=o.createElement(i,"div");p.style.visibility="hidden";a.appendChild(p)}var v,m;if(a.rulerChanged){if(p){v=-1;m=f.getWidestAnnotation();if(m){l(m.style,p);if(m.html){p.innerHTML=m.html}}p.lineIndex=v;p.style.height=s+u.top+"px"}}var g,y,b;if(h==="page"){b=f.getAnnotations(t,n+1);while(d){v=d.lineIndex;var w=d.nextSibling;if(!(t<=v&&v<=n)||d.lineChanged){a.removeChild(d)}d=w}d=a.firstChild.nextSibling;y=i.createDocumentFragment();for(v=t;v<=n;v++){if(!d||d.lineIndex>v){g=o.createElement(i,"div");m=b[v];if(m){l(m.style,g);if(m.html){g.innerHTML=m.html}g.annotation=m}g.lineIndex=v;g.style.height=this._getLineHeight(v)+"px";y.appendChild(g)}else{if(y.firstChild){a.insertBefore(y,d);y=i.createDocumentFragment()}if(d){d=d.nextSibling}}}if(y.firstChild){a.insertBefore(y,d)}}else{var E=this._getClientHeight();var S=this._model.getLineCount();var x=s*S;var T=E+u.top+u.bottom-2*this._metrics.scrollWidth;var N;if(x<T){N=s}else{N=T/S}if(a.rulerChanged){var C=a.childNodes.length;while(C>1){a.removeChild(a.lastChild);C--}b=f.getAnnotations(0,S);y=i.createDocumentFragment();for(var k in b){v=k>>>0;if(v<0){continue}g=o.createElement(i,"div");m=b[k];l(m.style,g);g.style.position="absolute";g.style.top=this._metrics.scrollWidth+s+Math.floor(v*N)+"px";if(m.html){g.innerHTML=m.html}g.annotation=m;g.lineIndex=v;y.appendChild(g)}a.appendChild(y)}else if(a._oldTrackHeight!==T){g=a.firstChild?a.firstChild.nextSibling:null;while(g){g.style.top=this._metrics.scrollWidth+s+Math.floor(g.lineIndex*N)+"px";g=g.nextSibling}}a._oldTrackHeight=T}a.rulerChanged=false;a=a.nextSibling}},_updateStyleSheet:function(){var e="";if(o.isWebkit&&this._metrics.scrollWidth>0){e+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"}if(o.isFirefox&&o.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"){e+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}"}if(e){var t=document.getElementById("_textviewStyle");if(!t){t=o.createElement(document,"style");t.id="_textviewStyle";var n=document.getElementsByTagName("head")[0]||document.documentElement;t.appendChild(document.createTextNode(e));n.insertBefore(t,n.firstChild)}else{t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},_updateStyle:function(e){if(!e&&o.isIE){this._rootDiv.style.lineHeight="normal"}var t=this._metrics=this._calculateMetrics();if(o.isIE){this._rootDiv.style.lineHeight=t.lineHeight-(t.lineTrim.top+t.lineTrim.bottom)+"px"}else{this._rootDiv.style.lineHeight="normal"}this._updateStyleSheet();if(!e){this.redraw();this._resetLineWidth()}}};r.EventTarget.addMixin(S.prototype);return{TextView:S}});define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(e,t){function n(e){this._model=e;this._projections=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)},onChanging:function(e){t._onChanging(e)}};e.addEventListener("preChanged",this._listener.onChanged);e.addEventListener("preChanging",this._listener.onChanging)}n.prototype={destroy:function(){if(this._model){this._model.removeEventListener("preChanged",this._listener.onChanged);this._model.removeEventListener("preChanging",this._listener.onChanging);this._model=null}},addProjection:function(t){if(!t){return}var n=this._model,r=this._projections;t._lineIndex=n.getLineAtOffset(t.start);t._lineCount=n.getLineAtOffset(t.end)-t._lineIndex;var i=t.text;if(!i){i=""}if(typeof i==="string"){t._model=new e.TextModel(i,n.getLineDelimiter())}else{t._model=i}var s=this.mapOffset(t.start,true);var o=t.end-t.start;var u=t._lineCount;var a=t._model.getCharCount();var f=t._model.getLineCount()-1;var l={type:"Changing",text:t._model.getText(),start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(l);var c=this._binarySearch(r,t.start);r.splice(c,0,t);var h={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(h)},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(e,t){var n=this._projections,r=0,i,s;if(t){for(i=0;i<n.length;i++){s=n[i];if(s.start>e){break}if(s.end>e){return-1}r+=s._model.getCharCount()-(s.end-s.start)}return e+r}for(i=0;i<n.length;i++){s=n[i];if(s.start>e-r){break}var o=s._model.getCharCount();if(s.start+o>e-r){return-1}r+=o-(s.end-s.start)}return e-r},removeProjection:function(e){var t,n=0;for(t=0;t<this._projections.length;t++){var r=this._projections[t];if(r===e){e=r;break}n+=r._model.getCharCount()-(r.end-r.start)}if(t<this._projections.length){var i=this._model;var s=e.start+n;var o=e.end-e.start;var u=e._lineCount;var a=e._model.getCharCount();var f=e._model.getLineCount()-1;var l={type:"Changing",text:i.getText(e.start,e.end),start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanging(l);this._projections.splice(t,1);var c={type:"Changed",start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanged(c)}},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1){i=Math.floor((n+r)/2);if(t<=e[i].start){n=i}else{r=i}}return n},getCharCount:function(){var e=this._model.getCharCount(),t=this._projections;for(var n=0;n<t.length;n++){var r=t[n];e+=r._model.getCharCount()-(r.end-r.start)}return e},getLine:function(e,t){if(e<0){return null}var n=this._model,r=this._projections;var i=0,s=[],o=0,u,a,f;for(u=0;u<r.length;u++){f=r[u];if(f._lineIndex>=e-i){break}a=f._model.getLineCount()-1;if(f._lineIndex+a>=e-i){var l=e-(f._lineIndex+i);if(l<a){return f._model.getLine(l,t)}else{s.push(f._model.getLine(a))}}o=f.end;i+=a-f._lineCount}o=Math.max(o,n.getLineStart(e-i));for(;u<r.length;u++){f=r[u];if(f._lineIndex>e-i){break}s.push(n.getText(o,f.start));a=f._model.getLineCount()-1;if(f._lineIndex+a>e-i){s.push(f._model.getLine(0,t));return s.join("")}s.push(f._model.getText());o=f.end;i+=a-f._lineCount}var c=n.getLineEnd(e-i,t);if(o<c){s.push(n.getText(o,c))}return s.join("")},getLineAtOffset:function(e){var t=this._model,n=this._projections;var r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o.start>e-r){break}var u=o._model.getCharCount();if(o.start+u>e-r){var a=e-(o.start+r);i+=o._model.getLineAtOffset(a);r+=a;break}i+=o._model.getLineCount()-1-o._lineCount;r+=u-(o.end-o.start)}return t.getLineAtOffset(e-r)+i},getLineCount:function(){var e=this._model,t=this._projections;var n=e.getLineCount();for(var r=0;r<t.length;r++){var i=t[r];n+=i._model.getLineCount()-1-i._lineCount}return n},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(e,t){if(e<0){return-1}var n=this._model,r=this._projections;var i=0,s=0;for(var o=0;o<r.length;o++){var u=r[o];if(u._lineIndex>e-i){break}var a=u._model.getLineCount()-1;if(u._lineIndex+a>e-i){var f=e-(u._lineIndex+i);return u._model.getLineEnd(f,t)+u.start+s}s+=u._model.getCharCount()-(u.end-u.start);i+=a-u._lineCount}return n.getLineEnd(e-i,t)+s},getLineStart:function(e){if(e<0){return-1}var t=this._model,n=this._projections;var r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o._lineIndex>=e-r){break}var u=o._model.getLineCount()-1;if(o._lineIndex+u>=e-r){var a=e-(o._lineIndex+r);return o._model.getLineStart(a)+o.start+i}i+=o._model.getCharCount()-(o.end-o.start);r+=u-o._lineCount}return t.getLineStart(e-r)+i},getText:function(e,t){if(e===undefined){e=0}var n=this._model,r=this._projections;var i=0,s=[],o,u,a;for(o=0;o<r.length;o++){u=r[o];if(u.start>e-i){break}a=u._model.getCharCount();if(u.start+a>e-i){if(t!==undefined&&u.start+a>t-i){return u._model.getText(e-(u.start+i),t-(u.start+i))}else{s.push(u._model.getText(e-(u.start+i)));e=u.end+i+a-(u.end-u.start)}}i+=a-(u.end-u.start)}var f=e-i;if(t!==undefined){for(;o<r.length;o++){u=r[o];if(u.start>t-i){break}s.push(n.getText(f,u.start));a=u._model.getCharCount();if(u.start+a>t-i){s.push(u._model.getText(0,t-(u.start+i)));return s.join("")}s.push(u._model.getText());f=u.end;i+=a-(u.end-u.start)}s.push(n.getText(f,t-i))}else{for(;o<r.length;o++){u=r[o];s.push(n.getText(f,u.start));s.push(u._model.getText());f=u.end}s.push(n.getText(f))}return s.join("")},_onChanged:function(e){var t=this._change;var n=t.baseStart,r=t.baseEnd,i;var s,o=this._projections;for(i=0;i<o.length;i++){s=o[i];if(s.end>n){break}}var u=i;for(i=0;i<o.length;i++){s=o[i];if(s.start>=r){break}}var a=i;var f=this._model;var l=t.baseText.length-(r-n);for(i=a;i<o.length;i++){s=o[i];s.start+=l;s.end+=l;s._lineIndex=f.getLineAtOffset(s.start)}var c=o.splice(u,a-u);for(i=0;i<c.length;i++){if(c[i].annotation){c[i].annotation._expand()}}var h={type:"Changed",start:t.start,removedCharCount:t.removedCharCount,addedCharCount:t.addedCharCount,removedLineCount:t.removedLineCount,addedLineCount:t.addedLineCount};this.onChanged(h);this._change=undefined},_onChanging:function(e){var t=!!this._change;var n=this._change||{};var r=e.start,i=r+e.removedCharCount;n.baseStart=r;n.baseEnd=i;n.baseText=e.text;n.addedLineCount=e.addedLineCount;if(!t){this._change=n;n.text=e.text;var s=this._projections,o,u,a;function f(e){for(u=0,o=0;u<s.length;u++){a=s[u];if(a.start>e){break}if(a.end>e){return-1}o+=a._model.getCharCount()-(a.end-a.start)}return e+o}n.start=f(r);if(n.start===-1){n.text=this._model.getText(a.start,r)+n.text;n.addedLineCount+=this._model.getLineAtOffset(r)-this._model.getLineAtOffset(a.start);n.start=a.start+o}n.end=f(i);if(n.end===-1){n.text+=this._model.getText(i,a.end);n.addedLineCount+=this._model.getLineAtOffset(a.end)-this._model.getLineAtOffset(i);n.end=a.start+o}}n.addedCharCount=n.text.length;n.removedCharCount=n.end-n.start;n.removedLineCount=this.getLineAtOffset(n.end)-this.getLineAtOffset(n.start);var l={type:"Changing",text:n.text,start:n.start,removedCharCount:n.removedCharCount,addedCharCount:n.addedCharCount,removedLineCount:n.removedLineCount,addedLineCount:n.addedLineCount};this.onChanging(l)},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e){this._model.setLineDelimiter(e)},setText:function(e,t,n){function u(e){for(s=0,i=0;s<r.length;s++){o=r[s];if(o.start>e-i){break}var t=o._model.getCharCount();if(o.start+t>e-i){return-1}i+=t-(o.end-o.start)}return e-i}this._change={text:e||"",start:t||0,end:n===undefined?this.getCharCount():n};var r=this._projections,i,s,o;var a,f;var l=u(this._change.start);if(l===-1){a={projection:o,start:this._change.start-(o.start+i)};l=o.end}var c=u(this._change.end);if(c===-1){f={projection:o,end:this._change.end-(o.start+i)};c=o.start}if(a&&f&&a.projection===f.projection){o._model.setText(this._change.text,a.start,f.end)}else{this._model.setText(this._change.text,l,c);if(a){o=a.projection;o._model.setText("",a.start)}if(f){o=f.projection;o._model.setText("",0,f.end);o.start=o.end;o._lineCount=0}}this._change=undefined}};t.EventTarget.addMixin(n.prototype);return{ProjectionTextModel:n}});define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/util","orion/util"],function(e,t,n,r,i,s){function o(e){this._view=e;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5e3;this._create(e.getOptions("parent").ownerDocument)}o.getTooltip=function(e){if(!e._tooltip){e._tooltip=new o(e)}return e._tooltip};o.prototype={_create:function(e){if(this._tooltipDiv){return}var t=this._tooltipDiv=s.createElement(e,"div");t.tabIndex=0;t.className="textviewTooltip";t.setAttribute("aria-live","assertive");t.setAttribute("aria-atomic","true");var n=this._tooltipContents=s.createElement(e,"div");t.appendChild(n);e.body.appendChild(t);var r=this;i.addEventListener(t,"mouseover",function(e){if(!r._hideDelay){return}var t=r._getWindow();if(r._delayedHideTimeout){t.clearTimeout(r._delayedHideTimeout);r._delayedHideTimeout=null}if(r._hideTimeout){t.clearTimeout(r._hideTimeout);r._hideTimeout=null}r._nextTarget=null},false);i.addEventListener(t,"mouseout",function(e){var n=e.relatedTarget||e.toElement;if(n===t||r._hasFocus()){return}if(n){if(i.contains(t,n)){return}}r._hide()},false);i.addEventListener(t,"keydown",function(e){if(e.keyCode===27){r._hide()}},false);i.addEventListener(e,"mousedown",this._mouseDownHandler=function(e){if(!r.isVisible()){return}if(i.contains(t,e.target||e.srcElement)){return}r._hide()},true);this._view.addEventListener("Destroy",function(){r.destroy()});this._hide()},_getWindow:function(){var e=this._tooltipDiv.ownerDocument;return e.defaultView||e.parentWindow},destroy:function(){if(!this._tooltipDiv){return}this._hide();var e=this._tooltipDiv.parentNode;if(e){e.removeChild(this._tooltipDiv)}var t=this._tooltipDiv.ownerDocument;i.removeEventListener(t,"mousedown",this._mouseDownHandler,true);this._tooltipDiv=null},_hasFocus:function(){var e=this._tooltipDiv;if(!e){return false}var t=e.ownerDocument;return i.contains(e,t.activeElement)},hide:function(e){if(e===undefined){e=this._hideDelay}var t=this._getWindow();if(this._delayedHideTimeout){t.clearTimeout(this._delayedHideTimeout);this._delayedHideTimeout=null}var n=this;if(!e){n._hide();n.setTarget(n._nextTarget,0)}else{n._delayedHideTimeout=t.setTimeout(function(){n._delayedHideTimeout=null;n._hide();n.setTarget(n._nextTarget,0)},e)}},_hide:function(){var e=this._tooltipDiv;if(!e){return}if(this._hasFocus()){this._view.focus()}if(this._contentsView){this._contentsView.destroy();this._contentsView=null}if(this._tooltipContents){this._tooltipContents.innerHTML=""}e.style.visibility="hidden";var t=this._getWindow();if(this._showTimeout){t.clearTimeout(this._showTimeout);this._showTimeout=null}if(this._delayedHideTimeout){t.clearTimeout(this._delayedHideTimeout);this._delayedHideTimeout=null}if(this._hideTimeout){t.clearTimeout(this._hideTimeout);this._hideTimeout=null}if(this._fadeTimeout){t.clearInterval(this._fadeTimeout);this._fadeTimeout=null}},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(e,t,n){var r=this.isVisible();if(r){if(this._hasFocus()){return}this._nextTarget=e;this.hide(n)}else{this._target=e;if(e){var i=this;var s=i._getWindow();if(i._showTimeout){s.clearTimeout(i._showTimeout);i._showTimeout=null}if(t===0){i.show(true)}else{i._showTimeout=s.setTimeout(function(){i._showTimeout=null;i.show(true)},t?t:i._showDelay)}}}},show:function(e){if(!this._target){return}var n=this._target.getTooltipInfo();if(!n){return}var i=this._tooltipDiv,s=this._tooltipContents;i.style.left=i.style.right=i.style.width=i.style.height=s.style.width=s.style.height="auto";var o=n.contents;if(o instanceof Array){o=this._getAnnotationContents(o)}if(typeof o==="string"){s.innerHTML=o}else if(this._isNode(o)){s.appendChild(o)}else if(o instanceof r.ProjectionTextModel){var u=this._view;var a=u.getOptions();a.wrapMode=false;a.parent=s;var f="tooltipTheme";var l=a.themeClass;if(l){l=l.replace(f,"");if(l){l=" "+l}l=f+l}else{l=f}a.themeClass=l;var c=this._contentsView=new t.TextView(a);var h={onLineStyle:function(e){u.onLineStyle(e)}};c.addEventListener("LineStyle",h.onLineStyle);c.setModel(o);var p=c.computeSize();s.style.width=p.width+"px";s.style.height=p.height+"px";c.resize()}else{return}var d=i.ownerDocument.documentElement;if(n.anchor==="right"){var v=d.clientWidth-n.x;i.style.right=v+"px";i.style.maxWidth=d.clientWidth-v-10+"px"}else{var m=parseInt(this._getNodeStyle(i,"padding-left","0"),10);m+=parseInt(this._getNodeStyle(i,"border-left-width","0"),10);m=n.x-m;i.style.left=m+"px";i.style.maxWidth=d.clientWidth-m-10+"px"}var g=parseInt(this._getNodeStyle(i,"padding-top","0"),10);g+=parseInt(this._getNodeStyle(i,"border-top-width","0"),10);g=n.y-g;i.style.top=g+"px";i.style.maxHeight=d.clientHeight-g-10+"px";i.style.opacity="1";i.style.visibility="visible";if(e){var y=this;var b=this._getWindow();y._hideTimeout=b.setTimeout(function(){y._hideTimeout=null;var e=parseFloat(y._getNodeStyle(i,"opacity","1"));y._fadeTimeout=b.setInterval(function(){if(i.style.visibility==="visible"&&e>0){e-=.1;i.style.opacity=e;return}y._hide()},y._fadeDelay/10)},y._autoHideDelay)}},_getAnnotationContents:function(t){function d(e,t){var n=p.getLineStart(p.getLineAtOffset(e));var r=p.getLineEnd(p.getLineAtOffset(t),true);return p.getText(n,r)}function v(e){var t=e.title;var n=s.createElement(l,"div");n.className="tooltipRow";if(e.html){n.innerHTML=e.html;if(n.lastChild){i.addEventListener(n.lastChild,"click",function(t){var n=e.start,r=e.end;if(h.getBaseModel){n=h.mapOffset(n,true);r=h.mapOffset(r,true)}c.setSelection(n,r,1/3,function(){a._hide()})},false)}n.appendChild(l.createTextNode(" "))}if(!t){t=d(e.start,e.end)}if(typeof t==="function"){t=e.title()}if(typeof t==="string"){var r=s.createElement(l,"span");r.appendChild(l.createTextNode(t));t=r}n.appendChild(t);return n}var n;var o=[];for(var u=0;u<t.length;u++){n=t[u];if(n.title!==""&&!n.groupAnnotation){o.push(n)}}t=o;if(t.length===0){return null}var a=this;var f;var l=this._tooltipDiv.ownerDocument;var c=this._view;var h=c.getModel();var p=h.getBaseModel?h.getBaseModel():h;if(t.length===1){n=t[0];if(n.title!==undefined){f=v(n);if(f.firstChild){var m=f.firstChild.className;if(m){m+=" "}m+="single";f.firstChild.className=m}return f}else{var g=new r.ProjectionTextModel(p);var y=p.getLineStart(p.getLineAtOffset(n.start));var b=p.getCharCount();if(n.end!==b){g.addProjection({start:n.end,end:b})}if(y>0){g.addProjection({start:0,end:y})}return g}}else{var w=s.createElement(l,"div");var E=s.createElement(l,"em");E.appendChild(l.createTextNode(e.multipleAnnotations));w.appendChild(E);for(var S=0;S<t.length;S++){n=t[S];f=v(n);if(f){w.appendChild(f)}}return w}},_getNodeStyle:function(e,t,n){var r;if(e){r=e.style[t];if(!r){if(e.currentStyle){var i=0,s=t;while((i=s.indexOf("-",i))!==-1){s=s.substring(0,i)+s.substring(i+1,i+2).toUpperCase()+s.substring(i+2)}r=e.currentStyle[s]}else{var o=e.ownerDocument.defaultView.getComputedStyle(e,null);r=o?o.getPropertyValue(t):null}}}return r||n},_isNode:function(e){return typeof Node==="object"?e instanceof Node:e&&typeof e==="object"&&typeof e.nodeType==="number"&&typeof e.nodeName==="string"}};return{Tooltip:o}});define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(e,t){function n(e,t,n){this.start=e;this.end=t;this._projectionModel=n;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=true}function r(){}function s(t,n){var i=t.lastIndexOf(".");var s=t.substring(i+1);var o={title:e[s],style:{styleClass:"annotation "+s},html:"<div class='annotationHTML "+s+"'></div>",overviewStyle:{styleClass:"annotationOverview "+s}};if(n){o.lineStyle={styleClass:"annotationLine "+s}}else{o.rangeStyle={styleClass:"annotationRange "+s}}r.registerType(t,o)}function o(){}function u(e){this._annotations=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)}};this.setTextModel(e)}function a(e,t){this._view=e;this._annotationModel=t;var n=this;this._listener={onDestroy:function(e){n._onDestroy(e)},onLineStyle:function(e){n._onLineStyle(e)},onChanged:function(e){n._onAnnotationModelChanged(e)}};e.addEventListener("Destroy",this._listener.onDestroy);e.addEventListener("postLineStyle",this._listener.onLineStyle);t.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded){return false}this.expanded=false;this.html=this._collapsedHTML;this.style=this._collapsedStyle;if(this._annotationModel){this._annotationModel.modifyAnnotation(this)}return true},_expand:function(){if(this.expanded){return false}this.expanded=true;this.html=this._expandedHTML;this.style=this._expandedStyle;if(this._annotationModel){this._annotationModel.modifyAnnotation(this)}return true},collapse:function(){if(this._collapse()){var e=this._projectionModel;var t=e.getBaseModel();this._projection={annotation:this,start:t.getLineStart(t.getLineAtOffset(this.start)+1),end:t.getLineEnd(t.getLineAtOffset(this.end),true)};e.addProjection(this._projection)}},expand:function(){if(this._expand()){this._projectionModel.removeProjection(this._projection)}}};r.ANNOTATION_ERROR="orion.annotation.error";r.ANNOTATION_WARNING="orion.annotation.warning";r.ANNOTATION_TASK="orion.annotation.task";r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";r.ANNOTATION_BOOKMARK="orion.annotation.bookmark";r.ANNOTATION_FOLDING="orion.annotation.folding";r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";r.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";r.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";r.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";r.ANNOTATION_BLAME="orion.annotation.blame";r.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var i={};r.registerType=function(e,t){var n=t;if(typeof n!=="function"){n=function(e,t,n){this.start=e;this.end=t;if(n!==undefined){this.title=n}};n.prototype=t}n.prototype.type=e;i[e]=n;return e};r.createAnnotation=function(e,t,n,r){return new(this.getType(e))(t,n,r)};r.getType=function(e){return i[e]};s(r.ANNOTATION_ERROR);s(r.ANNOTATION_WARNING);s(r.ANNOTATION_TASK);s(r.ANNOTATION_BREAKPOINT);s(r.ANNOTATION_BOOKMARK);s(r.ANNOTATION_CURRENT_BRACKET);s(r.ANNOTATION_MATCHING_BRACKET);s(r.ANNOTATION_CURRENT_SEARCH);s(r.ANNOTATION_MATCHING_SEARCH);s(r.ANNOTATION_READ_OCCURRENCE);s(r.ANNOTATION_WRITE_OCCURRENCE);s(r.ANNOTATION_SELECTED_LINKED_GROUP);s(r.ANNOTATION_CURRENT_LINKED_GROUP);s(r.ANNOTATION_LINKED_GROUP);s(r.ANNOTATION_CURRENT_LINE,true);s(r.ANNOTATION_BLAME,true);s(r.ANNOTATION_CURRENT_BLAME,true);r.registerType(r.ANNOTATION_FOLDING,n);o.addMixin=function(e){var t=o.prototype;for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}};o.prototype={addAnnotationType:function(e){if(!this._annotationTypes){this._annotationTypes=[]}this._annotationTypes.push(e)},getAnnotationTypePriority:function(e){if(this._annotationTypes){for(var t=0;t<this._annotationTypes.length;t++){if(this._annotationTypes[t]===e){return t+1}}}return 0},getAnnotationsByType:function(e,t,n){var r=e.getAnnotations(t,n);var i,s=[];while(r.hasNext()){i=r.next();var o=this.getAnnotationTypePriority(i.type);if(o===0){continue}s.push(i)}var u=this;s.sort(function(e,t){return u.getAnnotationTypePriority(e.type)-u.getAnnotationTypePriority(t.type)});return s},isAnnotationTypeVisible:function(e){return this.getAnnotationTypePriority(e)!==0},removeAnnotationType:function(e){if(!this._annotationTypes){return}for(var t=0;t<this._annotationTypes.length;t++){if(this._annotationTypes[t]===e){this._annotationTypes.splice(t,1);break}}}};u.prototype={addAnnotation:function(e){if(!e){return}var t=this._annotations;var n=this._binarySearch(t,e.start);t.splice(n,0,e);e._annotationModel=this;var r={type:"Changed",added:[e],removed:[],changed:[]};this.onChanged(r)},getTextModel:function(){return this._model},getAnnotations:function(e,t){var n=this._annotations,r;var i=0;var s=function(){while(i<n.length){var r=n[i++];if(e===r.start||(e>r.start?e<r.end:r.start<t)){return r}if(r.start>=t){break}}return null};r=s();return{next:function(){var e=r;if(e){r=s()}return e},hasNext:function(){return r!==null}}},modifyAnnotation:function(e){if(!e){return}var t=this._getAnnotationIndex(e);if(t<0){return}var n={type:"Changed",added:[],removed:[],changed:[e]};this.onChanged(n)},onChanged:function(e){return this.dispatchEvent(e)},removeAnnotations:function(e){var t=this._annotations;var n,r;if(e){n=[];for(r=t.length-1;r>=0;r--){var i=t[r];if(i.type===e){t.splice(r,1);n.splice(0,0,i);i._annotationModel=null}}}else{n=t;t=[]}var s={type:"Changed",removed:n,added:[],changed:[]};this.onChanged(s)},removeAnnotation:function(e){if(!e){return}var t=this._getAnnotationIndex(e);if(t<0){return}e._annotationModel=null;var n={type:"Changed",removed:this._annotations.splice(t,1),added:[],changed:[]};this.onChanged(n)},replaceAnnotations:function(e,t){var n=this._annotations,r,i,s,o=[];if(e){for(r=e.length-1;r>=0;r--){s=e[r];i=this._getAnnotationIndex(s);if(i<0){continue}s._annotationModel=null;n.splice(i,1);o.splice(0,0,s)}}if(!t){t=[]}for(r=0;r<t.length;r++){s=t[r];i=this._binarySearch(n,s.start);s._annotationModel=this;n.splice(i,0,s)}var u={type:"Changed",removed:o,added:t,changed:[]};this.onChanged(u)},setTextModel:function(e){if(this._model){this._model.removeEventListener("Changed",this._listener.onChanged)}this._model=e;if(this._model){this._model.addEventListener("Changed",this._listener.onChanged)}},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1){i=Math.floor((n+r)/2);if(t<=e[i].start){n=i}else{r=i}}return n},_getAnnotationIndex:function(e){var t=this._annotations;var n=this._binarySearch(t,e.start);while(n<t.length&&t[n].start===e.start){if(t[n]===e){return n}n++}return-1},_onChanged:function(e){var t=e.start;var n=e.addedCharCount;var r=e.removedCharCount;var i=this._annotations,s=t+r;var o=0;if(!(0<=o&&o<i.length)){return}var u={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:e};var a=n-r,f;for(f=o;f<i.length;f++){var l=i[f];if(l.start>=s){l._oldStart=l.start;l._oldEnd=l.end;l.start+=a;l.end+=a;u.changed.push(l)}else if(l.end<=t){}else if(l.start<t&&s<l.end){l._oldStart=l.start;l._oldEnd=l.end;l.end+=a;u.changed.push(l)}else{i.splice(f,1);u.removed.push(l);l._annotationModel=null;if(l.expand){l.expand()}f--}}if(u.added.length>0||u.removed.length>0||u.changed.length>0){this.onChanged(u)}}};t.EventTarget.addMixin(u.prototype);a.prototype={destroy:function(){var e=this._view;if(e){e.removeEventListener("Destroy",this._listener.onDestroy);e.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}var t=this._annotationModel;if(t){t.removeEventListener("Changed",this._listener.onChanged);t=null}},_mergeStyle:function(e,t){if(t){if(!e){e={}}if(e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass){e.styleClass+=" "+t.styleClass}else{e.styleClass=t.styleClass}var n;if(t.tagName){if(!e.tagName){e.tagName=t.tagName}}if(t.style){if(!e.style){e.style={}}for(n in t.style){if(!e.style[n]){e.style[n]=t.style[n]}}}if(t.attributes){if(!e.attributes){e.attributes={}}for(n in t.attributes){if(!e.attributes[n]){e.attributes[n]=t.attributes[n]}}}}return e},_mergeStyleRanges:function(e,t){if(!e){e=[]}var n,r;for(r=0;r<e.length&&t;r++){var i=e[r];if(t.end<=i.start){break}if(t.start>=i.end){continue}n=this._mergeStyle({},i.style);n=this._mergeStyle(n,t.style);var s=[];s.push(r,1);if(t.start<i.start){s.push({start:t.start,end:i.start,style:t.style})}if(t.start>i.start){s.push({start:i.start,end:t.start,style:i.style})}s.push({start:Math.max(i.start,t.start),end:Math.min(i.end,t.end),style:n});if(t.end<i.end){s.push({start:t.end,end:i.end,style:i.style})}if(t.end>i.end){t={start:i.end,end:t.end,style:t.style}}else{t=null}Array.prototype.splice.apply(e,s)}if(t){n=this._mergeStyle({},t.style);e.splice(r,0,{start:t.start,end:t.end,style:n})}return e},_onAnnotationModelChanged:function(e){function i(e,n){if(r.getBaseModel){e=r.mapOffset(e,true);n=r.mapOffset(n,true)}if(e!==-1&&n!==-1){t.redrawRange(e,n)}}function s(e,t){for(var r=0;r<e.length;r++){if(!n.isAnnotationTypeVisible(e[r].type)){continue}var s=e[r];i(s.start,s.end);if(t&&s._oldStart!==undefined&&s._oldEnd){i(s._oldStart,s._oldEnd)}}}var t=this._view;if(!t){return}var n=this;var r=t.getModel();s(e.added);s(e.removed);s(e.changed,true)},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){var t=this._annotationModel;var n=e.textView.getModel();var r=t.getTextModel();var i=e.lineStart;var s=e.lineStart+e.lineText.length;if(r!==n){i=n.mapOffset(i);s=n.mapOffset(s)}var o=t.getAnnotations(i,s);while(o.hasNext()){var u=o.next();if(!this.isAnnotationTypeVisible(u.type)){continue}if(u.rangeStyle){var a=u.start;var f=u.end;if(r!==n){a=n.mapOffset(a,true);f=n.mapOffset(f,true)}e.ranges=this._mergeStyleRanges(e.ranges,{start:a,end:f,style:u.rangeStyle})}if(u.lineStyle){e.style=this._mergeStyle({},e.style);e.style=this._mergeStyle(e.style,u.lineStyle)}}}};o.addMixin(a.prototype);return{FoldingAnnotation:n,AnnotationType:r,AnnotationTypeList:o,AnnotationModel:u,AnnotationStyler:a}});define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/objects","orion/util"],function(e,t,n,r,i,s){function a(e){e=e||{};this._domNode=e.domNode;this._model=e.model;this._undoStack=e.undoStack;this._statusReporter=e.statusReporter;this._title=null;var t=this;this._listener={onChanged:function(e){t.onChanged(e)}};if(this._model){this._model.addEventListener("Changed",this._listener.onChanged)}this.checkDirty()}function f(e){e=e||{};a.call(this,e);this._textViewFactory=e.textViewFactory;this._undoStackFactory=e.undoStackFactory;this._textDNDFactory=e.textDNDFactory;this._annotationFactory=e.annotationFactory;this._foldingRulerFactory=e.foldingRulerFactory;this._lineNumberRulerFactory=e.lineNumberRulerFactory;this._contentAssistFactory=e.contentAssistFactory;this._keyBindingFactory=e.keyBindingFactory;this._annotationStyler=null;this._annotationModel=null;this._annotationRuler=null;this._lineNumberRuler=null;this._overviewRuler=null;this._foldingRuler=null;this._contentAssist=null}var o=r.AnnotationType;var u="orion.annotation.highlightError";a.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;if(this._model){this._model.removeEventListener("Changed",this._listener.onChanged)}},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(e,t){return this.getModel().getText(e,t)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=true},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(false)},onDirtyChanged:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onChanged:function(e){this.checkDirty()},reportStatus:function(e,t,n){if(this._statusReporter){this._statusReporter(e,t,n)}},resize:function(){},setDirty:function(e){if(this._dirty===e){return}this._dirty=e;this.onDirtyChanged({type:"DirtyChanged"})},_setModelText:function(e){if(this._model){this._model.setText(e)}},setInput:function(e,t,n,r){this._title=e;if(!r){if(t){this.reportStatus(t,"error")}else{if(n!==null&&n!==undefined){this._setModelText(n)}}if(this._undoStack){this._undoStack.reset()}}this.checkDirty();this.onInputChanged({type:"InputChanged",title:e,message:t,contents:n,contentsSaved:r})},setText:function(e,t,n){this.getModel().setText(e,t,n)},uninstall:function(){this.installed=false}};t.EventTarget.addMixin(a.prototype);f.prototype=new a;i.mixin(f.prototype,{destroy:function(){a.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var e=this._textView.getModel();if(e.getBaseModel){e=e.getBaseModel()}return e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){if(this._textView){this._textView.focus()}},resize:function(){if(this._textView){this._textView.resize()}},setAnnotationRulerVisible:function(e,t){if(this._annotationRulerVisible===e&&!t){return}this._annotationRulerVisible=e;if(!this._annotationRuler){return}var n=this._textView;if(e){n.addRuler(this._annotationRuler,0)}else{n.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(e,t){if(this._foldingRulerVisible===e&&!t){return}this._foldingRulerVisible=e;if(!this._foldingRuler){return}var n=this._textView;if(!n.getModel().getBaseModel){return}if(e){n.addRuler(this._foldingRuler)}else{n.removeRuler(this._foldingRuler)}},setLineNumberRulerVisible:function(e,t){if(this._lineNumberRulerVisible===e&&!t){return}this._lineNumberRulerVisible=e;if(!this._lineNumberRuler){return}var n=this._textView;if(e){n.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1)}else{n.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(e,t){if(this._overviewRulerVisible===e&&!t){return}this._overviewRulerVisible=e;if(!this._overviewRuler){return}var n=this._textView;if(e){n.addRuler(this._overviewRuler)}else{n.removeRuler(this._overviewRuler)}},mapOffset:function(e,t){var n=this._textView;var r=n.getModel();if(r.getBaseModel){e=r.mapOffset(e,t)}return e},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(this.mapOffset(e))},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var e=this._textView;var t=e.getSelection();var n=e.getModel();if(n.getBaseModel){t.start=n.mapOffset(t.start);t.end=n.mapOffset(t.end)}return t},_expandOffset:function(e){var t=this._textView.getModel();var n=this._annotationModel;if(!n||!t.getBaseModel){return}var r=n.getAnnotations(e,e+1);while(r.hasNext()){var i=r.next();if(i.type===o.ANNOTATION_FOLDING){if(i.expand){i.expand()}}}},setCaretOffset:function(e,t,n){var r=this._textView;var i=r.getModel();if(i.getBaseModel){this._expandOffset(e);e=i.mapOffset(e,true)}r.setCaretOffset(e,t,n)},setText:function(e,t,n){var r=this._textView;var i=r.getModel();if(i.getBaseModel){if(t!==undefined){this._expandOffset(t);t=i.mapOffset(t,true)}if(n!==undefined){this._expandOffset(n);n=i.mapOffset(n,true)}}r.setText(e,t,n)},setSelection:function(e,t,n,r){var i=this._textView;var s=i.getModel();if(s.getBaseModel){this._expandOffset(e);this._expandOffset(t);e=s.mapOffset(e,true);t=s.mapOffset(t,true)}i.setSelection(e,t,n,r)},moveSelection:function(e,t,n,r){t=t||e;var i=this._textView;this.setSelection(e,t,1/3,function(){if(r===undefined||r){i.focus()}if(n){n()}})},_getTooltipInfo:function(e,t){var n=this._textView;var r=this.getAnnotationModel();if(!r){return null}var i=this._annotationStyler;if(!i){return null}var s=n.getOffsetAtLocation(e,t);if(s===-1){return null}s=this.mapOffset(s);var o=i.getAnnotationsByType(r,s,s+1);var u=[];for(var a=0;a<o.length;a++){if(o[a].rangeStyle){u.push(o[a])}}if(u.length===0){return null}var f=n.convert({x:e,y:t},"document","page");var l={contents:u,anchor:"left",x:f.x+10,y:f.y+20};return l},_highlightCurrentLine:function(e,t){var n=this._annotationModel;if(!n){return}var r=this._textView;if(r.getOptions("singleMode")){return}var i=r.getModel();var s=t?i.getLineAtOffset(t.start):-1;var u=i.getLineAtOffset(e.start);var a=e.start===e.end;var f=!t||t.start===t.end;var l=i.getLineStart(u);var c=i.getLineEnd(u);if(i.getBaseModel){l=i.mapOffset(l);c=i.mapOffset(c)}var h=this._currentLineAnnotation;if(s===u&&f&&a&&h&&h.start===l&&h.end===c){return}var p=h?[h]:null;var d;if(a){var v=o.ANNOTATION_CURRENT_LINE;h=o.createAnnotation(v,l,c);d=[h]}this._currentLineAnnotation=h;n.replaceAnnotations(p,d)},installTextView:function(){this.install()},install:function(){if(this._textView){return}this._textView=this._textViewFactory();if(this._undoStackFactory){this._undoStack=this._undoStackFactory.createUndoStack(this);this.checkDirty()}if(this._textDNDFactory){this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack)}if(this._contentAssistFactory){var e=this._contentAssistFactory.createContentAssistMode(this);this._contentAssist=e.getContentAssist()}var t=this,r=this._textView;var i=this;this._listener={onModelChanged:function(e){i.checkDirty()},onMouseOver:function(e){i._listener.onMouseMove(e)},onMouseMove:function(e){var t=n.Tooltip.getTooltip(r);if(!t){return}if(i._listener.lastMouseX===e.event.clientX&&i._listener.lastMouseY===e.event.clientY){return}i._listener.lastMouseX=e.event.clientX;i._listener.lastMouseY=e.event.clientY;t.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){return i._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(e){var t=n.Tooltip.getTooltip(r);if(!t){return}if(i._listener.lastMouseX===e.event.clientX&&i._listener.lastMouseY===e.event.clientY){return}i._listener.lastMouseX=e.event.clientX;i._listener.lastMouseY=e.event.clientY;t.setTarget(null)},onScroll:function(e){var t=n.Tooltip.getTooltip(r);if(!t){return}t.setTarget(null,0,0)},onSelection:function(e){i._updateCursorStatus();i._highlightCurrentLine(e.newValue,e.oldValue)}};r.addEventListener("ModelChanged",this._listener.onModelChanged);r.addEventListener("Selection",this._listener.onSelection);r.addEventListener("MouseOver",this._listener.onMouseOver);r.addEventListener("MouseOut",this._listener.onMouseOut);r.addEventListener("MouseMove",this._listener.onMouseMove);r.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var s;if(typeof this._keyBindingFactory==="function"){s=this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist)}else{s=this._keyBindingFactory.createKeyBindings(t,this._undoStack,this._contentAssist)}if(s){this._textActions=s.textActions;this._linkedMode=s.linkedMode;this._sourceCodeActions=s.sourceCodeActions}}var f=function(e,n){if(e===undefined){return}if(e===-1){return}var r=this.getView();var i=r.getModel();var s=this.getAnnotationModel();var u=t.mapOffset(i.getLineStart(e));var a=t.mapOffset(i.getLineEnd(e));var f=s.getAnnotations(u,a);var l=null;while(f.hasNext()){var c=f.next();if(c.type===o.ANNOTATION_BOOKMARK){l=c;break}}if(l){s.removeAnnotation(l)}else{l=o.createAnnotation(o.ANNOTATION_BOOKMARK,u,a);l.title=undefined;s.addAnnotation(l)}};if(this._annotationFactory){var l=r.getModel();if(l.getBaseModel){l=l.getBaseModel()}this._annotationModel=this._annotationFactory.createAnnotationModel(l);if(this._annotationModel){var c=this._annotationStyler=this._annotationFactory.createAnnotationStyler(r,this._annotationModel);if(c){c.addAnnotationType(o.ANNOTATION_CURRENT_SEARCH);c.addAnnotationType(o.ANNOTATION_MATCHING_SEARCH);c.addAnnotationType(o.ANNOTATION_ERROR);c.addAnnotationType(o.ANNOTATION_WARNING);c.addAnnotationType(o.ANNOTATION_MATCHING_BRACKET);c.addAnnotationType(o.ANNOTATION_CURRENT_BRACKET);c.addAnnotationType(o.ANNOTATION_CURRENT_LINE);c.addAnnotationType(o.ANNOTATION_READ_OCCURRENCE);c.addAnnotationType(o.ANNOTATION_WRITE_OCCURRENCE);c.addAnnotationType(o.ANNOTATION_SELECTED_LINKED_GROUP);c.addAnnotationType(o.ANNOTATION_CURRENT_LINKED_GROUP);c.addAnnotationType(o.ANNOTATION_LINKED_GROUP);c.addAnnotationType(u)}}var h=this._annotationFactory.createAnnotationRulers(this._annotationModel);var p=this._annotationRuler=h.annotationRuler;if(p){p.onDblClick=f;p.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"});p.addAnnotationType(o.ANNOTATION_ERROR);p.addAnnotationType(o.ANNOTATION_WARNING);p.addAnnotationType(o.ANNOTATION_TASK);p.addAnnotationType(o.ANNOTATION_BOOKMARK)}this.setAnnotationRulerVisible(this._annotationRulerVisible||this._annotationRulerVisible===undefined,true);p=this._overviewRuler=h.overviewRuler;if(p){p.addAnnotationType(o.ANNOTATION_CURRENT_SEARCH);p.addAnnotationType(o.ANNOTATION_MATCHING_SEARCH);p.addAnnotationType(o.ANNOTATION_READ_OCCURRENCE);p.addAnnotationType(o.ANNOTATION_WRITE_OCCURRENCE);p.addAnnotationType(o.ANNOTATION_CURRENT_BLAME);p.addAnnotationType(o.ANNOTATION_ERROR);p.addAnnotationType(o.ANNOTATION_WARNING);p.addAnnotationType(o.ANNOTATION_TASK);p.addAnnotationType(o.ANNOTATION_BOOKMARK);p.addAnnotationType(o.ANNOTATION_MATCHING_BRACKET);p.addAnnotationType(o.ANNOTATION_CURRENT_BRACKET);p.addAnnotationType(o.ANNOTATION_CURRENT_LINE)}this.setOverviewRulerVisible(this._overviewRulerVisible||this._overviewRulerVisible===undefined,true)}if(this._lineNumberRulerFactory){this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel);this._lineNumberRuler.addAnnotationType(o.ANNOTATION_CURRENT_BLAME);this._lineNumberRuler.addAnnotationType(o.ANNOTATION_BLAME);this._lineNumberRuler.onDblClick=f;this.setLineNumberRulerVisible(this._lineNumberRulerVisible||this._lineNumberRulerVisible===undefined,true)}if(this._foldingRulerFactory){this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel);this._foldingRuler.addAnnotationType(o.ANNOTATION_FOLDING);this.setFoldingRulerVisible(this._foldingRulerVisible||this._foldingRulerVisible===undefined,true)}var d={type:"TextViewInstalled",textView:r};this.dispatchEvent(d);a.prototype.install.call(this)},uninstallTextView:function(){this.uninstall()},uninstall:function(){var e=this._textView;if(!e){return}e.destroy();this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null;this._dirty=false;this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=undefined;var t={type:"TextViewUninstalled",textView:e};this.dispatchEvent(t);a.prototype.uninstall.call(this)},_updateCursorStatus:function(){var t=this.getModel();var n=this.getCaretOffset();var r=t.getLineAtOffset(n);var i=t.getLineStart(r);var o=n-i;var u=this.getKeyModes();for(var a=0;a<u.length;a++){var f=u[a];if(f.isActive()&&f.isStatusActive&&f.isStatusActive()){return}}this.reportStatus(s.formatMessage(e.lineColumn,r+1,o+1))},showAnnotations:function(e,t,n,r){var i=this._annotationModel;if(!i){return}var s=[],u=[];var a=i.getTextModel();var f=i.getAnnotations(0,a.getCharCount()),l;while(f.hasNext()){l=f.next();if(t.indexOf(l.type)!==-1){if(l.creatorID===this){s.push(l)}}}if(e){for(var c=0;c<e.length;c++){l=e[c];if(!l){continue}if(n){l=n(l)}else{var h,p;if(typeof l.line==="number"){var d=l.line-1;var v=a.getLineStart(d);h=v+l.start-1;p=v+l.end-1}else{h=l.start;p=l.end}var m=r(l);if(!m){continue}l=o.createAnnotation(m,h,p,l.description)}l.creatorID=this;u.push(l)}}i.replaceAnnotations(s,u)},showProblems:function(e){this.showAnnotations(e,[o.ANNOTATION_ERROR,o.ANNOTATION_WARNING,o.ANNOTATION_TASK],null,function(e){switch(e.severity){case"error":return o.ANNOTATION_ERROR;case"warning":return o.ANNOTATION_WARNING;case"task":return o.ANNOTATION_TASK}return null})},showOccurrences:function(e){this.showAnnotations(e,[o.ANNOTATION_READ_OCCURRENCE,o.ANNOTATION_WRITE_OCCURRENCE],null,function(e){return e.readAccess?o.ANNOTATION_READ_OCCURRENCE:o.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(t){var n=this._blameRGB;var u=this.getTextView().getOptions("parent").ownerDocument;if(!n){var a=s.createElement(u,"div");a.className="annotation blame";u.body.appendChild(a);var f=u.defaultView||u.parentWindow;var l=f.getComputedStyle(a);var c=l.getPropertyValue("background-color");a.parentNode.removeChild(a);var h=c.indexOf("(");var p=c.indexOf(")");c=c.substring(h+1,p);this._blameRGB=n=c.split(",").slice(0,3)}var d=function(){var e=r.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);e.style=i.mixin({},e.style);e.style.style=i.mixin({},e.style.style);e.style.style.backgroundColor="";this.groupAnnotation=e;e.blame=this.blame;e.html=this.html;e.creatorID=this.creatorID;return e};var v=function(){var t=s.createElement(u,"div");t.className="tooltipTitle";var n=this.blame.Message.indexOf("\n");if(n===-1){n=this.blame.Message.length}var r=s.createElement(u,"a");r.href=this.blame.CommitLink;r.appendChild(u.createTextNode(this.blame.Message.substring(0,n)));t.appendChild(r);t.appendChild(s.createElement(u,"br"));t.appendChild(u.createTextNode(s.formatMessage(e.committerOnTime,this.blame.AuthorName,this.blame.Time)));return t};var m=this.getModel();this.showAnnotations(t,[o.ANNOTATION_BLAME,o.ANNOTATION_CURRENT_BLAME],function(e){var t=m.getLineStart(e.Start-1);var s=m.getLineEnd(e.End-1,true);var u=r.AnnotationType.createAnnotation(o.ANNOTATION_BLAME,t,s,v);var a=n.slice(0);a.push(e.Shade);u.style=i.mixin({},u.style);u.style.style=i.mixin({},u.style.style);u.style.style.backgroundColor="rgba("+a.join()+")";u.groupId=e.Name;u.groupType=o.ANNOTATION_CURRENT_BLAME;u.createGroupAnnotation=d;u.html='<img class="annotationHTML blame" src="'+e.AuthorImage+'"/>';u.blame=e;return u})},showSelection:function(e,t,n,r,i){if(typeof e==="number"){if(typeof t!=="number"){t=e}this.moveSelection(e,t)}else if(typeof n==="number"){var s=this.getModel();var o=s.getLineStart(n-1);if(typeof r==="number"){o=o+r}if(typeof i!=="number"){i=0}this.moveSelection(o,o+i)}},_setModelText:function(e){if(this._textView){this._textView.setText(e);this._textView.getModel().setLineDelimiter("auto");this._highlightCurrentLine(this._textView.getSelection())}},setInput:function(e,t,n,r,i){a.prototype.setInput.call(this,e,t,n,r);if(this._textView&&!r&&!i){this._textView.focus()}},onGotoLine:function(e,t,n,r){if(this._textView){var i=this.getModel();e=Math.max(0,Math.min(e,i.getLineCount()-1));var s=i.getLineStart(e);var o=0;if(n===undefined){n=0}if(typeof t==="string"){var u=i.getLine(e).indexOf(t);if(u!==-1){o=u;n=o+t.length}}else{o=t;var a=i.getLineEnd(e)-s;o=Math.min(o,a);n=Math.min(n,a)}this.moveSelection(s+o,s+n,r)}}});return{BaseEditor:a,Editor:f}});define("orion/selection",["orion/EventTarget","orion/Deferred"],function(e,t){function n(t,n){if(!n){n="orion.page.selection"}this._serviceRegistry=t;e.attach(this);this._serviceRegistration=t.registerService(n,this);this._selections=null}n.prototype={getSelection:function(e){var t=this._getSingleSelection();if(typeof e==="function"){e(t)}return t},getSelections:function(e){var t=Array.isArray(this._selections)?this._selections.slice():[];if(typeof e==="function"){e(t)}return t},_getSingleSelection:function(){if(this._selections&&this._selections.length>0){return this._selections[0]}return null},setSelections:function(e){var t=this._selections;if(Array.isArray(e)){this._selections=e.length>0?e.slice():null}else if(e){this._selections=[e]}else{this._selections=null}if(t!==this._selections){this.dispatchEvent({type:"selectionChanged",selection:this._getSingleSelection(),selections:this._selections})}}};n.prototype.constructor=n;return{Selection:n}});define("orion/commandRegistry",["require","orion/commands","orion/explorers/navigationUtils","orion/PageUtil","orion/uiUtils","orion/webui/littlelib","orion/webui/dropdown","orion/webui/tooltip","text!orion/webui/checkedmenuitem.html","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/submenutriggerbutton.html"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e){this._commandList={};this._contributionsByScopeId={};this._activeBindings={};this._urlBindings={};this._pendingBindings={};this._init(e);this._parameterCollector=null}function h(e,t){this.token=e;this.parameterName=t}function p(e,t,n,r,i){this.name=e;this.type=t;this.label=n;this.value=r;this.lines=i||1}function d(e,t,n){this._storeParameters(e);this._hasOptionalParameters=t&&t.hasOptionalParameters;this._options=t;this.optionsRequested=false;this.getParameters=n;this.clientCollect=t&&t.clientCollect}c.prototype={_init:function(e){this._selectionService=e.selection;var n=this;t.setKeyBindingProvider(function(){return n._activeBindings})},processURL:function(e){for(var t in this._urlBindings){if(this._urlBindings[t]&&this._urlBindings[t].urlBinding&&this._urlBindings[t].command){var n=this._urlBindings[t].urlBinding.match(e);if(n){var r=this._urlBindings[t];var i=r.command;var s=r.invocation;if(s&&s.parameters&&i.callback){s.parameters.setValue(n.parameterName,n.parameterValue);var o=this;window.setTimeout(function(){o._invoke(s)},0);return}}}}},findCommand:function(e){return this._commandList[e]},runCommand:function(e,n,r,i){var s=this;if(n){var o=this._commandList[e];var u=o&&(o.visibleWhen?o.visibleWhen(n):true);if(u&&o.callback){s._invoke(new t.CommandInvocation(r,n,null,o,s),i)}}else{var a=this._urlBindings[e];if(a&&a.command){if(a.command.callback){s._invoke(a.invocation,i)}}}},getSelectionService:function(){return this._selectionService},setParameterCollector:function(e){this._parameterCollector=e},openParameterCollector:function(e,t,n){if(this._parameterCollector){this._parameterCollector.close();this._parameterCollector.open(e,t,n)}},confirm:function(e,t,n,r,i,s){var o=false;if(this._parameterCollector&&!i){var u=this;this._parameterCollector.close();var a=this._parameterCollector.open(e,function(e,i){var s=document.createElement("span");s.classList.add("parameterPrompt");s.textContent=t;e.appendChild(s);var a=document.createElement("button");a.addEventListener("click",function(e){o=true;u._parameterCollector.close()},false);i.appendChild(a);a.appendChild(document.createTextNode(n));a.className="dismissButton";var f=document.createElement("button");f.addEventListener("click",function(e){o=false;u._parameterCollector.close()},false);i.appendChild(f);f.appendChild(document.createTextNode(r));f.className="dismissButton";return a},function(){s(o)});if(a){return}}o=window.confirm(t);s(o)},closeParameterCollector:function(){if(this._parameterCollector){this._parameterCollector.close()}},collectsParameters:function(){return this._parameterCollector},_invoke:function(e,t){return this._collectAndInvoke(e.makeCopy(t),false)},_collectAndInvoke:function(e,t){if(e){if(this._parameterCollector&&e.parameters&&e.parameters.hasParameters()&&(t||e.parameters.shouldCollectParameters())){var n=false;e.parameters.updateParameters(e);if(e.parameters.shouldCollectParameters()){n=this._parameterCollector.collectParameters(e);if(!n){var r=new u.Tooltip({node:e.domNode,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above","left"]});var i=r.contentContainer();i.classList.add("parameterPopup");var s=window.document.activeElement;var o=this._parameterCollector.getFillFunction(e,function(){if(s){s.focus()}r.destroy()})(i);r.show();window.setTimeout(function(){o.focus();o.select()},0);n=true}}if(!n){e.command.callback.call(e.handler||window,e)}}else{e.command.callback.call(e.handler||window,e)}}else{window.console.log("Client attempted to invoke command without an available (rendered) command invocation")}},collectParameters:function(e){this._collectAndInvoke(e,true)},showKeyBindings:function(e){function o(e){return function(){t.executeBinding(e)}}var n={};var r,s;var u=[];for(var a in this._activeBindings){s=this._activeBindings[a];if(s&&s.keyBinding&&s.command&&(s.command.name||s.command.tooltip)){u.push(s)}}u.sort(function(e,t){var n=e.command.name||e.command.tooltip;var r=t.command.name||t.command.tooltip;return n.localeCompare(r)});for(var f=0;f<u.length;f++){s=u[f];if(s.keyBinding.scopeName){if(!n[s.keyBinding.scopeName]){n[s.keyBinding.scopeName]=[]}n[s.keyBinding.scopeName].push(s)}else{r=i.getUserKeyString(s.keyBinding);e.createItem(r,s.command.name||s.command.tooltip,o(s))}}for(var l in n){if(n[l].length&&n[l].length>0){e.createHeader(l);n[l].forEach(function(t){r=i.getUserKeyString(t.keyBinding);e.createItem(r,t.command.name||t.command.tooltip,o(t))})}}},addCommand:function(e){this._commandList[e.id]=e;var t=this._pendingBindings[e.id];if(t){var n=this;t.forEach(function(t){n._addBinding(e,t.type,t.binding,t.bindingOnly)});delete this._pendingBindings[e.id]}},addCommandGroup:function(e,t,n,r,i,s,o,u,a){if(!this._contributionsByScopeId[e]){this._contributionsByScopeId[e]={}}var f=this._contributionsByScopeId[e];if(i){f=this._createEntryForPath(f,i)}if(f[t]){if(r){f[t].title=r}if(n){f[t].position=n}if(o){f[t].imageClass=o}if(u){f[t].tooltip=u}if(a){f[t].selectionClass=a}f[t].emptyGroupMessage=s}else{f[t]={title:r,position:n,emptyGroupMessage:s,imageClass:o,tooltip:u,selectionClass:a,children:{}};f.sortedContributions=null}},_createEntryForPath:function(e,t){if(t){var n=t.split("/");n.forEach(function(t){if(t.length>1){if(!e[t]){e[t]={position:0,children:{}};e.sortedContributions=null}e=e[t].children}})}return e},registerSelectionService:function(e,t){if(!this._contributionsByScopeId[e]){this._contributionsByScopeId[e]={}}this._contributionsByScopeId[e].localSelectionService=t},registerCommandContribution:function(e,t,n,r,i,s,o){if(!this._contributionsByScopeId[e]){this._contributionsByScopeId[e]={}}var u=this._contributionsByScopeId[e];if(r){u=this._createEntryForPath(u,r)}u[t]={position:n};var a;if(s){a=this._commandList[t];if(a){this._addBinding(a,"key",s,i)}else{this._addPendingBinding(t,"key",s,i)}}if(o){a=this._commandList[t];if(a){this._addBinding(a,"url",o,i)}else{this._addPendingBinding(t,"url",o,i)}}u.sortedContributions=null},unregisterCommandContribution:function(e,t,n){if(!this._contributionsByScopeId[e]){return}delete this._commandList[t];delete this._activeBindings[t];delete this._urlBindings[t];delete this._pendingBindings[t];var r=this._contributionsByScopeId[e];if(n){var i=n.split("/");i.forEach(function(e){if(e.length>1){if(!r[e]){return}r=r[e].children}})}delete r[t];r.sortedContributions=null},_addBinding:function(e,t,n,r){if(!e.id){throw new Error("No command id: "+e)}if(t==="key"){this._activeBindings[e.id]={command:e,keyBinding:n,bindingOnly:r}}else if(t==="url"){this._urlBindings[e.id]={command:e,urlBinding:n,bindingOnly:r}}},_addPendingBinding:function(e,t,n,r){this._pendingBindings[e]=this._pendingBindings[e]||[];this._pendingBindings[e].push({type:t,binding:n,bindingOnly:r})},_checkForTrailingSeparator:function(e,t,n){var r;if(t==="tool"||t==="button"){r=e.childNodes.length>0?e.childNodes[e.childNodes.length-1]:null;if(r&&r.classList.contains("commandSeparator")){if(n){e.removeChild(r);return false}return true}}if(t==="menu"){var i=s.$$array("li > *",e);if(i.length>0&&i[i.length-1].classList.contains("dropdownSeparator")){r=i[i.length-1];if(n){r.parentNode.parentNode.removeChild(r.parentNode);return false}else{return true}}}return false},renderCommands:function(e,t,n,r,i,o,u){if(typeof e!=="string"){throw"a scope id for rendering must be specified"}t=s.node(t);if(!t){throw"no parent"}var a=this._contributionsByScopeId[e];if(!n&&a){var f=a.localSelectionService||this._selectionService;var l=this;if(f){f.getSelections(function(n){l.renderCommands(e,t,n,r,i,o)})}return}if(a){this._render(this._contributionsByScopeId[e],t,n,r,i||"button",o,u);this._checkForTrailingSeparator(t,i,true)}},destroy:function(e){e=s.node(e);if(!e){throw"no parent"}while(e.hasChildNodes()){var t=e.firstChild;if(t.commandTooltip){t.commandTooltip.destroy()}if(t.emptyGroupTooltip){t.emptyGroupTooltip.destroy()}this.destroy(t);e.removeChild(t)}},_render:function(e,r,i,s,o,a,f){var l=e.sortedContributions;if(!l){l=[];var c=false;for(var h in e){if(Object.prototype.hasOwnProperty.call(e,h)){var p=e[h];if(p&&typeof p.position==="number"){p.id=h;l.push(p);c=true}}}if(c){l.sort(function(e,t){return e.position-t.position});e.sortedContributions=l}}var d=0;var v=this;l.forEach(function(e){var l,c;if(!e.imageClass){e.imageClass=null}if(e.children&&Object.getOwnPropertyNames(e.children).length>0){var h=e.children;var p;if(o==="tool"||o==="button"){if(e.title){p=v._createDropdownMenu(r,e.title,null,null,e.imageClass,e.tooltip,e.selectionClass);if(f){n.generateNavGrid(f,p.menuButton)}if(p){window.setTimeout(function(){v._render(e.children,p.menu,i,s,"menu",a,f);v._checkForTrailingSeparator(p.menu,"menu",true);if(p.menu.childNodes.length===0){if(e.emptyGroupMessage){if(!p.menuButton.emptyGroupTooltip){p.menuButton.emptyGroupTooltip=new u.Tooltip({node:p.menuButton,text:e.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})}}else{if(f){n.removeNavGrid(f,p.menuButton)}if(p.menu.parentNode){p.menu.parentNode.removeChild(p.menu)}if(p.destroyButton&&p.destroyButton.parentNode){p.destroyButton.parentNode.removeChild(p.destroyButton)}}}else{p.menuButton.style.visibility="visible"}},0)}}else{var m;if(r.childNodes.length>0&&!v._checkForTrailingSeparator(r,o)){m=v.generateSeparatorImage(r)}v._render(h,r,i,s,o,a,f);if(r.childNodes.length>0){var g=r.childNodes[r.childNodes.length-1];if(g!==m){m=v.generateSeparatorImage(r)}}}}else{if(e.title){var y=v._createDropdownMenu(r,e.title,true,null,null,e.imageClass);if(y){v._render(h,y.menu,i,s,"menu",a,f);if(y.menu.childNodes.length===0&&y.destroyButton){r.removeChild(y.destroyButton)}}}else{if(r.childNodes.length>0){v._generateMenuSeparator(r)}v._render(h,r,i,s,o,a,f);v._generateMenuSeparator(r)}}}else{var b=v._commandList[e.id];var w=b?true:false;var E=null;var S=null;if(b){c=new t.CommandInvocation(s,i,a,b,v);c.domParent=r;var x=w&&(b.visibleWhen?b.visibleWhen(i):true);if(v._activeBindings[b.id]&&v._activeBindings[b.id].keyBinding){E=v._activeBindings[b.id];if(x){E.invocation=c}else{E.invocation=null}if(E.bindingOnly){w=false}}if(v._urlBindings[b.id]&&v._urlBindings[b.id].urlBinding){S=v._urlBindings[b.id];if(x){S.invocation=c}else{S.invocation=null}if(S.bindingOnly){w=false}}w=w&&x}if(w){if(b.choiceCallback){var T;var N;var C;if(o==="tool"||o==="button"){T=r;C=false;if(r.nodeName.toLowerCase()==="ul"){T=document.createElement("li");r.appendChild(T)}else{N="commandMargins"}}else{T=r;C=true}var k=function(e){b.populateChoicesMenu(e,i,s,a,v)};v._createDropdownMenu(T,b.name,C,k.bind(b),b.imageClass,b.tooltip||b.title,b.selectionClass)}else{c.handler=c.handler||this;c.domParent=r;var L;var A=function(e){v._invoke(c)};if(o==="menu"){L=t.createCommandMenuItem(r,b,c,null,A)}else{l=o+b.id+d;L=t.createCommandItem(r,b,c,l,null,o==="tool",A)}n.generateNavGrid(f,L);c.domNode=L;d++}}}})},_createDropdownMenu:function(e,n,r,i,a,f,c){e=s.node(e);if(!e||!s.contains(document.body,e)){return null}var h,p;var d,v=e;if(r){var m=document.createRange();m.selectNode(e);var g=m.createContextualFragment(l);s.processTextNodes(g,{ButtonText:n});e.appendChild(g);d=e.lastChild;p=d.lastChild;h=p.previousSibling;h.dropdown=new o.Dropdown({dropdown:p,populate:i,parentDropdown:e.dropdown});p.dropdown=h.dropdown}else{if(e.nodeName.toLowerCase()==="ul"){v=document.createElement("li");e.appendChild(v);d=v}var y=null;if(a){y="dropdownButtonWithIcon";f=f||n}f=a?f||n:f;var b=t.createDropdownMenu(v,n,i,y,a,false,c);h=b.menuButton;p=b.menu;if(f){h.commandTooltip=new u.Tooltip({node:h,text:f,position:["above","below","right","left"]})}}return{menuButton:h,menu:p,dropdown:h.dropdown,destroyButton:d}},_generateMenuSeparator:function(e){if(!this._checkForTrailingSeparator(e,"menu")){var t=document.createElement("li");t.classList.add("dropdownSeparator");var n=document.createElement("span");n.classList.add("dropdownSeparator");t.appendChild(n);e.appendChild(t)}},generateSeparatorImage:function(e){var t;if(e.nodeName.toLowerCase()==="ul"){t=document.createElement("li");e.appendChild(t)}else{t=document.createElement("span");e.appendChild(t)}t.classList.add("core-sprite-sep");t.classList.add("imageSprite");t.classList.add("commandSeparator");return t}};c.prototype.constructor=c;h.prototype={match:function(e){var t=r.matchResourceParameters(e);if(typeof t[this.token]!=="undefined"){this.parameterValue=t[this.token];return this}return null}};h.prototype.constructor=h;p.prototype={optionsRequested:function(){return this.optionsRequested}};p.prototype.constructor=p;d.prototype={_storeParameters:function(e){this.parameterTable=null;if(e){var t=this.parameterTable={};e.forEach(function(e){t[e.name]=e})}},updateParameters:function(e){if(typeof this.getParameters==="function"){this._storeParameters(this.getParameters(e))}},hasParameters:function(){return this.parameterTable!==null},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(e){return this.parameterTable[e]},valueFor:function(e){var t=this.parameterTable[e];if(t){return t.value}return null},setValue:function(e,t){var n=this.parameterTable[e];if(n){n.value=t}},forEach:function(e){for(var t in this.parameterTable){if(this.parameterTable[t].type&&this.parameterTable[t].name){e(this.parameterTable[t])}}},makeCopy:function(){var e=[];this.forEach(function(t){var n=new p(t.name,t.type,t.label,t.value,t.lines);e.push(n)});var t=new d(e,this._options,this.getParameters);t.clientCollect=this.clientCollect;return t},hasOptionalParameters:function(){return this._hasOptionalParameters}};d.prototype.constructor=d;return{CommandRegistry:c,URLBinding:h,ParametersDescription:d,CommandParameter:p}});define("text!orion/banner/slideout.html",[],function(){return'<div id="slideContainer" class="slideParameters slideContainer">\r\n	<span id="pageCommandParameters" class="layoutLeft parameters"></span>\r\n	<span id="pageCommandDismiss" class="layoutRight parametersDismiss"></span>\r\n</div>'});define("orion/commonHTMLFragments",["require","orion/webui/littlelib","text!orion/banner/slideout.html"],function(e,t,n){function r(e){var r=document.createElement("div");r.innerHTML=n;var i=t.$("#slideContainer",r);i.id=e+i.id;i=t.$("#pageCommandParameters",r);i.id=e+i.id;i=t.$("#pageCommandDismiss",r);i.id=e+i.id;return r.innerHTML}return{slideoutHTMLFragment:r}});define("orion/section",["orion/webui/littlelib","orion/selection","orion/commandRegistry","orion/commonHTMLFragments","orion/objects","orion/selection"],function(e,t,n,r,i,s){function o(t,n){var i=this;this._expandImageClass="core-sprite-openarrow";this._collapseImageClass="core-sprite-closedarrow";this._twistieSpriteClass="modelDecorationSprite";if(!n.id){throw new Error("Missing required argument: id")}this.id=n.id;if(!n.title){throw new Error("Missing required argument: title")}var s=n.useAuxStyle?["sectionWrapper","sectionWrapperAux","toolComposite"]:["sectionWrapper","toolComposite"];this.domNode=document.createElement("div");t.appendChild(this.domNode);for(var o=0;o<s.length;o++){this.domNode.classList.add(s[o])}this.domNode.id=n.id;if(n.canHide){this.twistie=document.createElement("span");this.twistie.classList.add("modelDecorationSprite");this.twistie.classList.add("layoutLeft");this.twistie.classList.add("sectionTitleTwistie");this.domNode.style.cursor="pointer";this.domNode.appendChild(this.twistie);this.domNode.tabIndex=0;this.domNode.addEventListener("click",function(e){if(e.target===i.titleNode||e.target===i.twistie){i._changeExpandedState()}},false);this.domNode.addEventListener("keydown",function(t){if(t.keyCode===e.KEY.ENTER&&(t.target===i.domNode||t.target===i.titleNode||t.target===i.twistie)){i._changeExpandedState()}},false)}var u;if(n.iconClass){var a=document.createElement("span");a.classList.add("sectionIcon");this.domNode.appendChild(a);u=Array.isArray(n.iconClass)?n.iconClass:[n.iconClass];u.forEach(function(e){a.classList.add(e)})}if(n.headerClass){u=Array.isArray(n.headerClass)?n.headerClass:[n.headerClass];u.forEach(function(e){this.domNode.classList.add(e)}.bind(this))}this.titleNode=document.createElement("div");this.titleNode.id=n.id+"Title";this.titleNode.classList.add("sectionAnchor");this.titleNode.classList.add("sectionTitle");this.titleNode.classList.add("layoutLeft");this.domNode.appendChild(this.titleNode);this.titleNode.textContent=n.title;if(typeof n.getItemCount==="function"){var f=document.createElement("div");f.classList.add("layoutLeft");f.classList.add("sectionItemCount");this.domNode.appendChild(f);f.textContent=n.getItemCount(this)}this._progressNode=document.createElement("div");this._progressNode.id=n.id+"Progress";this._progressNode.classList.add("sectionProgress");this._progressNode.classList.add("sectionTitle");this._progressNode.classList.add("layoutLeft");this._progressNode.style.visibility="hidden";this._progressNode.textContent="...";this.domNode.appendChild(this._progressNode);var l=document.createElement("div");l.id=n.id+"FilterSearchBox";this.domNode.appendChild(l);this._toolActionsNode=document.createElement("div");this._toolActionsNode.id=n.id+"ToolActionsArea";this._toolActionsNode.classList.add("layoutRight");this._toolActionsNode.classList.add("sectionActions");this.domNode.appendChild(this._toolActionsNode);this.actionsNode=document.createElement("div");this.actionsNode.id=n.id+"ActionArea";this.actionsNode.classList.add("layoutRight");this.actionsNode.classList.add("sectionActions");this.domNode.appendChild(this.actionsNode);this.selectionNode=document.createElement("div");this.selectionNode.id=n.id+"SelectionArea";this.selectionNode.classList.add("layoutRight");this.selectionNode.classList.add("sectionActions");this.domNode.appendChild(this.selectionNode);if(n.slideout){var c=r.slideoutHTMLFragment(n.id);var h=document.createRange();h.selectNode(this.domNode);c=h.createContextualFragment(c);this.domNode.appendChild(c)}this._contentParent=document.createElement("div");this._contentParent.id=this.id+"Content";this._contentParent.role="region";this._contentParent.classList.add("sectionTable");this._contentParent.setAttribute("aria-labelledby",this.titleNode.id);t.appendChild(this._contentParent);if(n.content){this.setContent(n.content)}this.hidden=n.hidden;if(typeof n.onExpandCollapse==="function"){this._onExpandCollapse=n.onExpandCollapse}this._preferenceService=n.preferenceService;this._contentParent.style.display="none";this.domNode.classList.add("sectionWrapperClosed");if(this._preferenceService){var p=this;this._preferenceService.getPreferences("/window/views").then(function(e){var t=e.get(p.id);if(t===undefined){}else{p.hidden=!t}if(!p.hidden){p._contentParent.style.display="block";p.domNode.classList.remove("sectionWrapperClosed")}p._updateExpandedState(!p.hidden,false)})}else{if(!this.hidden){this._contentParent.style.display="block";this.domNode.classList.remove("sectionWrapperClosed")}this._updateExpandedState(!this.hidden,false)}this._commandService=n.commandService;this._lastMonitor=0;this._loading={}}function u(e){this._section=e;this._id=++e._lastMonitor}o.prototype={setTitle:function(e){this.titleNode.textContent=e},getHeaderElement:function(e){return this.domNode},getTitleElement:function(e){return this.titleNode},setContent:function(e){if(typeof e==="string"){this._contentParent.innerHTML=e}else{this._contentParent.innerHTML="";this._contentParent.appendChild(e)}},getContentElement:function(){return this._contentParent},embedExplorer:function(t,n,r){this._contentParent.innerHTML="";if(!t.parent){t.parent=n}this._contentParent.appendChild(t.parent);t.section=this;i.mixin(t,{createActionSections:function(){if(this.actionsSections)this.actionsSections.forEach(function(t){if(!e.node(t)){var n=document.createElement("ul");n.id=t;n.classList.add("commandList");n.classList.add("layoutRight");this.section.actionsNode.appendChild(n)}}.bind(this))},getCommandsVisible:function(){return this.section.actionsNode.style.visibility!=="hidden"},setCommandsVisible:function(t){this.section.actionsNode.style.visibility=t?"":"hidden";var n=t?null:"cursorOnly";this.renderer.selectionPolicy=n;var r=this.getNavHandler();if(r){r.setSelectionPolicy(n)}if(t){this.updateCommands()}else{if(this.actionsSections)this.actionsSections.forEach(function(t){if(e.node(t))this.commandRegistry.destroy(t)}.bind(this))}},destroy:function(){Object.getPrototypeOf(this).destroy.call(this);var e=this;if(!this.actionsSections){return}this.actionsSections.forEach(function(t){delete e[t]});delete this.actionsSections},updateCommands:function(e){if(!this.section.actionsNode||!this.getCommandsVisible()){return}this.createActionSections();Object.getPrototypeOf(this).updateCommands.call(this,e)},loaded:function(){var e=this;if(!this.selection&&!r){if(this.serviceRegistry||this.registry){this.selection=new s.Selection(this.serviceRegistry||this.registry,this.parent.id+"Selection");this.selection.addEventListener("selectionChanged",function(t){e.updateCommands(t.selections)})}else{window.console.error("Could not create a Selection for the explorer because of lack of serviceRegistry")}}var t=this.registerCommands();if(!t||!t.then){e.updateCommands()}else{t.then(function(){e.updateCommands()})}}});if(t.renderer){t.renderer.section=this;i.mixin(t.renderer,{getCellHeaderElement:function(e){var t=Object.getPrototypeOf(this).getCellHeaderElement.call(this,e);if(t){this.section.setTitle(t.innerHTML)}return null}})}},createProgressMonitor:function(){return new u(this)},_setMonitorMessage:function(e,t){this._progressNode.style.visibility="visible";this._loading[e]=t;var n="";for(var r in this._loading){if(n!==""){n+="\n"}n+=this._loading[r]}this._progressNode.title=n},_monitorDone:function(e){delete this._loading[e];var t="";for(var n in this._loading){if(t!==""){t+="\n"}t+=this._loading[n]}this._progressNode.title=t;if(t===""){this._progressNode.style.visibility="hidden"}},_changeExpandedState:function(){if(!this.hidden){this._contentParent.style.display="none";this.domNode.classList.add("sectionWrapperClosed");this.hidden=true}else{this._contentParent.style.display="block";this.domNode.classList.remove("sectionWrapperClosed");this.hidden=false}this._updateExpandedState(!this.hidden,true)},_updateExpandedState:function(e,t){var n=this.twistie;var r=this.id;if(n){n.classList.add(e?this._expandImageClass:this._collapseImageClass);n.classList.remove(e?this._collapseImageClass:this._expandImageClass)}if(this._preferenceService&&t){this._preferenceService.getPreferences("/window/views").then(function(t){t.put(r,e)})}if(this._onExpandCollapse){this._onExpandCollapse(e,this)}}};o.prototype.constructor=o;u.prototype={begin:function(e){this.status=e;this._section._setMonitorMessage(this.id,e)},worked:function(e){this.status=e;this._section._setMonitorMessage(this.id,e)},done:function(e){this.status=e;this._section._monitorDone(this.id)}};u.prototype.constructor=u;return{Section:o}});define("orion/markdownView",["marked/marked","orion/editor/editor","orion/objects","orion/webui/littlelib","orion/URITemplate","orion/PageUtil","orion/section","orion/URL-shim"],function(e,t,n,r,i,s,o){function a(e,t,n){return function(r,i){if(i.href.indexOf(":")===-1){try{var s;if(t.protocol==="filesystem:"){s={href:"filesystem:"+(new URL(i.href,t.pathname)).href}}else{s=new URL(i.href,t);if(n){s.protocol="";s.host=""}}if(r[0][0]!=="!"){i.href=u.expand({resource:s.href})}else{i.href=s.href}}catch(o){console.log(o)}}return e.call(this,r,i)}}function f(t){var n=e.InlineLexer.prototype.outputLink;var r=s.matchResourceParameters().resource;var i=new URL(r,window.location.href);e.InlineLexer.prototype.outputLink=a(n,i,r.indexOf(":")===-1);var o=e(t,{sanitize:true});e.InlineLexer.prototype.outputLink=n;return o}function l(e){this.fileClient=e.fileClient;this.progress=e.progress;this.canHide=e.canHide;this._node=null}function h(e){this.id="orion.markdownViewer";c.apply(this,arguments)}function p(e){this._parent=e.parent;this.serviceRegistry=e.serviceRegistry;this.contentTypeRegistry=e.contentTypeRegistry;this.commandRegistry=e.commandRegistry;this.progress=e.progressService;this.model=e.model;this.undoStack=e.undoStack}var u=new i("#{,resource,params*}");l.prototype={display:function(e,t){e.classList.add("orionMarkdown");e.innerHTML=f(t)},displayContents:function(e,t){var n=t.Location||t;r.empty(e);var i=document.createElement("div");(this.progress?this.progress.progress(this.fileClient.read(n),"Reading file "+(t.Name||n)):this.fileClient.read(n)).then(function(e){this.display.bind(this)(i,e)}.bind(this));e.appendChild(i)},displayInFrame:function(e,t,n){var r=new o.Section(e,{id:"markdownSection",title:t.Name||"readme",headerClass:n,canHide:this.canHide});this.displayContents.call(this,r.getContentElement(),t)}};var c=t.BaseEditor;h.prototype=Object.create(c.prototype);n.mixin(h.prototype,{install:function(){var e=this._rootDiv=document.createElement("div");e.style.width="100%";e.style.height="100%";var t=this._contentDiv=document.createElement("div");t.classList.add("orionMarkdown");e.appendChild(t);var n=r.node(this._domNode);n.appendChild(e);this._contentDiv.innerHTML=f(this.getModel().getText());c.prototype.install.call(this)},setInput:function(e,t,n,r){c.prototype.setInput.call(this,e,t,n,r);if(!t&&!r){this._contentDiv.innerHTML=f(n)}},uninstall:function(){r.empty(this._domNode);c.prototype.uninstall.call(this)}});p.prototype={create:function(){this.editor=new h({domNode:this._parent,model:this.model,undoStack:this.undoStack});this.editor.install()},destroy:function(){if(this.editor){this.editor.destroy()}this.editor=null}};return{MarkdownEditorView:p,MarkdownView:l}});define("orion/widgets/browse/browseView",["i18n!orion/edit/nls/messages","orion/explorers/explorer-table","orion/explorers/navigatorRenderer","orion/markdownView","orion/PageUtil","orion/URITemplate","orion/webui/littlelib","orion/objects","orion/Deferred","orion/section"],function(e,t,n,r,i,s,o,u,a,f){function p(){c.apply(this,arguments)}function d(e){e.setFocus=false;e.cachePrefix=null;e.rendererFactory=function(t){return new p({checkbox:false,cachePrefix:"FolderNavigator"},t,e.commandRegistry,e.contentTypeRegistry)};l.apply(this,arguments);this.commandsId=".folderNav";this.fileClient=e.fileClient;this.commandRegistry=e.commandRegistry;this.contentTypeRegistry=e.contentTypeRegistry;this.readonly=e.readonly;this.breadCrumbMaker=e.breadCrumbMaker;this.clickHandler=e.clickHandler;this.treeRoot={};this.parent=o.node(e.parentId);this.toolbarId=this.parent.id+"Tool";this.newActionsScope=this.parent.id+"NewScope";this.selectionActionsScope=this.parent.id+"SelectionScope";this.actionsSections=[this.newActionsScope,this.selectionActionsScope]}function v(e){this._parent=e.parent;this._metadata=e.metadata;this.fileClient=e.fileService;this.progress=e.progressService;this.commandRegistry=e.commandRegistry;this.contentTypeRegistry=e.contentTypeRegistry;this.preferences=e.preferences;this.readonly=typeof e.readonly==="undefined"?false:e.readonly;this.showFolderNav=true;this.readmeHeaderClass=e.readmeHeaderClass;this.editorView=e.editorView;this._maxEditorHeight=e.maxEditorHeight;this.imageView=e.imageView;this.breadCrumbMaker=e.breadCrumbMaker;this.clickHandler=e.clickHandler;this._init()}var l=t.FileExplorer;var c=n.NavigatorRenderer;var h=new s("#{,resource,params*}");p.prototype=Object.create(c.prototype);u.mixin(p.prototype,{showFolderImage:true,createFolderNode:function(e){var t=n.NavigatorRenderer.prototype.createFolderNode.call(this,e);if(this.showFolderLinks&&t.tagName==="A"){t.href=h.expand({resource:e.Location})}t.classList.add("folderNavFolder");t.classList.add("navlink");t.classList.add("targetSelector");t.classList.remove("navlinkonpage");if(this.explorer.readonly&&this.explorer.clickHandler){t.href="javascript:void(0)";t.addEventListener("click",function(){this.explorer.clickHandler(e.Location)}.bind(this),false)}return t},updateFileNode:function(e,t,r){n.NavigatorRenderer.prototype.updateFileNode.call(this,e,t,r);if(this.explorer.readonly&&t.tagName==="A"){if(this.explorer.clickHandler){t.href="javascript:void(0)";t.addEventListener("click",function(){this.explorer.clickHandler(e.Location)}.bind(this),false)}else{t.href=h.expand({resource:e.Location})}}},getCellHeaderElement:function(e){if(this.explorer.breadCrumbMaker){return null}var t;if(e===0){t=document.createElement("th");t.colSpan=1;var n=this.explorer.treeRoot;t.appendChild(document.createTextNode(n.Parents?n.Name:this.explorer.fileClient.fileServiceName(n.Location)));return t}return null},emptyCallback:function(e){if(this.explorer.readonly){return}n.NavigatorRenderer.prototype.emptyCallback.call(this,e)},getExpandImage:function(){return null}});d.prototype=Object.create(l.prototype);u.mixin(d.prototype,{loadRoot:function(e){if(e){this.load(e,"Loading "+e.Name).then(this.loaded.bind(this))}else{this.loadResourceList(i.matchResourceParameters().resource+"?depth=1",false).then(this.loaded.bind(this))}},registerCommands:function(){return(new a).resolve()},updateCommands:function(e){}});v.prototype={_init:function(){this.markdownView=new r.MarkdownView({fileClient:this.fileClient,canHide:!this.readonly,progress:this.progress})},_isCommandsVisible:function(){return!this.readonly},displayWorkspaceView:function(){if(!this._node){this._node=document.createElement("div");this._node.classList.add("browse_inner_container")}this._parent.appendChild(this._node)},displayBrowseView:function(e){function u(e){e.forEach(function(e){if(e==="folderNav"){if(this.showFolderNav){var t=document.createElement("div");t.id="folderNavNode";this._foldersSection=new f.Section(this._node,{id:"folderNavSection",title:"Files",canHide:!this.readonly});if(this.editorView){this._foldersSection.setContent(this.editorView.getParent());this.editorView.create();var r=this.editorView.editor.getTextView();r.getModel().addEventListener("Changed",this._editorViewModelChangedListener=function(e){var t=r.getLineHeight()*r.getModel().getLineCount()+20;if(this._maxEditorHeight&&this._maxEditorHeight>0&&t>this._maxEditorHeight){t=this._maxEditorHeight}this.editorView.getParent().style.height=t+"px"}.bind(this));this.editor=this.editorView.editor}else if(this.imageView){}else{this.folderNavExplorer=new d({parentId:t,readonly:this.readonly,breadCrumbMaker:this.breadCrumbMaker,clickHandler:this.clickHandler,fileClient:this.fileClient,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry});this._foldersSection.embedExplorer(this.folderNavExplorer,null,true);this.folderNavExplorer.setCommandsVisible(this._isCommandsVisible());this.folderNavExplorer.loadRoot(this._metadata)}if(this.breadCrumbMaker){var i=this._foldersSection.getTitleElement();if(i){o.empty(i);var u=document.createElement("div");i.appendChild(u);this.breadCrumbMaker(u,this._foldersSection.getHeaderElement().offsetWidth-24)}}}}else if(e==="readme"){if(n){s=document.createElement("div");this.markdownView.displayInFrame(s,n,this.readmeHeaderClass);this._node.appendChild(s)}}}.bind(this))}var t=e.Children;var n;if(t){for(var r=0;r<t.length;r++){var i=t[r];if(!i.Directory&&i.Name&&i.Name.toLowerCase()==="readme.md"){n=i}}}var s;if(!this._node){this._node=document.createElement("div");this._node.classList.add("browse_inner_container")}this._parent.appendChild(this._node);var a=["folderNav","readme"];u.apply(this,[a])},updateImage:function(e){this._foldersSection.setContent(e)},create:function(){if(this._metadata.Projects){this.displayWorkspaceView()}if(this.editorView||this.imageView){this.displayBrowseView(this._metadata)}else if(this._metadata.Children){this.displayBrowseView(this._metadata)}else if(this._metadata.ChildrenLocation){this.progress.progress(this.fileClient.fetchChildren(this._metadata.ChildrenLocation),"Fetching children of "+this._metadata.Name).then(function(e){this._metadata.Children=e;this.displayBrowseView(this._metadata)}.bind(this))}},destroy:function(){if(this.editorView){this.editorView.editor.getTextView().getModel().removeEventListener("Changed",this._editorViewModelChangedListener);this.editorView.destroy();this.editor=null}if(this.folderNavExplorer){this.folderNavExplorer.destroy()}this.folderNavExplorer=null;if(this._node&&this._node.parentNode){this._node.parentNode.removeChild(this._node)}this._node=null}};return{BrowseView:v}});define("orion/editor/find",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/regex","orion/objects","orion/util"],function(e,t,n,r,i,s,o){function a(e){var t=e.getTextView();n.KeyMode.call(this,t);this.editor=e;this._active=false;this._success=true;this._ignoreSelection=false;this._prefix="";t.setAction("incrementalFindCancel",function(){this.setActive(false);return true}.bind(this));t.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));var r=this;this._listener={onVerify:function(e){var t=r.editor;var n=t.getModel();var s=t.mapOffset(e.start),o=t.mapOffset(e.end);var u=n.getText(s,o);var a=r._prefix;var f=a.match(new RegExp("^"+i.escape(u),"i"));if(f&&f.length>0){a=r._prefix+=e.text;r._success=true;r._status();r.find(r._forward,true);e.text=null}},onSelection:function(){if(!r._ignoreSelection){r.setActive(false)}}}}function f(e,t,n){if(!e){return}this._editor=e;this._undoStack=t;this._showAll=true;this._visible=false;this._caseInsensitive=true;this._wrap=true;this._wholeWord=false;this._incremental=true;this._regex=false;this._findAfterReplace=true;this._hideAfterFind=false;this._reverse=false;this._start=undefined;this._end=undefined;this._timer=undefined;this._lastString="";var r=this;this._listeners={onEditorFocus:function(e){r._removeCurrentAnnotation(e)}};this.setOptions(n)}var u={};a.prototype=new n.KeyMode;s.mixin(a.prototype,{createKeyBindings:function(){var e=t.KeyBinding;var n=[];n.push({actionID:"incrementalFindBackspace",keyBinding:new e(8)});n.push({actionID:"incrementalFindCancel",keyBinding:new e(13)});n.push({actionID:"incrementalFindCancel",keyBinding:new e(27)});n.push({actionID:"incrementalFindReverse",keyBinding:new e(38)});n.push({actionID:"incrementalFind",keyBinding:new e(40)});n.push({actionID:"incrementalFindReverse",keyBinding:new e("k",true,true)});n.push({actionID:"incrementalFind",keyBinding:new e("k",true)});return n},find:function(e,t){this._forward=e;if(!this.isActive()){this.setActive(true);return false}var n=this._prefix;if(n.length===0){return false}var r=this.editor;var i=r.getModel();var s;if(e){if(this._success){s=t?this._start:r.getCaretOffset()+1}else{s=0}}else{if(this._success){s=t?this._start:r.getCaretOffset()}else{s=i.getCharCount()-1}}var o=r.getModel().find({string:n,start:s,reverse:!e,caseInsensitive:n.toLowerCase()===n}).next();if(o){if(!t){this._start=s}this._success=true;this._ignoreSelection=true;r.moveSelection(e?o.start:o.end,e?o.end:o.start);this._ignoreSelection=false}else{this._success=false}this._status();return true},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(e){if(this._active===e){return}this._active=e;this._prefix="";this._success=true;var t=this.editor;var n=t.getTextView();this._start=this.editor.getCaretOffset();this.editor.setCaretOffset(this._start);if(this._active){n.addEventListener("Verify",this._listener.onVerify);n.addEventListener("Selection",this._listener.onSelection);n.addKeyMode(this)}else{n.removeEventListener("Verify",this._listener.onVerify);n.removeEventListener("Selection",this._listener.onSelection);n.removeKeyMode(this)}this._status()},_backspace:function(){var e=this._prefix;e=this._prefix=e.substring(0,e.length-1);if(e.length===0){this._success=true;this._ignoreSelection=true;this.editor.setCaretOffset(this.editor.getSelection().start);this._ignoreSelection=false;this._status();return true}return this.find(this._forward,true)},_status:function(){if(!this.isActive()){this.editor.reportStatus("");return}var t;if(this._forward){t=this._success?e.incrementalFindStr:e.incrementalFindStrNotFound}else{t=this._success?e.incrementalFindReverseStr:e.incrementalFindReverseStrNotFound}t=o.formatMessage(t,this._prefix);this.editor.reportStatus(t,this._success?"":"error")}});u.IncrementalFind=a;f.prototype={find:function(e,t,n){this.setOptions({reverse:!e});var r=this.getFindString();var i;if(t){r=t.findString||r;i=t.count}var s=this.getOptions();this.setOptions(t);var o=n?this._startOffset:this.getStartOffset();var u=this._doFind(r,o,i);if(u){if(!n){this._startOffset=u.start}}this.setOptions(s);if(this._hideAfterFind){this.hide()}return u},getStartOffset:function(){if(this._start!==undefined){return this._start}if(this._reverse){return this._editor.getSelection().start-1}return this._editor.getCaretOffset()},getFindString:function(){var e=this._editor.getSelection();var t=this._editor.getText(e.start,e.end);if(this._regex){t=i.escape(t)}return t||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},hide:function(){this._visible=false;if(this._savedOptions){this.setOptions(this._savedOptions.pop());if(this._savedOptions.length===0){this._savedOptions=null}}this._removeAllAnnotations();var e=this._editor.getTextView();if(e){e.removeEventListener("Focus",this._listeners.onEditorFocus);e.focus()}},_processReplaceString:function(e){var t=e;if(this._regex){t="";var n=false;var r=this._editor.getModel().getLineDelimiter();for(var i=0;i<e.length;i++){var s=e.substring(i,i+1);if(n){switch(s){case"R":t+=r;break;case"r":t+="\r";break;case"n":t+="\n";break;case"t":t+="	";break;case"\\":t+="\\";break;default:t+="\\"+s}n=false}else if(s==="\\"){n=true}else{t+=s}}if(n){t+="\\"}}return t},isVisible:function(){return this._visible},replace:function(){var e=this.getFindString();if(e){var t=this._editor;var n=this._processReplaceString(this.getReplaceString());var r=t.getSelection();var i=r.start;var s=t.getModel().find({string:e,start:i,reverse:false,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next();if(s){this.startUndo();this._doReplace(s.start,s.end,e,n);this.endUndo()}}if(this._findAfterReplace&&e){this._doFind(e,this.getStartOffset())}},replaceAll:function(){var t=this.getFindString();if(t){this._replacingAll=true;var n=this._editor;var r=n.getTextView();n.reportStatus(e.replaceAll);var i=this._processReplaceString(this.getReplaceString());var s=this;window.setTimeout(function(){var u=0;var a=0,f;while(true){var l=s._doFind(t,u,null,true);if(!l){break}f=l;a++;if(a===1){r.setRedraw(false);s.startUndo()}s._doReplace(l.start,l.end,t,i);u=s.getStartOffset()}if(a>0){s.endUndo();r.setRedraw(true)}if(u>0){n.reportStatus(o.formatMessage(e.replacedMatches,a))}else{n.reportStatus(e.nothingReplaced,"error")}s._replacingAll=false},100)}},setOptions:function(e){if(e){if((e.showAll===true||e.showAll===false)&&this._showAll!==e.showAll){this._showAll=e.showAll;if(this.isVisible()){if(this._showAll){this._markAllOccurrences()}else{var t=this._editor.getAnnotationModel();if(t){t.removeAnnotations(r.AnnotationType.ANNOTATION_MATCHING_SEARCH)}}}}if(e.caseInsensitive===true||e.caseInsensitive===false){this._caseInsensitive=e.caseInsensitive}if(e.wrap===true||e.wrap===false){this._wrap=e.wrap}if(e.wholeWord===true||e.wholeWord===false){this._wholeWord=e.wholeWord}if(e.incremental===true||e.incremental===false){this._incremental=e.incremental}if(e.regex===true||e.regex===false){this._regex=e.regex}if(e.findAfterReplace===true||e.findAfterReplace===false){this._findAfterReplace=e.findAfterReplace}if(e.hideAfterFind===true||e.hideAfterFind===false){this._hideAfterFind=e.hideAfterFind}if(e.reverse===true||e.reverse===false){this._reverse=e.reverse}if(e.hasOwnProperty("findCallback")){this._findCallback=e.findCallback}if(e.hasOwnProperty("start")){this._start=e.start}if(e.hasOwnProperty("end")){this._end=e.end}}},show:function(e){this._visible=true;if(e){if(!this._savedOptions){this._savedOptions=[]}this._savedOptions.push(this.getOptions());this.setOptions(e)}this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var t=this;window.setTimeout(function(){if(t._incremental){t.find(true,null,true)}},0)},startUndo:function(){if(this._undoStack){this._undoStack.startCompoundChange()}},endUndo:function(){if(this._undoStack){this._undoStack.endCompoundChange()}},_find:function(e,t,n){return this._editor.getModel().find({string:e,start:t,end:this._end,reverse:this._reverse,wrap:n?false:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(t,n,i,s){i=i||1;var o=this._editor;if(!t){this._removeAllAnnotations();return null}this._lastString=t;var u,a;if(this._regex){try{a=this._find(t,n,s)}catch(f){o.reportStatus(f.message,"error");return}}else{a=this._find(t,n,s)}for(var l=0;l<i&&a.hasNext();l++){u=a.next()}if(!this._replacingAll){if(u){this._editor.reportStatus("")}else{this._editor.reportStatus(e.notFound,"error")}if(this.isVisible()){var c=r.AnnotationType.ANNOTATION_CURRENT_SEARCH;var h=o.getAnnotationModel();if(h){h.removeAnnotations(c);if(u){h.addAnnotation(r.AnnotationType.createAnnotation(c,u.start,u.end))}}if(this._showAll){if(this._timer){window.clearTimeout(this._timer)}var p=this;this._timer=window.setTimeout(function(){p._markAllOccurrences();p._timer=null},500)}}if(this._findCallback){this._findCallback(u)}else if(u){o.moveSelection(u.start,u.end,null,false)}}return u},_doReplace:function(e,t,n,r){var i=this._editor;if(this._regex){r=i.getText(e,t).replace(new RegExp(n,this._caseInsensitive?"i":""),r);if(!r){return}}i.setText(r,e,t);i.setSelection(e,e+r.length,true)},_markAllOccurrences:function(){var e=this._editor.getAnnotationModel();if(!e){return}var t=r.AnnotationType.ANNOTATION_MATCHING_SEARCH;var n=e.getAnnotations(0,e.getTextModel().getCharCount());var i=[],s;while(n.hasNext()){var o=n.next();if(o.type===t){i.push(o)}}if(this.isVisible()){var u=this.getFindString();n=this._editor.getModel().find({string:u,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});s=[];while(n.hasNext()){var a=n.next();s.push(r.AnnotationType.createAnnotation(t,a.start,a.end))}}e.replaceAnnotations(i,s)},_removeAllAnnotations:function(){var e=this._editor.getAnnotationModel();if(e){e.removeAnnotations(r.AnnotationType.ANNOTATION_CURRENT_SEARCH);e.removeAnnotations(r.AnnotationType.ANNOTATION_MATCHING_SEARCH)}},_removeCurrentAnnotation:function(e){var t=this._editor.getAnnotationModel();if(t){t.removeAnnotations(r.AnnotationType.ANNOTATION_CURRENT_SEARCH)}}};u.Find=f;return u});define("orion/editor/actions",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/annotations","orion/editor/tooltip","orion/editor/find","orion/util"],function(e,t,n,r,i,s){function a(e,t,n){this.editor=e;this.undoStack=t;this._incrementalFind=new i.IncrementalFind(e);this._find=n?n:new i.Find(e,t);this._lastEditLocation=null;this.init()}function f(e,t,n,r){this.editor=e;this.undoStack=t;this.contentAssist=n;this.linkedMode=r;if(this.contentAssist){this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this))}this.init()}var o=n.AnnotationType;var u={};a.prototype={init:function(){var n=this.editor.getTextView();this._lastEditListener={onModelChanged:function(e){if(this.editor.isDirty()){this._lastEditLocation=e.start+e.addedCharCount}}.bind(this)};n.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);n.setAction("undo",function(e){if(this.undoStack){var t=1;if(e&&e.count){t=e.count}while(t>0){this.undoStack.undo();--t}return true}return false}.bind(this),{name:e.undo});n.setAction("redo",function(e){if(this.undoStack){var t=1;if(e&&e.count){t=e.count}while(t>0){this.undoStack.redo();--t}return true}return false}.bind(this),{name:e.redo});n.setKeyBinding(new t.KeyBinding("f",true),"find");n.setAction("find",function(){if(this._find){var t=this.editor.getSelection();var n=prompt(e.find,this.editor.getText(t.start,t.end));if(n){this._find.find(true,{findString:n})}}}.bind(this),{name:e.find});n.setKeyBinding(new t.KeyBinding("k",true),"findNext");n.setAction("findNext",function(e){if(this._find){this._find.find(true,e);return true}return false}.bind(this),{name:e.findNext});n.setKeyBinding(new t.KeyBinding("k",true,true),"findPrevious");n.setAction("findPrevious",function(e){if(this._find){this._find.find(false,e);return true}return false}.bind(this),{name:e.findPrevious});n.setKeyBinding(new t.KeyBinding("j",true),"incrementalFind");n.setAction("incrementalFind",function(){if(this._incrementalFind){this._incrementalFind.find(true)}return true}.bind(this),{name:e.incrementalFind});n.setKeyBinding(new t.KeyBinding("j",true,true),"incrementalFindReverse");n.setAction("incrementalFindReverse",function(){if(this._incrementalFind){this._incrementalFind.find(false)}return true}.bind(this),{name:e.incrementalFindReverse});n.setAction("tab",function(){return this.indentLines()}.bind(this));n.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:e.unindentLines});n.setKeyBinding(new t.KeyBinding(38,false,false,true),"moveLinesUp");n.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:e.moveLinesUp});n.setKeyBinding(new t.KeyBinding(40,false,false,true),"moveLinesDown");n.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:e.moveLinesDown});n.setKeyBinding(new t.KeyBinding(38,true,false,true),"copyLinesUp");n.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:e.copyLinesUp});n.setKeyBinding(new t.KeyBinding(40,true,false,true),"copyLinesDown");n.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:e.copyLinesDown});n.setKeyBinding(new t.KeyBinding("d",true,false,false),"deleteLines");n.setAction("deleteLines",function(e){return this.deleteLines(e)}.bind(this),{name:e.deleteLines});n.setKeyBinding(new t.KeyBinding("l",!s.isMac,false,false,s.isMac),"gotoLine");n.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:e.gotoLine});n.setKeyBinding(new t.KeyBinding(190,true),"nextAnnotation");n.setAction("nextAnnotation",function(){return this.nextAnnotation(true)}.bind(this),{name:e.nextAnnotation});n.setKeyBinding(new t.KeyBinding(188,true),"previousAnnotation");n.setAction("previousAnnotation",function(){return this.nextAnnotation(false)}.bind(this),{name:e.prevAnnotation});n.setKeyBinding(new t.KeyBinding("e",true,false,true,false),"expand");n.setAction("expand",function(){return this.expandAnnotation(true)}.bind(this),{name:e.expand});n.setKeyBinding(new t.KeyBinding("c",true,false,true,false),"collapse");n.setAction("collapse",function(){return this.expandAnnotation(false)}.bind(this),{name:e.collapse});n.setKeyBinding(new t.KeyBinding("e",true,true,true,false),"expandAll");n.setAction("expandAll",function(){return this.expandAnnotations(true)}.bind(this),{name:e.expandAll});n.setKeyBinding(new t.KeyBinding("c",true,true,true,false),"collapseAll");n.setAction("collapseAll",function(){return this.expandAnnotations(false)}.bind(this),{name:e.collapseAll});n.setKeyBinding(new t.KeyBinding("q",!s.isMac,false,false,s.isMac),"lastEdit");n.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:e.lastEdit})},copyLinesDown:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=n.getLineStart(i);var u=n.getLineEnd(s,true);var a=n.getLineCount();var f="";var l=n.getText(o,u);if(s===a-1){l=(f=n.getLineDelimiter())+l}var c=u;e.setText(l,c,c);e.setSelection(c+f.length,c+l.length);return true},copyLinesUp:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=n.getLineStart(i);var u=n.getLineEnd(s,true);var a=n.getLineCount();var f="";var l=n.getText(o,u);if(s===a-1){l+=f=n.getLineDelimiter()}var c=o;e.setText(l,c,c);e.setSelection(c,c+l.length-f.length);return true},deleteLines:function(e){var t=this.editor;var n=t.getTextView();if(n.getOptions("readonly")){return false}var r=1;if(e&&e.count){r=e.count}var i=t.getSelection();var s=t.getModel();var o=s.getLineAtOffset(i.start);var u=s.getLineStart(o);var a;if(i.start!==i.end||r===1){a=s.getLineAtOffset(i.end>i.start?i.end-1:i.end)}else{a=Math.min(o+r-1,s.getLineCount()-1)}var f=s.getLineEnd(a,true);t.setText("",u,f);return true},expandAnnotation:function(e){var t=this.editor;var r=t.getAnnotationModel();if(!r){return true}var i=t.getModel();var s=t.getCaretOffset();var o=i.getLineAtOffset(s);var u=i.getLineStart(o);var a=i.getLineEnd(o,true);if(i.getBaseModel){u=i.mapOffset(u);a=i.mapOffset(a);i=i.getBaseModel()}var f,l=r.getAnnotations(u,a);while(!f&&l.hasNext()){var c=l.next();if(c.type!==n.AnnotationType.ANNOTATION_FOLDING){continue}f=c}if(f){if(e!==f.expanded){if(e){f.expand()}else{t.setCaretOffset(f.start);f.collapse()}}}return true},expandAnnotations:function(e){var t=this.editor;var r=t.getTextView();var i=t.getAnnotationModel();if(!i){return true}var s=t.getModel();var o,u=i.getAnnotations(0,s.getCharCount());r.setRedraw(false);while(u.hasNext()){o=u.next();if(o.type!==n.AnnotationType.ANNOTATION_FOLDING){continue}if(e!==o.expanded){if(e){o.expand()}else{o.collapse()}}}r.setRedraw(true);return true},indentLines:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}if(!t.getOptions("tabMode")){return}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);if(i!==s){var o=[];o.push("");for(var u=i;u<=s;u++){o.push(n.getLine(u,true))}var a=n.getLineStart(i);var f=n.getLineEnd(s,true);var l=t.getOptions("tabSize","expandTab");var c=l.expandTab?(new Array(l.tabSize+1)).join(" "):"	";e.setText(o.join(c),a,f);e.setSelection(a===r.start?r.start:r.start+c.length,r.end+(s-i+1)*c.length);return true}return false},gotoLastEdit:function(){if(typeof this._lastEditLocation==="number"){this.editor.showSelection(this._lastEditLocation)}return true},gotoLine:function(){var t=this.editor;var n=t.getModel();var r=n.getLineAtOffset(t.getCaretOffset());r=prompt(e.gotoLinePrompty,r+1);if(r){r=parseInt(r,10);t.onGotoLine(r-1,0)}return true},moveLinesDown:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=n.getLineCount();if(s===o-1){return true}var u=n.getLineStart(i);var a=n.getLineEnd(s,true);var f=n.getLineEnd(s+1,true)-(a-u);var l,c=0;if(s!==o-2){l=n.getText(u,a)}else{var h=n.getLineEnd(s);l=n.getText(h,a)+n.getText(u,h);c+=a-h}this.startUndo();e.setText("",u,a);e.setText(l,f,f);e.setSelection(f+c,f+c+l.length);this.endUndo();return true},moveLinesUp:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);if(i===0){return true}var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=n.getLineCount();var u=n.getLineStart(i-1);var a=n.getLineStart(i);var f=n.getLineEnd(s,true);var l=n.getText(a,f);var c=0;if(s===o-1){var h=n.getLineEnd(i-1);var p=n.getLineEnd(i-1,true);l+=n.getText(h,p);a=h;c=p-h}this.startUndo();e.setText("",a,f);e.setText(l,u,u);e.setSelection(u,u+l.length-c);this.endUndo();return true},nextAnnotation:function(e){function s(e){return!!e.lineStyle||e.type===o.ANNOTATION_MATCHING_BRACKET||e.type===o.ANNOTATION_CURRENT_BRACKET||!i.isAnnotationTypeVisible(e.type)}var t=this.editor;var n=t.getAnnotationModel();if(!n){return true}var i=t.getOverviewRuler()||t.getAnnotationStyler();if(!i){return true}var u=t.getModel();var a=t.getCaretOffset();var f=n.getAnnotations(e?a:0,e?u.getCharCount():a);var l=null;while(f.hasNext()){var c=f.next();if(e){if(c.start<=a){continue}}else{if(c.start>=a){continue}}if(s(c)){continue}l=c;if(e){break}}if(l){var h=[l];f=n.getAnnotations(l.start,l.start);while(f.hasNext()){c=f.next();if(c!==l&&!s(c)){h.push(c)}}var p=t.getTextView();var d=u.getLineAtOffset(l.start);var v=r.Tooltip.getTooltip(p);if(!v){t.moveSelection(l.start);return true}t.moveSelection(l.start,l.start,function(){v.setTarget({getTooltipInfo:function(){var e=p.convert({x:p.getLocationAtOffset(l.start).x,y:p.getLocationAtOffset(u.getLineStart(d)).y},"document","page");return{contents:h,x:e.x,y:e.y+Math.floor(p.getLineHeight(d)*1.33)}}},0)})}return true},unindentLines:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}if(!t.getOptions("tabMode")){return}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=t.getOptions("tabSize");var u=(new Array(o+1)).join(" ");var a=[],f=0,l=0;for(var c=i;c<=s;c++){var h=n.getLine(c,true);if(n.getLineStart(c)!==n.getLineEnd(c)){if(h.indexOf("	")===0){h=h.substring(1);f++}else if(h.indexOf(u)===0){h=h.substring(o);f+=o}else{return true}}if(c===i){l=f}a.push(h)}var p=n.getLineStart(i);var d=n.getLineEnd(s,true);var v=n.getLineStart(s);e.setText(a.join(""),p,d);var m=p===r.start?r.start:r.start-l;var g=Math.max(m,r.end-f+(r.end===v+1&&r.start!==r.end?1:0));e.setSelection(m,g);return true},startUndo:function(){if(this.undoStack){this.undoStack.startCompoundChange()}},endUndo:function(){if(this.undoStack){this.undoStack.endCompoundChange()}}};u.TextActions=a;f.prototype={init:function(){var n=this.editor.getTextView();n.setAction("lineStart",function(){return this.lineStart()}.bind(this));n.setAction("enter",function(){return this.autoIndent()}.bind(this));n.setKeyBinding(new t.KeyBinding("t",true,false,true),"trimTrailingWhitespaces");n.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:e.trimTrailingWhitespaces});n.setKeyBinding(new t.KeyBinding(191,true),"toggleLineComment");n.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:e.toggleLineComment});n.setKeyBinding(new t.KeyBinding(191,true,!s.isMac,false,s.isMac),"addBlockComment");n.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:e.addBlockComment});n.setKeyBinding(new t.KeyBinding(220,true,!s.isMac,false,s.isMac),"removeBlockComment");n.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:e.removeBlockComment});n.setKeyBinding(new t.KeyBinding("[",false,false,false,false,"keypress"),"autoPairSquareBracket");n.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));n.setKeyBinding(new t.KeyBinding("]",false,false,false,false,"keypress"),"skipClosingSquareBracket");n.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));n.setKeyBinding(new t.KeyBinding("<",false,false,false,false,"keypress"),"autoPairAngleBracket");n.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("<",">")}.bind(this));n.setKeyBinding(new t.KeyBinding(">",false,false,false,false,"keypress"),"skipClosingAngleBracket");n.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket(">")}.bind(this));n.setKeyBinding(new t.KeyBinding("(",false,false,false,false,"keypress"),"autoPairParentheses");n.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));n.setKeyBinding(new t.KeyBinding(")",false,false,false,false,"keypress"),"skipClosingParenthesis");n.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));n.setKeyBinding(new t.KeyBinding("{",false,false,false,false,"keypress"),"autoPairBraces");n.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));n.setKeyBinding(new t.KeyBinding("}",false,false,false,false,"keypress"),"skipClosingBrace");n.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));n.setKeyBinding(new t.KeyBinding("'",false,false,false,false,"keypress"),"autoPairSingleQuotation");n.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));n.setKeyBinding(new t.KeyBinding('"',false,false,false,false,"keypress"),"autoPairDblQuotation");n.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));n.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getSelection();if(n.start===n.end){var r=e.getModel();var i=r.getLineAtOffset(n.start);var s=r.getLine(i,false);var o=r.getLineStart(i);var u=0;var a=n.start-o;var f;while(u<a&&((f=s.charCodeAt(u))===32||f===9)){u++}var l=s.substring(0,u);var c=t.getOptions("tabSize","expandTab");var h=c.expandTab?(new Array(c.tabSize+1)).join(" "):"	";var p=r.getLineDelimiter();var d=/^[\s]*\/\*[\*]*[\s]*$/;var v=/^[\s]*\*/;var m=/\*\/[\s]*$/;var g=s.substring(0,a);var y=s.substring(a);var b;var w;if(this.smartIndentation&&s.charCodeAt(w=g.trimRight().length-1)===123){var E=a-w-1;var S=y.length-y.trimLeft().length;b=s.charCodeAt(a+S)===125?p+l+h+p+l:p+l+h;e.setText(b,n.start-E,n.end+S);e.setCaretOffset(n.start+p.length+l.length+h.length-E);return true}else if(this.autoCompleteComments&&!m.test(g)&&(d.test(g)||v.test(g))){var x;var T=d.exec(g);if(T){b=p+l+" * ";if(m.test(y)){b+=y.substring(0,y.length-2).trim()}else{b+=y.trim()}if(r.getLineCount()===i+1||!v.test(r.getLine(i+1))){b+=p+l+" */"}e.setText(b,n.start,n.end+y.length);e.setCaretOffset(n.start+p.length+l.length+3);return true}T=v.exec(g);if(T){for(var N=i-1;N>=0;N--){var C=r.getLine(N,false);if(d.test(C)){if(m.test(y)||s.charCodeAt(a)===47){b=p+l+"*"+y;x=n.start+p.length+l.length+1}else{b=p+l+"* "+y;x=n.start+p.length+l.length+2}e.setText(b,n.start,n.end+y.length);e.setCaretOffset(x);return true}else if(!v.test(C)){return false}}}return false}else if(m.test(g)&&l.charCodeAt(l.length-1)===32){b=p+l.substring(0,l.length-1);e.setText(b,n.start,n.end);e.setCaretOffset(n.start+b.length);return true}else if(u>0){u=a;while(u<s.length&&((f=s.charCodeAt(u++))===32||f===9)){n.end++}e.setText(r.getLineDelimiter()+l,n.start,n.end);return true}}return false},addBlockComment:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i="/*",s="*/",o=new RegExp("/\\*"+"|"+"\\*/","g");var u=this._findEnclosingComment(n,r.start,r.end);if(u.commentStart!==undefined&&u.commentEnd!==undefined){return true}var a=n.getText(r.start,r.end);if(a.length===0){return true}var f=a.length;a=a.replace(o,"");var l=a.length;e.setText(i+a+s,r.start,r.end);e.setSelection(r.start+i.length,r.end+i.length+(l-f));return true},autoPairBrackets:function(e,t){if(e==="["&&!this.autoPairSquareBrackets){return false}else if(e==="{"&&!this.autoPairBraces){return false}else if(e==="("&&!this.autoPairParentheses){return false}else if(e==="<"&&!this.autoPairAngleBrackets){return false}var n=this.editor;var r=n.getTextView();if(r.getOptions("readonly")){return false}var i=n.getSelection();var s=n.getModel();var o=n.getCaretOffset();var u=o===s.getCharCount()?"":s.getText(i.start,i.start+1).trim();var a=new RegExp("^$|[)}\\]>]");if(i.start===i.end&&a.test(u)){n.setText(e+t,i.start,i.start);n.setCaretOffset(i.start+1);return true}else if(i.start!==i.end){var f=s.getText(i.start,i.end);n.setText(e+f+t,i.start,i.end);n.setSelection(i.start+1,i.end+1);return true}return false},autoPairQuotations:function(e){if(!this.autoPairQuotation){return false}var t=this.editor;var n=t.getTextView();if(n.getOptions("readonly")){return false}var r=t.getSelection();var i=t.getModel();var s=t.getCaretOffset();var o=s===0?"":i.getText(r.start-1,r.start).trim();var u=s===i.getCharCount()?"":i.getText(r.start,r.start+1).trim();var a=new RegExp("^\"$|^'$");var f=new RegExp("\\w");var l=new RegExp("^$|[)}\\]>]");if(r.start!==r.end){var c=i.getText(r.start,r.end);if(a.test(c)){return false}t.setText(e+c+e,r.start,r.end);t.setSelection(r.start+1,r.end+1)}else if(u===e){t.setCaretOffset(r.start+1)}else if(o===e||a.test(u)||f.test(o)||!l.test(u)){return false}else{t.setText(e+e,r.start,r.start);t.setCaretOffset(r.start+1)}return true},contentAssistProposalApplied:function(e){var t=e.data.proposal;if(t.positions&&t.positions.length>0&&this.linkedMode){var n=[];for(var r=0;r<t.positions.length;++r){n[r]={positions:[{offset:t.positions[r].offset,length:t.positions[r].length}]}}this.linkedMode.enterLinkedMode({groups:n,escapePosition:t.escapePosition})}else if(t.groups&&t.groups.length>0&&this.linkedMode){this.linkedMode.enterLinkedMode({groups:t.groups,escapePosition:t.escapePosition})}else if(t.escapePosition){var i=this.editor.getTextView();i.setCaretOffset(t.escapePosition)}return true},deletePrevious:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getSelection();if(n.start!==n.end){return false}var r=e.getModel();var i=e.getCaretOffset();var s=i===0?"":r.getText(n.start-1,n.start);var o=i===r.getCharCount()?"":r.getText(n.start,n.start+1);if(s==="("&&o===")"||s==="["&&o==="]"||s==="{"&&o==="}"||s==="<"&&o===">"||s==='"'&&o==='"'||s==="'"&&o==="'"){e.setText("",n.start,n.start+1)}return false},_findEnclosingComment:function(e,t,n){var r="/*",i="*/";var s=e.getLineAtOffset(t);var o=e.getLineAtOffset(n);var u,a,f,l,c;var h,p;for(u=s;u>=0;u--){a=e.getLine(u);f=u===s?t-e.getLineStart(s):a.length;l=a.lastIndexOf(r,f);c=a.lastIndexOf(i,f);if(c>l){break}else if(l!==-1){h=e.getLineStart(u)+l;break}}for(u=o;u<e.getLineCount();u++){a=e.getLine(u);f=u===o?n-e.getLineStart(o):0;l=a.indexOf(r,f);c=a.indexOf(i,f);if(l!==-1&&l<c){break}else if(c!==-1){p=e.getLineStart(u)+c;break}}return{commentStart:h,commentEnd:p}},lineStart:function(){var e=this.editor;var t=e.getModel();var n=e.getCaretOffset();var r=t.getLineAtOffset(n);var i=t.getLineStart(r);var s=t.getLine(r);var o;for(o=0;o<s.length;o++){var u=s.charCodeAt(o);if(!(u===32||u===9)){break}}o+=i;if(n!==o){e.setSelection(o,o);return true}return false},removeBlockComment:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i="/*",s="*/";var o=n.getText(r.start,r.end);var u,a;var f;for(f=0;f<o.length;f++){if(o.substring(f,f+i.length)===i){u=r.start+f;break}}for(;f<o.length;f++){if(o.substring(f,f+s.length)===s){a=r.start+f;break}}if(u!==undefined&&a!==undefined){e.setText(n.getText(u+i.length,a),u,a+s.length);e.setSelection(u,a)}else{var l=this._findEnclosingComment(n,r.start,r.end);if(l.commentStart===undefined||l.commentEnd===undefined){return true}var c=n.getText(l.commentStart+i.length,l.commentEnd);e.setText(c,l.commentStart,l.commentEnd+s.length);e.setSelection(r.start-i.length,r.end-s.length)}return true},toggleLineComment:function(){var e=this.editor;var t=e.getTextView();if(t.getOptions("readonly")){return false}var n=e.getModel();var r=e.getSelection();var i=n.getLineAtOffset(r.start);var s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end);var o=true,u=[],a,f;for(var l=i;l<=s;l++){a=n.getLine(l,true);u.push(a);if(!o||(f=a.indexOf("//"))===-1){o=false}else{if(f!==0){var c;for(c=0;c<f;c++){var h=a.charCodeAt(c);if(!(h===32||h===9)){break}}o=c===f}}}var p,d,v;var m=n.getLineStart(i);var g=n.getLineEnd(s,true);if(o){for(var y=0;y<u.length;y++){a=u[y];f=a.indexOf("//");u[y]=a.substring(0,f)+a.substring(f+2)}p=u.join("");var b=n.getLineStart(s);d=m===r.start?r.start:r.start-2;v=r.end-2*(s-i+1)+(r.end===b+1?2:0)}else{u.splice(0,0,"");p=u.join("//");d=m===r.start?r.start:r.start+2;v=r.end+2*(s-i+1)}e.setText(p,m,g);e.setSelection(d,v);return true},trimTrailingWhitespaces:function(){var e=this.editor;var t=e.getModel();var n=e.getSelection();e.getTextView().setRedraw(false);e.getUndoStack().startCompoundChange();var r=/(\s+$)/;var i=t.getLineCount();for(var s=0;s<i;s++){var o=t.getLine(s);var u=r.exec(o);if(u){var a=t.getLineStart(s);var f=u[0].length;var l=a+u.index;t.setText("",l,l+f);if(n.start>l){n.start=Math.max(l,n.start-f)}if(n.start!==n.end&&n.end>l){n.end=Math.max(l,n.end-f)}}}e.getUndoStack().endCompoundChange();e.getTextView().setRedraw(true);e.setSelection(n.start,n.end,false)},startUndo:function(){if(this.undoStack){this.undoStack.startCompoundChange()}},skipClosingBracket:function(e){var t=this.editor;var n=t.getTextView();if(n.getOptions("readonly")){return false}var r=t.getSelection();var i=t.getModel();var s=t.getCaretOffset();var o=s===i.getCharCount()?"":i.getText(r.start,r.start+1);if(o===e){t.setCaretOffset(r.start+1);return true}return false},endUndo:function(){if(this.undoStack){this.undoStack.endCompoundChange()}},setAutoPairParentheses:function(e){this.autoPairParentheses=e},setAutoPairBraces:function(e){this.autoPairBraces=e},setAutoPairSquareBrackets:function(e){this.autoPairSquareBrackets=e},setAutoPairAngleBrackets:function(e){this.autoPairAngleBrackets=e},setAutoPairQuotations:function(e){this.autoPairQuotation=e},setAutoCompleteComments:function(e){this.autoCompleteComments=e},setSmartIndentation:function(e){this.smartIndentation=e}};u.SourceCodeActions=f;if(!String.prototype.trimLeft){String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")}}if(!String.prototype.trimRight){String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")}}return u});define("orion/editor/undoStack",[],function(){function e(e,t,n,r,i){this.model=e;this.offset=t;this.text=n;this.previousText=r;this.type=i}function t(e){this.owner=e;this.changes=[]}function n(e,t){this.size=t!==undefined?t:100;this.reset();var n=this;this._listener={onChanging:function(e){n._onChanging(e)},onDestroy:function(e){n._onDestroy(e)}};if(e.getModel){var r=e.getModel();if(r.getBaseModel){r=r.getBaseModel()}this.model=r;this.setView(e)}else{this.shared=true;this.model=e}this.model.addEventListener("Changing",this._listener.onChanging)}e.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(e,t){this._doUndoRedo(this.offset,this.previousText,this.text,e,t);return true},redo:function(e,t){this._doUndoRedo(this.offset,this.text,this.previousText,e,t);return true},merge:function(e,t,n,r,i){if(r===this.type){if(r===1&&e===this.offset+this.text.length){this.text+=t;return true}else if(r===-1&&i===this.offset){this.offset=e;this.previousText=n+this.previousText;return true}else if(r===-1&&e===this.offset){this.previousText=this.previousText+n;return true}}return false},_doUndoRedo:function(e,t,n,r,i){this.model.setText(t,e,e+n.length);if(i&&r){var s=r.getModel();if(s!==this.model){e=s.mapOffset(e,true)}r.setSelection(e,e+t.length)}}};t.prototype={getRedoChanges:function(){var e=[];for(var t=0;t<this.changes.length;t++){e=e.concat(this.changes[t].getRedoChanges())}return e},getUndoChanges:function(){var e=[];for(var t=this.changes.length-1;t>=0;t--){e=e.concat(this.changes[t].getUndoChanges())}return e},add:function(e){this.changes.push(e)},end:function(e){if(e){this.endSelection=e.getSelection();this.endCaret=e.getCaretOffset()}var t=this.owner;if(t&&t.end){t.end()}},undo:function(e,t){if(this.changes.length>1&&e){e.setRedraw(false)}for(var n=this.changes.length-1;n>=0;n--){this.changes[n].undo(e,false)}if(this.changes.length>1&&e){e.setRedraw(true)}if(t&&e){var r=this.startSelection.start;var i=this.startSelection.end;e.setSelection(this.startCaret?r:i,this.startCaret?i:r)}var s=this.owner;if(s&&s.undo){s.undo()}return this.changes.length>0},redo:function(e,t){if(this.changes.length>1&&e){e.setRedraw(false)}for(var n=0;n<this.changes.length;n++){this.changes[n].redo(e,false)}if(this.changes.length>1,e){e.setRedraw(true)}if(t&&e){var r=this.endSelection.start;var i=this.endSelection.end;e.setSelection(this.endCaret?r:i,this.endCaret?i:r)}var s=this.owner;if(s&&s.redo){s.redo()}return this.changes.length>0},merge:function(e,t,n,r,i){var s=this.changes.length;if(s>0){return this.changes[s-1].merge(e,t,n,r,i)}return false},start:function(e){if(e){this.startSelection=e.getSelection();this.startCaret=e.getCaretOffset()}var t=this.owner;if(t&&t.start){t.start()}}};n.prototype={destroy:function(){this._onDestroy()},add:function(e){if(this.compoundChange){this.compoundChange.add(e)}else{var t=this.stack.length;this.stack.splice(this.index,t-this.index,e);this.index++;if(this.stack.length>this.size){this.stack.shift();this.index--}}},markClean:function(){this._commitUndo();this.cleanChange=this.stack[this.index-1];if(this.cleanChange){this.cleanChange.type=2}},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return this.index>0},canRedo:function(){return this.stack.length-this.index>0},endCompoundChange:function(){if(this.compoundChange){this.compoundChange.end(this.view)}this.compoundChange=undefined},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();var e=[];for(var t=this.index;t<this.stack.length;t++){e=e.concat(this.stack[t].getRedoChanges())}return e},getUndoChanges:function(){this._commitUndo();var e=[];for(var t=this.index;t>=0;t--){e=e.concat(this.stack[t].getUndoChanges())}return e},undo:function(){this._commitUndo();var e,t=false;this._ignoreUndo=true;do{if(this.index<=0){break}e=this.stack[--this.index]}while(!(t=e.undo(this.view,true)));this._ignoreUndo=false;return t},redo:function(){this._commitUndo();var e,t=false;this._ignoreUndo=true;do{if(this.index>=this.stack.length){break}e=this.stack[this.index++]}while(!(t=e.redo(this.view,true)));this._ignoreUndo=false;return true},reset:function(){this.index=0;this.cleanChange=undefined;this.stack=[];this._ignoreUndo=false;this._compoundChange=undefined},setView:function(e){if(this.view===e){return}if(this.view){e.removeEventListener("Destroy",this._listener.onDestroy)}this.view=e;if(this.view){e.addEventListener("Destroy",this._listener.onDestroy)}},startCompoundChange:function(e){this._commitUndo();var n=new t(e);this.add(n);this.compoundChange=n;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(e){if(!e||!this.shared){this.model.removeEventListener("Changing",this._listener.onChanging)}if(this.view){this.view.removeEventListener("Destroy",this._listener.onDestroy);this.view=null}},_onChanging:function(t){if(this._ignoreUndo){return}var n=t.text;var r=t.start;var i=t.addedCharCount;var s=t.removedCharCount;var o=r+s;var u=0;if(i===0&&s===1){u=-1}else if(i===1&&s===0){u=1}var a=this.stack.length;var f=this.model.getText(r,o);if(a>0&&this.index===a){var l=this.stack[a-1];if(l.merge(r,n,f,u,o)){return}}this.add(new e(this.model,r,n,f,u))}};return{UndoStack:n}});define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(e,t,n,r){function i(e,t,n,r){this._location=t||"left";this._overview=n||"page";this._rulerStyle=r;this._view=null;var i=this;this._listener={onTextModelChanged:function(e){i._onTextModelChanged(e)},onAnnotationModelChanged:function(e){i._onAnnotationModelChanged(e)}};this.setAnnotationModel(e)}function s(e,t,n,r,s){i.call(this,e,t,"page",n);this._oddStyle=r||{style:{backgroundColor:"white"}};this._evenStyle=s||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function o(e,t,n){i.call(this,e,t,"page",n)}function u(e,t,n){i.call(this,e,t,"document",n)}function a(e,t,n){o.call(this,e,t,n)}i.prototype={getAnnotations:function(e,t){var n=this._annotationModel;if(!n){return[]}var r=this._view.getModel();var i=r.getLineStart(e);var s=r.getLineEnd(t-1);var o=r;if(r.getBaseModel){o=r.getBaseModel();i=r.mapOffset(i);s=r.mapOffset(s)}var u=[];var a=this.getAnnotationsByType(n,i,s);for(var f=0;f<a.length;f++){var l=a[f];var c=o.getLineAtOffset(l.start);var h=o.getLineAtOffset(Math.max(l.start,l.end-1));for(var p=c;p<=h;p++){var d=p;if(r!==o){var v=o.getLineStart(p);v=r.mapOffset(v,true);if(v===-1){continue}d=r.getLineAtOffset(v)}if(!(e<=d&&d<t)){continue}var m=this._mergeAnnotation(u[d],l,p-c,h-c+1);if(m){u[d]=m}}}if(!this._multiAnnotation&&this._multiAnnotationOverlay){for(var g in u){if(u[g]._multiple){u[g].html=u[g].html+this._multiAnnotationOverlay.html}}}return u},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){if(this._annotationModel){this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged)}this._annotationModel=e;if(this._annotationModel){this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)}},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=e},setView:function(e){if(this._onTextModelChanged&&this._view){this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged)}this._view=e;if(this._onTextModelChanged&&this._view){this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}},onClick:function(e,t){if(e===undefined){return}var r=this._view;var i=r.getModel();var s=i;var o=i.getLineStart(e),u=o;var a=o;var f=this._annotationModel;if(f){var l=r.getSelection();a=i.getLineEnd(e,true);if(o<=l.start&&l.start<a){o=l.start}if(i.getBaseModel){o=i.mapOffset(o);a=i.mapOffset(a);s=i.getBaseModel()}var c,h=f.getAnnotations(o,a);var p=null;while(!c&&h.hasNext()){var d=h.next();if(!this.isAnnotationTypeVisible(d.type)){continue}p=d;if(d.start<=o){continue}c=d}if(p&&p.groupId!==undefined){if(this._currentClickGroup===p.groupId){this._currentClickGroup=null}else{this._currentClickGroup=p.groupId}this._setCurrentGroup(e)}if(c&&s.getLineAtOffset(c.start)===s.getLineAtOffset(o)){o=c.start;a=c.end}else{a=o=u}if(i.getBaseModel){o=i.mapOffset(o,true);a=i.mapOffset(a,true)}}var v=n.Tooltip.getTooltip(this._view);if(v){v.setTarget(null)}this._view.setSelection(a,o,1/3,function(){})},onDblClick:function(e,t){},onMouseMove:function(e,t){var r=n.Tooltip.getTooltip(this._view);if(!r){return}if(r.isVisible()&&this._tooltipLineIndex===e){return}this._tooltipLineIndex=e;var i=this;r.setTarget({y:t.clientY,getTooltipInfo:function(){return i._getTooltipInfo(i._tooltipLineIndex,this.y)}})},onMouseOver:function(e,t){this.onMouseMove(e,t);if(!this._currentClickGroup){this._setCurrentGroup(e)}},onMouseOut:function(e,t){if(!this._currentClickGroup){this._setCurrentGroup(-1)}var r=n.Tooltip.getTooltip(this._view);if(!r){return}r.setTarget(null)},_getTooltipInfo:function(e,t){if(e===undefined){return}var n=this._view;var r=n.getModel();var i=this._annotationModel;var s=[];if(i){var o=r.getLineStart(e);var u=r.getLineEnd(e);if(r.getBaseModel){o=r.mapOffset(o);u=r.mapOffset(u)}s=this.getAnnotationsByType(i,o,u)}var a=this._getTooltipContents(e,s);if(!a){return null}var f={contents:a,anchor:this.getLocation()};var l=n.getClientArea();if(this.getOverview()==="document"){l.y=n.convert({y:t},"view","document").y}else{l.y=n.getLocationAtOffset(r.getLineStart(e)).y}n.convert(l,"document","page");f.x=l.x;f.y=l.y;if(f.anchor==="right"){f.x+=l.width}return f},_getTooltipContents:function(e,t){return t},_onAnnotationModelChanged:function(e){function u(e){for(var i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type)){continue}var s=e[i].start;var o=e[i].end;if(n.getBaseModel){s=n.mapOffset(s,true);o=n.mapOffset(o,true)}if(s!==-1&&o!==-1){t.redrawLines(n.getLineAtOffset(s),n.getLineAtOffset(Math.max(s,o-1))+1,r)}}}var t=this._view;if(!t){return}var n=t.getModel(),r=this;var i=n.getLineCount();if(e.textModelChangedEvent){var s=e.textModelChangedEvent.start;if(n.getBaseModel){s=n.mapOffset(s,true)}var o=n.getLineAtOffset(s);t.redrawLines(o,i,r);return}u(e.added);u(e.removed);u(e.changed)},_mergeAnnotation:function(e,t,n,r){if(!e){e={}}if(n===0){if(e.html&&t.html){if(t.html!==e.html){if(!e._multiple&&this._multiAnnotation){e.html=this._multiAnnotation.html}}e._multiple=true}else{e.html=t.html}}e.style=this._mergeStyle(e.style,t.style);return e},_mergeStyle:function(e,t){if(t){if(!e){e={}}if(e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass){e.styleClass+=" "+t.styleClass}else{e.styleClass=t.styleClass}var n;if(t.style){if(!e.style){e.style={}}for(n in t.style){if(e.style[n]===undefined){e.style[n]=t.style[n]}}}if(t.attributes){if(!e.attributes){e.attributes={}}for(n in t.attributes){if(e.attributes[n]===undefined){e.attributes[n]=t.attributes[n]}}}}return e},_setCurrentGroup:function(e){var t=this._annotationModel;var n=null;var r=t.getTextModel();var i;var s;var o=this._currentGroupAnnotation;if(e!==-1){var u=r.getLineStart(e);var a=r.getLineEnd(e);if(r.getBaseModel){u=r.mapOffset(u);a=r.mapOffset(a)}s=t.getAnnotations(u,a);while(s.hasNext()){i=s.next();if(!this.isAnnotationTypeVisible(i.type)){continue}if(i.start<=u&&i.end>=a){if(i.groupId!==undefined){n=i;break}}}if(o&&n){if(o.groupId===n.groupId){return}}}this._currentGroupAnnotation=null;if(o){t.removeAnnotations(o.groupType)}if(!n){return}if(e===-1){return}this._currentGroupAnnotation=n;s=t.getAnnotations(0,r.getCharCount());var f=[];while(s.hasNext()){i=s.next();delete i.groupAnnotation;if(i.groupId===n.groupId){i=i.createGroupAnnotation();f.push(i)}}t.replaceAnnotations(null,f)}};t.AnnotationTypeList.addMixin(i.prototype);s.prototype=new i;s.prototype.getAnnotations=function(e,t){var n=i.prototype.getAnnotations.call(this,e,t);var r=this._view.getModel();for(var s=e;s<t;s++){var o=s&1?this._oddStyle:this._evenStyle;var u=s;if(r.getBaseModel){var a=r.getLineStart(u);u=r.getBaseModel().getLineAtOffset(r.mapOffset(a))}if(!n[s]){n[s]={}}n[s].html=this._firstLine+u+"";if(!n[s].style){n[s].style=o}}return n};s.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]};s.prototype.setFirstLine=function(e){this._firstLine=e!==undefined?e:1};s.prototype._onTextModelChanged=function(e){var t=e.start;var n=this._view.getModel();var r=n.getBaseModel?n.getBaseModel().getLineCount():n.getLineCount();var i=(this._firstLine+r-1+"").length;if(this._numOfDigits!==i){this._numOfDigits=i;var s=n.getLineAtOffset(t);this._view.redrawLines(s,n.getLineCount(),this)}};o.prototype=new i;u.prototype=new i;u.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};e=this._mergeStyle(e,this._rulerStyle);return e};u.prototype._getTooltipContents=function(t,n){if(n.length===0){var s=this._view.getModel();var o=t;if(s.getBaseModel){var u=s.getLineStart(o);o=s.getBaseModel().getLineAtOffset(s.mapOffset(u))}return r.formatMessage(e.line,o+1)}return i.prototype._getTooltipContents.call(this,t,n)};u.prototype._mergeAnnotation=function(e,t,n,r){if(n!==0){return undefined}var i=e;if(!i){var s=3*r;i={html:"&nbsp;",style:{style:{height:s+"px"}}};i.style=this._mergeStyle(i.style,t.overviewStyle)}return i};a.prototype=new o;a.prototype.onClick=function(e,t){if(e===undefined){return}var r=this._annotationModel;if(!r){return}var i=this._view;var s=i.getModel();var o=s.getLineStart(e);var u=s.getLineEnd(e,true);if(s.getBaseModel){o=s.mapOffset(o);u=s.mapOffset(u);s=s.getBaseModel()}var a,f=r.getAnnotations(o,u);while(!a&&f.hasNext()){var l=f.next();if(!this.isAnnotationTypeVisible(l.type)){continue}a=l}if(a&&s.getLineAtOffset(a.start)===s.getLineAtOffset(o)){var c=n.Tooltip.getTooltip(this._view);if(c){c.setTarget(null)}if(a.expanded){a.collapse()}else{a.expand()}}};a.prototype._getTooltipContents=function(e,t){if(t.length===1){if(t[0].expanded){return null}}return o.prototype._getTooltipContents.call(this,e,t)};a.prototype._onAnnotationModelChanged=function(e){function a(e){for(i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type)){continue}var t=e[i].start;if(n.getBaseModel){t=n.mapOffset(t,true)}if(t!==-1){u=Math.min(u,n.getLineAtOffset(t))}}}if(e.textModelChangedEvent){o.prototype._onAnnotationModelChanged.call(this,e);return}var t=this._view;if(!t){return}var n=t.getModel(),r=this,i;var s=n.getLineCount(),u=s;a(e.added);a(e.removed);a(e.changed);var f=t.getRulers();for(i=0;i<f.length;i++){t.redrawLines(u,s,f[i])}};return{Ruler:i,AnnotationRuler:o,LineNumberRuler:s,OverviewRuler:u,FoldingRuler:a}});define("orion/editor/textDND",["orion/util"],function(e){function t(e,t){this._view=e;this._undoStack=t;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var n=this;this._listener={onDragStart:function(e){n._onDragStart(e)},onDragEnd:function(e){n._onDragEnd(e)},onDragEnter:function(e){n._onDragEnter(e)},onDragOver:function(e){n._onDragOver(e)},onDrop:function(e){n._onDrop(e)},onDestroy:function(e){n._onDestroy(e)}};e.addEventListener("DragStart",this._listener.onDragStart);e.addEventListener("DragEnd",this._listener.onDragEnd);e.addEventListener("DragEnter",this._listener.onDragEnter);e.addEventListener("DragOver",this._listener.onDragOver);e.addEventListener("Drop",this._listener.onDrop);e.addEventListener("Destroy",this._listener.onDestroy)}t.prototype={destroy:function(){var e=this._view;if(!e){return}e.removeEventListener("DragStart",this._listener.onDragStart);e.removeEventListener("DragEnd",this._listener.onDragEnd);e.removeEventListener("DragEnter",this._listener.onDragEnter);e.removeEventListener("DragOver",this._listener.onDragOver);e.removeEventListener("Drop",this._listener.onDrop);e.removeEventListener("Destroy",this._listener.onDestroy);this._view=null},_onDestroy:function(e){this.destroy()},_onDragStart:function(e){var t=this._view;var n=t.getSelection();var r=t.getModel();if(r.getBaseModel){n.start=r.mapOffset(n.start);n.end=r.mapOffset(n.end);r=r.getBaseModel()}var i=r.getText(n.start,n.end);if(i){this._dragSelection=n;e.event.dataTransfer.effectAllowed="copyMove";e.event.dataTransfer.setData("Text",i)}},_onDragEnd:function(t){if(this._dragSelection){var n=this._view;var r=t.event.dataTransfer.dropEffect;if(!e.isFirefox){if(r!=="none"||this._dropText){r=t.event.dataTransfer.dropEffect=this._dropEffect}}if(this._undoStack){this._undoStack.startCompoundChange()}var i=r==="move";if(i){n.setText("",this._dragSelection.start,this._dragSelection.end)}if(this._dropText){var s=this._dropText;var o=this._dropOffset;if(i){if(o>=this._dragSelection.end){o-=this._dragSelection.end-this._dragSelection.start}else if(o>=this._dragSelection.start){o=this._dragSelection.start}}n.setText(s,o,o);n.setSelection(o,o+s.length);this._dropText=null;this._dropOffset=-1}if(this._undoStack){this._undoStack.endCompoundChange()}}this._dragSelection=null},_onDragEnter:function(e){this._onDragOver(e)},_onDragOver:function(t){var n=t.event.dataTransfer.types;var r=!this._view.getOptions("readonly");if(r){if(n){r=n.contains?n.contains("text/plain")||n.contains("Text"):n.indexOf("text/plain")!==-1||n.indexOf("Text")!==-1}}if(!r){t.event.dataTransfer.dropEffect="none"}else{if(!e.isFirefox){var i=e.isMac?t.event.altKey:t.event.ctrlKey;this._dropEffect=t.event.dataTransfer.dropEffect=i?"copy":"move"}}},_onDrop:function(t){var n=this._view;var r=t.event.dataTransfer.getData("Text");if(r){if(!e.isFirefox){t.event.dataTransfer.dropEffect=this._dropEffect}var i=n.getOffsetAtLocation(t.x,t.y);if(this._dragSelection){this._dropOffset=i;this._dropText=r}else{n.setText(r,i,i);n.setSelection(i,i+r.length)}}}};return{TextDND:t}});define("orion/editor/templates",[],function(){function e(e,t){return t.substring(e.length)}function i(e,t,n,r){this.prefix=e;this.description=t;this.template=n;this.name=r;this._parse()}function s(e,t){this._keywords=e||[];this._templates=[];this.addTemplates(t||[])}var t="${tab}";var n="${delimiter}";var r="${cursor}";i.prototype={getProposal:function(e,i,s){var o=i-e.length;var u={};var a;var f=s.delimiter!==undefined?s.delimiter:"\n";if(s.indentation){f+=s.indentation}var l=s.tab!==undefined?s.tab:"	";var c=0;var h=this.variables;var p=this.segments,d=[];for(var v=0;v<p.length;v++){var m=p[v];var g=h[m];if(g!==undefined){switch(m){case t:m=l;break;case n:m=f;break;case r:m="";a=c;break;default:var y=u[m];if(!y){y=u[m]={data:g.data,positions:[]}}m=g.substitution;if(y.data&&y.data.values){m=y.data.values[0]}y.positions.push({offset:o+c,length:m.length})}}d.push(m);c+=m.length}var b=[];for(var w in u){if(u.hasOwnProperty(w)){b.push(u[w])}}d=d.join("");if(a===undefined){a=d.length}return{proposal:d,name:this.name,description:this.description,groups:b,escapePosition:o+a,style:"noemphasis"}},match:function(e){return this.prefix.indexOf(e)===0},_parse:function(){var e=this.template;var r=[],i={},s,o=0;e=e.replace(/\n/g,n);e=e.replace(/\t/g,t);e.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(t,n,u){var a=t.substring(2,t.length-1);var f=t,l=a,c=null;var h=l.indexOf(":");if(h!==-1){l=l.substring(0,h);f="${"+l+"}";c=JSON.parse(a.substring(h+1).replace("\\}","}").trim())}var p=i[f];if(!p){p=i[f]={}}p.substitution=l;if(c){p.data=c}s=e.substring(o,u);if(s){r.push(s)}r.push(f);o=u+t.length;return l});s=e.substring(o,e.length);if(s){r.push(s)}this.segments=r;this.variables=i}};s.prototype={addTemplates:function(e){var t=this.getTemplates();for(var n=0;n<e.length;n++){t.push(new i(e[n].prefix,e[n].description,e[n].template,e[n].name))}},computeProposals:function(e,t,n){var r=this.getPrefix(e,t,n);var i=[];if(this.isValid(r,e,t,n)){i=i.concat(this.getTemplateProposals(r,t,n));i=i.concat(this.getKeywordProposals(r))}return i},getKeywords:function(){return this._keywords},getKeywordProposals:function(t){var n=[];var r=this.getKeywords();if(r){for(var i=0;i<r.length;i++){if(r[i].indexOf(t)===0){n.push({proposal:e(t,r[i]),description:r[i],style:"noemphasis_keyword"})}}if(0<n.length){n.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:true})}}return n},getPrefix:function(e,t,n){return n.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(e,t,n){var r=[];var i=this.getTemplates();for(var s=0;s<i.length;s++){var o=i[s];if(o.match(e)){var u=o.getProposal(e,t,n);this.removePrefix(e,u);r.push(u)}}if(0<r.length){r.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:true})}return r},removePrefix:function(t,n){var r=n.overwrite=n.proposal.substring(0,t.length)!==t;if(!r){n.proposal=e(t,n.proposal)}},isValid:function(e,t,n,r){return true}};return{Template:i,TemplateContentAssist:s}});define("orion/editor/linkedMode",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/editor/templates","orion/objects","orion/util"],function(e,t,n,r,i,s){function u(e,t,r){var i=e.getTextView();n.KeyMode.call(this,i);this.editor=e;this.undoStack=t;this.contentAssist=r;this.linkedModeModel=null;i.setAction("linkedModeEnter",function(){this.exitLinkedMode(true);return true}.bind(this));i.setAction("linkedModeCancel",function(){this.exitLinkedMode(false);return true}.bind(this));i.setAction("linkedModeNextGroup",function(){var e=this.linkedModeModel;this.selectLinkedGroup((e.selectedGroupIndex+1)%e.groups.length);return true}.bind(this));i.setAction("linkedModePreviousGroup",function(){var e=this.linkedModeModel;this.selectLinkedGroup(e.selectedGroupIndex>0?e.selectedGroupIndex-1:e.groups.length-1);return true}.bind(this));this.linkedModeListener={onActivating:function(e){if(this._groupContentAssistProvider){this.contentAssist.setProviders([this._groupContentAssistProvider]);this.contentAssist.setProgress(null)}}.bind(this),onModelChanged:function(e){if(this.ignoreVerify){return}var t=this.editor.mapOffset(e.start);var n=this.linkedModeModel,r,i;while(n){r=this._getPositionChanged(n,t,t+e.removedCharCount);i=r.position;if(i===undefined||i.model!==n){this.exitLinkedMode(false);n=this.linkedModeModel}else{break}}if(!n){return}var s=0;var o=e.addedCharCount-e.removedCharCount;var u=r.positions,a,f;for(var l=0;l<u.length;++l){f=u[l];a=f.position;var c=a.offset<=t&&t<=a.offset+a.length;if(c&&!f.ansestor){a.offset+=s;a.length+=o;s+=o}else{a.offset+=s;if(f.ansestor&&c){a.length+=o}}if(f.escape){f.model.escapePosition=a.offset}}this._updateAnnotations(u)}.bind(this),onVerify:function(e){if(this.ignoreVerify){return}var t=this.editor;var n=t.mapOffset(e.start);var r=this.editor.mapOffset(e.end);var i=this.linkedModeModel,s,o;while(i){s=this._getPositionChanged(i,n,r);o=s.position;if(o===undefined||o.model!==i){this.exitLinkedMode(false);i=this.linkedModeModel}else{break}}if(!i){return}var u=this._compoundChange;if(u){if(!(u.owner.model===i&&u.owner.group===o.group)){this.endUndo();this.startUndo()}}else{this.startUndo()}i.selectedGroupIndex=o.group;var a=0;var f=e.text.length-(r-n);var l=s.positions,c,h;var p=n-o.position.offset,d=r-o.position.offset;for(var v=0;v<l.length;++v){h=l[v];c=h.position;h.oldOffset=c.offset;if(h.model===i&&h.group===o.group){c.offset+=a;c.length+=f;a+=f}else{c.offset+=a;if(h.ansestor){c.length+=o.count*f}}if(h.escape){h.model.escapePosition=c.offset}}this.ignoreVerify=true;for(v=l.length-1;v>=0;v--){h=l[v];if(h.model===i&&h.group===o.group){t.setText(e.text,h.oldOffset+p,h.oldOffset+d)}}this.ignoreVerify=false;e.text=null;this._updateAnnotations(l)}.bind(this)}}var o={};u.prototype=new n.KeyMode;s.mixin(u.prototype,{createKeyBindings:function(){var e=t.KeyBinding;var n=[];n.push({actionID:"linkedModeEnter",keyBinding:new e(13)});n.push({actionID:"linkedModeCancel",keyBinding:new e(27)});n.push({actionID:"linkedModeNextGroup",keyBinding:new e(9)});n.push({actionID:"linkedModePreviousGroup",keyBinding:new e(9,false,true)});return n},enterLinkedMode:function(t){if(!this.linkedModeModel){var n=this.editor.getTextView();n.addKeyMode(this);n.addEventListener("Verify",this.linkedModeListener.onVerify);n.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var r=this.contentAssist;r.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(e.linkedModeEntered,null,true)}this._sortedPositions=null;if(this.linkedModeModel){t.previousModel=this.linkedModeModel;t.parentGroup=this.linkedModeModel.selectedGroupIndex;this.linkedModeModel.nextModel=t}this.linkedModeModel=t;this.selectLinkedGroup(0)},exitLinkedMode:function(t){if(!this.isActive()){return}if(this._compoundChange){this.endUndo();this._compoundChange=null}this._sortedPositions=null;var n=this.linkedModeModel;this.linkedModeModel=n.previousModel;n.parentGroup=n.previousModel=undefined;if(this.linkedModeModel){this.linkedModeModel.nextModel=undefined}if(!this.linkedModeModel){var r=this.editor;var i=r.getTextView();i.removeKeyMode(this);i.removeEventListener("Verify",this.linkedModeListener.onVerify);i.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var s=this.contentAssist;s.removeEventListener("Activating",this.linkedModeListener.onActivating);s.offset=undefined;this.editor.reportStatus(e.linkedModeExited,null,true);if(t){r.setCaretOffset(n.escapePosition,false)}}this.selectLinkedGroup(0)},startUndo:function(){if(this.undoStack){var e=this;var t=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:t,group:t.selectedGroupIndex,end:function(){e._compoundChange=null}})}},endUndo:function(){if(this.undoStack){this.undoStack.endCompoundChange()}},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var t=this.linkedModeModel;if(t){t.selectedGroupIndex=e;var n=t.groups[e];var r=n.positions[0];var s=this.editor;s.setSelection(r.offset,r.offset+r.length);var o=this.contentAssist;if(o){o.offset=undefined;if(n.data&&n.data.type==="link"&&n.data.values){var u=this._groupContentAssistProvider=new i.TemplateContentAssist(n.data.values);u.getPrefix=function(){var e=s.getSelection();if(e.start===e.end){var t=s.getCaretOffset();if(r.offset<=t&&t<=r.offset+r.length){return s.getText(r.offset,t)}}return""};o.offset=r.offset;o.deactivate();o.activate()}else if(this._groupContentAssistProvider){this._groupContentAssistProvider=null;o.deactivate()}}}this._updateAnnotations()},_getModelPositions:function(e,t,n){var r=t.groups;for(var i=0;i<r.length;i++){var s=r[i].positions;for(var o=0;o<s.length;o++){var u=s[o];if(n){u={offset:u.offset+n,length:u.length}}var a={index:o,group:i,count:s.length,model:t,position:u};e.push(a);if(t.nextModel&&t.nextModel.parentGroup===i){a.ansestor=true;this._getModelPositions(e,t.nextModel,(n||0)+s[o].offset-s[0].offset)}}}},_getSortedPositions:function(e){var t=this._sortedPositions;if(!t){t=[];while(e.previousModel){e=e.previousModel}this._getModelPositions(t,e);while(e){if(e.escapePosition!==undefined){t.push({escape:true,model:e,position:{offset:e.escapePosition,length:0}})}e=e.nextModel}t.sort(function(e,t){return e.position.offset-t.position.offset});this._sortedPositions=t}return t},_getPositionChanged:function(e,t,n){var r;var i=this._getSortedPositions(e);for(var s=i.length-1;s>=0;s--){var o=i[s].position;if(o.offset<=t&&n<=o.offset+o.length){r=i[s];break}}return{position:r,positions:i}},_updateAnnotations:function(e){var t=this.editor.getAnnotationModel();if(!t){return}var n=[],i=[];var s=t.getTextModel();var o=t.getAnnotations(0,s.getCharCount()),u;while(o.hasNext()){u=o.next();switch(u.type){case r.AnnotationType.ANNOTATION_LINKED_GROUP:case r.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case r.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:n.push(u)}}var a=this.linkedModeModel;if(a){e=e||this._getSortedPositions(a);for(var f=0;f<e.length;f++){var l=e[f];if(l.model!==a){continue}var c=r.AnnotationType.ANNOTATION_LINKED_GROUP;if(l.group===a.selectedGroupIndex){if(l.index===0){c=r.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP}else{c=r.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP}}l=l.position;u=r.AnnotationType.createAnnotation(c,l.offset,l.offset+l.length,"");i.push(u)}}t.replaceAnnotations(n,i)}});o.LinkedMode=u;return o});define("orion/editor/factories",["orion/editor/actions","orion/editor/undoStack","orion/editor/rulers","orion/editor/annotations","orion/editor/textDND","orion/editor/linkedMode"],function(e,t,n,r,i,s){function u(){}function a(){}function f(){}function l(){}function c(){}function h(){}var o={};u.prototype={createKeyBindings:function(t,n,r,i){var o=new e.TextActions(t,n,i);var u=new s.LinkedMode(t,n,r);var a=new e.SourceCodeActions(t,n,r,u);return{textActions:o,linkedMode:u,sourceCodeActions:a}}};o.KeyBindingsFactory=u;a.prototype={createUndoStack:function(e){var n=e.getTextView();return new t.UndoStack(n,200)}};o.UndoFactory=a;f.prototype={createLineNumberRuler:function(e){return new n.LineNumberRuler(e,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};o.LineNumberRulerFactory=f;l.prototype={createFoldingRuler:function(e){return new n.FoldingRuler(e,"left",{styleClass:"ruler folding"})}};o.FoldingRulerFactory=l;c.prototype={createAnnotationModel:function(e){return new r.AnnotationModel(e)},createAnnotationStyler:function(e,t){return new r.AnnotationStyler(e,t)},createAnnotationRulers:function(e){var t=new n.AnnotationRuler(e,"left",{styleClass:"ruler annotations"});var r=new n.OverviewRuler(e,"right",{styleClass:"ruler overview"});return{annotationRuler:t,overviewRuler:r}}};o.AnnotationFactory=c;h.prototype={createTextDND:function(e,t){return new i.TextDND(e.getTextView(),t)}};o.TextDNDFactory=h;return o});define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(e,t,n,r){return r.mixin({},e,t,n)});define("orion/editorPreferences",[],function(){function r(t,n){this._preferences=t;this._callback=n;if(n){var r=t.listenForChangedSettings(e,function(e){if(e.key===r){n()}}.bind(this))}}var e="/editor/settings";var t="editorSettings";var n={autoSave:false,autoSaveVisible:true,autoSaveLocalVisible:true,autoSaveTimeout:1e3,autoSaveTimeoutVisible:true,themeVisible:true,themeLocalVisible:true,fontSizeVisible:true,fontSizeLocalVisible:true,autoLoad:true,autoLoadVisible:true,saveDiffs:true,saveDiffsVisible:true,showBlame:false,showBlameVisible:true,contentAssistAutoTrigger:true,contentAssistAutoTriggerVisible:true,showOccurrences:false,showOccurrencesVisible:true,autoPairParentheses:true,autoPairParenthesesVisible:true,autoPairBraces:true,autoPairBracesVisible:true,autoPairSquareBrackets:true,autoPairSquareBracketsVisible:true,autoPairAngleBrackets:false,autoPairAngleBracketsVisible:true,autoPairQuotations:true,autoPairQuotationsVisible:true,autoCompleteComments:true,autoCompleteCommentsVisible:true,smartIndentation:true,smartIndentationVisible:true,trimTrailingWhiteSpace:false,trimTrailingWhiteSpaceVisible:true,tabSize:4,tabSizeVisible:true,expandTab:false,expandTabVisible:true,scrollAnimation:true,scrollAnimationVisible:true,scrollAnimationTimeout:300,scrollAnimationTimeoutVisible:true,annotationRuler:true,annotationRulerVisible:true,lineNumberRuler:true,lineNumberRulerVisible:true,foldingRuler:true,foldingRulerVisible:true,overviewRuler:true,overviewRulerVisible:true,showTabs:false,showTabsVisible:true,showSpaces:false,showSpacesVisible:true,wordWrap:false,wordWrapVisible:true,showMargin:false,showMarginVisible:true,marginOffset:80,marginOffsetVisible:true,keyBindings:"Default",keyBindingsVisible:true,keyBindingsLocalVisible:true};r.prototype={_initialize:function(e){var r=e.get(t)||{};for(var i in n){if(!r.hasOwnProperty(i)){r[i]=n[i]}}return r},getPrefs:function(t){this._preferences.getPreferences(e).then(function(e){var n=this._initialize(e);if(typeof n==="string"){n=JSON.parse(n)}t(n)}.bind(this))},setPrefs:function(n,r){this._preferences.getPreferences(e).then(function(e){e.put(t,n);n=this._initialize(e);if(r){r(n)}if(this._callback){this._callback(n)}}.bind(this))}};return{EditorPreferences:r}});define("orion/widgets/themes/ThemePreferences",[],function(){function e(e,t){this._preferences=e;this._themeData=t;var n=t.getThemeStorageInfo();var r=e.listenForChangedSettings(n.storage,2,function(e){if(e.key===r){this.apply()}}.bind(this))}e.prototype={_initialize:function(e,t,n){var r=n.get(e.styleset);if(!r){r=t.getStyles();n.put(e.styleset,JSON.stringify(r))}var i=n.get("selected");if(i){i=JSON.parse(i)}if(!i||i[e.selectedKey]===undefined){i=i||{};i[e.selectedKey]=e.defaultTheme;n.put("selected",JSON.stringify(i))}},apply:function(){this.setTheme()},getTheme:function(e){var t=this._themeData;var n=t.getThemeStorageInfo();this._preferences.getPreferences(n.storage,2).then(function(r){this._initialize(n,t,r);var i=JSON.parse(r.get("selected"));var s=JSON.parse(r.get(n.styleset)),o;if(s){for(var u=0;u<s.length;u++){if(s[u].name===i[n.selectedKey]){o=s[u];break}}}e({style:o,styles:s})}.bind(this))},setTheme:function(e,t){var n=this._themeData;var r=n.getThemeStorageInfo();this._preferences.getPreferences(r.storage,2).then(function(i){this._initialize(r,n,i);var s=JSON.parse(i.get("selected"));if(!e){e=s[r.selectedKey]}s[r.selectedKey]=e;i.put("selected",JSON.stringify(s));if(t){i.put(r.styleset,JSON.stringify(t))}else{t=JSON.parse(i.get(r.styleset))}for(var o=0;o<t.length;o++){if(t[o].name===s[r.selectedKey]){n.processSettings(t[o]);break}}}.bind(this))},setFontSize:function(e){var t=this._themeData;var n=t.getThemeStorageInfo();this._preferences.getPreferences(n.storage,2).then(function(r){this._initialize(n,t,r);var i=JSON.parse(r.get("selected"));var s=JSON.parse(r.get(n.styleset)),o;if(s){for(var u=0;u<s.length;u++){s[u].fontSize=e;if(s[u].name===i[n.selectedKey]){o=s[u]}}}r.put(n.styleset,JSON.stringify(s));t.processSettings(o)}.bind(this))}};return{ThemePreferences:e}});define("orion/settings/nls/root/messages",{"Plugin Description":"Plugin Description",Create:"Create","Loading...":"Loading...","Label:":"Label:",Title:"Title",Plugins:"Plugins","User Profile":"User Profile","Git Settings":"Git Settings",General:"General",Navigation:"Navigation",Links:"Links","Open in same tab":"Open in same tab","Open in new tab":"Open in new tab",Font:"Font",Family:"Family","Sans Serif":"Sans Serif",Serif:"Serif",Size:"Size","8pt":"8pt","9pt":"9pt","10pt":"10pt","12pt":"12pt",Color:"Color",Background:"Background",Strings:"Strings","String Types":"String Types",blue:"blue",Weight:"Weight",Normal:"Normal",Bold:"Bold",Comments:"Comments","Comment Types":"Comment Types",green:"green",Keywords:"Keywords","Keyword Types":"Keyword Types",darkred:"darkred",Categories:"Categories",Username:"Username","Full Name":"Full Name","Email Address":"Email Address","Email Confirmed":"Email Confirmed",Account:"Account","Current Password":"Current Password","New Password":"New Password","Verify Password":"Verify Password",Password:"Password",OpenId:"OpenId",AOL:"AOL",Yahoo:"Yahoo",Google:"Google",Unlink:"Unlink",Link:"Link",Unlinked:"Unlinked",Linked:"Linked","Linked Accounts":"Linked Accounts","Git Email Address":"Git Email Address","Git Username":"Git Username","Git Credentials Storage":"Git Credentials Storage",Update:"Update","Update Profile Settings":"Update Profile Settings","Update Git User Settings":"Update Git User Settings","Update Git Credentials":"Update Git Credentials","User profile data successfully updated.":"User profile data successfully updated.","Git user data successfully updated.":"Git user data successfully updated.","Git Credentials successfully updated.":"Git Credentials successfully updated.","Edit Plugin JavaScript":"Edit Plugin JavaScript","Install Plugin":"Install Plugin","Plugin Name:":"Plugin Name:","Author Name:":"Author Name:","Licence:":"Licence:","Description:":"Description:","A plugin for Eclipse Orion":"A plugin for Eclipse Orion","Plugin Link":"Plugin Link",Install:"Install","Install a plugin by specifying its URL":"Install a plugin by specifying its URL","Plugin URL:":"Plugin URL:",Disable:"Disable",DisableTooltip:"Disable the plugin",Enable:"Enable",EnableTooltip:"Enable the plugin","Reload all":"Reload all","Reload all installed plugins":"Reload all installed plugins","Create a new Orion Plugin":"Create a new Orion Plugin","Find More Orion Plugins":"Find More Orion Plugins","Get Plugins":"Get Plugins",Reload:"Reload","Reload the plugin":"Reload the plugin",Delete:"Delete","Delete this plugin from the configuration":"Delete this plugin from the configuration","Type a plugin url here ...":"Type a plugin url here ...","Installed ":"Installed ","Installing ":"Installing ","Already installed":"Already installed"," plugin":" plugin","Reloaded ":"Reloaded ","Uninstalled ":"Uninstalled ","Are you sure you want to uninstall '":"Are you sure you want to uninstall '",Services:"Services",Value:"Value","JavaScript Object":"JavaScript Object","click here, then check javascript console to drill down":"click here, then check javascript console to drill down",Item:"Item","Git Config":"Git Config","Clear Git Credentials":"Clear Git Credentials","Enable Storage":"Enable Storage","Please be aware that your credentials will be stored persistently in the browser.":"Please be aware that your credentials will be stored persistently in the browser.","Do you wish to enable the Key Storage?":"Do you wish to enable the Key Storage?",general:"General",validation:"Validation","Deleted git credentials for ${0}":"Deleted git credentials for ${0}",Editor:"Editor",editorSettings:"Settings",EditorThemes:"Themes",Import:"Import","Import a theme":"Import a theme",Export:"Export","Export a theme":"Export a theme","Theme name:":"Theme name:",yourTheme:"yourTheme",fileManagement:"File Management",typing:"Typing",autoSave:"Auto Save",autoSaveTimeout:"Save interval (ms)",autoLoad:"Auto Load",saveDiffs:"Save file as diffs",trimTrailingWhiteSpace:"Trim Trailing Whitespace on Save",Restore:"Restore Defaults",Default:"Default",keys:"Keys",tabs:"Tabs",tabSize:"Tab Size",expandTab:"Insert spaces for tabs",smoothScrolling:"Smooth Scrolling",scrollAnimation:"Scrolling Animation",scrollAnimationTimeout:"Scrolling Duration (ms)",keyBindings:"Key Bindings",rulers:"Rulers",annotationRuler:"Show Annotation Ruler",lineNumberRuler:"Show Line Number Ruler",foldingRuler:"Show Folding Ruler",overviewRuler:"Show Overview Ruler",whitespaces:"White Spaces",wrapping:"Wrapping",wordWrap:"Word Wrap",showMargin:"Show Margin",marginOffset:"Margin Column",showTabs:"Show Tabs",showSpaces:"Show Spaces",autoSaveTimeoutInvalid:"Invalid save interval.",scrollAnimationTimeoutInvalid:"Invalid scrolling duration.",tabSizeInvalid:"Invalid tab size.",localSettingsTooltip:"Toggle whether this setting is shown in the local editor settings drop down.",editorSettingsInfo:"Use the ${0} and ${1} to toggle whether a given setting is shown in the local editor settings drop down ${2}.",autoPairParentheses:"Autopair (Parentheses)",autoPairBraces:"Autopair {Braces}",autoPairSquareBrackets:"Autopair [Square] Brackets",autoPairAngleBrackets:"Autopair <Angle> Brackets",autoPairQuotations:'Autopair "Strings"',autoCompleteComments:"Autocomplete /** Block Comments */",smartIndentation:"Smart Indentation",sourceControl:"Source Control",showBlame:"Show Blame",languageTools:"Language Tools",showOccurrences:"Show Occurrences",contentAssistAutoTrigger:"Automatically Trigger Content Assist","Editor preferences updated":"Editor preferences updated","Editor defaults restored":"Editor defaults restored",Theme:"Theme","Font Size":"Font Size","New Theme Name:":"New Theme Name:","Font Size:":"Font Size:","UI Theme":"UI Theme","Navigation Bar":"Navigation Bar","Navigation Text":"Navigation Text","Search Box":"Search Box","Tool Panel":"Tool Panel","Selection Bar":"Selection Bar",Location:"Location",Content:"Content","Main Panel":"Main Panel",Button:"Button","Button Text":"Button Text","Section Text":"Section Text","Side Panel":"Side Panel","Line Color":"Line Color","Line Numbers":"Line Numbers",Foreground:"Foreground","Current Line":"Current Line","HTML Attribute":"HTML Attribute","Overview Ruler":"Overview Ruler","HTML Tag":"HTML Tag","Annotation Ruler":"Annotation Ruler","Show Guide":"Show Guide","Check Guide":"Check Guide",Cancel:"Cancel","Revert Theme":"Revert Theme","Update Theme":"Update Theme","Theme:":"Theme:",clickDiagram:"Click diagram to style.",clickUpdate:"Click Update button to save preview.","CSS Class Name":"CSS Class Name","CSS Attribute":"CSS Attribute","CSS Value":"CSS Value","CSS Text":"CSS Text","COLOR:":"Color:","NEW COLOR:":"New Color:",Ok:"Ok","OR HEX:":"Or Hex: "});define("orion/settings/nls/messages",["orion/i18n!orion/settings/nls/messages","orion/settings/nls/root/messages"],function(e,t){var n={root:t};Object.keys(e).forEach(function(t){if(typeof n[t]==="undefined"){n[t]=e[t]}});return n});define("orion/widgets/themes/editor/ThemeData",["i18n!orion/settings/nls/messages","orion/editor/textTheme"],function(e,t){function n(){}function r(e,t){var n="Result:";var r=e*t;return n+r}function o(){this.styles=[];var e=new n;e.name="Eclipse";e.annotationRuler="white";e.background="white";e.comment="green";e.keyword="#7f0055";e.text="darkSlateGray";e.string="blue";e.overviewRuler="white";e.lineNumberOdd="#444";e.lineNumberEven="#444";e.lineNumber="#444";e.currentLine="#EAF2FE";e.tag="darkorange";e.attribute="cadetBlue";e.fontFamily=i;e.fontSize=s;this.styles.push(e);var t=new n;t.name="Prospecto";t.annotationRuler="white";t.background="white";t.comment="#3C802C";t.keyword="#CC4C07";t.text="#333";t.string="#446FBD";t.overviewRuler="white";t.lineNumberOdd="silver";t.lineNumberEven="silver";t.lineNumber="silver";t.currentLine="#EAF2FE";t.tag="#CC4C07";t.attribute="cadetBlue";t.fontFamily=i;t.fontSize=s;this.styles.push(t);var r=new n;r.name="Blue";r.annotationRuler="lavender";r.background="aliceBlue";r.comment="indigo";r.keyword="cornFlowerBlue";r.text="navy";r.string="cornFlowerBlue";r.overviewRuler="lavender";r.lineNumberOdd="darkSlateGray";r.lineNumberEven="darkSlateGray";r.lineNumber="darkSlateGray";r.currentLine="white";r.tag="cornFlowerBlue";r.attribute="cadetBlue";r.fontFamily=i;r.fontSize=s;this.styles.push(r);var o=new n;o.name="Ambience";o.annotationRuler="#3D3D3D";o.background="#202020";o.comment="mediumslateblue";o.keyword="cornFlowerBlue";o.text="darkseagreen";o.string="lightcoral";o.overviewRuler="white";o.lineNumberOdd="black";o.lineNumberEven="black";o.lineNumber="black";o.currentLine="lightcyan";o.tag="cornFlowerBlue";o.attribute="cadetBlue";o.fontFamily=i;o.fontSize=s;this.styles.push(o);var u=new n;u.name="Tierra";u.annotationRuler="moccasin";u.background="lemonchiffon";u.comment="darkseagreen";u.keyword="darkred";u.text="#555555";u.string="orangered";u.overviewRuler="moccasin";u.lineNumberOdd="chocolate";u.lineNumberEven="chocolate";u.lineNumber="chocolate";u.currentLine="#baa289";u.tag="darkred";u.attribute="cadetBlue";u.fontFamily=i;u.fontSize=s;this.styles.push(u);var a=new n;a.name="Nimbus";a.annotationRuler="#444";a.background="dimgray";a.comment="darkseagreen";a.keyword="darkorange";a.text="white";a.string="cornflowerblue";a.overviewRuler="#444";a.lineNumberOdd="#aaa";a.lineNumberEven="#aaa";a.lineNumber="#aaa";a.currentLine="#aabfbb";a.tag="darkorange";a.attribute="cadetBlue";a.fontFamily=i;a.fontSize=s;this.styles.push(a);var f=new n;f.name="Adelante";f.annotationRuler="#E2D2B2";f.background="#F1E7C8";f.comment="#5D774E";f.keyword="#AF473B";f.text="dimgray";f.string="#DE5D3B";f.overviewRuler="#E2D2B2";f.lineNumberOdd="#AF473B";f.lineNumberEven="#AF473B";f.lineNumber="#AF473B";f.currentLine="#9e937b";f.tag="#AF473B";f.attribute="cadetBlue";f.fontFamily=i;f.fontSize=s;this.styles.push(f);var l=new n;l.name="Raspberry Pi";l.annotationRuler="seashell";l.background="seashell";l.comment="#66B32F";l.keyword="#E73E36";l.text="dimgray";l.string="darkorange";l.overviewRuler="seashell";l.lineNumberOdd="#E73E36";l.lineNumberEven="#E73E36";l.lineNumber="#E73E36";l.currentLine="#F5B1AE";l.tag="#E73E36";l.attribute="cadetBlue";l.fontFamily=i;l.fontSize=s;this.styles.push(l)}function u(){return this.styles}function f(){var e={storage:"/themes",styleset:"editorstyles",defaultTheme:"Prospecto",selectedKey:"editorSelected"};return e}function l(){var t={};t.top=10;t.left=10;t.width=400;t.height=350;var n=t.left;var r=t.top;t.shapes=[{type:"TEXT",name:e["Line Numbers"],label:"1",x:n+20,y:r+20,fill:"darkSlateGray",family:"lineNumber",font:"9pt sans-serif"},{type:"RECTANGLE",name:e.Background,x:n+46,y:r,width:290,height:t.height,family:"background",fill:"white"},{type:"TEXT",name:e.Strings,label:"'text/javascript'",x:n+134,y:r+20,fill:"darkorange",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"=",x:n+124,y:r+20,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Current Line"],x:n+46,y:r+87,width:290,height:18,family:"currentLine",fill:"#eaf2fd"},{type:"TEXT",name:e["HTML Attribute"],label:"type",x:n+98,y:r+20,fill:"darkGray",family:"attribute",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Overview Ruler"],x:n+336,y:r,width:14,height:t.height,family:"overviewRuler",fill:"white"},{type:"TEXT",name:e.Comments,label:"/* comment */",x:n+75,y:r+40,fill:"darkSeaGreen",family:"comment",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"<script",x:n+55,y:r+20,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:">",x:n+213,y:r+20,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Strings,label:"'Result'",x:n+164,y:r+80,fill:"cornflowerBlue",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"multiply(a,b){",x:n+120,y:r+60,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"function",x:n+75,y:r+60,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"var",x:n+95,y:r+80,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"output = ",x:n+115,y:r+80,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:";",x:n+205,y:r+80,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"var",x:n+95,y:r+100,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"result = a*b;",x:n+115,y:r+100,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"return",x:n+95,y:r+120,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"output + result;",x:n+135,y:r+120,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"}",x:n+75,y:r+140,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"</script>",x:n+55,y:r+160,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"<style",x:n+55,y:r+200,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Attribute"],label:"type",x:n+95,y:r+200,fill:"darkGray",family:"attribute",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"=",x:n+121,y:r+200,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Strings,label:"'text/css'",x:n+131,y:r+200,fill:"darkorange",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:">",x:n+180,y:r+200,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:".some-class",x:n+75,y:r+220,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:"{",x:n+145,y:r+220,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Attribute"],label:"color:",x:n+95,y:r+240,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Value"],label:"#123456",x:n+130,y:r+240,fill:"darkSlateGray",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Text"],label:";",x:n+180,y:r+240,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:"}",x:n+75,y:r+260,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"</style>",x:n+55,y:r+280,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Annotation Ruler"],x:n,y:r,width:46,height:t.height,family:"annotationRuler",fill:"white"}];for(var i=0;i<16;i++){t.shapes.push({type:"TEXT",name:e["Line Numbers"],label:i+1,x:n+20,y:r+20*i+20,fill:"darkSlateGray",family:"lineNumber",font:"9pt sans-serif"})}return t}function c(e){try{var t=null;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml");var r=t.getElementsByTagName("parsererror");if(!r||!r.length||!r[0].childNodes.length){return t}return null}else{t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(e);return t}}catch(i){}}function h(e){console.log("fontsize: "+e)}function p(e){console.log("import theme");console.log(e);var t=e.parameters.valueFor("name");var r=this.parseToXML(t);var i=new n;i.name=r.getElementsByTagName("colorTheme")[0].attributes[1].value;i.annotationRuler=r.getElementsByTagName("background")[0].attributes[0].value;i.background=r.getElementsByTagName("background")[0].attributes[0].value;i.comment=r.getElementsByTagName("singleLineComment")[0].attributes[0].value;i.keyword=r.getElementsByTagName("keyword")[0].attributes[0].value;i.text=r.getElementsByTagName("foreground")[0].attributes[0].value;i.string=r.getElementsByTagName("string")[0].attributes[0].value;i.overviewRuler=r.getElementsByTagName("background")[0].attributes[0].value;i.lineNumberOdd=r.getElementsByTagName("lineNumber")[0].attributes[0].value;i.lineNumberEven=r.getElementsByTagName("lineNumber")[0].attributes[0].value;i.lineNumber=r.getElementsByTagName("lineNumber")[0].attributes[0].value;i.currentLine=r.getElementsByTagName("selectionBackground")[0].attributes[0].value;e.items.addTheme(i)}function d(e,n){var r="editorTheme";var i=t.TextTheme.getTheme();i.setThemeClass(r,i.buildStyleSheet(r,e))}var i='"Consolas", "Monaco", "Vera Mono", "monospace"';var s="10pt";o.prototype.styles=[];o.prototype.getStyles=u;var a=true;o.prototype.fontSettable=a;o.prototype.getThemeStorageInfo=f;o.prototype.parseToXML=c;o.prototype.selectFontSize=h;o.prototype.importTheme=p;o.prototype.processSettings=d;o.prototype.getViewData=l;return{ThemeData:o,getStyles:u}});define("orion/widgets/browse/readonlyEditorView",["orion/editor/editor","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/editorFeatures","orion/editorPreferences","orion/widgets/themes/ThemePreferences","orion/widgets/themes/editor/ThemeData","orion/objects"],function(e,t,n,r,i,s,o,u,a){function f(e){this._parent=e.parent;this.renderToolbars=e.renderToolbars;this.inputManager=e.inputManager;this.preferences=e.preferences;this.statusReporter=e.statusReporter;this.model=e.model;this.syntaxHighlighter=e.syntaxHighlighter;this.readonly=true;this.settings={};this._init()}f.prototype={getParent:function(){return this._parent},updateViewOptions:function(e){var t=0;if(e.showMargin){t=e.marginOffset;if(typeof t!=="number"){t=e.marginOffset=parseInt(t,10)}}var n=0;if(e.wordWrap){n=t}return{readonly:this.readonly||this.inputManager.getReadOnly(),tabSize:e.tabSize||4,expandTab:e.expandTab,wrapMode:e.wordWrap,wrapOffset:n,marginOffset:t,scrollAnimation:e.scrollAnimation?e.scrollAnimationTimeout:0}},updateSettings:function(e){this.settings=e;var t=this.editor;var n=this.inputManager;n.setAutoLoadEnabled(e.autoLoad);n.setAutoSaveTimeout(e.autoSave?e.autoSaveTimeout:-1);n.setSaveDiffsEnabled(e.saveDiffs);this.updateStyler(e);var r=t.getTextView();if(r){r.setOptions(this.updateViewOptions(e))}t.setAnnotationRulerVisible(e.annotationRuler);t.setLineNumberRulerVisible(e.lineNumberRuler);t.setFoldingRulerVisible(e.foldingRuler);t.setOverviewRulerVisible(e.overviewRuler);if(this.renderToolbars){this.renderToolbars(n.getFileMetadata())}},updateStyler:function(e){var t=this.syntaxHighlighter.getStyler();if(t){if(t.setTabsVisible){t.setTabsVisible(e.showTabs)}if(t.setSpacesVisible){t.setSpacesVisible(e.showSpaces)}}},_init:function(){var f=null;if(this.preferences){f=this.editorPreferences=new s.EditorPreferences(this.preferences,function(e){if(!e){f.getPrefs(this.updateSettings.bind(this))}else{this.updateSettings(e)}}.bind(this))}var l=null;if(this.preferences){l=new o.ThemePreferences(this.preferences,new u.ThemeData);l.apply()}var c=this._parent;var h=this.inputManager;var p=function(){var e=this.updateViewOptions(this.settings);a.mixin(e,{parent:c,model:new r.ProjectionTextModel(this.model||new n.TextModel)});var i=new t.TextView(e);return i}.bind(this);var d=this.editor=new e.Editor({textViewFactory:p,annotationFactory:new i.AnnotationFactory,foldingRulerFactory:new i.FoldingRulerFactory,lineNumberRulerFactory:new i.LineNumberRulerFactory,statusReporter:this.statusReporter,domNode:c});d.id="orion.editor";h.addEventListener("InputChanged",function(e){var t=d.getTextView();if(t){t.setOptions(this.updateViewOptions(this.settings));this.syntaxHighlighter.setup(e.contentType,d.getTextView(),d.getAnnotationModel(),e.title,true).then(function(){this.updateStyler(this.settings)}.bind(this))}}.bind(this));if(this.editorPreferences){this.editorPreferences.getPrefs(this.updateSettings.bind(this))}else{d.setAnnotationRulerVisible(false)}},create:function(){this.editor.install()},destroy:function(){this.editor.uninstall()},getStyleAccessor:function(){this.syntaxHighlighter.getStyler().getStyleAccessor()}};return{ReadonlyEditorView:f}});define("orion/fileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(e,t,n){function r(t,n,r){if(!t[n]){throw n+e[" is not supported in this file system"]}return t[n].apply(t,r)}function i(n,s,o,u){if(!n.readBlob){throw e["source file service does not support binary read"]}if(!o.writeBlob){throw e["target file service does not support binary write"]}if(s[s.length-1]!=="/"){return r(n,"readBlob",[s]).then(function(e){return r(o,"writeBlob",[u,e])})}var a=u.substring(0,u.length-1);var f=decodeURIComponent(a.substring(a.lastIndexOf("/")+1));var l=a.substring(0,a.lastIndexOf("/")+1);return r(o,"createFolder",[l,f]).then(function(){return},function(){return}).then(function(){return r(n,"fetchChildren",[s]).then(function(e){var r=[];for(var s=0;s<e.length;++s){var a=e[s].Location;var f=a;if(e[s].Directory){f=a.substring(0,a.length-1)}var l=decodeURIComponent(f.substring(f.lastIndexOf("/")+1));var c=u+encodeURIComponent(l);if(e[s].Directory){c+="/"}r[s]=i(n,a,o,c)}return t.all(r)})})}function s(r,i){function c(n){var r=new t;r.reject(e["No Matching FileService for location:"]+n);return r}var s=r.getServiceReferences("orion.core.file");var o=s;if(i){o=[];for(var u=0;u<s.length;++u){if(i(s[u])){o.push(s[u])}}}var a=[];var f=[];var l=[];var h=[];var p={fetchChildren:function(){var e=new t;e.resolve(h);return e},createWorkspace:function(){var n=new t;n.reject(e["no file service"]);return n},loadWorkspaces:function(){var n=new t;n.reject(e["no file service"]);return n},loadWorkspace:function(n){var r=new t;window.setTimeout(function(){r.resolve({Directory:true,Length:0,LocalTimeStamp:0,Name:e["File Servers"],Location:"/",Children:h,ChildrenLocation:"/"})},100);return r},search:c,createProject:c,createFolder:c,createFile:c,deleteFile:c,moveFile:c,copyFile:c,read:c,write:c};for(var d=0;d<o.length;++d){h[d]={Directory:true,Length:0,LocalTimeStamp:0,Location:o[d].getProperty("top"),ChildrenLocation:o[d].getProperty("top"),Name:o[d].getProperty("Name")};var v=o[d].getProperty("pattern")||".*";if(v[0]!=="^"){v="^"+v}a[d]=new RegExp(v);f[d]=r.getService(o[d]);l[d]=o[d].getProperty("Name");if(o[d].getProperty("NameKey")&&o[d].getProperty("nls")){n.getMessageBundle(o[d].getProperty("nls")).then(function(e,t){h[e].Name=t[o[e].getProperty("NameKey")];l[e]=t[o[e].getProperty("NameKey")]}.bind(this,d))}}this._getServiceIndex=function(t){if(t==="/"){return-1}else if(!t||t.length&&t.length===0){return f[0]?0:-1}for(var n=0;n<a.length;++n){if(a[n].test(t)){return n}}throw e["No Matching FileService for location:"]+t};this._getService=function(e){var t=this._getServiceIndex(e);return t===-1?p:f[t]};this._getServiceName=function(e){var t=this._getServiceIndex(e);return t===-1?p.Name:l[t]};this._getServiceRootURL=function(e){var t=this._getServiceIndex(e);return t===-1?p.Location:h[t].Location}}s.prototype={getService:function(e){return this._getService(e)},fileServiceName:function(e){return this._getServiceName(e)},fileServiceRootURL:function(e){return this._getServiceRootURL(e)},fetchChildren:function(e){return r(this._getService(e),"fetchChildren",arguments)},createWorkspace:function(e){return r(this._getService(),"createWorkspace",arguments)},loadWorkspaces:function(){return r(this._getService(),"loadWorkspaces",arguments)},loadWorkspace:function(e){return r(this._getService(e),"loadWorkspace",arguments)},createProject:function(e,t,n,i){return r(this._getService(e),"createProject",arguments)},createFolder:function(e,t){return r(this._getService(e),"createFolder",arguments)},createFile:function(e,t){return r(this._getService(e),"createFile",arguments)},deleteFile:function(e){return r(this._getService(e),"deleteFile",arguments)},moveFile:function(e,t,n){var s=this._getService(e);var o=this._getService(t);if(s===o){return r(s,"moveFile",arguments)}var u=e[e.length-1]==="/";var a=t;if(a[a.length-1]!=="/"){a+="/"}if(n){a+=encodeURIComponent(n)}else{var f=e;if(u){f=f.substring(0,f.length-1)}a+=f.substring(f.lastIndexOf("/")+1)}if(u&&a[a.length-1]!=="/"){a+="/"}return i(s,e,o,a).then(function(){return r(s,"deleteFile",[e])})},copyFile:function(e,t,n){var s=this._getService(e);var o=this._getService(t);if(s===o){return r(s,"copyFile",arguments)}var u=e[e.length-1]==="/";var a=t;if(a[a.length-1]!=="/"){a+="/"}if(n){a+=encodeURIComponent(n)}else{var f=e;if(u){f=f.substring(0,f.length-1)}a+=f.substring(f.lastIndexOf("/")+1)}if(u&&a[a.length-1]!=="/"){a+="/"}return i(s,e,o,a)},read:function(e,t){return r(this._getService(e),"read",arguments)},readBlob:function(e){return r(this._getService(e),"readBlob",arguments)},write:function(e,t,n){return r(this._getService(e),"write",arguments)},remoteImport:function(e,t){return r(this._getService(e),"remoteImport",arguments)},remoteExport:function(e,t){return r(this._getService(e),"remoteExport",arguments)},search:function(e){return r(this._getService(e.resource),"search",arguments)}};s.prototype.constructor=s;return{FileClient:s}});define("orion/editor/textStyler",["orion/editor/annotations"],function(e){function v(e,t){this._unnamedCounter=0;this._patterns=[];this._rootId=t;e.forEach(function(e){if(e.patterns){this._addPatterns(e.patterns,e.id)}}.bind(this))}function m(e,t,n,r,i){this.start=e.start;this.end=e.end;this.contentStart=e.contentStart;this.contentEnd=e.contentEnd;this.pattern=t;this._styler=n;this._parent=i;this._linePatterns=[];this._blockPatterns=[];this._enclosurePatterns={};if(r){this._initPatterns();this._subBlocks=d(r,r.getText(this.start,this.end),this,this.start)}}function g(e){this._styler=e}function y(e,t,n,r){this.whitespacesVisible=this.spacesVisible=this.tabsVisible=false;this.detectHyperlinks=true;this.highlightCaretLine=false;this.foldingEnabled=true;this.detectTasks=true;this.view=e;this.annotationModel=t;this.patternManager=new v(n,r);this._accessor=new g(this);this._bracketAnnotations=undefined;var i=this;this._listener={onChanged:function(e){i._onModelChanged(e)},onDestroy:function(e){i._onDestroy(e)},onLineStyle:function(e){i._onLineStyle(e)},onMouseDown:function(e){i._onMouseDown(e)},onSelection:function(e){i._onSelection(e)}};var s=e.getModel();if(s.getBaseModel){s=s.getBaseModel()}s.addEventListener("Changed",this._listener.onChanged);e.addEventListener("MouseDown",this._listener.onMouseDown);e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("Destroy",this._listener.onDestroy);e.addEventListener("LineStyle",this._listener.onLineStyle);var o=s.getCharCount();var u={start:0,contentStart:0,end:o,contentEnd:o};this._rootBlock=new m(u,null,this,s);this._computeFolding(this._rootBlock.getBlocks());e.redrawLines()}var t={styleClass:"line_caret"};var n=".begin";var r=".end";var i=/$/;var s=/.*(?:\n|$)/g;var o={regex:/ /g,style:{styleClass:"punctuation separator space",unmergeable:true}};var u={regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:true}};var a=function(e,t,n){var r=n;var i=e.lastIndex;s.lastIndex=n;var o=s.exec(t);while(o&&o.index<t.length){e.lastIndex=0;var u=e.exec(o[0]);if(u){u.index+=r;e.lastIndex=i;return u}r+=o[0].length;o=s.exec(t)}e.lastIndex=i;return null};var f=function(e,t,n,r){var i=e.pattern.regex?e.pattern.regex:e.pattern.regexBegin;var s=a(i,t,r);if(s){e.result=s;for(var o=0;o<n.length;o++){if(s.index<n[o].result.index||s.index===n[o].result.index&&e.pattern.pattern.index<n[o].pattern.pattern.index){n.splice(o,0,e);return}}n.push(e)}};var l=function(e,t,n,r){var i=0;for(var s=1;s<e.length;s++){if(e[s]){var o=t[s];if(o){var u=n+i;r.push({start:u,end:u+e[s].length,style:o.name})}i+=e[s].length}}};var c=function(e,t,n){var r=e.start;t.forEach(function(t){if(r<t.start){n.push({start:r,end:t.start,style:e.style})}n.push(t);r=t.end});if(r<e.end){n.push({start:r,end:e.end,style:e.style})}};var h=function(e,t,n,r){var s=n.getLinePatterns();if(!s){return}var o=[];s.forEach(function(t){var n=t.regex||t.regexBegin;n.oldLastIndex=n.lastIndex;n.lastIndex=0;var r=n.exec(e);if(r){o.push({result:r,pattern:t})}});o.sort(function(e,t){if(e.result.index<t.result.index){return-1}if(e.result.index>t.result.index){return 1}return e.pattern.pattern.index<t.pattern.pattern.index?-1:1});var u=0;while(o.length>0){var a=o[0];o.splice(0,1);if(a.result.index<u){f(a,e,o,u);continue}var h=a.result.index;var p,d;var v=[];if(a.pattern.regex){d=a.result;p=h+d[0].length;var m={start:t+h,end:t+p,style:a.pattern.pattern.name,isWhitespace:a.pattern.isWhitespace};if(a.pattern.pattern.captures){l(d,a.pattern.pattern.captures,t+h,v)}v.sort(function(e,t){if(e.start<t.start){return-1}if(e.start>t.start){return 1}return 0});for(var g=0;g<v.length-1;g++){if(v[g+1].start<v[g].end){var y={start:v[g+1].end,end:v[g].end,style:v[g].style};v[g].end=v[g+1].start;v.splice(g+2,0,y)}}c(m,v,r)}else{a.pattern.regexEnd.lastIndex=a.result.index+a.result[0].length;d=a.pattern.regexEnd.exec(e);if(!d){i.lastIndex=0;d=i.exec(e)}p=d.index+d[0].length;r.push({start:t+h,end:t+p,style:a.pattern.pattern.name,isWhitespace:a.pattern.isWhitespace})}u=d.index+d[0].length;f(a,e,o,u)}s.forEach(function(e){var t=e.regex||e.regexBegin;t.lastIndex=t.oldLastIndex})};var p=function(t,n,r,i){if(!n.detectTasks()){return}var s=n.getAnnotationModel();if(!s){return}var o=e.AnnotationType.ANNOTATION_TASK;var u=[],a=[];i.forEach(function(t){var i=s.getAnnotations(t.start,t.end);while(i.hasNext()){var f=i.next();if(f.type===o){a.push(f)}}var l=t.getLinePatterns();if(l.length&&(t.pattern.pattern.name==="comment.block"||t.pattern.pattern.name==="comment.line")){var c=[];h(r.getText(t.contentStart,t.end),t.contentStart,t,c);for(var p=0;p<c.length;p++){if(c[p].style==="meta.annotation.task.todo"){var d=c[p].end;if(n.isRenderingWhitespace()){while(p+1<c.length&&(c[p+1].isWhitespace||c[p+1].style==="meta.annotation.task.todo")){d=c[p+1].end;p+=1}}u.push(e.AnnotationType.createAnnotation(o,c[p].start,d,r.getText(c[p].start,d)))}}}}.bind(this));s.replaceAnnotations(a,u)};var d=function(e,t,n,r){var s=[];n.getBlockPatterns().forEach(function(e){var n=a(e.regexBegin,t,0);if(n){s.push({result:n,pattern:e})}}.bind(this));s.sort(function(e,t){if(e.result.index<t.result.index){return-1}if(e.result.index>t.result.index){return 1}return e.pattern.pattern.index<t.pattern.pattern.index?-1:1});if(!s.length){return s}var o=0;var u=[];while(s.length>0){var l=s[0];s.splice(0,1);if(l.result.index<o){f(l,t,s,o);continue}var c=e.getLineAtOffset(r+l.result.index);var d=e.getLine(c);var v=[];h(d,e.getLineStart(c),n,v);var g=r+l.result.index;var y=0;for(;y<v.length;y++){if(v[y].start===g){var b=l.result.index+l.result[0].length;var w=null;var E=b;while(!w){var S=a(l.pattern.regexEnd,t,E);if(!S){i.lastIndex=0;S=i.exec(t)}var x=[];var T=new m({start:g,end:r+S.index+S[0].length,contentStart:r+b,contentEnd:r+S.index},l.pattern,n.getStyler(),e,n);h(t.substring(b,S.index+S[0].length),b,T,x);if(!x.length||x[x.length-1].end<=S.index){w=T}E=S.index+S[0].length}u.push(w);o=w.end-r;break}}if(y===v.length){o=l.result.index+1}f(l,t,s,o)}p(r,n,e,u);return u};v.prototype={getPatterns:function(e){var t;if(!e){t=this._rootId}else{if(typeof e==="string"){t=e}else{t=e.qualifiedId}}var n=[0];var r={};var i=new RegExp(t+"#[^#]+$");var s=[];this._patterns.forEach(function(e){if(i.test(e.qualifiedId)){if(e.include){s.push(e)}else{e.index=n[0]++;r[e.id]=e}}}.bind(this));s.forEach(function(e){this._processInclude(e,n,r)}.bind(this));var o=[];var u=Object.keys(r);u.forEach(function(e){o.push(r[e])});return o},_addPatterns:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r.parentId=t;if(!r.id){r.id=this._UNNAMED+this._unnamedCounter++}r.qualifiedId=r.parentId+"#"+r.id;this._patterns.push(r);if(r.patterns&&!r.include){this._addPatterns(r.patterns,r.qualifiedId)}}},_processInclude:function(e,t,n){var r;var i=e.include.indexOf("#");if(i===0){r=new RegExp(e.parentId.substring(0,e.parentId.indexOf("#"))+e.include+"$")}else if(i===-1){r=new RegExp(e.include+"#[^#]+$")}else{r=new RegExp(e.include)}var s=[];this._patterns.forEach(function(e){if(r.test(e.qualifiedId)){if(e.include){s.push(e)}else if(!n[e.id]){e.index=t[0]++;n[e.id]=e}}}.bind(this));s.forEach(function(e){this._processInclude(e,t,n)}.bind(this))},_UNNAMED:"noId"};m.prototype={adjustEnd:function(e){this.end+=e;this.contentEnd+=e;this._subBlocks.forEach(function(t){t.adjustEnd(e)})},adjustStart:function(e){this.start+=e;this.contentStart+=e;this._subBlocks.forEach(function(t){t.adjustStart(e)})},computeStyle:function(e,t){if(!(this.pattern&&this.start<=t&&t<this.end)){return null}var n={start:this.start,end:this.end,style:this.pattern.pattern.name};if(this.contentStart<=t&&t<this.contentEnd){if(this.pattern.pattern.contentName){return{start:this.contentStart,end:this.contentEnd,style:this.pattern.pattern.contentName}}return n}var r,i,s,o;if(t<this.contentStart){i=this.pattern.pattern.beginCaptures||this.pattern.pattern.captures;if(!i){return n}r=this.pattern.regexBegin;s=e.getText(this.start,this.contentStart);o=this.start}else{i=this.pattern.pattern.endCaptures||this.pattern.pattern.captures;if(!i){return n}r=this.pattern.regexEnd;s=e.getText(this.contentEnd,this.end);o=this.contentEnd}r.lastIndex=0;var u=r.exec(s);if(u){var a=[];l(u,i,o,a);for(var f=0;f<a.length;f++){if(a[f].start<=t&&t<a[f].end){return a[f]}}}return n},detectTasks:function(){return this._styler._getDetectTasks()},getAnnotationModel:function(){return this._styler._getAnnotationModel()},getBlockPatterns:function(){return this._blockPatterns},getBlocks:function(){return this._subBlocks},getEnclosurePatterns:function(){return this._enclosurePatterns},getLinePatterns:function(){return this._linePatterns},getParent:function(){return this._parent},getPatternManager:function(){return this._styler._getPatternManager()},getStyler:function(){return this._styler},isRenderingWhitespace:function(){return this._styler._isRenderingWhitespace()},_initPatterns:function(){var e=this.getPatternManager().getPatterns(this.pattern?this.pattern.pattern:null);var t=function(e){var t=/^\(\?i\)\s*/.exec(e);if(t){e=e.substring(t[0].length)}return e};e.forEach(function(e){var i;if(e.match&&!e.begin&&!e.end){var s="g";var o=t(e.match);if(o!==e.match){s+="i"}i={regex:new RegExp(o,s),pattern:e};this._linePatterns.push(i);if(e.name&&e.name.indexOf("punctuation.section")===0&&(e.name.indexOf(n)!==-1||e.name.indexOf(r)!==-1)){this._enclosurePatterns[e.name]=i}}else if(!e.match&&e.begin&&e.end){var u="g";var a=t(e.begin);if(a!==e.begin){u+="i"}var f="g";var l=t(e.end);if(l!==e.end){f+="i"}i={regexBegin:new RegExp(a,u),regexEnd:new RegExp(l,f),pattern:e};this._linePatterns.push(i);this._blockPatterns.push(i)}}.bind(this))}};g.prototype={getStyles:function(e){return this._styler.getStyles(e)}};y.prototype={destroy:function(){var e=this.view;if(e){var t=e.getModel();if(t.getBaseModel){t=t.getBaseModel()}t.removeEventListener("Changed",this._listener.onChanged);e.removeEventListener("MouseDown",this._listener.onMouseDown);e.removeEventListener("Selection",this._listener.onSelection);e.removeEventListener("Destroy",this._listener.onDestroy);e.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},getStyleAccessor:function(){return this._accessor},getStyles:function(e){var t=[];var n=this.view.getModel();if(n.getBaseModel){n=n.getBaseModel()}var r=this._findBlock(this._rootBlock,e);var i=n.getLineAtOffset(e);var s=n.getLine(i);var o=[];h(s,n.getLineStart(i),r,o);for(var u=0;u<o.length;u++){if(e<o[u].start){break}if(o[u].start<=e&&e<o[u].end){t.push(o[u]);break}}while(r){var a=r.computeStyle(n,e);if(a){t.splice(0,0,a)}r=r.getParent()}return t},setHighlightCaretLine:function(e){this.highlightCaretLine=e},setWhitespacesVisible:function(e,t){if(this.whitespacesVisible===e){return}this.whitespacesVisible=e;if(t){this.view.redraw()}},setTabsVisible:function(e){if(this.tabsVisible===e){return}this.tabsVisible=e;this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,false);this.view.redraw()},setSpacesVisible:function(e){if(this.spacesVisible===e){return}this.spacesVisible=e;this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,false);this.view.redraw()},setDetectHyperlinks:function(e){this.detectHyperlinks=e},setFoldingEnabled:function(e){this.foldingEnabled=e},setDetectTasks:function(e){this.detectTasks=e},_binarySearch:function(e,t,n,r,i){var s;if(r===undefined){r=-1}if(i===undefined){i=e.length}while(i-r>1){s=Math.floor((i+r)/2);if(t<=e[s].start){i=s}else if(n&&t<e[s].end){i=s;break}else{r=s}}return i},_computeFolding:function(t){if(!this.foldingEnabled){return}var n=this.view;var r=n.getModel();if(!r.getBaseModel){return}var i=this.annotationModel;if(!i){return}i.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING);var s=[];var o=r.getBaseModel();for(var u=0;u<t.length;u++){var a=t[u];var f=this._createFoldingAnnotation(r,o,a.start,a.end);if(f){s.push(f)}}i.replaceAnnotations(null,s)},_createFoldingAnnotation:function(t,n,r,i){var s=n.getLineAtOffset(r);var o=n.getLineAtOffset(i);if(s===o){return null}return new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(r,i,t)},_findBlock:function(e,t){var n=e.getBlocks();if(!n.length){return e}var r=this._binarySearch(n,t,true);if(r<n.length&&n[r].start<=t&&t<n[r].end){return this._findBlock(n[r],t)}return e},_findBrackets:function(e,t,n,r,i,s){var o=[],u=[];var a=i,f=n.getBlocks();var l=this._binarySearch(f,i,true);for(var c=l;c<f.length;c++){if(f[c].start>=s){break}var p=f[c].start;var d=f[c].end;if(a<p){h(r.substring(a-i,p-i),a,n,u);u.forEach(function(n){if(n.style.indexOf(e.pattern.name)===0){o.push(n.start+1)}else if(n.style.indexOf(t.pattern.name)===0){o.push(-(n.start+1))}});u=[]}a=d}if(a<s){h(r.substring(a-i,s-i),a,n,u);u.forEach(function(n){if(n.style.indexOf(e.pattern.name)===0){o.push(n.start+1)}else if(n.style.indexOf(t.pattern.name)===0){o.push(-(n.start+1))}})}return o},_findMatchingBracket:function(e,t,i){var s=e.getLineAtOffset(i);var o=e.getLineEnd(s);var u=e.getText(i,o);var f;var l=t.getEnclosurePatterns();var c=Object.keys(l);for(var h=0;h<c.length;h++){var p=l[c[h]];var d=a(p.regex,u,0);if(d&&d.index===0){f=p;break}}if(!f){return-1}var v;var m=false;if(f.pattern.name.indexOf(n)!==-1){m=true;v=f.pattern.name.replace(n,r)}else{v=f.pattern.name.replace(r,n)}var g=l[v];if(!g){return-1}var y=e.getLine(s);var b=e.getLineStart(s);var w=this._findBrackets(f,g,t,y,b,o);for(h=0;h<w.length;h++){var E=w[h]>=0?1:-1;if(w[h]*E-1===i){var S=1;if(!m){h--;for(;h>=0;h--){E=w[h]>=0?1:-1;S+=E;if(S===0){return w[h]*E-1}}s-=1;while(s>=0){y=e.getLine(s);b=e.getLineStart(s);o=e.getLineEnd(s);w=this._findBrackets(f,g,t,y,b,o);for(var x=w.length-1;x>=0;x--){E=w[x]>=0?1:-1;S+=E;if(S===0){return w[x]*E-1}}s--}}else{h++;for(;h<w.length;h++){E=w[h]>=0?1:-1;S+=E;if(S===0){return w[h]*E-1}}s+=1;var T=e.getLineCount();while(s<T){y=e.getLine(s);b=e.getLineStart(s);o=e.getLineEnd(s);w=this._findBrackets(f,g,t,y,b,o);for(var N=0;N<w.length;N++){E=w[N]>=0?1:-1;S+=E;if(S===0){return w[N]*E-1}}s++}}break}}return-1},_getAnnotationModel:function(){return this.annotationModel},_getDetectTasks:function(){return this.detectTasks},_getLineStyle:function(e){if(this.highlightCaretLine){var n=this.view;var r=n.getModel();var i=n.getSelection();if(i.start===i.end&&r.getLineAtOffset(i.start)===e){return t}}return null},_getPatternManager:function(){return this.patternManager},_getStyles:function(e,t,n,r){if(t.getBaseModel){r=t.mapOffset(r)}var i=r+n.length;var s=[];var o=r,u=e.getBlocks();var f=this._binarySearch(u,r,true);for(var c=f;c<u.length;c++){if(u[c].start>=i){break}var p=u[c].start;var d=u[c].end;if(o<p){h(n.substring(o-r,p-r),o,e,s)}var v=Math.max(o,p);if(v===p){var m=a(u[c].pattern.regexBegin,n.substring(v-r),0);if(m){var g=u[c].pattern.pattern.beginCaptures||u[c].pattern.pattern.captures;if(g){l(m,g,v,s)}else{s.push({start:v,end:v+m[0].length,style:u[c].pattern.pattern.name})}v+=m[0].length}}var y=Math.min(i,d);var b=[];if(y===d){var w=n.substring(y-o-(u[c].end-u[c].contentEnd));var m=a(u[c].pattern.regexEnd,w,0);if(m){var g=u[c].pattern.pattern.endCaptures||u[c].pattern.pattern.captures;if(g){l(m,g,y-m[0].length,b)}else if(u[c].pattern.pattern.name){b.push({start:y-m[0].length,end:y,style:u[c].pattern.pattern.name})}y-=m[0].length}}var E=this._getStyles(u[c],t,n.substring(v-r,y-r),v);var S=u[c].pattern.pattern.contentName||u[c].pattern.pattern.name;if(S){var x=v;E.forEach(function(e){if(e.start-x){s.push({start:x,end:e.start,style:S})}s.push(e);x=e.end});if(y-x){s.push({start:x,end:y,style:S})}}else{s=s.concat(E)}s=s.concat(b);o=d}if(o<i){h(n.substring(o-r,i-r),o,e,s)}if(t.getBaseModel){for(var T=0;T<s.length;T++){var N=s[T].end-s[T].start;s[T].start=t.mapOffset(s[T].start,true);s[T].end=s[T].start+N}}return s},_isRenderingWhitespace:function(){return this.whitespacesVisible&&(this.tabsVisible||this.spacesVisible)},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){if(e.textView===this.view){e.style=this._getLineStyle(e.lineIndex)}e.ranges=this._getStyles(this._rootBlock,e.textView.getModel(),e.lineText,e.lineStart);e.ranges.forEach(function(e){if(e.style){e.style={styleClass:e.style.replace(/\./g," ")}}});if(this._isRenderingWhitespace()){if(this.spacesVisible){this._spliceStyles(o,e.ranges,e.lineText,e.lineStart)}if(this.tabsVisible){this._spliceStyles(u,e.ranges,e.lineText,e.lineStart)}}},_onSelection:function(t){var n=t.oldValue;var r=t.newValue;var i=this.view;var s=i.getModel();var o;if(this.highlightCaretLine){var u=s.getLineAtOffset(n.start);o=s.getLineAtOffset(r.start);var a=r.start===r.end;var f=n.start===n.end;if(!(u===o&&f&&a)){if(f){i.redrawLines(u,u+1)}if((u!==o||!f)&&a){i.redrawLines(o,o+1)}}}if(!this.annotationModel){return}var l=this._bracketAnnotations,c,h;if(r.start===r.end&&(h=i.getCaretOffset())>0){var p=h-1;if(s.getBaseModel){p=s.mapOffset(p);s=s.getBaseModel()}var d=this._findBlock(this._rootBlock,p);var v=this._findMatchingBracket(s,d,p);if(v!==-1){c=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,v,v+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,p,p+1)]}}this._bracketAnnotations=c;this.annotationModel.replaceAnnotations(l,c)},_onMouseDown:function(e){if(e.clickCount!==2){return}var t=this.view;var n=t.getModel();var r=t.getOffsetAtLocation(e.x,e.y);if(r>0){var i=r-1;var s=n;if(n.getBaseModel){i=n.mapOffset(i);s=n.getBaseModel()}var o=this._findBlock(this._rootBlock,i);var u=this._findMatchingBracket(s,o,i);if(u!==-1){e.preventDefault();var a=u;if(n.getBaseModel){a=n.mapOffset(a,true)}if(r>a){r--;a++}t.setSelection(a,r)}}},_onModelChanged:function(t){var n=t.start;var r=t.removedCharCount;var i=t.addedCharCount;var s=i-r;var o=this.view;var u=o.getModel();var a=u.getBaseModel?u.getBaseModel():u;var f=n+r;var l=a.getCharCount();var c=this._rootBlock.getBlocks();var h=c.length;var p=a.getLineStart(a.getLineAtOffset(n));var v=this._binarySearch(c,p,true);var m=this._binarySearch(c,f,false,v-1,h);var g;if(v<h&&c[v].start<=p&&p<c[v].end){g=c[v].start;if(g>n){g+=s}}else{if(v===h&&h>0&&l-s===c[h-1].end){g=c[h-1].start}else{g=p}}var y,b;do{if(m<h){y=c[m].end;if(y>n){y+=s}m+=1}else{m=h;y=l}var w=a.getText(g,y),E;b=d(a,w,this._rootBlock,g)}while(b.length&&c.length&&m<h&&b[b.length-1].pattern.pattern.id!==c[m-1].pattern.pattern.id);for(var S=v;S<c.length;S++){E=c[S];if(E.start>n){E.adjustStart(s)}if(E.start>n){E.adjustEnd(s)}}var x=m-v!==b.length;if(!x){for(S=0;S<b.length;S++){E=c[v+S];var T=b[S];if(E.start!==T.start||E.end!==T.end||E.type!==T.type){x=true;break}}}var N=[v,m-v].concat(b);Array.prototype.splice.apply(c,N);if(x){var C=g;var k=y;if(u!==a){C=u.mapOffset(C,true);k=u.mapOffset(k,true)}o.redrawRange(C,k)}if(this.foldingEnabled&&a!==u&&this.annotationModel){var L=this.annotationModel;var A=L.getAnnotations(g,y);var O=[],M=[];var _;while(A.hasNext()){_=A.next();if(_.type===e.AnnotationType.ANNOTATION_FOLDING){M.push(_);for(S=0;S<b.length;S++){if(_.start===b[S].start&&_.end===b[S].end){break}}if(S===b.length){O.push(_);_.expand()}else{var D=_.start;var P=_.end;if(D>n){D-=s}if(P>n){P-=s}if(D<=n&&n<P&&D<=f&&f<P){var H=a.getLineAtOffset(_.start);var B=a.getLineAtOffset(_.end);if(H!==B){if(!_.expanded){_.expand()}}else{L.removeAnnotation(_)}}}}}var j=[];for(S=0;S<b.length;S++){E=b[S];for(var F=0;F<M.length;F++){if(M[F].start===E.start&&M[F].end===E.end){break}}if(F===M.length){_=this._createFoldingAnnotation(u,a,E.start,E.end);if(_){j.push(_)}}}L.replaceAnnotations(O,j)}},_spliceStyles:function(e,t,n,r){var i=e.regex;i.lastIndex=0;var s=0;var o=i.exec(n);while(o){var u=r+o.index;while(s<t.length){if(u<t[s].end){break}s++}var a={start:u,end:u+1,style:e.style};if(s<t.length&&t[s].start<=u){var f={start:u+1,end:t[s].end,style:t[s].style};t[s].end=u;t.splice(s+1,0,f);t.splice(s+1,0,a);s+=2}else{t.splice(s,0,a);s++}o=i.exec(n)}}};return{TextStyler:y}});define("orion/editor/stylers/shared/shared",[],function(){return{grammars:[{id:"orion.patterns",patterns:[{id:"brace_open",match:"{",name:"punctuation.section.block.begin"},{id:"brace_close",match:"}",name:"punctuation.section.block.end"},{id:"bracket_open",match:"\\[",name:"punctuation.section.bracket.begin"},{id:"bracket_close",match:"\\]",name:"punctuation.section.bracket.end"},{id:"parenthesis_open",match:"\\(",name:"punctuation.section.parens.begin"},{id:"parenthesis_close",match:"\\)",name:"punctuation.section.parens.end"},{id:"comment_singleline",begin:"//",end:".*",name:"comment.line",patterns:[{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},{id:"comment_multiline",begin:"/\\*",end:"\\*/",name:"comment.block",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\<\\S*\\>",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},{id:"string_singleline",match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},{id:"string_singleQuote",match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},{id:"number_decimal",match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric"},{id:"number_hex",match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric"}]}],keywords:[]}});define("orion/editor/stylers/js/js",["orion/editor/stylers/shared/shared"],function(e){var t=["break","case","class","catch","continue","const","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","true","try","typeof","undefined","var","void","while","with","yield"];var n=e.grammars;n.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{include:"orion.patterns"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control"},{begin:"'(?:\\\\.|[^'\\n])*\\\\\\n",end:"(?:(?:\\\\.|[^'\\n])*\\\\\\n)*(?:\\n|(?:\\\\.|[^'\\n])*'?)",name:"string.quoted.single"},{begin:'"(?:\\\\.|[^"\\n])*\\\\\\n',end:'(?:(?:\\\\.|[^"\\n])*\\\\\\n)*(?:\\n|(?:\\\\.|[^"\\n])*"?)',name:"string.quoted.double"}]});return{grammars:n,keywords:t}});define("orion/editor/stylers/css/css",["orion/editor/stylers/shared/shared"],function(e){var t=["alignment-adjust","alignment-baseline","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","appearance","azimuth","backface-visibility","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-top","border-width","border","bottom","box-align","box-decoration-break","box-direction","box-flex-group","box-flex","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color-profile","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue-after","cue-before","cue","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit-position","fit","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float-offset","float","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","font","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","line-stacking","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","mark-after","mark-before","mark","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline-color","outline-offset","outline-style","outline-width","outline","overflow-style","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","page-break-after","page-break-before","page-break-inside","page-policy","page","pause-after","pause-before","pause","perspective-origin","perspective","phonemes","pitch-range","pitch","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest-after","rest-before","rest","richness","right","rotation-point","rotation","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak-header","speak-numeral","speak-punctuation","speak","speech-rate","stress","string-set","table-layout","target-name","target-new","target-position","target","text-align-last","text-align","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform-origin","transform-style","transform","transition-delay","transition-duration","transition-property","transition-timing-function","transition","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch-range","voice-pitch","voice-rate","voice-stress","voice-volume","volume","white-space-collapse","white-space","widows","width","word-break","word-spacing","word-wrap","z-index"];var n=e.grammars;n.push({id:"orion.css",contentTypes:["text/css"],patterns:[{include:"orion.patterns"},{match:"(?:-webkit-|-moz-|-ms-|\\b)(?:"+t.join("|")+")\\b",name:"keyword.control"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric"},{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric"},{begin:"'[^'\\n]*\\\\\n",end:"(?:[^'\\n]*\\\\\\n)*[^'\\n]*'?",name:"string.quoted.single"},{begin:'"[^"\\n]*\\\\\n',end:'(?:[^"\\n]*\\\\\\n)*[^"\\n]*"?',name:"string.quoted.double"},{id:"comment_singleline"}]});return{grammars:n,keywords:t}});define("orion/editor/stylers/php/php",["orion/editor/stylers/shared/shared"],function(e){var t=["abstract","and","array","as","break","callable","case","catch","class","clone","const","continue","declare","default","die","do","echo","else","elseif","empty","enddeclare","endfor","endforeach","endif","endswitch","endwhile","eval","exit","extends","false","FALSE","final","finally","for","foreach","function","global","goto","if","implements","include","include_once","insteadof","interface","instanceof","isset","list","namespace","new","null","NULL","or","parent","print","private","protected","public","require","require_once","return","self","static","switch","throw","trait","try","true","TRUE","unset","use","var","while","xor","yield","__halt_compiler","__CLASS__","__DIR__","__FILE__","__FUNCTION__","__LINE__","__METHOD__","__NAMESPACE__","__TRAIT__"];var n=e.grammars;n.push({id:"orion.php",contentTypes:["text/x-php"],patterns:[{include:"orion.patterns"},{begin:"#",end:".*",name:"comment.line",patterns:[{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},{match:"\\b0[bB][01]+\\b",name:"constant.numeric"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control"}]});return{grammars:n,keywords:t}});define("orion/editor/stylers/html/html",["orion/editor/stylers/shared/shared","orion/editor/stylers/js/js","orion/editor/stylers/css/css","orion/editor/stylers/php/php"],function(e,t,n,r){var i=e.grammars.concat(t.grammars).concat(n.grammars).concat(r.grammars);i.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(<!(?:doctype|DOCTYPE))",end:"(>)",captures:{1:{name:"entity.name.tag.doctype.html"}},name:"meta.tag.doctype.html"},{begin:"(<script)([^>]*)(>)",end:"(</script>)",captures:{1:{name:"entity.name.tag"},3:{name:"entity.name.tag"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{begin:"(<style)([^>]*)(>)",end:"(</style>)",captures:{1:{name:"entity.name.tag"},3:{name:"entity.name.tag"}},contentName:"source.css.embedded.html",patterns:[{include:"orion.css"}]},{begin:"(<\\?php\\b)",end:"(\\?>|%>)",captures:{1:{name:"entity.name.tag"}},contentName:"source.php.embedded.html",patterns:[{include:"orion.php"}]},{id:"comment",begin:"<!--",end:"-->",name:"comment.block"},{begin:"(</?[A-Za-z0-9]+)",end:"(/?>)",captures:{1:{name:"entity.name.tag"}},name:"meta.tag.html",patterns:[{include:"#comment"},{include:"orion.patterns#string"},{include:"orion.patterns#string_singleQuote"}]}]});return{grammars:i,keywords:[]}});define("orion/editor/stylers/java/java",["orion/editor/stylers/shared/shared"],function(e){var t=["abstract","boolean","break","byte","case","catch","char","class","continue","default","do","double","else","extends","false","final","finally","float","for","if","implements","import","instanceof","int","interface","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","void","volatile","while"];var n=e.grammars;n.push({id:"orion.java",contentTypes:["text/x-java-source"],patterns:[{include:"orion.patterns"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control"},{id:"string_singleQuote"}]});return{grammars:n,keywords:t}});define("orion/editor/stylers/json/json",["orion/editor/stylers/shared/shared"],function(e){var t=e.grammars;t.push({id:"orion.json",contentTypes:["application/json"],patterns:[{include:"orion.patterns"},{match:"\\b(?:true|false|null)\\b",name:"keyword.control"},{id:"comment_singleline"},{id:"comment_multiline"}]});return{grammars:t,keywords:[]}});define("orion/editor/stylers/python/python",["orion/editor/stylers/shared/shared"],function(e){var t=["and","as","assert","break","class","continue","def","del","exec","elif","else","except","Ellipsis","False","finally","for","from","global","if","import","in","is","lambda","not","None","NotImplemented","or","pass","print","raise","return","try","True","while","with","yield"];var n=e.grammars;n.push({id:"orion.py",contentTypes:["text/x-python"],patterns:[{include:"orion.patterns"},{id:"comment_singleline"},{id:"comment_multiline"},{id:"number_decimal",match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)[lL]?\\b",name:"constant.numeric"},{begin:"#",end:".*",name:"comment.line",patterns:[{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},{begin:"'''",end:"'''",name:"string.quoted.triple"},{begin:'"""',end:'"""',name:"string.quoted.triple"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control"}]});return{grammars:n,keywords:t}});define("orion/editor/stylers/ruby/ruby",["orion/editor/stylers/shared/shared"],function(e){var t=["alias","alias_method","and","attr_reader","attr_writer","attr_accessor","attr","BEGIN","begin","break","case","class","catch","def","defined?","do","else","elsif","END","end","ensure","extend","false","for","if","fail","gem","in","include","initialize","load","loop","lambda","module","module_function","new","next","nil","not","or","public","prepend","private","protected","raise","redo","require","require_relative","rescue","retry","return","self","super","then","throw","true","undef","unless","until","when","while","yield","__ENCODING__","__END__","__FILE__","__LINE__"];var n=e.grammars;n.push({id:"orion.rb",contentTypes:["text/x-ruby"],patterns:[{include:"orion.patterns"},{id:"comment_singleline"},{id:"comment_multiline"},{begin:"#",end:".*",name:"comment.line",patterns:[{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},{id:"comment_multiline",begin:"^=begin",end:"^=end",name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},{match:"\\b0[bB][01]+\\b",name:"constant.numeric"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control"}]});return{grammars:n,keywords:t}});define("orion/widgets/browse/staticDataSource",["orion/Deferred","orion/editor/textStyler","orion/editor/stylers/js/js","orion/editor/stylers/css/css","orion/editor/stylers/html/html","orion/editor/stylers/java/java","orion/editor/stylers/json/json","orion/editor/stylers/php/php","orion/editor/stylers/python/python","orion/editor/stylers/ruby/ruby"],function(e,t,n,r,i,s,o,u,a,f){function c(){this.styler=null}var l=[{id:"text/plain",name:"Text",extension:["txt"],imageClass:"file-sprite-text modelDecorationSprite"},{id:"application/javascript","extends":"text/plain",name:"JavaScript",extension:["js"],imageClass:"file-sprite-javascript modelDecorationSprite"},{id:"text/html","extends":"text/plain",name:"HTML",extension:["html","htm"],imageClass:"file-sprite-html modelDecorationSprite"},{id:"text/css","extends":"text/plain",name:"CSS",extension:["css"],imageClass:"file-sprite-css modelDecorationSprite"},{id:"application/json","extends":"text/plain",name:"JSON",extension:["json"],imageClass:"file-sprite-text modelDecorationSprite"},{id:"application/xml","extends":"text/plain",name:"XML",extension:["xml"],imageClass:"file-sprite-xml"},{id:"text/x-java-source","extends":"text/plain",name:"Java",extension:["java"]},{id:"text/x-python","extends":"text/plain",name:"Python",extension:["py","rpy","pyw","cpy","SConstruct","Sconstruct","sconstruct","SConscript","gyp","gypi"]},{id:"text/x-ruby","extends":"text/plain",name:"Ruby",extension:["rb","rbx","rjs","Rakefile","rake","cgi","fcgi","gemspec","irbrc","capfile","ru","prawn","Gemfile","Guardfile","Vagrantfile","Appraisals","Rantfile"]},{id:"text/x-php","extends":"text/plain",name:"PHP",extension:["php","php3","php4","php5","phpt","phtml","aw","ctp"]},{id:"text/x-markdown","extends":"text/plain",name:"Markdown",extension:["md"]},{id:"text/x-yaml","extends":"text/plain",name:"YAML",extension:["yaml","yml"]},{id:"text/conf","extends":"text/plain",name:"Conf",extension:["conf"]},{id:"text/sh","extends":"text/plain",name:"sh",extension:["sh"]},{id:"image/gif",name:"GIF",extension:["gif"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/jpeg",name:"JPG",extension:["jpg","jpeg","jpe"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/ico",name:"ICO",extension:["ico"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/png",name:"PNG",extension:["png"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/tiff",name:"TIFF",extension:["tif","tiff"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/svg",name:"SVG",extension:["svg"],imageClass:"file-sprite-image modelDecorationSprite"}];c.prototype={setup:function(e,t,n,r,i){if(this.styler){if(this.styler.destroy){this.styler.destroy()}this.styler=null}return this.highlight(e,t,n)},highlight:function(s,l,c){if(this.styler){this.styler.destroy();this.styler=null}if(s){switch(s.id){case"application/javascript":this.styler=new t.TextStyler(l,c,n.grammars,"orion.js");break;case"text/css":this.styler=new t.TextStyler(l,c,r.grammars,"orion.css");break;case"text/html":this.styler=new t.TextStyler(l,c,i.grammars,"orion.html");break;case"text/x-java-source":this.styler=new t.TextStyler(l,c,n.grammars,"orion.js");break;case"application/json":this.styler=new t.TextStyler(l,c,o.grammars,"orion.json");break;case"text/x-python":this.styler=new t.TextStyler(l,c,a.grammars,"orion.py");break;case"text/x-ruby":this.styler=new t.TextStyler(l,c,f.grammars,"orion.rb");break;case"text/x-php":this.styler=new t.TextStyler(l,c,u.grammars,"orion.php");break}}return(new e).resolve()},getStyler:function(){return this.styler}};return{ContentTypes:l,SyntaxHighlighter:c}});define("orion/widgets/browse/readonlyFileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(e,t,n){function r(e){function n(n){return function(){var r;try{var i=e[n].apply(e,Array.prototype.slice.call(arguments));if(i&&typeof i.then==="function"){return i}else{r=new t;r.resolve(i)}}catch(s){r=new t;r.reject(s)}return r.promise}}var r;for(r in e){if(typeof e[r]==="function"){this[r]=n(r)}}}function i(e,t,n,r){this._properties=n||{};this._properties["service.id"]=e;this._properties.objectClass=t;this._properties["service.names"]=t;this.service=r}function s(t,n,r){if(!t[n]){throw n+e[" is not supported in this file system"]}return t[n].apply(t,r)}function o(s,o){function p(n){var r=new t;r.reject(e["No Matching FileService for location:"]+n);return r}var u=[];s.forEach(function(e){var t=new r(e.impl);u.push(new i(e.id,"readonly.file.service",e.serviceProperties,t))});var a=u;if(o){a=[];for(var f=0;f<u.length;++f){if(o(u[f])){a.push(u[f])}}}var l=[];var c=[];var h=[];var d=[];var v={fetchChildren:function(){var e=new t;e.resolve(d);return e},createWorkspace:function(){var n=new t;n.reject(e["no file service"]);return n},loadWorkspaces:function(){var n=new t;n.reject(e["no file service"]);return n},loadWorkspace:function(n){var r=new t;window.setTimeout(function(){r.resolve({Directory:true,Length:0,LocalTimeStamp:0,Name:e["File Servers"],Location:"/",Children:d,ChildrenLocation:"/"})},100);return r},search:p,createProject:p,createFolder:p,createFile:p,deleteFile:p,moveFile:p,copyFile:p,read:p,write:p};for(var m=0;m<a.length;++m){d[m]={Directory:true,Length:0,LocalTimeStamp:0,Location:a[m].getProperty("top"),ChildrenLocation:a[m].getProperty("top"),Name:a[m].getProperty("Name")};var g=a[m].getProperty("pattern")||".*";if(g[0]!=="^"){g="^"+g}l[m]=new RegExp(g);c[m]=a[m].service;h[m]=a[m].getProperty("Name");if(a[m].getProperty("NameKey")&&a[m].getProperty("nls")){n.getMessageBundle(a[m].getProperty("nls")).then(function(e,t){d[e].Name=t[a[e].getProperty("NameKey")];h[e]=t[a[e].getProperty("NameKey")]}.bind(this,m))}}this._getServiceIndex=function(t){if(t==="/"){return-1}else if(!t||t.length&&t.length===0){return c[0]?0:-1}for(var n=0;n<l.length;++n){if(l[n].test(t)){return n}}throw e["No Matching FileService for location:"]+t};this._getService=function(e){var t=this._getServiceIndex(e);return t===-1?v:c[t]};this._getServiceName=function(e){var t=this._getServiceIndex(e);return t===-1?v.Name:h[t]};this._getServiceRootURL=function(e){var t=this._getServiceIndex(e);return t===-1?v.Location:d[t].Location}}i.prototype={getPropertyKeys:function(){var e=[];var t;for(t in this._properties){if(this._properties.hasOwnProperty(t)){e.push(t)}}return e},getProperty:function(e){return this._properties[e]}};i.prototype.constructor=i;o.prototype={getService:function(e){return this._getService(e)},fileServiceName:function(e){return this._getServiceName(e)},fileServiceRootURL:function(e){return this._getServiceRootURL(e)},fetchChildren:function(e){return s(this._getService(e),"fetchChildren",arguments)},loadWorkspaces:function(){return s(this._getService(),"loadWorkspaces",arguments)},read:function(e,t){return s(this._getService(e),"read",arguments)},loadWorkspace:function(e){return s(this._getService(e),"loadWorkspace",arguments)}};o.prototype.constructor=o;return{FileClient:o}});define("orion/widgets/browse/emptyFileClient",["orion/Deferred"],function(e){function s(){}var t={Directory:false,Length:1159,LocaltimeStamp:1389974936424,Location:"readme",Name:"README.md"};var n={Directory:false,Length:1159,LocaltimeStamp:1389974936424,Location:"readme",Name:"README.md",Parents:[]};var r="The goal of Orion is to build developer tooling that works in the browser, at web scale.\n"+"The vision behind Orion is to move software development to the web as a web experience, by\n"+"enabling open tool integration through HTTP and REST, JSON, OAuth, OpenID, and others.\n"+"The idea is to exploit internet design principles throughout, instead of trying to bring\n"+"existing desktop IDE concepts to the browser. See the [Orion wiki](http://wiki.eclipse.org/Orion) for more\n"+"information about Orion.\n"+"\n"+"Contributing\n"+"------------\n"+"\n"+"Orion source code is available in an Eclipse Git repository, and there is also a mirror\n"+"on GitHub. For complete details on getting the source and getting setup to develop Orion,\n"+"see the [Orion wiki](http://wiki.eclipse.org/Orion/Getting_the_source).\n"+"\n"+"Bug reports and patches are welcome in [bugzilla](https://bugs.eclipse.org/bugs/enter_bug.cgi?product=Orion).\n"+"\n"+"License\n"+"-------\n"+"\n"+"This repository contains the Orion client and Node-based server. This source code is available\n"+"under the [Eclipse Public License](http://www.eclipse.org/legal/epl-v10.html)\n"+"and [Eclipse Distribution License](http://www.eclipse.org/org/documents/edl-v10.php).\n";var i={Children:[t],ChildrenLocation:"children",Directory:true,Length:0,LocaltimeStamp:1389974936424,Location:"root",Name:""};s.prototype={fileServiceName:function(e){return"Empty"},fileServiceRootURL:function(e){return""},fetchChildren:function(n){return(new e).resolve([t])},loadWorkspaces:function(){return(new e).resolve(i)},read:function(t,i){if(i){return(new e).resolve(n)}return(new e).resolve(r)},loadWorkspace:function(t){return(new e).resolve(i)}};s.prototype.constructor=s;return{FileClient:s}});define("orion/widgets/browse/fileBrowser",["orion/PageUtil","orion/inputManager","orion/breadcrumbs","orion/widgets/browse/browseView","orion/explorers/navigatorRenderer","orion/widgets/browse/readonlyEditorView","orion/markdownView","orion/commandRegistry","orion/fileClient","orion/contentTypes","orion/widgets/browse/staticDataSource","orion/widgets/browse/readonlyFileClient","orion/widgets/browse/emptyFileClient","orion/Deferred","orion/URITemplate","orion/objects","orion/webui/littlelib"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function g(e){this._parentDomNode=m.node(e.parent);this._fileClient=e.fileClient;this._repoURL=e.repoURL;if(e.serviceRegistry){this._fileClient=new a.FileClient(e.serviceRegistry)}else if(!this._fileClient&&e.serviceRefs){this._fileClient=new c.FileClient(e.serviceRefs)}if(!this._fileClient){this._fileClient=new h.FileClient}this._syntaxHighlighter=e.syntaxHighlighter;if(!this._syntaxHighlighter){this._syntaxHighlighter=new l.SyntaxHighlighter}this._contentTypeService=e.contentTypeService;if(!this._contentTypeService){this._contentTypeService=new f.ContentTypeRegistry(l.ContentTypes)}this._preferences=e.preferences;this._init(e)}v.mixin(g.prototype,{_init:function(n){this._commandRegistry=new u.CommandRegistry({});this._maxEditorHeight=n.maxEditorHeight;this._inputManager=new t.InputManager({fileClient:this._fileClient,statusReporter:this._statusReport,contentTypeRegistry:this._contentTypeService});this._uriTemplate=new d("#{,resource,params*}");this._inputManager.addEventListener("InputChanged",function(e){var t=e.metadata;this._breadCrumbName=e.name;this._breadCrumbTarget=t;if(e.input===null||e.input===undefined){this._breadCrumbName=this._lastRoot?this._lastRoot.Name:"";this._breadCrumbTarget=this._lastRoot}var n=this._getEditorView(e.input,t);this._setEditor(n?n.editor:null);e.editor=this._editor}.bind(this));var r=document.createElement("div");var i={parent:r,syntaxHighlighter:this._syntaxHighlighter,inputManager:this._inputManager,preferences:this._preferences,statusReporter:function(e,t,n){this._statusReport(e,t,n)}.bind(this)};this._editorView=new s.ReadonlyEditorView(i);window.addEventListener("hashchange",function(){this.refresh(e.hash())}.bind(this));this.refresh(e.hash())},_breadCrumbMaker:function(e,t){this._renderBreadCrumb({task:"Browse",name:this._breadCrumbName,target:this._breadCrumbTarget,breadCrumbContainer:e,makeBreadcrumbLink:function(e,t,n){this._makeBreadCrumbLink(e,t,n)}.bind(this),makeBreadcrumFinalLink:true,fileClient:this._fileClient,maxLength:t})},_setEditor:function(e){if(this._editor===e){return}this._editor=e},_statusReport:function(e,t,n){if(t==="progress"){}else if(t==="error"){}else{}},_makeBreadCrumbLink:function(e,t,n){var r=n?n.Location:this._fileClient.fileServiceRootURL(t);e.href=this._uriTemplate.expand({resource:r})},_renderBreadCrumb:function(e){var t;var r=e.breadcrumbRootName;var i=e.fileClient;if(e.target){if(i&&!e.breadcrumbTarget){t=r?r+" ":"";t=t+i.fileServiceName(e.target.Location);r=null}}else{if(!e.breadcrumbTarget){r=r||e.task||e.name}}var s=m.node(e.breadCrumbContainer);if(s){m.empty(s);var o=e.breadcrumbTarget||e.target;var u=i&&o&&o.Location?i.fileServiceRootURL(o.Location):null;new n.BreadCrumbs({container:s,maxLength:e.maxLength,resource:o,rootSegmentName:r,workspaceRootSegmentName:u,workspaceRootURL:u,makeFinalHref:e.makeBreadcrumFinalLink,makeHref:e.makeBreadcrumbLink})}},_getEditorView:function(e,t){var n=null;if(t&&e){var s={parent:this._parentDomNode,readonly:true,showProjectView:false,maxEditorHeight:this._maxEditorHeight,readmeHeaderClass:"readmeHeader",metadata:t,commandRegistry:this._commandRegistry,contentTypeRegistry:this._contentTypeService,inputManager:this._inputManager,fileService:this._fileClient,breadCrumbMaker:function(e,t){this._breadCrumbMaker(e,t)}.bind(this)};if(t.Directory){n=new r.BrowseView(s)}else{var o=e.editor;if(!o||o==="orion.editor"){var u=this._contentTypeService.getFileContentType(t);if(!i.isImage(u)){s.editorView=this._editorView}else{s.imageView={};this._fileClient.readBlob(t.Location).then(function(e){var t=URL.createObjectURL(new Blob(new Uint8Array(e)));var n=document.createElement("img");n.src=t;n.classList.add("readonlyImage");this._currentEditorView.updateImage(n)}.bind(this))}n=new r.BrowseView(s)}else if(o==="orion.markdownViewer"){}else{}}}if(this._currentEditorView!==n){if(this._currentEditorView){this._currentEditorView.destroy()}this._currentEditorView=n;if(this._currentEditorView){this._currentEditorView.create()}}return this._currentEditorView},refresh:function(e){var t=e;if(!t){t=this._fileClient.fileServiceRootURL("")}this._inputManager.setInput(t)},create:function(){},destroy:function(){}});return{FileBrowser:g}});define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function n(e,t,n){this._properties=n||{};this._properties["service.id"]=e;this._properties.objectClass=t;this._properties["service.names"]=t}function r(e,t,n){this._serviceId=e;this._serviceReference=t;this._internalRegistry=n}function i(t,n){function r(r){return function(){var i;try{if(!n()){throw new Error("Service was unregistered")}var s=t[r].apply(t,Array.prototype.slice.call(arguments));if(s&&typeof s.then==="function"){return s}else{i=new e;i.resolve(s)}}catch(o){i=new e;i.reject(o)}return i.promise}}var i;for(i in t){if(typeof t[i]==="function"){this[i]=r(i)}}}function s(e,t){this.type=e;this.serviceReference=t}function o(){this._entries=[];this._namedReferences={};this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?true:false},unregisterService:function(t){var n=e._entries[t];if(!n){throw new Error("Service has already been unregistered: "+t)}var r=n.reference;e._serviceEventTarget.dispatchEvent(new s("unregistering",r));e._entries[t]=null;var i=r.getProperty("objectClass");i.forEach(function(t){var n=e._namedReferences[t];for(var i=0;i<n.length;i++){if(n[i]===r){if(n.length===1){delete e._namedReferences[t]}else{n.splice(i,1)}break}}})},modifyService:function(t){var n=e._entries[t];if(!n){throw new Error("Service not found while trying to send modified event: "+t)}var r=n.reference;e._serviceEventTarget.dispatchEvent(new s("modified",r))}}}n.prototype={getPropertyKeys:function(){var e=[];var t;for(t in this._properties){if(this._properties.hasOwnProperty(t)){e.push(t)}}return e},getProperty:function(e){return this._properties[e]}};n.prototype.constructor=n;r.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId)){throw new Error("Service has already been unregistered: "+this._serviceId)}return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{};e["service.id"]=this._serviceId;e.objectClass=t.objectClass;e["service.names"]=t["service.names"];this._internalRegistry.modifyService(this._serviceId)}};r.prototype.constructor=r;o.prototype={getService:function(e){var t;if(typeof e==="string"){var n=this._namedReferences[e];if(n){n.some(function(e){t=this._entries[e.getProperty("service.id")].service;return!!t},this)}}else{var r=this._entries[e.getProperty("service.id")];if(r){t=r.service}}return t||null},getServiceReferences:function(e){if(e){return this._namedReferences[e]?this._namedReferences[e]:[]}var t=[];this._entries.forEach(function(e){if(e){t.push(e.reference)}});return t},registerService:function(e,t,o){if(typeof t==="undefined"||t===null){throw new Error("invalid service")}if(typeof e==="string"){e=[e]}else if(!Array.isArray(e)){e=[]}var u=this._entries.length;var a=new n(u,e,o);var f=this._namedReferences;e.forEach(function(e){f[e]=f[e]||[];f[e].push(a)});var l=new i(t,this._internalRegistry.isRegistered.bind(null,u));this._entries.push({reference:a,service:l});var c=this._internalRegistry;this._serviceEventTarget.dispatchEvent(new s("registered",a));return new r(u,a,c)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}};o.prototype.constructor=o;return{ServiceRegistry:o}});define("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/URL-shim"],function(e,t,n){function r(e,t){var n=Object.keys(e);var r=Object.keys(t);if(n.length!==r.length){return false}n.sort();r.sort();for(var i=0,s=n.length;i<s;i++){var o=n[i];if(o!==r[i]){return false}var u=e[o],a=t[o];if(u===a){continue}if(JSON.stringify(u)!==JSON.stringify(a)){return false}}return true}function s(e){if(e.indexOf("://")===-1){try{return(new URL(e,location.href)).href}catch(t){}}return e}function o(e){function n(){return t=t||Object.keys(e)}var t=null;var r={key:function(e){return n()[e]},getItem:function(t){return e[t]},setItem:function(n,r){e[n]=r;t=null},removeItem:function(n){delete e[n];t=null},clear:function(){n().forEach(function(t){delete e[t]}.bind(this));t=null}};Object.defineProperty(r,"length",{get:function(){return n().length}});return r}function u(e,t){if(t&&t instanceof XMLHttpRequest){var n,r;try{n=t.status;r=t.statusText}catch(i){n=0;r=""}return{status:n||0,statusText:r}}return t}function a(e){var t=e?JSON.parse(JSON.stringify(e,u)):e;if(e instanceof Error){t.__isError=true;t.message=t.message||e.message;t.name=t.name||e.name}return t}function f(e,t){this.type=e;this.plugin=t}function l(e,t){this.__objectId=e;this.__methods=t}function c(n,i,s){function k(e){if(!y){return}s.postMessage(e,y)}function L(t){if(!y){return(new e).reject(new Error("plugin not connected"))}t.id=String(E++);var n=new e;T[t.id]=n;n.then(null,function(e){if(v==="active"&&e instanceof Error&&e.name==="Cancel"){k({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})}});var r=Object.prototype.toString;t.params.forEach(function(e,i){if(r.call(e)==="[object Object]"&&!(e instanceof l)){var s,o;for(s in e){if(r.call(e[s])==="[object Function]"){o=o||[];o.push(s)}}if(o){var u=S++;N[u]=e;var a=function(){delete N[u]};n.then(a,a);t.params[i]=new l(u,o)}}});s.postMessage(t,y);return n.promise}function A(e,t){if(e||e===0){k({id:e,result:null,error:t})}else{console.log(t)}}function O(e,t,n,r){r.forEach(function(e,t){if(e&&typeof e.__objectId!=="undefined"){var n={};e.__methods.forEach(function(t){n[t]=function(){return L({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}});r[t]=n}});var i=typeof e===undefined?null:{id:e,result:null,error:null};try{var s=n.apply(t,r);if(!i){return}if(s&&typeof s.then==="function"){x[e]=s;s.then(function(t){delete x[e];i.result=t;k(i)},function(t){if(x[e]){delete x[e];i.error=a(t);k(i)}},function(){k({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})}else{i.result=s;k(i)}}catch(o){if(i){i.error=a(o);k(i)}}}function _(e){try{if(e.method){var t=e.method,n=e.params||[];if("serviceId"in e){var r=C[e.serviceId];if(!r){A(e.id,"service not found")}if(t in r){O(e.id,r,r[t],n)}else{A(e.id,"method not found")}}else if("objectId"in e){var i=N[e.objectId];if(!i){A(e.id,"object not found")}if(t in i){O(e.id,i,i[t],n)}else{A(e.id,"method not found")}}else if("requestId"in e){var u=x[e.requestId];if(u&&t==="cancel"&&u.cancel){u.cancel.apply(u,n)}}else if("responseId"in e){var a=T[e.responseId];if(a&&t==="progress"&&a.progress){a.progress.apply(a,n)}}else{if("plugin"===e.method){var f=e.params[0];M({headers:f.headers,services:f.services}).then(function(){if(g){g.resolve(o)}})}else if("timeout"===e.method){if(g){g.reject(e.error)}}else{throw new Error("Bad method: "+e.method)}}}else{var l=T[String(e.id)];delete T[String(e.id)];if(e.error){var c=s.handleServiceError(o,e.error);l.reject(c)}else{l.resolve(e.result)}}}catch(h){console.log("Plugin._messageHandler "+h)}}function D(e){var n={};if(e.methods){e.methods.forEach(function(t){n[t]=function(){var n={serviceId:e.serviceId,method:t,params:Array.prototype.slice.call(arguments)};if(v==="active"){return L(n)}else{return o.start({"transient":true}).then(function(){return L(n)})}}});if(n.addEventListener&&n.removeEventListener){var r=new t;var i=S++;N[i]={handleEvent:r.dispatchEvent.bind(r)};var s=new l(i,["handleEvent"]);var u=n.addEventListener;n.addEventListener=function(e,t){if(!r._namedListeners[e]){u(e,s)}r.addEventListener(e,t)};var a=n.removeEventListener;n.removeEventListener=function(e,t){r.removeEventListener(e,t);if(!r._namedListeners[e]){a(e,s)}}}}return n}function P(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=n;var r=e.names||e.type||[];if(!Array.isArray(r)){r=[r]}t.objectClass=r;return t}function H(e){var t=D(e);var n=P(e);var r=s.registerService(e.names||e.type,t,n);w[e.serviceId]={registration:r,proxy:t}}function B(){s.persist(n,{created:u,headers:c,services:h,autostart:p,lastModified:d})}var o=this;i=i||{};var u=i.created||(new Date).getTime();var c=i.headers||{};var h=i.services||[];var p=i.autostart;var d=i.lastModified||0;var v="installed";var m;var g;var y;var b;var w={};var E=0;var S=0;var x={};var T={};var N={};var C={};var M;this._persist=B;this._resolve=function(){v="resolved";s.dispatchEvent(new f("resolved",o))};this._getAutostart=function(){return p};this._getCreated=function(){return u};this.getLocation=function(){return n};this.getHeaders=function(){return JSON.parse(JSON.stringify(c))};this.getName=function(){var e=this.getHeaders();if(e){return e.name||""}return null};this.getVersion=function(){var e=this.getHeaders();if(e){return e.version||"0.0.0"}return null};this.getLastModified=function(){return d};this.getServiceReferences=function(){var e=[];Object.keys(w).forEach(function(t){e.push(w[t].registration.getReference())});return e};this.setParent=function(t){if(b!==t){b=t;return o.stop({"transient":true}).then(function(){if("started"===p){return o.start({"transient":true})}else if("lazy"===p){return o.start({lazy:true,"transient":true})}})}return(new e).resolve()};this.getState=function(){return v};this.start=function(t){if(v==="uninstalled"){return(new e).reject(new Error("Plugin is uninstalled"))}if(m){return m.promise.then(this.start.bind(this,t))}if(v==="active"){return(new e).resolve()}if(!t||!t.transient){var r=t&&t.lazy?"lazy":"started";if(r!==p){p=r;B()}}var i=s.getState();if(i!=="starting"&&i!=="active"){if(t.transient){return(new e).reject(new Error("start transient error"))}return(new e).resolve()}if(v==="installed"){try{this._resolve()}catch(u){return(new e).reject(u)}}if(v==="resolved"){h.forEach(function(e){H(e)})}if(t&&t.lazy){if(v!=="starting"){v="starting";s.dispatchEvent(new f("lazy activation",o))}return(new e).resolve()}var a=new e;m=a;v="starting";s.dispatchEvent(new f("starting",o));g=new e;y=s.connect(n,_,b);g.then(function(){g=null;v="active";s.dispatchEvent(new f("started",o));m=null;a.resolve()},function(){g=null;v="stopping";s.dispatchEvent(new f("stopping",o));Object.keys(w).forEach(function(e){w[e].registration.unregister();delete w[e]});s.disconnect(y);y=null;v="resolved";m=null;s.dispatchEvent(new f("stopped",o));a.reject(new Error("plugin activation error"))});return a.promise};this.stop=function(t){if(v==="uninstalled"){return(new e).reject(new Error("Plugin is uninstalled"))}if(m){return m.promise.then(this.stop.bind(this,t))}if(!t||!t.transient){if("stopped"!==p){p="stopped";B()}}if(v!=="active"&&v!=="starting"){return(new e).resolve()}var n=new e;m=n;v="stopping";s.dispatchEvent(new f("stopping",o));Object.keys(w).forEach(function(e){w[e].registration.unregister();delete w[e]});if(y){s.disconnect(y);y=null}v="resolved";m=null;s.dispatchEvent(new f("stopped",o));n.resolve();return n.promise};M=function(t){if(v==="uninstalled"){return(new e).reject(new Error("Plugin is uninstalled"))}if(!t){if(d===0){d=(new Date).getTime();B()}return s.loadManifest(n).then(M)}var i=c;var u=h;var a=p;c=t.headers||{};h=t.services||{};p=t.autostart||p;if(t.lastModified){d=t.lastModified}else{d=(new Date).getTime();B()}if(r(c,i)&&r(h,u)&&p===a){return(new e).resolve()}if(v==="active"||v==="starting"){var l=[];Object.keys(h).forEach(function(e){var t=h[e];l.push(e);var n=w[e];if(n){if(r(t.methods,Object.keys(n.proxy))){var i=P(t);var s=n.registration.getReference();var o={};s.getPropertyKeys().forEach(function(e){o[e]=s.getProperty(e)});if(!r(i,o)){n.registration.setProperties(i)}return}n.registration.unregister();delete w[e]}H(t)});Object.keys(w).forEach(function(e){if(l.indexOf(e)===-1){w[e].registration.unregister();delete w[e]}})}if(v==="active"){s.disconnect(y);g=new e;y=s.connect(n,_,b);g.then(function(){g=null},function(){g=null;v="stopping";s.dispatchEvent(new f("stopping"),o);Object.keys(w).forEach(function(e){w[e].registration.unregister();delete w[e]});s.disconnect(y);y=null;v="resolved";s.dispatchEvent(new f("stopped",o))})}return(new e).resolve()};this.update=function(e){return M(e).then(function(){s.dispatchEvent(new f("updated",o))})};this.uninstall=function(){if(v==="uninstalled"){return(new e).reject(new Error("Plugin is uninstalled"))}if(v==="active"||v==="starting"||v==="stopping"){return this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this))}s.removePlugin(this);v="uninstalled";s.dispatchEvent(new f("uninstalled",o));return(new e).resolve()}}function h(n,r){function g(e){var t=e.source;p.some(function(n){if(t===n.target){try{var r;if(typeof n.useStructuredClone==="undefined"){var i=typeof e.data!=="string";r=i?e.data:JSON.parse(e.data);n.useStructuredClone=i}else{r=n.useStructuredClone?e.data:JSON.parse(e.data)}n.handler(r)}catch(s){}return true}})}r=r||{};var u=r.storage||localStorage;if(!u.getItem){u=o(u)}var a="installed";var l;var h=[];var p=[];var d=new t;var v={};var m={registerService:n.registerService.bind(n),connect:function(e,t,n,r){function s(e){var n=new Error(e);n.name="timeout";t({method:"timeout",error:n})}var i={handler:t,url:e};var o=setTimeout(s.bind(null,"Load timeout for: "+e),r||15e3);var u=document.createElement("iframe");u.name=e+"_"+(new Date).getTime();u.src=e;u.onload=function(){clearTimeout(o);o=setTimeout(s.bind(null,"Plugin handshake timeout for: "+e),5e3)};u.sandbox="allow-scripts allow-same-origin";u.style.width=u.style.height="100%";u.frameBorder=0;(n||l).appendChild(u);i.target=u.contentWindow;i.close=function(){clearTimeout(o);if(u){var e=u.parentNode;if(e){e.removeChild(u)}u=null}};p.push(i);return i},disconnect:function(e){for(var t=0;t<p.length;t++){if(e===p[t]){p.splice(t,1);try{e.close()}catch(n){}break}}},removePlugin:function(e){for(var t=0;t<h.length;t++){if(e===h[t]){h.splice(t,1);break}}u.removeItem("plugin."+e.getLocation())},persist:function(e,t){u.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.target.postMessage(t.useStructuredClone?e:JSON.stringify(e),t.url)},dispatchEvent:function(e){try{d.dispatchEvent(e)}catch(t){if(console){console.log("PluginRegistry.dispatchEvent "+t)}}},loadManifest:function(t){var n=new e;var r=m.connect(t,function(e){if(!r||!e.method){return}if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];m.disconnect(r);r=null;n.resolve(t)}else if("timeout"===e.method){m.disconnect(r);r=null;n.reject(e.error)}});return n.promise},getState:function(){return a},handleServiceError:function(e,t){if(t&&t.status===401){var n=e.getHeaders();var r=e.getName()||e.getLocation();var s=document.createElement("span");s.appendChild(document.createTextNode("Authentication required for: "+r+"."));if(n.login){s.appendChild(document.createTextNode(" "));var o=document.createElement("a");o.target="_blank";o.textContent="Login";o.href=n.login;if(!i.test(o.href)){console.log("Illegal Login URL: "+n.login)}else{s.appendChild(o);s.appendChild(document.createTextNode(" and re-try the request."))}}var u=new XMLSerializer;return{Severity:"Error",HTML:true,Message:u.serializeToString(s)}}if(t.__isError){var a=t;t=new Error(a.message);Object.keys(a).forEach(function(e){t[e]=a[e]});delete t.__isError}return t}};this.getLocation=function(){return"System"};this.getHeaders=function(){return{}};this.getName=function(){return"System"};this.getVersion=function(){return"0.0.0"};this.getLastModified=function(){return 0};this.getState=m.getState;this.init=function(){if(a==="starting"||a==="active"||a==="stopping"){return}addEventListener("message",g,false);var e=[];for(var t=0,n=u.length;t<n;t++){e.push(u.key(t))}e.forEach(function(e){if(e.indexOf("plugin.")===0){var t=e.substring("plugin.".length);var n=JSON.parse(u.getItem(e));if(n.created){h.push(new c(t,n,m))}}});h.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1});if(r.parent){l=r.parent}else{l=document.createElement("div");if(!r.visible){l.style.display="none";l.style.visibility="hidden"}document.body.appendChild(l)}if(r.plugins){Object.keys(r.plugins).forEach(function(e){e=s(e);var t=this.getPlugin(e);if(!t){var n=r.plugins[e];n=typeof n==="object"||{};n.autostart=n.autostart||r.defaultAutostart||"lazy";h.push(new c(e,n,m))}}.bind(this))}a="starting"};this.start=function(){if(a!=="starting"){this.init()}if(a!=="starting"){return(new e).reject("Cannot start framework. Framework is already "+a+".")}var t=[];var n=(new Date).getTime();h.forEach(function(e){var r=e._getAutostart();if(e.getLastModified()===0){t.push(e.update().then(function(){if("started"===r){return e.start({"transient":true})}if("lazy"===r){return e.start({lazy:true,"transient":true})}e._resolve()}));return}if("started"===r){t.push(e.start({"transient":true}))}else if("lazy"===r){t.push(e.start({lazy:true,"transient":true}));if(n>e.getLastModified()+864e5){e.update()}}else{e._resolve()}});return e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){a="active"})};this.stop=function(){if(a!=="starting"&&a!=="active"){return(new e).reject("Cannot stop registry. Registry is already "+a+".")}a="stopping";var t=[];h.forEach(function(e){t.push(e.stop({"transient":true}))});return e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){if(!r.parent){var e=l.parentNode;if(e){e.removeChild(l)}}l=null;removeEventListener("message",g);a="resolved"})};this.update=function(){this.stop().then(this.start.bind(this))};this.uninstall=function(){return(new e).reject("Cannot uninstall registry")};this.installPlugin=function(t,n){t=s(t);var r=this.getPlugin(t);if(r){return(new e).resolve(r)}if(v[t]){return v[t]}if(n){r=new c(t,n,m);h.push(r);r._persist();m.dispatchEvent(new f("installed",r));return(new e).resolve(r)}var i=m.loadManifest(t).then(function(e){r=new c(t,e,m);h.push(r);r._persist();delete v[t];m.dispatchEvent(new f("installed",r));return r},function(e){delete v[t];throw e});v[t]=i;return i};this.getPlugins=function(){return h.slice()};this.getPlugin=function(e){var t=null;e=s(e);h.some(function(n){if(e===n.getLocation()){t=n;return true}});return t};this.addEventListener=d.addEventListener.bind(d);this.removeEventListener=d.removeEventListener.bind(d);this.resolvePlugins=function(){var e=true;h.forEach(function(t){e=e&&t._resolve()});return e}}var i=new RegExp("^http[s]?","i");return{Plugin:c,PluginRegistry:h}});var _browser_script_source=null;var _all_script=document.getElementsByTagName("script");if(_all_script&&_all_script.length&&_all_script.length>0){for(var j=0;j<2;j++){for(var i=0;i<_all_script.length;i++){if(j===0){if(_all_script[i].id==="orion.browse.browser"){_browser_script_source=_all_script[i].src;break}}else{var regex=/.*built-browse.*.js/;if(_all_script[i].src&&regex.exec(_all_script[i].src)){_browser_script_source=_all_script[i].src;break}}}if(_browser_script_source){break}}if(!_browser_script_source){_browser_script_source=_all_script[_all_script.length-1].src}}define("orion/widgets/browse/builder/browse",["orion/widgets/browse/fileBrowser","orion/serviceregistry","orion/pluginregistry","orion/URL-shim"],function(e,t,n){function r(r,i,s){var o;var u=new URL(i||window.location.href);if(u.host==="github.com"){o=new URL("../../plugins/GitHubFilePlugin.html?repo="+i,_browser_script_source)}else if(u.pathname.indexOf("/git/")===0){o=new URL("/gerrit/plugins/gerritFilesystem/static/plugins/GerritFilePlugin.html",i);o.query.set("project",u.pathname.substring(5))}else if(u.pathname.indexOf("/project/")===0){if(!s){s=(new URL("/ccm01",i)).href}o=new URL(s+"/service/com.ibm.team.filesystem.service.jazzhub.IOrionFilesystem/sr/pluginOrionWs.html?"+i)}else{throw"Bad Repo URL - "+i}var a=new t.ServiceRegistry;var f={};f[o.href]=true;var l=new n.PluginRegistry(a,{storage:{},plugins:f});l.start().then(function(){this._fileBrowser=new e.FileBrowser({parent:r,serviceRegistry:a})}.bind(this))}r.prototype={getFileBrowser:function(){return this._fileBrowser}};return r});orion=this.orion||(this.orion={});var browse=orion.browse||(orion.browse={});browse.browser=require("orion/widgets/browse/builder/browse")