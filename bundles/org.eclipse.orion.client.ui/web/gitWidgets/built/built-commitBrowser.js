/* orion commitBrowser */ 
/**
 * almond 0.2.4 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
//Going sloppy to avoid 'use strict' string cost, but strict practices should
//be followed.
/*jslint sloppy: true */
/*global setTimeout: false */

var requirejs, require, define;
(function (undef) {
    var main, req, makeMap, handlers,
        defined = {},
        waiting = {},
        config = {},
        defining = {},
        hasOwn = Object.prototype.hasOwnProperty,
        aps = [].slice;

    function hasProp(obj, prop) {
        return hasOwn.call(obj, prop);
    }

    /**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */
    function normalize(name, baseName) {
        var nameParts, nameSegment, mapValue, foundMap,
            foundI, foundStarMap, starI, i, j, part,
            baseParts = baseName && baseName.split("/"),
            map = config.map,
            starMap = (map && map['*']) || {};

        //Adjust any relative paths.
        if (name && name.charAt(0) === ".") {
            //If have a base name, try to normalize against it,
            //otherwise, assume it is a top-level require that will
            //be relative to baseUrl in the end.
            if (baseName) {
                //Convert baseName to array, and lop off the last part,
                //so that . matches that "directory" and not name of the baseName's
                //module. For instance, baseName of "one/two/three", maps to
                //"one/two/three.js", but we want the directory, "one/two" for
                //this normalization.
                baseParts = baseParts.slice(0, baseParts.length - 1);

                name = baseParts.concat(name.split("/"));

                //start trimDots
                for (i = 0; i < name.length; i += 1) {
                    part = name[i];
                    if (part === ".") {
                        name.splice(i, 1);
                        i -= 1;
                    } else if (part === "..") {
                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {
                            //End of the line. Keep at least one non-dot
                            //path segment at the front so it can be mapped
                            //correctly to disk. Otherwise, there is likely
                            //no path mapping for a path starting with '..'.
                            //This can still fail, but catches the most reasonable
                            //uses of ..
                            break;
                        } else if (i > 0) {
                            name.splice(i - 1, 2);
                            i -= 2;
                        }
                    }
                }
                //end trimDots

                name = name.join("/");
            } else if (name.indexOf('./') === 0) {
                // No baseName, so this is ID is resolved relative
                // to baseUrl, pull off the leading dot.
                name = name.substring(2);
            }
        }

        //Apply map config if available.
        if ((baseParts || starMap) && map) {
            nameParts = name.split('/');

            for (i = nameParts.length; i > 0; i -= 1) {
                nameSegment = nameParts.slice(0, i).join("/");

                if (baseParts) {
                    //Find the longest baseName segment match in the config.
                    //So, do joins on the biggest to smallest lengths of baseParts.
                    for (j = baseParts.length; j > 0; j -= 1) {
                        mapValue = map[baseParts.slice(0, j).join('/')];

                        //baseName segment has  config, find if it has one for
                        //this name.
                        if (mapValue) {
                            mapValue = mapValue[nameSegment];
                            if (mapValue) {
                                //Match, update name to the new value.
                                foundMap = mapValue;
                                foundI = i;
                                break;
                            }
                        }
                    }
                }

                if (foundMap) {
                    break;
                }

                //Check for a star map match, but just hold on to it,
                //if there is a shorter segment match later in a matching
                //config, then favor over this star map.
                if (!foundStarMap && starMap && starMap[nameSegment]) {
                    foundStarMap = starMap[nameSegment];
                    starI = i;
                }
            }

            if (!foundMap && foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
            }

            if (foundMap) {
                nameParts.splice(0, foundI, foundMap);
                name = nameParts.join('/');
            }
        }

        return name;
    }

    function makeRequire(relName, forceSync) {
        return function () {
            //A version of a require function that passes a moduleName
            //value for items that may need to
            //look up paths relative to the moduleName
            return req.apply(undef, aps.call(arguments, 0).concat([relName, forceSync]));
        };
    }

    function makeNormalize(relName) {
        return function (name) {
            return normalize(name, relName);
        };
    }

    function makeLoad(depName) {
        return function (value) {
            defined[depName] = value;
        };
    }

    function callDep(name) {
        if (hasProp(waiting, name)) {
            var args = waiting[name];
            delete waiting[name];
            defining[name] = true;
            main.apply(undef, args);
        }

        if (!hasProp(defined, name) && !hasProp(defining, name)) {
            throw new Error('No ' + name);
        }
        return defined[name];
    }

    //Turns a plugin!resource to [plugin, resource]
    //with the plugin being undefined if the name
    //did not have a plugin prefix.
    function splitPrefix(name) {
        var prefix,
            index = name ? name.indexOf('!') : -1;
        if (index > -1) {
            prefix = name.substring(0, index);
            name = name.substring(index + 1, name.length);
        }
        return [prefix, name];
    }

    /**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */
    makeMap = function (name, relName) {
        var plugin,
            parts = splitPrefix(name),
            prefix = parts[0];

        name = parts[1];

        if (prefix) {
            prefix = normalize(prefix, relName);
            plugin = callDep(prefix);
        }

        //Normalize according
        if (prefix) {
            if (plugin && plugin.normalize) {
                name = plugin.normalize(name, makeNormalize(relName));
            } else {
                name = normalize(name, relName);
            }
        } else {
            name = normalize(name, relName);
            parts = splitPrefix(name);
            prefix = parts[0];
            name = parts[1];
            if (prefix) {
                plugin = callDep(prefix);
            }
        }

        //Using ridiculous property names for space reasons
        return {
            f: prefix ? prefix + '!' + name : name, //fullName
            n: name,
            pr: prefix,
            p: plugin
        };
    };

    function makeConfig(name) {
        return function () {
            return (config && config.config && config.config[name]) || {};
        };
    }

    handlers = {
        require: function (name) {
            return makeRequire(name);
        },
        exports: function (name) {
            var e = defined[name];
            if (typeof e !== 'undefined') {
                return e;
            } else {
                return (defined[name] = {});
            }
        },
        module: function (name) {
            return {
                id: name,
                uri: '',
                exports: defined[name],
                config: makeConfig(name)
            };
        }
    };

    main = function (name, deps, callback, relName) {
        var cjsModule, depName, ret, map, i,
            args = [],
            usingExports;

        //Use name if no relName
        relName = relName || name;

        //Call the callback to define the module, if necessary.
        if (typeof callback === 'function') {

            //Pull out the defined dependencies and pass the ordered
            //values to the callback.
            //Default to [require, exports, module] if no deps
            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;
            for (i = 0; i < deps.length; i += 1) {
                map = makeMap(deps[i], relName);
                depName = map.f;

                //Fast path CommonJS standard dependencies.
                if (depName === "require") {
                    args[i] = handlers.require(name);
                } else if (depName === "exports") {
                    //CommonJS module spec 1.1
                    args[i] = handlers.exports(name);
                    usingExports = true;
                } else if (depName === "module") {
                    //CommonJS module spec 1.1
                    cjsModule = args[i] = handlers.module(name);
                } else if (hasProp(defined, depName) ||
                           hasProp(waiting, depName) ||
                           hasProp(defining, depName)) {
                    args[i] = callDep(depName);
                } else if (map.p) {
                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                    args[i] = defined[depName];
                } else {
                    throw new Error(name + ' missing ' + depName);
                }
            }

            ret = callback.apply(defined[name], args);

            if (name) {
                //If setting exports via "module" is in play,
                //favor that over return value and exports. After that,
                //favor a non-undefined return value over exports use.
                if (cjsModule && cjsModule.exports !== undef &&
                        cjsModule.exports !== defined[name]) {
                    defined[name] = cjsModule.exports;
                } else if (ret !== undef || !usingExports) {
                    //Use the return value from the function.
                    defined[name] = ret;
                }
            }
        } else if (name) {
            //May just be an object definition for the module. Only
            //worry about defining if have a module name.
            defined[name] = callback;
        }
    };

    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {
        if (typeof deps === "string") {
            if (handlers[deps]) {
                //callback in this case is really relName
                return handlers[deps](callback);
            }
            //Just return the module wanted. In this scenario, the
            //deps arg is the module name, and second arg (if passed)
            //is just the relName.
            //Normalize module name, if it contains . or ..
            return callDep(makeMap(deps, callback).f);
        } else if (!deps.splice) {
            //deps is a config object, not an array.
            config = deps;
            if (callback.splice) {
                //callback is an array, which means it is a dependency list.
                //Adjust args if there are dependencies
                deps = callback;
                callback = relName;
                relName = null;
            } else {
                deps = undef;
            }
        }

        //Support require(['a'])
        callback = callback || function () {};

        //If relName is a function, it is an errback handler,
        //so remove it.
        if (typeof relName === 'function') {
            relName = forceSync;
            forceSync = alt;
        }

        //Simulate async callback;
        if (forceSync) {
            main(undef, deps, callback, relName);
        } else {
            //Using a non-zero value because of concern for what old browsers
            //do, and latest browsers "upgrade" to 4 if lower value is used:
            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
            //If want a value immediately, use require('id') instead -- something
            //that works in almond on the global level, but not guaranteed and
            //unlikely to work in other AMD implementations.
            setTimeout(function () {
                main(undef, deps, callback, relName);
            }, 4);
        }

        return req;
    };

    /**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */
    req.config = function (cfg) {
        config = cfg;
        return req;
    };

    define = function (name, deps, callback) {

        //This module may not have dependencies
        if (!deps.splice) {
            //deps is not an array, so probably means
            //an object literal or factory function for
            //the value. Adjust args.
            callback = deps;
            deps = [];
        }

        if (!hasProp(defined, name) && !hasProp(waiting, name)) {
            waiting[name] = [name, deps, callback];
        }
    };

    define.amd = {
        jQuery: true
    };
}());

define("almond", function(){});

/**
 * @license RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */
/*jslint regexp: true */
/*global require: false, navigator: false, define: false */

/**
 * This plugin handles i18n! prefixed modules. It does the following:
 *
 * 1) A regular module can have a dependency on an i18n bundle, but the regular
 * module does not want to specify what locale to load. So it just specifies
 * the top-level bundle, like "i18n!nls/colors".
 *
 * This plugin will load the i18n bundle at nls/colors, see that it is a root/master
 * bundle since it does not have a locale in its name. It will then try to find
 * the best match locale available in that master bundle, then request all the
 * locale pieces for that best match locale. For instance, if the locale is "en-us",
 * then the plugin will ask for the "en-us", "en" and "root" bundles to be loaded
 * (but only if they are specified on the master bundle).
 *
 * Once all the bundles for the locale pieces load, then it mixes in all those
 * locale pieces into each other, then finally sets the context.defined value
 * for the nls/colors bundle to be that mixed in locale.
 *
 * 2) A regular module specifies a specific locale to load. For instance,
 * i18n!nls/fr-fr/colors. In this case, the plugin needs to load the master bundle
 * first, at nls/colors, then figure out what the best match locale is for fr-fr,
 * since maybe only fr or just root is defined for that locale. Once that best
 * fit is found, all of its locale pieces need to have their bundles loaded.
 *
 * Once all the bundles for the locale pieces load, then it mixes in all those
 * locale pieces into each other, then finally sets the context.defined value
 * for the nls/fr-fr/colors bundle to be that mixed in locale.
 */
(function () {
    

    //regexp for reconstructing the master bundle name from parts of the regexp match
    //nlsRegExp.exec("foo/bar/baz/nls/en-ca/foo") gives:
    //["foo/bar/baz/nls/en-ca/foo", "foo/bar/baz/nls/", "/", "/", "en-ca", "foo"]
    //nlsRegExp.exec("foo/bar/baz/nls/foo") gives:
    //["foo/bar/baz/nls/foo", "foo/bar/baz/nls/", "/", "/", "foo", ""]
    //so, if match[5] is blank, it means this is the top bundle definition.
    var nlsRegExp = /(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;

    //Helper function to avoid repeating code. Lots of arguments in the
    //desire to stay functional and support RequireJS contexts without having
    //to know about the RequireJS contexts.
    function addPart(locale, master, needed, toLoad, prefix, suffix) {
        if (master[locale]) {
            needed.push(locale);
            if (master[locale] === true || master[locale] === 1) {
                toLoad.push(prefix + locale + '/' + suffix);
            }
        }
    }

    function addIfExists(req, locale, toLoad, prefix, suffix) {
        var fullName = prefix + locale + '/' + suffix;
        if (require._fileExists(req.toUrl(fullName + '.js'))) {
            toLoad.push(fullName);
        }
    }

    /**
     * Simple function to mix in properties from source into target,
     * but only if target does not already have a property of the same name.
     * This is not robust in IE for transferring methods that match
     * Object.prototype names, but the uses of mixin here seem unlikely to
     * trigger a problem related to that.
     */
    function mixin(target, source, force) {
        var prop;
        for (prop in source) {
            if (source.hasOwnProperty(prop) && (!target.hasOwnProperty(prop) || force)) {
                target[prop] = source[prop];
            } else if (typeof source[prop] === 'object') {
                if (!target[prop] && source[prop]) {
                    target[prop] = {};
                }
                mixin(target[prop], source[prop], force);
            }
        }
    }

    define('i18n',['module'], function (module) {
        var masterConfig = module.config ? module.config() : {};

        return {
            version: '2.0.4',
            /**
             * Called when a dependency needs to be loaded.
             */
            load: function (name, req, onLoad, config) {
                config = config || {};

                if (config.locale) {
                    masterConfig.locale = config.locale;
                }

                var masterName,
                    match = nlsRegExp.exec(name),
                    prefix = match[1],
                    locale = match[4],
                    suffix = match[5],
                    parts = locale.split("-"),
                    toLoad = [],
                    value = {},
                    i, part, current = "";

                //If match[5] is blank, it means this is the top bundle definition,
                //so it does not have to be handled. Locale-specific requests
                //will have a match[4] value but no match[5]
                if (match[5]) {
                    //locale-specific bundle
                    prefix = match[1];
                    masterName = prefix + suffix;
                } else {
                    //Top-level bundle.
                    masterName = name;
                    suffix = match[4];
                    locale = masterConfig.locale;
                    if (!locale) {
                        locale = masterConfig.locale =
                            typeof navigator === "undefined" ? "root" :
                            (navigator.language ||
                             navigator.userLanguage || "root").toLowerCase();
                    }
                    parts = locale.split("-");
                }

                if (config.isBuild) {
                    //Check for existence of all locale possible files and
                    //require them if exist.
                    toLoad.push(masterName);
                    addIfExists(req, "root", toLoad, prefix, suffix);
                    for (i = 0; i < parts.length; i++) {
                        part = parts[i];
                        current += (current ? "-" : "") + part;
                        addIfExists(req, current, toLoad, prefix, suffix);
                    }
                                        
                    if(config.locales) {
                    	var j, k; 
                    	for (j = 0; j < config.locales.length; j++) {
                    		locale = config.locales[j];
                    		parts = locale.split("-");
                    		current = "";
	                    	for (k = 0; k < parts.length; k++) {
		                        part = parts[k];
		                        current += (current ? "-" : "") + part;
		                        addIfExists(req, current, toLoad, prefix, suffix);
	                    	}
                    	}
                    }

                    req(toLoad, function () {
                        onLoad();
                    });
                } else {
                    //First, fetch the master bundle, it knows what locales are available.
                    req([masterName], function (master) {
                        //Figure out the best fit
                        var needed = [],
                            part;

                        //Always allow for root, then do the rest of the locale parts.
                        addPart("root", master, needed, toLoad, prefix, suffix);
                        for (i = 0; i < parts.length; i++) {
                            part = parts[i];
                            current += (current ? "-" : "") + part;
                            addPart(current, master, needed, toLoad, prefix, suffix);
                        }

                        //Load all the parts missing.
                        req(toLoad, function () {
                            var i, partBundle, part;
                            for (i = needed.length - 1; i > -1 && needed[i]; i--) {
                                part = needed[i];
                                partBundle = master[part];
                                if (partBundle === true || partBundle === 1) {
                                    partBundle = req(prefix + part + '/' + suffix);
                                }
                                mixin(value, partBundle);
                            }

                            //All done, notify the loader.
                            onLoad(value);
                        });
                    });
                }
            }
        };
    });
}());

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('git/nls/gitmessages',{
	root: {//Default message bundle
		"Compare": "Compare", //$NON-NLS-0$  //$NON-NLS-1$
		"View the side-by-side compare": "View the side-by-side compare", //$NON-NLS-0$  //$NON-NLS-1$
		"WorkingDirVer": "Open Working Directory", //$NON-NLS-0$  //$NON-NLS-1$
		"Working Directory": "Working Directory", //$NON-NLS-0$  //$NON-NLS-1$
		"ViewWorkingDirVer": "View the working directory version of the file", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading...": "Loading...", //$NON-NLS-0$  //$NON-NLS-1$
		"Repositories": "Git", //$NON-NLS-0$  //$NON-NLS-1$
		"Repo": "Repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"0 on 1 - Git": "${0} on ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
		"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
		"Show in eclipse.org": "Show in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
		"Show in GitHub": "Show in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
		"Show this repository in GitHub": "Show this repository in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit Details": "Commit Details", //$NON-NLS-0$  //$NON-NLS-1$
		"No Commits": "No Commits", //$NON-NLS-0$  //$NON-NLS-1$
		"commit: 0": "commit: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"parent: 0": "parent: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"authored by 0 (1) on 2": "authored by ${0} <${1}> on ${2}", //$NON-NLS-0$  //$NON-NLS-1$
		"committed by 0 (1)": "committed by ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
		"committedby": "committed by ", //$NON-NLS-0$  //$NON-NLS-1$
		"authoredby": "authored by ", //$NON-NLS-0$  //$NON-NLS-1$
		"on": " on ", //$NON-NLS-0$  //$NON-NLS-1$
		"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
		"Tags:": "Tags:", //$NON-NLS-0$  //$NON-NLS-1$
		"No Tags": "No Tags", //$NON-NLS-0$  //$NON-NLS-1$
		"Diffs": "Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"WorkingDirChanges": "Working Directory Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitChanges": "Commit Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitChangesDialog": "Commit Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"more": "more ...", //$NON-NLS-0$  //$NON-NLS-1$
		"less": "less ...", //$NON-NLS-0$  //$NON-NLS-1$
		"More": "More", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreFiles" : "More Files", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreFilesProgress": "Loading more files...", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreCommits": "More commits for \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreCommitsProgress": "Loading more commits for \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreBranches": "More branches for \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreBranchesProgress": "Loading more branches for \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreTags": "More tags", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreTagsProgress": "Loading more tags...", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreStashes": "More stashes", //$NON-NLS-0$  //$NON-NLS-1$
		"MoreStashesProgress": "Loading more stashes...", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading git log...": "Loading git log...", //$NON-NLS-0$  //$NON-NLS-1$
		"local": "local", //$NON-NLS-0$  //$NON-NLS-1$
		"remote": "remote", //$NON-NLS-0$  //$NON-NLS-1$
		"View All": "View All", //$NON-NLS-0$  //$NON-NLS-1$
		"Error ${0}: ": "Error ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading ": "Loading ", //$NON-NLS-0$  //$NON-NLS-1$
		"Message": "Message", //$NON-NLS-0$  //$NON-NLS-1$
		"Author": "Author", //$NON-NLS-0$  //$NON-NLS-1$
		"Date": "Date", //$NON-NLS-0$  //$NON-NLS-1$
		"fromDate:": "Start Date:", //$NON-NLS-0$  //$NON-NLS-1$
		"toDate:": "End Date:", //$NON-NLS-0$  //$NON-NLS-1$
		"Actions": "Actions", //$NON-NLS-0$  //$NON-NLS-1$
		"Branches": "Branches", //$NON-NLS-0$  //$NON-NLS-1$
		"Tags": "Tags", //$NON-NLS-0$  //$NON-NLS-1$
		"Stage": "Stage", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaged removal": "Unstaged removal", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstage": "Unstage", //$NON-NLS-0$  //$NON-NLS-1$
		"Staged removal": "Staged removal", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaged change": "Unstaged change", //$NON-NLS-0$  //$NON-NLS-1$
		"Staged change": "Staged change", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaged add": "Unstaged add", //$NON-NLS-0$  //$NON-NLS-1$
		"Staged add": "Staged add", //$NON-NLS-0$  //$NON-NLS-1$
		"Addition": "Addition", //$NON-NLS-0$  //$NON-NLS-1$
		"Deletion": "Deletion", //$NON-NLS-0$  //$NON-NLS-1$
		"Resolve Conflict": "Resolve Conflict", //$NON-NLS-0$  //$NON-NLS-1$
		"Conflicting": "Conflicting", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit message": "Commit message", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit": "Commit", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitTooltip": "Commit the selected files with the given message.", //$NON-NLS-0$  //$NON-NLS-1$
		"AuthMsgLink":"Authentication required for: ${0}. <a target=\"_blank\" href=\"${1}\">${2}</a> and re-try the request. </span>", //$NON-NLS-0$  //$NON-NLS-1$
		"SmartCommit": "Enter the commit message", //$NON-NLS-0$  //$NON-NLS-1$
		"SmartCountCommit": "Commit ${0} file(s)", //$NON-NLS-0$  //$NON-NLS-1$
		"Amend last commit": "Amend last commit", //$NON-NLS-0$  //$NON-NLS-1$
		" Amend": " Amend", //$NON-NLS-0$  //$NON-NLS-1$
		"Rebase in progress. Choose action:": "Rebase in progress. Choose action:", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseProgress": "Rebase in progress", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseTip": "Rebase your commits by removing them from the active branch, starting the active branch again based on the latest state of \"${0}\" and applying each commit again to the updated active branch.", //$NON-NLS-0$  //$NON-NLS-1$
		"RebasingRepo": "Rebasing git repository", //$NON-NLS-0$  //$NON-NLS-1$
		"AddingConfig": "Adding git configuration property: key=${0} value=${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"EditingConfig": "Editing git configuration property: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"DeletingConfig": "Deleting git configuration property: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"AddClone": "Cloning repository: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseProgressDetails": "Rebasing branch.\n\n\tUse Continue after merging the conflicts and selecting all files;\n\tSkip to bypass the current patch;\n\tAbort to end the rebase at any time.", //$NON-NLS-0$  //$NON-NLS-1$
		"Committer name:": "Committer name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Name:": "Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"email:": "email:", //$NON-NLS-0$  //$NON-NLS-1$
		"Email:": "Email:", //$NON-NLS-0$  //$NON-NLS-1$
		"Author name: ": "Author name: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaged": "Unstaged", //$NON-NLS-0$  //$NON-NLS-1$
		"Staged": "Staged", //$NON-NLS-0$  //$NON-NLS-1$
		"ChangedFiles": "Changed Files", //$NON-NLS-0$  //$NON-NLS-1$
		"Recent commits on": "Recent commits on", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Status": "Git Status", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to Git Status": "Open the Git Status page for the repository containing this file or folder.", //$NON-NLS-0$  //$NON-NLS-1$
		"GetGitIncomingMsg": "Getting git incoming changes...", //$NON-NLS-0$  //$NON-NLS-1$
		"Checkout": "Checkout", //$NON-NLS-0$  //$NON-NLS-1$
		"Checking out...": "Checking out...", //$NON-NLS-0$  //$NON-NLS-1$
		"Stage the change": "Stage the change", //$NON-NLS-0$  //$NON-NLS-1$
		"Staging...": "Staging...", //$NON-NLS-0$  //$NON-NLS-1$
		"CheckoutSelectedFiles": "Checkout all the selected files, discarding all changes", //$NON-NLS-0$  //$NON-NLS-1$
		"AddFilesToGitignore" : "Add all the selected files to .gitignore file(s)", //$NON-NLS-0$  //$NON-NLS-1$
		"Writing .gitignore rules" : "Writing .gitignore rules", //$NON-NLS-0$  //$NON-NLS-1$ 
		"Save Patch": "Save Patch", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstage the change": "Unstage the change", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaging...": "Unstaging...", //$NON-NLS-0$  //$NON-NLS-1$
		"Undo": "Undo", //$NON-NLS-0$  //$NON-NLS-1$
		"UndoTooltip": "Revert this commit, keeping all changed files and not making any changes to the working directory.", //$NON-NLS-0$  //$NON-NLS-1$
		"UndoConfirm": "The content of your active branch will be replaced with commit \"${0}\". All changes in the commit and working directory will be kept. Are you sure?", //$NON-NLS-0$  //$NON-NLS-1$
		"Reset": "Reset", //$NON-NLS-0$  //$NON-NLS-1$
		"ResetConfirm": "All unstaged and staged changes in the working directory and index will be discarded and cannot be recovered.\n\nAre you sure you want to continue?", //$NON-NLS-0$  //$NON-NLS-1$
		"CheckoutConfirm" : "Your changes to the selected files will be discarded and cannot be recovered.\n\nAre you sure you want to continue?", //$NON-NLS-0$  //$NON-NLS-1$
		"ResetBranchDiscardChanges": "Reset the branch, discarding all staged and unstaged changes", //$NON-NLS-0$  //$NON-NLS-1$
		"ChangesIndexDiscardedMsg": "All unstaged and staged changes in the working directory and index will be discarded and cannot be recovered.", //$NON-NLS-0$  //$NON-NLS-1$
		"ContinueMsg": "Are you sure you want to continue?", //$NON-NLS-0$  //$NON-NLS-1$
		"KeepWorkDir" : "Keep Working Directory", //$NON-NLS-0$  //$NON-NLS-1$
		"Resetting local changes...": "Resetting local changes...", //$NON-NLS-0$  //$NON-NLS-1$
		"Continue rebase...": "Continue rebase...", //$NON-NLS-0$  //$NON-NLS-1$
		"Skipping patch...": "Skipping patch...", //$NON-NLS-0$  //$NON-NLS-1$
		"Aborting rebase...": "Aborting rebase...", //$NON-NLS-0$  //$NON-NLS-1$
		"Complete log": "Complete log", //$NON-NLS-0$  //$NON-NLS-1$
		"local VS index": "local VS index", //$NON-NLS-0$  //$NON-NLS-1$
		"index VS HEAD": "index VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
		"Compare(${0} : ${1})": "Compare(${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading status...": "Loading status...", //$NON-NLS-0$  //$NON-NLS-1$
		"Committing...": "Committing...", //$NON-NLS-0$  //$NON-NLS-1$
		"The author name is required.": "The author name is required.", //$NON-NLS-0$  //$NON-NLS-1$
		"The author mail is required.": "The author mail is required.", //$NON-NLS-0$  //$NON-NLS-1$
		"RepoConflict": ". Repository still contains conflicts.", //$NON-NLS-0$  //$NON-NLS-1$
		"RepoUnmergedPathResolveConflict": ". Repository contains unmerged paths. Resolve conflicts first.", //$NON-NLS-0$  //$NON-NLS-1$
		"Rendering ${0}": "Rendering ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Configuration": "Configuration", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting configuration of": "Getting configuration of ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting git repository details": "Getting git repository details", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting changes": "Getting changes", //$NON-NLS-0$  //$NON-NLS-1$
		" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
		"Repositories - Git": "Repositories - Git", //$NON-NLS-0$  //$NON-NLS-1$
		"Repository": "Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Repository Not Found": "Repository Not Found", //$NON-NLS-0$  //$NON-NLS-1$
		"No Repositories": "No Repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading repository": "Loading repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading repositories": "Loading repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"(no remote)": "(no remote)", //$NON-NLS-0$  //$NON-NLS-1$
		"location: ": "location: ", //$NON-NLS-0$  //$NON-NLS-1$
		"NumFilesStageAndCommit": "${0} file(s) to stage and ${1} file(s) to commit.", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Nothing to commit.": "Nothing to commit.", //$NON-NLS-0$  //$NON-NLS-1$
		"Nothing to push.": "Nothing to push.", //$NON-NLS-0$  //$NON-NLS-1$
		"NCommitsToPush": "${0} commit(s) to push.", //$NON-NLS-0$  //$NON-NLS-1$
		"You have no changes to commit.": "You have no changes to commit.", //$NON-NLS-0$  //$NON-NLS-1$
		"Rebase in progress!": "Rebase in progress!", //$NON-NLS-0$  //$NON-NLS-1$
		"View all local and remote tracking branches": "View all local and remote tracking branches", //$NON-NLS-0$  //$NON-NLS-1$
		"tracksNoBranch": "tracks no branch", //$NON-NLS-0$  //$NON-NLS-1$
		"tracks": "tracks ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"last modified ${0} by ${1}": "last modified ${0} by ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"No Remote Branches": "No Remote Branches", //$NON-NLS-0$  //$NON-NLS-1$
		"Rendering branches": "Rendering branches", //$NON-NLS-0$  //$NON-NLS-1$
		"Commits": "Commits", //$NON-NLS-0$  //$NON-NLS-1$
		"GettingCurrentBranch": "Getting current branch for ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"See Full Log": "See Full Log", //$NON-NLS-0$  //$NON-NLS-1$
		"See the full log": "See the full log", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting commits for \"${0}\" branch": "Getting commits for \"${0}\" branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Rendering commits": "Rendering commits", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting outgoing commits": "Getting outgoing commits", //$NON-NLS-0$  //$NON-NLS-1$
		"The branch is up to date.": "The branch is up to date.", //$NON-NLS-0$  //$NON-NLS-1$
		"NoOutgoingIncomingCommits": "You have no outgoing or incoming commits.", //$NON-NLS-0$  //$NON-NLS-1$
	 	") by ": ") by ", //$NON-NLS-0$  //$NON-NLS-1$
		" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting tags": "Getting tags", //$NON-NLS-0$  //$NON-NLS-1$
		"View all tags": "View all tags", //$NON-NLS-0$  //$NON-NLS-1$
		" on ": " on ", //$NON-NLS-0$  //$NON-NLS-1$
		" by ": " by ", //$NON-NLS-0$  //$NON-NLS-1$
		"Remotes": "Remotes", //$NON-NLS-0$  //$NON-NLS-1$
		"Rendering remotes": "Rendering remotes", //$NON-NLS-0$  //$NON-NLS-1$
		"No Remotes": "No Remotes", //$NON-NLS-0$  //$NON-NLS-1$
		"Unstaged addition": "Unstaged addition", //$NON-NLS-0$  //$NON-NLS-1$
		"Staged addition": "Staged addition", //$NON-NLS-0$  //$NON-NLS-1$
		" (Rebase in Progress)": " (Rebase in Progress)", //$NON-NLS-0$  //$NON-NLS-1$
		"Status": "Status", //$NON-NLS-0$  //$NON-NLS-1$
		"Log (0)": "Log (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Log (0) - 1": "Log (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"Status for ${0} - Git ": "Status for ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
		"No Unstaged Changes": "No Unstaged Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"No Staged Changes": "No Staged Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"Changes for \"${0}\" branch": "Changes for ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Commits for \"${0}\" branch": "Commits for ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Commits for \"${0}\" branch against": "Commits for \"${0}\" branch against", //$NON-NLS-0$  //$NON-NLS-1$
		"Add Remote": "Add Remote", //$NON-NLS-0$  //$NON-NLS-1$
		"Remote Name:": "Remote Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Remote URI:": "Remote URI:", //$NON-NLS-0$  //$NON-NLS-1$
		"Apply Patch": "Apply Patch", //$NON-NLS-0$  //$NON-NLS-1$
		"ApplyPatchDialog": "Apply Patch", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Repository": "Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to the git repository": "Open the Git Repository page for this file or folder.", //$NON-NLS-0$  //$NON-NLS-1$
		"Clone Git Repository": "Clone Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"CloneGitRepositoryDialog": "Clone Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Repository URL:": "Repository URL:", //$NON-NLS-0$  //$NON-NLS-1$
		"Existing directory:": "Existing directory:", //$NON-NLS-0$  //$NON-NLS-1$
		"New folder:": "New folder:", //$NON-NLS-0$  //$NON-NLS-1$
		"ChooseFolderDialog": "Choose a Folder", //$NON-NLS-0$  //$NON-NLS-1$
		"Message:": "Message:", //$NON-NLS-0$  //$NON-NLS-1$
		"Amend:": "Amend:", //$NON-NLS-0$  //$NON-NLS-1$
		"SmartAmend": "Amend previous commit", //$NON-NLS-0$  //$NON-NLS-1$
		"ChangeId:": "ChangeId:", //$NON-NLS-0$  //$NON-NLS-1$
		"SmartChangeId": "Add Change-ID to message", //$NON-NLS-0$  //$NON-NLS-1$
		"Committer Name:": "Committer Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Committer Email:": "Committer Email:", //$NON-NLS-0$  //$NON-NLS-1$
		"AuthorNamePlaceholder": "Enter author name", //$NON-NLS-0$  //$NON-NLS-1$
		"AuthorEmailPlaceholder": "Enter author email", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitterNamePlaceholder": "Enter committer name", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitterEmailPlaceholder": "Enter committer email", //$NON-NLS-0$  //$NON-NLS-1$
		"Author Name:": "Author Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Author Email:": "Author Email:", //$NON-NLS-0$  //$NON-NLS-1$
		"The commit message is required.": "The commit message is required.", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Credentials": "Git Credentials", //$NON-NLS-0$  //$NON-NLS-1$
		"Username:": "Username:", //$NON-NLS-0$  //$NON-NLS-1$
		"Private key:": "Private key:", //$NON-NLS-0$  //$NON-NLS-1$
		"Passphrase (optional):": "Passphrase (optional):", //$NON-NLS-0$  //$NON-NLS-1$
		"commit:": "commit: ", //$NON-NLS-0$  //$NON-NLS-1$
		"parent:": "parent: ", //$NON-NLS-0$  //$NON-NLS-1$
		"branches: ": "branches: ", //$NON-NLS-0$  //$NON-NLS-1$
		"tags: ": "tags: ", //$NON-NLS-0$  //$NON-NLS-1$
		"tags": "tags", //$NON-NLS-0$  //$NON-NLS-1$
		" authored by ${0} {${1}) on ${2}": " authored by ${0} (${1}) on ${2}", //$NON-NLS-0$  //$NON-NLS-1$
		"Content": "Content", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to ${0} section": "Go to ${0} section", //$NON-NLS-0$  //$NON-NLS-1$
		"Type the commit name (sha1):": "Type the commit name (sha1):", //$NON-NLS-0$  //$NON-NLS-1$
		"Search": "Search", //$NON-NLS-0$  //$NON-NLS-1$
		"Searching...": "Searching...", //$NON-NLS-0$  //$NON-NLS-1$
		"SelectAll": "Select All", //$NON-NLS-0$  //$NON-NLS-1$
		"Looking for the commit": "Looking for the commit", //$NON-NLS-0$  //$NON-NLS-1$
		"New Branch:": "New Branch:", //$NON-NLS-0$  //$NON-NLS-1$
		"No remote selected": "No remote selected", //$NON-NLS-0$  //$NON-NLS-1$
		"Enter a name...": "Enter a name...", //$NON-NLS-0$  //$NON-NLS-1$
		"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
		"Cancel": "Cancel", //$NON-NLS-0$  //$NON-NLS-1$
		"Clear": "Clear", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter": "Filter", //$NON-NLS-0$  //$NON-NLS-1$
		"FilterCommits": "Filter Commits", //$NON-NLS-0$  //$NON-NLS-1$
		"FilterCommitsTip": "Toggles the filter commits panel", //$NON-NLS-0$  //$NON-NLS-1$
		"MaximizeCmd": "Maximize", //$NON-NLS-0$  //$NON-NLS-1$
		"MaximizeTip": "Toggles the maximize state of the editor", //$NON-NLS-0$  //$NON-NLS-1$
		" [New branch]": " [New branch]", //$NON-NLS-0$  //$NON-NLS-1$
		"AddKeyToHostContinueOp": "Would you like to add ${0} key for host ${1} to continue operation? Key fingerpt is ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Link Repository": "Link Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Folder name:": "Folder name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Repository was linked to ": "Repository was linked to ", //$NON-NLS-0$  //$NON-NLS-1$
		"CheckoutCommitTooltip": "Checkout this commit, creating a local branch based on its contents.", //$NON-NLS-0$  //$NON-NLS-1$
		"CheckoutTagTooltip": "Checkout this tag, creating a local branch based on its contents.", //$NON-NLS-0$  //$NON-NLS-1$
		"Checking out ${0}": "Checking out ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"CheckoutBranchMsg": "Checkout the branch or corresponding local branch and make it active. If the remote tracking branch does not have a corresponding local branch, the local branch will be created first.", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Checking out branch...": "Checking out branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Adding branch ${0}...": "Adding branch ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Removing branch ${0}...": "Removing branch ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Adding remote ${0}...": "Adding remote ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Removing remote ${0}...": "Removing remote ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Removing repository ${0}": "Removing repository ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Adding tag {$0}": "Adding tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Removing tag {$0}": "Removing tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Merging ${0}": "Merging ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		'Unstaging changes' : 'Unstaging changes', //$NON-NLS-0$  //$NON-NLS-1$
		"Checking out branch ${0}...": "Checking out branch ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Branch checked out.": "Branch checked out.", //$NON-NLS-0$  //$NON-NLS-1$
		"New Branch": "New Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Add a new local branch to the repository": "Add a new local branch to the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Branch name": "Branch name", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete": "Delete", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the local branch from the repository": "Delete the local branch from the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"DelBrConfirm": "Are you sure you want to delete branch ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the remote tracking branch from the repository": "Delete the remote tracking branch from the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Are you sure?": "Are you sure?", //$NON-NLS-0$  //$NON-NLS-1$
		"RemoveRemoteBranchConfirm": "You're going to delete remote branch \"${0}\" and push the change.\n\nAre you sure?", //$NON-NLS-0$  //$NON-NLS-1$
		"Removing remote branch: ": "Removing remote branch: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete Remote Branch": "Delete Remote Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"New Remote": "New Remote", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Remote": "Git Remote", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to Git Remote": "Open the remote Git Log page for this file or folder.", //$NON-NLS-0$  //$NON-NLS-1$
		"Add a new remote to the repository": "Add a new remote to the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the remote from the repository": "Delete the remote from the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Are you sure you want to delete remote ${0}?": "Are you sure you want to delete remote ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
		"Pull": "Pull", //$NON-NLS-0$  //$NON-NLS-1$
		"Pull from the repository": "Pull from the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Pulling: ": "Pulling: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Pull Git Repository": "Pull Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Log": "Git Log", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to Git Log": "Open the local Git Log page for this file or folder.", //$NON-NLS-0$  //$NON-NLS-1$
		"Open the log for the branch": "Open the log for the branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Open the log for the repository": "Open the log for the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Open the status for the repository": "Open the status for the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowInEditor": "Show in Editor", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowInEditorTooltip": "Show the repository folder in the editor", //$NON-NLS-0$  //$NON-NLS-1$
		"CompareEach": "Compare With Each Other", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Compare With Working Tree": "Compare With Working Tree", //$NON-NLS-0$  //$NON-NLS-1$
		"Open": "Open", //$NON-NLS-0$  //$NON-NLS-1$
		"OpenGitCommitTip": "View the tree for this commit", //$NON-NLS-0$  //$NON-NLS-1$
		"OpenCommitVersion": "Open Commit", //$NON-NLS-0$  //$NON-NLS-1$
		"ViewCommitVersionTip": "View the committed version of the file", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetch": "Fetch", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetch from the remote": "Fetch from the remote", //$NON-NLS-0$  //$NON-NLS-1$
		"Password:": "Password:", //$NON-NLS-0$  //$NON-NLS-1$
		"User Name:": "User Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetching remote: ": "Fetching remote: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Force Fetch": "Force Fetch", //$NON-NLS-0$  //$NON-NLS-1$
		"FetchRemoteBranch": "Fetch from the remote branch into your remote tracking branch overriding its current content", //$NON-NLS-0$  //$NON-NLS-1$
		"OverrideContentRemoteTrackingBr": "You're going to override content of the remote tracking branch. This can cause the branch to lose commits.", //$NON-NLS-0$  //$NON-NLS-1$
		"Merge": "Merge", //$NON-NLS-0$  //$NON-NLS-1$
		"MergeContentFrmBr": "Merge the content from the branch to your active branch", //$NON-NLS-0$  //$NON-NLS-1$
	 	". Go to ${0}.": ". Go to ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
		"Git Status page": "Git Status page", //$NON-NLS-0$  //$NON-NLS-1$
		"Rebase": "Rebase", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseCommitsMsg": "Rebase your commits by removing them from the active branch, starting the active branch again based on the latest state of the selected branch ", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Rebase on top of ": "Rebase on top of ", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseSTOPPED": ". Some conflicts occurred. Please resolve them and continue, skip patch or abort rebasing.", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseFAILED_WRONG_REPOSITORY_STATE": ". Repository state is invalid (i.e. already during rebasing).", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseFAILED_UNMERGED_PATHS": ". Repository contains unmerged paths.", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseFAILED_PENDING_CHANGES": ". Repository contains pending changes. Please commit or stash them.", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseUNCOMMITTED_CHANGES": ". There are uncommitted changes.", //$NON-NLS-0$  //$NON-NLS-1$
		"RebaseCommitsByRmvingThem": "Rebase your commits by removing them from the active branch, ", //$NON-NLS-0$  //$NON-NLS-1$
		"StartActiveBranch": "starting the active branch again based on the latest state of '", //$NON-NLS-0$  //$NON-NLS-1$
		"ApplyEachCommitAgain": "and applying each commit again to the updated active branch.", //$NON-NLS-0$  //$NON-NLS-1$
		"Push All": "Push All", //$NON-NLS-0$  //$NON-NLS-1$
		"PushCommitsTagsFrmLocal": "Push commits and tags from your local branch into the remote branch", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Push Branch": "Push Branch", //$NON-NLS-0$  //$NON-NLS-1$
	 	"PushResult": "Push Result:", //$NON-NLS-0$  //$NON-NLS-1$
	 	"PushCommitsWithoutTags": "Push commits without tags from your local branch into the remote branch", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Push for Review": "Push for Review", //$NON-NLS-0$  //$NON-NLS-1$
		"Push commits to Gerrit Code Review": "Push commits to Gerrit Code Review", //$NON-NLS-0$  //$NON-NLS-1$
		"Force Push Branch": "Force Push Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"PushCommitsWithoutTagsOverridingCurrentContent": "Push commits without tags from your local branch into the remote branch overriding its current content", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Pushing remote: ": "Pushing remote: ", //$NON-NLS-0$  //$NON-NLS-1$
		"ChooseBranchDialog": "Choose Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Choose the remote branch.": "Choose the remote branch.", //$NON-NLS-0$  //$NON-NLS-1$
		"Force Push All": "Force Push All", //$NON-NLS-0$  //$NON-NLS-1$
		"PushCommitsTagsFrmLocalBr": "Push commits and tags from your local branch into the remote branch overriding its current content", //$NON-NLS-0$  //$NON-NLS-1$
		"OverrideContentOfRemoteBr": "You're going to override content of the remote branch. This can cause the remote repository to lose commits.", //$NON-NLS-0$  //$NON-NLS-1$
		"< Previous Page": "< Previous Page", //$NON-NLS-0$  //$NON-NLS-1$
		"Show previous page of git log": "Show previous page of git log", //$NON-NLS-0$  //$NON-NLS-1$
		"Show previous page of git tags" : "Show previous page of git tags", //$NON-NLS-0$  //$NON-NLS-1$
		"Next Page >": "Next Page >", //$NON-NLS-0$  //$NON-NLS-1$
		"Show next page of git log": "Show next page of git log", //$NON-NLS-0$  //$NON-NLS-1$
		"Show next page of git tags" : "Show next page of git tags", //$NON-NLS-0$  //$NON-NLS-1$
		"Push from your local branch into the selected remote branch": "Push from your local branch into the selected remote branch", //$NON-NLS-0$  //$NON-NLS-1$
		"ResetActiveBr": "Reset your active branch to the state of this reference. Discard all staged and unstaged changes.", //$NON-NLS-0$  //$NON-NLS-1$
	 	"GitResetIndexConfirm": "The content of your active branch will be replaced with commit \"${0}\". All unstaged and staged changes will be discarded and cannot be recovered if \"${1}\" is not checked. Are you sure?", //$NON-NLS-0$  //$NON-NLS-1$
		"Resetting index...": "Resetting index...", //$NON-NLS-0$  //$NON-NLS-1$
		"Resetting git index for ${0}" : "Resetting git index for ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Tag": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
		"Create a tag for the commit": "Create a tag for the commit", //$NON-NLS-0$  //$NON-NLS-1$
		"ProjectSetup": "Your project is being set up. This may take a minute...", //$NON-NLS-0$  //$NON-NLS-1$
		"LookingForProject": "Looking for project: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Tag name": "Tag name", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the tag from the repository": "Delete the tag from the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Are you sure you want to delete tag ${0}?": "Are you sure you want to delete tag ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
		"Cherry-Pick": "Cherry-Pick", //$NON-NLS-0$  //$NON-NLS-1$
		"CherryPicking": "Cherry Picking commit: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"RevertingCommit": "Reverting commit: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Apply the change introduced by the commit to your active branch": "Apply the change introduced by the commit to your active branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Nothing changed.": "Nothing changed.", //$NON-NLS-0$  //$NON-NLS-1$
		". Some conflicts occurred": ". Some conflicts occurred.", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetch from the remote branch into your remote tracking branch": "Fetch from the remote branch into your remote tracking branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetch Git Repository": "Fetch Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Push": "Push", //$NON-NLS-0$  //$NON-NLS-1$
		"Push from your local branch into the remote branch": "Push from your local branch into the remote branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Push Git Repository": "Push Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Key:": "Key:", //$NON-NLS-0$  //$NON-NLS-1$
		"Value:": "Value:", //$NON-NLS-0$  //$NON-NLS-1$
		"New Configuration Entry": "New Configuration Entry", //$NON-NLS-0$  //$NON-NLS-1$
		"Edit": "Edit", //$NON-NLS-0$  //$NON-NLS-1$
		"Edit the configuration entry": "Edit the configuration entry", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the configuration entry": "Delete the configuration entry", //$NON-NLS-0$  //$NON-NLS-1$
		"Are you sure you want to delete ${0}?": "Are you sure you want to delete ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
		"Clone Repository": "Clone Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Clone an existing Git repository to a folder": "Clone an existing Git repository to a folder", //$NON-NLS-0$  //$NON-NLS-1$
		"Cloning repository: ": "Cloning repository: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Init Repository": "Init Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Create a new Git repository in a new folder": "Create a new Git repository in a new folder", //$NON-NLS-0$  //$NON-NLS-1$
		"Initializing repository: ": "Initializing repository: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Init Git Repository": "Init Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Delete the repository": "Delete the repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Are you sure you want do delete ${0} repositories?": "Are you sure you want do delete ${0} repositories?", //$NON-NLS-0$  //$NON-NLS-1$
		"Apply a patch on the selected repository": "Apply a patch on the selected repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Show content": "Show content", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit name:": "Commit name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Open Commit": "Open Commit", //$NON-NLS-0$  //$NON-NLS-1$
		"OpenCommitDialog": "Open Commit", //$NON-NLS-0$  //$NON-NLS-1$
		"Open the commit with the given name": "Open the commit with the given name", //$NON-NLS-0$  //$NON-NLS-1$
		"No commits found": "No commits found", //$NON-NLS-0$  //$NON-NLS-1$
		"Staging changes": "Staging changes", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit message:": "Commit message:", //$NON-NLS-0$  //$NON-NLS-1$
		"Committing changes": "Committing changes", //$NON-NLS-0$  //$NON-NLS-1$
		"Fetching previous commit message": "Fetching previous commit message", //$NON-NLS-0$  //$NON-NLS-1$
		"Resetting local changes": "Resetting local changes", //$NON-NLS-0$  //$NON-NLS-1$
		"Checkout files, discarding all changes": "Checkout files, discarding all changes", //$NON-NLS-0$  //$NON-NLS-1$
		"Show Patch": "Show Patch", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading default workspace": "Loading default workspace", //$NON-NLS-0$  //$NON-NLS-1$
		"Show workspace changes as a patch": "Show workspace changes as a patch", //$NON-NLS-0$  //$NON-NLS-1$
		"Show checked changes as a patch": "Show checked changes as a patch", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowCommitPatchTip": "Show patch for changes in this commit", //$NON-NLS-0$  //$NON-NLS-1$
		"Continue": "Continue", //$NON-NLS-0$  //$NON-NLS-1$
		"Contibue Rebase": "Continue Rebase", //$NON-NLS-0$  //$NON-NLS-1$
		"Skip Patch": "Skip Patch", //$NON-NLS-0$  //$NON-NLS-1$
		"Abort": "Abort", //$NON-NLS-0$  //$NON-NLS-1$
		"Abort Rebase": "Abort Rebase", //$NON-NLS-0$  //$NON-NLS-1$
		"Discard": "Discard", //$NON-NLS-0$  //$NON-NLS-1$
		"Ignore": "Ignore", //$NON-NLS-0$  //$NON-NLS-1$
		"ChangesSelectedFilesDiscard": "Your changes to the selected files will be discarded and cannot be recovered.", //$NON-NLS-0$  //$NON-NLS-1$
	 	"Getting git log": "Getting git log", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting stashed changes...": "Getting stashed changes...", //$NON-NLS-0$  //$NON-NLS-1$
		"Active Branch (${0})": "Active Branch (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Branch (${0})": "Branch (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Tag (${0})": "Tag (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit (${0})": "Commit (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"StashCommit (${0})": "Stash (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"WIPStash": "WIP on ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"IndexStash": "index on ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"RemoteTrackingBranch (${0})": "Remote Branch (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Active Branch Log": "Git Log (Active Branch)", //$NON-NLS-0$  //$NON-NLS-1$
		"Show the log for the active local branch": "Show the log for the active local branch", //$NON-NLS-0$  //$NON-NLS-1$
		"Remote Branch Log": "Git Log (Remote Branch)", //$NON-NLS-0$  //$NON-NLS-1$
		"Show the log for the corresponding remote tracking branch": "Show the log for the corresponding remote tracking branch", //$NON-NLS-0$  //$NON-NLS-1$
		"See Full Status" : "See Full Status", //$NON-NLS-0$  //$NON-NLS-1$
		"See the status" : "See the status", //$NON-NLS-0$  //$NON-NLS-1$
		"Choose target location" : "Choose target location", //$NON-NLS-0$  //$NON-NLS-1$
		"Default target location" : "Default target location", //$NON-NLS-0$  //$NON-NLS-1$
		"Change..." : "Change...", //$NON-NLS-0$  //$NON-NLS-1$
		"Merge Squash": "Merge Squash", //$NON-NLS-0$  //$NON-NLS-1$
		"Squash the content of the branch to the index" : "Squash the content of the branch to the index", //$NON-NLS-0$  //$NON-NLS-1$
		"Local Branch Name:" : "Local Branch Name:", //$NON-NLS-0$  //$NON-NLS-1$
		"Local": "local", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter items" : "Filter items", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter filter" : "Filter message", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter author" : "Filter author", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter committer" : "Filter commiter", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter sha1" : "Filter sha1", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter fromDate" : "Filter from date YYYY-MM-DD or 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter toDate" : "Filter to date YYYY-MM-DD or 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter path" : "Filter path", //$NON-NLS-0$  //$NON-NLS-1$
		"Filter remote branches" : "Filter remote branches", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting remote branches" : "Getting remote branches ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting remote details": "Getting remote details: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"PatchApplied": "Patch applied successfully", //$NON-NLS-0$  //$NON-NLS-1$
		"PatchFailed": "Apply patch failed. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Getting branches" : "Getting branches ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Paste link in email or IM" : "Paste link in email or IM", //$NON-NLS-0$  //$NON-NLS-1$
		"Show Commit in GitHub" : "Show Commit in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
		"Show Repository in GitHub" : "Show Repository in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
		"Show this commit in GitHub": "Show this commit in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
		"Show Commit in eclipse.org": "Show Commit in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
		"Show this commit in eclipse.org" : "Show this commit in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
		"Show Repository in eclipse.org":"Show Repository in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
		"Show this repository in eclipse.org":"Show this repository in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
		"Ask for review" : "Ask for review", //$NON-NLS-0$  //$NON-NLS-1$
		"Ask for review tooltip" : "Send email with request for commit review", //$NON-NLS-0$  //$NON-NLS-1$
		"Reviewer name" : "Reviewer name", //$NON-NLS-0$  //$NON-NLS-1$
		"Contribution Review Request" : "Contribution Review Request", //$NON-NLS-0$  //$NON-NLS-1$
		"Send the link to the reviewer" : "Send the link to the reviewer", //$NON-NLS-0$  //$NON-NLS-1$
		"Private key file (optional):" : "Private key file (optional):", //$NON-NLS-0$  //$NON-NLS-1$
		"Don't prompt me again:" : "Don't prompt me again:", //$NON-NLS-0$  //$NON-NLS-1$
		"Your private key will be saved in the browser for further use" : "Your private key will be saved in the browser for further use", //$NON-NLS-0$  //$NON-NLS-1$
		"Loading Contribution Review Request..." : "Loading Contribution Review Request...", //$NON-NLS-0$  //$NON-NLS-1$
		"The commit can be found in the following repositories" : "The commit can be found in the following repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"Try to update your repositories" : "Try to update your repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"Create new repository" : "Create new repository", //$NON-NLS-0$  //$NON-NLS-1$
		"Attach the remote to one of your existing repositories" : "Attach the remote to one of your existing repositories", //$NON-NLS-0$  //$NON-NLS-1$
		"You are reviewing contribution ${0} from ${1}" : "You are reviewing contribution ${0} from ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitNotFoundInWorkspace" : "Unfortunately the commit can not be found in your workspace. To see it try one of the following: ", //$NON-NLS-0$  //$NON-NLS-1$
	 	"To review the commit you can also:" : "To review the commit you can also:", //$NON-NLS-0$  //$NON-NLS-1$
		"Contribution Review Request for ${0} on ${1}" : "Contribution Review Request for ${0} on ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"Failing paths: ${0}": "Failing paths: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
		"Problem while performing the action": "Problem while performing the action", //$NON-NLS-0$  //$NON-NLS-1$
		"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.", //$NON-NLS-0$  //$NON-NLS-1$
		"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
		"File:": "File:", //$NON-NLS-0$  //$NON-NLS-1$
		"Submit": "Submit", //$NON-NLS-0$  //$NON-NLS-1$
		"git url:": "git url: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Revert": "Revert", //$NON-NLS-0$  //$NON-NLS-1$
		"Revert changes introduced by the commit into your active branch": "Revert changes introduced by the commit into your active branch", //$NON-NLS-0$  //$NON-NLS-1$
		". Could not revert into active branch": ". Could not revert into active branch.", //$NON-NLS-0$  //$NON-NLS-1$
		"Login": "Login", //$NON-NLS-0$  //$NON-NLS-1$
		"Authentication required for: ${0}. ${1} and re-try the request.": "Authentication required for: ${0}. ${1} and re-try the request.", //$NON-NLS-0$  //$NON-NLS-1$
		"Save":"Save", //$NON-NLS-0$  //$NON-NLS-1$
		"Remember my committer name and email:":"Remember my committer name and email:", //$NON-NLS-0$  //$NON-NLS-1$
		"Successfully edited ${0} to have value ${1}":"Successfully edited ${0} to have value ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"Successfully added ${0} with value ${1}":"Successfully added ${0} with value ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"Signed-off-by: ":"Signed-off-by: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Change-Id: ":"Change-Id: ", //$NON-NLS-0$  //$NON-NLS-1$
		"Push_REJECTED_NONFASTFORWARD":"Push is non-fastforward and was rejected. Use Fetch to see new commits that must be merged.", //$NON-NLS-0$  //$NON-NLS-1$
		"Commit and Push" : "Commit and Push", //$NON-NLS-0$  //$NON-NLS-1$
		"Sync" : "Sync", //$NON-NLS-0$  //$NON-NLS-1$
		"SyncTooltip" : "Fetch from the remote branch. Rebase your commits by removing them from the local branch, starting the local branch again based on the latest state of the remote branch and applying each commit to the updated local branch. Push commits and tags from your local branch into the remote branch.", //$NON-NLS-0$  //$NON-NLS-1$
		"NoCommits" : "No Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"NoContent" : "No Content", //$NON-NLS-0$  //$NON-NLS-1$
		"Incoming" : "Incoming", //$NON-NLS-0$  //$NON-NLS-1$
		"Outgoing" : "Outgoing", //$NON-NLS-0$  //$NON-NLS-1$
		"IncomingWithCount" : "Incoming (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"OutgoingWithCount" : "Outgoing (${0})", //$NON-NLS-0$  //$NON-NLS-1$
		"Synchronized" : "History", //$NON-NLS-0$  //$NON-NLS-1$
		"Uncommited" : "Uncommited", //$NON-NLS-0$  //$NON-NLS-1$
		"Repository:" : "Repository:", //$NON-NLS-0$  //$NON-NLS-1$
		"Reference:" : "Reference:", //$NON-NLS-0$  //$NON-NLS-1$
		"Author:" : "Author:", //$NON-NLS-0$  //$NON-NLS-1$
		"Committer:" : "Committer:", //$NON-NLS-0$  //$NON-NLS-1$
		"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowActiveBranchCmd" : "Show Active Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowReferenceCmd": "Show Reference", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowReferenceTip": "View the history of ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
		"ShowActiveBranchTip": "View the history of \"${0}\" relative to ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitType": "commit", //$NON-NLS-0$  //$NON-NLS-1$
		"BranchType": "branch", //$NON-NLS-0$  //$NON-NLS-1$
		"RemoteTrackingBranchType": "remote branch", //$NON-NLS-0$  //$NON-NLS-1$
		"TagType": "tag", //$NON-NLS-0$  //$NON-NLS-1$
		"StashCommitType": "stash", //$NON-NLS-0$  //$NON-NLS-1$
		"Path:" : "Path:", //$NON-NLS-0$  //$NON-NLS-1$
		"LocalChanges" : "Working Directory Changes", //$NON-NLS-0$  //$NON-NLS-1$
		"LocalChangesDetails" : "Working Directory Details", //$NON-NLS-0$  //$NON-NLS-1$
		"CompareChanges" : "Compare (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
		"NoBranch" : "No Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"NoActiveBranch" : "No Active Branch", //$NON-NLS-0$  //$NON-NLS-1$
		"NoRef" : "No Selected Reference", //$NON-NLS-0$  //$NON-NLS-1$
		"None": "None", //$NON-NLS-0$  //$NON-NLS-1$
		"FileSelected": "${0} file selected", //$NON-NLS-0$  //$NON-NLS-1$
		"FilesSelected": "${0} files selected", //$NON-NLS-0$  //$NON-NLS-1$
		"FileChanged": "${0} file changed", //$NON-NLS-0$  //$NON-NLS-1$
		"FilesChanged": "${0} files changed", //$NON-NLS-0$  //$NON-NLS-1$
		"file": "file", //$NON-NLS-0$  //$NON-NLS-1$
		"files": "files", //$NON-NLS-0$  //$NON-NLS-1$
		"EmptyCommitConfirm": "You have no files selected. If you continue, you will end up with an empty commit. Do you want to continue?", //$NON-NLS-0$  //$NON-NLS-1$
		"AlwaysSelectFiles": "Always select changed files (see Git Preferences)", //$NON-NLS-0$  //$NON-NLS-1$
		"EmptyCommitWarning": "The commit is empty", //$NON-NLS-0$  //$NON-NLS-1$
		"FilesChangedVsReadyToCommit": "${0} ${1} changed. ${2} ${3} ready to commit.", //$NON-NLS-0$  //$NON-NLS-1$
		"CommitPush": "Commit and Push", //$NON-NLS-0$  //$NON-NLS-1$
		"Commits and pushes files to the default remote": "Commits and pushes files to the default remote", //$NON-NLS-0$  //$NON-NLS-1$
		"Stash" : "Stash", //$NON-NLS-0$  //$NON-NLS-1$
		"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
		"Stash all current changes away" : "Stash all current changes away", //$NON-NLS-0$  //$NON-NLS-1$
		"Drop" : "Drop", //$NON-NLS-0$  //$NON-NLS-1$
		"Drop the commit from the stash list" : "Drop the commit from the stash list", //$NON-NLS-0$  //$NON-NLS-1$
		"Apply" : "Apply", //$NON-NLS-0$  //$NON-NLS-1$
		"Pop Stash" : "Pop Stash", //$NON-NLS-0$  //$NON-NLS-1$
		"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Apply the most recently stashed change to your active branch and drop it from the stashes", //$NON-NLS-0$  //$NON-NLS-1$
		"stashes" : "stashes", //$NON-NLS-0$  //$NON-NLS-1$
		'addDependencyName': "Git Repository", //$NON-NLS-0$  //$NON-NLS-1$
		'addDependencyTooltip': "Associate a git repository with this project.",  //$NON-NLS-0$  //$NON-NLS-1$
		'addProjectName': "Git Repository",  //$NON-NLS-0$  //$NON-NLS-1$
		'addProjectTooltip': "Create a project from a git repository.",  //$NON-NLS-0$  //$NON-NLS-1$
		'fetchGroup': 'Fetch',  //$NON-NLS-0$  //$NON-NLS-1$
		'pushGroup' : 'Push',  //$NON-NLS-0$  //$NON-NLS-1$
		'Url:' : 'Url:', //$NON-NLS-0$  //$NON-NLS-1$
		'Ssh Private Key:' : 'Ssh Private Key:', //$NON-NLS-0$  //$NON-NLS-1$
		'Ssh Passphrase:' : 'Ssh Passphrase:', //$NON-NLS-0$  //$NON-NLS-1$
		'confirmUnsavedChanges': 'There are unsaved changes. Do you want to save them?', //$NON-NLS-1$ //$NON-NLS-0$
		'NewConfigurationEntryTooltip': "Add a new entry to the repository configuration" //$NON-NLS-1$ //$NON-NLS-0$
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/ja/gitmessages',{
	"Compare": "比較", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "並列比較の表示", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "作業ディレクトリーを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "作業ディレクトリー", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "ファイルの作業ディレクトリーのバージョンを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "ロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "すべての Git リポジトリー", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "リポジトリー", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} (${1} 上) - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "eclipse.org で表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "GitHub で表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "GitHub でこのリポジトリーを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "詳細をコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "コミットなし", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "コミット: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "親: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "作成者: ${0} <${1}> 日時: ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "コミット担当者: ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "コミット担当者 ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "作成者", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " 作成日: ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "タグ:", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "タグなし", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "変更", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "作業ディレクトリーの変更", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "変更のコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "変更のコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "詳細...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "簡略...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "その他", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "追加のファイル", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "追加のファイルをロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "\"${0}\" の追加のコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "\"${0}\" の追加のコミットをロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "\"${0}\" の追加のブランチ", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "\"${0}\" の追加のブランチをロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "追加のタグ", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "追加のタグをロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "追加のスタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "追加のスタッシュをロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "git ログのロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "ローカル", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "リモート", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "すべて表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "エラー ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "ロード中 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "メッセージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "作成者", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "日付", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "開始日:", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "終了日:", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "アクション", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "ブランチ", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "タグ", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "ステージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "未ステージの削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "ステージ解除", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "ステージ済み削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "未ステージの変更", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "ステージ済み変更", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "未ステージの追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "ステージ済み追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "競合の解決", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "競合", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "コミット・メッセージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "コミット", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "指定されたメッセージを選択されたファイルに付けてコミットします。", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"${0} の認証が必要です。<a target=\"_blank\" href=\"${1}\">${2}</a> の後、要求を再試行してください。</span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "コミット・メッセージを入力", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "${0} ファイルをコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "最後のコミットの修正", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " 修正", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "リベース進行中。 アクションを選択してください:", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "リベース進行中", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "アクティブ・ブランチからコミットを削除し、「${0}」の最新の状態に基づいてアクティブ・ブランチを再開してから、各コミットを更新済みのアクティブ・ブランチに再び適用することによって、コミットをリベースします。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Git リポジトリーのリベース", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Git 構成プロパティーの追加: キー=${0} 値=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Git　構成プロパティーの編集: キー=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Git 構成プロパティーの削除: キー=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "リポジトリーのクローン作成: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "ブランチのリベース進行中。\n\n\t競合をマージし、すべてのファイルを選択して続行してください。\n\t現在のパッチをバイパスするにはスキップを選択します。\n\t中断を選択すると、いつでもリベースを終了できます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "コミット担当者名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "名前:", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "E メール:", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "E メール: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "作成者名: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "未ステージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "ステージ済み", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "変更されたファイル", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "最近のコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Git 状況", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "このファイルまたはフォルダーを含むリポジトリーの Git 状況ページを開きます。", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "git 着信変更の取得...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "チェックアウト", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "チェックアウト中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "変更をステージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "ステージング...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "選択した全ファイルをチェックアウト (変更はすべて破棄)", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "選択されたすべてのファイルを .gitignore ファイルに追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : ".gitignore 規則を書き込み中", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "パッチの保存", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "変更をステージ解除", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "ステージ解除中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "元に戻す", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "このコミットを元に戻し、変更されたすべてのファイルを保持し、作業ディレクトリーには変更を加えません。", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "アクティブ・ブランチのコンテンツがコミット「${0}」に置換されます。コミットに含まれるすべての変更と作業ディレクトリーは保持されます。実行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "リセット", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "作業ディレクトリーおよび索引に含まれる未ステージとステージ済みのすべての変更は破棄され、復旧できません。\n\n続行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "選択したファイルに加えた変更は破棄され、復旧できません。\n\n続行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "ブランチをリセット (ステージ済み変更と未ステージの変更をすべて破棄)", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "作業ディレクトリーおよび索引に含まれる未ステージとステージ済みのすべての変更は破棄され、復旧できません。", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "続行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "作業ディレクトリーを保持", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "ローカル変更のリセット中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "リベースの続行...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "パッチをスキップ中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "リベースを中断中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "ログ完了", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "ローカル VS 索引", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "索引 VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "比較 (${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "状況のロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "コミット中...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "作成者の名前が必要です。", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "作成者のメールが必要です。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". リポジトリーにまだ競合が含まれています。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". リポジトリーに、アンマージされているパスが含まれています。 最初に競合を解決してください。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "${0} のレンダリング", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "構成", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "${0} の構成の取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Git リポジトリー詳細の取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "変更の取得中", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "リポジトリー - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "リポジトリー", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "リポジトリーが見つかりません", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "リポジトリーがありません", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "リポジトリーのロード中", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "リポジトリーのロード中", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(リモートなし)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "ロケーション: ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "ステージするファイル: ${0} 個、コミットするファイル: ${1} 個", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "コミットするものがありません。", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "プッシュするものがありません。", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "プッシュするコミット ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "コミットする変更はありません。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "リベース進行中", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "ローカルおよびリモートのトラッキング・ブランチのすべてを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "トラックするブランチなし", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "トラック ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "最終変更日時 ${0} (変更者 ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "リモート・ブランチなし", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "ブランチのレンダリング", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "コミット", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "${0} の現在のブランチの取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "ログ全体を参照", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "ログ全体を参照", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "\"${0}\" ブランチのコミット取得", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "コミットのレンダリング", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "発信コミットの取得", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "ブランチは最新です。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "発信コミットも着信コミットもありません。", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") by ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "タグ取得", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "全タグの表示", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " 作成日: ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " 条件: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "リモート", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "リモートのレンダリング", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "リモートなし", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "未ステージの追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "ステージ済み追加", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " (リベース進行中)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "状況", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "ログ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "ログ (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "${0} の状況 - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "未ステージの変更なし", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "ステージ済みの変更なし", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "${0} の変更", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "${0} のコミット", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "\"${0}\" ブランチのコミットと比較:", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "リモートの追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "リモート名", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "リモートの URI:", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "パッチの適用", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "パッチの適用", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Git リポジトリー", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "このファイルまたはフォルダーの Git リポジトリー・ページを開きます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Git リポジトリーのクローン", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Git リポジトリーのクローン", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "リポジトリー URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "既存のディレクトリー:", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "新規フォルダー:", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "フォルダーの選択", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "メッセージ:", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "修正:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "前のコミットの修正", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "変更 ID:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "メッセージへの変更 ID の追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "コミット担当者名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "コミット担当者の E メール:", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "作成者名の入力", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "作成者の E メールの入力", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "コミッターの名前の入力", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "コミッターの E メールの入力", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "作成者名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "作成者の E メール:", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "コミット・メッセージが必要です。", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Git 資格情報", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "ユーザー名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "秘密鍵:", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "パスフレーズ (オプション):", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "コミット: ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "親: ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "ブランチ: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "タグ: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "タグ", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " 作成者: ${0} (${1}) (日時: ${2})", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "コンテンツ", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "${0} セクションにジャンプ", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "コミットの名前を入力 (sha1):", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "検索", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "検索中...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "すべて選択", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "コミットを検索中", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "新規ブランチ:", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "リモートが選択されていません", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "名前の入力...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "キャンセル", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "クリア", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "フィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "コミットのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "「コミットのフィルター」パネルを切り替えます", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "最大化", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "エディターの状態の最大化を切り替えます", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [新規ブランチ]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "ホスト ${1} の ${0} キーを追加して操作を続行しますか? キー fingerpt は ${2} です。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "リポジトリーのリンク", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "フォルダー名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "リポジトリーのリンク先 ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "このコミットをチェックアウトし、そのコンテンツに基づいてローカル・ブランチを作成します。", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "このタグをチェックアウトし、そのコンテンツに基づいてローカル・ブランチを作成します。", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "${0} をチェックアウト中", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "ブランチまたは対応するローカル・ブランチをチェックアウトして、それをアクティブにします。 リモート・トラッキング・ブランチに対応するローカル・ブランチがない場合、まずローカル・ブランチが作成されます。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "ブランチのチェックアウト中", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "ブランチ ${0} の追加中", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "ブランチ ${0} の削除中", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "リモート ${0} の追加中", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "リモート ${0} の削除中", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "リポジトリー ${0} の削除中", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "タグ {$0} の追加中", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "タグ {$0} の削除中", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "${0} のマージ中", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : '変更のステージ解除中', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "ブランチ ${0} のチェックアウト中", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "ブランチがチェックアウトされました。", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "新規ブランチ", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "新規ローカル・ブランチをリポジトリーに追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "ブランチ名", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "リポジトリーからローカル・ブランチを削除", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "ブランチ ${0} を削除しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "リポジトリーからリモート・トラッキング・ブランチを削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "実行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "リモート・ブランチ「${0}」を削除し、変更をプッシュしようとしています。\n\n続行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "リモート・ブランチの削除中: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "リモート・ブランチの削除", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "新規リモート", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Git リモート", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "このファイルまたはフォルダーのリモート Git ログ・ページを開きます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "リポジトリーに新規リモートを追加", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "リポジトリーからリモートを削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "リモート ${0} を削除しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "プル", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "リポジトリーからプル", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "プル中 : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Git リポジトリーのプル", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Git ログ", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "このファイルまたはフォルダーのローカル Git ログ・ページを開きます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "ブランチのログを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "リポジトリーのログを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "リポジトリーの状況を開く", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "エディターに表示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "リポジトリー・フォルダーをエディターに表示", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "相互比較", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "作業ツリーでの比較", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "開く", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "コミットのツリーを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "コミットを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "ファイルのコミット済みバージョンを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "フェッチ", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "リモートからフェッチ", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "パスワード:", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "ユーザー名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "リモートからフェッチ中: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "強制フェッチ", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "リモート・ブランチからフェッチして、リモート・トラッキング・ブランチに入れ、現在のコンテンツをオーバーライド", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "リモート・トラッキング・ブランチのコンテンツをオーバーライドしようとしています。 ブランチでコミットが失われることがあります。", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "マージ", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "ブランチのコンテンツをアクティブ・ブランチにマージ", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". ${0} にジャンプ", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Git 状況ページ", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "リベース", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "アクティブ・ブランチから削除することによりリベースをコミットし、選択されたブランチの最後の状態に基づいて、アクティブのブランチを再開 ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "追加でリベース ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". 何らかの競合が発生しました。 それらを解決してから、続行、またはパッチをスキップ、またはリベースを打ち切ってください。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". リポジトリー状態が無効です (既にリベース中です)。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". リポジトリーに、アンマージされているパスが含まれています。 ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". リポジトリーに保留中の変更が含まれています。 それらをコミットまたは隠しておいてください。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". コミットされていない変更があります。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "アクティブ・ブランチから削除することによりコミットをリベースし、 ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "の最新の状態に基づいてアクティブ・ブランチを再開し、", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "更新されたアクティブ・ブランチに各コミットを再適用します。", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "すべてプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "コミットとタグを、ローカル・ブランチからリモート・ブランチにプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "ブランチをプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "プッシュの結果:", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "コミットをタグなしで、ローカル・ブランチからリモート・ブランチにプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "レビュー用にプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Gerrit コード・レビューにコミットをプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "ブランチを強制プッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "ローカル・ブランチからリモート・ブランチにコミットをタグなしでプッシュし、現在のコンテンツをオーバーライド", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "リモートをプッシュ中: ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "ブランチの選択", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "リモート・ブランチを選択します。", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "すべて強制プッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "ローカル・ブランチからリモート・ブランチにコミットとタグをプッシュし、現在のコンテンツをオーバーライド", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "リモート・ブランチのコンテンツをオーバーライドしようとしています。 リモート・リポジトリーでコミットが失われることがあります。", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< 前ページ", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "git ログの前ページを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "git タグの前ページを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "次ページ >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "git ログの次ページを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "git タグの次ページを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "ローカル・ブランチから、選択したリモート・ブランチにプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "アクティブ・ブランチを、この参照の状態にリセットします。ステージ済みおよび未ステージのすべての変更を破棄します。", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "アクティブ・ブランチのコンテンツがコミット「${0}」に置換されます。未ステージとステージ済みのすべての変更は破棄され、「${1}」がチェックされていなければ復旧できません。実行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "索引のリセット中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "${0} の Git 索引のリセット中", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "タグ", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "コミットのタグを作成", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "ご使用のプロジェクトはセットアップ中です。これには少し時間がかかることがあります...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "プロジェクトの検索中: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "タグ名", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "リポジトリーからタグを削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "タグ ${0} を削除しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "チェリー・ピック", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "チェリー・ピックのコミット: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "コミットを元に戻しています: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "コミットによる変更をアクティブ・ブランチに適用", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "変更なし。", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". 何らかの競合が発生しました。 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "リモート・ブランチからフェッチして、リモート・トラッキング・ブランチに入れる", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Git リポジトリーのフェッチ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "プッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "ローカル・ブランチからリモート・ブランチにプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Git リポジトリーのプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "キー:", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "値:", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "新しい構成エントリー", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "編集", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "構成エントリーの編集", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "構成エントリーの削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "${0} を削除しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "リポジトリーのクローン", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "既存の Git リポジトリーのクローンをフォルダーに作成", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "リポジトリーのクローン作成 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "リポジトリーの初期化", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "新しい Git リポジトリーを新しいフォルダー中に作成", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "リポジトリーの初期化 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Git リポジトリーの初期化", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "リポジトリーの削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "${0} リポジトリーを削除しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "選択したリポジトリーにパッチを適用", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "コンテンツの表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "コミットの名前:", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "コミットを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "コミットを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "指定した名前のコミットを開く", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "コミットが見つかりません", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "変更のステージング", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "コミット・メッセージ:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "変更のコミット中", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "前のコミット・メッセージを取り出し中", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "ローカル変更のリセット中", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "ファイルのチェックアウト (変更をすべて破棄)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "パッチの表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "デフォルトのワークスペースをロード中", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "ワークスペースの変更をパッチとして表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "チェックされた変更をパッチとして表示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "コミットの変更パッチを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "続行", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "リベースの続行", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "パッチをスキップ", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "中断", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "リベースを打ち切る", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "破棄", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "無視", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "選択したファイルに加えた変更は破棄され、復旧できません。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Git ログの取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "スタッシュ変更の取得中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "アクティブ・ブランチ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "ブランチ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "タグ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "コミット (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "スタッシュ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "${0} 上の WIP: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "${0} 上の索引: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "リモート・ブランチ (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Git ログ (アクティブ・ブランチ)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "アクティブ・ローカル・ブランチのログを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Git ログ (リモート・ブランチ)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "対応するリモート・トラッキング・ブランチのログを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "状況全体を参照", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "状況を参照", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "ターゲット・ロケーションを選択", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "デフォルト・ターゲット・ロケーション", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "変更...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "squash 指定でマージ", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "ブランチのコンテンツをインデックスへ squash", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "ローカル・ブランチ名:", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "ローカル", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "項目のフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "メッセージのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "作成者のフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "コミッターのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "sha1 のフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "日付 YYYY-MM-DD または 1(h d w m y) からのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "日付 YYYY-MM-DD または 1(h d w m y) までのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "パスのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "リモート・ブランチのフィルター", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "リモート・ブランチ ${0} の取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "リモートの詳細の取得中: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "パッチの適用に成功 しました", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "パッチの適用に失敗しました。${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "ブランチ ${0} の取得中", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "E メールまたは IM にリンクを貼り付ける", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "GitHub でコミットを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "GitHub でリポジトリーを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "GitHub でこのコミットを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "eclipse.org でコミットを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "eclipse.org でこのコミットを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"eclipse.org でリポジトリーを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"eclipse.org でこのリポジトリーを表示", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "レビュー依頼", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "コミットのレビュー依頼の E メールを送信", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "レビュー担当者名", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "コントリビューション・レビューの要求", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "レビュー担当者にリンクを送信", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "秘密鍵ファイル (オプション):", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "今後プロンプトを表示しない:", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "以降の使用のために秘密鍵はブラウザーに保存されます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "コントリビューション・レビュー要求をロード中...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "コミットは以下のリポジトリーで見つけることができます", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "リポジトリーの更新を試行してください", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "新規リポジトリーの作成", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "既存のリポジトリーのいずれかにリモートを接続します", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "コントリビューション ${0} から ${1} をレビューしています", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "残念ながらコミットはワークスペースで見つかりませんでした。それを表示するには、以下のいずれかを試行してください。", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "以下の方法でもコミットをレビューすることができます。", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "${1} の ${0} についてのコントリビューション・レビューの要求", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "障害のあるパス: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "操作の実行中に問題が生じました", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Orion リポジトリー・ページに移動して、git リポジトリーの URL を指定します。リポジトリーが作成されると、ナビゲーターに表示されます。", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "ファイル:", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "実行依頼", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "git URL: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "前回の状態に戻す", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "コミットによる変更をアクティブ・ブランチに戻す", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". アクティブ・ブランチに戻せませんでした。", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "ログイン", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "${0} の認証が必要です。${1} の後、要求を再試行してください。", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"保存", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"コミット担当者名と E メールを記憶:", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"${0} は正常に編集されました。値は ${1} です。", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"${0} は正常に追加されました。値は ${1} です。", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"サインオフ: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"変更 ID: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"プッシュは non-fastforward であり、リジェクトされました。マージが必要な新しいコミットを確認するには、フェッチを使用してください。", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "コミットしてプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "同期化", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "リモート・ブランチからフェッチします。ローカル・ブランチから削除することによりリベースをコミットし、リモート・ブランチの最後の状態に基づいてローカル・ブランチを再開し、更新されたローカル・ブランチに各コミットを適用します。コミットとタグをローカル・ブランチからリモート・ブランチにプッシュします。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "変更なし", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "コンテンツなし", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "着信", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "発信", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "着信 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "発信 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "履歴", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "未コミット", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "リポジトリー:", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "参照:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "作成者: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "コミッター:", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "アクティブ・ブランチの表示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "参照の表示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "${1}「${2}」の履歴の表示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "${1}「${2}」に関連する「${0}」の履歴の表示", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "commit", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "ブランチ", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "リモート・ブランチ", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "タグ", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "スタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "パス:", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "作業ディレクトリーの変更", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "作業ディレクトリーの詳細", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "比較 (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "ブランチなし", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "アクティブ・ブランチなし", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "選択参照なし", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "なし", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} ファイルが選択されました", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} ファイルが選択されました", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} ファイルは変更されました", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} ファイルは変更されました", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "ファイル", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "ファイル", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "ファイルが選択されていません。実行しますか?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "コミットは空です", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} を変更しました。${2} ${3} のコミット準備ができました。", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "コミットしてプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "ファイルをデフォルトのリモートにコミットしてプッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "スタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "現在のすべての変更内容をスタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "スタッシュ・リストからコミットを削除", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "適用", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "ポップ・スタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "スタッシュに退避済みの最新の変更をアクティブ・ブランチに適用して、スタッシュから削除 ", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "スタッシュ", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Git リポジトリー", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Git リポジトリーとこのプロジェクトを関連付けます。",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Git リポジトリー",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Git リポジトリーからプロジェクトを作成します。",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'フェッチ',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'プッシュ',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'URL:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'SSH 秘密鍵:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'SSH パスフレーズ:', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '保存されていない変更があります。 保存しますか?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/zh/gitmessages',{
	"Compare": "比较", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "查看并排比较", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "打开工作目录", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "工作目录", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "查看文件的工作目录版本", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "正在装入...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "所有 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${1} 上的 ${0} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "在 eclipse.org 中显示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "在 GitHub 中显示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "在 GitHub 中显示此存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "落实详细信息", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "无落实", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "落实：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "父代：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "由 ${0} <${1}> 在 ${2} 进行了编辑", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "由 ${0} <${1}> 落实", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "落实者", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "编辑者", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " 打开", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "标记：", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "无标记", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "更改", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "工作目录更改", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "落实更改", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "落实更改", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "更多...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "更少...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "更多", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "更多文件", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "正在装入更多文件...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "“${0}”的更多落实", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "正在为“${0}”装入更多落实...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "“${0}”的更多分支", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "正在为“${0}”装入更多分支...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "更多标记", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "正在装入更多标记...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "更多隐藏项", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "正在装入更多隐藏项...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "正在装入 Git 日志...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "本地", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "远程", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "全部查看", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "错误 ${0}：", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "正在装入", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "消息", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "作者", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "日期", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "开始日期：", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "结束日期：", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "操作", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "标记", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "未登台的除去", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "未登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "已登台的除去", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "未登台的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "已登台的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "未登台的添加", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "已登台的添加", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "添加", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "删除", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "解决冲突", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "冲突", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "落实消息", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "落实", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "落实所选择的文件并提供所给定的消息。", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"需要对 ${0} 进行认证。<a target=\"_blank\" href=\"${1}\">${2}</a>，然后重试该请求。</span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "输入落实消息", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "落实 ${0} 文件", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "修改上次的落实", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " 修改", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "正在重定基底。选择操作：", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "正在重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "通过从活动分支中除去落实，然后根据“${0}”的最新状态来再次启动该活动分支，并将每个落实再次应用于已更新的活动分支，从而对落实重定基底。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "正在对 Git 存储库重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "正在添加 Git 配置属性：键=${0}，值=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "正在编辑 Git 配置属性：键=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "正在删除 Git 配置属性：键=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "正在克隆存储库：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "正在为分支重定基底。\n\n\t合并冲突并选择所有文件之后使用“继续”；\n\t跳过以忽略当前补丁；\n\t异常终止以随时结束重定基底。", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "落实者名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "电子邮件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "电子邮件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "作者名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "未登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "已登台", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "已更改的文件", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "最近落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Git 状态", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "对包含此文件或文件夹的存储库打开“Git 状态”页面。", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "正在获取 Git 传入更改...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "检出", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "正在检出...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "将更改登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "正在登台...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "检出所选择的所有文件，并废弃所有更改", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "将所选择的所有文件添加至 .gitignore 文件", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "正在编写 .gitignore 规则", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "保存补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "取消将更改登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "正在取消登台...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "撤销", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "还原此落实，保留已更改的所有文件，对工作目录不进行任何更改。", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "活动分支的内容将替换为落实“${0}”。将保留在落实和工作目录中进行的所有更改。您确定吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "重置", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "工作目录和索引中所有未登台和已登台的更改都将被废弃，并且无法恢复。\n\n确定要继续吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "您对所选文件所作的更改将被废弃，并且无法恢复。\n\n确定要继续吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "重置分支，并废弃所有已登台和未登台的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "工作目录和索引中所有未登台和已登台的更改都将被废弃，并且无法恢复。", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "确定要继续吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "保留工作目录", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "正在重置本地更改...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "继续重定基底...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "正在跳过补丁...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "正在退出重定基底...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "完整日志", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "本地 VS 索引", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "索引 VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "比较（${0}：${1}）", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "正在装入状态...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "正在落实... ", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "作者名是必需的。", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "作者邮件是必需的。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". 存储库仍然包含冲突。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". 存储库包含未合并的路径。请首先解决冲突。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "正在呈示 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "配置", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "正在获取 ${0} 的配置", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "正在获取 Git 存储库详细信息", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "正在获取更改", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "存储库 - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "找不到存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "无存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "正在装入存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "正在装入存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "（无远程分支）", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "位置：", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} 个文件要登台，${1} 个文件要落实。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "没有要落实的内容", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "没有要推送的内容。", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} 个落实需要推送。", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "您没有要落实的更改。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "正在重定基底！", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "查看所有本地跟踪分支和远程跟踪分支", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "不跟踪分支", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "跟踪 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "由 ${1} 最近一次修改 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "没有远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "呈示分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "落实数", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "正在获取 ${0} 的当前分支", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "查看完整日志", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "查看完整的日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "正在获取“${0}”分支的落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "正在呈示落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "正在获取传出落实", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "最新的分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "您没有任何传出或传入落实。", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": "）由", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "获取标记", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "查看所有标记", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " 打开", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " 为 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "正在呈示远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "无远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "未登台的添加", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "已登台的添加", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " （正在重定基底）", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "状态", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "日志 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "日志 (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "${0} 的状态 - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "没有未登台的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "没有已登台的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "${0} 的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "${0} 的落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "“${0}”分支的落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "添加远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "远程对象名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "远程 URI：", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "应用补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "应用补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "为此文件或文件夹打开“Git 存储库”页面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "克隆 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "克隆 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "存储库 URL：", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "现有目录：", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "新建文件夹：", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "选择文件夹", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "消息：", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "修改：", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "修改先前的落实", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "更改标识：", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "将更改标识添加到消息", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "落实者名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "落实者电子邮件：", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "输入作者名称", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "输入作者电子邮件", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "输入落实者名称", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "输入落实者电子邮件", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "作者名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "作者电子邮件：", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "落实消息是必需的。", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Git 凭证", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "用户名：", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "专用密钥：", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "口令（可选）：", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "落实：", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "父代：", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "分支：", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "标记：", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "标记", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " 由 ${0} (${1}) 在 ${2} 进行了编辑", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "内容", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "转至 ${0} 部分", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "输入落实名称 (sha1)：", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "搜索", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "正在搜索...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "全选", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "正在查找落实...", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "新建分支：", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "未选择远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "请输入名称...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "确定", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "取消", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "清除", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "过滤", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "过滤落实", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "切换过滤落实面板", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "最大化", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "切换编辑器的最大化状态", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [新建分支]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "要为主机 ${1} 添加 ${0} 以继续执行操作吗？密钥手指模板为 ${2}。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "链接存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "文件夹名：", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "存储库已链接至", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "检出此落实，并根据其内容创建本地分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "检出此标记，并根据其内容创建本地分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "正在检出 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "检出该分支或者相应的本地分支并使其处于活动状态。如果远程跟踪分支不具备相应的本地分支，那么首先将创建本地分支。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "正在检出分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "正在添加分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "正在除去分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "正在添加远程 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "正在除去远程 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "正在除去存储库 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "正在添加标记 {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "正在除去标记 {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "正在合并 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : '正在取消将更改登台', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "正在检出分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "已检出分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "新建分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "将新的本地分支添加到存储库中", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "分支名称", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "删除", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "从存储库中删除本地分支", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "确定要删除分支 ${0} 吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "从存储库中删除远程跟踪分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "您确定吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "您将删除远程分支“${0}”并推送更改。\n\n您确定吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "正在除去远程分支：", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "删除远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "新建远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Git 远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "为此文件或文件夹打开远程“Git 日志”页面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "将新的远程对象添加到存储库中", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "从存储库中删除远程对象", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "确定要删除远程对象 ${0} 吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "拉取", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "从存储库中拉取", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "正在拉取：", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "拉取 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Git 日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "为此文件或文件夹打开本地“Git 日志”页面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "打开分支的日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "打开存储库的日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "打开存储库的状态", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "在编辑器中显示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "在编辑器中显示存储库文件夹", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "互相比较", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "与工作树比较", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "打开", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "查看此落实的树", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "打开落实", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "查看已落实版本的文件", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "访存", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "从远程对象访存", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "密码：", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "用户名：", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "正在访存远程对象：", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "强制访存", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "从远程分支访存到远程跟踪分支中并覆盖其当前内容", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "您将覆盖远程跟踪分支的内容。这可能会导致该分支失去落实。", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "合并", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "将该分支的内容合并到活动分支中", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". 转至 ${0}。", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "“Git 状态”页面", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "通过从活动分支中除去落实，然后根据所选分支的最新状态来再次启动此活动分支，从而对落实重定基底", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "基于以下对象重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". 发生了一些冲突。请解决这些冲突之后继续，跳过补丁或者异常终止重定基底。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". 存储库状态无效（即，已经在重定基底）。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". 存储库包含未合并的路径。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". 存储库中包含暂挂的更改。请落实或隐藏这些更改。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". 存在未落实的更改。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "通过从活动分支中除去落实，", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "然后根据所选分支的最新状态来再次启动此活动分支，", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "并对更新后的活动分支再次应用每个落实，从而对落实重定基底。", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "全部推送", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "将落实和标记从本地分支推送到远程分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "推送分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "推送结果：", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "将没有标记的落实从本地分支推送到远程分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "推送以复审", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "推送落实以进行 Gerrit 代码复审", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "强制推送分支", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "将没有标记的落实从本地分支推送到推送到远程分支并覆盖其当前内容", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "正在推送远程对象：", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "选择分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "请选择远程分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "强制全部推送", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "将落实和标记从本地分支推送到远程分支并覆盖其当前内容", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "您将覆盖远程分支的内容。这可能会导致该远程存储库丢失落实项。", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< 上一页", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "显示 Git 日志的上一页", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "显示 Git 标记的上一页", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "下一页 >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "显示 Git 日志的下一页", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "显示 Git 标记的下一页", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "从本地分支推送到所选择的远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "将活动分支复位为此引用的状态。废弃所有已登台的更改和未登台的更改。", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "活动分支的内容将替换为落实“${0}”。如果未选中“${1}”，那么所有未登台和已登台的更改都将被废弃，并且无法恢复。您确定吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "正在重置索引...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "正在为 ${0} 重置 Git 索引", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "标记", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "为落实创建标记", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "正在设置项目。这可能需要一分钟的时间...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "正在查找项目：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "标记名称", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "从存储库中删除此标记", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "确定要删除标记 ${0} 吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "选出最佳项目", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "选出最佳项目落实：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "还原落实：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "对活动分支应用由落实引入的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "未进行任何更改。", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". 发生了一些冲突。", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "从远程分支访存到远程跟踪分支中", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "访存 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "从本地分支推送到远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "推送 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "键：", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "值：", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "新建配置条目", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "编辑", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "编辑配置条目", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "删除配置条目", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "确定要删除${0}吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "克隆存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "将现有 Git 存储库克隆到文件夹中", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "正在克隆存储库：", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "初始化存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "在新的文件夹中创建新的 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "正在初始化存储库：", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "初始化 Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "删除存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "确定要删除 ${0} 存储库吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "对所选择的存储库应用补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "显示内容", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "落实名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "打开落实", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "打开落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "打开具有所给定名称的落实", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "找不到任何落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "正在将更改登台", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "落实消息：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "正在落实更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "正在访存先前落实消息", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "正在重置本地更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "检出文件，并废弃所有更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "显示补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "正在装入缺省工作空间", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "将工作空间更改作为补丁显示", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "将已检查的更改作为补丁显示", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "显示此落实中对更改的补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "继续", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "继续重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "跳过补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "放弃", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "异常终止重定基底", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "废弃", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "忽略", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "您对所选文件所作的更改将被废弃，并且无法恢复。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "正在获取 Git 日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "正在获取隐藏的更改...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "活动分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "标记 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "落实 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "隐藏项 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "${0} 上的 WIP：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "${0} 上的索引：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "远程分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Git 日志（活动分支）", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "显示活动本地分支的日志", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Git 日志（远程分支）", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "显示相应的远程跟踪分支的日志", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "查看完整状态", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "查看状态", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "选择目标位置", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "缺省目标位置", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "更改...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "合并压缩", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "将分支的内容压缩到索引", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "本地分支名称：", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "本地", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "过滤项目", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "过滤消息", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "过滤作者", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "过滤落实者", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "过滤 sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "过滤起始日期 YYYY-MM-DD 或 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "过滤终止日期 YYYY-MM-DD 或 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "过滤路径", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "过滤远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "正在获取远程分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "正在获取远程详细信息：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "已成功应用补丁", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "应用补丁失败。${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "正在获取分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "在电子邮件或 IM 中粘贴链接", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "在 GitHub 中显示落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "在 GitHub 中显示存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "在 GitHub 中显示此落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "在 eclipse.org 中显示落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "在 eclipse.org 中显示此落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"在 eclipse.org 中显示存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"在 eclipse.org 中显示此存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "请求复审", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "发送电子邮件请求落实复审", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "复审者名称", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "添加复审请求", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "将链接发送到复审者", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "专用密钥文件（可选）：", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "不要再次提示我：", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "您的专用密钥将保存在浏览器中以备后用", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "正在装入添加项复审请求...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "可以在下列存储库中找到该落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "尝试更新存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "创建新的存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "将远程对象附加到现有的其中一个存储库", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "您正在复查来自 ${1} 的添加项 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "很遗憾，在工作空间中找不到该落实。要进行查看，请尝试执行下列其中一项操作：", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "要复查该落实，您还可以：", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "对 ${1} 上的 ${0} 添加复查请求", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "失败路径：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "执行该操作时发生问题", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "转至“Orion 存储库”页面以提供 Git 存储库 URL。一旦创建了存储库，它就会出现在导航器中。", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL：", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "文件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "提交", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "GIT URL：", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "还原", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "对活动分支还原由落实引入的更改", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". 未能还原到活动分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "登录", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "需要对 ${0} 进行认证。${1}，然后重试该请求。", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"保存", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"请记住我的落实者名称和电子邮件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"已成功编辑 ${0}，使其具有值 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"为 ${0} 成功添加了值 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"注销者：", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"更改标识：", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"推送非快进，并且已被拒绝。使用“访存”来查看必须合并的新落实。", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "落实和推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "同步", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "从远程分支访存。通过从本地分支中除去落实，然后根据远程分支的最新状态来再次启动此本地分支，并将每个落实应用于已更新的本地分支，从而对落实重定基底。将落实和标记从本地分支推送到远程分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "无更改", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "无内容", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "传入", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "传出", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "传入 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "传出 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "历史记录", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "未落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "存储库：", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "引用：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "作者：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "落实者：", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1：", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "显示活动分支", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "显示引用", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "查看 ${1}“${2}”的历史记录", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "查看“${0}”中与 ${1}“${2}”相关的历史记录", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "落实", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "分支", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "远程分支", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "标记", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "隐藏", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "路径：", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "工作目录更改", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "工作目录详细信息", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "比较 (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "无分支", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "无活动分支", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "未选择引用", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "无", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "选择了 ${0} 个文件", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "选择了 ${0} 个文件", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "更改了 ${0} 文件", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "更改了 ${0} 个文件", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "文件", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "文件", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "您没有选择文件。您确定吗？", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "落实为空", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} 已更改。${2} ${3} 准备好进行落实。", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "落实和推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "落实文件并将其推送到缺省远程位置", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "隐藏", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "隐藏所有当前更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "删除", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "从隐藏列表中删除落实", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "应用", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "应用隐藏的更改", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "将最近隐藏的更改应用至活动分支，并从隐藏中删除这些项", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "隐藏", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Git 存储库", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "将 Git 存储库与此项目相关联。",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Git 存储库",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "从 Git 存储库创建项目。",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': '访存',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : '推送',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'Url：', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Ssh 专用密钥：', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Ssh 口令：', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '存在未保存的更改。要保存这些更改吗？' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/zh-tw/gitmessages',{
	"Compare": "比較", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "檢視並列比較", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "開啟工作目錄", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "工作目錄", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "檢視檔案的工作目錄版本", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "載入中...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "所有 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} 在 ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "顯示在 eclipse.org 中", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "顯示在 GitHub 中", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "在 GitHub 中顯示此儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "確定詳細資料", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "無確定", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "確定：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "母項：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "由 ${0} 撰寫 <${1}>，在 ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "由 ${0} 確定 <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "確認者 ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "作者為 ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " 於 ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "標籤：", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "無標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "變更", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "工作目錄變更", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "確定變更", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "確定變更", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "或更多 ...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "或更少 ...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "尚有", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "更多檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "正在載入更多檔案...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "\"${0}\" 的其他確定", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "正在載入 \"${0}\" 的其他確定...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "\"${0}\" 的其他分支", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "正在載入 \"${0}\" 的其他分支...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "其他標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "正在載入其他標籤...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "其他隱藏", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "正在載入其他隱藏...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "正在載入 Git 日誌...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "本端", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "檢視全部", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "錯誤 ${0}： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "正在載入 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "作者", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "日期", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "開始日期：", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "結束日期：", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "動作", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "暫置", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "未暫置移除", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "取消暫置", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "暫置移除", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "未暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "未暫置新增", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "暫置新增", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "新增", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "刪除", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "解決衝突", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "衝突", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "確定訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "確定", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "使用給定訊息來確定選取的檔案。", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"${0} 需要鑑別。<a target=\"_blank\" href=\"${1}\">${2}</a>，並重試要求。</span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "輸入確定訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "確定 ${0} 個檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "修改前次確定", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " 修改", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "重設基線進行中。選擇動作：", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "重設基線進行中", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "重設確定的基線，方法是將確定從作用中分支移除，然後根據 \"${0}\" 的最新狀態來重新啟動作用中分支，並且將每一個確定重新套用至已更新的作用中分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "重設 Git 儲存庫的基線", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "新增 Git 配置內容：key=${0} value=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "編輯 Git 配置內容：key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "刪除 Git 配置內容：key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "正在複製儲存庫：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "正在重設分支的基線。\n\n\t在合併衝突和選取所有檔案後，請使用「繼續」；\n\t使用「跳過」會忽略現行修補程式；\n\t使用「中斷」可隨時結束重設基線。", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "確認者名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "電子郵件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "電子郵件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "作者名稱： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "未暫置", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "暫置", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "已變更檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "最近確定在", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Git 狀態", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "針對含有這個檔案或資料夾的儲存庫，開啟「Git 狀態」頁面。", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "正在取得 Git 送入的變更...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "移出", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "正在移出...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "正在暫置...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "移出所有選取的檔案，捨棄所有變更", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "將所有選取的檔案新增至 .gitignore 檔", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "正在撰寫 .gitignore 規則", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "儲存修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "取消暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "正在取消暫置...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "復原", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "回復這項確定，保留所有已變更的檔案，且不對工作目錄進行任何變更。", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "作用中分支的內容將取代為確定 \"${0}\"。將保留確定及工作目錄中的所有變更。 您確定要這樣做嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "重設", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "將會捨棄工作目錄和索引中的所有未暫置和暫置變更，而且無法回復。\n\n您確定要繼續嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "將會捨棄您對所選取檔案所做的變更，而且無法回復。\n\n您確定要繼續嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "重設分支，捨棄所有暫置和未暫置的變更", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "將會捨棄工作目錄和索引中的所有未暫置和暫置變更，無法回復。", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "您確定要繼續嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "保留工作目錄", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "正在重設本端變更...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "繼續重設基線...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "正在跳過修補程式...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "正在中止重設基線...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "完整日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "本端 VS 索引", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "索引 VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "比較（${0}：${1}）", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "正在載入狀態...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "正在確定...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "需要作者名稱。", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "需要作者郵件。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". 儲存庫仍然包含衝突。", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". 儲存庫包含未合併的路徑。請先解決衝突。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "呈現 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "配置", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "正在取得 ${0} 配置", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "正在取得 git 儲存庫詳細資料", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "取得變更", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "儲存庫 - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "找不到儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "無儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "載入儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "載入儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "（無遠端）", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "位置： ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "要暫置 ${0} 個檔案，要確定 ${1} 個檔案。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "沒有可確定的項目。", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "沒有可推送的項目。", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "有 ${0} 個確定待推送。", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "您沒有可確定的變更。", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "正在重設基線！", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "檢視所有本端和遠端追蹤分支", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "不追蹤分支", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "追蹤 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "前次修改時間：${0}，修改者：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "無遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "呈現分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "確定", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "正在取得 ${0} 的現行分支", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "請參閱完整日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "請參閱完整日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "取得 \"${0}\" 分支的確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "呈現確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "取得送出的確定", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "分支已是最新。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "您沒有送出的或送入的確定。", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") 由 ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "取得標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "檢視所有標籤", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " 於 ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " 由 ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "呈現遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "無遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "未暫置新增", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "暫置新增", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " （重設基線進行中）", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "狀態", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "日誌 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "日誌 (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "${0} 的狀態 - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "無未暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "無暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "${0} 的變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "${0} 的確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "\"${0}\" 分支的確定，針對", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "新增遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "遠端名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "遠端 URI：", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "套用修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "套用修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "開啟這個檔案或資料夾的「Git 儲存庫」頁面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "複製 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "複製 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "儲存庫 URL：", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "現有的目錄：", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "新建資料夾：", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "選擇資料夾", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "訊息：", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "修改：", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "修正前一個確定", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "變更 ID：", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "新增變更 ID 至訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "確認者名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "確認者電子郵件：", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "輸入作者名稱", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "輸入作者電子郵件", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "輸入確認者名稱", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "輸入確認者電子郵件", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "作者名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "作者電子郵件：", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "需要確定訊息。", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Git 認證", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "使用者名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "私密金鑰：", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "通行詞組（選用）：", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "確定： ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "母項： ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "分支： ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "標籤： ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "標籤", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " 由 ${0} 撰寫 (${1})，在 ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "內容", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "移至 ${0} 區段", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "輸入確定名稱 (sha1)：", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "搜尋", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "搜尋中...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "全選", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "尋找確定", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "新建分支：", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "未選取遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "輸入名稱...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "取消", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "清除", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "過濾器", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "過濾確定", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "切換過濾確定畫面", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "最大化", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "切換編輯器的最大化狀態", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [新建分支]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "您要新增主機 ${1} 的 ${0} 按鍵以繼續作業嗎？按鍵 fingerpt 是 ${2}。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "鏈結儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "資料夾名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "儲存庫已鏈結至 ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "移出這項確定，根據內容建立本端分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "移出這個標籤，根據內容建立本端分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "移出 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "移出分支或對應的本端分支並設為作用中。如果遠端追蹤分支沒有對應的本端分支，將會先建立本端分支。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "正在移出分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "正在新增分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "正在移除分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "正在新增遠端 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "正在移除遠端 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "正在移除儲存庫 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "新增標籤 {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "移除標籤 {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "正在合併 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : '正在解除暫置變更', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "正在移出分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "已移出分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "新建分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "將新的本端分支新增至儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "分支名稱", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "刪除", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "從儲存庫中刪除本端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "您確定要刪除分支 ${0} 嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "從儲存庫中刪除遠端追蹤分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "您確定要這樣做嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "即將刪除遠端分支 \"${0}\" 並推送變更。\n\n您確定要這樣做嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "移除遠端分支： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "刪除遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "新建遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Git 遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "開啟這個檔案或資料夾的遠端「Git 日誌」頁面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "將新的遠端新增至儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "從儲存庫中刪除遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "您確定要刪除遠端 ${0} 嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "取出", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "從儲存庫中取出", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "取出： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "取出 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Git 日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "開啟這個檔案或資料夾的本端「Git 日誌」頁面。", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "開啟分支的日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "開啟儲存庫的日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "開啟儲存庫的狀態", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "顯示在編輯器中", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "在編輯器中顯示儲存庫資料夾", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "彼此相互比較", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "與工作樹狀結構相互比較", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "開啟", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "檢視此確定的樹狀結構", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "開啟確定", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "檢視經過確定的檔案版本", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "提取", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "從遠端提取", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "密碼：", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "使用者名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "提取遠端： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "強制提取", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "從遠端分支提取到您的遠端追蹤分支，置換現行內容", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "您將會置換遠端追蹤分支的內容。 這會造成分支遺失確定。", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "合併", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "將分支的內容合併到作用中分支", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". 移至 ${0}。", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Git 狀態頁面", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "重設基線", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "從作用中分支移除確定，以將確定重設基線，並根據所選分支的最新狀態，重新啟動作用中分支 ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "在最上層重設基線 ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". 發生一些衝突。 請解決後再繼續，跳過修補程式或中斷重設基線。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". 儲存庫狀態無效Ｉ（例如，已經處於衍合期間）。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". 儲存庫包含未合併的路徑。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". 儲存庫包含擱置變更。 請確定或隱藏它們。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". 有未確定的變更。", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "從作用中分支移除確定，以將確定重設基線， ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "根據下列項目的最新狀態，重新啟動作用中分支：'", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "並將每一個確定重新套用至更新的作用中分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "推送全部", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "從本端分支將確定和標籤推送至遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "推送分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "推送結果：", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "將確定（不包含標籤）從本端分支推送至遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "推送以便檢閱", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "推送確定以檢閱 Gerrit 程式碼", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "強制推送分支", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "將確定（不包含標籤）從本端分支推送至遠端分支，以置換其現行內容", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "推送遠端： ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "選擇分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "選擇遠端分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "強制推送全部", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "從本端分支將確定和標籤推送至遠端分支，置換其現行內容", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "您將會置換遠端分支的內容。這會造成遠端儲存庫遺失確定。", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< 上一頁", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "顯示 Git 日誌的上一頁", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "顯示上一頁 Git 標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "下一頁 >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "顯示 Git 日誌的下一頁", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "顯示下一頁 Git 標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "從本端分支推送至選取的遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "將作用中分支重設為這個參照的狀態。捨棄所有暫置和未暫置的變更。", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "作用中分支的內容將取代為確定 \"${0}\"。如果未勾選 \"${1}\"，將會捨棄所有未暫置和暫置變更，無法回復。您確定要這樣做嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "正在重設索引...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "正在重設 ${0} 的 Git 索引", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "建立確定的標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "正在設定您的專案。這可能需要一分鐘...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "正在尋找專案：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "標籤名稱", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "從儲存庫中刪除標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "您確定要刪除標籤 ${0} 嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "最佳選擇", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "挑選最佳確定：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "正在回復確定：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "將確定所引起的變更套用至作用中分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "沒有任何變更。", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". 發生一些衝突。", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "從遠端分支提取到您的遠端追蹤分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "提取 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "從本端分支推送至遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "推送 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "索引鍵：", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "值：", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "新建配置項目", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "編輯", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "編輯配置項目", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "刪除配置項目", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "您確定要刪除 ${0} 嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "複製儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "將現有的 Git 儲存庫複製到資料夾", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "複製儲存庫： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "起始設定儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "在新的資料夾中建立新的 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "起始設定儲存庫： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "起始設定 Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "刪除儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "您確定要刪除 ${0} 儲存庫嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "將修補程式套用在選取的儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "顯示內容", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "確定名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "開啟確定", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "開啟確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "開啟給定名稱的確定", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "找不到確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "暫置變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "確定訊息：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "確定變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "正在提取先前的確定訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "重設本端變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "移出檔案，捨棄所有變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "顯示修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "載入預設工作區", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "將工作區變更顯示為修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "將已勾選的變更顯示成修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "顯示這個確定中之變更的修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "繼續", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "繼續重設基線", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "跳過修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "中止", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "中止重設基線", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "捨棄", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "忽略", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "將會捨棄您對所選檔案所做的變更，無法回復。", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "正在取得 git 日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "正在取得隱藏變更...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "作用中的分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "標籤 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "確定 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "隱藏 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "${0} 上的 WIP：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "${0} 上的索引：${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "遠端分支 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Git 日誌（作用中的分支）", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "顯示作用中本端分支的日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Git 日誌（遠端分支）", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "顯示對應的遠端追蹤分支的日誌", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "請參閱完整狀態", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "請參閱狀態", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "請選擇目標位置", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "預設的目標位置", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "變更...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "合併擠壓", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "將分支的內容擠壓至索引", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "本端分支名稱：", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "本端", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "過濾項目", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "過濾訊息", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "過濾作者", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "過濾確認者", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "過濾 sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "過濾開始日期 YYYY-MM-DD 或 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "過濾結束日期 YYYY-MM-DD 或 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "過濾路徑", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "過濾遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "正在取得遠端分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "正在取得遠端詳細資料：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "已順利套用修補程式", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "套用修補程式失敗。${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "正在取得分支 ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "將鏈結貼在電子郵件或 IM 中", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "在 GitHub 中顯示確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "在 GitHub 中顯示儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "在 GitHub 中顯示此確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "在 eclipse.org 中顯示確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "在 eclipse.org 中顯示此確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"在 eclipse.org 中顯示儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"在 eclipse.org 中顯示此儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "要求檢閱", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "傳送帶有要求的電子郵件供確定檢閱", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "檢閱人員名稱", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "要素項檢閱要求", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "將鏈結傳送至檢閱人員", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "私密金鑰檔（選用）：", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "不再提示我：", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "您的私密金鑰會儲存在瀏覽器中供進一步使用", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "正在載入要素項檢閱要求...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "在下列儲存庫中可以找到這項確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "嘗試更新儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "建立新的儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "將遠端附加至現有的其中一個儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "您正在檢閱 ${0} 的要素項，其要素項來自 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "很遺憾，在您的工作區中找不到這項確定。若要查看，請嘗試執行下列其中一項： ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "若要檢閱這項確定，您也可以：", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "提出要素項檢閱要求 ${0} 於 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "失敗的路徑：${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "執行動作時發生問題", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "移至 Orion 儲存庫頁面來提供 Git 儲存庫 URL。建立儲存庫後，它會出現在「導覽器」中。", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL：", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "檔案：", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "提交", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "git url： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "回復", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "將確定所引起的變更回復至作用中分支", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". 無法回復成作用中的分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "登入", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "${0} 需要鑑別。${1}，並重試要求。", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"儲存", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"記住我的確認者名稱與電子郵件：", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"已順利編輯 ${0} 使其具有值 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"已順利在 ${0} 中新增值 ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"登出者： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"變更 ID： ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"推送是 non-fastforward，而遭到拒絕。請使用「提取」，來查看必須合併的新確定。", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "確定和推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "同步", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "從遠端分支提取。重設確地的基線，方法是將確定從作用中分支移除，然後根據遠端分支的最新狀態來重新啟動本端分支，並且將每一項確定套用至已更新的本端分支。從本端分支將確定和標籤推送至遠端分支。", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "無變更", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "沒有內容", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "送入", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "送出", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "送入 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "送出 (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "歷程", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "未確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "儲存庫：", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "參照：", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "作者：", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "確認者：", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1：", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "顯示作用中的分支", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "顯示參照", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "檢視 ${1} \"${2}\" 的歷程", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "檢視相對於 ${1} \"${2}\" 的 \"${0}\" 的歷程", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "確定", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "分支", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "遠端分支", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "標籤", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "隱藏", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "路徑：", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "工作目錄變更", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "工作目錄詳細資料", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "比較 (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "無分支", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "沒有作用中的分支", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "沒有選取的參照", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "無", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "已選取 ${0} 個檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "已選取 ${0} 個檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} 個檔案已變更", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} 個檔案已變更", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "個檔案", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "您未選取檔案。您確定要這樣做嗎？", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "確定是空的", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1}已變更。${2} ${3}已備妥可確定。", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "確定和推送", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "確定和推送檔案至預設遠端", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "隱藏", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "隱藏所有的現行變更", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "捨棄", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "從隱藏清單中捨棄確定", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "套用", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "取出隱藏", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "將最近的隱藏變更套用到作用中的分支，並且從隱藏項目捨棄該隱藏變更", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "隱藏", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Git 儲存庫", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "將 git 儲存庫關聯到這個專案。",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Git 儲存庫",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "從 git 儲存庫建立專案。",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': '提取',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : '推送',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'URL：', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Ssh 私密金鑰：', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Ssh 通行詞組：', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '有未儲存的變更。您要儲存它們嗎？' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/fr/gitmessages',{
	"Compare": "Comparer", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "Afficher la comparaison côte à côte", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "Ouvrir le répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "Répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "Afficher la version du répertoire de travail du fichier", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "Chargement...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "Tous les référentiels Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "Référentiels", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} de ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "Afficher dans eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "Afficher dans GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "Afficher ce référentiel dans GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "Détails de la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "Pas de validation", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "validation : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "parent : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "créé par ${0} <${1}> le ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "validé par ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "validé par ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "créé par ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " le ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "Etiquettes :", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "Aucune étiquette", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "Modifications", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "Modifications du répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "Valider les changements", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "Valider les changements", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "plus ...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "moins ...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "Plus", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "Fichiers supplémentaires", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "Chargement de fichiers supplémentaires...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "Validations supplémentaires pour \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "Chargement de validations supplémentaires pour \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "Branches supplémentaires pour \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "Chargement de branches supplémentaires pour \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "Etiquettes supplémentaires", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "Chargement d'étiquettes supplémentaires...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "Stocks supplémentaires", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "Chargement de stocks supplémentaires...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "Chargement du journal Git en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "distant", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "Afficher tout", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "Erreur ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "Chargement ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "Message", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "Auteur", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "Date", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "Date de début :", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "Date de fin :", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "Actions", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "Branches", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "Etiquettes", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "Ajouter du contenu à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "Suppression avec retrait du contenu de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "Retirer le contenu de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "Suppression avec ajout de contenu à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "Contenu retiré de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "Contenu ajouté à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "Ajout avec retrait de contenu de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "Ajout avec ajout de contenu à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "Ajout", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "Suppression", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "Résoudre le conflit", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "En conflit", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "Valider le message", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "Valider", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "Valider les fichiers sélectionnés avec le message indiqué.", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"Authentification requise pour : ${0}. <a target=\"_blank\" href=\"${1}\">${2}</a> et relancez la demande. </span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "Entrez le message de validation", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "Valider ${0} fichier(s)", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "Modifier la dernière validation", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " Modifier", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "Resynchronisation en cours. Choisissez une action :", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "Resynchronisation en cours", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "Resynchronisez vos validations en les retirant de la branche active, en redémarrant la branche active en fonction de l'état le plus récent de \"${0}\" et en appliquant chaque validation à nouveau à la branche active mise à jour.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Resynchronisation du référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Ajout de la propriété de configuration Git suivante : clé=${0} valeur=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Edition de la propriété de configuration Git suivante : clé=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Suppression de la propriété de configuration Git suivante : clé=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "Clonage du référentiel : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "Branche de resynchronisation.\n\n\tUtilisez Continuer après avoir fusionné les conflits et sélectionné tous les fichiers ;\n\tIgnorer pour ignorer le correctif en cours ;\n\tAnnuler pour terminer la resynchronisation à tout moment.", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "Nom du valideur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "Nom :", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "Courrier électronique :", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "Adresse électronique :", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "Nom de l'auteur : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "Avec retrait du contenu de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "Avec ajout de contenu à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "Fichiers modifiés", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "Validations récentes sur", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Statut de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "Ouvrez la page Statut de Git pour le référentiel contenant ce fichier ou ce dossier.", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "Obtention des changements entrants Git...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "Réservation", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "Réservation en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "Ajouter le contenu du changement à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "Ajout de contenu à l'index en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "Réserver tous les fichiers sélectionnés en annulant tous les changements", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "Ajoutez tous les fichiers sélectionné au(x) fichier(s) .gitignore", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "Ecriture des règles du fichier .gitignore", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "Enregistrer le correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "Retirer le contenu du changement de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "Retrait du contenu de l'index...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "Annuler", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "Annuler cette validation, en conservant tous les fichiers modifiés et sans apporter de modification dans le répertoire de travail.", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "Le contenu de votre branche active sera remplacé par la validation \"${0}\". Toutes les modifications dans les répertoires de validation et de travail seront conservées. Voulez-vous vraiment effectuer cette opération ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "Réinitialiser", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "Tous les changements avec ajout ou retrait de contenu dans le répertoire de travail et dans l'index seront annulés et ne pourront pas être restaurés.\n\nVoulez-vous vraiment continuer ?", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "Les changements apportés aux fichiers sélectionnés seront annulés et ne pourront pas être restaurés.\n\nVoulez-vous vraiment continuer ?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "Réinitialiser la branche en annulant tous les changements avec ajout ou retrait du contenu de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "Tous les changements avec ajout ou retrait de contenu dans le répertoire de travail et dans l'index seront annulés et ne pourront pas être restaurés.", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "Voulez-vous vraiment continuer ?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "Conserver le répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "Réinitialisation des changements locaux en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "Continuer la resynchronisation...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "Ignorer le correctif...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "Abandon de la resynchronisation...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "Journal complet", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "index VS local", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "EN-TETE VS d'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "Comparer (${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "Chargement du statut en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "Validation...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "Le nom de l'auteur est obligatoire.", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "Le mail de l'auteur est obligatoire.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". Le référentiel contient toujours des conflits.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". Le référentiel contient des chemins non fusionnés. Traitez d'abord les conflits.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "Affichage de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "Configuration", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "Obtention de la configuration de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Obtention des informations du référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "Obtention des modifications", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "Référentiels - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "Référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "Référentiel introuvable", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "Aucun référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "Chargement du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "Chargement des référentiels", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(aucun contenu distant)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "emplacement : ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} fichier(s) dont le contenu doit être ajouté à l'index et ${1} fichier(s) à valider.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "Rien à valider.", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "Rien à envoyer.", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} validation(s) à envoyer.", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "Vous n'avez pas de changements à valider.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "Resynchronisation en cours.", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "Afficher toutes les branches de suivi locales et distantes", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "n'effectue le suivi d'aucune branche", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "effectue le suivi de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "dernière modification ${0} par ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "Aucune branche distante", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "Affichage des branches", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "Validations", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "Obtention de la branche en cours pour ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "Consultez le journal complet.", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "Consultez le journal complet", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "Obtention de validations pour la branche \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "Affichage des validations", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "Obtention des validations sortantes", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "La branche est à jour.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "Vous n'avez pas de validations sortantes ou entrantes.", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") par ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "Obtention des étiquettes", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "Afficher toutes les étiquettes", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " le ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " par ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "Contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "Affichage du contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "Aucun contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "Ajout contenu retiré de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "Ajout avec contenu ajouté à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " (Resynchronisation en cours)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "Etat", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "Journal (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "Journal (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "Statut de ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "Aucun contenu retiré de l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "Aucun contenu ajouté à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "Modifications pour ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "Validations pour ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "Validations pour la branche \"${0}\" par rapport à", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "Ajouter du contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "Nom du contenu distant :", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "URI distant :", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "Appliquer un correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "Appliquer un correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "Ouvrir la page Référentiel Git pour ce fichier ou ce dossier.", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Cloner un référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Cloner un référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "URL de référentiel :", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "Répertoire existant :", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "Nouveau dossier :", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "Sélectionnez un dossier", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "Message :", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "Modifier :", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "Modifier la validation précédente", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "ID de modification :", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "Ajouter l'ID de la modification au message", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "Nom du valideur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "Adresse électronique du valideur :", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "Entrez le nom de l'auteur", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "Entrez l'adresse électronique de l'auteur", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "Entrez le nom du valideur", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "Entrez l'adresse électronique du valideur", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "Nom de l'auteur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "E-mail de l'auteur :", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "Le message de validation est obligatoire.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Données d'identification Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "Nom d'utilisateur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "Clé privée :", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "Phrase passe (facultative) :", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "validation : ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "Parent : ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "branches : ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "étiquettes : ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "étiquettes", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " créé par ${0} (${1}) le ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "Contenu", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "Passer à la section ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "Entrez le nom de la validation (sha1) :", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "Rechercher", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "Recherche en cours...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "Sélectionner tout", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "Recherche de la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "Nouvelle branche :", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "Aucun contenu distant sélectionné", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "Entrer un nom...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "Annuler", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "Effacer", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "Filtrer", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "Filtrer les validations", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "Affiche/masque le panneau de filtrage des validations", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "Agrandir", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "Affiche la taille maximale de l'éditeur", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [Nouvelle branche]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "Voulez-vous ajouter la clé ${0} pour que l'hôte ${1} continue à fonctionner ? L'empreinte digitale de la clé est ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "Lier le référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "Nom du dossier :", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "Le référentiel a été lié à ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "Réservez cette validation pour créer une branche locale basée sur son contenu.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "Réservez cette étiquette pour créer une branche locale basée sur son contenu.", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "Réservation de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "Réservez et activez la branche ou la branche locale correspondante. Si la branche de suivi à distance n'est pas associée à une branche locale, celle-ci est créée automatiquement en premier.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "Réservation de la branche", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "Ajout de la branche ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "Retrait de la branche ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "Ajout du descripteur ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "Retrait du descripteur ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "Retrait du référentiel ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "Ajout de l'étiquette {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "Retrait de l'étiquette {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "Fusion de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : 'Modifications avec retrait de contenu', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "Réservation de la branche ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "Branche réservée.", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "Nouvelle branche", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "Ajouter une branche locale au référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "Nom de la branche", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "Suppression", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "Supprimer la branche locale du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "Voulez-vous vraiment supprimer la branche ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "Supprimer la branche de suivi à distance du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "Voulez-vous vraiment effectuer cette opération ?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "Vous allez supprimer la branche distante \"${0}\" et envoyer la modification.\n\nVoulez-vous vraiment effectuer cette opération ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "Suppression de la branche distante en cours : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "Supprimer la branche distante", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "Nouveau contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Contenu distant Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "Ouvrir la page Journal Git distante pour ce fichier ou ce dossier.", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "Ajouter un nouveau contenu distant au référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "Supprimer le contenu distant du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "Voulez-vous vraiment supprimer le contenu distant ${0} ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "Extraire", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "Extraire du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "Extraction en cours : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Extraire le référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Journal Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "Ouvrir la page Journal Git locale pour ce fichier ou ce dossier.", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "Ouvrir le journal de la branche", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "Ouvrir le journal du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "Ouvrir le statut du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "Afficher dans l'éditeur", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "Afficher le dossier du référentiel dans l'éditeur", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "Comparer l'un à l'autre", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "Comparer avec l'arborescence de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "Ouvrir", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "Afficher l'arborescence pour cette validation", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "Ouvrir la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "Afficher la version validée du fichier", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "Extraire", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "Extraire du contenu distant", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "Mot de passe :", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "Nom d'utilisateur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "Extraction du contenu distant : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "Forcer l'extraction", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "Extraire de la branche distante dans la branche de suivi à distance en remplaçant son contenu en cours", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "Vous allez remplacer le contenu de la branche de suivi à distance. Suite à cette action, la branche peut perdre des validations.", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "Fusionner", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "Fusionner le contenu de la branche dans la branche active", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". Accéder à ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Page de statut de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "Resynchroniser", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "Resynchronisez vos validations en les retirant de la branche active et en redémarrant celle-ci sur la base du dernier état de la branche sélectionnée ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "Resynchronisation en plus de ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". Des conflits se sont produits. Des conflits se sont produits.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". L'état du référentiel n'est pas valide (la resynchronisation est déjà en cours).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". Le référentiel contient des chemins non fusionnés.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". Le référentiel contient des changements en attente. Validez ou stockez ces changements.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". Des modifications n'ont pas été validées.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "Resynchronisez vos validations en les retirant de la branche active ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "en redémarrant celle-ci sur la base du dernier état de '", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "et en appliquant de nouveau chaque validation à la branche active mise à jour.", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "Insérer tout", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "Insérer les validations et les étiquettes de la branche locale dans la branche distante", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "Insérer la branche", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "Résultat de la commande push :", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "Insérer les validations sans étiquettes de la branche locale dans la branche distante", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "Insérer pour la révision", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Insérer des validations pour la révision du code Gerrit", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "Forcer l'insertion de branche", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "Insérer les validations sans étiquettes de la branche locale dans la branche distante en remplaçant le contenu en cours", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "Insertion du contenu distant : ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "Sélectionner une branche", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "Sélectionnez la branche distante.", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "Forcer l'insertion de tous les éléments", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "Insérer les validations et les étiquettes de la branche locale dans la branche distante en remplaçant le contenu en cours", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "Vous allez remplacer le contenu de la branche distante. Suite à cette action, le référentiel distant peut perdre des validations.", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< - Page précédente", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "Afficher la page précédente du journal Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "Afficher la page précédente des étiquettes Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "Page suivante >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "Afficher la page suivante du journal Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "Afficher la page suivante des étiquettes Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "Insérer de la branche locale dans la branche distante sélectionnée", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "Réinitialisez votre branche active à l'état de cette référence. Supprimez tout le contenu ajouté à l'index et retiré de celui-ci.", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "Le contenu de votre branche active sera remplacé par la validation \"${0}\". Tous les changements avec ajout ou retrait de contenu seront annulés et ne pourront pas être restaurés si \"${1}\" n'est pas sélectionné. Voulez-vous vraiment effectuer cette opération ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "Réinitialisation de l'index...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "Réinitialisation de l'index Git pour ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "Etiquette", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "Créer une étiquette pour la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "Votre projet est en cours de configuration. Cette opération peut prendre une minute...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "Recherche du projet : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "Nom de l'étiquette", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "Supprimer l'étiquette du référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "Voulez-vous vraiment supprimer l'étiquette ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "Sélectionner", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "Validation de la sélection des meilleurs éléments : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "Rétablissement de la validation : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "Appliquer les changements apportés par la validation à la branche active", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "Rien n'a été modifié.", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". Des conflits se sont produits.", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "Extraire de la branche distante dans la branche de suivi à distance", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Extraire le référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "Insérer", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "Insérer de la branche locale dans la branche distante", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Extraire le référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "Clé :", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "Valeur :", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "Nouvelle entrée de configuration", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "Edition", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "Editer l'entrée de configuration", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "Supprimer l'entrée de configuration", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "Voulez-vous vraiment supprimer ${0} ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "Cloner le référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "Cloner un référentiel Git dans un dossier", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "Clonage du référentiel : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "Initialiser le référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "Créer un nouveau référentiel Git dans un nouveau dossier", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "Initialisation du référentiel en cours : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Initialiser le référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "Supprimer le référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "Voulez-vous vraiment supprimer les référentiels ${0} ?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "Appliquer un correctif sur le référentiel sélectionné", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "Afficher le contenu", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "Nom de la validation :", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "Ouvrir la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "Ouvrir la validation", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "Ouvrir la validation avec le nom donné", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "Aucune validation trouvée", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "Ajout de contenu à l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "Message de validation :", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "Validation des modifications", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "Extraction du message de validation précédent", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "Réinitialisation des changements en local", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "Réserver les fichiers en annulant tous les changements", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "Afficher le correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "Chargement de l'espace de travail par défaut", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "Afficher les changements de l'espace de travail en tant que correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "Afficher les changements vérifiés en tant que correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "Afficher le correctif pour les changements de cette validation", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "Continuer", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "Poursuivre la resynchronisation", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "Ignorer le correctif", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "Abandonner", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "Abandonner la resynchronisation", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "Eliminer", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "Ignorer", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "Les changements apportés aux fichiers sélectionnés seront perdus et ne pourront pas être restaurés.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Obtention du journal Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "Obtention des modifications stockées...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "Branche active (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "Branche (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "Etiquette (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "Validation (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "Stock (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "Travail en cours sur ${0} : ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "index sur ${0} : ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "Branche distante (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Journal Git (branche active)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "Afficher le journal de la branche locale active", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Journal Git (branche distante)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "Afficher le journal de la branche de suivi à distance correspondante", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "Consulter le statut intégral", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "Consulter le statut", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "Choisir l'emplacement cible", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "Emplacement cible par défaut", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "Modifier...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "Fusionner Squash", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "Ecarter le contenu de la branche sur l'index", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "Nom de la branche locale :", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "Filtrer les éléments", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "Filtrer le message", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "Filtrer l'auteur", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "Filtrer le valideur", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "Filtrer sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "Filtrer depuis la date AAAA-MM-JJ ou 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "Filtrer jusqu'à la date AAAA-MM-JJ ou 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "Filtrer le chemin", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "Filtrer les branches distantes", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "Obtention des branches distantes ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "Obtention des détails distants : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "Correctif appliqué", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "L'application du correctif a échoué. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "Obtention des branches ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "Coller le lien dans un courrier électronique ou dans IM", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "Afficher la validation dans GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "Afficher le référentiel dans GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "Afficher cette validation dans GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "Afficher la validation dans eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "Afficher cette validation dans eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"Afficher le référentiel dans eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"Afficher ce référentiel dans eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "Demander la révision", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "Envoyer un courrier électronique avec une demande pour valider la révision", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "Nom du réviseur", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "Demande de révision de contribution", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "Envoyer le lien au réviseur", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "Fichier de clés privé (facultatif)", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "Ne plus me demander :", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "Votre clé privée sera enregistrée dans le navigateur pour une utilisation ultérieure", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "Chargement de la demande de révision de contribution...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "La validation se trouve dans les référentiels suivants", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "Essayez de mettre à jour vos référentiels", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "Créer un référentiel", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "Joindre le référentiel distant à l'un de vos référentiels existants", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "Vous êtes en train de réviser la contribution ${0} de ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "La validation est introuvable dans votre espace de travail. Pour l'afficher, effectuez l'une des opérations suivantes : ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "Pour réviser la validation, vous pouvez aussi :", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "Demande de révision de contribution pour ${0} dans le référentiel dont l'adresse URL est ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "Chemins défaillants : ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "Problème lors de l'exécution de l'action", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Accédez à la page de référentiels Orion pour fournir une URL de référentiel Git. Une fois créé, le référentiel apparaît dans le navigateur.", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL :", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "Fichier :", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "Soumettre", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "Adresse URL Git : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "Rétablir", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "Annuler les modifications apportées par la validation à la branche active", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". Impossible d'annuler les modifications dans la branche active.", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "Connexion", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "Authentification requise pour : ${0}. ${1} et relancez la demande.", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"Sauvegarder", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"Mémoriser le nom et l'adresse e-mail du valideur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"${0} édité(e) avec succès pour obtenir la valeur ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"${0} ajouté(e) avec succès avec la valeur ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"Déconnexion par : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"ID modification : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"L'insertion n'a pas été accélérée et a été rejetée. L'insertion n'a pas été accélérée et a été rejetée.", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "Valider et insérer", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "Synchroniser", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "Extraire à partir de la branche distante. Resynchronisez vos validations en les retirant de la branche locale, en redémarrant la branche locale en fonction de l'état le plus récent de la branche distante et en appliquant chaque validation à la branche locale mise à jour. Insérez les validations et les étiquettes de la branche locale dans la branche distante.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "Pas de modification", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "Pas de contenu", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "Entrant", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "Sortant", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "Entrant (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "Sortant (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "Historique", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "Non validé", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "Référentiel :", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "Référence :", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "Auteur :", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "Valideur :", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1 :", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "Afficher la branche active", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "Afficher la référence", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "Afficher l'historique de ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "Afficher l'historique de \"${0}\" relativement à ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "valider", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "branche", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "branche distante", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "étiquette", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "stockage dissimulé", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "Chemin :", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "Modifications du répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "Détails du répertoire de travail", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "Comparer (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "Aucune branche", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "Aucune branche active", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "Aucune référence sélectionnée", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "Aucun(e)", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} fichier sélectionné", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} fichier(s) sélectionné(s)", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} fichier modifié", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} fichier(s) modifié(s)", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "fichier", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "fichiers", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "Aucun fichier n'est sélectionné. Voulez-vous vraiment effectuer cette opération ?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "La validation est vide", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} modifié(s). ${2} ${3} prêt(s) pour validation.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "Valider et insérer", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "Valide et insère des fichiers au contenu distant par défaut", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "Stocker", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "Stocker toutes les modifications en cours", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "Supprimer", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "Supprimer la validation de la liste de stockage", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "Appliquer", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "Supprimer du stock", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Appliquer la dernière modification stockée sur votre branche active et la supprimer des stocks", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "stocks", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Référentiel Git", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Associer un référentiel Git à ce projet.",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Référentiel Git",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Créer un projet à partir d'un référentiel Git.",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'Extraire',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'Insérer',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'URL :', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Clé privée SSH :', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Phrase passe SSH :', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Des modifications n\'ont pas été sauvegardées. Voulez-vous les sauvegarder ?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/de/gitmessages',{
	"Compare": "Vergleichen", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "Gegenüberstellenden Vergleich anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "Arbeitsverzeichnis öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "Arbeitsverzeichnis", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "Arbeitsverzeichnisversion der Datei anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "Laden...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "Alle Git-Repositorys", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "Repositorys", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} in ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "In eclipse.org anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "In GitHub anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "Dieses Repository in GitHub anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "Festschreibungsdetails", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "Keine Festschreibung", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "Festschreiben: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "Übergeordnet: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "verfasst von ${0} <${1}> am ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "festgeschrieben von ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "festgeschrieben von ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "verfasst von ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " ein ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "Tags:", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "Keine Tags", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "Änderungen", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "Änderungen am Arbeitsverzeichnis", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "Änderungen festschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "Änderungen festschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "mehr...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "weniger...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "Mehr", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "Weitere Dateien", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "Weitere Dateien werden geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "Mehr Festschreibungen für \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "Weitere Festschreibungen für \"${0}\" werden geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "Mehr Verzweigungen für \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "Weitere Verzweigungen für \"${0}\" werden geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "Weitere Tags", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "Weitere Tags werden geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "Mehr Stashes", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "Weitere Stashes werden geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "Git-Protokoll wird geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "lokal", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "fern", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "Alle anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "Fehler ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "Ladevorgang läuft ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "Nachricht", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "Autor", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "Datum", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "Anfangstermin:", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "Endtermin:", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "Aktionen", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "Verzweigungen", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "Tags", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "Stufe", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "Nicht zwischengelagerte Entfernung", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "Nicht zwischenlagern", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "Zwischengelagerte Entfernung", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "Nicht zwischengelagerte Änderung", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "Zwischengelagerte Änderung", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "Nicht zwischengelagerte Hinzufügung", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "Zwischengelagerte Hinzufügung", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "Hinzufügung", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "Löschung", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "Konflikt auflösen", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "Mit Konflikt", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "Festschreibungsnachricht", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "Festschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "Schreibt die ausgewählte(n) Datei(en) mit der angegebenen Nachricht fest.", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"Für ${0} ist eine Authentifizierung erforderlich. <a target=\"_blank\" href=\"${1}\">${2}</a> und wiederholen Sie die Anforderung. </span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "Festschreibungsnachricht eingeben", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "Datei(en) ${0} festschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "Letzte Festschreibung korrigieren", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " Korrigieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "Aktualisierung mit Referenzversionen in Bearbeitung. Aktion auswählen:", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "Aktualisierung mit Referenzversionen in Bearbeitung", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "Führen Sie für Ihre Festschreibungen (Commits) eine Aktualisierung mit Referenzversionen durch, indem Sie sie aus der aktiven Verzweigung entfernen, die aktive Verzweigung dann auf der Basis des letzten Status von \"${0}\" erneut starten und jede Festschreibung erneut auf die aktualisierte aktive Verzweigung anwenden.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Aktualisierung mit Referenzversionen für Git-Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Git-Konfigurationseigenschaft wird hinzugefügt: Schlüssel=${0} Wert=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Git-Konfigurationseigenschaft wird bearbeitet: Schlüssel=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Git-Konfigurationseigenschaft wird gelöscht: Schlüssel=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "Repository wird geklont: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "Aktualisierung der Verzweigung mit Referenzversionen.\n\n\tVerwenden Sie 'Fortfahren', nachdem Sie die Konflikte gemischt und alle Dateien ausgewählt haben.\n\Verwenden Sie 'Überspringen', um den aktuellen Patch zu überspringen.\n\tVerwenden Sie jederzeit 'Stoppen', um die Aktualisierung mit Referenzversionen zu beenden.", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "Name des Festschreibungsverantwortlichen:", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "Name:", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "E-Mail:", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "E-Mail:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "Name des Autors: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "Nicht zwischengelagert", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "Zwischengelagert", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "Geänderte Dateien", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "Kürzliche Festschreibungen in", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Git-Status", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "Öffnet die Seite 'Git-Status' für das Repository, das diese Datei oder diesen Ordner enthält.", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "Eingehende Git-Änderungen werden abgerufen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "Auschecken", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "Check-out läuft...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "Änderung zwischenlagern", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "Zwischenlagerung wird ausgeführt...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "Alle ausgewählten Dateien auschecken und alle Änderungen verwerfen", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "Alle ausgewählten Dateien zu Datei(en) vom Typ .gitignore hinzufügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : ".gitignore-Regeln werden geschrieben", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "Patch speichern", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "Zwischenlagerung der Änderung aufheben", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "Aufhebung der Zwischenlagerung wird ausgeführt...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "Widerrufen", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "Hebt diese Festschreibung auf, wobei alle geänderten Dateien beibehalten und keine Änderungen am Arbeitsverzeichnis vorgenommen werden.", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "Der Inhalt Ihrer aktiven Verzweigung wird ersetzt durch Festschreibung \"${0}\". Alle Änderungen im Festschreibungs- und im Arbeitsverzeichnis bleiben erhalten. Möchten Sie fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "Zurücksetzen", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "Alle nicht zwischengelagerten und zwischengelagerten Änderungen im Arbeitsverzeichnis und im Index werden verworfen und können nicht wiederhergestellt werden.\n\nMöchten Sie tatsächlich fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "Ihre Änderungen an den ausgewählten Dateien werden verworfen und können nicht wiederhergestellt werden.\n\nMöchten Sie tatsächlich fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "Verzweigung zurücksetzen und alle zwischengelagerten und nicht zwischengelagerten Änderungen verwerfen", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "Alle nicht zwischengelagerten und zwischengelagerten Änderungen im Arbeitsverzeichnis und im Index werden verworfen und können nicht wiederhergestellt werden.", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "Möchten Sie wirklich fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "Arbeitsverzeichnis beibehalten", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "Lokale Änderungen werden zurückgesetzt...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "Aktualisierung mit Referenzversionen fortsetzen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "Patch überspringen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "Aktualisierung mit Referenzversionen abbrechen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "Protokoll abschließen", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "Lokaler VS-Index", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "VS HEAD - Index", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "Vergleich (${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "Status wird geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "Festschreibung wird ausgeführt...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "Der Name des Autors ist erforderlich.", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "Die E-Mail des Autors ist erforderlich.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". Das Repository enthält weiterhin Konflikte.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". Das Repository enthält nicht zusammengeführte Pfade. Beheben Sie zuerst die Konflikte.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "${0} wird dargestellt", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "Konfiguration", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "Konfiguration von ${0} wird abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Git-Repository-Details werden abgerufen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "Änderungen werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "Repositorys - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "Repository nicht gefunden", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "Keine Repositorys", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "Repository wird geladen", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "Repositorys werden geladen", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(kein Fernzugriff)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "Standort: ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} Datei(en) zwischenzulagern und ${1} Datei(en) festzuschreiben.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "Nichts festzuschreiben.", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "Nichts mit Push-Operation zu übertragen.", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} mit Push-Operation zu übertragende Festschreibung(en).", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "Sie haben keine festzuschreibenden Änderungen.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "Aktualisierung mit Referenzversionen wird verarbeitet!", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "Alle lokalen und fernen Verfolgungsverzweigungen anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "verfolgt keine Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "verfolgt ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "letzte Änderung ${0} durch ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "Keine fernen Verzweigungen", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "Verzweigungen darstellen", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "Festschreibungen", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "Aktuelle Verzweigung für ${0} wird abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "Vollständiges Protokoll anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "Informationen enthält das vollständige Protokoll", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "Festschreibungen für Verzweigung \"${0}\" werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "Festschreibungen werden dargestellt", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "Abgehende Festschreibungen werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "Die Verzweigung ist auf dem neuesten Stand.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "Sie haben keine abgehenden oder eingehenden Festschreibungen.", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") von ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "Tags werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "Alle Tags anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " ein ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " nach ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "Ferne", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "Ferne werden dargestellt", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "Keine fernen", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "Nicht zwischengelagerte Addition", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "Zwischengelagerte Addition", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " (Aktualisierung mit Referenzversionen in Bearbeitung)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "Status", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "Protokoll (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "Protokoll (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "Status für ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "Keine nicht zwischengelagerten Änderungen", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "Keine zwischengelagerten Änderungen", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "Änderungen für ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "Änderungen für ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "Festschreibungen für die Verzweigung \"${0}\" für", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "Ferne hinzufügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "Name der fernen Einheit:", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "URI der fernen Einheit:", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "Patch anwenden", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "Patch anwenden", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Git-Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "Öffnet die Git-Repository-Seite für diese Datei oder diesen Ordner.", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Git-Repository klonen", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Git-Repository klonen", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "Repository-URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "Vorhandenes Verzeichnis:", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "Neuer Ordner:", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "Ordner auswählen", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "Nachricht:", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "Korrigieren:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "Vorherige Festschreibung ändern", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "Änderungs-ID:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "Änderungs-ID zu Nachricht hinzufügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "Name des Festschreibungsverantwortlichen:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "E-Mail des Festschreibungsverantwortlichen:", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "Name des Autors eingeben", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "E-Mail des Autors eingeben", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "Name des Festschreibungsverantwortlichen eingeben", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "E-Mail des Festschreibungsverantwortlichen eingeben", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "Autorenname:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "E-Mail des Autors:", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "Die Festschreibungsnachricht ist erforderlich.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Git-Berechtigungsnachweise", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "Benutzername:", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "Privater Schlüssel:", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "Kennphrase (optional):", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "Festschreiben: ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "Übergeordnetes Element: ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "Verzweigungen: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "Tags: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "Tags", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " verfasst von ${0} (${1}) am ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "Inhalt", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "Gehe zum Abschnitt ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "Geben Sie den Festschreibungsnamen (sha1) ein:", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "Suchen", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "Suchen...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "Alles auswählen", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "Festschreibung wird gesucht", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "Neue Verzweigung:", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "Keine fernen ausgewählt", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "Namen eingeben...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "Abbrechen", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "Inhalt löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "Filter", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "Festschreibungen filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "Aktiviert bzw. inaktiviert die Anzeige 'Festschreibungen filtern'", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "Maximieren", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "Aktiviert bzw. inaktiviert den Maximierungsstatus des Editors", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [Neue Verzweigung]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "Wollen Sie den Schlüssel ${0} für den Host ${1} hinzufügen, um die Operation fortzusetzen? Schlüssel für elektronischen Fingerabdruck ist ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "Link-Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "Ordnername:", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "Repository wurde verknüpft mit ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "Checkt diese Festschreibung aus und erstellt dabei eine lokale Verzweigung auf der Basis des Inhalts.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "Checkt diesen Tag aus und erstellt dabei eine lokale Verzweigung auf der Basis des Inhalts.", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "${0} wird ausgecheckt", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "Checken Sie die Verzweigung oder die entsprechende lokale Verzweigung aus und aktivieren Sie sie. Wenn die ferne Verfolgungsverzweigung nicht über eine entsprechende lokale Verzweigung verfügt, dann wird die lokale Verzweigung zuerst erstellt.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "Verzweigung wird ausgecheckt", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "Verzweigung ${0} wird hinzugefügt", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "Verzweigung ${0} wird entfernt", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "${0} (fern) wird hinzugefügt", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "${0} (fern) wird entfernt", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "Repository ${0} wird entfernt", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "Tag ${0} wird hinzugefügt", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "Tag ${0} wird entfernt", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "Merge-Operation für ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : 'Aufhebung der Zwischenlagerung für Änderungen wird ausgeführt', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "Verzweigung ${0} wird ausgecheckt", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "Verzweigung wurde ausgecheckt.", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "Neue Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "Neue lokale Verzweigung zum Repository hinzufügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "Name der Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "Löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "Lokale Verzweigung aus Repository löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "Soll die Verzweigung ${0} wirklich gelöscht werden?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "Ferne Verfolgungsverzweigung aus Repository löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "Möchten Sie fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "Sie sind dabei, die ferne Verzweigung \"${0}\" zu löschen und die Änderung mit einer Push-Operation zu übertragen.\n\nMöchten Sie tatsächlich fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "Ferne Verzweigung wird entfernt: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "Ferne Verzweigung löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "Neu - Fern", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Git - Fern", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "Öffnet die ferne Seite 'Git-Protokoll' für diese Datei oder diesen Ordner.", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "Neues fernes Element zum Repository hinzufügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "Fernes Element aus dem Repository löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "Soll das ferne Element ${0} wirklich gelöscht werden?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "Pull-Operation", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "Mit Pull-Operation aus dem Repository extrahieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "Pull-Operation wird ausgeführt: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Git-Repository mit Pull-Operation extrahieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Git-Protokoll", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "Öffnet die lokale Seite 'Git-Protokoll' für diese Datei oder diesen Ordner.", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "Protokoll für Verzweigung öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "Protokoll für Repository öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "Status für Repository öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "In Editor anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "Repositoryordner in Editor anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "Miteinander vergleichen", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "Mit Arbeitsbaumstruktur vergleichen", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "Öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "Baumstruktur für diese Festschreibung anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "Festschreibung öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "Die festgeschriebene Version der Datei anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "Abruf", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "Aus fernem Element abrufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "Kennwort:", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "Benutzername:", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "Fernes Element abrufen: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "Abruf erzwingen", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "Aus ferner Verzweigung abrufen und in ferne Verfolgungsverzweigung einlesen und dabei den aktuellen Inhalt überschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "Sie sind dabei, den Inhalt der fernen Verfolgungsverzweigung zu überschreiben. Dadurch gehen die Festschreibungen der Verzweigung möglicherweise verloren.", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "Mischen", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "Inhalt aus der Verzweigung in die aktive Verzweigung mischen", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". Wechseln zu ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Seite 'Git-Status'", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "Aktualisierung mit Referenzversionen", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "Führen Sie für Ihre Festschreibungen eine Aktualisierung mit Referenzversionen durch, indem Sie sie aus der aktiven Verzweigung entfernen und die aktive Verzweigung dann auf der Basis des letzten Status der ausgewählten Verzweigung starten. ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "Aktualisierung mit Referenzversionen über ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". Es sind Konflikte aufgetreten. Beheben Sie sie und setzen Sie die Verarbeitung dann fort, überspringen Sie den Patch oder brechen Sie die Aktualisierung mit Referenzversionen ab.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". Der Repository-Status ist ungültig (d. h. bereits während der Aktualisierung mit Referenzversionen).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". Das Repository enthält nicht zusammengeführte Pfade.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". Das Repository enthält anstehende Änderungen. Festschreibung oder Stash dafür duchführen.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". Es sind nicht festgeschriebene Änderungen vorhanden.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "Führen Sie für Ihre Festschreibungen eine Aktualisierung mit Referenzversionen durch, indem Sie sie aus der aktiven Verzweigung entfernen und ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "und die aktive Verzweigung dann auf der Basis des letzten Status der", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "und wenden Sie jede Festschreibung erneut auf die aktualisierte, aktive Verzweigung an.", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "Alles mit Push-Operation übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "Festschreibungen und Tags mit einer Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "Push-Operation für Verzweigung durchführen", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "Push-Operation für Ergebnis durchführen:", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "Festschreibungen und Tags mit Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "Push-Operation für Überprüfung durchführen", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Festschreibungen mit Push-Operation an Gerrit-Codeüberprüfung übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "Push-Operation für Verzweigung erzwingen", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "Festschreibungen ohne Tags mit Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen und dabei den aktuellen Inhalt überschreiben", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "Ferne Elemente mit Push-Operation übertragen: ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "Verzweigung auswählen", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "Wählen Sie die ferne Verzweigung aus.", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "Übertragung aller Elemente mit einer Push-Operation erzwingen", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "Festschreibungen und Tags mit einer Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen und dabei den aktuellen Inhalt überschreiben", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "Sie sind dabei, den Inhalt der fernen Verzweigung zu überschreiben. Dadurch gehen die Festschreibungen im fernen Repository möglicherweise verloren.", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< Vorherige Seite", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "Vorherige Seite des Git-Protokolls anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "Vorherige Seite der Git-Tags anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "Nächste Seite >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "Nächste Seite des Git-Protokolls anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "Nächste Seite der Git-Tags anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "Mit Push-Operation von der lokalen Verzweigung in die ausgewählte ferne Verzweigung übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "Setzen Sie die aktive Verzweigung in den Status dieser Referenz zurück. Verwerfen Sie alle zwischengelagerten und nicht zwischengelagerten Änderungen.", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "Der Inhalt Ihrer aktiven Verzweigung wird ersetzt durch Festschreibung \"${0}\". Alle nicht zwischengelagerten und zwischengelagerten Änderungen werden verworfen und können nicht wiederhergestellt werden, wenn \"${1}\" nicht überprüft wird. Möchten Sie fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "Index wird zurückgesetzt...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "Git-Index ${0} wird zurückgesetzt", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "Tag für Festschreibung erstellen", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "Ihr Projekt wird eingerichtet. Dies kann eine Minute dauern...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "Projekt wird gesucht: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "Tag-Name", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "Tag aus Repository löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "Soll der Tag ${0} wirklich gelöscht werden?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "Cherry-Pick", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "Cherry-Picking für Festschreibung: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "Revert-Operation für Festschreibung: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "Durch Festschreibung definierte Änderung in aktiver Verzweigung anwenden", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "Keine Änderungen vorgenommen.", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". Es sind Konflikte aufgetreten.", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "Aus ferner Verzweigung abrufen und in ferne Verfolgungsverzweigung einlesen", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Git-Repository abrufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "Push-Operation", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "Mit Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Git-Repository mit Push-Operation übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "Schlüssel:", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "Wert:", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "Neuer Konfigurationseintrag", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "Bearbeiten", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "Konfigurationseintrag bearbeiten", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "Konfigurationseintrag löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "Sind Sie sicher, dass Sie ${0} löschen möchten?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "Repository klonen", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "Vorhandenes Git-Repository in einem Ordner klonen", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "Repository wird geklont: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "Repository initialisieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "Neues Git-Repository in einem neuen Ordner erstellen", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "Repository initialisieren: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Git-Repository initialisieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "Repository löschen", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "Sollen die ${0} Repositorys wirklich gelöscht werden?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "Patch auf ausgewähltes Repository anwenden", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "Inhalt anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "Name der Festschreibung:", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "Festschreibung öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "Festschreibung öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "Festschreibung mit angegebenem Namen öffnen", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "Keine Festschreibungen gefunden", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "Änderungen werden zwischengelagerten", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "Festschreibungsnachricht:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "Änderungen werden festgeschrieben", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "Vorherige Festschreibungsnachricht wird abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "Lokale Änderungen werden zurückgesetzt", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "Dateien auschecken und alle Änderungen verwerfen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "Patch anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "Standadrdarbeitsbereich wird geladen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "Arbeitsbereichsänderungen als Patch anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "Geprüfte Änderungen als Patch anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "Patch für Änderungen in dieser Festschreibung anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "Weiter", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "Mit der Aktualisierung mit Referenzversionen fortsetzen", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "Patch überspringen", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "Stoppen", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "Aktualisierung mit Referenzversionen abbrechen", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "Verwerfen", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "Ignorieren", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "Ihre Änderungen an den ausgewählten Dateien werden gelöscht und können nicht wiederhergestellt werden.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Git-Protokoll wird abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "Stash-Änderungen werden abgerufen...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "Aktive Verzweigung (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "Verzweigung (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "Tag (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "Festschreibung (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "Stash (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "Bearbeitung läuft für ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "Indexierung läuft für ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "Ferne Verzweigung (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Git-Protokoll (aktive Verzweigung)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "Protokoll der aktiven lokalen Verzweigung anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Git-Protokoll (ferne Verzweigung)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "Protokoll der entsprechenden fernen Verfolgungsverzweigung anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "Informationen finden Sie unter dem vollständigen Status", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "Informationen finden Sie unter dem Status", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "Zielposition auswählen", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "Standardzielposition", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "Ändern...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "Zusammenführen und Komprimieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "Inhalt der Verzweigung im Index komprimieren", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "Name der lokalen Verzweigung:", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "lokal", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "Elemente filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "Nachricht filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "Autor filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "Festschreibungsverantwortlichen filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "Filter sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "Filtern von Datum JJJJ-MM-TT oder 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "Filtern bis Datum JJJJ-MM-TT oder 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "Pfad filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "Ferne Verzweigungen filtern", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "Ferne Verzweigungen ${0} werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "Ferne Details werden abgerufen: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "Patch wurde erfolgreich angewendet", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "Anwendung des Patch fehlgeschlagen. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "Verzweigungen ${0} werden abgerufen", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "Link in E-Mail oder IM einfügen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "Festschreibung in GitHub anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "Repository in GitHub anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "Diese Festschreibung in GitHub anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "Festschreibung in eclipse.org anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "Diese Festschreibung in eclipse.org anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"Repository in eclipse.org anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"Dieses Repository in eclipse.org anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "nach Prüfung fragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "E-Mail mit Anfrage für Festschreibungsprüfung senden", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "Prüfername", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "Anforderung zur Beitragsprüfung", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "Link an den Prüfer senden", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "Private schlüsseldatei (optional):", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "Nicht wieder anfragen:", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "Ihr privater Schlüssel wird im Browser zur weiteren Verwendung gespeichert.", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "Anforderung zur Beitragsprüfung wird geladen...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "Die Festschreibung ist in den folgenden Repositorys zu finden:", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "Versuchen Sie, Ihre Repositorys zu aktualisieren.", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "Neues Repository erstellen", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "Fernes Repository an eines der vorhandenen Repositorys anhängen", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "Sie prüfen momentan den Beitrag ${0} von ${1}.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "Die Festschreibung wurde leider in Ihrem Arbeitsbereich nicht gefunden. Versuchen Sie es mit einer der folgenden Aktionen, um es anzuzeigen: ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "Zum Prüfen der Festschreibung stehen Ihnen auch die folgenden Möglichkeiten zur Verfügung:", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "Anforderung zur Beitragsprüfung für ${0} auf ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "Fehlgeschlagene Pfade: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "Problem bei Ausführung der Aktion", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Rufen Sie die Orion-Repository-Seite auf, um die URL für ein Git-Repository anzugeben. Nach der Erstellung des Repositorys wird es im Navigator angezeigt.", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "Datei:", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "Übergeben", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "Git-URL: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "Zurücksetzen", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "Änderungen umkehren, die durch Festschreibung in aktiver Verzweigung stattfanden", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". Zurücksetzen in die aktive Verzweigung war nicht möglich.", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "Anmelden", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "Für ${0} ist eine Authentifizierung erforderlich. ${1} und wiederholen Sie die Anforderung.", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"Speichern", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"Meinen Namen als Festschreibungsverantwortlicher und meine E-Mail-Adresse merken:", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"Erfolgreiche Bearbeitung von ${0} mit dem Wert ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"Erfolgreiches Ergänzen von ${0} mit dem Wert ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"Abgezeichnet durch: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"Änderungs-ID: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"Die Push-Operation ist nicht vorwärts gerichtet und wurde abgelehnt. Verwenden Sie 'Fetch', damit neue Festschreibungen angezeigt werden, die gemischt werden müssen.", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "Festschreibung und mit Push-Operation übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "Sync", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "Ruft aus der fernen Verzweigung ab. Führen Sie für Ihre Festschreibungen eine Aktualisierung mit Referenzversionen durch, indem Sie sie aus der lokalen Verzweigung entfernen, die lokale Verzweigung dann auf der Basis des letzten Status der fernen Verzweigung erneut starten und jede Festschreibung auf die aktualisierte lokale Verzweigung anwenden. Festschreibungen und Tags werden mit einer Push-Operation von der lokalen Verzweigung in die ferne Verzweigung übertragen.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "Keine Änderungen", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "Kein Inhalt", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "Eingehend", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "Abgehend", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "Eingehend (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "Abgehend (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "Verlaufsprotokoll", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "Nicht festgeschrieben", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "Repository:", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "Verweis:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "Autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "Festschreibungsverantwortlicher:", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "Aktive Verzweigung anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "Verweis anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "Verlaufsprotokoll von ${1} \"${2}\" anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "Verlaufsprotokoll von \"${0}\" relativ zu ${1} \"${2}\" anzeigen", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "Festschreibung", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "Ferne Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "Stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "Pfad:", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "Änderungen am Arbeitsverzeichnis", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "Details des Arbeitsverzeichnisses", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "Vergleich (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "Keine Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "Keine aktive Verzweigung", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "Keine ausgewählte Referenz", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "Keine Angabe", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} Datei ausgewählt", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} Dateien ausgewählt.", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} Datei geändert", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} Dateien geändert", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "Datei", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "Dateien", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "Sie haben keine Dateien ausgewählt. Möchten Sie fortfahren?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "Die Festschreibung ist leer", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} geändert. ${2} ${3} für Festschreibung bereit.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "Festschreibung und mit Push-Operation übertragen", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "Schreibt Dateien fest und überträgt sie mit Push-Operation an die ferne Standardposition", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "Stash", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "Stash für alle aktuellen Änderungen", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "Freigeben", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "Die Festschreibung aus der Stash-Liste freigeben", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "Anwenden", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "Pop-Stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Die aktuellste Stash-Änderung in der aktiven Verzweigung anwenden und diese aus den Stashes freigeben", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "Stashes", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Git-Repository", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Diesem Projekt ein Git-Repository zuordnen.",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Git-Repository",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Ein Projekt aus einem Git-Repository erstellen.",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'Abruf',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'Push-Operation',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'URL:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Privater SSH-Schlüssel:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'SSH-Kennphrase:', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Nicht gespeicherte Änderungen vorhanden. Möchten Sie sie speichern?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/it/gitmessages',{
	"Compare": "Confronta", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "Visualizza confronto", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "Apri directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "Directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "Visualizzare la versione della directory di lavoro del file", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "Caricamento...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "Tutti i repository Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} su ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "Mostra in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "Mostra in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "Mostra questo repository in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "Dettagli commit", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "Nessun commit", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "commit: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "parent: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "creato da ${0} <${1}> su ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "sottoposto a commit da ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "sottoposto a commit da ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "autore ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " attivo ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "Tag:", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "Nessuna tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "Modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "Modifiche alla directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "Applica le modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "Applica le modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "di più ...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "di meno ...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "Altro", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "Altri file", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "Caricamento di altri file...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "Ulteriori commit per \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "Caricamento di ulteriori commit per \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "Ulteriori rami per \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "Caricamento di ulteriori rami per \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "Ulteriori tag", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "Caricamento di ulteriori tag...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "Altri stash", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "Caricamento di altri stash in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "Caricamento log git in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "locale", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "Visualizza tutto", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "Errore ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "Caricamento ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "Messaggio", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "Autore", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "Data", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "Data di inizio:", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "Data di fine:", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "Azioni", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "Sezioni", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "Fase", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "Rimozione unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "Unstage", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "Rimozione Staged", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "Modifica unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "Modifica staged", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "Aggiunta unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "Aggiunta Staged", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "Aggiunta", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "Eliminazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "Risolvi il conflitto", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "In conflitto", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "Messaggio commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "Commit", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "Eseguire il commit dei file selezionati con il messaggio fornito.", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"Autenticazione obbligatoria per: ${0}. <a target=\"_blank\" href=\"${1}\">${2}</a> e ritentare la richiesta. </span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "Immetti il messaggio di commit", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "File di commit ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "Rettifica ultimo commit", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " Rettifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "Modifica in corso. Seleziona azione:", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "Modifica in corso", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "Modifica dei commit eliminandoli dal ramo attivo, avviando di nuovo il ramo attivo sulla base dello stato più recente di \"${0}\" e applicando di nuovo ciascun commit al ramo attivo aggiornato.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Rimodifica in corso del repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Aggiunta in corso della proprietà di configurazione git: key=${0} value=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Modifica proprietà di configurazione git: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Eliminazione della proprietà di configurazione git: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "Clonazione del repository: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "Modifica del ramo.\n\n\tUtilizzare Continua dopo aver unito i conflitti e selezionato tutti i file;\n\tUtilizzare Ignora per evitare la patch corrente;\n\tUtilizzare Interrompi per terminare le modifiche in qualsiasi momento.", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "Nome committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "Nome:", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "email:", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "Email:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "Nome autore: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "Unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "In staging", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "File modificati", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "Commit recenti su", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Stato Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "Aprire la pagina Stato Git per il repository contenente questo file o cartella.", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "Ricerca modifiche git in entrata...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "Check-out", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "Check-out in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "Stage la modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "Staging...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "Esegui check-out di tutti i file selezionati ignorando tutte le modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "Aggiungere tutti i file selezionati ai file .gitignore", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "Scrittura di regole .gitignore", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "Salva patch", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "Unstage la modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "Unstaging...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "Annulla", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "Ripristinare questo commit, conservando tutti i file modificati e non apportando alcuna modifica alla directory di lavoro.", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "Il contenuto del ramo attivo verrà sostituito con commit \"${0}\". Tutte le modifiche nel commit e nella directory di lavoro verranno conservate. Continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "Reimposta", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "Tutte le modifiche staged e unstaged nella directory di lavoro e l'indice di lavoro andranno persi e non potranno essere recuperati.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "Le modifiche apportate ai file selezionati verranno eliminate e non sarà possibile recuperarle.\n\nSi è sicuri di voler continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "Ripristina il ramo ignorando tutte le modifiche staged e unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "Tutte le modifiche staged e unstaged nella directory ed indice di lavoro andranno perse e non potranno essere recuperate.", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "Continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "Conserva la directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "Ripristino delle modifiche locali...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "Continua modifica...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "Ignora patch...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "Modifica non riuscita...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "Log completo", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "Indice VS locale", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "Indice VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "Confronta(${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "Stato caricamento...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "Esecuzione del commit in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "Il nome dell'autore è obbligatorio.", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "L'email dell'autore è obbligatoria.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". Il repository contiene ancora conflitti.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". Il repository contiene percorsi non integrati. Risolvi prima i conflitti.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "Rendering ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "Configurazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "Richiamo configurazione di ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Acquisizione dei dettagli del repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "Acquisizione delle modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "Repository - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "Repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "Repository non trovato", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "Nessun repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "Caricamento repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "Caricamento repository", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(non remoto)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "ubicazione: ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} file per lo stage e ${1} file per il commit.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "Nulla su cui eseguire il commit.", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "Nulla da eseguire.", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} commit di cui eseguire l'inoltro.", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "Non esiste alcuna modifica per cui eseguire il commit.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "Modifica in corso!", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "Visualizza tutti i rami di traccia locali e remoti", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "non traccia alcun ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "traccia ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "Ultimo modificato ${0} da ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "Nessun ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "Rendering rami", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "Commit", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "Richiamo ramo corrente per ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "Visualizza log completo", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "Visualizza il log completo", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "Richiamo commit per \"${0}\" ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "Rendering commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "Richiamo commit in uscita", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "Il ramo è aggiornato.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "Non si hanno commit in entrata o in uscita.", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") da ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "Richiamo tag", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "Visualizza tutte i tag", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " attivo ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " per ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "Remoti", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "Rendering remoti", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "Nessun remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "Aggiunta unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "Aggiunta staged", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " Modifica in corso)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "Stato", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "Registro (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "Registro (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "Stato per  ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "Nessuna modifica unstaged", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "Nessuna modifica staged", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "Modifiche per ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "Commit per ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "Commit per ramo \"${0}\" e", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "Aggiungi remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "Nome remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "URI remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "Applica patch", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "Applica patch", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Repository Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "Aprire la pagina Repository Git per questo file o cartella.", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Clona repository Git", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Clona repository Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "URL repository:", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "Directory esistente:", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "Nuova cartella:", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "Seleziona una cartella", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "Messaggio:", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "Rettifica:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "Correggi commit precedente", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "ChangeId:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "Aggiungi messaggio Cambio ID", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "Nome committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "Email committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "Immetti nome autore", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "Immetti email autore", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "Immetti nome committer", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "Immetti email committer", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "Nome autore:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "Email autore:", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "Il messaggio di commit è richiesto.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Credenziali Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "Nome utente:", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "Chiave privata:", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "Passphrase (facoltativa):", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "commit: ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "principale: ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "rami: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "tag: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "tag", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " creato da ${0} (${1}) il ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "Contenuto", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "Andare alla sezione ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "Immetti nome commit (sha1):", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "Cerca", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "Ricerca in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "Seleziona tutto", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "Ricerca commit", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "Nuovo ramo:", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "Nessuna risorsa remota selezionata", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "Immettere un nome...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "Annulla", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "Cancella", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "Filtro", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "Filtra commit", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "Attiva/disattiva pannello di filtro commit", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "Ingrandisci", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "Attiva/Disattiva la dimensione massima dell'editor", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [Nuovo ramo]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "Si desidera aggiungere la chiave ${0} per l'host ${1} per continuare l'operazione? L'impronta digitale della chiave è ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "Link repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "Nome cartella:", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "Il repository è stato collegato a ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "Eseguire il check out di questo commit, creando un ramo locale sulla base del suo contenuto.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "Eseguire il check out di questo tag, creando un ramo locale sulla base del suo contenuto.", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "Esecuzione del check out di ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "Esegui check out del ramo o del ramo corrispondente locale e rendilo attivo. Se il ramo di traccia remoto non ha un corrispondente ramo locale, verrà prima creato il ramo locale.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "Esecuzione check-out ramo in corso...", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "Aggiunta ramo ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "Rimozione ramo ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "Aggiunta ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "Rimozione ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "Rimozione repository ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "Aggiunta tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "Rimozione tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "Unione in ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : 'unstage modifiche', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "Esecuzione check out ramo ${0}...", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "Check out ramo eseguito.", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "Nuovo ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "Aggiungi un nuovo ramo locale al repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "Nome ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "Elimina", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "Elimina il ramo locale dal repository", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "Si è sicuri di voler eliminare il ramo ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "Elimina il ramo di traccia remoto dal repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "Continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "Si sta per eliminare il ramo remoto \"${0}\" e per inserire la modifica.\n\nSi è sicuri?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "Rimozione ramo remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "Elimina ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "Nuovo remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Git remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "Aprire la pagina Log Git remota per questo file o cartella.", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "Aggiungi un nuovo remoto al repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "Elimina il remoto dal repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "Si è sicuri di voler eliminare il remoto ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "Esegui pull", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "Estrai dal repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "Estrazione : ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Estrai dal repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "Aprire la pagina Log Git locale per questo file o cartella.", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "Apri il log per il ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "Apri il log per il repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "Apri lo stato per il repository", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "Mostra nell'editor", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "Mostra la cartella di repository nell'editor", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "Confronta l'uno con l'altro", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "Confronta con la struttura ad albero di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "Aperto", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "Visualizza la struttura ad albero di questo commit", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "Apri commit", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "Visualizza la versione del file sottoposta a commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "Recupera", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "Richiama dati dal remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "Password:", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "Nome utente:", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "Richiamo dati remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "Forza richiamo dati", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "Richiama dati dal ramo remoto nel ramo di traccia remoto sostituendo il suo contenuto attuale", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "Si sta per sostituire il contenuto del ramo di traccia remoto. Ciò può causare la perdita del commit per il ramo.", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "Unisci", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "Unisci il contenuto del ramo al ramo attivo", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". Passa a ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Pagina Stato git", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "Modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "Modifica i commit eliminandoli dal ramo attivo, avvia il ramo attivo nuovamente sulla base dello stato più recente del ramo selezionato ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "Modifica nella parte superiore ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". Si sono verificati alcuni conflitti. Risolverli e continuare, ignorare le patch o interrompere le modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". Lo stato del repository non è valido (ad esempio già durante la modifica).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". Il repository contiene percorsi non integrati.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". Il repository contiene modifiche in sospeso Eseguire il commit o ignorarli (mediante stash).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". Sono presenti modifiche senza commit.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "Modifica i commit eliminandoli dal ramo attivo ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "avvia nuovamente il ramo attivo in base all'ultimo stato", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "e esegui nuovamente tutti i commit al ramo attivo aggiornato.", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "Inoltra tutti", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "Inoltra i commit e i tag dal ramo locale al ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "Inoltra ramo", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "Inoltra risultato:", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "Inoltra i commit senza tag dal proprio ramo locale al ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "Inoltra per revisione", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Inoltra commit per revisione codice Gerrit", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "Forza inoltra ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "Inoltra i commit senza tag dal proprio ramo locale al ramo remoto sostituendone il contenuto corrente", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "Inoltro remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "Seleziona ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "Scegli il ramo remoto.", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "Forza Inoltra tutti", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "Inoltra i commit e i tag dal ramo locale al ramo remoto sostituendo il contenuto attuale", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "Si sta per sostituire il contenuto del ramo remoto. Ciò può causare la perdita di commit per il repository.", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "<Pagina precedente", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "Mostra pagina precedente del log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "Mostra pagina precedente dei tag git", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "Pagina successiva >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "Mostra pagina successiva del log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "Mostra pagina successiva dei tag git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "Inoltra dal ramo locale al ramo remoto selezionato", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "Reimposta il ramo attivo allo stato di questo riferimento. Annulla tutte le modifiche staged e unstaged.", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "Il contenuto del ramo attivo verrà sostituito con commit \"${0}\". Tutte le modifiche staged e unstaged verranno annullate e non potranno essere ripristinate se \"${1}\" non è selezionato. Continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "Reimpostazione indice...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "Reimposta indice git per ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "Crea un tag per il commit", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "È in corso la configurazione del progetto. Potrebbe essere necessario un minuto...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "Ricerca del progetto: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "Nome tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "Elimina i tag dal repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "Si è sicuri di voler eliminare il tag  ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "Selezione personale", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "Commit Selezione personale: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "Ritorno al commit: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "Esegui la modifica introdotta dal commit al ramo attivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "Nessuna modifica", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". Si sono verificati alcuni conflitti.", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "Richiama dati dal ramo remoto al ramo di traccia remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Richiamo dati repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "Inoltra", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "Inoltra dal ramo locale al ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Inoltra repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "Chiave:", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "Valore:", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "Nuova voce di configurazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "Modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "Modifica voce di configurazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "Elimina voce di configurazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "Eliminare ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "Clona repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "Clona un repository git esistente in una cartella", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "Clonazione repository: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "Inizializza repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "Crea un nuovo repository Git in una nuova cartella", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "Inizializzazione repository ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Inizializza repository git", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "Elimina il repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "Si è sicuri di voler eliminare i repository ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "Applica una patch al repository selezionato", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "Mostra contenuto", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "Nome commit:", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "Apri commit", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "Apri commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "Apri commit con il nome dato", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "Nessun commit trovato", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "Sospendi modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "Messaggio commit:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "Commit delle modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "Recupero del messaggio di commit precedente", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "Ripristina modifiche locali", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "Esegui check out dei file ignorando tutte le modifiche", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "Mostra patch", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "Caricamento dello spazio di lavoro predefinito", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "Mostra modifiche dello spazio dei nomi come patch", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "Mostra modifiche controllate come patch", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "Mostra la patch per le modifiche in questo commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "Continua", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "Continua modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "Ignora patch", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "Interrompi", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "Annulla modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "Elimina", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "Ignora", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "Le modifiche ai file selezionati verranno ignorate e non sarà possibile recuperarle", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Richiamo del log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "Richiamo delle modifiche nascoste...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "Ramo attivo (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "Ramo (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "Tag (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "Commit (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "Stash (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "WIP su ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "indice su ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "Ramo remoto (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Git Log (Ramo attivo)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "Mostra il log per il ramo locale attivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Git Log (Ramo remoto)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "Mostra il log per il corrispondente ramo di traccia remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "Visualizza stato completo", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "Visualizza lo stato", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "Scegli ubicazione di destinazione", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "Ubicazione di destinazione predefinita", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "Cambia...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "Merge Squash", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "Integrare il contenuto del ramo nell'indice", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "Nome ramo locale:", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "locale", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "Filtra elementi", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "Filtra messaggi", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "Filtra autore", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "Filtra esecutore del commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "Filtra sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "Filtra da data YYYY-MM-DD o 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "Filtra a data YYYY-MM-DD o 1(h d w m y)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "Filtra percorso", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "Filtra rami remoti", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "Richiamo rami remoti ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "Richiamo dettagli remoti: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "Patch applicata correttamente", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "Applicazione patch non riuscita. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "Richiamo rami ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "Incolla il collegamento nell'email o nell'IM", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "Mostra commit in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "Mostra repository in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "Mostra il commit in GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "Mostra commit in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "Mostra il commit in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"Mostra repository in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"Mostra il repository in eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "Chiedi una revisione", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "Invia l'email con la richiesta di revisione del commit", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "Nome revisore", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "Richiesta revisione contributo", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "Invia il collegamento al revisore", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "File chiave privata (facoltativo):", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "Non chiedere nuovamente:", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "La chiave privata verrà salvata nel browser per ulteriori utilizzi", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "Caricamento richiesta revisione contributo...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "Impossibile trovare il commit nei seguenti repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "Provare ad aggiornare i propri repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "Crea nuovo repository", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "Collegare l'elemento remoto a uno dei propri repository esistenti", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "Si sta eseguendo la revisione del contributo ${0} da ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "Non è possibile trovare il commit nel proprio spazio di lavoro. Per visualizzarlo effettuare una delle seguenti operazioni: ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "Per revisionare il commit è possibile anche:", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "Richiesta di revisione contributo per ${0} su ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "Percorsi non funzionanti: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "Problema durante l'esecuzione dell'azione", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Vai alla pagina di repository Orion per fornire un URL del repository git. Una volta creato il repository, verrà visualizzato nel navigator.", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "File:", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "Inoltra", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "url git: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "Ripristina", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "Ripristina la modifica introdotta dal commit al ramo attivo", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". Impossibile ripristinare nel ramo attivo.", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "Accesso", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "Autenticazione obbligatoria per: ${0}. ${1} e ritentare la richiesta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"Salva", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"Ricorda il mio nome ed email committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"${0} modificato correttamente per ottenere il valore ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"${0} aggiunto correttamente con valore ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"Sign-off eseguito da: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"Change-Id: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"L'operazione di inoltro (push) è di tipo non-fastforward ed è stata rifiutata. Utilizzare l'operazione di richiamo (recupero) per visualizzare i nuovi commit che devono essere integrati.", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "Esegui commit e inoltra", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "Sincronizza", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "Eseguire il richiamo dal ramo remoto. Modificare i commit eliminandoli dal ramo locale, avviare il ramo locale nuovamente sulla base dello stato più recente del ramo remoto e applicare ciascun commit al ramo locale aggiornato. Inoltrare i commit ed i tag dal ramo locale al ramo remoto.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "Nessuna modifica", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "Nessun contenuto", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "In entrata", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "In uscita", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "In entrata (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "In uscita (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "Cronologia", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "Commit non eseguito", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "Repository:", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "Riferimento:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "Autore:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "Esecutore del commit", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "Mostra ramo attivo", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "Mostra riferimento", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "Visualizza la cronologia di ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "Visualizza la cronologia di \"${0}\" relativa a ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "commit", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "ramo remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "tag", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "Percorso:", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "Modifiche alla directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "Dettagli della directory di lavoro", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "Confronta (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "Nessun ramo", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "Nessun ramo attivo", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "Nessun riferimento selezionato", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "Nessuna", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} file selezionato", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} file selezionati", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} file modificato", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} file modificati", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "file", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "file", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "Non vi sono file selezionati. Continuare?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "Il commit è vuoto", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "modificato ${0} ${1}. pronto per essere sottoposto a commit ${2} ${3}.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "Esegui commit e inoltra", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "Esegue il commit ed inoltra i file al ramo remoto predefinito", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "Stash", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "Ignora tutte le modifiche correnti", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "Trascina", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "Rilascia il commit dall'elenco di stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "Applica", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "Stash a comparsa", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Applica la modifica nascosta più recente al ramo attivo e rilascia dagli stash", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "stash", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Repository Git", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Associa un repository git a questo progetto.",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Repository Git",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Crea un progetto da un repository git.",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'Recupera',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'Inoltra',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'Url:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Chiave privata ssh:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Passphrase Ssh:', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Esistono modifiche non salvate. Salvarle?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/es/gitmessages',{
	"Compare": "Comparar", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "Ver la comparación en paralelo", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "Abrir directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "Directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "Ver la versión del directorio de trabajo del archivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "Cargando...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "Todos los repositorios de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "Repositorios", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} en ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "Mostrar en eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "Mostrar en GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "Mostrar reste repositorio en GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "Detalles de confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "No hay confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "confirmación: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "padre: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "creado por ${0} <${1}> el ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "confirmado por ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "confirmados por ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "escritos por ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " activado ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "Etiquetas:", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "Sin etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "Cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "Modificaciones del directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "Confirmar cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "Confirmar cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "más ...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "menos ...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "Más", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "Más archivos", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "Cargando más archivos...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "Más confirmaciones para \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "Cargando más confirmaciones para \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "Más ramas para \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "Cargando más ramas para \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "Más etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "Cargando más etiquetas...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "Más acumulaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "Cargando más acumulaciones...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "Cargando registro de git...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "remota", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "Ver todo", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "Error ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "Cargando ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "Mensaje", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "Autor", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "Fecha", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "Fecha de inicio:", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "Fecha final:", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "Acciones", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "Ramas", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "Etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "Etapa", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "Eliminación sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "Sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "Eliminación por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "Cambio sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "Cambio por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "Adición sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "Adición por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "Adición", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "Supresión", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "Resolver conflicto", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "Conflictivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "Mensaje de confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "Comprometer", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "Confirmar los archivos seleccionados con el mensaje dado.", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"Autenticación necesaria para ${0}. <a target=\"_blank\" href=\"${1}\">${2}</a> y vuelva a intentar la solicitud. </span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "Especificar el mensaje de confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "Confirmar ${0} archivo(s)", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "Corregir última confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " Corregir", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "Cambio de base en curso. Elija la acción:", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "Cambio de base en curso.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "Cambie la base de las confirmaciones eliminándolas de la rama activa, volviendo a iniciar la rama activa basada en el último estado de \"${0}\" y aplicando de nuevo cada confirmación a la rama activa actualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Cambiando la base del repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Añadiendo la propiedad de configuración git: key=${0} value=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Editando la propiedad de configuración git: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Suprimiendo la propiedad de configuración git: key=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "Clonando repositorio: =${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "Cambiando la base de la rama.\n\n\tUtilice Continuar después de fusionar los conflictos y de seleccionar todos los archivos;\n\tOmitir para ignorar el parche actual;\n\tAbortar para finalizar el cambio de base en cualquier momento.", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "Nombre de confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "Nombre:", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "Correo electrónico:", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "Correo electrónico:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "Nombre de autor: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "Sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "Por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "Archivos modificados", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "Confirmaciones recientes en", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Estado de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "Abrir la página Estado de Git para el repositorio que contiene este archivo o carpeta.", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "Obtención de cambios entrantes de git...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "Extracción", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "Extrayendo...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "Definir la etapa del cambio", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "Definiendo etapas...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "Extraer todos los archivos seleccionados, descartando todos los cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "Añadir todos los archivos seleccionados a archivo(s) .gitignore", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "Escribiendo reglas de .gitignore", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "Guardar parche", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "Anular etapa del cambio", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "Anulando etapas...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "Deshacer", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "Revertir esta confirmación conservando todos los archivos cambiados sin hacer cambios en el directorio de trabajo.", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "El contenido de la rama activa se sustituirá por la confirmación \"${0}\". Se conservarán todos los cambios del directorio trabajo y confirmación. ¿Está seguro?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "Restablecer", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "Todos los cambios sin etapas y por etapas del directorio de trabajo y del índice se descartarán y no podrán recuperarse.\n\n¿Está seguro de que desea continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "Los cambios en los archivos seleccionados se descartarán y no podrán recuperarse.\n\n¿Está seguro de que desea continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "Restablecer la rama descartando todos los cambios por etapas y sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "Todos los cambios sin etapas y por etapas del directorio de trabajo y del índice se descartarán y no podrán recuperarse.", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "¿Está seguro de que desea continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "Conservar directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "Restableciendo cambios locales...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "Continuar cambio de base...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "Omitiendo parche...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "Anulando cambio de base...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "Registro completo", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "índice de VS local", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "índice VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "Comparar (${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "Cargando estado...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "Comprometiendo...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "El nombre del autor es necesario.", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "La dirección de correo electrónico del autor es necesaria.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". El repositorio todavía tiene conflictos.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". El repositorio contiene vías de acceso no fusionadas. Resuelva primero los conflictos.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "Representando ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "Configuración", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "Obteniendo configuración de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Obteniendo detalles de repositorio git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "Obteniendo cambios", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "Repositorios - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "Repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "Repositorio no encontrado", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "No hay repositorios", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "Cargando el repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "Cargando repositorios", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(no remoto)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "ubicación: ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} archivo(s) para definir etapa y ${1} archivo(s) para confirmar.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "No hay nada para confirmar.", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "No haya nada para enviar (push).", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} confirmaciones para enviar.", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "No tiene cambios por confirmar.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "Cambio de base en curso.", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "Ver todas las ramas de rastreo locales y remotas", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "seguimiento de ninguna rama", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "${0} seguimientos", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "última modificación ${0} realizada por ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "No hay ramas remotas", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "Ramas de representación", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "Confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "Obteniendo la rama actual para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "Ver registro completo", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "Ver el registro completo", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "Obteniendo confirmaciones para la rama de \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "Representando confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "Obteniendo confirmaciones de salida", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "La rama está actualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "No tiene ninguna confirmación de entrada ni de salida.", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") por ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "Obteniendo etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "Ver todas las etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " activado ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " por ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "Remotos", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "Representando remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "Sin remotos", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "Adición sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "Adición por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " (Cambio de base en curso)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "Estado", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "Registro (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "Registro (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "Estado para ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "No hay cambios sin etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "No hay cambios por etapas", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "Modificaciones para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "Confirmaciones para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "Confirmaciones para la rama \"${0}\" contra", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "Añadir remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "Nombre remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "URI remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "Aplicar parche", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "Aplicar parche", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "Abrir la página Repositorio Git para este archivo o carpeta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Clonar repositorio git", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Clonar repositorio git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "URL del repositorio:", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "Directorio existente:", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "Nueva carpeta:", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "Elegir carpeta", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "Mensaje:", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "Corregir:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "Corregir confirmación anterior", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "ID de cambio:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "Añadir ID de cambio al mensaje", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "Nombre de confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "Correo electrónico de confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "Escriba nombre de autor", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "Escriba correo electrónico de autor", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "Escriba nombre de confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "Escriba correo electrónico de confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "Nombre de autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "Correo electrónico de autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "El mensaje de confirmación es necesario.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Credenciales de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "Nombre de usuario:", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "Clave privada:", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "Frase de contraseña (opcional):", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "confirmar: ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "padre: ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "ramas: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "etiquetas: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "etiquetas", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " creado por ${0} (${1}) el ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "Contenido", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "Ir a la sección ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "Escriba el nombre de confirmación (sha1):", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "Buscar", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "Buscando...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "Seleccionar todo", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "Buscando la confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "Nueva rama:", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "No se ha seleccionado ningún remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "Escriba un nombre...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "Aceptar", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "Cancelar", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "Borrar", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "Filtrar", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "Filtrar confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "Conmuta el panel de filtrado de confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "Maximizar", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "Conmuta el estado maximización del editor", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [Nueva rama]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "¿Desea añadir la clave ${0} para el host ${1} para continuar con la operación? El valor de fingerpt clave es ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "Enlazar repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "Nombre de carpeta:", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "El repositorio estaba enlazado con ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "Extraer esta confirmación, creando una rama local basada en su contenido.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "Extraer este código, creando una rama local basada en su contenido.", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "Extrayendo ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "Extraer la rama o la rama local correspondiente y hacer que esté activa. Si la rama de seguimiento remoto no tiene una sucursal local correspondiente, la rama local se creará primero.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "Extrayendo la rama", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "Añadiendo rama ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "Eliminando rama ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "Añadiendo ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "Eliminando ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "Eliminando repositorio ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "Añadiendo etiqueta {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "Eliminando etiqueta {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "Fusionando ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : 'Anulando etapas de cambios', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "Extrayendo rama ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "La rama se ha extraído.", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "Nueva rama", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "Añadir una rama local al repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "Nombre de rama", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "Suprimir", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "Suprimir la rama local del repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "¿Seguro que desea suprimir la rama ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "Suprimir la rama de rastreo remota del repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "¿Está seguro?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "Va a suprimir la rama remota \"${0}\" y enviar el cambio.\n\n¿Está seguro?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "Eliminando rama remota: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "Suprimir rama remota", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "Remota nueva", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Remota Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "Abrir la página Registro Git remoto para este archivo o carpeta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "Añadir remota nueva al repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "Suprimir remota del repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "¿Seguro que desea suprimir la ${0} remota?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "Obtener", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "Obtener del repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "Obteniendo: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Obtener repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Registro de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "Abrir la página Registro Git local para este archivo o carpeta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "Abrir el registro para la rama", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "Abrir el registro para el repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "Abrir el estado para el repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "Mostrar en editor", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "Mostrar la carpeta de repositorio en el editor", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "Comparar entre sí", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "Comparar con árbol de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "Abrir", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "Ver el árbol para esta confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "Abrir confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "Ver la versión confirmada del archivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "Extracción", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "Obtener de remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "Contraseña:", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "Nombre de usuario:", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "Captando remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "Forzar captación", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "Captar la rama remota en la rama de rastreo remota sobrescribiendo su contenido actual.", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "Va a sobrescribir el contenido de la rama de rastreo remota. Esto puede provocar que la rama pierda las confirmaciones.", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "Fusionar", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "Fusionar contenido de la rama con la rama activa", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". Ir a ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Página de estado Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "Cambiar la base", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "Cambie la base de las confirmaciones; para ello, elimine la rama activa, inicie la rama activa en base al último estado de la rama seleccionada. ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "Cambiar la base encima de ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". Se han producido algunos conflictos. Resuélvalos y continúe, omita el parche o cancele el cambio de base.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". El estado del repositorio no es válido (ya existía durante el cambio de base).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". El repositorio contiene vías de acceso no fusionadas.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". El repositorio contiene cambios pendientes. Confírmelos u ocúltelos.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". Existen cambios no confirmados.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "Cambie la base de las confirmaciones eliminándolas de la rama activa, ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "iniciando la rama activa de nuevo en base al último estado de '", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "y aplicando de nuevo cada confirmación a la rama activa actualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "Enviar todo", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "Enviar confirmaciones y etiquetas de la rama local a la rama remota", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "Enviar rama", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "Resultado del envío:", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "Enviar confirmaciones sin etiquetas de la rama local a la rama remota", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "Enviar para revisión", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Enviar confirmaciones a la Revisión de código Gerrit", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "Forzar Enviar rama", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "Enviar confirmaciones sin etiquetas de la rama local a la rama remota sobrescribiendo el contenido actual", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "Enviar remota: ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "Elegir rama", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "Elegir la rama remota.", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "Forzar Enviar todo", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "Enviar confirmaciones y etiquetas de la rama local a la rama remota sobrescribiendo el contenido actual", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "Va a sobrescribir el contenido de la rama remota. Esto puede provocar que el repositorio remoto pierda las confirmaciones.", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "Página anterior de <", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "Mostrar página anterior del registro de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "Mostrar página anterior de códigos de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "Página siguiente >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "Mostrar página siguiente del registro de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "Mostrar página siguiente de códigos de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "Enviar de la rama local a la rama remota seleccionada", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "Restablecer la rama activa al estado de esta referencia. Descartar todos los cambios sin etapas y por etapas.", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "El contenido de la rama activa se sustituirá por la confirmación \"${0}\". Todos los cambios sin etapas y por etapas se descartarán y no se podrán recuperar si \"${1}\" no está marcado. ¿Está seguro?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "Restableciendo el índice...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "Restableciendo el índice Git para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "Código", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "Crear un código para la confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "Su proyecto se está configurando. Esto puede tardar un minuto...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "Se está buscando el proyecto: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "Nombre de código", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "Suprimir el código del repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "¿Seguro que desea suprimir el código ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "Cherry-Pick", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "Confirmación de Cherry Picking: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "Revertiendo confirmación: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "Aplicar el cambio introducido por la confirmación a la rama activa", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "No ha cambiado nada.", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". Se han producido algunos conflictos.", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "Captar la rama remota en la rama de rastreo remota", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Captar repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "Enviar", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "Enviar de la rama local a la rama remota", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Enviar repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "Clave:", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "Valor:", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "Nueva entrada de configuración", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "Editar", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "Editar la entrada de configuración", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "Suprimir la entrada de configuración", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "¿Está seguro de que desea suprimir ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "Clonar repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "Clonar un repositorio git existente en una carpeta", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "Clonando repositorio: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "Inicializar repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "Crear repositorio Git nuevo en una carpeta nueva", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "Inicializando repositorio: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Inicializando repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "Suprimir repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "¿Seguro que desea suprimir repositorios ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "Aplicar un parche en el repositorio seleccionado", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "Mostrar contenido", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "Nombre de confirmación:", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "Abrir confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "Abrir confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "Abra la confirmación con el nombre indicado", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "No se han encontrado confirmaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "Definiendo etapas de cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "Mensaje de confirmación:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "Confirmando cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "Captando mensaje de confirmación anterior", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "Restableciendo cambios locales", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "Extraer archivos, descartar todos los cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "Mostrar parche", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "Cargando espacio de trabajo predeterminado", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "Mostrar cambios de espacio de trabajo como parche", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "Mostrar cambios comprobados como parche", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "Mostrar el parche de los cambios en esta confirmación", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "Continuar", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "Continuar cambio de base", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "Omitir parche", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "Terminar anormalmente", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "Cancelar cambio de base", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "Descartar", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "Omitir", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "Los cambios en los archivos seleccionados se descartarán y no podrán recuperarse.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Obteniendo el registro de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "Obteniendo cambios acumulados...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "Rama activa (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "Rama (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "Código (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "Confirmación (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "Acumulación (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "Trabajo en curso en ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "índice en ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "Rama remota (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Registro de Git (rama activa)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "Mostrar registro para rama local activa", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Registro de Git (rama remota)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "Mostrar registro para la rama de rastro remota correspondiente", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "Ver estado completo", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "Ver el estado", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "Elegir ubicación de destino", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "Ubicación de destino predeterminada", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "Cambiar...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "Fusionar", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "Introducir el contenido de la rama en el índice", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "Nombre de rama local:", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "Filtrar elementos", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "Filtrar mensaje", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "Filtrar autor", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "Filtrar confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "Filtrar sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "Filtrar por fecha inicial AAAA-MM-DD o 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "Filtrar por fecha final AAAA-MM-DD o 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "Filtrar vía de acceso", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "Filtrar ramas remotas", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "Obteniendo ramas remotas ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "Obteniendo detalles remotos: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "Parche aplicado correctamente", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "No se ha podido aplicar el parche. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "Obteniendo ramas ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "Pegar enlace en correo electrónico o MI", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "Mostrar compromiso en GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "Mostrar repositorio en GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "Mostrar este compromiso en GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "Mostrar compromiso en eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "Mostrar este compromiso en eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"Mostrar repositorio en eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"Mostrar este repositorio en eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "Solicitar revisión", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "Enviar correo electrónico con solicitud de revisión de compromiso", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "Nombre de revisor", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "Solicitud de revisión de contribución", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "Enviar el enlace al revisor", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "Archivo de clave privada (opcional):", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "No preguntarme de nuevo:", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "La clave privada se guardará en el navegador para su uso en el futuro", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "Cargando solicitud de revisión de contribución...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "Puede encontrar la confirmación en los siguientes repositorios", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "Intente actualizar los repositorios", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "Crear nuevo repositorio", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "Adjuntar el repositorio remoto a uno de los repositorios existentes", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "Está revisando la contribución ${0} de ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "Lamentablemente, no se encuentra la confirmación en su espacio de trabajo. Para verla, pruebe una de las siguientes opciones: ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "Para revisar la confirmación también puede:", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "Solicitud de revisión de contribución de ${0} en ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "Vías de acceso anómalas: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "Se ha producido un problema al ejecutar la acción", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Vaya a la página de propiedades de Orion para proporcionar un URL de repositorio git. Una vez que se haya creado el repositorio, éste aparecerá en el navegador.", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "Archivo:", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "Enviar", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "URL de git: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "Revertir", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "Revertir el cambio introducido por la confirmación en la rama activa", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". No se ha podido revertir en una rama activa.", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "Iniciar sesión", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "Autenticación necesaria para ${0}. ${1} y vuelva a intentar la solicitud.", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"Guardar", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"Recordar mi nombre y correo electrónico de confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"Se ha editado ${0} satisfactoriamente para tener el valor ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"Se ha añadido ${0} satisfactoriamente con el valor ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"Aprobado por: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"ID de cambio: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"El envío no es de avance rápido y se ha rechazado. Utilice Extraer para ver confirmaciones nuevas que se deben fusionar.", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "Confirmar y enviar", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "Sincronizar", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "Extraer de la rama remota. Cambie la base de las confirmaciones eliminándolas de la rama local, volviendo a iniciar la rama local basada en el último estado de la rama remota y aplicando cada confirmación a la rama local actualizada. Enviar confirmaciones y etiquetas de la rama local a la rama remota.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "No hay cambios", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "Sin contenido", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "Entrante", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "Saliente", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "(${0}) de entrada", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "(${0}) de salida", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "Historial", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "No confirmado", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "Repositorio:", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "Referencia:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "Autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "Confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "Mostrar rama activa", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "Mostrar referencia", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "Ver el historial de ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "Ver el historial de \"${0}\" relativo a ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "comprometer", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "rama", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "rama remota", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "código", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "acumular", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "Vía de acceso:", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "Modificaciones del directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "Detalles del directorio de trabajo", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "Comparar (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "Ninguna rama", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "No hay rama activa", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "No hay referencia seleccionada", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "Ninguno", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} archivo seleccionado", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} archivos seleccionados", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} archivo modificado", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} archivos modificados", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "archivo", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "archivos", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "No tiene ningún archivo seleccionado. ¿Está seguro?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "La confirmación está vacía", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} modificado(s). ${2} ${3} preparado para confirmar.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "Confirmar y enviar", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "Confirma y envía archivos al remoto predeterminado", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "Acumular", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "acumulación@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "Acumular aparte todos los cambios actuales", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "Descartar", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "Descartar la confirmación de la lista de acumulación", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "Aplicar", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "Sacar acumulación", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Aplicar el cambio acumulado más recientemente a la rama activa y descartarlo de las acumulaciones", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "acumulaciones", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Repositorio Git", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Asociar un repositorio git con este proyecto.",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Repositorio Git",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Crear un proyecto a partir de un repositorio git.",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'Extracción',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'Enviar',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'URL:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Clave privada de SSH:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Frase de contraseña de SSH:', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Hay cambios no guardados. ¿Desea guardarlos?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/
/*eslint-env browser, amd*/

//NLS_CHARSET=UTF-8

define('git/nls/pt-br/gitmessages',{
	"Compare": "Comparação", //$NON-NLS-0$  //$NON-NLS-1$
	"View the side-by-side compare": "Visualizar a comparação lado a lado", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirVer": "Abrir diretório ativo", //$NON-NLS-0$  //$NON-NLS-1$
	"Working Directory": "Diretório de Trabalho", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewWorkingDirVer": "Visualizar a versão do diretório ativo do arquivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading...": "Carregando...", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories": "Todos os repositórios Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repo": "Repositórios", //$NON-NLS-0$  //$NON-NLS-1$
	"0 on 1 - Git": "${0} em ${1} - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git": "Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in eclipse.org": "Mostrar no eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show in GitHub": "Mostrar no GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in GitHub": "Mostrar esse repositório em GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit Details": "Detalhes de Confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"No Commits": "Sem Confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"commit: 0": "confirmação: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"parent: 0": "pai: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"authored by 0 (1) on 2": "de autoria de ${0} <${1}> em ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"committed by 0 (1)": "confirmado por ${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"committedby": "confirmado por ", //$NON-NLS-0$  //$NON-NLS-1$
	"authoredby": "autoria de ", //$NON-NLS-0$  //$NON-NLS-1$
	"on": " em ", //$NON-NLS-0$  //$NON-NLS-1$
	"nameEmail": "${0} <${1}>", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags:": "Tags:", //$NON-NLS-0$  //$NON-NLS-1$
	"No Tags": "Nenhum Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Diffs": "Mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"WorkingDirChanges": "Mudanças no diretório ativo", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChanges": "Confirmar Mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitChangesDialog": "Confirmar Mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"more": "mais ...", //$NON-NLS-0$  //$NON-NLS-1$
	"less": "menos ...", //$NON-NLS-0$  //$NON-NLS-1$
	"More": "Mais", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFiles" : "Mais Arquivos", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreFilesProgress": "Carregando mais arquivos...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommits": "Mais confirmações para \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreCommitsProgress": "Carregando mais confirmações para \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranches": "Mais ramificações para \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreBranchesProgress": "Carregando mais ramificações para \"${0}\"...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTags": "Mais tags", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreTagsProgress": "Carregando mais tags...", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashes": "Mais armazenamentos em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	"MoreStashesProgress": "Carregando mais armazenamentos em arquivo stash...", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading git log...": "Carregando o log git...", //$NON-NLS-0$  //$NON-NLS-1$
	"local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"remote": "remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"View All": "Exibir Tudo", //$NON-NLS-0$  //$NON-NLS-1$
	"Error ${0}: ": "Erro ${0}: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading ": "Carregando ", //$NON-NLS-0$  //$NON-NLS-1$
	"Message": "Mensagem", //$NON-NLS-0$  //$NON-NLS-1$
	"Author": "Autor", //$NON-NLS-0$  //$NON-NLS-1$
	"Date": "Data", //$NON-NLS-0$  //$NON-NLS-1$
	"fromDate:": "Data de Início:", //$NON-NLS-0$  //$NON-NLS-1$
	"toDate:": "Data de Encerramento:", //$NON-NLS-0$  //$NON-NLS-1$
	"Actions": "Ações", //$NON-NLS-0$  //$NON-NLS-1$
	"Branches": "Ramificações", //$NON-NLS-0$  //$NON-NLS-1$
	"Tags": "Tags", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage": "Colocar em ambiente Temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged removal": "Remoção feita fora de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage": "Remover de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged removal": "Remoção feita em ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged change": "Mudança feita fora de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged change": "Mudança feita em ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged add": "Inclusão feita fora de espaço temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged add": "Inclusão feita em ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Addition": "Adição", //$NON-NLS-0$  //$NON-NLS-1$
	"Deletion": "Exclusão", //$NON-NLS-0$  //$NON-NLS-1$
	"Resolve Conflict": "Resolver Conflito", //$NON-NLS-0$  //$NON-NLS-1$
	"Conflicting": "Em Conflito", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message": "Confirmar mensagem", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit": "Confirmar", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitTooltip": "Confirme os arquivos selecionados com a mensagem fornecida.", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthMsgLink":"Autenticação requerida para: ${0}. <a target=\"_blank\" href=\"${1}\">${2}</a> e tente a solicitação novamente. </span>", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCommit": "Insira a mensagem de confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartCountCommit": "Confirmar ${0} arquivo(s)", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend last commit": "Aditar última confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	" Amend": " Aditar", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress. Choose action:": "Criação de nova base em andamento. Escolher ação:", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgress": "Rebaseamento em progresso", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseTip": "Rebaseie suas confirmações removendo-as da ramificação ativa, iniciando a ramificação ativa novamente com base no estado mais recente de \"${0}\" e aplicando cada confirmação novamente à ramificação ativa atualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebasingRepo": "Rebaseando o repositório git", //$NON-NLS-0$  //$NON-NLS-1$
	"AddingConfig": "Incluindo a propriedade de configuração do git: chave=${0} valor=${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"EditingConfig": "Editando a propriedade de configuração do git: chave=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"DeletingConfig": "Excluindo a propriedade de configuração do git: chave=${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"AddClone": "Clonando o repositório: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseProgressDetails": "Rebaseando a ramificação.\n\n\tUse Continuar depois de mesclar os conflitos e selecionar todos os arquivos;\n\tIgnore para efetuar bypass da correção atual;\n\tInterrompa para terminar a criação de nova base a qualquer momento.", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer name:": "Nome do Committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"Name:": "Nome:", //$NON-NLS-0$  //$NON-NLS-1$
	"email:": "e-mail:", //$NON-NLS-0$  //$NON-NLS-1$
	"Email:": "E-mail:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author name: ": "Nome do autor: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged": "Fora de Ambiente Temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged": "Em Ambiente Temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangedFiles": "Arquivos alterados", //$NON-NLS-0$  //$NON-NLS-1$
	"Recent commits on": "Confirmações recentes sobre", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status": "Status de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Status": "Abra a página de status do Git para o repositório que contém este arquivo ou pasta.", //$NON-NLS-0$  //$NON-NLS-1$
	"GetGitIncomingMsg": "Obtendo mudanças do git recebido...", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout": "Check-out", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out...": "Fazendo check-out...", //$NON-NLS-0$  //$NON-NLS-1$
	"Stage the change": "Fazer mudança em ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging...": "Configurando...", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutSelectedFiles": "Efetuar check-out em todos os arquivos selecionados, descartando todas as mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"AddFilesToGitignore" : "Inclua todos os arquivos selecionados no(s) arquivo(s) .gitignore", //$NON-NLS-0$  //$NON-NLS-1$
	"Writing .gitignore rules" : "Gravando regras .gitignore", //$NON-NLS-0$  //$NON-NLS-1$ 
	"Save Patch": "Salvar Correção", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstage the change": "Remover mudanças de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaging...": "Não configurando...", //$NON-NLS-0$  //$NON-NLS-1$
	"Undo": "Desfazer", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoTooltip": "Reverta esta confirmação, mantendo todos os arquivos alterados e não fazendo qualquer mudança no diretório ativo.", //$NON-NLS-0$  //$NON-NLS-1$
	"UndoConfirm": "O conteúdo de sua ramificação ativa será substituído pela confirmação \"${0}\". Todas as mudanças na confirmação e no diretório ativo serão mantidas. Tem certeza?", //$NON-NLS-0$  //$NON-NLS-1$
	"Reset": "Reconfigurar", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetConfirm": "Todas as mudanças estagiadas e não estagiadas no diretório ativo e no índice serão descartadas e não poderão ser recuperadas.\n\nTem certeza de que deseja continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutConfirm" : "Suas mudanças nos arquivos selecionados serão descartadas e não poderão ser recuperadas.\n\nTem certeza que deseja continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetBranchDiscardChanges": "Reconfigurar a ramificação, descartando todas as mudanças em ambiente temporário e fora de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesIndexDiscardedMsg": "Todas as mudanças em ambiente temporário e fora de ambiente temporário no diretório ativo e no índice serão descartadas e não poderão ser recuperadas.", //$NON-NLS-0$  //$NON-NLS-1$
	"ContinueMsg": "Tem certeza que deseja continuar?", //$NON-NLS-0$  //$NON-NLS-1$
	"KeepWorkDir" : "Manter diretório ativo", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes...": "Reconfigurando mudanças locais...", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue rebase...": "Continuar a criação de nova base...", //$NON-NLS-0$  //$NON-NLS-1$
	"Skipping patch...": "Ignorando correção...", //$NON-NLS-0$  //$NON-NLS-1$
	"Aborting rebase...": "Interrompendo criação de nova base...", //$NON-NLS-0$  //$NON-NLS-1$
	"Complete log": "Concluir log", //$NON-NLS-0$  //$NON-NLS-1$
	"local VS index": "índice VS local", //$NON-NLS-0$  //$NON-NLS-1$
	"index VS HEAD": "índice VS HEAD", //$NON-NLS-0$  //$NON-NLS-1$
	"Compare(${0} : ${1})": "Comparar (${0} : ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading status...": "Carregando status...", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing...": "Confirmando...", //$NON-NLS-0$  //$NON-NLS-1$
	"The author name is required.": "O nome do autor é necessário.", //$NON-NLS-0$  //$NON-NLS-1$
	"The author mail is required.": "O correio do autor necessário.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoConflict": ". O repositório ainda contém conflitos.", //$NON-NLS-0$  //$NON-NLS-1$
	"RepoUnmergedPathResolveConflict": ". O repositório contém caminhos não mesclados. Resolva os conflitos primeiro.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering ${0}": "Renderização ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Configuration": "Configuração", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting configuration of": "Obtendo a configuração de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting git repository details": "Obtendo detalhes do repositório git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting changes": "Obtendo mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	" - Git": " - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repositories - Git": "Repositórios - Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository": "Repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository Not Found": "Repositório Não Localizado", //$NON-NLS-0$  //$NON-NLS-1$
	"No Repositories": "Nenhum Repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repository": "Carregando repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading repositories": "Carregando repositórios", //$NON-NLS-0$  //$NON-NLS-1$
	"(no remote)": "(nenhum remoto)", //$NON-NLS-0$  //$NON-NLS-1$
	"location: ": "local: ", //$NON-NLS-0$  //$NON-NLS-1$
	"NumFilesStageAndCommit": "${0} arquivo(s) a ser(em) colocado(s) em ambiente temporário e ${1} arquivo(s) a ser(em) confirmado(s).", //$NON-NLS-0$  //$NON-NLS-1$
 	"Nothing to commit.": "Nada a ser confirmado.", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing to push.": "Nada a ser enviado por push.", //$NON-NLS-0$  //$NON-NLS-1$
	"NCommitsToPush": "${0} confirmação(ões) a ser(em) enviada(s) por push.", //$NON-NLS-0$  //$NON-NLS-1$
	"You have no changes to commit.": "Você não possui mudanças a serem confirmadas.", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase in progress!": "Criação de nova base em andamento!", //$NON-NLS-0$  //$NON-NLS-1$
	"View all local and remote tracking branches": "Visualizar todas as ramificações de rastreamento local e remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"tracksNoBranch": "não controla nenhuma ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"tracks": "controla ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"last modified ${0} by ${1}": "última modificação ${0} por ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remote Branches": "Nenhuma Ramificação Remota", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering branches": "Ramificações de renderização", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits": "Confirmações", //$NON-NLS-0$  //$NON-NLS-1$
	"GettingCurrentBranch": "Obtendo ramificação atual para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Log": "Consultar Log Integral", //$NON-NLS-0$  //$NON-NLS-1$
	"See the full log": "Consulte o log integral", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting commits for \"${0}\" branch": "Obtendo confirmações para a ramificação \"${0}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering commits": "Confirmações de renderização", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting outgoing commits": "Obtendo confirmações de saída", //$NON-NLS-0$  //$NON-NLS-1$
	"The branch is up to date.": "A ramificação está atualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoOutgoingIncomingCommits": "Você não possui nenhuma confirmação de saída ou recebida.", //$NON-NLS-0$  //$NON-NLS-1$
 	") by ": ") por ", //$NON-NLS-0$  //$NON-NLS-1$
	" (SHA ": " (SHA ", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting tags": "Obtendo tags", //$NON-NLS-0$  //$NON-NLS-1$
	"View all tags": "Visualizar todas as tags", //$NON-NLS-0$  //$NON-NLS-1$
	" on ": " em ", //$NON-NLS-0$  //$NON-NLS-1$
	" by ": " por ", //$NON-NLS-0$  //$NON-NLS-1$
	"Remotes": "Remotos", //$NON-NLS-0$  //$NON-NLS-1$
	"Rendering remotes": "Remotos de Renderização", //$NON-NLS-0$  //$NON-NLS-1$
	"No Remotes": "Nenhum Remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Unstaged addition": "Adição fora de ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Staged addition": "Adição feita em ambiente temporário", //$NON-NLS-0$  //$NON-NLS-1$
	" (Rebase in Progress)": " (Criação de Nova Base em Andamento)", //$NON-NLS-0$  //$NON-NLS-1$
	"Status": "Status", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0)": "Log (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Log (0) - 1": "Log (${0}) - ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Status for ${0} - Git ": "Status para ${0} - Git ", //$NON-NLS-0$  //$NON-NLS-1$
	"No Unstaged Changes": "Nenhuma Mudança Feita em Ambiente Temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"No Staged Changes": "Nenhuma Mudança em Ambiente Temporário", //$NON-NLS-0$  //$NON-NLS-1$
	"Changes for \"${0}\" branch": "Mudanças para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch": "Confirmações para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits for \"${0}\" branch against": "Confirmações para a ramificação \"${0}\" com relação a", //$NON-NLS-0$  //$NON-NLS-1$
	"Add Remote": "Incluir Remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Name:": "Nome do Remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote URI:": "URI do Remoto:", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply Patch": "Aplicar Correção", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyPatchDialog": "Aplicar Correção", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Repository": "Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the git repository": "Abra a página Repositório Git para este arquivo ou pasta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Git Repository": "Clonar Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"CloneGitRepositoryDialog": "Clonar Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository URL:": "URL do Repositório:", //$NON-NLS-0$  //$NON-NLS-1$
	"Existing directory:": "Diretório existente:", //$NON-NLS-0$  //$NON-NLS-1$
	"New folder:": "Nova pasta:", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseFolderDialog": "Escolher uma Pasta", //$NON-NLS-0$  //$NON-NLS-1$
	"Message:": "Mensagem :", //$NON-NLS-0$  //$NON-NLS-1$
	"Amend:": "Aditar:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartAmend": "Aditar confirmação anterior", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangeId:": "ChangeId:", //$NON-NLS-0$  //$NON-NLS-1$
	"SmartChangeId": "Incluir ID de mudança na mensagem", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Name:": "Nome do Confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer Email:": "E-mail do Confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorNamePlaceholder": "Inserir nome do autor", //$NON-NLS-0$  //$NON-NLS-1$
	"AuthorEmailPlaceholder": "Inserir e-mail do autor", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterNamePlaceholder": "Inserir nome do confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitterEmailPlaceholder": "Inserir e-mail do confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Name:": "Nome do Autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author Email:": "E-mail do Autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit message is required.": "A mensagem de confirmação é necessária.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Credentials": "Credenciais de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Username:": "Nome do usuário:", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key:": "Chave Privada:", //$NON-NLS-0$  //$NON-NLS-1$
	"Passphrase (optional):": "Passphrase (opcional):", //$NON-NLS-0$  //$NON-NLS-1$
	"commit:": "confirmação: ", //$NON-NLS-0$  //$NON-NLS-1$
	"parent:": "pai: ", //$NON-NLS-0$  //$NON-NLS-1$
	"branches: ": "ramificações: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags: ": "Tags: ", //$NON-NLS-0$  //$NON-NLS-1$
	"tags": "tags", //$NON-NLS-0$  //$NON-NLS-1$
	" authored by ${0} {${1}) on ${2}": " de autoria de ${0} (${1}) em ${2}", //$NON-NLS-0$  //$NON-NLS-1$
	"Content": "Conteúdo", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to ${0} section": "Acessar seção ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Type the commit name (sha1):": "Digitar o nome de confirmação (sha1):", //$NON-NLS-0$  //$NON-NLS-1$
	"Search": "Pesquisar", //$NON-NLS-0$  //$NON-NLS-1$
	"Searching...": "Procurando...", //$NON-NLS-0$  //$NON-NLS-1$
	"SelectAll": "Selecionar Todos", //$NON-NLS-0$  //$NON-NLS-1$
	"Looking for the commit": "Procurando a confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch:": "Nova ramificação:", //$NON-NLS-0$  //$NON-NLS-1$
	"No remote selected": "Nenhum remoto selecionado", //$NON-NLS-0$  //$NON-NLS-1$
	"Enter a name...": "Inserir um nome...", //$NON-NLS-0$  //$NON-NLS-1$
	"OK": "OK", //$NON-NLS-0$  //$NON-NLS-1$
	"Cancel": "Cancelar", //$NON-NLS-0$  //$NON-NLS-1$
	"Clear": "Limpar", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter": "Filtro", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommits": "Filtrar confirmações", //$NON-NLS-0$  //$NON-NLS-1$
	"FilterCommitsTip": "Alterna o painel de confirmações de filtro", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeCmd": "Maximizar", //$NON-NLS-0$  //$NON-NLS-1$
	"MaximizeTip": "Alterna o estado maximizar do editor", //$NON-NLS-0$  //$NON-NLS-1$
	" [New branch]": " [Nova ramificação]", //$NON-NLS-0$  //$NON-NLS-1$
	"AddKeyToHostContinueOp": "Deseja incluir a chave ${0} no host ${1} para continuar a operação? A chave fingerpt é ${2}.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Link Repository": "Repositório de Link", //$NON-NLS-0$  //$NON-NLS-1$
	"Folder name:": "Nome da Pasta:", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository was linked to ": "O repositório foi vinculado a ", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutCommitTooltip": "Efetue check-out dessa confirmação, criando uma ramificação local com base em seu conteúdo.", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutTagTooltip": "Efetue check-out dessa tag, criando uma ramificação local com base em seu conteúdo.", //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out ${0}": "Efetuando check-out de ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"CheckoutBranchMsg": "Efetue check-out da ramificação ou da ramificação local correspondente e torne-a ativa. Se a ramificação de rastreamento remoto não tiver uma ramificação local correspondente, a ramificação local será criada primeiro.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Checking out branch...": "Efetuando check-out da ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding branch ${0}...": "Incluindo a ramificação ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing branch ${0}...": "Removendo a ramificação ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding remote ${0}...": "Incluindo ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote ${0}...": "Removendo ${0} remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing repository ${0}": "Removendo o repositório ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Adding tag {$0}": "Incluindo a tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing tag {$0}": "Removendo a tag {$0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Merging ${0}": "Mesclando ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	'Unstaging changes' : 'Removendo estágio de mudanças', //$NON-NLS-0$  //$NON-NLS-1$
	"Checking out branch ${0}...": "Efetuando check-out da ramificação ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch checked out.": "Ramificação com check-out efetuado.", //$NON-NLS-0$  //$NON-NLS-1$
	"New Branch": "Nova Ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new local branch to the repository": "Incluir uma nova ramificação local no repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch name": "Nome da ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete": "Excluir", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the local branch from the repository": "Excluir a ramificação local do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"DelBrConfirm": "Tem certeza de que deseja excluir a ramificação ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote tracking branch from the repository": "Excluir a ramificação de rastreamento remoto do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure?": "Tem certeza?", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoveRemoteBranchConfirm": "Você excluirá a ramificação remota \"${0}\" e enviará a mudança por push.\n\nTem certeza?", //$NON-NLS-0$  //$NON-NLS-1$
	"Removing remote branch: ": "Removendo a ramificação remota: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete Remote Branch": "Excluir Ramificação Remota", //$NON-NLS-0$  //$NON-NLS-1$
	"New Remote": "Novo Remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Remote": "Remoto de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Remote": "Abra a página de log de Git remoto para este arquivo ou pasta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Add a new remote to the repository": "Incluir um novo remoto no repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the remote from the repository": "Excluir o remoto do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete remote ${0}?": "Tem certeza de que deseja excluir o ${0} remoto?", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull": "Pull", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull from the repository": "Efetuar pull do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Pulling: ": "Efetuando pull: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Pull Git Repository": "Efetuar Pull do Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Log": "Log Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to Git Log": "Abra a página de log de Git local para este arquivo ou pasta.", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the branch": "Abrir o log da ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the log for the repository": "Abrir o log do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the status for the repository": "Abrir o status do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditor": "Mostrar no editor", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowInEditorTooltip": "Mostrar a pasta do repositório no editor", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareEach": "Comparar Um com o Outro", //$NON-NLS-0$  //$NON-NLS-1$
 	"Compare With Working Tree": "Comparar com a Árvore de Trabalho", //$NON-NLS-0$  //$NON-NLS-1$
	"Open": "Abrir", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenGitCommitTip": "Visualizar a árvore para esta confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitVersion": "Abrir Confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"ViewCommitVersionTip": "Visualizar a versão confirmada do arquivo", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch": "Buscar", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote": "Buscar a partir do Remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Password:": "Senha:", //$NON-NLS-0$  //$NON-NLS-1$
	"User Name:": "Nome do Usuário:", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching remote: ": "Buscando remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Fetch": "Forçar Busca", //$NON-NLS-0$  //$NON-NLS-1$
	"FetchRemoteBranch": "Buscar da ramificação remota para a ramificação de rastreamento remoto substituindo seu conteúdo atual", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentRemoteTrackingBr": "Você está substituindo o conteúdo da ramificação de rastreamento remoto. Isso pode fazer com que a ramificação perca as confirmações.", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge": "Mesclar", //$NON-NLS-0$  //$NON-NLS-1$
	"MergeContentFrmBr": "Mescle o conteúdo da ramificação para a ramificação ativa", //$NON-NLS-0$  //$NON-NLS-1$
 	". Go to ${0}.": ". Acessar ${0}.", //$NON-NLS-0$  //$NON-NLS-1$
	"Git Status page": "Página Status de Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Rebase": "Criar Nova Base", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsMsg": "Criar a nova base das confirmações removendo-as da ramificação ativa, iniciando a ramificação ativa novamente com base no último estado da ramificação selecionada ", //$NON-NLS-0$  //$NON-NLS-1$
 	"Rebase on top of ": "Criar nova base na parte superior de ", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseSTOPPED": ". Ocorreram alguns conflitos. Resolva-os e continue, ignore a correção ou interrompa a criação de nova base.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_WRONG_REPOSITORY_STATE": ". O estado do repositório é inválido (ou seja, já durante a criação de nova base).", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_UNMERGED_PATHS": ". O repositório contém caminhos não mesclados.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseFAILED_PENDING_CHANGES": ". O repositório contém mudanças pendentes. Confirme-as ou armazene-as em arquivo stash.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseUNCOMMITTED_CHANGES": ". Há mudanças não confirmadas.", //$NON-NLS-0$  //$NON-NLS-1$
	"RebaseCommitsByRmvingThem": "Criar a nova base das confirmações removendo-as da ramificação ativa, ", //$NON-NLS-0$  //$NON-NLS-1$
	"StartActiveBranch": "iniciando a ramificação ativa novamente com base no último estado de '", //$NON-NLS-0$  //$NON-NLS-1$
	"ApplyEachCommitAgain": "e aplicando cada confirmação novamente à ramificação ativa atualizada.", //$NON-NLS-0$  //$NON-NLS-1$
	"Push All": "Enviar Todos por Push", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocal": "Enviar por push confirmações e tags da ramificação local para a ramificação remota", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push Branch": "Enviar ramificação por push", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushResult": "Resultado de push:", //$NON-NLS-0$  //$NON-NLS-1$
 	"PushCommitsWithoutTags": "Enviar por push confirmações sem tags da ramificação local para a ramificação remota", //$NON-NLS-0$  //$NON-NLS-1$
 	"Push for Review": "Enviar por push para revisão", //$NON-NLS-0$  //$NON-NLS-1$
	"Push commits to Gerrit Code Review": "Enviar por push confirmações para revisão de código Gerrit", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push Branch": "Forçar envio de ramificação por push", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsWithoutTagsOverridingCurrentContent": "Enviar por push confirmações sem tags da ramificação local para a ramificação remota substituindo seu conteúdo atual", //$NON-NLS-0$  //$NON-NLS-1$
 	"Pushing remote: ": "Pushing remoto: ", //$NON-NLS-0$  //$NON-NLS-1$
	"ChooseBranchDialog": "Escolher Ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose the remote branch.": "Escolha a ramificação remota.", //$NON-NLS-0$  //$NON-NLS-1$
	"Force Push All": "Forçar Envio por Push em Todos", //$NON-NLS-0$  //$NON-NLS-1$
	"PushCommitsTagsFrmLocalBr": "Enviar por push confirmações e tags da ramificação local para a ramificação remota substituindo seu conteúdo atual", //$NON-NLS-0$  //$NON-NLS-1$
	"OverrideContentOfRemoteBr": "Você está substituindo o conteúdo da ramificação remota. Isso pode fazer com que o repositório remoto perca as confirmações.", //$NON-NLS-0$  //$NON-NLS-1$
	"< Previous Page": "< Página Anterior", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git log": "Mostrar a página de log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show previous page of git tags" : "Mostrar a página anterior de tags de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Next Page >": "Próxima Página >", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git log": "Mostrar próxima página de log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Show next page of git tags" : "Mostrar próxima página de tags de git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the selected remote branch": "Enviar por push da ramificação local para a ramificação remota selecionada", //$NON-NLS-0$  //$NON-NLS-1$
	"ResetActiveBr": "Reconfigure a ramificação ativa para o estado dessa referência. Descartar todas as mudanças fora e em ambiente temporário.", //$NON-NLS-0$  //$NON-NLS-1$
 	"GitResetIndexConfirm": "O conteúdo de sua ramificação ativa será substituído pela confirmação \"${0}\". Todas as mudanças estagiadas e não estagiadas serão descartadas e não poderão ser recuperadas se \"${1}\" não estiver marcado. Tem certeza?", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting index...": "Reconfigurando o índice...", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting git index for ${0}" : "Reconfigurando o índice do git para ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag": "Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a tag for the commit": "Criar uma tag para a confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"ProjectSetup": "Seu projeto está sendo configurado. Isso pode demorar um tempo...", //$NON-NLS-0$  //$NON-NLS-1$
	"LookingForProject": "Procurando projeto: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag name": "Nome da Tag", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the tag from the repository": "Excluir a tag do repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete tag ${0}?": "Tem certeza de que deseja excluir a tag ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Cherry-Pick": "Escolhas mais Confortáveis", //$NON-NLS-0$  //$NON-NLS-1$
	"CherryPicking": "Confirmação das escolhas mais confortáveis: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"RevertingCommit": "Revertendo a confirmação: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the change introduced by the commit to your active branch": "Aplicar a mudança apresentada pela confirmação à ramificação ativa", //$NON-NLS-0$  //$NON-NLS-1$
	"Nothing changed.": "Nada foi alterado.", //$NON-NLS-0$  //$NON-NLS-1$
	". Some conflicts occurred": ". Ocorreram alguns conflitos.", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch from the remote branch into your remote tracking branch": "Buscar da ramificação remota para a ramificação de rastreamento remoto", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetch Git Repository": "Buscar Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Push": "Push", //$NON-NLS-0$  //$NON-NLS-1$
	"Push from your local branch into the remote branch": "Enviar por push da ramificação local para a ramificação remota", //$NON-NLS-0$  //$NON-NLS-1$
	"Push Git Repository": "Enviar o Repositório Git por Push", //$NON-NLS-0$  //$NON-NLS-1$
	"Key:": "Chave:", //$NON-NLS-0$  //$NON-NLS-1$
	"Value:": "Valor:", //$NON-NLS-0$  //$NON-NLS-1$
	"New Configuration Entry": "Nova Entrada de Configuração", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit": "Editar", //$NON-NLS-0$  //$NON-NLS-1$
	"Edit the configuration entry": "Editar a entrada de configuração", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the configuration entry": "Excluir a entrada de configuração", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want to delete ${0}?": "Tem certeza de que deseja excluir ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone Repository": "Clonar Repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Clone an existing Git repository to a folder": "Clonar um Repositório Git existente para uma pasta", //$NON-NLS-0$  //$NON-NLS-1$
	"Cloning repository: ": "Clonando o repositório: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Repository": "Inicializar Repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Create a new Git repository in a new folder": "Criar um novo Repositório Git em uma nova pasta", //$NON-NLS-0$  //$NON-NLS-1$
	"Initializing repository: ": "Inicializando o repositório: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Init Git Repository": "Inicializar Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	"Delete the repository": "Excluir o repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Are you sure you want do delete ${0} repositories?": "Tem certeza de que deseja excluir os repositórios ${0}?", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply a patch on the selected repository": "Aplicar uma correção no repositório selecionado", //$NON-NLS-0$  //$NON-NLS-1$
	"Show content": "Mostrar conteúdo", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit name:": "Confirmar nome:", //$NON-NLS-0$  //$NON-NLS-1$
	"Open Commit": "Abrir Confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"OpenCommitDialog": "Abrir Confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"Open the commit with the given name": "Abrir a confirmação com o nome dado", //$NON-NLS-0$  //$NON-NLS-1$
	"No commits found": "Nenhuma confirmação localizada", //$NON-NLS-0$  //$NON-NLS-1$
	"Staging changes": "Configurando mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit message:": "Confirmar mensagem:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committing changes": "Confirmando Alterações", //$NON-NLS-0$  //$NON-NLS-1$
	"Fetching previous commit message": "Buscando mensagem de confirmação anterior", //$NON-NLS-0$  //$NON-NLS-1$
	"Resetting local changes": "Reconfigurando as mensagens locais", //$NON-NLS-0$  //$NON-NLS-1$
	"Checkout files, discarding all changes": "Efetuar check-out de arquivos, descartando todas as mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Patch": "Mostrar Correção", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading default workspace": "Carregando área de trabalho padrão", //$NON-NLS-0$  //$NON-NLS-1$
	"Show workspace changes as a patch": "Mostrar as mudanças da área de trabalho como uma correção", //$NON-NLS-0$  //$NON-NLS-1$
	"Show checked changes as a patch": "Mostrar mudanças verificadas como uma correção", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowCommitPatchTip": "Mostrar correção para mudanças nesta confirmação", //$NON-NLS-0$  //$NON-NLS-1$
	"Continue": "Continuar", //$NON-NLS-0$  //$NON-NLS-1$
	"Contibue Rebase": "Continuar o rebaseamento", //$NON-NLS-0$  //$NON-NLS-1$
	"Skip Patch": "Ignorar Correção", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort": "Interromper", //$NON-NLS-0$  //$NON-NLS-1$
	"Abort Rebase": "Interromper Criação de Nova Base", //$NON-NLS-0$  //$NON-NLS-1$
	"Discard": "Descartar", //$NON-NLS-0$  //$NON-NLS-1$
	"Ignore": "Ignorar", //$NON-NLS-0$  //$NON-NLS-1$
	"ChangesSelectedFilesDiscard": "As mudanças nos arquivos selecionados serão descartadas e não poderão ser recuperadas.", //$NON-NLS-0$  //$NON-NLS-1$
 	"Getting git log": "Obtendo log git", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting stashed changes...": "Obtendo mudanças do armazenamento em arquivo stash...", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch (${0})": "Ramificação ativa (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Branch (${0})": "Ramificação (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Tag (${0})": "Tag (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit (${0})": "Confirmação (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommit (${0})": "Armazenamento em arquivo stash (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"WIPStash": "WIP em ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"IndexStash": "índice em ${0}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranch (${0})": "Ramificação Remota (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Active Branch Log": "Log Git (Ramificação Ativa)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the active local branch": "Mostrar o log da ramificação local ativa", //$NON-NLS-0$  //$NON-NLS-1$
	"Remote Branch Log": "Log Git (Ramificação Remota)", //$NON-NLS-0$  //$NON-NLS-1$
	"Show the log for the corresponding remote tracking branch": "Mostrar o log da ramificação de rastreamento remoto correspondente", //$NON-NLS-0$  //$NON-NLS-1$
	"See Full Status" : "Consulte o Status Integral", //$NON-NLS-0$  //$NON-NLS-1$
	"See the status" : "Consulte o status", //$NON-NLS-0$  //$NON-NLS-1$
	"Choose target location" : "Escolha o local de destino", //$NON-NLS-0$  //$NON-NLS-1$
	"Default target location" : "Local de destino padrão", //$NON-NLS-0$  //$NON-NLS-1$
	"Change..." : "Alterar...", //$NON-NLS-0$  //$NON-NLS-1$
	"Merge Squash": "Mesclar Squash", //$NON-NLS-0$  //$NON-NLS-1$
	"Squash the content of the branch to the index" : "Efetuar squash do conteúdo da ramificação para o índice", //$NON-NLS-0$  //$NON-NLS-1$
	"Local Branch Name:" : "Nome da Filial Local:", //$NON-NLS-0$  //$NON-NLS-1$
	"Local": "local", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter items" : "Filtrar itens", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter filter" : "Filtrar mensagem", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter author" : "Filtrar autor", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter committer" : "Filtrar confirmador", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter sha1" : "Filtrar sha1", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter fromDate" : "Filtrar a partir da data AAAA-MM-DD ou 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter toDate" : "Filtrar até a data AAAA-MM-DD ou 1(h d s m a)", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter path" : "Filtrar caminho", //$NON-NLS-0$  //$NON-NLS-1$
	"Filter remote branches" : "Filtrar filiais remotas", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote branches" : "Obtendo ramificações remotas ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting remote details": "Obtendo detalhes remotos: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchApplied": "Correção aplicada com sucesso", //$NON-NLS-0$  //$NON-NLS-1$
	"PatchFailed": "Falha ao aplicar correção. ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Getting branches" : "Obtendo ramificações ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Paste link in email or IM" : "Cole o link no e-mail ou IM", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in GitHub" : "Mostrar Confirmação no GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in GitHub" : "Mostrar o Repositório no GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in GitHub": "Mostrar essa Confirmação no GitHub", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Commit in eclipse.org": "Mostrar Confirmação no eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this commit in eclipse.org" : "Mostrar essa Confirmação no eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show Repository in eclipse.org":"Mostrar Repositório no eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Show this repository in eclipse.org":"Mostrar este repositório no eclipse.org", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review" : "Pedir revisão", //$NON-NLS-0$  //$NON-NLS-1$
	"Ask for review tooltip" : "Enviar e-mail com a solicitação para a revisão de compromisso", //$NON-NLS-0$  //$NON-NLS-1$
	"Reviewer name" : "Nome do revisor", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request" : "Solicitação de revisão de contribuição", //$NON-NLS-0$  //$NON-NLS-1$
	"Send the link to the reviewer" : "Enviar o link para o revisor", //$NON-NLS-0$  //$NON-NLS-1$
	"Private key file (optional):" : "Arquivo de chave privado (opcional):", //$NON-NLS-0$  //$NON-NLS-1$
	"Don't prompt me again:" : "Não me avise novamente:", //$NON-NLS-0$  //$NON-NLS-1$
	"Your private key will be saved in the browser for further use" : "Sua chave privada será salva em um navegador para uso futuro", //$NON-NLS-0$  //$NON-NLS-1$
	"Loading Contribution Review Request..." : "Carregando Solicitação de Revisão de Contribuição ...", //$NON-NLS-0$  //$NON-NLS-1$
	"The commit can be found in the following repositories" : "A confirmação pode ser localizada nos seguintes repositórios", //$NON-NLS-0$  //$NON-NLS-1$
	"Try to update your repositories" : "Tente atualizar seus repositórios", //$NON-NLS-0$  //$NON-NLS-1$
	"Create new repository" : "Criar novo repositório", //$NON-NLS-0$  //$NON-NLS-1$
	"Attach the remote to one of your existing repositories" : "Anexe o remoto em um dos seus repositórios existentes", //$NON-NLS-0$  //$NON-NLS-1$
	"You are reviewing contribution ${0} from ${1}" : "Você está revisando a contribuição ${0} de ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitNotFoundInWorkspace" : "Infelizmente, a confirmação não pode ser localizada em sua área de trabalho. Para ver, tente uma das seguintes: ", //$NON-NLS-0$  //$NON-NLS-1$
 	"To review the commit you can also:" : "Para revisar a confirmação, você também pode:", //$NON-NLS-0$  //$NON-NLS-1$
	"Contribution Review Request for ${0} on ${1}" : "Solicitação de Revisão de Contribuição para ${0} em ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Failing paths: ${0}": "caminhos com falha: ${0}", //$NON-NLS-0$  //$NON-NLS-1$
	"Problem while performing the action": "Problema ao executar a ação", //$NON-NLS-0$  //$NON-NLS-1$
	"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.": "Acesse a página de repositórios do Orion para fornecer uma URL do repositório git. Após o repositório ser criado, ele aparecerá no Navegador.", //$NON-NLS-0$  //$NON-NLS-1$
	"URL:": "URL:", //$NON-NLS-0$  //$NON-NLS-1$
	"File:": "Arquivo:", //$NON-NLS-0$  //$NON-NLS-1$
	"Submit": "Enviar", //$NON-NLS-0$  //$NON-NLS-1$
	"git url:": "URL de git: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert": "Reverter", //$NON-NLS-0$  //$NON-NLS-1$
	"Revert changes introduced by the commit into your active branch": "Reverter mudanças introduzidas pela confirmação em ramificação ativa", //$NON-NLS-0$  //$NON-NLS-1$
	". Could not revert into active branch": ". Não foi possível reverter para ramificação ativa.", //$NON-NLS-0$  //$NON-NLS-1$
	"Login": "Iniciar sessão", //$NON-NLS-0$  //$NON-NLS-1$
	"Authentication required for: ${0}. ${1} and re-try the request.": "Autenticação requerida para: ${0}. ${1} e tente novamente a solicitação.", //$NON-NLS-0$  //$NON-NLS-1$
	"Save":"Salvar", //$NON-NLS-0$  //$NON-NLS-1$
	"Remember my committer name and email:":"Lembrar meu nome e e-mail do committer:", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully edited ${0} to have value ${1}":"Editado com êxito ${0} para ter o valor ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Successfully added ${0} with value ${1}":"Incluído com êxito ${0} com o valor ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Signed-off-by: ":"Sign off efetuado por: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Change-Id: ":"ID da mudança: ", //$NON-NLS-0$  //$NON-NLS-1$
	"Push_REJECTED_NONFASTFORWARD":"Push não é de avanço rápido e foi rejeitado. Use Buscar para ver novas confirmações que devem ser mescladas.", //$NON-NLS-0$  //$NON-NLS-1$
	"Commit and Push" : "Confirmar e enviar por push", //$NON-NLS-0$  //$NON-NLS-1$
	"Sync" : "Sincronizar", //$NON-NLS-0$  //$NON-NLS-1$
	"SyncTooltip" : "Busque a partir da ramificação remota. Rebaseie suas confirmações removendo-as da ramificação local, iniciando a ramificação local novamente com base no estado mais recente da ramificação remota e aplicando cada confirmação à ramificação local atualizada. Envie por push confirmações e tags da ramificação local para a ramificação remota.", //$NON-NLS-0$  //$NON-NLS-1$
	"NoCommits" : "Sem Alterações", //$NON-NLS-0$  //$NON-NLS-1$
	"NoContent" : "Sem Conteúdo", //$NON-NLS-0$  //$NON-NLS-1$
	"Incoming" : "Entrada", //$NON-NLS-0$  //$NON-NLS-1$
	"Outgoing" : "Saída", //$NON-NLS-0$  //$NON-NLS-1$
	"IncomingWithCount" : "Recebido (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"OutgoingWithCount" : "De saída (${0})", //$NON-NLS-0$  //$NON-NLS-1$
	"Synchronized" : "Histórico", //$NON-NLS-0$  //$NON-NLS-1$
	"Uncommited" : "Não confirmado", //$NON-NLS-0$  //$NON-NLS-1$
	"Repository:" : "Repositório:", //$NON-NLS-0$  //$NON-NLS-1$
	"Reference:" : "Referência:", //$NON-NLS-0$  //$NON-NLS-1$
	"Author:" : "Autor:", //$NON-NLS-0$  //$NON-NLS-1$
	"Committer:" : "Confirmador:", //$NON-NLS-0$  //$NON-NLS-1$
	"SHA1:" : "SHA1:", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchCmd" : "Mostrar ramificação ativa", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceCmd": "Mostrar referência", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowReferenceTip": "Visualizar o histórico de ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"ShowActiveBranchTip": "Visualizar o histórico de \"${0}\" relativo a ${1} \"${2}\"", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitType": "confirmar", //$NON-NLS-0$  //$NON-NLS-1$
	"BranchType": "ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"RemoteTrackingBranchType": "ramificação remota", //$NON-NLS-0$  //$NON-NLS-1$
	"TagType": "tag", //$NON-NLS-0$  //$NON-NLS-1$
	"StashCommitType": "armazenar em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Path:" : "Caminho:", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChanges" : "Mudanças no diretório ativo", //$NON-NLS-0$  //$NON-NLS-1$
	"LocalChangesDetails" : "Detalhes do diretório ativo", //$NON-NLS-0$  //$NON-NLS-1$
	"CompareChanges" : "Comparar (${0} => ${1})", //$NON-NLS-0$  //$NON-NLS-1$
	"NoBranch" : "Nenhuma ramificação", //$NON-NLS-0$  //$NON-NLS-1$
	"NoActiveBranch" : "Nenhuma ramificação ativa", //$NON-NLS-0$  //$NON-NLS-1$
	"NoRef" : "Nenhuma referência selecionada", //$NON-NLS-0$  //$NON-NLS-1$
	"None": "Nenhum(a)", //$NON-NLS-0$  //$NON-NLS-1$
	"FileSelected": "${0} arquivo selecionado", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesSelected": "${0} arquivos selecionados", //$NON-NLS-0$  //$NON-NLS-1$
	"FileChanged": "${0} arquivo alterado", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChanged": "${0} arquivos alterados", //$NON-NLS-0$  //$NON-NLS-1$
	"file": "arquivo", //$NON-NLS-0$  //$NON-NLS-1$
	"files": "arquivos", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitConfirm": "Você não possui arquivos selecionados. Tem certeza?", //$NON-NLS-0$  //$NON-NLS-1$
	"EmptyCommitWarning": "A confirmação está vazia", //$NON-NLS-0$  //$NON-NLS-1$
	"FilesChangedVsReadyToCommit": "${0} ${1} alterado. ${2} ${3} pronto para confirmação.", //$NON-NLS-0$  //$NON-NLS-1$
	"CommitPush": "Confirmar e enviar por push", //$NON-NLS-0$  //$NON-NLS-1$
	"Commits and pushes files to the default remote": "Confirma e envia por push arquivos para o remoto padrão", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash" : "Armazenar em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	"stashIndex" : "stash@{${0}}: ${1}", //$NON-NLS-0$  //$NON-NLS-1$
	"Stash all current changes away" : "Armazenar em arquivo stash todas as mudanças", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop" : "Soltar", //$NON-NLS-0$  //$NON-NLS-1$
	"Drop the commit from the stash list" : "Descartar a confirmação da lista de armazenamento em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply" : "Aplicar", //$NON-NLS-0$  //$NON-NLS-1$
	"Pop Stash" : "Armazenamento em arquivo stash Pop", //$NON-NLS-0$  //$NON-NLS-1$
	"Apply the most recently stashed change to your active branch and drop it from the stashes" : "Aplicar a mudança de armazenamento em arquivo stash mais recente em sua ramificação ativa e descartá-la dos armazenamentos em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	"stashes" : "armazenamentos em arquivo stash", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyName': "Repositório Git", //$NON-NLS-0$  //$NON-NLS-1$
	'addDependencyTooltip': "Associar um repositório git a este projeto.",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectName': "Repositório Git",  //$NON-NLS-0$  //$NON-NLS-1$
	'addProjectTooltip': "Criar um projeto a partir de um repositório git.",  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchGroup': 'Buscar',  //$NON-NLS-0$  //$NON-NLS-1$
	'pushGroup' : 'Push',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:' : 'Url:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Private Key:' : 'Chave privada Ssh:', //$NON-NLS-0$  //$NON-NLS-1$
	'Ssh Passphrase:' : 'Passphrase Ssh:', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Há mudanças não salvas. Deseja salvá-las?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd, node*/
(function(root, factory) { // UMD
    if (typeof define === "function" && define.amd) { //$NON-NLS-0$
        define('orion/Deferred',factory);
    } else if (typeof exports === "object") { //$NON-NLS-0$
        module.exports = factory();
    } else {
        root.orion = root.orion || {};
        root.orion.Deferred = factory();
    }
}(this, function() {
    var queue = [],
        running = false;

    function run() {
        var fn;
        while ((fn = queue.shift())) {
            fn();
        }
        running = false;
    }

	var runAsync = (function() {
		if (typeof process !== "undefined" && typeof process.nextTick === "function") {
			var nextTick = process.nextTick;
    		return function() {
    			nextTick(run);
    		};
		} else if (typeof MutationObserver === "function") {
			var div = document.createElement("div");
			var observer = new MutationObserver(run);
			observer.observe(div, {
            	attributes: true
        	});
        	return function() {
        		div.setAttribute("class", "_tick");
        	};
		}
		return function() {
			setTimeout(run, 0);
		};
	})();

    function enqueue(fn) {
        queue.push(fn);
        if (!running) {
            running = true;
            runAsync();
        }
    }

    function noReturn(fn) {
        return function(result) {
            fn(result);
        };
    }
    
    function settleDeferred(fn, result, deferred) {
    	try {
    		var listenerResult = fn(result);
    		var listenerThen = listenerResult && (typeof listenerResult === "object" || typeof listenerResult === "function") && listenerResult.then;
    		if (typeof listenerThen === "function") {
    			if (listenerResult === deferred.promise) {
    				deferred.reject(new TypeError());
    			} else {
    				var listenerResultCancel = listenerResult.cancel;
    				if (typeof listenerResultCancel === "function") {
    					deferred._parentCancel = listenerResultCancel.bind(listenerResult);
    				} else {
    					delete deferred._parentCancel;
    				}
    				listenerThen.call(listenerResult, noReturn(deferred.resolve), noReturn(deferred.reject), noReturn(deferred.progress));
    			}
    		} else {
    			deferred.resolve(listenerResult);
    		}
    	} catch (e) {
    		deferred.reject(e);
    	}
    }


    /**
     * @name orion.Promise
     * @class Interface representing an eventual value.
     * @description Promise is an interface that represents an eventual value returned from the single completion of an operation.
     *
     * <p>For a concrete class that implements Promise and provides additional API, see {@link orion.Deferred}.</p>
     * @see orion.Deferred
     * @see orion.Deferred#promise
     */
    /**
     * @name then
     * @function
     * @memberOf orion.Promise.prototype
     * @description Adds handlers to be called on fulfillment or progress of this promise.
     * @param {Function} [onResolve] Called when this promise is resolved.
     * @param {Function} [onReject] Called when this promise is rejected.
     * @param {Function} [onProgress] May be called to report progress events on this promise.
     * @returns {orion.Promise} A new promise that is fulfilled when the given <code>onResolve</code> or <code>onReject</code>
     * callback is finished. The callback's return value gives the fulfillment value of the returned promise.
     */
    /**
     * Cancels this promise.
     * @name cancel
     * @function
     * @memberOf orion.Promise.prototype
     * @param {Object} reason The reason for canceling this promise.
     * @param {Boolean} [strict]
     */

    /**
     * @name orion.Deferred
     * @borrows orion.Promise#then as #then
     * @borrows orion.Promise#cancel as #cancel
     * @class Provides abstraction over asynchronous operations.
     * @description Deferred provides abstraction over asynchronous operations.
     *
     * <p>Because Deferred implements the {@link orion.Promise} interface, a Deferred may be used anywhere a Promise is called for.
     * However, in most such cases it is recommended to use the Deferred's {@link #promise} field instead, which exposes a 
     * simplified, minimally <a href="https://github.com/promises-aplus/promises-spec">Promises/A+</a>-compliant interface to callers.</p>
     */
    function Deferred() {
        var result, state, listeners = [],
            _this = this;

        function notify() {
            var listener;
            while ((listener = listeners.shift())) {
                var deferred = listener.deferred;
                var methodName = state === "fulfilled" ? "resolve" : "reject"; //$NON-NLS-0$ //$NON-NLS-1$ //$NON-NLS-2$
                var fn = listener[methodName];
                if (typeof fn === "function") { //$NON-NLS-0$
                	settleDeferred(fn, result, deferred);
                } else {
                    deferred[methodName](result);
                }
            }
        }

        function _reject(error) {
            delete _this._parentCancel;
            state = "rejected";
            result = error;
            if (listeners.length) {
                enqueue(notify);
            }
        }

        function _resolve(value) {
            function once(fn) {
                return function(result) {
                    if (!state || state === "assumed") {
                          fn(result);
                    }
                };
            }
            delete _this._parentCancel;
            try {
                var valueThen = value && (typeof value === "object" || typeof value === "function") && value.then;
                if (typeof valueThen === "function") {
                    if (value === _this) {
                        _reject(new TypeError());
                    } else {
                        state = "assumed";
                        var valueCancel = value && value.cancel;
                        if (typeof valueCancel !== "function") {
                            var deferred = new Deferred();
                            value = deferred.promise;
                            try {
                                valueThen(deferred.resolve, deferred.reject, deferred.progress);
                            } catch (thenError) {
                                deferred.reject(thenError);
                            }
                            valueCancel = value.cancel;
                            valueThen = value.then;
                        }
                        result = value;
                        valueThen.call(value, once(_resolve), once(_reject));
                        _this._parentCancel = valueCancel.bind(value);
                    }
                } else {
                    state = "fulfilled";
                    result = value;
                    if (listeners.length) {
                        enqueue(notify);
                    }
                }
            } catch (error) {
                once(_reject)(error);
            }
        }

        function cancel() {
            var parentCancel = _this._parentCancel;
            if (parentCancel) {
                delete _this._parentCancel;
                parentCancel();
            } else if (!state) {
                var cancelError = new Error("Cancel");
                cancelError.name = "Cancel";
                _reject(cancelError);
            }
        }


        /**
         * Resolves this Deferred.
         * @name resolve
         * @function
         * @memberOf orion.Deferred.prototype
         * @param {Object} value
         * @returns {orion.Promise}
         */
        this.resolve = function(value) {
            if (!state) {
                _resolve(value);
            }
            return _this;
        };

        /**
         * Rejects this Deferred.
         * @name reject
         * @function
         * @memberOf orion.Deferred.prototype
         * @param {Object} error
         * @param {Boolean} [strict]
         * @returns {orion.Promise}
         */
        this.reject = function(error) {
            if (!state) {
                _reject(error);
            }
            return _this;
        };

        /**
         * Notifies listeners of progress on this Deferred.
         * @name progress
         * @function
         * @memberOf orion.Deferred.prototype
         * @param {Object} update The progress update.
         * @returns {orion.Promise}
         */
        this.progress = function(update) {
            if (!state) {
                listeners.forEach(function(listener) {
                    if (listener.progress) {
                        try {
                            listener.progress(update);
                        } catch (ignore) {
                            // ignore
                        }
                    }
                });
            }
            return _this.promise;
        };

        this.cancel = function() {
            if (_this._parentCancel) {
                setTimeout(cancel, 0);
            } else {
                cancel();
            }
            return _this;
        };

        // Note: "then" ALWAYS returns before having onResolve or onReject called as per http://promises-aplus.github.com/promises-spec/
        this.then = function(onFulfill, onReject, onProgress) {
        	var deferred = new Deferred();
            deferred._parentCancel = _this.promise.cancel;
            listeners.push({
                resolve: onFulfill,
                reject: onReject,
                progress: onProgress,
                deferred: deferred
            });
            if (state === "fulfilled" || state === "rejected") {
                enqueue(notify);
            }
            return deferred.promise;
        };

        /**
         * The promise exposed by this Deferred.
         * @name promise
         * @field
         * @memberOf orion.Deferred.prototype
         * @type orion.Promise
         */
        this.promise = {
            then: _this.then,
            cancel: _this.cancel
        };
    }

    /**
     * Returns a promise that represents the outcome of all the input promises.
     * <p>When <code>all</code> is called with a single parameter, the returned promise has <dfn>eager</dfn> semantics,
     * meaning that if any input promise rejects, the returned promise immediately rejects, without waiting for the rest of the
     * input promises to fulfill.</p>
     *
     * To obtain <dfn>lazy</dfn> semantics (meaning the returned promise waits for every input promise to fulfill), pass the
     * optional parameter <code>optOnError</code>.
     * @name all
     * @function
     * @memberOf orion.Deferred
     * @static
     * @param {orion.Promise[]} promises The input promises.
     * @param {Function} [optOnError] Handles a rejected input promise. <code>optOnError</code> is invoked for every rejected
     * input promise, and is passed the reason the input promise was rejected. <p><code>optOnError</code> can return a value, which
     * allows it to act as a transformer: the return value serves as the final fulfillment value of the rejected promise in the 
     * results array generated by <code>all</code>.
     * @returns {orion.Promise} A new promise. The returned promise is generally fulfilled to an <code>Array</code> whose elements
     * give the fulfillment values of the input promises. <p>However, if an input promise rejects and eager semantics is used, the 
     * returned promise will instead be fulfilled to a single error value.</p>
     */
    Deferred.all = function(promises, optOnError) {
        var count = promises.length,
            result = [],
            rejected = false,
            deferred = new Deferred();

        deferred.then(undefined, function() {
            rejected = true;
            promises.forEach(function(promise) {
                if (promise.cancel) {
                    promise.cancel();
                }
            });
        });

        function onResolve(i, value) {
            if (!rejected) {
                result[i] = value;
                if (--count === 0) {
                    deferred.resolve(result);
                }
            }
        }

        function onReject(i, error) {
            if (!rejected) {
                if (optOnError) {
                    try {
                        onResolve(i, optOnError(error));
                        return;
                    } catch (e) {
                        error = e;
                    }
                }
                deferred.reject(error);
            }
        }

        if (count === 0) {
            deferred.resolve(result);
        } else {
            promises.forEach(function(promise, i) {
                promise.then(onResolve.bind(undefined, i), onReject.bind(undefined, i));
            });
        }
        return deferred.promise;
    };

    /**
     * Applies callbacks to a promise or to a regular object.
     * @name when
     * @function
     * @memberOf orion.Deferred
     * @static
     * @param {Object|orion.Promise} value Either a {@link orion.Promise}, or a normal value.
     * @param {Function} onResolve Called when the <code>value</code> promise is resolved. If <code>value</code> is not a promise,
     * this function is called immediately.
     * @param {Function} onReject Called when the <code>value</code> promise is rejected. If <code>value</code> is not a promise, 
     * this function is never called.
     * @param {Function} onProgress Called when the <code>value</code> promise provides a progress update. If <code>value</code> is
     * not a promise, this function is never called.
     * @returns {orion.Promise} A new promise.
     */
    Deferred.when = function(value, onResolve, onReject, onProgress) {
        var promise, deferred;
        if (value && typeof value.then === "function") { //$NON-NLS-0$
            promise = value;
        } else {
            deferred = new Deferred();
            deferred.resolve(value);
            promise = deferred.promise;
        }
        return promise.then(onResolve, onReject, onProgress);
    };

    return Deferred;
}));

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/*global requirejs*/
define('orion/i18nUtil',['require', 'orion/Deferred'], function(require, Deferred) {

	var messageBundleDeffereds = {};

	/**
	 * Performs string substitution. Can be invoked in 2 ways:
	 *
	 * i) vargs giving numbered substition values:
	 *   formatMessage("${0} is ${1}", "foo", "bar")  // "foo is bar"
	 *
	 * ii) a map giving the substitutions:
	 *   formatMessage("${thing} is ${1}", {1: "bar", thing: "foo"})  // "foo is bar"
	 */
	function formatMessage(msg) {
		var pattern = /\$\{([^\}]+)\}/g, args = arguments;
		if (args.length === 2 && args[1] && typeof args[1] === "object") {
			return msg.replace(pattern, function(str, key) {
				return args[1][key];
			});
		}
		return msg.replace(pattern, function(str, index) {
			return args[(index << 0) + 1];
		});
	}

	function bundleKey(name) {
		var userLocale = typeof navigator !== "undefined" ? (navigator.language || navigator.userLanguage) : null;
		if(userLocale) {
			return 'orion/messageBundle/' + userLocale.toLowerCase() + "/" + name;
		}
		return 'orion/messageBundle/' + name;
	}

	function getCachedMessageBundle(name) {
		var item = localStorage.getItem(bundleKey(name));
		if (item) {
			var bundle = JSON.parse(item);
			if (bundle._expires && bundle._expires > new Date().getTime()) {
				delete bundle._expires;
				return bundle;
			}
		}
		return null;
	}

	function setCachedMessageBundle(name, bundle) {
		bundle._expires = new Date().getTime() + 1000 * 900; //15 minutes
		localStorage.setItem(bundleKey(name), JSON.stringify(bundle));
		delete bundle._expires;
	}

	function getMessageBundle(name) {
		if (messageBundleDeffereds[name]) {
			return messageBundleDeffereds[name];
		}

		var d = new Deferred();
		messageBundleDeffereds[name] = d;

		var cached = getCachedMessageBundle(name);
		if (cached) {
				d.resolve(cached);
				return d;
		}

		// Wrapper for require() that normalizes away the IE quirk of never calling `errback`,
		// see https://bugs.eclipse.org/bugs/show_bug.cgi?id=428797
		function _require(deps, callback, errback) {
			require(deps, function(bundle) {
				if (typeof bundle === "undefined") { // IE
					errback(new Error(name));
				} else {
					callback.apply(null, Array.prototype.slice.call(arguments));
				}
			}, errback);
		}

		function _resolveMessageBundle(/*bundle*/) {
			require(['i18n!' + name], function(bundle) { //$NON-NLS-0$
				if (bundle) {
					setCachedMessageBundle(name, bundle);
				}
				d.resolve(bundle);
			});
		}

		function _rejectMessageBundle(error) {
			d.reject(error);
		}

		try {
			// First try to require `name` directly in case it's a bundle that ships with Orion
			_require([name], _resolveMessageBundle, function(/*error*/) {
				// Failed; fallback to orion/i18n to check the service registry for this bundle.
				// But first unload `name` from the loader, so orion/i18n can start fresh.
				requirejs.undef(name);
				_require(['orion/i18n!' + name], _resolveMessageBundle, _rejectMessageBundle); //$NON-NLS-0$
			});
		} catch (ignore) {
			// TODO require() never throws so this probably never runs
			_require(['orion/i18n!' + name], _resolveMessageBundle, _rejectMessageBundle); //$NON-NLS-0$
		}
		return d;
	}
	return {
		getMessageBundle: getMessageBundle,
		formatMessage: formatMessage
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/nls/messages',{
	root: {//Default message bundle
		"Navigator": "Navigator",
		"Sites": "Sites",
		"Shell": "Shell",
		"ShellLinkWorkspace": "Shell",
		"Get Plugins": "Get Plugins",
		"Global": "Global",
		"Editor": "Editor",
		"EditorRelatedLink": "Show Current Folder",
		"EditorRelatedLinkParent": "Show Enclosing Folder",
		"EditorLinkWorkspace": "Edit",
		"EditorRelatedLinkProj": "Show Project",
		"Filter bindings": "Filter bindings",
		"Orion Editor": "Orion Editor",
		"Orion Image Viewer": "Orion Image Viewer",
		"Orion Markdown Editor": "Orion Markdown Editor",
		"Orion Markdown Viewer": "Orion Markdown Viewer",
		"Orion JSON Editor": "Orion JSON Editor",
		"View on Site": "View on Site",
		"View this file or folder on a web site hosted by Orion": "View this file or folder on a web site hosted by Orion.",
		"ShowAllKeyBindings": "Show a list of all the keybindings on this page",
		"Show Keys": "Show Keys",
		"HideShowBannerFooter": "Hide or show the page banner and footer",
		"Toggle banner and footer": "Toggle banner and footer",
		"ChooseFileOpenEditor": "Choose a file by name and open an editor on it",
		"FindFile": "Find File Named...",
		"System Configuration Details": "System Configuration Details",
		"System Config Tooltip": "Go to the System Configuration Details page",
		"Background Operations": "Background Operations",
		"Background Operations Tooltip": "Go to the Background Operations page",
		"Operation status is unknown": "Operation status is unknown",
		"Unknown item": "Unknown item",
		"NoSearchAvailableErr": "Can't search: no search service is available",
		"Related": "Related",
		"Options": "Options",
		"FAQ": "FAQ",
		"Report a Bug": "Bugs",
		"Privacy Policy": "Privacy",
		"Terms of Use": "Terms",
		"Copyright Agent": "Copyright",
		"Orion Logo": "Orion Logo",
		"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
		"LOG: ": "LOG: ",
		"View": "View",
		"no parent": "no parent",
		"no tree model": "no tree model",
		"no renderer": "no renderer",
		"could not find table row ": "could not find table row ",
		"Operations": "Operations",
		"Operations running": "Operations running",
		"SomeOpWarning": "Some operations finished with warning",
		"SomeOpErr": "Some operations finished with error",
		"no service registry": "no service registry",
		"Tasks": "Tasks",
		"Close": "Close",
		"Expand all": "Expand all",
		"Collapse all": "Collapse all",
		"Search" : "Search",
		"Advanced search" : "Advanced search",
		"Submit" : "Submit",
		"More" : "More",
		"Recent searches" : "Recent searches",
		"Regular expression" : "Regular expression",
		"Search options" : "Search options",
		"Global search" : "Global search",
		"Orion Home" : "Orion Home",
		"Close notification" : "Close notification",
		"OpPressSpaceMsg" : "Operations - Press spacebar to show current operations",
		"Toggle side panel" : "Toggle side panel",
		"Open or close the side panel": "Open or close the side panel",
		"Projects" : "Projects",
		"Toggle Sidebar" : "Toggle Sidebar",
		"Sample HTML5 Site": "Sample HTML5 Site",
		"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.",
		"Sample Orion Plugin": "Sample Orion Plugin",
		"Generate a sample plugin for integrating with Orion.": "Generate a sample plugin for integrating with Orion.",
		"Browser": "Web Browser",
		"OutlineProgress": "Getting outline for ${0} from ${1}",
		"outlineTimeout": "Outline service timed out. Try reloading the page and opening the outline again.",
		"UnknownError": "An unknown error occurred.",
		"UnknownWarning": "An unknown warning occurred.",
		"Filter": "Filter (* = any string, ? = any character)",
		"TemplateExplorerLabel": "Templates",
		"OpenTemplateExplorer": "Open Template Explorer",
		"Edit": "Edit",
		"CentralNavTooltip": "Toggle Navigation Menu",
		"Wrote: ${0}": "Wrote: ${0}",
		"GenerateHTML": "Generate HTML file",
		"GenerateHTMLTooltip": "Write an HTML file generated from the current Markdown editor content",
		"alt text": "alt text",
		"blockquote": "blockquote",
		"code": "code",
		"code (block)": "code (block)",
		"code (span)": "code (span)",
		"emphasis": "emphasis",
		"fenced code (${0})": "fenced code (${0})",
		"header (${0})": "header (${0})",
		"horizontal rule": "horizontal rule",
		"label": "label",
		"link (auto)": "link (auto)",
		"link (image)": "link (image)",
		"link (inline)": "link (inline)",
		"link label": "link label",
		"link label (optional)": "link label (optional)",
		"link (ref)": "link (ref)",
		"list item (bullet)": "list item (bullet)",
		"list item (numbered)": "list item (numbered)",
		"strikethrough (${0})": "strikethrough (${0})",
		"strong": "strong",
		"table (${0})": "table (${0})",
		"text": "text",
		"title (optional)": "title (optional)",
		"url": "url",
		"TogglePaneOrientationTooltip": "Toggle split pane orientation",
		"WarningHeaderTooDeep": "Header level cannot exceed 6",
		"WarningUnorderedListItem": "Unordered list item within ordered list",
		"WarningOrderedListItem": "Ordered list item within unordered list",
		"WarningOrderedListShouldStartAt1": "The first item in an ordered list should have index 1",
		"WarningLinkHasNoText": "Link has no text",
		"WarningLinkHasNoURL": "Link has no URL",
		"WarningUndefinedLinkId": "Undefined link ID: ${0}",
		"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
		// Display names for keys:
		"KeyCTRL": "Ctrl",
		"KeySHIFT": "Shift",
		"KeyALT": "Alt",
		"KeyBKSPC": "Backspace",
		"KeyDEL": "Del",
		"KeyEND": "End",
		"KeyENTER": "Enter",
		"KeyESCAPE": "Esc",
		"KeyHOME": "Home",
		"KeyINSERT": "Ins",
		"KeyPAGEDOWN": "Page Down",
		"KeyPAGEUP": "Page Up",
		"KeySPACE": "Space",
		"KeyTAB": "Tab"
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/ja/messages',{
	"Navigator": "ナビゲーター",
	"Sites": "サイト",
	"Shell": "シェル",
	"ShellLinkWorkspace": "ワークスペース・シェル",
	"Get Plugins": "プラグインの取得",
	"Global": "グローバル",
	"Editor": "エディター",
	"EditorRelatedLink": "現行フォルダーの表示",
	"EditorRelatedLinkParent": "エンクロージング・フォルダーの表示",
	"EditorLinkWorkspace": "ワークスペースの表示",
	"EditorRelatedLinkProj": "プロジェクトの表示",
	"Filter bindings": "フィルター・バインディング",
	"Orion Editor": "Orion エディター",
	"Orion Image Viewer": "Orion イメージ・ビューアー",
	"Orion Markdown Editor": "Orion Markdown エディター",
	"Orion Markdown Viewer": "Orion Markdown ビューアー",
	"Orion JSON Editor": "Orion JSON エディター",
	"View on Site": "サイトで表示",
	"View this file or folder on a web site hosted by Orion": "このファイルまたはフォルダーを Orion がホストする Web サイトに表示します。",
	"ShowAllKeyBindings": "すべてのキー・バインディングをこのページのリストに表示",
	"Show Keys": "キーの表示",
	"HideShowBannerFooter": "ページのバナーとフッターを非表示または表示",
	"Toggle banner and footer": "バナーとフッターの切り替え",
	"ChooseFileOpenEditor": "名前を指定してファイルを選択し、エディターを開く",
	"FindFile": "名前を指定してファイルを検索...",
	"System Configuration Details": "システム構成の詳細",
	"System Config Tooltip": "システム構成の詳細ページに移動",
	"Background Operations": "バックグラウンド操作",
	"Background Operations Tooltip": "バックグラウンド操作ページに移動",
	"Operation status is unknown": "操作状況が不明です",
	"Unknown item": "不明な項目",
	"NoSearchAvailableErr": "検索できません: 検索サービスが使用できません",
	"Related": "関連",
	"Options": "オプション",
	"FAQ": "よくある質問",
	"Report a Bug": "バグ・レポート",
	"Privacy Policy": "プライバシー",
	"Terms of Use": "条件",
	"Copyright Agent": "著作権",
	"Orion Logo": "Orion ロゴ",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "ログ: ",
	"View": "表示",
	"no parent": "親がありません",
	"no tree model": "ツリー・モデルがありません",
	"no renderer": "レンダラーがありません",
	"could not find table row ": "テーブル行が見つかりませんでした ",
	"Operations": "操作",
	"Operations running": "操作実行中",
	"SomeOpWarning": "操作が完了しましたが、警告が発生した操作があります",
	"SomeOpErr": "操作が完了しましたが、エラーが発生した操作があります",
	"no service registry": "サービス・レジストリーがありません",
	"Tasks": "タスク",
	"Close": "閉じる",
	"Expand all": "すべて展開",
	"Collapse all": "すべて省略表示",
	"Search" : "検索",
	"Advanced search" : "拡張検索",
	"Submit" : "実行依頼",
	"More" : "その他",
	"Recent searches" : "最近の検索",
	"Regular expression" : "正規表現",
	"Search options" : "検索オプション",
	"Global search" : "グローバル・サーチ",
	"Orion Home" : "Orion ホーム",
	"Close notification" : "クローズ通知",
	"OpPressSpaceMsg" : "操作 - スペース・バーを押して現行操作を表示",
	"Toggle side panel" : "サイド・パネルの切り替え",
	"Open or close the side panel": "サイド・パネルのオープンまたはクローズ",
	"Projects" : "プロジェクト",
	"Toggle Sidebar" : "サイドバーの切り替え",
	"Sample HTML5 Site": "サンプル HTML5 サイト",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "HTML5 の「Hello World」Web サイト (JavaScript、HTML、および CSS ファイルを含む) を生成します。",
	"Sample Orion Plugin": "サンプル Orion プラグイン",
	"Generate a sample plugin for integrating with Orion.": "Orion と統合するためのサンプル・プラグインを生成します。",
	"Browser": "Web ブラウザー",
	"OutlineProgress": "${0} のアウトラインを ${1} から取得中",
	"outlineTimeout": "アウトライン・サービスがタイムアウトしました。ページを再ロードしてアウトラインを再度開くよう試行してください。",
	"UnknownError": "不明なエラーが発生しました。",
	"UnknownWarning": "不明な警告が発生しました。",
	"Filter": "フィルター (* = 任意のストリング、? = 任意の文字)",
	"TemplateExplorerLabel": "テンプレート",
	"OpenTemplateExplorer": "テンプレート・エクスプローラーを開く",
	"Edit": "編集",
	"CentralNavTooltip": "ナビゲーション・メニューの切り替え",
	"Wrote: ${0}": "書き込みました: ${0}",
	"GenerateHTML": "HTML ファイルの生成",
	"GenerateHTMLTooltip": "現在の Markdown エディターの内容から生成した HTML ファイルを書き込みます",
	"alt text": "代替テキスト",
	"blockquote": "ブロック引用",
	"code": "コード",
	"code (block)": "コード (ブロック)",
	"code (span)": "コード (幅)",
	"emphasis": "強調",
	"fenced code (${0})": "囲まれたコード (${0})",
	"header (${0})": "ヘッダー (${0})",
	"horizontal rule": "水平罫線",
	"label": "ラベル",
	"link (auto)": "リンク (自動)",
	"link (image)": "リンク (画像)",
	"link (inline)": "リンク (インライン)",
	"link label": "リンク・ラベル",
	"link label (optional)": "リンク・ラベル (オプション)",
	"link (ref)": "リンク (参照)",
	"list item (bullet)": "リスト項目 (黒丸)",
	"list item (numbered)": "リスト項目 (番号付き)",
	"strikethrough (${0})": "取り消し線 (${0})",
	"strong": "強い",
	"table (${0})": "表 (${0})",
	"text": "テキスト",
	"title (optional)": "タイトル (オプション)",
	"url": "URL",
	"TogglePaneOrientationTooltip": "分割ペインまたは方向の切り替え",
	"WarningHeaderTooDeep": "ヘッダー・レベルは 6 を超えることができません",
	"WarningUnorderedListItem": "順序付きリスト内の順序なしリスト項目",
	"WarningOrderedListItem": "順序なしリスト内の順序付けリスト項目",
	"WarningOrderedListShouldStartAt1": "順序付けリストの最初の項目は、索引が 1 でなければなりません",
	"WarningLinkHasNoText": "リンクにはテキストがありません",
	"WarningLinkHasNoURL": "リンクには URL がありません",
	"WarningUndefinedLinkId": "未定義リンク ID: ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Shift",
	"KeyALT": "Alt",
	"KeyBKSPC": "Backspace",
	"KeyDEL": "Delete",
	"KeyEND": "End",
	"KeyENTER": "Enter",
	"KeyESCAPE": "Esc",
	"KeyHOME": "Home",
	"KeyINSERT": "Insert",
	"KeyPAGEDOWN": "Page Down",
	"KeyPAGEUP": "Page Up",
	"KeySPACE": "Space",
	"KeyTAB": "Tab",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/zh/messages',{
	"Navigator": "导航器",
	"Sites": "站点",
	"Shell": "Shell",
	"ShellLinkWorkspace": "工作空间 Shell",
	"Get Plugins": "获取插件",
	"Global": "全局",
	"Editor": "编辑器",
	"EditorRelatedLink": "显示当前文件夹",
	"EditorRelatedLinkParent": "显示外层文件夹",
	"EditorLinkWorkspace": "显示工作空间",
	"EditorRelatedLinkProj": "显示项目",
	"Filter bindings": "过滤器绑定",
	"Orion Editor": "Orion 编辑器",
	"Orion Image Viewer": "Orion Image Viewer",
	"Orion Markdown Editor": "Orion Markdown 编辑器",
	"Orion Markdown Viewer": "Orion Markdown 查看器",
	"Orion JSON Editor": "Orion JSON 编辑器",
	"View on Site": "在站点上查看",
	"View this file or folder on a web site hosted by Orion": "在由 Orion 托管的 Web 站点上查看此文件或文件夹。",
	"ShowAllKeyBindings": "在此页面上显示所有键绑定的列表",
	"Show Keys": "显示键",
	"HideShowBannerFooter": "隐藏或显示页面条幅和页脚",
	"Toggle banner and footer": "切换条幅和页脚",
	"ChooseFileOpenEditor": "按名称选择文件并对它打开编辑器",
	"FindFile": "查找所指定的文件...",
	"System Configuration Details": "系统配置详细信息",
	"System Config Tooltip": "转至“系统配置详细信息”页面",
	"Background Operations": "后台操作",
	"Background Operations Tooltip": "转至“后台操作”页面",
	"Operation status is unknown": "操作状态未知",
	"Unknown item": "未知项",
	"NoSearchAvailableErr": "无法搜索：未提供搜索服务",
	"Related": "相关",
	"Options": "选项",
	"FAQ": "FAQ",
	"Report a Bug": "错误",
	"Privacy Policy": "隐私",
	"Terms of Use": "条款",
	"Copyright Agent": "版权",
	"Orion Logo": "Orion 徽标",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "日志：",
	"View": "查看",
	"no parent": "无父代",
	"no tree model": "没有树模型",
	"no renderer": "无渲染器",
	"could not find table row ": "找不到表行",
	"Operations": "操作",
	"Operations running": "操作正在运行",
	"SomeOpWarning": "某些操作已完成，但是发出了警告",
	"SomeOpErr": "某些操作已完成，但是产生了错误",
	"no service registry": "没有服务注册表",
	"Tasks": "任务",
	"Close": "关闭",
	"Expand all": "全部展开",
	"Collapse all": "全部折叠",
	"Search" : "搜索",
	"Advanced search" : "高级搜索",
	"Submit" : "提交",
	"More" : "更多",
	"Recent searches" : "最近的搜索",
	"Regular expression" : "正则表达式",
	"Search options" : "搜索选项",
	"Global search" : "全局搜索",
	"Orion Home" : "Orion 主页",
	"Close notification" : "关闭通知",
	"OpPressSpaceMsg" : "操作 - 按空格键以显示当前操作",
	"Toggle side panel" : "切换侧面板",
	"Open or close the side panel": "打开或关闭侧面板",
	"Projects" : "项目",
	"Toggle Sidebar" : "切换侧边栏",
	"Sample HTML5 Site": "样本 HTML5 站点",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "生成 HTML5“Hello World”Web 站点（其中包括 JavaScript、HTML 和 CSS 文件）。",
	"Sample Orion Plugin": "样本 Orion 插件",
	"Generate a sample plugin for integrating with Orion.": "生成样本插件以与 Orion 集成。",
	"Browser": "Web 浏览器",
	"OutlineProgress": "从 ${1} 获取 ${0} 的大纲",
	"outlineTimeout": "大纲服务已超时。请尝试重新装入页面并重新打开大纲。",
	"UnknownError": "发生未知错误。",
	"UnknownWarning": "产生了未知警告。",
	"Filter": "过滤器（* 表示任意字符串，? 表示任意字符）",
	"TemplateExplorerLabel": "模板",
	"OpenTemplateExplorer": "打开模板资源管理器",
	"Edit": "编辑",
	"CentralNavTooltip": "切换导航菜单",
	"Wrote: ${0}": "写入：${0}",
	"GenerateHTML": "生成 HTML 文件",
	"GenerateHTMLTooltip": "写入根据当前 Markdown 编辑器内容生成的 HTML 文件",
	"alt text": "Alt 文本",
	"blockquote": "块引用",
	"code": "代码",
	"code (block)": "代码（块）",
	"code (span)": "代码（行）",
	"emphasis": "重点强调",
	"fenced code (${0})": "已防护代码 (${0})",
	"header (${0})": "标题 (${0})",
	"horizontal rule": "水平线",
	"label": "标签",
	"link (auto)": "链接（自动）",
	"link (image)": "链接（图像）",
	"link (inline)": "链接（内联）",
	"link label": "链接标签",
	"link label (optional)": "链接标签（可选）",
	"link (ref)": "链接（参照）",
	"list item (bullet)": "列表项（项目符号）",
	"list item (numbered)": "列表项（编号）",
	"strikethrough (${0})": "删除线 (${0})",
	"strong": "加粗",
	"table (${0})": "表格 (${0})",
	"text": "文本",
	"title (optional)": "标题（可选）",
	"url": "url",
	"TogglePaneOrientationTooltip": "切换拆分窗格方向",
	"WarningHeaderTooDeep": "头级别不能超过 6",
	"WarningUnorderedListItem": "有序列表内的无序列表项",
	"WarningOrderedListItem": "无序列表内的有序列表项",
	"WarningOrderedListShouldStartAt1": "有序列表中第一个项的索引应该为 1",
	"WarningLinkHasNoText": "链接没有文本",
	"WarningLinkHasNoURL": "链接没有 URL",
	"WarningUndefinedLinkId": "未定义的链接标识：${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Shift",
	"KeyALT": "Alt",
	"KeyBKSPC": "Backspace ",
	"KeyDEL": "Del",
	"KeyEND": "结束",
	"KeyENTER": "Enter",
	"KeyESCAPE": "Esc",
	"KeyHOME": "主页",
	"KeyINSERT": "Ins",
	"KeyPAGEDOWN": "Page Down",
	"KeyPAGEUP": "Page Up",
	"KeySPACE": "空格",
	"KeyTAB": "Tab",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/zh-tw/messages',{
	"Navigator": "導覽器",
	"Sites": "網站",
	"Shell": "Shell",
	"ShellLinkWorkspace": "工作區 Shell",
	"Get Plugins": "取得外掛程式",
	"Global": "廣域",
	"Editor": "編輯器",
	"EditorRelatedLink": "顯示現行資料夾",
	"EditorRelatedLinkParent": "顯示含括的資料夾",
	"EditorLinkWorkspace": "顯示工作區",
	"EditorRelatedLinkProj": "顯示專案",
	"Filter bindings": "過濾連結",
	"Orion Editor": "Orion 編輯器",
	"Orion Image Viewer": "Orion 影像檢視器",
	"Orion Markdown Editor": "Orion 調降編輯器",
	"Orion Markdown Viewer": "Orion 調降檢視器",
	"Orion JSON Editor": "Orion JSON 編輯器",
	"View on Site": "在網站上檢視",
	"View this file or folder on a web site hosted by Orion": "在 Orion 管理的網站上檢視這個檔案或資料夾。",
	"ShowAllKeyBindings": "在這個頁面上顯示所有按鍵連結的清單",
	"Show Keys": "顯示按鍵",
	"HideShowBannerFooter": "隱藏或顯示頁面橫幅和標底",
	"Toggle banner and footer": "切換橫幅和標底",
	"ChooseFileOpenEditor": "依名稱選擇檔案並開啟它的編輯器",
	"FindFile": "尋找指名的檔案...",
	"System Configuration Details": "系統配置詳細資料",
	"System Config Tooltip": "移至系統配置詳細資料頁面",
	"Background Operations": "背景作業",
	"Background Operations Tooltip": "移至背景作業頁面",
	"Operation status is unknown": "作業狀態不明",
	"Unknown item": "不明項目",
	"NoSearchAvailableErr": "無法搜尋：沒有可用的搜尋服務",
	"Related": "相關",
	"Options": "選項",
	"FAQ": "FAQ",
	"Report a Bug": "錯誤",
	"Privacy Policy": "隱私權",
	"Terms of Use": "條款",
	"Copyright Agent": "著作權",
	"Orion Logo": "Orion 標誌",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "日誌： ",
	"View": "檢視",
	"no parent": "無母項",
	"no tree model": "無樹狀結構模型",
	"no renderer": "無呈現器",
	"could not find table row ": "找不到表格列 ",
	"Operations": "作業",
	"Operations running": "作業執行中",
	"SomeOpWarning": "部分作業完成時出現警告",
	"SomeOpErr": "部分作業完成時發生錯誤",
	"no service registry": "無服務登錄",
	"Tasks": "作業",
	"Close": "關閉",
	"Expand all": "全部展開",
	"Collapse all": "全部收合",
	"Search" : "搜尋",
	"Advanced search" : "進階搜尋",
	"Submit" : "提交",
	"More" : "尚有",
	"Recent searches" : "最新搜尋",
	"Regular expression" : "正規表示式",
	"Search options" : "搜尋選項",
	"Global search" : "廣域搜尋",
	"Orion Home" : "Orion 起始目錄",
	"Close notification" : "關閉通知",
	"OpPressSpaceMsg" : "作業 - 按空格鍵來顯示現行作業",
	"Toggle side panel" : "切換側邊畫面",
	"Open or close the side panel": "開啟或關閉側邊畫面",
	"Projects" : "專案",
	"Toggle Sidebar" : "切換資訊看板",
	"Sample HTML5 Site": "HTML5 範例網站",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "產生 HTML5 'Hello World' 網站，包含 JavaScript、HTML 及 CSS 檔。",
	"Sample Orion Plugin": "Orion 外掛程式範例",
	"Generate a sample plugin for integrating with Orion.": "產生範例外掛程式來與 Orion 整合。",
	"Browser": "Web 瀏覽器",
	"OutlineProgress": "從 ${1} 取得 ${0} 的大綱",
	"outlineTimeout": "大綱服務逾時。請嘗試重新載入頁面並再次開啟大綱。",
	"UnknownError": "發生不明錯誤。",
	"UnknownWarning": "發生不明警告。",
	"Filter": "過濾器（* = 任何字串，? = 任何字元）",
	"TemplateExplorerLabel": "範本",
	"OpenTemplateExplorer": "開啟範本瀏覽器",
	"Edit": "編輯",
	"CentralNavTooltip": "切換導覽功能表",
	"Wrote: ${0}": "已寫入：${0}",
	"GenerateHTML": "產生 HTML 檔",
	"GenerateHTMLTooltip": "撰寫從現行「調降」編輯器內容產生的 HTML 檔",
	"alt text": "替代文字",
	"blockquote": "區塊引文",
	"code": "代碼",
	"code (block)": "代碼（區塊）",
	"code (span)": "代碼（橫跨）",
	"emphasis": "強調",
	"fenced code (${0})": "隔離的代碼 (${0})",
	"header (${0})": "標頭 (${0})",
	"horizontal rule": "水平尺規",
	"label": "標籤",
	"link (auto)": "鏈結（自動）",
	"link (image)": "鏈結（影像）",
	"link (inline)": "鏈結（行內）",
	"link label": "鏈結標籤",
	"link label (optional)": "鏈結標籤（選用）",
	"link (ref)": "鏈結（參照）",
	"list item (bullet)": "清單項目（項目符號）",
	"list item (numbered)": "清單項目（編號）",
	"strikethrough (${0})": "加刪除線 (${0})",
	"strong": "加強",
	"table (${0})": "表格 (${0})",
	"text": "文字",
	"title (optional)": "標題（選用）",
	"url": "url",
	"TogglePaneOrientationTooltip": "切換分割窗格方向",
	"WarningHeaderTooDeep": "標頭層次不能超過 6",
	"WarningUnorderedListItem": "已排序之清單內未排序的清單項目",
	"WarningOrderedListItem": "未排序之清單內已排序的清單項目",
	"WarningOrderedListShouldStartAt1": "已排序之清單中的第一個項目應該具有索引 1",
	"WarningLinkHasNoText": "鏈結沒有文字",
	"WarningLinkHasNoURL": "鏈結沒有 URL",
	"WarningUndefinedLinkId": "未定義的鏈結 ID：${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Shift",
	"KeyALT": "Alt",
	"KeyBKSPC": "倒退鍵",
	"KeyDEL": "刪除建",
	"KeyEND": "結束",
	"KeyENTER": "輸入",
	"KeyESCAPE": "Esc",
	"KeyHOME": "首頁",
	"KeyINSERT": "插入鍵",
	"KeyPAGEDOWN": "下一頁",
	"KeyPAGEUP": "上一頁",
	"KeySPACE": "空格鍵",
	"KeyTAB": "標籤",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/fr/messages',{
	"Navigator": "Navigateur",
	"Sites": "Sites",
	"Shell": "Shell",
	"ShellLinkWorkspace": "Shell de l'espace de travail",
	"Get Plugins": "Obtention de plug-ins",
	"Global": "Global",
	"Editor": "Editeur",
	"EditorRelatedLink": "Afficher le dossier en cours",
	"EditorRelatedLinkParent": "Afficher le dossier contenant les correspondances",
	"EditorLinkWorkspace": "Afficher l'espace de travail",
	"EditorRelatedLinkProj": "Afficher le projet",
	"Filter bindings": "Filtrer les combinaisons",
	"Orion Editor": "Editeur Orion",
	"Orion Image Viewer": "Orion Image Viewer",
	"Orion Markdown Editor": "Orion Markdown Editor",
	"Orion Markdown Viewer": "Orion Markdown Viewer",
	"Orion JSON Editor": "Orion JSON Editor",
	"View on Site": "Afficher sur le site",
	"View this file or folder on a web site hosted by Orion": "Afficher ce fichier ou dossier sur un site Web hébergé par Orion.",
	"ShowAllKeyBindings": "Afficher une liste de toutes les combinaisons de touches sur cette page",
	"Show Keys": "Afficher des touches",
	"HideShowBannerFooter": "Masquer ou afficher la bannière ou le bas de page",
	"Toggle banner and footer": "Afficher/masquer la bannière ou le bas de page",
	"ChooseFileOpenEditor": "Sélectionnez un fichier par son nom et ouvrez un éditeur en cliquant dessus",
	"FindFile": "Rechercher le fichier nommé...",
	"System Configuration Details": "Détails de la configuration du système",
	"System Config Tooltip": "Accéder à la page Détails de la configuration du système",
	"Background Operations": "Opérations d'arrière-plan",
	"Background Operations Tooltip": "Accédez à la page Opérations d'arrière-plan",
	"Operation status is unknown": "Le statut de l'opération est inconnu",
	"Unknown item": "Elément inconnu",
	"NoSearchAvailableErr": "Recherche impossible : aucun service de recherche n'est disponible",
	"Related": "Associé",
	"Options": "Options",
	"FAQ": "FAQ",
	"Report a Bug": "Bogues",
	"Privacy Policy": "Confidentialité",
	"Terms of Use": "Dispositions",
	"Copyright Agent": "Copyright",
	"Orion Logo": "Logo Orion",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "JOURNAL : ",
	"View": "Vue",
	"no parent": "aucun parent",
	"no tree model": "aucun modèle d'arborescence",
	"no renderer": "aucun présentateur de rendu",
	"could not find table row ": "ligne de table introuvable ",
	"Operations": "Opérations",
	"Operations running": "Opérations en cours",
	"SomeOpWarning": "Certaines opérations se sont terminées par un avertissement",
	"SomeOpErr": "Certaines opérations se sont terminées par une erreur",
	"no service registry": "aucun registre de services",
	"Tasks": "Tâches",
	"Close": "Fermer",
	"Expand all": "Développer tout",
	"Collapse all": "Réduire tout",
	"Search" : "Recherche",
	"Advanced search" : "Recherche avancée",
	"Submit" : "Soumettre",
	"More" : "Plus",
	"Recent searches" : "Recherches récentes",
	"Regular expression" : "Expression régulière",
	"Search options" : "Options de recherche",
	"Global search" : "Recherche globale",
	"Orion Home" : "Orion - Accueil",
	"Close notification" : "Fermer la notification",
	"OpPressSpaceMsg" : "Opérations - Appuyez sur la barre d'espace pour afficher les opérations en cours",
	"Toggle side panel" : "Afficher/masquer le panneau latéral",
	"Open or close the side panel": "Ouvrir ou fermer le panneau latéral",
	"Projects" : "Projets",
	"Toggle Sidebar" : "Afficher/masquer la barre de navigation",
	"Sample HTML5 Site": "Exemple de site HTML5",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "Générez un site Web HTML5 'Hello World' comportant des  fichiers JavaScript, HTML et CSS.",
	"Sample Orion Plugin": "Exemple de plug-in Orion",
	"Generate a sample plugin for integrating with Orion.": "Générez un exemple de plug-in pour l'intégration à Orion.",
	"Browser": "Navigateur Web",
	"OutlineProgress": "Obtention de la structure de ${0} à partir de ${1}",
	"outlineTimeout": "Le service de structure est arrivé à expiration. Essayez de recharger la page et d'ouvrir la structure à nouveau. ",
	"UnknownError": "Une erreur inconnue s'est produite.",
	"UnknownWarning": "Un avertissement inconnu s'est produit.",
	"Filter": "Filtre (* = toute chaîne, ? = tout caractère)",
	"TemplateExplorerLabel": "Modèles",
	"OpenTemplateExplorer": "Ouvrir l'explorateur de modèles",
	"Edit": "Edition",
	"CentralNavTooltip": "Activer/désactiver le menu de navigation",
	"Wrote: ${0}": "Ecriture : ${0}",
	"GenerateHTML": "Générer un fichier HTML",
	"GenerateHTMLTooltip": "Ecrire un fichier HTML généré à partir du contenu de l'éditeur Markdown en cours",
	"alt text": "texte alternatif",
	"blockquote": "bloc de citation",
	"code": "code",
	"code (block)": "code (bloc)",
	"code (span)": "code (étendue)",
	"emphasis": "mise en évidence",
	"fenced code (${0})": "code isolé (${0})",
	"header (${0})": "en-tête (${0})",
	"horizontal rule": "règle horizontale",
	"label": "libellé",
	"link (auto)": "lien (automatique)",
	"link (image)": "lien (image)",
	"link (inline)": "lien (en ligne)",
	"link label": "libellé de lien",
	"link label (optional)": "libellé de lien (facultatif)",
	"link (ref)": "lien (référence)",
	"list item (bullet)": "élément de liste (puce)",
	"list item (numbered)": "élément de liste (numéro)",
	"strikethrough (${0})": "barré (${0})",
	"strong": "gras",
	"table (${0})": "table (${0})",
	"text": "text",
	"title (optional)": "titre (facultatif)",
	"url": "url",
	"TogglePaneOrientationTooltip": "Basculer l'orientation de fractionnement de la sous-fenêtre",
	"WarningHeaderTooDeep": "Le niveau d'en-tête ne peut pas être supérieur à 6",
	"WarningUnorderedListItem": "Elément de liste non ordonné dans une liste ordonnée",
	"WarningOrderedListItem": "Elément de liste ordonné dans une liste non ordonnée",
	"WarningOrderedListShouldStartAt1": "Le premier élément dans une liste ordonnée doit avoir l'index 1",
	"WarningLinkHasNoText": "Le lien ne possède pas de texte",
	"WarningLinkHasNoURL": "Le lien ne possède pas d'adresse URL",
	"WarningUndefinedLinkId": "ID de lien non défini : ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Maj",
	"KeyALT": "Alt",
	"KeyBKSPC": "Retour arrière",
	"KeyDEL": "Suppr",
	"KeyEND": "Fin",
	"KeyENTER": "Entrer",
	"KeyESCAPE": "Echap",
	"KeyHOME": "Accueil",
	"KeyINSERT": "Inser",
	"KeyPAGEDOWN": "Page avant",
	"KeyPAGEUP": "Page arrière",
	"KeySPACE": "Espace",
	"KeyTAB": "Tabulation",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/de/messages',{
	"Navigator": "Navigator",
	"Sites": "Sites",
	"Shell": "Shell",
	"ShellLinkWorkspace": "Arbeitsbereichsshell",
	"Get Plugins": "Plug-ins abrufen",
	"Global": "Global",
	"Editor": "Editor",
	"EditorRelatedLink": "Aktuellen Ordner anzeigen",
	"EditorRelatedLinkParent": "Einschließenden Ordner anzeigen",
	"EditorLinkWorkspace": "Arbeitsbereich anzeigen",
	"EditorRelatedLinkProj": "Projekt anzeigen",
	"Filter bindings": "Bindings filtern",
	"Orion Editor": "Orion-Editor",
	"Orion Image Viewer": "Orion Image-Viewer",
	"Orion Markdown Editor": "Orion Markdown-Editor",
	"Orion Markdown Viewer": "Orion Markdown-Viewer",
	"Orion JSON Editor": "Orion JSON-Editor",
	"View on Site": "Auf Site anzeigen",
	"View this file or folder on a web site hosted by Orion": "Diese Datei oder diesen Ordner auf einer von Orion gehosteten Website anzeigen.",
	"ShowAllKeyBindings": "Liste aller Schlüsselbindings auf dieser Seite anzeigen",
	"Show Keys": "Schlüssel anzeigen",
	"HideShowBannerFooter": "Seitenbanner und -fußzeile aus- oder einblenden",
	"Toggle banner and footer": "Banner und Fußzeile ein-/ausschalten",
	"ChooseFileOpenEditor": "Datei nach Namen auswählen und für diese Datei einen Editor öffnen",
	"FindFile": "Benannte Datei suchen...",
	"System Configuration Details": "Details zur Systemkonfiguration",
	"System Config Tooltip": "Wechseln Sie zur Seite 'Details zur Systemkonfiguration'",
	"Background Operations": "Hintergrundoperationen",
	"Background Operations Tooltip": "Wechseln Sie zur Seite 'Hintergrundoperationen'",
	"Operation status is unknown": "Operationsstatus ist unbekannt",
	"Unknown item": "Unbekanntes Element",
	"NoSearchAvailableErr": "Suche nicht möglich: Es ist kein Suchservice verfügbar",
	"Related": "Zugehörig",
	"Options": "Optionen",
	"FAQ": "Häufig gestellte Fragen",
	"Report a Bug": "Programmfehler",
	"Privacy Policy": "Datenschutz",
	"Terms of Use": "Bedingungen",
	"Copyright Agent": "Copyright",
	"Orion Logo": "Orion-Logo",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "PROTOKOLL: ",
	"View": "Ansicht",
	"no parent": "kein übergeordnetes Element",
	"no tree model": "kein Baummodell",
	"no renderer": "kein Renderer",
	"could not find table row ": "Tabellenzeile konnte nicht gefunden werden ",
	"Operations": "Operationen",
	"Operations running": "Operationen werden ausgeführt",
	"SomeOpWarning": "Einige Operationen wurden mit einer Warnung abgeschlossen",
	"SomeOpErr": "Einige Operationen wurden mit einem Fehler abgeschlossen",
	"no service registry": "kein Service-Registry",
	"Tasks": "Tasks",
	"Close": "Schließen",
	"Expand all": "Alle einblenden",
	"Collapse all": "Alle ausblenden",
	"Search" : "Suchen",
	"Advanced search" : "Erweiterte Suche",
	"Submit" : "Übergeben",
	"More" : "Mehr",
	"Recent searches" : "Kürzliche Suchen",
	"Regular expression" : "Regulärer Ausdruck",
	"Search options" : "Suchoptionen",
	"Global search" : "Globale Suche",
	"Orion Home" : "Orion-Ausgangsverzeichnis",
	"Close notification" : "Benachrichtigung schließen",
	"OpPressSpaceMsg" : "Operationen - Drücken Sie die Leertaste, um die aktuellen Operationen anzuzeigen",
	"Toggle side panel" : "Seitliche Anzeige umschalten",
	"Open or close the side panel": "Seitliche Anzeige öffnen oder schließen",
	"Projects" : "Projekte",
	"Toggle Sidebar" : "Seitliche Liste umschalten",
	"Sample HTML5 Site": "HTML5-Beispielsite",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "HTML5-Web-Site 'Hello World' inklusive JavaScript-, HTML- und CSS-Dateien generieren.",
	"Sample Orion Plugin": "Orion-Beispiel-Plug-in",
	"Generate a sample plugin for integrating with Orion.": "Beispiel-Plug-in für die Integration bei Orion generieren.",
	"Browser": "Webbrowser",
	"OutlineProgress": "Gliederung für ${0} wird von ${1} abgerufen",
	"outlineTimeout": "Für den Gliederungsservice wurde das zulässige Zeitlimit überschritten. Versuchen Sie, die Seite erneut zu laden und die Gliederung wieder zu öffnen.",
	"UnknownError": "Es ist ein unbekannter Fehler aufgetreten.",
	"UnknownWarning": "Es ist eine unbekannte Warnung aufgetreten.",
	"Filter": "Filtern (* = beliebige Zeichenfolge, ? = beliebiges Zeichen)",
	"TemplateExplorerLabel": "Schablonen",
	"OpenTemplateExplorer": "Schablonen-Explorer öffnen",
	"Edit": "Bearbeiten",
	"CentralNavTooltip": "Navigationsmenü ein-/ausblenden",
	"Wrote: ${0}": "Hat Folgendes geschrieben: ${0}",
	"GenerateHTML": "HTML-Datei generieren",
	"GenerateHTMLTooltip": "HTML-Datei schreiben, die aus dem aktuellen Inhalt des Markdown-Editors generiert wurde",
	"alt text": "alternativer Text",
	"blockquote": "Blockquote",
	"code": "code",
	"code (block)": "code (Block)",
	"code (span)": "code (Span)",
	"emphasis": "Hervorhebung",
	"fenced code (${0})": "abgeschirmter Code (${0})",
	"header (${0})": "Header (${0})",
	"horizontal rule": "horizontales Lineal",
	"label": "Beschriftung",
	"link (auto)": "Link (auto)",
	"link (image)": "Link (Image)",
	"link (inline)": "Link (inline)",
	"link label": "Linkbeschriftung",
	"link label (optional)": "Linkbeschriftung (optional)",
	"link (ref)": "Link (ref)",
	"list item (bullet)": "Listeneintrag (Listenpunkt)",
	"list item (numbered)": "Listeneintrag (nummeriert)",
	"strikethrough (${0})": "durchgestrichen (${0})",
	"strong": "Ffett",
	"table (${0})": "Tabelle (${0})",
	"text": "Text",
	"title (optional)": "Titel (optional)",
	"url": "url",
	"TogglePaneOrientationTooltip": "Ausrichtung des geteilten Teilfensters wechseln",
	"WarningHeaderTooDeep": "Kopfzeilenebene darf nicht über 6 liegen",
	"WarningUnorderedListItem": "Eintrag in einer ungeordneten Liste in einer geordneten Liste",
	"WarningOrderedListItem": "Eintrag in einer geordneten Liste in einer ungeordneten Liste",
	"WarningOrderedListShouldStartAt1": "Das erste Element in einer geordneten Liste muss den Index 1 haben",
	"WarningLinkHasNoText": "Link ist ohne Text",
	"WarningLinkHasNoURL": "Link hat keine URL",
	"WarningUndefinedLinkId": "Nicht definierte Link-ID: ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Strg",
	"KeySHIFT": "Umschalttaste",
	"KeyALT": "Alt",
	"KeyBKSPC": "Rücktaste",
	"KeyDEL": "Taste ENTF",
	"KeyEND": "Ende",
	"KeyENTER": "Eingabetaste",
	"KeyESCAPE": "Abbruchtaste",
	"KeyHOME": "Home",
	"KeyINSERT": "Einfg",
	"KeyPAGEDOWN": "Vorblättern",
	"KeyPAGEUP": "Zurückblättern",
	"KeySPACE": "Leerzeichen",
	"KeyTAB": "Tabulator",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/it/messages',{
	"Navigator": "Navigator",
	"Sites": "Siti",
	"Shell": "Shell",
	"ShellLinkWorkspace": "Shell dello spazio di lavoro",
	"Get Plugins": "Ottieni plugin",
	"Global": "Globale",
	"Editor": "Editor",
	"EditorRelatedLink": "Mostra cartella corrente",
	"EditorRelatedLinkParent": "Mostra cartella di inclusione",
	"EditorLinkWorkspace": "Mostra spazio di lavoro",
	"EditorRelatedLinkProj": "Mostra progetto",
	"Filter bindings": "Binding di filtri",
	"Orion Editor": "Editor Orion",
	"Orion Image Viewer": "Programma di visualizzazione Orion Image",
	"Orion Markdown Editor": "Editor Orion Markdown",
	"Orion Markdown Viewer": "Programma di visualizzazione Orion Markdown",
	"Orion JSON Editor": "Editor Orion JSON",
	"View on Site": "Visualizza sul sito",
	"View this file or folder on a web site hosted by Orion": "Visualizza questo file o cartella su un sito Web ospitato da Orion.",
	"ShowAllKeyBindings": "Mostra un elenco di tutti i keybindings in questa pagina",
	"Show Keys": "Mostra chiavi",
	"HideShowBannerFooter": "Nascondi o mostra piè di pagina e intestazione della pagina",
	"Toggle banner and footer": "Attiva/disattiva piè di pagina e intestazione",
	"ChooseFileOpenEditor": "Scegliere un file in base al nome e aprirvi un editor",
	"FindFile": "Trova file con nome...",
	"System Configuration Details": "Dettagli di configurazione del sistema",
	"System Config Tooltip": "Vai alla pagina Dettagli di configurazione del sistema",
	"Background Operations": "Operazioni di sfondo",
	"Background Operations Tooltip": "Vai alla pagina Operazioni di sfondo",
	"Operation status is unknown": "Lo stato operazione è sconosciuto",
	"Unknown item": "Elemento sconosciuto",
	"NoSearchAvailableErr": "Impossibile ricercare: nessun servizio di ricerca è disponibile",
	"Related": "Correlato",
	"Options": "Opzioni",
	"FAQ": "FAQ",
	"Report a Bug": "Errori",
	"Privacy Policy": "Privacy",
	"Terms of Use": "Termini",
	"Copyright Agent": "Copyright",
	"Orion Logo": "Logo Orion",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "LOG: ",
	"View": "Vista",
	"no parent": "nessun padre",
	"no tree model": "nessun modello ad albero",
	"no renderer": "nessun renderer",
	"could not find table row ": "impossibile trovare la riga della tabella ",
	"Operations": "Operazioni",
	"Operations running": "Operazioni in esecuzione",
	"SomeOpWarning": "Alcune operazioni sono terminate con un'avvertenza",
	"SomeOpErr": "Alcune operazioni sono terminate con errore",
	"no service registry": "nessun registro del servizio",
	"Tasks": "Attività",
	"Close": "Chiuso",
	"Expand all": "Espandi tutto",
	"Collapse all": "Comprimi tutto",
	"Search" : "Cerca",
	"Advanced search" : "Ricerca avanzata",
	"Submit" : "Inoltra",
	"More" : "Altro",
	"Recent searches" : "Ricerche recenti",
	"Regular expression" : "Espressione regolare",
	"Search options" : "Opzioni di ricerca",
	"Global search" : "Ricerca globale",
	"Orion Home" : "Home Orion",
	"Close notification" : "Chiudi notifica",
	"OpPressSpaceMsg" : "Operazioni - Premere la barra spaziatrice per mostrare le operazioni correnti",
	"Toggle side panel" : "Attiva/disattiva pannello laterale",
	"Open or close the side panel": "Apri o chiudi il pannello laterale",
	"Projects" : "Progetti",
	"Toggle Sidebar" : "Attiva/disattiva barra laterale",
	"Sample HTML5 Site": "Sito HTML5 di esempio",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "Generare un sito Web 'Hello World' HTML5, includendo file JavaScript, HTML e CSS.",
	"Sample Orion Plugin": "Plugin Orion di esempio",
	"Generate a sample plugin for integrating with Orion.": "Generare un plugin di esempio per l'integrazione con Orion.",
	"Browser": "Browser Web",
	"OutlineProgress": "Acquisizione struttura per ${0} da ${1}",
	"outlineTimeout": "Servizio di descrizione scaduto. Provare ricaricando la pagina ed aprendo di nuovo il servizio di descrizione. ",
	"UnknownError": "Si è verificato un errore sconosciuto.",
	"UnknownWarning": "Si è verificato un avviso sconosciuto.",
	"Filter": "Filtro (* = qualsiasi stringa, ? = tutti i caratteri)",
	"TemplateExplorerLabel": "Modelli",
	"OpenTemplateExplorer": "Apri Explorer modelli",
	"Edit": "Modifica",
	"CentralNavTooltip": "Attiva/disattiva menu di navigazione",
	"Wrote: ${0}": "Scritto: ${0}",
	"GenerateHTML": "Genera file HTML",
	"GenerateHTMLTooltip": "Scrivere un file HTML generato dal contenuto corrente dell'editor Markdown",
	"alt text": "testo alt",
	"blockquote": "blockquote",
	"code": "code",
	"code (block)": "codice (block)",
	"code (span)": "codice (span)",
	"emphasis": "enfasi",
	"fenced code (${0})": "codice tra parentesi graffe (${0})",
	"header (${0})": "intestazione (${0})",
	"horizontal rule": "regola orizzontale",
	"label": "etichetta",
	"link (auto)": "collegamento (auto)",
	"link (image)": "collegamento (immagine)",
	"link (inline)": "collegamento (in linea)",
	"link label": "etichetta collegamento",
	"link label (optional)": "etichetta collegamento (facoltativa)",
	"link (ref)": "collegamento (ref)",
	"list item (bullet)": "elemento di elenco (pallino)",
	"list item (numbered)": "elemento di elenco (numerato)",
	"strikethrough (${0})": "barrato (${0})",
	"strong": "grassetto",
	"table (${0})": "tabella (${0})",
	"text": "text",
	"title (optional)": "titolo (facoltativo)",
	"url": "url",
	"TogglePaneOrientationTooltip": "Attiva/disattiva orientamento del riquadro di suddivisione",
	"WarningHeaderTooDeep": "Livello intestazione non può superare 6",
	"WarningUnorderedListItem": "Elemento di elenco non ordinato all'interno di elenco ordinato",
	"WarningOrderedListItem": "Elemento di elenco ordinato all'interno di elenco non ordinato",
	"WarningOrderedListShouldStartAt1": "Il primo elemento in un elenco ordinato deve avere indice 1",
	"WarningLinkHasNoText": "Il link non ha testo",
	"WarningLinkHasNoURL": "Il link non ha URL",
	"WarningUndefinedLinkId": "ID link non definito: ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Maiusc",
	"KeyALT": "Alt",
	"KeyBKSPC": "Backspace",
	"KeyDEL": "Canc",
	"KeyEND": "Fine",
	"KeyENTER": "Accedi",
	"KeyESCAPE": "Esc",
	"KeyHOME": "Home",
	"KeyINSERT": "Ins",
	"KeyPAGEDOWN": "Pagina giù",
	"KeyPAGEUP": "Pagina su",
	"KeySPACE": "Spazio",
	"KeyTAB": "Scheda",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/es/messages',{
	"Navigator": "Navegador",
	"Sites": "Sitios",
	"Shell": "Shell",
	"ShellLinkWorkspace": "Shell de espacio de trabajo",
	"Get Plugins": "Obtener plug-ins",
	"Global": "Global",
	"Editor": "Editor",
	"EditorRelatedLink": "Mostrar carpeta actual",
	"EditorRelatedLinkParent": "Mostrar carpeta delimitadora",
	"EditorLinkWorkspace": "Mostrar espacio de trabajo",
	"EditorRelatedLinkProj": "Mostrar proyecto",
	"Filter bindings": "Enlaces de filtro",
	"Orion Editor": "Editor de Orion",
	"Orion Image Viewer": "Visor de imágenes Orion",
	"Orion Markdown Editor": "Editor Orion Markdown",
	"Orion Markdown Viewer": "Visor Orion Markdown",
	"Orion JSON Editor": "Editor JSON de Orion",
	"View on Site": "Ver en sitio",
	"View this file or folder on a web site hosted by Orion": "Ver este archivo o carpeta en un sitio web alojado en Orion.",
	"ShowAllKeyBindings": "Mostrar una lista de todos los enlaces en esta página",
	"Show Keys": "Mostrar claves",
	"HideShowBannerFooter": "Ocultar o mostrar la cabecera y el pie de página",
	"Toggle banner and footer": "Conmutar cabecera y pie de página",
	"ChooseFileOpenEditor": "Elija un archivo por el nombre y abrir un editor en él",
	"FindFile": "Buscar archivo denominado...",
	"System Configuration Details": "Detalles de configuración del sistema",
	"System Config Tooltip": "Ir a página de detalles de configuración del sistema",
	"Background Operations": "Operaciones de fondo",
	"Background Operations Tooltip": "Ir a página de operaciones de fondo",
	"Operation status is unknown": "Estado de operación desconocido",
	"Unknown item": "Elemento desconocido",
	"NoSearchAvailableErr": "No se puede buscar: no hay ningún servicio de búsqueda disponible",
	"Related": "Relacionado",
	"Options": "Opciones",
	"FAQ": "Preguntas frecuentes (FAQ)",
	"Report a Bug": "Errores",
	"Privacy Policy": "Privacidad",
	"Terms of Use": "Términos",
	"Copyright Agent": "Copyright",
	"Orion Logo": "Logotipo de Orion",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "REGISTRO: ",
	"View": "Ver",
	"no parent": "no hay padre",
	"no tree model": "no hay modelo de árbol",
	"no renderer": "no hay visualizador",
	"could not find table row ": "no se ha encontrado la fila de tabla ",
	"Operations": "Operaciones",
	"Operations running": "Operaciones en ejecución",
	"SomeOpWarning": "Algunas operaciones han finalizado con aviso",
	"SomeOpErr": "Algunas operaciones han finalizado con error",
	"no service registry": "no hay registro de servicio",
	"Tasks": "Tareas",
	"Close": "Cerrar",
	"Expand all": "Expandir todo",
	"Collapse all": "Contraer todo",
	"Search" : "Buscar",
	"Advanced search" : "Búsqueda avanzada",
	"Submit" : "Enviar",
	"More" : "Más",
	"Recent searches" : "Búsquedas recientes",
	"Regular expression" : "Expresión regular",
	"Search options" : "Opciones de búsqueda",
	"Global search" : "Búsqueda global",
	"Orion Home" : "Inicio de Orion",
	"Close notification" : "Cerrar notificación",
	"OpPressSpaceMsg" : "Operaciones - Pulse la barra espaciadora para mostrar las operaciones actuales",
	"Toggle side panel" : "Conmutar panel lateral",
	"Open or close the side panel": "Abrir o cerrar panel lateral",
	"Projects" : "Proyectos",
	"Toggle Sidebar" : "Conmutar barra lateral",
	"Sample HTML5 Site": "Sitio HTML5 de ejemplo",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "Generar un sitio web HTML5 'Hello World', con archivos JavaScript, HTML y CSS.",
	"Sample Orion Plugin": "Plug-in Orion de ejemplo",
	"Generate a sample plugin for integrating with Orion.": "Generar un plug-in de ejemplo para la integración con Orion.",
	"Browser": "Navegador Web",
	"OutlineProgress": "Obtener esquema para ${0} de ${1}",
	"outlineTimeout": "Se ha superado el tiempo de espera del servicio de esquema. Intente recargar la página y abrir el esquema de nuevo.",
	"UnknownError": "Se ha producido un error desconocido.",
	"UnknownWarning": "Se ha producido un aviso desconocido.",
	"Filter": "Filtrar (* = cualquier serie, ? = cualquier carácter)",
	"TemplateExplorerLabel": "Plantillas",
	"OpenTemplateExplorer": "Abrir explorador de plantillas",
	"Edit": "Editar",
	"CentralNavTooltip": "Conmutar menú de navegación",
	"Wrote: ${0}": "Se ha escrito: ${0}",
	"GenerateHTML": "Generar archivo HTML",
	"GenerateHTMLTooltip": "Escriba un archivo HTML generado a partir del contenido del editor Markdown actual",
	"alt text": "texto alternativo",
	"blockquote": "cita de bloque",
	"code": "code",
	"code (block)": "código (bloque)",
	"code (span)": "código (tramo)",
	"emphasis": "énfasis",
	"fenced code (${0})": "código delimitado (${0})",
	"header (${0})": "cabecera (${0})",
	"horizontal rule": "regla horizontal",
	"label": "etiqueta",
	"link (auto)": "enlace (auto)",
	"link (image)": "enlace (imagen)",
	"link (inline)": "enlace (en línea)",
	"link label": "etiqueta de enlace",
	"link label (optional)": "etiqueta de enlace (opcional)",
	"link (ref)": "enlace (ref)",
	"list item (bullet)": "elemento de lista (viñeta)",
	"list item (numbered)": "elemento de lista (numerado)",
	"strikethrough (${0})": "tachado (${0})",
	"strong": "fuerte",
	"table (${0})": "tabla (${0})",
	"text": "texto",
	"title (optional)": "título (opcional)",
	"url": "url",
	"TogglePaneOrientationTooltip": "Conmutar orientación de panel de división",
	"WarningHeaderTooDeep": "El nivel de cabecera no puede ser superior a 6",
	"WarningUnorderedListItem": "Elemento de lista sin ordenar en la lista ordenada",
	"WarningOrderedListItem": "Elemento de lista ordenado en la lista sin ordenar",
	"WarningOrderedListShouldStartAt1": "El primer elemento de una lista ordenada debe tener el índice 1",
	"WarningLinkHasNoText": "El enlace no tiene texto",
	"WarningLinkHasNoURL": "El enlace no tiene URL",
	"WarningUndefinedLinkId": "ID de enlace no definido: ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Mayús",
	"KeyALT": "Alt",
	"KeyBKSPC": "Retroceso",
	"KeyDEL": "Supr",
	"KeyEND": "Fin",
	"KeyENTER": "Intro",
	"KeyESCAPE": "Esc",
	"KeyHOME": "Inicio",
	"KeyINSERT": "Ins",
	"KeyPAGEDOWN": "Avanzar página",
	"KeyPAGEUP": "Retroceder página",
	"KeySPACE": "Espacio",
	"KeyTAB": "Tabulador",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/nls/pt-br/messages',{
	"Navigator": "Navegador",
	"Sites": "Sites",
	"Shell": "Shell",
	"ShellLinkWorkspace": "Shell de área de trabalho",
	"Get Plugins": "Obter Plugins",
	"Global": "Global",
	"Editor": "Editor",
	"EditorRelatedLink": "Mostrar pasta atual",
	"EditorRelatedLinkParent": "Mostrar pasta de fechamento",
	"EditorLinkWorkspace": "Mostrar área de trabalho",
	"EditorRelatedLinkProj": "Mostrar projeto",
	"Filter bindings": "Filtrar ligações",
	"Orion Editor": "Editor Orion",
	"Orion Image Viewer": "Orion Image Viewer",
	"Orion Markdown Editor": "Orion Markdown Editor",
	"Orion Markdown Viewer": "Orion Markdown Viewer",
	"Orion JSON Editor": "Orion JSON Editor",
	"View on Site": "Visualizar no Site",
	"View this file or folder on a web site hosted by Orion": "Visualize este arquivo ou pasta em um website hospedado pelo Orion.",
	"ShowAllKeyBindings": "Mostrar uma lista de todas as ligações de teclas desta página",
	"Show Keys": "Mostrar Teclas",
	"HideShowBannerFooter": "Ocultar ou mostrar o banner e rodapé da página",
	"Toggle banner and footer": "Alternar banner e rodapé",
	"ChooseFileOpenEditor": "Escolher um arquivo por nome e abrir um editor nele",
	"FindFile": "Localizar Arquivo Denominado...",
	"System Configuration Details": "Detalhes de Configuração do Sistema",
	"System Config Tooltip": "Página Acessar os Detalhes de Configuração do Sistema",
	"Background Operations": "Operações de Segundo Plano",
	"Background Operations Tooltip": "Página Acessar Operações de Segundo Plano",
	"Operation status is unknown": "O status da operação é desconhecido",
	"Unknown item": "Item desconhecido",
	"NoSearchAvailableErr": "Não é possível procurar: serviço de procura indisponível",
	"Related": "Relacionado",
	"Options": "Opções",
	"FAQ": "Perguntas Frequentes",
	"Report a Bug": "Erros",
	"Privacy Policy": "Privacidade",
	"Terms of Use": "Termos",
	"Copyright Agent": "Copyright",
	"Orion Logo": "Logotipo Orion",
	"Orion is in Beta. Please try it out but BEWARE your data may be lost.": "@buildLabel@",
	"LOG: ": "LOG: ",
	"View": "Visualização",
	"no parent": "nenhum pai",
	"no tree model": "nenhum modelo de árvore",
	"no renderer": "nenhum renderizador",
	"could not find table row ": "não foi possível localizar a linha da tabela ",
	"Operations": "Operações",
	"Operations running": "Operações em execução",
	"SomeOpWarning": "Algumas operações concluídas com aviso",
	"SomeOpErr": "Algumas operações concluídas com erro",
	"no service registry": "nenhum registro de serviço",
	"Tasks": "Tarefas",
	"Close": "Fechar",
	"Expand all": "Expandir todos",
	"Collapse all": "Reduzir todos",
	"Search" : "Pesquisar",
	"Advanced search" : "Procura avançada",
	"Submit" : "Enviar",
	"More" : "Mais",
	"Recent searches" : "Pesquisas recentes",
	"Regular expression" : "Expressão regular",
	"Search options" : "Opções de Pesquisa",
	"Global search" : "Procura global",
	"Orion Home" : "Início do Orion",
	"Close notification" : "Fechar notificação",
	"OpPressSpaceMsg" : "Operações - Pressione a barra de espaço para exibir as operações atuais",
	"Toggle side panel" : "Alternar Painel Lateral",
	"Open or close the side panel": "Abrir ou fechar o painel lateral",
	"Projects" : "Projetos",
	"Toggle Sidebar" : "Alternar barra lateral",
	"Sample HTML5 Site": "Site HTML5 de Amostra",
	"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.": "Gerar um website HTML5 'Hello World', incluindo os arquivos JavaScript, HTML e CSS.",
	"Sample Orion Plugin": "Plug-in Orion de Amostra",
	"Generate a sample plugin for integrating with Orion.": "Gerar um plugin de amostra para integração com Orion.",
	"Browser": "Navegador da Web",
	"OutlineProgress": "Obtendo estrutura de tópicos para ${0} de ${1}",
	"outlineTimeout": "Serviço de estrutura de tópicos atingiu tempo limite. Tente recarregar a página e abrir a estrutura de tópicos novamente.",
	"UnknownError": "Ocorreu um erro desconhecido.",
	"UnknownWarning": "Ocorreu um erro desconhecido.",
	"Filter": "Filtrar (* = qualquer sequência, ? = qualquer caractere)",
	"TemplateExplorerLabel": "Modelos",
	"OpenTemplateExplorer": "Abrir o Explorador de modelos",
	"Edit": "Editar",
	"CentralNavTooltip": "Alternar menu de navegação",
	"Wrote: ${0}": "Gravado: ${0}",
	"GenerateHTML": "Gerar arquivo HTML",
	"GenerateHTMLTooltip": "Gravar um arquivo HTML gerado do conteúdo do editor Markdown atual",
	"alt text": "texto alternativo",
	"blockquote": "citação de bloco",
	"code": "código",
	"code (block)": "código (bloco)",
	"code (span)": "código (período)",
	"emphasis": "ênfase",
	"fenced code (${0})": "código protegido (${0})",
	"header (${0})": "cabeçalho (${0})",
	"horizontal rule": "régua horizontal",
	"label": "rótulo",
	"link (auto)": "vínculo (automático)",
	"link (image)": "vínculo (imagem)",
	"link (inline)": "vínculo (sequencial)",
	"link label": "etiqueta de vínculo",
	"link label (optional)": "Etiqueta de vínculo (opcional)",
	"link (ref)": "vínculo (ref)",
	"list item (bullet)": "item da lista (marcador)",
	"list item (numbered)": "item da lista (numerado)",
	"strikethrough (${0})": "tachado (${0})",
	"strong": "forte",
	"table (${0})": "tabela (${0})",
	"text": "texto",
	"title (optional)": "título (opcional)",
	"url": "url",
	"TogglePaneOrientationTooltip": "Alternar orientação da área de janela dividida",
	"WarningHeaderTooDeep": "O nível do cabeçalho não pode exceder 6",
	"WarningUnorderedListItem": "Item da lista não ordenada dentro da lista ordenada",
	"WarningOrderedListItem": "Item da lista ordenada dentro da lista não ordenada",
	"WarningOrderedListShouldStartAt1": "O primeiro item em uma lista ordenada deve ter o índice 1",
	"WarningLinkHasNoText": "O link não possui texto",
	"WarningLinkHasNoURL": "O link não possui URL",
	"WarningUndefinedLinkId": "ID do link indefinido: ${0}",
	"PageTitleFormat": "${0} - ${1}", // ${0} is the file or resource being edited; ${1} is the task (eg. "Editor")
	// Display names for keys:
	"KeyCTRL": "Ctrl",
	"KeySHIFT": "Shift",
	"KeyALT": "Alt",
	"KeyBKSPC": "Backspace",
	"KeyDEL": "Del",
	"KeyEND": "Terminar",
	"KeyENTER": "Inserir o",
	"KeyESCAPE": "Esc",
	"KeyHOME": "Home",
	"KeyINSERT": "Ins",
	"KeyPAGEDOWN": "Página Abaixo",
	"KeyPAGEUP": "Página Acima",
	"KeySPACE": "Espaço",
	"KeyTAB": "Guia",
	// End key names
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/

/*eslint-env browser, amd*/
define('orion/util',[],function() {

	var userAgent = navigator.userAgent;
	var isIE = (userAgent.indexOf("MSIE") !== -1 || userAgent.indexOf("Trident") !== -1) ? document.documentMode : undefined; //$NON-NLS-1$ //$NON-NLS-0$
	var isFirefox = parseFloat(userAgent.split("Firefox/")[1] || userAgent.split("Minefield/")[1]) || undefined; //$NON-NLS-1$ //$NON-NLS-0$
	var isOpera = userAgent.indexOf("Opera") !== -1 ? parseFloat(userAgent.split("Version/")[1]) : undefined; //$NON-NLS-0$
	var isChrome = parseFloat(userAgent.split("Chrome/")[1]) || undefined; //$NON-NLS-0$
	var isSafari = userAgent.indexOf("Safari") !== -1 && !isChrome; //$NON-NLS-0$
	var isWebkit = parseFloat(userAgent.split("WebKit/")[1]) || undefined; //$NON-NLS-0$
	var isAndroid = userAgent.indexOf("Android") !== -1; //$NON-NLS-0$
	var isIPad = userAgent.indexOf("iPad") !== -1; //$NON-NLS-0$
	var isIPhone = userAgent.indexOf("iPhone") !== -1; //$NON-NLS-0$
	var isIOS = isIPad || isIPhone;
	var isMac = navigator.platform.indexOf("Mac") !== -1; //$NON-NLS-0$
	var isWindows = navigator.platform.indexOf("Win") !== -1; //$NON-NLS-0$
	var isLinux = navigator.platform.indexOf("Linux") !== -1; //$NON-NLS-0$
	var isTouch = typeof document !== "undefined" && "ontouchstart" in document.createElement("input"); //$NON-NLS-1$ //$NON-NLS-0$
	
	var platformDelimiter = isWindows ? "\r\n" : "\n"; //$NON-NLS-1$ //$NON-NLS-0$

	function formatMessage(msg) {
		var args = arguments;
		return msg.replace(/\$\{([^\}]+)\}/g, function(str, index) { return args[(index << 0) + 1]; });
	}
	
	var XHTML = "http://www.w3.org/1999/xhtml"; //$NON-NLS-0$
	function createElement(document, tagName) {
		if (document.createElementNS) {
			return document.createElementNS(XHTML, tagName);
		}
		return document.createElement(tagName);
	}

	return {
		formatMessage: formatMessage,
		
		createElement: createElement,
		
		/** Browsers */
		isIE: isIE,
		isFirefox: isFirefox,
		isOpera: isOpera,
		isChrome: isChrome,
		isSafari: isSafari,
		isWebkit: isWebkit,
		isAndroid: isAndroid,
		isIPad: isIPad,
		isIPhone: isIPhone,
		isIOS: isIOS,
		
		/** OSs */
		isMac: isMac,
		isWindows: isWindows,
		isLinux: isLinux,

		/** Capabilities */
		isTouch: isTouch,

		platformDelimiter: platformDelimiter
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/littlelib',["orion/util"], function(util) {
	/**
	 * @name orion.webui.littlelib
	 * @class A small library of DOM and UI helpers.
	 */

	/**
	 * Alias for <code>node.querySelector()</code>.
	 * @name orion.webui.littlelib.$
	 * @function
	 * @static
	 * @param {String} selectors Selectors to match on.
	 * @param {Node} [node=document] Node to query under.
	 * @returns {Element}
	 */
	function $(selector, node) {
		if (!node) {
			node = document;
		}
		return node.querySelector(selector);
	}

	/**
	 * Alias for <code>node.querySelectorAll()</code>.
	 * @name orion.webui.littlelib.$$
	 * @function
	 * @static
	 * @param {String} selectors Selectors to match on.
	 * @param {Node} [node=document] Node to query under.
	 * @returns {NodeList}
	 */
	function $$(selector, node) {
		if (!node) {
			node = document;
		}
		return node.querySelectorAll(selector);
	}

	/**
	 * Identical to {@link orion.webui.littlelib.$$}, but returns an Array instead of a NodeList.
	 * @name orion.webui.littlelib.$$array
	 * @function
	 * @static
	 * @param {String} selectors Selectors to match on.
	 * @param {Node} [node=document] Node to query under.
	 * @returns {Element[]}
	 */
	function $$array(selector, node) {
		return Array.prototype.slice.call($$(selector,node));
	}

	/**
	 * Alias for <code>document.getElementById</code>, but returns the input unmodified when passed a Node (or other non-string).
	 * @function
	 * @param {String|Element} elementOrId
	 * @returns {Element}
	 */
	function node(either) {
		var theNode = either;
		if (typeof(either) === "string") { //$NON-NLS-0$
			theNode = document.getElementById(either);
		}	
		return theNode;
	}

	/**
	 * Returns whether <code>child</code> is a descendant of <code>parent</code> in the DOM order.
	 * @function
	 * @param {Node} parent
	 * @param {Node} child
	 * @returns {Boolean}
	 */
	function contains(parent, child) {
		if (!parent || !child) { return false; }
		if (parent === child) { return true; }
		var compare = parent.compareDocumentPosition(child);  // useful to break out for debugging
		return Boolean(compare & 16);
	}

	/**
	 * Returns the bounds of a node. The returned coordinates are absolute (not relative to the viewport).
	 * @function
	 * @param {Node} node
	 * @returns {Object}
	 */
	function bounds(node) {
		var clientRect = node.getBoundingClientRect();
		return { 
			left: clientRect.left + document.documentElement.scrollLeft,
			top: clientRect.top + document.documentElement.scrollTop,
			width: clientRect.width,
			height: clientRect.height
		};
	}

	/**
	 * Removes all children of the given node.
	 * @name orion.webui.littlelib.empty
	 * @function
	 * @static
	 * @param {Node} node
	 */
	function empty(node) {
		while (node.hasChildNodes()) {
			var child = node.firstChild;
			node.removeChild(child);
		}
	}

	function _getTabIndex(node) {
		var result = node.tabIndex;
		if (result === 0 && util.isIE) {
			/*
			 * The default value of tabIndex is 0 on IE, even for elements that are not focusable
			 * by default (http://msdn.microsoft.com/en-us/library/ie/ms534654(v=vs.85).aspx).
			 * Handle this browser difference by treating this value as -1 if the node is a type
			 * that is not focusable by default according to the MS doc and has not had this
			 * attribute value explicitly set on it.
			 */
			var focusableElements = {
				a: true,
				body: true,
				button: true,
				frame: true,
				iframe: true,
				img: true,
				input: true,
				isindex: true,
				object: true,
				select: true,
				textarea: true
			};
			if (!focusableElements[node.nodeName.toLowerCase()] && !node.attributes.tabIndex) {
				result = -1;
			}
		}
		return result;
	}

	/* 
	 * Inspired by http://brianwhitmer.blogspot.com/2009/05/jquery-ui-tabbable-what.html
	 */
	function firstTabbable(node) {
		if (_getTabIndex(node) >= 0) {
			return node;
		}
		if (node.hasChildNodes()) {
			for (var i=0; i<node.childNodes.length; i++) {
				var result = firstTabbable(node.childNodes[i]);
				if (result) {
					return result;
				}
			}
		}
		return null;
	}
	
	function lastTabbable(node) {
		if (_getTabIndex(node) >= 0) {
			return node;
		}
		if (node.hasChildNodes()) {
			for (var i=node.childNodes.length - 1; i>=0; i--) {
				var result = lastTabbable(node.childNodes[i]);
				if (result) {
					return result;
				}
			}
		}
		return null;
	}

	var variableRegEx = /\$\{([^\}]+)\}/;
	// Internal helper
	function processNodes(node, replace) {
		if (node.nodeType === 3) { // TEXT_NODE
			var matches = variableRegEx.exec(node.nodeValue);
			if (matches && matches.length > 1) {
				replace(node, matches);
			}
		}
		if (node.hasChildNodes()) {
			for (var i=0; i<node.childNodes.length; i++) {
				processNodes(node.childNodes[i], replace);
			}
		}
	}

	/**
	 * Performs substitution of strings into textContent within the given node and its descendants. An occurrence of <code>${n}</code>
	 * in text content will be replaced with the string <code>messages[n]</code>.
	 * <p>This function is recommended for binding placeholder text in template-created DOM elements to actual display strings.</p>
	 * @name orion.webui.littlelib.processTextNodes
	 * @function
	 * @param {Node} node The node to perform replacement under.
	 * @param {String[]} messages The replacement strings.
	 */
	function processTextNodes(node, messages) {
		processNodes(node, function(targetNode, matches) {
			var replaceText = messages[matches[1]] || matches[1];
			targetNode.parentNode.replaceChild(document.createTextNode(replaceText), targetNode);
		});
	}

	/**
	 * Performs substitution of DOM nodes into textContent within the given node and its descendants. An occurrence of <code>${n}</code>
	 * in text content will be replaced by the DOM node <code>replaceNodes[n]</code>.
	 * <p>This function is recommended for performing rich-text replacement within a localized string. The use of actual DOM nodes
	 * avoids the need for embedded HTML in strings.</p>
	 * @name orion.webui.littlelib.processDOMNodes
	 * @function
	 * @param {Node} node The node to perform replacement under.
	 * @param {Node[]} replaceNodes The replacement nodes.
	 */
	function processDOMNodes(node, replaceNodes) {
		processNodes(node, function(targetNode, matches) {
			var replaceNode = replaceNodes[matches[1]];
			if (replaceNode) {
				var range = document.createRange();
				var start = matches.index;
				range.setStart(targetNode, start);
				range.setEnd(targetNode, start + matches[0].length);
				range.deleteContents();
				range.insertNode(replaceNode);
			}
		});
	}

	/**
	 * Adds auto-dismiss functionality to the document. When a click event occurs whose <code>target</code> is not a descendant of
	 * one of the <code>excludeNodes</code>, the <code>dismissFunction</code> is invoked.
	 * @name orion.webui.littlelib.addAutoDismiss
	 * @function
	 * @static
	 * @param {Node[]} excludeNodes Clicks targeting any descendant of these nodes will not trigger the dismissFunction.
	 * @param {Function} dismissFunction The dismiss handler.
	 */
	
	var autoDismissNodes = null;

	function addAutoDismiss(excludeNodes, dismissFunction) {
		// auto dismissal.  Click anywhere else means close.
		function onclick(event) {
			autoDismissNodes.forEach(function(autoDismissNode) {
				var excludeNodeInDocument = false;
				var excluded = autoDismissNode.excludeNodes.some(function(excludeNode) {
					if(document.body.contains(excludeNode)) {
						excludeNodeInDocument = true;
						return excludeNode.contains(event.target);
					}
					return false;
				});
				if (excludeNodeInDocument && !excluded) {
					try {
						autoDismissNode.dismiss(event);
					} catch (e) {
						if (typeof console !== "undefined" && console) { //$NON-NLS-0$
							console.error(e && e.message);
						}
					}
				}
			});
			autoDismissNodes = autoDismissNodes.filter(function(autoDismissNode) {
				// true if at least one excludeNode is in document.body
				return autoDismissNode.excludeNodes.some(function(excludeNode) {
					return document.body.contains(excludeNode);
				});
			});
		}

		// Hook listener only once
		if (autoDismissNodes === null) {
			autoDismissNodes = [];
			document.addEventListener("click", onclick, true); //$NON-NLS-0$
			if (util.isIOS) {
				document.addEventListener("touchend", function(event){
					function unhook(){
						event.target.removeEventListener("click", unhook);
					}
					if (event.touches.length === 0) {
						// we need a click eventlistener on the target to have ios really trigger a click
						event.target.addEventListener("click", unhook);
					}	
				}, false);
			}
		}
		
		autoDismissNodes.push({excludeNodes: excludeNodes, dismiss: dismissFunction});
	}
	
	/**
	 * Removes all auto-dismiss nodes which trigger the specified dismiss function.
	 * 
	 * @name orion.webui.littlelib.removeAutoDismiss
	 * @function
	 * @static
	 * @param {Function} dismissFunction The dismiss function to look for.
	 */
	function removeAutoDismiss(dismissFunction) {
		autoDismissNodes = autoDismissNodes.filter(function(autoDismissNode) {
			return dismissFunction !== autoDismissNode.dismiss;
		});
	}
	
	/**
	 * Returns the parent of the node that has the vertical scroll bar.
	 * 
	 * @name orion.webui.littlelib.getOffsetParent
	 * @function
	 * @static
	 * @param {Element} node The node to lookup the offset parent
	 */
	function getOffsetParent(node) {
		var offsetParent = node.parentNode, documentElement = document.documentElement;
		while (offsetParent && offsetParent !== documentElement) {
			var style = window.getComputedStyle(offsetParent, null);
			if (!style) { break; }
			var overflow = style.getPropertyValue("overflow-y"); //$NON-NLS-0$
			if (overflow === "auto" || overflow === "scroll") { break; } //$NON-NLS-1$ //$NON-NLS-0$
			offsetParent = offsetParent.parentNode;
		}
		return offsetParent;
	}
	
	/**
	 * Cancels the default behavior of an event and stops its propagation.
	 * @name orion.webui.littlelib.stop
	 * @function
	 * @static
	 * @param {Event} event
	 */
	function stop(event) {
		if (window.document.all) { 
			event.keyCode = 0;
		}
		if (event.preventDefault) {
			event.preventDefault();
			event.stopPropagation();
		}
	}
	
	function setFramesEnabled(enable) {
		var frames = document.getElementsByTagName("iframe"); //$NON-NLS-0$
		for (var i = 0; i<frames.length; i++) {
			frames[i].parentNode.style.pointerEvents = enable ? "" : "none"; //$NON-NLS-0$
		}
	}

	/**
	 * Holds useful <code>keyCode</code> values.
	 * @name orion.webui.littlelib.KEY
	 * @static
	 */
	var KEY = {
		BKSPC: 8,
		TAB: 9,
		ENTER: 13,
		ESCAPE: 27,
		SPACE: 32,
		PAGEUP: 33,
		PAGEDOWN: 34,
		END: 35,
		HOME: 36,
		LEFT: 37,
		UP: 38,
		RIGHT: 39,
		DOWN: 40,
		INSERT: 45,
		DEL: 46
	};
	/**
	 * Maps a <code>keyCode</code> to <tt>KEY</tt> name. This is the inverse of {@link orion.webui.littlelib.KEY}.
	 * @private
	 */
	var KEY_CODE = Object.create(null);
	Object.keys(KEY).forEach(function(name) {
		KEY_CODE[KEY[name]] = name;
	});

	/**
	 * @param {Number} keyCode
	 * @returns The name of the <code>lib.KEY</code> entry for keyCode, or null.
	 */
	function keyName(keyCode) {
		return KEY_CODE[keyCode] || null;
	}

	/**
	 * Creates DOM nodes from the specified template string.
	 * 
	 * @param {String} templateString 	A string containing the HTML template to use
	 * @param {Node} parentNode 		Optional. The parent node to insert the new nodes into. 
	 * 									The parent's contents will be completely replaced.
	 * @returns If the template string contains a single node or a wrapper node which
	 * 			wraps all the other nodes that single DOM node will be returned. 
	 * 			Otherwise if the template string contains multiple top-level nodes a
	 * 			{NodeList} object containing all the top-level nodes will be returned.
	 */
	function createNodes(templateString, parentNode) {
		var parent = parentNode;
		var newNodes = null;
		
		if (undefined === parent) {
			parent = document.createElement("div"); //$NON-NLS-0$
		}

		parent.innerHTML = templateString;	
		if (1 < parent.childNodes.length) {
			newNodes = parent.childNodes;
		} else {
			newNodes = parent.firstChild;
		}
		
		return newNodes;
	}

	//return module exports
	return {
		$: $,
		$$: $$,
		$$array: $$array,
		node: node,
		contains: contains,
		bounds: bounds,
		empty: empty,
		firstTabbable: firstTabbable,
		lastTabbable: lastTabbable,
		stop: stop,
		processTextNodes: processTextNodes,
		processDOMNodes: processDOMNodes,
		addAutoDismiss: addAutoDismiss,
		setFramesEnabled: setFramesEnabled,
		getOffsetParent: getOffsetParent,
		removeAutoDismiss: removeAutoDismiss,
		keyName: keyName,
		KEY: KEY,
		createNodes: createNodes
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/webui/treetable',['i18n!orion/nls/messages', 'orion/webui/littlelib'], function(messages, lib) {

	/**
	 * Constructs a new TableTree with the given options.
	 * 
	 * @param options 
	 * @name orion.treetable.TableTree 
	 * @class Generates an HTML table where one of the columns is indented according to depth of children.
	 * <p>Clients must supply a model that generates children items, and a renderer can be supplied which
	 * generates the HTML table row for each child. Custom rendering allows clients to use checkboxes,
	 * images, links, etc. to describe each  element in the tree.  Renderers handle all clicks and other
	 * behavior via their supplied row content.</p>
	 * 
	 * <p>The table tree parent can be specified by id or DOM node.</p>
	 * 
	 * <p>The tree provides API for the client to programmatically expand and collapse
	 * nodes, based on the client renderer's definition of how that is done (click on icon, etc.).
	 * The tree will manage the hiding and showing of child DOM elements and proper indent</p>
	 * 
	 * The model must implement:
	 * <ul>
	 *   <li>getRoot(onItem)</li>
	 *   <li>getChildren(parentItem, onComplete)</li>
	 *   <li>getId(item)  // must be a valid DOM id</li>
	 * </ul>
	 * 
	 * Renderers must implement:
	 * <ul>
	 *   <li>initTable(tableNode) // set up table attributes and a header if desired</li>
	 *   <li>render(item, tr) // generate tds for the row</li>
	 *   <li>labelColumnIndex() // 0 based index of which td contains the primary label which will be indented</li>
	 *   <li>rowsChanged // optional, perform any work (such as styling) that should happen after the row content changes</li>
	 *   <li>updateExpandVisuals(row, isExpanded) // update any expand/collapse visuals for the row based on the specified state</li>
	 * </ul>
	 *   TODO DOC
	 *   wrapperCallback
	 *   tableCallback
	 *   bodyCallback
	 *   rowCallback
	 */
	function TableTree (options) {
		this._init(options);
	}
	TableTree.prototype = /** @lends orion.treetable.TableTree.prototype */ {
		_init: function(options) {
			var parent = options.parent;
			var tree = this;
			parent = lib.node(parent);
			if (!parent) { throw messages["no parent"]; }
			if (!options.model) { throw messages["no tree model"]; }
			if (!options.renderer) { throw messages["no renderer"]; }
			this._parent = parent;
			this._treeModel = options.model;
			this._onComplete = options.onComplete;
			this._renderer = options.renderer;
			this._showRoot = options.showRoot === undefined ? false : options.showRoot;
			this._indent = options.indent === undefined ? 16 : options.indent;
			this._preCollapse = options.preCollapse;
			this._onCollapse = options.onCollapse;
			this._labelColumnIndex = options.labelColumnIndex === undefined ? 0 : options.labelColumnIndex;
			this._id = options.id === undefined ? "treetable" : options.id; //$NON-NLS-0$
			this._tableStyle = options.tableStyle;
			this._tableElement = options.tableElement || "table"; //$NON-NLS-0$
			this._tableBodyElement = options.tableBodyElement || "tbody"; //$NON-NLS-0$
			this._tableRowElement = options.tableRowElement || "tr"; //$NON-NLS-0$
			
			// Generate the table
			this._treeModel.getRoot(function (root) {
				tree._root = root;
				if (tree._showRoot) {
					root._depth = 0;
					tree._generate([root], 0);
				}
				else {
					tree._treeModel.getChildren(root, function(children) {
						if (tree.destroyed) { return; }
						tree._generate(children, 0);
					});
				}
			});
		},
		
		destroy: function() {
			this.destroyed = true;
			this._removeAllRows();
		},
		
		_generate: function(children, indentLevel) {
			lib.empty(this._parent);
			var wrapper = document.createElement("div"); //$NON-NLS-0$
			if (this._renderer.wrapperCallback) {
				this._renderer.wrapperCallback(wrapper);
			}
			var table = document.createElement(this._tableElement); //$NON-NLS-0$
			if (this._renderer.tableCallback) {
				this._renderer.tableCallback(table);
			}
			table.id = this._id;
			if (this._tableStyle) {
				table.classList.add(this._tableStyle);
			}
			this._renderer.initTable(table, this);
			this._bodyElement = document.createElement(this._tableBodyElement); //$NON-NLS-0$
			if (this._renderer.bodyCallback) {
				this._renderer.bodyCallback(this._bodyElement);
			}
			this._bodyElement.id = this._id+"tbody"; //$NON-NLS-0$
			if (children.length === 0) {
				if (this._renderer.emptyCallback) {
					this._renderer.emptyCallback(this._bodyElement);
				}
			} else {
				this._generateChildren(children, indentLevel); //$NON-NLS-0$
			}
			table.appendChild(this._bodyElement);
			wrapper.appendChild(table);
			this._parent.appendChild(wrapper);
			this._rowsChanged();
			if (this._onComplete) {
				this._onComplete(this);
			}
		},
		
		_generateChildren: function(children, indentLevel, referenceNode) {
			for (var i=0; i<children.length; i++) {
				var row = document.createElement(this._tableRowElement); //$NON-NLS-0$
				if(this._renderer && typeof this._renderer.initSelectableRow === "function") { //$NON-NLS-0$
					this._renderer.initSelectableRow(children[i], row);
				}
				this._generateRow(children[i], row, indentLevel, referenceNode);
				if (referenceNode) {
					this._bodyElement.insertBefore(row, referenceNode.nextSibling);
					referenceNode = row;
				} else {
					this._bodyElement.appendChild(row);
				}
			}
		},
		
		_generateRow: function(child, row, indentLevel) {
			row.id = this._treeModel.getId(child);
			row._depth = indentLevel;
			// This is a perf problem and potential leak because we're bashing a dom node with
			// a javascript object.  (Whereas above we are using simple numbers/strings). 
			// We should consider an item map.
			row._item = child;
			this._renderer.render(child, row);
			// generate an indent
			var indent = this._indent * indentLevel;
			row.childNodes[Math.min(row.childNodes.length - 1, this._labelColumnIndex)].style.paddingLeft = indent +"px";  //$NON-NLS-0$
			if(this._renderer.updateExpandVisuals) {
			    this._renderer.updateExpandVisuals(row, row._expanded);
			}
			if (this._renderer.rowCallback) {
				this._renderer.rowCallback(row, child);
			}
		},
		
		_rowsChanged: function() {
			// notify the renderer if it has implemented the function
			if (this._renderer.rowsChanged) {
				this._renderer.rowsChanged();
			}
		},
		
		getSelected: function() {
			return this._renderer.getSelected();
		},
		
		redraw: function(item) {
			var itemId = this._treeModel.getId(item);
			var row = lib.node(itemId);
			if (!row) return;
			lib.empty(row);
			this._generateRow(item, row, row._depth);
		},
		
		refresh: function(item, children, /* optional */ forceExpand) {
			var parentId = this._treeModel.getId(item);
			var tree;
			if (parentId === this._id) {  // root of tree
				this._removeChildRows(parentId);
				this._generateChildren(children, 0);
				this._rowsChanged();
			} else if (parentId === this._treeModel.getId(this._root) && item.removeAll) {
				this._removeAllRows();
				this._generateChildren(children, 0);
				this._rowsChanged();
			} else {  // node in the tree
				var row = lib.node(parentId);
				if (row) {
					// if it is showing children, refresh what is showing
					row._item = item;
					// If the row should be expanded
					if (row && (forceExpand || row._expanded)) {
						this._removeChildRows(parentId);
						if(children){
							row._expanded = true;
							if(this._renderer.updateExpandVisuals) {
							    this._renderer.updateExpandVisuals(row, true);
							}
							this._generateChildren(children, row._depth+1, row); //$NON-NLS-0$
							this._rowsChanged();
						} else {
							tree = this;
							if(this._renderer.updateExpandVisuals) {
							    this._renderer.updateExpandVisuals(row, "progress"); //$NON-NLS-0$
							}
							children = this._treeModel.getChildren(row._item, function(children) {
								if (tree.destroyed) { return; }
								if(tree._renderer.updateExpandVisuals) {
								    tree._renderer.updateExpandVisuals(row, true);
								}
								if (!row._expanded) {
									row._expanded = true;
									tree._generateChildren(children, row._depth+1, row); //$NON-NLS-0$
									tree._rowsChanged();
								}
							});
						}
					} else {
					    if(this._renderer.updateExpandVisuals) {
						     this._renderer.updateExpandVisuals(row, false);
						}
					}
				} else {
					// the item wasn't found.  We could refresh the root here, but for now
					// let's log it to figure out why.
					console.log(messages["could not find table row "] + parentId);
				}
			}
		},
		
		getItem: function(itemOrId) {  // a dom node, a dom id, or the item
			var node = lib.node(itemOrId);
			if (node && node._item) {
				return node._item;
			}
			return itemOrId;  // return what we were given
		},
		
		toggle: function(id) {
			var row = lib.node(id);
			if (row) {
				if (row._expanded) {
					this.collapse(id, true);
				}
				else {
					this.expand(id);
				}
			}
		},
		
		isExpanded: function(itemOrId) {
			var id = typeof(itemOrId) === "string" ? itemOrId : this._treeModel.getId(itemOrId); //$NON-NLS-0$
			var row =lib.node(id);
			if (row) {
				return row._expanded;
			}
			return false;
		},
		
		expand: function(itemOrId , postExpandFunc , args) {
			var id = typeof(itemOrId) === "string" ? itemOrId : this._treeModel.getId(itemOrId); //$NON-NLS-0$
			var row = lib.node(id);
			if (row) {
				var tree = this;
				if (row._expanded) {
					if (postExpandFunc) {
						postExpandFunc.apply(tree, args);
					}
					return;
				}
				if(this._renderer.updateExpandVisuals) {
				    this._renderer.updateExpandVisuals(row, "progress"); //$NON-NLS-0$
				}
				this._treeModel.getChildren(row._item, function(children) {
					if (tree.destroyed) { return; }
					if(tree._renderer.updateExpandVisuals) {
					   tree._renderer.updateExpandVisuals(row, true);
					}
					if (!row._expanded) {
						row._expanded = true;
						tree._generateChildren(children, row._depth+1, row); //$NON-NLS-0$
						tree._rowsChanged();
					}
					if (postExpandFunc) {
						postExpandFunc.apply(tree, args);
					}
				});
			}
		}, 
		
		_removeChildRows: function(parentId) {
			// true if we are removing directly from table
			var foundParent = parentId === this._id;
			var parentRow;
			var stop = false;
			var parentDepth = -1;
			var toRemove = [];
			var rows = lib.$$array(".treeTableRow", this._parent); //$NON-NLS-0$
			for (var i=0; i < rows.length; i++) {
				var row = rows[i];
				if (stop) {
					break;
				}
				if (foundParent) {
					if (!parentRow || row.parentNode === parentRow.parentNode) {
						if (row._depth > parentDepth) {
							toRemove.push(row);
						}
						else {
							stop = true;  // we reached a sibling to our parent
						}
					}
				} else {
					if (row.id === parentId) {
						foundParent = true;
						parentDepth = row._depth;
						parentRow = row;
					}
				}
			}
			for (var j=0; j<toRemove.length; j++) {
				var child = toRemove[j];
				if(child &&  child._item && typeof child._item.destroy === "function") { //$NON-NLS-0$
					child._item.destroy();
				}
				child.parentNode.removeChild(child);
			}
		},
		
		_removeAllRows: function() {
			var rows = lib.$$array(".treeTableRow", this._parent); //$NON-NLS-0$
			for (var j=0; j<rows.length; j++) {
				if(rows[j] &&  rows[j]._item && typeof rows[j]._item.destroy === "function") { //$NON-NLS-0$
					rows[j]._item.destroy();
				}
				rows[j].parentNode.removeChild(rows[j]);
			}
		},
		
		_collapse : function(id, row) {
			row._expanded = false;
			if(this._renderer.updateExpandVisuals) {
			    this._renderer.updateExpandVisuals(row, false);
			}
			this._removeChildRows(id);
			this._rowsChanged();
			if(this._onCollapse){
				this._onCollapse(row._item);
			}
		},
		
		collapse: function(itemOrId, byToggle) {
			var id = typeof(itemOrId) === "string" ? itemOrId : this._treeModel.getId(itemOrId); //$NON-NLS-0$
			var row = lib.node(id);
			if (row) {
				if (!row._expanded) {
					return;
				}
				if(byToggle && this._preCollapse){
					this._preCollapse(row._item).then(function(result) {
						if(result) {
							this._collapse(id, row);
						} else {
							return;
						}
					}.bind(this));
				} else {
					this._collapse(id, row);
				}
			}
		},
		
		/**
		 * Returns this tree's indentation increment
		 */
		getIndent: function() {
			return this._indent;
		}
	};  // end prototype
	TableTree.prototype.constructor = TableTree;
	//return module exports
	return {TableTree: TableTree};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/treeModelIterator',[], function(){

var exports = {};

exports.TreeModelIterator = (function() {
	/**
	 * Creates a new tree iterator.
	 *
	 * @name orion.TreeModelIterator.TreeModelIterator
	 * @class A tree model based iterator component.
	 * @param {list} firstLevelChildren The first level children of the tree root, each item has children and parent property recursively.
	 * @param {Object} options The options object which provides iterate patterns and all call back functions when iteration happens.
	 */
	function TreeModelIterator(firstLevelChildren, options) {
		this.firstLevelChildren = firstLevelChildren;
		this.reset();
		this._init(options);
	}
	TreeModelIterator.prototype = /** @lends orion.TreeModelIterator.TreeModelIterator.prototype */ {
		
		_init: function(options){
			if(!options){
				return;
			}
			this.isExpanded = options.isExpanded;//optional callback providing that if a model item is expanded even if it has children. Default is true if it has children.
			this.isExpandable = options.isExpandable;//optional  callback providing that if a model item is expandable.Default is true .
			this.forceExpandFunc = options.forceExpandFunc;//optional  callback providing the expansion on the caller side.
			this.getChildrenFunc = options.getChildrenFunc;//optional  callback providing the of a parent, instead of using the .children property.
		},
			
		topLevel: function(modelItem) {
			return modelItem.parent ? (modelItem.parent === this.root) : true;
		},
		
		_getChildren: function(model){
			if(typeof this.getChildrenFunc === "function") {
				return this.getChildrenFunc(model);
			}
			return model ? model.children : null;
		},
		
		_expanded: function(model){
			if(!model){
				return true;//root is always expanded
			}
			var children = this._getChildren(model);
			var expanded = (children && children.length > 0);
			if(this.isExpanded && expanded){
				expanded = this.isExpanded(model);
			}
			return expanded;
		},
		
		//This is for the force expand
		_expandable: function(model){
			if(!model){
				return true;//root is always expandable
			}
			if(this.isExpandable){
				return this.isExpandable(model);
			}
			return false;//If there is no isExpandable provided, we assume nothing is expandable
		},
		
		_diveIn: function(model){
			if( this._expanded(model)){
				var children = this._getChildren(model);
				this.setCursor(children[0]);
				return this.cursor();
			}
			return null;
		},
		
		_drillToLast: function(model){
			if( this._expanded(model)){
				var children = this._getChildren(model);
				return this._drillToLast(children[children.length-1]);
			}
			return model;
		},
		
		_forward: function(forceExpand){
			//first we will try to dive into the current cursor
			if(!this._cursor){
				return null;
			}
			var next = this._diveIn(this._cursor);
			if(!next){
				if(forceExpand && this._expandable(this._cursor) && this.forceExpandFunc){
					var that = this;
					return this.forceExpandFunc(this._cursor, "first", function(model){if(model){that.setCursor(model);}}); //$NON-NLS-0$
				}
				next = this._findSibling(this._cursor, true);
				if(next){
					this.setCursor(next);
				} 
			}
			return next;
		},
		
		_backward: function(forceExpand){
			if(!this._cursor){
				return null;
			}
			var previous = this._findSibling(this._cursor, false);
			if(previous && previous !== this._cursor.parent){
				previous = this._drillToLast(previous);
			}
			if(forceExpand && previous && this._expandable(previous) && this.forceExpandFunc && previous !== this._cursor.parent){
				var that = this;
				return this.forceExpandFunc(previous, "last", function(model){if(model){that.setCursor(model);}}); //$NON-NLS-0$
			}
			if(previous){
				this.setCursor(previous);
			} 
			return previous;
		},
		
		_findSibling: function(current, forward){
			var isTopLevel = this.topLevel(current);
			var children = this._getChildren(current.parent);
			var siblings = isTopLevel ? this.firstLevelChildren: children;
			for(var i = 0; i < siblings.length; i++){
				if(siblings[i] === current){
					if((i === 0 && !forward) ){
						return isTopLevel ? null : current.parent;
					} else if (i === (siblings.length-1) && forward) {
						return isTopLevel ? null : this._findSibling(current.parent, forward);
					} else {
						return forward ? siblings[i+1] : siblings[i-1];
					}
				}
			}
			return null;
		},
		
		_inParentChain: function(model, compareTo){
			var parent = model.parent;
			while(parent){
				if(parent === compareTo){
					return true;
				}
				parent = parent.parent;
			}
			return false;
		},
		
		_getTopLevelParent: function(model){
			if(this.topLevel(model)){
				return model;
			}
			var parent = model.parent;
			while(parent){
				if(this.topLevel(parent)){
					return parent;
				}
				parent = parent.parent;
			}
			return null;
		},
		
		_onCollapse: function(model){
			if(this._expanded(model.parent)){
				return model;
			}
			return this._onCollapse(model.parent);
		},
		
		_scan: function(forward, from, to){
			this.setCursor(from);
			var selection = [];
			selection.push(from);
			while(true){
				if(this.iterate(forward)){
					selection.push(this.cursor());
				} else {
					break;
				}
				if(to === this.cursor()){
					return selection;
				}
			}
			selection = [];
			return null;
		},
		
		/**
		 * Set the cursor to the given model
		 * @param {Object} the given model
		 */
		setCursor: function(modelItem) {
			this._prevCursor = this._cursor;
			this._cursor = modelItem;
		},
		
		/**
		 * Set the the first level children
		 * @param {list} the first level children
		 */
		setTree: function(firstLevelChildren) {
			this.firstLevelChildren = firstLevelChildren;
			if(this.firstLevelChildren.length > 0){
				this.root = this.firstLevelChildren[0].parent;
			}
		},
		
		/**
		 * Iterate from the current cursor
		 * @param {object} from the model object that the selection range starts from. Will be included in the return array.
		 * @param {object} to the model object that the selection range ends at. Will be included in the return array.
		 * @returns {Array} The selection of models in the array.
		 */
		scan: function(from, to) {
			var currentCursor = this.cursor();
			var selection = this._scan(true, from, to);
			if(!selection){
				selection = this._scan(false, from, to);
			}
			this.setCursor(currentCursor);
			return selection;
		},
		
		/**
		 * scan a selection range 
		 * @param {boolean} forward the iteration direction. If true then iterate to next, otherwise previous.
		 * @param {boolean} forceExpand optional. the flag for the current cursor to dive into its children. 
		 *                  If the cursor has no children yet or its children are not expanded, this method will call forceExpandFunc.
		 *                  If there is no forceExpandFunc defined it will not expand.
		 */
		iterate: function(forward, forceExpand) {
			return forward ? this._forward(forceExpand) : this._backward(forceExpand);
		},
		
		/**
		 * Iterate from the current cursor only on the top level children
		 * @param {boolean} forward the iteration direction. If true then iterate to next, otherwise previous.
		 * @param {boolean} roundTrip the round trip flag. If true then iterate to the beginning at bottom or end at beginning.
		 */
		iterateOnTop: function(forward, roundTrip) {
			var topSibling = this._findSibling(this._getTopLevelParent(this.cursor()), forward);
			if(topSibling){
				this.setCursor(topSibling);
			} else if(roundTrip && this.firstLevelChildren.length > 0) {
				this.setCursor(forward ? this.firstLevelChildren[0] : this.firstLevelChildren[this.firstLevelChildren.length - 1]);
			}
		},
		
		/**
		 * When the parent model containing the cursor is collapsed, the cursor has to be surfaced to the parent
		 */
		collapse: function(collapsedModel) {
			if(!this._cursor){
				return null;
			}
			if(this._inParentChain(this._cursor, collapsedModel)){
				this.setCursor(collapsedModel);
				return this._cursor;
			}
			return null;
		},
		
		/**
		 * Reset cursor and previous cursor
		 */
		reset: function(){
			this._cursor = null;
			this._prevCursor = null;
			this.root = null;
			//By default the cursor is pointed to the first child 
			if(this.firstLevelChildren.length > 0){
				this._cursor = this.firstLevelChildren[0];
				this.root = this.firstLevelChildren[0].parent;
			}
		},
		
		/**
		 * Convenient method to see if last iterate action moved the cursor
		 */
		cursorMoved: function(){
			return this._cursor !== this._prevCursor;
		},
		
		/**
		 * Get current selected model by the iteration
		 */
		cursor: function(){
			return this._cursor;
		},
		
		/**
		 * Get previously selected model by the iteration
		 */
		prevCursor: function(){
			return this._prevCursor;
		}
	};
	return TreeModelIterator;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/uiUtils',[
	'i18n!orion/nls/messages',
	'orion/webui/littlelib'
], function(messages, lib) {
	/**
	 * This class contains static utility methods. It is not intended to be instantiated.
	 * @class This class contains static utility methods.
	 * @name orion.uiUtils
	 */

	var isMac = navigator.platform.indexOf("Mac") !== -1; //$NON-NLS-0$

	// Maps keyCode to display symbol
	var keySymbols = Object.create(null);
	keySymbols[lib.KEY.DOWN]  = "\u2193"; //$NON-NLS-0$
	keySymbols[lib.KEY.UP]    = "\u2191"; //$NON-NLS-0$
	keySymbols[lib.KEY.RIGHT] = "\u2192"; //$NON-NLS-0$
	keySymbols[lib.KEY.LEFT]  = "\u2190"; //$NON-NLS-0$
	if (isMac) {
		keySymbols[lib.KEY.BKSPC]    = "\u232b"; //$NON-NLS-0$
		keySymbols[lib.KEY.DEL]      = "\u2326"; //$NON-NLS-0$
		keySymbols[lib.KEY.END]      = "\u21f2"; //$NON-NLS-0$
		keySymbols[lib.KEY.ENTER]    = "\u23ce"; //$NON-NLS-0$
		keySymbols[lib.KEY.ESCAPE]   = "\u238b"; //$NON-NLS-0$
		keySymbols[lib.KEY.HOME]     = "\u21f1"; //$NON-NLS-0$
		keySymbols[lib.KEY.PAGEDOWN] = "\u21df"; //$NON-NLS-0$
		keySymbols[lib.KEY.PAGEUP]   = "\u21de"; //$NON-NLS-0$
		keySymbols[lib.KEY.SPACE]    = "\u2423"; //$NON-NLS-0$
		keySymbols[lib.KEY.TAB]      = "\u21e5"; //$NON-NLS-0$
	}

	function getUserKeyStrokeString(binding) {
		var userString = "";

		if (isMac) {
			if (binding.mod4) {
				userString+= "\u2303"; //Ctrl //$NON-NLS-0$
			}
			if (binding.mod3) {
				userString+= "\u2325"; //Alt //$NON-NLS-0$
			}
			if (binding.mod2) {
				userString+= "\u21e7"; //Shift //$NON-NLS-0$
			}
			if (binding.mod1) {
				userString+= "\u2318"; //Command //$NON-NLS-0$
			}
		} else {
			var PLUS = "+"; //$NON-NLS-0$;
			if (binding.mod1)
				userString += messages.KeyCTRL + PLUS;
			if (binding.mod2)
				userString += messages.KeySHIFT + PLUS;
			if (binding.mod3)
				userString += messages.KeyALT + PLUS;
		}
		
		if (binding.alphaKey) {
			return userString+binding.alphaKey;
		}
		if (binding.type === "keypress") {
			return userString+binding.keyCode; 
		}

		// Check if it has a special symbol defined
		var keyCode = binding.keyCode;
		var symbol = keySymbols[keyCode];
		if (symbol) {
			return userString + symbol;
		}

		// Check if it's a known named key from lib.KEY
		var keyName = lib.keyName(keyCode);
		if (keyName) {
			// Some key names are translated, so check for that.
			keyName = messages["Key" + keyName] || keyName; //$NON-NLS-0$
			return userString + keyName;
		}

		var character;
		switch (binding.keyCode) {
			case 59:
				character = binding.mod2 ? ":" : ";"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 61:
				character = binding.mod2 ? "+" : "="; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 188:
				character = binding.mod2 ? "<" : ","; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 190:
				character = binding.mod2 ? ">" : "."; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 191:
				character = binding.mod2 ? "?" : "/"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 192:
				character = binding.mod2 ? "~" : "`"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 219:
				character = binding.mod2 ? "{" : "["; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 220:
				character = binding.mod2 ? "|" : "\\"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 221:
				character = binding.mod2 ? "}" : "]"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			case 222:
				character = binding.mod2 ? '"' : "'"; //$NON-NLS-1$ //$NON-NLS-0$
				break;
			}
		if (character) {
			return userString+character;
		}
		if (binding.keyCode >= 112 && binding.keyCode <= 123) {
			return userString+"F"+ (binding.keyCode - 111); //$NON-NLS-0$
		}
		return userString+String.fromCharCode(binding.keyCode);
	}

	function getUserKeyString(binding) {
		var result = "";
		var keys = binding.getKeys();
		for (var i = 0; i < keys.length; i++) {
			if (i !== 0) {
				result += " "; //$NON-NLS-0$
			}
			result += getUserKeyStrokeString(keys[i]);
		}
		return result;
	}

	/**
	 * @name orion.uiUtils.getUserText
	 * @function
	 * @param {Object} options The options object
	 * @param {String} options.id
	 * @param {Element} options.refNode
	 * @param {Boolean} options.hideRefNode
	 * @param {String} options.initialText
	 * @param {Function} options.onComplete
	 * @param {Function} options.onEditDestroy
	 * @param {String} options.selectTo
	 * @param {Boolean} options.isInitialValid
	 * @param {Boolean} options.insertAsChild
	 */
	function getUserText(options) {
		var id = options.id;
		var refNode = options.refNode;
		var hideRefNode = options.hideRefNode;
		var initialText = options.initialText;
		var onComplete = options.onComplete;
		var onEditDestroy = options.onEditDestroy;
		var selectTo = options.selectTo;
		var isInitialValid = options.isInitialValid;
		var insertAsChild = options.insertAsChild;
		
		var done = false;
		var handler = function(isKeyEvent) {
			return function(event) {
				if (done) {
					return;
				}
				var editBox = lib.node(id),
					newValue = editBox.value;
				if (!editBox) {
					return;
				}
				if (isKeyEvent && event.keyCode === lib.KEY.ESCAPE) {
					if (hideRefNode) {
						refNode.style.display = "inline"; //$NON-NLS-0$
					}
					done = true;
					editBox.parentNode.removeChild(editBox);
					if (onEditDestroy) {
						onEditDestroy();
					}
					return;
				}
				if (isKeyEvent && event.keyCode !== lib.KEY.ENTER) {
					return;
				} else if (newValue.length === 0 || (!isInitialValid && newValue === initialText)) {
					if (hideRefNode) {
						refNode.style.display = "inline"; //$NON-NLS-0$
					}
					done = true;
				} else {
					onComplete(newValue);
					if (hideRefNode && refNode.parentNode) {
						refNode.style.display = "inline"; //$NON-NLS-0$
					}
					done = true;
				}
				// some clients remove temporary dom structures in the onComplete processing, so check that we are still in DOM
				if (editBox.parentNode) {
					editBox.parentNode.removeChild(editBox);
				}
				if (onEditDestroy) {
					onEditDestroy();
				}
			};
		};
	
		// Swap in an editable text field
		var editBox = document.createElement("input"); //$NON-NLS-0$
		editBox.id = id;
		editBox.value = initialText || "";
		if (insertAsChild) {
			refNode.appendChild(editBox);
		} else {
			refNode.parentNode.insertBefore(editBox, refNode.nextSibling);
		}
		editBox.classList.add("userEditBoxPrompt"); //$NON-NLS-0$
		if (hideRefNode) {
			refNode.style.display = "none"; //$NON-NLS-0$
		}				
		editBox.addEventListener("keydown", handler(true), false); //$NON-NLS-0$
		editBox.addEventListener("blur", handler(false), false); //$NON-NLS-0$
		window.setTimeout(function() { 
			editBox.focus(); 
			if (initialText) {
				var box = lib.node(id);
				var end = selectTo ? initialText.indexOf(selectTo) : -1;
				if (end > 0) {
					if(box.createTextRange) {
						var range = box.createTextRange();
						range.collapse(true);
						range.moveStart("character", 0); //$NON-NLS-0$
						range.moveEnd("character", end); //$NON-NLS-0$
						range.select();
					} else if(box.setSelectionRange) {
						box.setSelectionRange(0, end);
					} else if(box.selectionStart !== undefined) {
						box.selectionStart = 0;
						box.selectionEnd = end;
					}
				} else {
					box.select();
				}
			}
		}, 0);
	}
	
	/**
	 * Returns whether the given event should cause a reference
	 * to open in a new window or not.
	 * @param {Object} event The key event
	 * @name orion.util#openInNewWindow
	 * @function
	 */
	function openInNewWindow(event) {
		var isMac = window.navigator.platform.indexOf("Mac") !== -1; //$NON-NLS-0$
		return (isMac && event.metaKey) || (!isMac && event.ctrlKey);
	}
	
	/**
	 * Opens a link in response to some event. Whether the link
	 * is opened in the same window or a new window depends on the event
	 * @param {String} href The link location
	 * @name orion.util#followLink
	 * @function
	 */
	function followLink(href, event) {
		if (event && openInNewWindow(event)) {
			window.open(href);
		} else {
			window.location = href;
		}
	}
	
	function createButton(text, callback) {
		var button = document.createElement("button"); //$NON-NLS-0$
		button.className = "orionButton commandButton commandMargins"; //$NON-NLS-0$
		button.addEventListener("click", function(e) { //$NON-NLS-0$
			callback();
			lib.stop(e);
		}, false);
		if (text) {
			button.appendChild(document.createTextNode(text));
		}
		return button;	
	}
	
	function createDropdownButton(parent, name, populateFunction) {
	}

	/**
	 * Returns whether <code>element</code> or its parent is an HTML5 form element.
	 * @param {Element} element
	 * @param {Element} parentLimit
	 * @function
	 * @returns {Boolean}
	 */
	function isFormElement(element, parentLimit) {
		if (!element || !element.tagName) return false;
		switch (element.tagName.toLowerCase()) {
			case "button": //$NON-NLS-0$
			case "fieldset": //$NON-NLS-0$
			case "form": //$NON-NLS-0$
			case "input": //$NON-NLS-0$
			case "keygen": //$NON-NLS-0$
			case "label": //$NON-NLS-0$
			case "legend": //$NON-NLS-0$
			case "meter": //$NON-NLS-0$
			case "optgroup": //$NON-NLS-0$
			case "output": //$NON-NLS-0$
			case "progress": //$NON-NLS-0$
			case "select": //$NON-NLS-0$
			case "textarea": //$NON-NLS-0$
				return true;
		}
		if (element.parentNode === parentLimit) return false;
		return element.parentNode && isFormElement(element.parentNode, parentLimit);
	}

	/**
	 * Returns the folder name from path.
	 * @param {String} filePath
	 * @param {String} fileName
	 * @param {Boolean} keepTailSlash
	 * @returns {String}
	 */
	function path2FolderName(filePath, fileName, keepTailSlash){
		var tail = keepTailSlash ? 0: 1;
		return filePath.substring(0, filePath.length - encodeURIComponent(fileName).length - tail);
	}
	
	//return module exports
	return {
		getUserKeyString: getUserKeyString,
		getUserText: getUserText,
		openInNewWindow: openInNewWindow,
		followLink: followLink,
		createButton: createButton,
		createDropdownButton: createDropdownButton,
		isFormElement: isFormElement,
		path2FolderName: path2FolderName
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/explorers/explorerNavHandler',[
	'orion/webui/littlelib',
	'orion/treeModelIterator',
	'orion/uiUtils'
], function(lib, mTreeModelIterator, UiUtils){

var exports = {};
var userAgent = navigator.userAgent;
var isPad = userAgent.indexOf("iPad") !== -1; //$NON-NLS-0$
var isMac = window.navigator.platform.indexOf("Mac") !== -1; //$NON-NLS-0$

exports.ExplorerNavHandler = (function() {

	/**
	 * Creates a new tree iteration handler
	 * 
	 * @name orion.explorerNavHandler.ExplorerNavHandler
	 * @class A tree iteration handler based on an explorer.
	 * @param {Object} explorer The {@link orion.explorer.Explorer} instance.
	 * @param {Object} options The options object which provides iterate patterns and all call back functions when iteration happens.
	 * @param {String} [options.gridClickSelectionPolicy="none"] Controls how clicking on a grid model item -- for example, a link or a button -- affects
	 * the selection (or how it affects the cursor, if the <code>selectionPolicy</code> is <code>"cursorOnly"</code>). Allowed values are:
	 * <ul>
	 * <li><code>"none"</code>: Clicking on a grid item will not change the selection (or cursor). This is the default.</li>
	 * <li><code>"active"</code>: Clicking on a grid item will change the selection (or cursor).</li>
	 * </ul>
	 * @param {String} [options.selectionPolicy=null] Selection policy for this explorer. Allowed values are:
	 * <ul>
	 * <li><code>"cursorOnly"</code>: No selection of model items is allowed.</li>
	 * <li><code>"singleSelection"</code>: Up to 1 model item can be selected.</li>
	 * <li><code>"readonlySelection"</code>: Selection cannot be changed while this selection policy is set.</li>
	 * <li><code>null</code>: Zero or more model items can be selected. This is the default.</li>
	 * </ul>
	 * @param {Function} [options.postDefaultFunc] If this function provides addtional behaviors after the default behavior. Some explorers may want to do something else when the cursor is changed, etc.
	 * @param {Function} [options.preventDefaultFunc] If this function returns true then the default behavior of all key press will stop at this time.
	 * The key event is passed to preventDefaultFunc. It can implement its own behavior based on the key event.
	 */
	function ExplorerNavHandler(explorer, navDict, options) {
		this.explorer = explorer;
		this.model = this.explorer.model;
		this._navDict = navDict;
		
	    this._listeners = [];
	    this._selections = [];
	    
	    this._currentColumn = 0;
	    var parentDiv = this._getEventListeningDiv();
	    parentDiv.tabIndex = 0;
		parentDiv.classList.add("selectionModelContainer"); //$NON-NLS-0$
		var self = this;
		this._modelIterator = new mTreeModelIterator.TreeModelIterator([], {
			isExpanded: this.isExpanded.bind(this),		
			getChildrenFunc: options.getChildrenFunc,
			isExpandable: this.explorer.renderer.isExpandable ? 
				function(model) { return self.explorer.renderer.isExpandable(model); } : 
				function(model) { return self.isExpandable(model); },
			forceExpandFunc: this.explorer.forceExpandFunc ? 
				function(modelToExpand, childPosition, callback) {
					return self.explorer.forceExpandFunc(modelToExpand, childPosition, callback);
				} : undefined
		});
		this._init(options);
		
	    if(!options || options.setFocus !== false){
			parentDiv.focus();
	    }
	    var keyListener = function (e) { 
			if(UiUtils.isFormElement(e.target)) {
				// Not for us
				return true;
			}
			if(self.explorer.preventDefaultFunc && self.explorer.preventDefaultFunc(e, self._modelIterator.cursor())){
				return true;
			}
			if(e.keyCode === lib.KEY.DOWN) {
				return self.onDownArrow(e);
			} else if(e.keyCode === lib.KEY.UP) {
				return self.onUpArrow(e);
			} else if(e.keyCode === lib.KEY.RIGHT) {
				return self.onRightArrow(e);
			} else if(e.keyCode === lib.KEY.LEFT) {
				return self.onLeftArrow(e);
			} else if(e.keyCode === lib.KEY.SPACE) {
				return self.onSpace(e);
			} else if(e.keyCode === lib.KEY.ENTER) {
				return self.onEnter(e);
			}
		};
		parentDiv.addEventListener("keydown", keyListener, false); //$NON-NLS-0$
		this._listeners.push({type: "keydown", listener: keyListener}); //$NON-NLS-0$
		var mouseListener = function (e) {
			if(UiUtils.isFormElement(e.target)) {
				// Not for us
				return true;
			}
			if (e.shiftKey && self._shiftSelectionAnchor) {
				lib.stop(e);
			}
		};
		parentDiv.addEventListener("mousedown", mouseListener, false); //$NON-NLS-0$
		this._listeners.push({type: "mousedown", listener: mouseListener}); //$NON-NLS-0$
		var l1 = function (e) { 
			if(self.explorer.onFocus){
				self.explorer.onFocus(false);
			} else {
				self.toggleCursor(null, false);
			}
		};
		parentDiv.addEventListener("blur", l1, false); //$NON-NLS-0$
		this._listeners.push({type: "blur", listener: l1}); //$NON-NLS-0$
		var l2 = function (e) { 
			if(self.explorer.onFocus){
				self.explorer.onFocus(true);
			} else {
				self.toggleCursor(null, true);
			}
		};
		parentDiv.addEventListener("focus", l2, false); //$NON-NLS-0$
		this._listeners.push({type: "focus", listener: l2}); //$NON-NLS-0$
		this._parentDiv = parentDiv;
	}
	
	ExplorerNavHandler.prototype = /** @lends orion.explorerNavHandler.ExplorerNavHandler.prototype */ {
		
		destroy: function() {
			this._parentDiv.classList.remove("selectionModelContainer"); //$NON-NLS-0$
			this.removeListeners();	
		},
		
		_init: function(options){
			this._linearGridMove = false;//temporary. If true right key on the last grid will go to first grid of next row
			                            // Left key on the first grid will go to the last line grid of the previous line
			if(!options){
				return;
			}
			this._selectionPolicy = options.selectionPolicy;
			this.gridClickSelectionPolicy = options.gridClickSelectionPolicy || "none"; //$NON-NLS-0$
			this.preventDefaultFunc = options.preventDefaultFunc;
			this.postDefaultFunc = options.postDefaultFunc;
		},
		
		_ctrlKeyOn: function(e){
			return isMac ? e.metaKey : e.ctrlKey;
		},
		
		removeListeners: function(){
			if(this._listeners){
				for (var i=0; i < this._listeners.length; i++) {
					this._parentDiv.removeEventListener(this._listeners[i].type, this._listeners[i].listener, false);
				}
			}
		},
		
		focus: function(){
		    var parentDiv = this._getEventListeningDiv();
		    if(parentDiv){
				parentDiv.focus();
		    }
		},
		
		_getEventListeningDiv: function(secondLevel){
			if(this.explorer.keyEventListeningDiv && typeof this.explorer.keyEventListeningDiv === "function"){ //$NON-NLS-0$
				return this.explorer.keyEventListeningDiv(secondLevel);
			}
			return lib.node(this.explorer._parentId);
		},
		
		isExpandable: function(model){
			if(!model){
				return false;
			}
			var expandImage = lib.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(model)));
			return expandImage ? true: false;
		},
		
		isExpanded: function(model){
			if(!model){
				return false;
			}
			return this.explorer.myTree.isExpanded(this.model.getId(model));
		},
		
		refreshSelection: function(noScroll, visually){
			var that = this;
			if(this.explorer.selection){
				this.explorer.selection.getSelections(function(selections) {
					that._clearSelection(visually);
					for (var i = 0; i < selections.length; i++){
						that._selections.push(selections[i]);
					}
					if(that._selections.length > 0){
						that.cursorOn(that._selections[0], true, false, noScroll);
					} else {//If there is no selection, we should just the first item as the cursored items.  
						that.cursorOn(null, false, false, noScroll);
					}
					//If shift selection anchor exists and in the refreshed selection range, we just keep it otherwise clear the anchor
					//See https://bugs.eclipse.org/bugs/show_bug.cgi?id=419170
					if(!(that._shiftSelectionAnchor && that._inSelection(that._shiftSelectionAnchor) >= 0)){
						that._shiftSelectionAnchor = null;
					}
				});
			}
		},
		
		refreshModel: function(navDict, model, topIterationNodes, noReset){
		    this._currentColumn = 0;
			this.topIterationNodes = [];
			this.model = model;
			this._navDict = navDict;
			if(this.model.getTopIterationNodes){
				this.topIterationNodes = this.model.getTopIterationNodes();
			} else if(topIterationNodes){
				this.topIterationNodes = topIterationNodes;
			}
			this._modelIterator.setTree(this.topIterationNodes);
			if(!noReset && this.explorer.selection){
				//refresh the current cursor visual, otherwise the next cursorOn() call will not remove the previoous cursor visual properly.
				this.toggleCursor(this._modelIterator.cursor(), false);
				this._modelIterator.reset();
			}
			this.refreshSelection(true);
		},
		
		getTopLevelNodes: function(){
			return this._modelIterator.firstLevelChildren;
		},
		
		_inSelection: function(model){
			var modelId = this.model.getId(model);
			for(var i = 0; i < this._selections.length; i++){
				if(modelId === this.model.getId(this._selections[i])){
					return i;
				}
			}
			return -1;
		},
		
		
		_clearSelection: function(visually){
			if(visually){
				for(var i = 0; i < this._selections.length; i++){
					this._checkRow(this._selections[i], true);
				}
			}
			this._selections = [];
		},
		
		getSelectionPolicy: function() {
			return this._selectionPolicy;
		},
		
		setSelectionPolicy: function(policy) {
			if (this._selectionPolicy === policy) {
				return;
			}
			if(this._selectionPolicy === "readonlySelection" || policy === "readonlySelection"){
				this._toggleSelectionClass("disabledRow", policy==="readonlySelection");
			}
			this._selectionPolicy = policy;
			if(this._selectionPolicy === "cursorOnly"){ //$NON-NLS-0$
				this._clearSelection(true);
			}
		},
		
		setSelection: function(model, toggling, shiftSelectionAnchor){
			if(this._selectionPolicy === "readonlySelection"){
				return false;
			}
			if(this._selectionPolicy === "cursorOnly"){ //$NON-NLS-0$
				if(toggling && this.explorer.renderer._useCheckboxSelection){
					this._checkRow(model,true);
				}
				return false;
			}
			if(!this._isRowSelectable(model)){
				return false;
			}
			if(!toggling || this._selectionPolicy === "singleSelection"){//$NON-NLS-0$
				this._clearSelection(true);
				this._checkRow(model,false);		
				this._selections.push(model);
				this._lastSelection = model;
			} else{
				var index = this._inSelection(model);
				if(index >= 0){
					this._checkRow(model, true);
					this._selections.splice(index, 1);
				} else {
					this._checkRow(model,false);		
					this._selections.push(model);
					this._lastSelection = model;
				}
			}
			if(shiftSelectionAnchor){
				this._shiftSelectionAnchor = this._lastSelection;
			}
			if (this.explorer.selection) {
				this.explorer.renderer.storeSelections();
				this.explorer.selection.setSelections(this._selections);		
			}
			return true;
		},
		
		moveColumn: function(model, offset){
			if(!model){
				model = this.currentModel();
			}
			var gridChildren = this._getGridChildren(model);
			if((gridChildren && gridChildren.length > 1) || (offset === 0 && gridChildren)){
				if(offset !== 0){
					this.toggleCursor(model, false);
				}
				var column = this._currentColumn;
				var rowChanged= true;
				column = column + offset;
				if(column < 0){
					if(this._linearGridMove && offset !== 0){
						if(this._modelIterator.iterate(false)){
							model = this.currentModel();
						} else {
							rowChanged = false;
						}
					}
					column = rowChanged ? gridChildren.length - 1 : this._currentColumn;
				} else if(column >= gridChildren.length){
					if(this._linearGridMove && offset !== 0){
						if(this._modelIterator.iterate(true)){
							model = this.currentModel();
						} else {
							rowChanged = false;
						}
					}
					column = rowChanged ? 0 : this._currentColumn;
				}
				this._currentColumn = column;
				if(offset !== 0){
					this.toggleCursor(model, true);
				}
				return true;
			}
			return false;
		},
		
		_getGridChildren: function(model){
			if(this._navDict){
				return this._navDict.getGridNavHolder(model);
			}
			return null;
		},
		
		getCurrentGrid:  function(model){
			if(!model){
				model = this.currentModel();
			}
			var gridChildren = this._getGridChildren(model);
			if(gridChildren && gridChildren.length > 0){
				return gridChildren[this._currentColumn];
			}
			return null;
		},

		/**
		 * @returns {Element} The ancestor element of <code>node</code> that provides grid/tree/treegrid behavior,
		 * or <code>null</code> if no such node was found.
		 */
		getAriaContainerElement: function(node) {
			var stop = this._parentDiv, role;
			while (node && node !== stop &&
					(role = node.getAttribute("role")) !== "grid" && role !== "tree" && role !== "treegrid") {//$NON-NLS-3$//$NON-NLS-2$//$NON-NLS-1$//$NON-NLS-0$
				node = node.parentNode;
			}
			return node === stop ? null : node;
		},

		toggleCursor:  function(model, on){
			var currentRow = this.getRowDiv(model);
			var currentgrid = this.getCurrentGrid(model);
			if(currentgrid) {
				if(currentRow){
					if (on) {
						currentRow.classList.add("treeIterationCursorRow"); //$NON-NLS-0$
					} else {
						currentRow.classList.remove("treeIterationCursorRow"); //$NON-NLS-0$
					}
				}
				if(currentgrid.domNode){
					var ariaElement = this.getAriaContainerElement(currentgrid.domNode);
					if (on) {
						currentgrid.domNode.classList.add("treeIterationCursor"); //$NON-NLS-0$
						if (ariaElement) {
							var activeDescendantId = currentgrid.domNode.id;
							ariaElement.setAttribute("aria-activedescendant", activeDescendantId); //$NON-NLS-0$
						}
					} else {
						currentgrid.domNode.classList.remove("treeIterationCursor"); //$NON-NLS-0$
					}
				}
			} else {
				if(currentRow){
					if (on) {
						currentRow.classList.add("treeIterationCursorRow_Dotted"); //$NON-NLS-0$
					} else {
						currentRow.classList.remove("treeIterationCursorRow_Dotted"); //$NON-NLS-0$
					}
				}
			}
		},
		
		currentModel: function(){
			return this._modelIterator.cursor();
		},
		
		cursorOn: function(model, force, next, noScroll){
			var previousModel, currentModel;
			if(model || force){
				if(currentModel === this._modelIterator.cursor()){
					return;
				}
				previousModel = this._modelIterator.cursor();
				currentModel = model;
				this._modelIterator.setCursor(currentModel);
			} else {
				previousModel = this._modelIterator.prevCursor();
				currentModel = this._modelIterator.cursor();
			}
			if(previousModel === currentModel && !force){
				return;
			}
			this.toggleCursor(previousModel, false);
			if(force && !currentModel){
				return;
			}
			this.moveColumn(null, 0);
			this.toggleCursor(currentModel, true);
			var currentRowDiv = this.getRowDiv();
			if(currentRowDiv && !noScroll) {
				var offsetParent = lib.getOffsetParent(currentRowDiv);
				if (offsetParent) {
					var visible = true;
					if(currentRowDiv.offsetTop <= offsetParent.scrollTop){
						visible = false;
						if(next === undefined){
							next = false;
						}
					}else if((currentRowDiv.offsetTop + currentRowDiv.offsetHeight) >= (offsetParent.scrollTop + offsetParent.clientHeight)){
						visible = false;
						if(next === undefined){
							next = true;
						}
					}
					if(!visible){
						currentRowDiv.scrollIntoView(!next);
					}
				}
			}
			if(this.explorer.onCursorChanged){
				this.explorer.onCursorChanged(previousModel, currentModel);
			}
		},
		
		getSelection: function(){
			return this._selections;
		},
		
		getSelectionIds: function(){
			var ids = [];
			for (var i = 0; i < this._selections.length; i++) {
				ids.push(this.model.getId(this._selections[i]));
			}
			return ids;
		},
		
		getRowDiv: function(model){
			var rowModel = model ? model: this._modelIterator.cursor();
			if(!rowModel){
				return null;
			}
			var modelId = this.model.getId(rowModel);
			var value = this._navDict.getValue(modelId);
			return value && value.rowDomNode ? value.rowDomNode :  lib.node(modelId);
		},
		
		iterate: function(forward, forceExpand, selecting, selectableOnly /* optional */)	{
			var currentItem = null;
			
			if(!this.topIterationNodes || this.topIterationNodes.length === 0){
				return;
			}
				
			if (selectableOnly) {
				var previousItem = this.currentModel();
				
				currentItem = this._modelIterator.iterate(forward, forceExpand);
				if(currentItem){
					this._setCursorOnItem(forward, selecting);
				}
				
				while (currentItem && currentItem.isNotSelectable) {
					currentItem = this._modelIterator.iterate(forward, forceExpand);
					if(currentItem){
						this._setCursorOnItem(forward, selecting);
					}
				}
				
				if (!currentItem) {
					// got to the end of the list and didn't find anything selectable, iterate back
					this.cursorOn(previousItem, true, false, true);
					this._setCursorOnItem(forward, selecting);
				}
			} else {
				currentItem = this._modelIterator.iterate(forward, forceExpand);
				if(currentItem){
					this._setCursorOnItem(forward, selecting);
				}
			}
		},
		
		_toggleSelectionClass: function(className, on){
			this._selections.forEach(function(selection){
				var selectedDiv = this.getRowDiv(selection);
				if(!selectedDiv){
					return;
				}
				if(on){
					selectedDiv.classList.add(className);
				} else {
					selectedDiv.classList.remove(className);
				}
			}.bind(this));
		},
		
		_setCursorOnItem: function(forward, selecting) {
			this.cursorOn(null, false, forward);
			if(selecting){
				var previousModelInSelection = this._inSelection(this._modelIterator.prevCursor());
				var currentModelInselection = this._inSelection(this._modelIterator.cursor());
				if(previousModelInSelection >= 0 && currentModelInselection >= 0) {
					this.setSelection(this._modelIterator.prevCursor(), true);
				} else {
					this.setSelection(this.currentModel(), true);
				}
			}
		},
		
		_checkRow: function(model, toggle) {
			if(this.explorer.renderer._useCheckboxSelection && this._selectionPolicy !== "singleSelection"){
				var tableRow = this.getRowDiv(model);
				if(!tableRow){
					return;
				}
				var checkBox  = lib.node(this.explorer.renderer.getCheckBoxId(tableRow.id));
				var checked = toggle ? !checkBox.checked : true;
				if(checked !== checkBox.checked){
					this.explorer.renderer.onCheck(tableRow, checkBox, checked, true);
				}
			} else {
				this._select(model, toggle);
			}
		},
		
		_select: function(model, toggling){
			if(!model){
				model = this._modelIterator.cursor();
			}
			var rowDiv = this.getRowDiv(model);
			if(rowDiv){
				if (this._inSelection(model) < 0) {
					rowDiv.classList.add("checkedRow"); //$NON-NLS-0$
				} else {
					rowDiv.classList.remove("checkedRow"); //$NON-NLS-0$
				}
			}
		},
		
		_onModelGrid: function(model, mouseEvt){
			var gridChildren = this._getGridChildren(model);
			if(gridChildren){
				for(var i = 0; i < gridChildren.length; i++){
					if(mouseEvt.target === gridChildren[i].domNode){
						return true;
					}
				}
			}
			return false;
		},
		
		onClick: function(model, mouseEvt)	{
			if(mouseEvt && UiUtils.isFormElement(mouseEvt.target)) {
				// Not for us
				return true;
			}
			if (this._selectionPolicy === "readonlySelection" || this.isDisabled(this.getRowDiv(model))) { //$NON-NLS-0$
				lib.stop(mouseEvt);
			} else {
				var twistieSpan = lib.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(model)));
				if(mouseEvt.target === twistieSpan){
					return;
				}
				if(this.gridClickSelectionPolicy === "none" && this._onModelGrid(model, mouseEvt)){ //$NON-NLS-0$
					return;
				}
				this.cursorOn(model, true, false, true);
				if(isPad){
					this.setSelection(model, true);
				} else if(this._ctrlKeyOn(mouseEvt)){
					this.setSelection(model, true, true);
				} else if(mouseEvt.shiftKey && this._shiftSelectionAnchor){
					var scannedSel = this._modelIterator.scan(this._shiftSelectionAnchor, model);
					if(scannedSel){
						this._clearSelection(true);
						for(var i = 0; i < scannedSel.length; i++){
							this.setSelection(scannedSel[i], true);
						}
					}
				} else {
					this.setSelection(model, false, true);
				}
			}
		},
		
		onCollapse: function(model)	{
			if(this._modelIterator.collapse(model)){
				this.cursorOn();
			}
		},
		
		//Up arrow key iterates the current row backward. If control key is on, browser's scroll up behavior takes over.
		//If shift key is on, it toggles the check box and iterates backward.
		onUpArrow: function(e) {
			this.iterate(false, false, e.shiftKey, true);
			if(!this._ctrlKeyOn(e) && !e.shiftKey){
				this.setSelection(this.currentModel(), false, true);
			}
			e.preventDefault();
			return false;
		},

		//Down arrow key iterates the current row forward. If control key is on, browser's scroll down behavior takes over.
		//If shift key is on, it toggles the check box and iterates forward.
		onDownArrow: function(e) {
			this.iterate(true, false, e.shiftKey, true);
			if(!this._ctrlKeyOn(e) && !e.shiftKey){
				this.setSelection(this.currentModel(), false, true);
			}
			e.preventDefault();
			return false;
		},

		_shouldMoveColumn: function(e){
			var model = this.currentModel();
			var gridChildren = this._getGridChildren(model);
			if(gridChildren && gridChildren.length > 1){
				if(this.isExpandable(model)){
					return this._ctrlKeyOn(e);
				}
				return true;
			} else {
				return false;
			}
		},
		
		//Left arrow key collapses the current row. If current row is not expandable(e.g. a file in file navigator), move the cursor to its parent row.
		//If current row is expandable and expanded, collapse it. Otherwise move the cursor to its parent row.
		onLeftArrow:  function(e) {
			if(this._shouldMoveColumn(e)){
				this.moveColumn(null, -1);
				e.preventDefault();
				return true;
			}
			var curModel = this._modelIterator.cursor();
			if(!curModel){
				return false;
			}
			if(this.isExpandable(curModel)){
				if(this.isExpanded(curModel)){
					this.explorer.myTree.collapse(curModel);
					e.preventDefault();
					return true;
				}
			}
			if(!this._modelIterator.topLevel(curModel)){
				this.cursorOn(curModel.parent);
				this.setSelection(curModel.parent, false, true);
			//The cursor is now on a top level item which is collapsed. We need to ask the explorer is it wants to scope up.	
			} else if (this.explorer.scopeUp && typeof this.explorer.scopeUp === "function"){ //$NON-NLS-0$
				this.explorer.scopeUp();
			}
		},
		
		//Right arrow key expands the current row if it is expandable and collapsed.
		onRightArrow: function(e) {
			if(this._shouldMoveColumn(e)){
				this.moveColumn(null, 1);
				e.preventDefault();
				return true;
			}
			var curModel = this._modelIterator.cursor();
			if(!curModel){
				return false;
			}
			if(this.isExpandable(curModel)){
				if(!this.isExpanded(curModel)){
					this.explorer.myTree.expand(curModel);
					if (this.explorer.postUserExpand) {
						this.explorer.postUserExpand(this.model.getId(curModel));
					}
					e.preventDefault();
					return false;
				}
			}
		},
		
		_isRowSelectable: function(model){
			return this.explorer.isRowSelectable ? this.explorer.isRowSelectable(model) : true;
		},

		//Space key toggles the check box on the current row if the renderer uses check box
		onSpace: function(e) {
			if(this.setSelection(this.currentModel(), true, true)) {
				e.preventDefault();
			}
		},
		
		//Enter key simulates a href call if the current row has an href link rendered. The render has to provide the getRowActionElement function that returns the href DIV.
		onEnter: function(e) {
			var currentGrid = this.getCurrentGrid(this._modelIterator.cursor());
			if(currentGrid){
				if(currentGrid.widget){
					if(typeof currentGrid.onClick === "function"){ //$NON-NLS-0$
						currentGrid.onClick();
					} else if(typeof currentGrid.widget.focus === "function"){ //$NON-NLS-0$
						currentGrid.widget.focus();
					}
				} else {
					var evt = document.createEvent("MouseEvents"); //$NON-NLS-0$
					evt.initMouseEvent("click", true, true, window, //$NON-NLS-0$
							0, 0, 0, 0, 0, this._ctrlKeyOn(e), false, false, false, 0, null);
					currentGrid.domNode.dispatchEvent(evt);
				}
				return;
			}
			
			var curModel = this._modelIterator.cursor();
			if(!curModel){
				return;
			}
			
			if(this.explorer.renderer.getRowActionElement){
				var div = this.explorer.renderer.getRowActionElement(this.model.getId(curModel));
				if(div.href){
					if(this._ctrlKeyOn(e)){
						window.open(div.href);
					} else {
						window.location.href = div.href;
					}
				}
			}
			if(this.explorer.renderer.performRowAction){
				this.explorer.renderer.performRowAction(e, curModel);
				e.preventDefault();
				return false;
			}
		},
		
		/**
		 * Sets the isNotSelectable attribute on the specified model.
		 * @param {Object} model
		 * @param {Boolean} isNotSelectable true makes the this.iterate() with selectableOnly specified skip the item
		 */
		setIsNotSelectable: function(model, isNotSelectable) {
			model.isNotSelectable = isNotSelectable;
		},
		
		/**
		 * Disables the specified model making it no longer respond 
		 * to user input such as mouse click or key presses. The
		 * CSS style of corresponding row node is also modified to
		 * reflect its disabled state.
		 * 
		 * @param {Object} model
		 */
		disableItem: function(model) {
			var rowDiv = this.getRowDiv(model);
			if (this.isExpandable(model) && this.isExpanded(model)) {
				this._modelIterator.collapse(model);
				this.explorer.myTree.toggle(rowDiv.id); // collapse tree visually
			}
			rowDiv.classList.remove("checkedRow"); //$NON-NLS-0$
			rowDiv.classList.add("disabledNavRow"); //$NON-NLS-0$
			this.setIsNotSelectable(model, true);
		},
		
		/**
		 * Checks if the specified html row node is disabled.
		 * @return true if the specified node's classList contains the 
		 * 			"disabledNavRow" class, false otherwise
		 */
		isDisabled: function(rowDiv) {
			return rowDiv.classList.contains("disabledNavRow"); //$NON-NLS-0$
		},
		
		/**
		 * Enables the specified model.
		 * 
		 * @param {Object} model
		 */
		enableItem: function(model) {
			var rowDiv = this.getRowDiv(model);
			if (rowDiv) {
				rowDiv.classList.remove("disabledNavRow"); //$NON-NLS-0$
				this.setIsNotSelectable(model, false);
			}
		},
	};
	return ExplorerNavHandler;
}());

exports.ExplorerNavDict = (function() {
	/**
	 * Creates a new explorer navigation dictionary. The key of the dictionary is the model id. The value is a wrapper object that holds .modelItem, .rowDomNode and .gridChildren properties.
	 * The .modelItem property helps quickly looking up a model object by a given id. The .rowDomNode also helps to find out the row DOM node instead of doing a query. 
	 * The .gridChildren is an array representing all the grid navigation information, which the caller has to fill the array out.
	 *
	 * @name orion.explorerNavHandler.ExplorerNavDict
	 * @class A explorer navigation dictionary.
	 * @param {Object} model The model object that represent the overall explorer.
	 */
	function ExplorerNavDict(model) {
		this._dict= {};
		this._model = model;
	}
	ExplorerNavDict.prototype = /** @lends orion.explorerNavHandler.ExplorerNavDict.prototype */ {
		
		/**
		 * Add a row to the dictionary.
		 * @param {Object} modelItem The model item object that represent a row.
		 * @param {domNode} rowDomNode optional The DOM node that represent a row. If 
		 */
		addRow: function(modelItem, rowDomNode){
			var modelId = this._model.getId(modelItem);
			this._dict[modelId] = {model: modelItem, rowDomNode: rowDomNode};
		},
			
		/**
		 * Get the value of a key by model id.
		 *  @param {String} id The model id.
		 * @returns {Object} The value of the id from the dictionary.
		 */
		getValue: function(id) {
			return this._dict[id];
		},
		
		/**
		 * Get the grid navigation holder from a row navigation model.
		 *  @param {Object} modelItem The model item object that represent a row.
		 * @returns {Array} The .gridChildren property of the value keyed by the model id.
		 */
		getGridNavHolder: function(modelItem, lazyCreate) {
			if(!modelItem){
				return null;
			}
			var modelId = this._model.getId(modelItem);
			if(this._dict[modelId]){
				if(!this._dict[modelId].gridChildren && lazyCreate){
					this._dict[modelId].gridChildren = [];
				}
				return this._dict[modelId].gridChildren;
			}
			return null;
		},
		
		/**
		 * Initialize the grid navigation holder to null.
		 *  @param {Object} modelItem The model item object that represent a row.
		 */
		initGridNavHolder: function(modelItem) {
			if(!modelItem){
				return null;
			}
			var modelId = this._model.getId(modelItem);
			if(this._dict[modelId]){
				this._dict[modelId].gridChildren = null;
			}
		}
	};
	return ExplorerNavDict;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/EventTarget',[],function() {
	/**
	 * Creates an Event Target
	 *
	 * @name orion.EventTarget
	 * @class Base for creating an Orion event target
	 */
	function EventTarget() {
		this._namedListeners = {};
	}

	EventTarget.prototype = /** @lends orion.EventTarget.prototype */
	{
		/**
		 * Dispatches a named event along with an arbitrary set of arguments. Any arguments after <code>eventName</code>
		 * will be passed to the event listener(s).
		 * @param {Object} event The event to dispatch. The event object MUST have a type field
		 * @returns {boolean} false if the event has been canceled and any associated default action should not be performed
		 * listeners (if any) have resolved.
		 */
		dispatchEvent: function(event) {
			if (!event.type) {
				throw new Error("unspecified type");
			}
			var listeners = this._namedListeners[event.type];
			if (listeners) {
				listeners.forEach(function(listener) {
					try {
						if (typeof listener === "function") {
							listener(event);
						} else {
							listener.handleEvent(event);
						}
					} catch (e) {
						if (typeof console !== 'undefined') {
							console.log(e); // for now, probably should dispatch an ("error", e)
						}
					}			
				});
			}
			return !event.defaultPrevented;
		},

		/**
		 * Adds an event listener for a named event
		 * @param {String} eventName The event name
		 * @param {Function} listener The function called when an event occurs
		 */
		addEventListener: function(eventName, listener) {
			if (typeof listener === "function" || listener.handleEvent) {
				this._namedListeners[eventName] = this._namedListeners[eventName] || [];
				this._namedListeners[eventName].push(listener);
			}
		},

		/**
		 * Removes an event listener for a named event
		 * @param {String} eventName The event name
		 * @param {Function} listener The function called when an event occurs
		 */
		removeEventListener: function(eventName, listener) {
			var listeners = this._namedListeners[eventName];
			if (listeners) {
				for (var i = 0; i < listeners.length; i++) {
					if (listeners[i] === listener) {
						if (listeners.length === 1) {
							delete this._namedListeners[eventName];
						} else {
							listeners.splice(i, 1);
						}
						break;
					}
				}
			}
		}
	};
	EventTarget.prototype.constructor = EventTarget;
	
	EventTarget.attach = function(obj) {
		var eventTarget = new EventTarget();
		obj.dispatchEvent = eventTarget.dispatchEvent.bind(eventTarget);
		obj.addEventListener = eventTarget.addEventListener.bind(eventTarget);
		obj.removeEventListener = eventTarget.removeEventListener.bind(eventTarget);
	};
	
	return EventTarget;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/dropdown',['orion/webui/littlelib', 'orion/EventTarget'], function(lib, EventTarget) {

	/**
	 * Attaches dropdown behavior to a given node.  Assumes the triggering node and dropdown node
	 * have the same parent.  Trigger should have "dropdownTrigger" class, and the dropdown node should 
	 * have "dropdownMenu" class.  Dropdown items should be <li> elements, so typically the dropdown node
	 * supplied is a <ul>.
	 *
	 * "dropdowntriggerbutton.html" contains an appropriate HTML fragment for a triggering button and associated
	 * dropdown.  Clients can add this fragment to the DOM and then attach Dropdown behavior to it.
	 * 
	 * Nested ("sub") menu behavior is accomplished by adding the class "dropdownSubMenu" to one of the <li> items.
	 * This item can then parent another trigger and <ul>.
	 *
	 * "submenutriggerbutton.html" contains an appropriate HTML fragment for a menu item that triggers a sub menu.
	 * Clients can add this fragment to a dropdown menu and then attach Dropdown behavior to the sub menu item.
	 *
	 * The items inside each <li> item in a dropdown can be almost any type of node.  The class "dropdownMenuItem" is
	 * used on the node inside the li to find items and style them appropriately.  There are HTML fragments for some
	 * common menu types.  For example, "checkedmenuitem.html" is a fragment appropriate for checked menu items.
	 *
	 * @param {Object} options The options object, which must minimally specify the dropdown dom node
	 * @param options.dropdown The node for the dropdown presentation.  Required.
	 * @param options.populate A function that should be called to populate the dropdown before it
	 * opens each time.  Optional.
	 * @param options.triggerNode The node which will listen for events that trigger the 
	 * opening of this drop down. If it is not specified the parent of the dropdown node will be searched
	 * for a node containing the dropdownTrigger class. Optional.
	 * @param options.parentDropdown The Dropdown that is the parent of this one if this is a sub-dropdown. Optional.
	 * @param options.positioningNode The Node that the dropdown uses so that it always renders under the positioningNode's left bottom corner. Optional.
	 * @param options.skipTriggerEventListeners A boolean indicating whether or not to skip adding event
	 * listeners to the triggerNode. Optional.
	 * 
	 * @name orion.webui.dropdown.Dropdown
	 *
	 */
	function Dropdown(options) {
		EventTarget.attach(this);
		this._init(options);		
	}
	Dropdown.prototype = /** @lends orion.webui.dropdown.Dropdown.prototype */ {
			
		_init: function(options) {
			this._dropdownNode = lib.node(options.dropdown);
			if (!this._dropdownNode) { throw "no dom node for dropdown found"; } //$NON-NLS-0$
			this._populate = options.populate;
			this._selectionClass = options.selectionClass;
			this._parentDropdown = options.parentDropdown;
			this._positioningNode = options.positioningNode;
			
			if (!this._parentDropdown) {
				//if a parentDropdown isn't specified move up in dom tree looking for one
				var parentNode = this._dropdownNode.parentNode;
				while(parentNode && (document !== parentNode)) {
					if (parentNode.classList && parentNode.classList.contains("dropdownMenu")) { //$NON-NLS-0$
						this._parentDropdown = parentNode.dropdown;
						break;
					}
					parentNode = parentNode.parentNode;
				}
			}
			
			this._dropdownNode.tabIndex = 0;

			if (options.triggerNode) {
				this._triggerNode = options.triggerNode;
			} else {
				this._triggerNode = lib.$(".dropdownTrigger", this._dropdownNode.parentNode); //$NON-NLS-0$	
			}
			if (!this._triggerNode) { throw "no dom node for dropdown trigger found"; } //$NON-NLS-0$
			
			var triggerClickHandler = function(event) {
				var actionTaken = false;
				
				if (this._triggerNode.classList.contains("dropdownMenuItem")) { //$NON-NLS-0$
					// if the trigger is a dropdownMenuItem we only want it to open the submenu
					actionTaken = this.open(event);
				} else {
					actionTaken = this.toggle(event);
				}
				
				if (actionTaken) {
					lib.stop(event);
				}
			}.bind(this);
			
			if (!options.skipTriggerEventListeners) {
				// click on trigger opens or toggles.
				this._triggerNode.addEventListener("click", triggerClickHandler, false); //$NON-NLS-0$

				// if trigger node is not key enabled...
				if (this._triggerNode.tagName.toLowerCase() === "span") { //$NON-NLS-0$
					this._triggerNode.addEventListener("keydown", function(event) { //$NON-NLS-0$
						if (event.keyCode === lib.KEY.ENTER || event.keyCode === lib.KEY.SPACE) {
							triggerClickHandler(event);
						}
					}.bind(this), false);
				}
			}
						
			// keys
			this._dropdownNode.addEventListener("keydown", this._dropdownKeyDown.bind(this), false); //$NON-NLS-0$
		},
		
		addTriggerNode: function(node){
			var self = this;
			node.addEventListener("click", function(event) { //$NON-NLS-0$
				if (self.toggle(event))  {
					lib.stop(event);
				}
			}, false);			
		},
		
		/**
		 * Toggle the open/closed state of the dropdown.  Return a boolean that indicates whether action was taken.
		 */			
		toggle: function(mouseEvent /* optional */) {
			if (this.isVisible()) {
				return this.close();
			} else {
				return this.open(mouseEvent);
			}
		},
		
		/**
		 * Answers whether the dropdown is visible.
		 */			
		isVisible: function() {
			return this._isVisible;
		},
		
		/**
		 * Open the dropdown.
		 */			
		open: function(mouseEvent /* optional */) {
			var actionTaken = false;
			if (!this.isVisible()) {
				this.dispatchEvent({type: "triggered", dropdown: this, event: mouseEvent}); //$NON-NLS-0$
				lib.setFramesEnabled(false);
				if (this._populate) {
					this.empty();
					this._populate(this._dropdownNode);
				}
				var items = this.getItems();
				if (items.length > 0) {
					if (this._boundAutoDismiss) {
						lib.removeAutoDismiss(this._boundAutoDismiss);
					} 
					this._boundAutoDismiss = this._autoDismiss.bind(this);

					// add auto dismiss.  Clicking anywhere but trigger or a submenu item means close.
					var submenuNodes = lib.$$array(".dropdownSubMenu", this._dropdownNode); //$NON-NLS-0$
					lib.addAutoDismiss([this._triggerNode].concat(submenuNodes), this._boundAutoDismiss);

					this._triggerNode.classList.add("dropdownTriggerOpen"); //$NON-NLS-0$
					if (this._selectionClass) {
						this._triggerNode.classList.add(this._selectionClass);
					}
					this._dropdownNode.classList.add("dropdownMenuOpen"); //$NON-NLS-0$
					this._isVisible = true;
					
					this._positionDropdown(mouseEvent);
					
					this._focusDropdownNode();
					actionTaken = true;
					
					if (this._parentDropdown) {
						this._parentDropdown.submenuOpen(this);
					}
				}
			}
			return actionTaken;
		},
		
		_focusDropdownNode :function() {//Sub classes can override this to set focus on different items.
			this._dropdownNode.focus();
		},
		
		_autoDismiss: function(event) {
			if (this.close(false)) {
				// only trigger dismissal of parent menus if
				// this dropdown's node contains the event.target
				if (this._dropdownNode.contains(event.target)) {
					// Dismiss parent menus
					var temp = this._parentDropdown;
					while (temp) {
						temp.close(false);
						temp = temp._parentDropdown;
					}
				}
			}
		},
		
		/**
		 * This method positions the dropdown menu.
		 * The specified mouseEvent is ignored. However, subclasses 
		 * can override this method if they wish to take the mouse 
		 * position contained in the mouse event into account.
		 * 
		 * @param {MouseEvent} mouseEvent
		 */
		_positionDropdown: function(mouseEvent) {//Sub classes can override this to position the drop down differently.
			this._dropdownNode.style.left = "";
			this._dropdownNode.style.top = "";
			
			if(this._positioningNode) {
				this._dropdownNode.style.left = this._positioningNode.offsetLeft + "px";
				return;
			}
			
			var bounds = lib.bounds(this._dropdownNode);
			var bodyBounds = lib.bounds(document.body);
			if (bounds.left + bounds.width > (bodyBounds.left + bodyBounds.width)) {
				if (this._triggerNode.classList.contains("dropdownMenuItem")) { //$NON-NLS-0$
					this._dropdownNode.style.left = -bounds.width + "px"; //$NON-NLS-0$
				} else {
					var totalBounds = lib.bounds(this._boundingNode(this._triggerNode));
					var triggerBounds = lib.bounds(this._triggerNode);
					this._dropdownNode.style.left = (triggerBounds.left  - totalBounds.left - bounds.width + triggerBounds.width) + "px"; //$NON-NLS-0$
				}
			}
			
			//ensure menu fits on page vertically
			var overflowY = (bounds.top + bounds.height) - (bodyBounds.top + bodyBounds.height);
			if (0 < overflowY) {
				this._dropdownNode.style.top = Math.floor(this._dropdownNode.style.top - overflowY) + "px"; //$NON-NLS-0$
			}
		},
		
		_boundingNode: function(node) {
			var style = window.getComputedStyle(node, null);
			if (style === null) {
				return node;
			}
			var position = style.getPropertyValue("position"); //$NON-NLS-0$
			if (position === "absolute" || !node.parentNode || node === document.body) { //$NON-NLS-0$
				return node;
			}
			return this._boundingNode(node.parentNode);
		},
		
		
		/**
		 * Close the dropdown.
		 */			
		close: function(restoreFocus) {
			var actionTaken = false;
			if (this.isVisible()) {
				this._triggerNode.classList.remove("dropdownTriggerOpen"); //$NON-NLS-0$
				if (this._selectionClass) {
					this._triggerNode.classList.remove(this._selectionClass);
				}
				this._dropdownNode.classList.remove("dropdownMenuOpen"); //$NON-NLS-0$
				lib.setFramesEnabled(true);
				if (restoreFocus) {
					this._triggerNode.focus();
				}
				
				this._isVisible = false;
				if (this._selectedItem) {
					this._selectedItem.classList.remove("dropdownMenuItemSelected"); //$NON-NLS-0$		
					this._selectedItem = null;	
				}
				
				if (this._boundAutoDismiss) {
					lib.removeAutoDismiss(this._boundAutoDismiss);
					this._boundAutoDismiss = null;
				} 
				actionTaken = true;
			}
			return actionTaken;
		},
		
		/**
		 *
		 */
		getItems: function() {
			var items = lib.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem", this._dropdownNode, true); //$NON-NLS-0$
			// We only want the direct li children, not any descendants.  But we can't preface a query with ">"
			// So we do some reachy filtering here.
			var filtered = [];
			var self = this;
			items.forEach(function(item) {
				if (item.parentNode.parentNode === self._dropdownNode) {
					filtered.push(item);
				}
			});
			
			//add handler to close open submenu when other items in the parent menu are hovered
			filtered.forEach(function(item){
				if (!item._hasDropdownMouseover) {
					item.addEventListener("mouseover", function(e){ //$NON-NLS-0$
						if (item.dropdown) {
							item.dropdown.open(e);
						} else {
							self._closeSelectedSubmenu();
							lib.stop(e);
						}
						self._selectItem(item); // select the item on mouseover
					});
					item._hasDropdownMouseover = true;
				}
			});
			return filtered;
		},
		
		/**
		 *
		 */
		empty: function() {
			var items = lib.$$array("li", this._dropdownNode); //$NON-NLS-0$
			var self = this;
			// We only want the direct li children, not any descendants. 
			items.forEach(function(item) {
				if (item.parentNode === self._dropdownNode) {
					item.parentNode.removeChild(item);
				}
			});
		},
		
		 
		/**
		 * A key is down in the dropdown node
		 */
		 _dropdownKeyDown: function(event) {
			if (event.keyCode === lib.KEY.UP || event.keyCode === lib.KEY.DOWN || event.keyCode === lib.KEY.RIGHT || event.keyCode === lib.KEY.ENTER || event.keyCode === lib.KEY.LEFT) {
				var items = this.getItems();	
				if (items.length && items.length > 0) {
					if (this._selectedItem) {
						var index = items.indexOf(this._selectedItem);
						// for inputs nested in labels, we should check the parent node since the label is the item
						if (index < 0) {
							index = items.indexOf(this._selectedItem.parentNode);
						}
						if (index >= 0) {
							if (event.keyCode === lib.KEY.UP && index > 0) {
								index--;
								this._selectItem(items[index]);
							} else if (event.keyCode === lib.KEY.DOWN && index < items.length - 1) {
								index++;
								this._selectItem(items[index]);
							} else if (event.keyCode === lib.KEY.ENTER || event.keyCode === lib.KEY.RIGHT) {
								if (this._selectedItem.classList.contains("dropdownTrigger") && this._selectedItem.dropdown) { //$NON-NLS-0$
									this._selectedItem.dropdown.open();
									this._selectedItem.dropdown._selectItem(); // select first item in submenu
								} else if (event.keyCode === lib.KEY.ENTER) {
									this._selectedItem.click();
								}
							} else if (event.keyCode === lib.KEY.LEFT && this._selectedItem.parentNode.parentNode.classList.contains("dropdownMenuOpen")) { //$NON-NLS-0$
								this.close(true);
								if (this._parentDropdown) {
									this._parentDropdown._dropdownNode.focus();
								}
							}
						}
					} else {
						this._selectItem(items[0]);	
					}
					lib.stop(event);
				}
			} else if (event.keyCode === lib.KEY.ESCAPE) {
				this.close(true);
				lib.stop(event);
			}
		 },
		 
		 /**
		  * Selects the specified dropdown menu item or the first
		  * dropdown menu item if none is specified.
		  * @param {Object} item The dropdown menu item that should be selected. See @ref getItems() for details. Optional.
		  */
		 _selectItem: function(item){
		 	var itemToSelect = item || this.getItems()[0];
		 	if (itemToSelect) {
		 		if (this._selectedItem) {
		 			this._selectedItem.classList.remove("dropdownMenuItemSelected"); //$NON-NLS-0$
			 	}
			 	this._selectedItem = itemToSelect;
			 	this._selectedItem.classList.add("dropdownMenuItemSelected"); //$NON-NLS-0$	
		 	}
		 	if (document.activeElement !== this._dropdownNode) {
		 		// ensure that the dropdown node has the focus in 
		 		// order for keydown events to be handled properly
		 		this._dropdownNode.focus();
		 	}
		 },
		 
		 /**
		  * Closes this._selectedSubmenu, and its children, if it is open.
		  * Sets the this._selectedSubmenu to the one that's passed in.
		  * @param submenu The submenu that was opened and should be set as the next this._selectedSubmenu
		  */
		submenuOpen: function(submenu) {
			if (submenu !== this._selectedSubmenu) {
				//close the current menu and all its children
				this._closeSelectedSubmenu();
				this._selectedSubmenu = submenu;
			}
		 },
		 
		_closeSelectedSubmenu: function() {
			var currentSubmenu = this._selectedSubmenu;
			while(currentSubmenu) {
				currentSubmenu.close();
				currentSubmenu = currentSubmenu._selectedSubmenu;
			}
		 },
		 
		destroy: function() {
			this.empty();
			if (this._boundAutoDismiss) {
				lib.removeAutoDismiss(this._boundAutoDismiss);
				this._boundAutoDismiss = null;
			}
		},
		
		/**
		 * Creates a new menu item and appends it to the bottom of this dropdown.
		 * @param {String} text The text to display inside the new menu item. Optional.
		 * @param {String} innerNodeType The type of the inner node to create. The default is "span". Optional.
		 * @returns {Object} The top-most new element that was created
		 */
		appendMenuItem: function(text, innerNodeType) {
			var li = createMenuItem(text, innerNodeType);
			this._dropdownNode.appendChild(li);
			return li;
		},
		
		/**
		 * Creates a new separator and appends it to the bottom of this dropdown.
		 */
		appendSeparator: function() {
			// Add a separator
			var li = createSeparator();
			this._dropdownNode.appendChild(li);
			return li;
		}
	};
	
	/**
	 * Creates a new menu item and returns it to the caller.
	 * @param {String} text The text to display inside the new menu item. Optional.
	 * @param {String} innerNodeType The type of the inner node to create. The default is "span". Optional.
	 * @returns {Object} The top-most new element that was created
	 */
	function createMenuItem(text, innerNodeType) {
		innerNodeType = innerNodeType === undefined ? "span" : innerNodeType; //$NON-NLS-0$
	 	
	 	var element = document.createElement(innerNodeType); //$NON-NLS-0$
		element.tabIndex = 0;
		element.className = "dropdownMenuItem"; //$NON-NLS-0$
		element.role = "menuitem";  //$NON-NLS-0$
		
		if (text) {
			var span = document.createElement("span");  //$NON-NLS-0$
			span.appendChild(document.createTextNode(text));
			span.classList.add("dropdownCommandName"); //$NON-NLS-0$
			element.appendChild(span);
		}
	 	
	 	var li = document.createElement("li"); //$NON-NLS-0$
	 	li.appendChild(element); //$NON-NLS-0$
		
		return li;
	}
	
	/**
	 * Creates a new separator menu item and returns it to the caller.
	 * @returns {Object} The new separator element that was created
	 */
	function createSeparator() {
		var li = document.createElement("li"); //$NON-NLS-0$
		li.classList.add("dropdownSeparator"); //$NON-NLS-0$
		return li;
	}
	
	/**
	 * Appends the specified keyBindingString to the specified menu item.
	 * @param {Object} element The menu item to append the keybinding string to. Required.
	 * @param {String} keyBindingString The keybinding string to append. Required.
	 */
	function appendKeyBindingString(element, keyBindingString) {
		var span = document.createElement("span"); //$NON-NLS-0$
		span.classList.add("dropdownKeyBinding"); //$NON-NLS-0$
		span.appendChild(document.createTextNode(keyBindingString));
		element.appendChild(span);
	}
		
	Dropdown.prototype.constructor = Dropdown;
	//return the module exports
	return {Dropdown: Dropdown,
			appendKeyBindingString: appendKeyBindingString,
			createMenuItem: createMenuItem,
			createSeparator: createSeparator};
});

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.12',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config && config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config && config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            // Do not load if it is an empty: url
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                if (errback) {
                    errback(e);
                }
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status || 0;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        if (errback) {
                            errback(err);
                        }
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes;
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});

define('text!orion/webui/dropdowntriggerbutton.html',[],function () { return '<button class="dropdownTrigger">${ButtonText}<!--span class="dropdownArrowDown core-sprite-openarrow"></span--></button><ul class="dropdownMenu"></ul>';});

define('text!orion/webui/dropdowntriggerbuttonwitharrow.html',[],function () { return '<button class="dropdownTrigger dropdownDefaultButton">${ButtonText}<span class="dropdownArrowDown core-sprite-openarrow"></span></button><ul class="dropdownMenu"></ul>';});

define('text!orion/webui/checkedmenuitem.html',[],function () { return '<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>';});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/tooltip',['orion/webui/littlelib'], function(lib) {

	/**
	 * Attaches tooltip behavior to a given node.  The tooltip will be assigned class "tooltip" which can be
	 * used to control appearance.  Uses the "CSS Triangle Trick" 
	 * http://css-tricks.com/snippets/css/css-triangle/
	 * for the tooltip shape and CSS transitions for fade in and fade out.
	 *
	 * Clients should destroy the tooltip if removing the node from the document.
	 *
	 * @param {Object} options The options object, which must minimally specify the tooltip dom node
	 * @param options.node The node showing the tooltip.  Required.
	 * @param options.text The text in the tooltip.  Optional.  If not specified, the client is expected to add content
	 * to the tooltip prior to triggering it.
	 * @param options.trigger The event that triggers the tooltip.  Optional.  Defaults to "mouseover".  Can be one of "mouseover",
	 * "click", "focus", or "none".  If "none" then the creator will be responsible for showing, hiding, and destroying the tooltip.
	 * If "mouseover" then the aria attributes for tooltips will be set up.
	 * @param options.position An array specifying the preferred positions to try positioning the tooltip.  Positions can be "left", "right", 
	 * "above", or "below".  If no position will fit on the screen, the first position specified is used.  Optional.  Defaults to 
	 * ["right", "above", "below", "left"].
	 * @param options.showDelay Specifies the number of millisecond delay before the tooltip begins to appear.
	 * Optional.  Valid only for "mouseover" trigger.  Defaults to 1000.
	 * @param options.hideDelay Specifies the number of millisecond delay before the tooltip begins to disappear.
	 * Optional.  Defaults to 200.  Valid only for "mouseover" trigger.
	 * @param options.tailSize Specifies the number of pixels to allocate for the tail.  Optional.  Defaults to 10.
	 * @name orion.webui.tooltip.Tooltip
	 *
	 */
	function Tooltip(options) {
		this._init(options);
	}
	Tooltip.prototype = /** @lends orion.webui.tooltip.Tooltip.prototype */ {
			
		_init: function(options) {
			this._node = lib.node(options.node);
			if (!this._node) { throw "no dom node for tooltip found"; } //$NON-NLS-0$
			this._position = options.position || ["right", "above", "below", "left"]; //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			this._text = options.text;
			this._hideDelay = options.hideDelay === undefined ? 200 : options.hideDelay;
			this._tailSize = options.tailSize || 10;
			this._trigger = options.trigger || "mouseover"; //$NON-NLS-0$
			this._afterShowing = options.afterShowing;
			this._afterHiding = options.afterHiding;
			
			var self = this;
			// set up events
			if (this._trigger === "click") { //$NON-NLS-0$
				this._showDelay = 0;
				this._node.addEventListener("click", this._clickHandler = function(event) { //$NON-NLS-0$
					if (event.target === self._node) {
						self.show();
						lib.stop(event);
					}
				}, false);
			} else if (this._trigger === "mouseover") { //$NON-NLS-0$
				this._showDelay = options.showDelay === undefined ? 500 : options.showDelay;
				var leave = ["mouseout", "click"];  //$NON-NLS-1$ //$NON-NLS-0$
				this._node.addEventListener("mouseover", this._mouseoverHandler = function(event) { //$NON-NLS-0$
					if (lib.contains(self._node, event.target)) {
						self.show();
						lib.stop(event);
					}
				}, false);
				
				this._leaveHandler = function(event) { //$NON-NLS-0$
					if (lib.contains(self._node, event.target)) {
						self.hide();
					}
				};

				for (var i=0; i<leave.length; i++) {
					this._node.addEventListener(leave[i], this._leaveHandler, false);
				}
			} else if (this._trigger === "focus") { //$NON-NLS-0$
				this._showDelay = options.showDelay === undefined ? 0 : options.showDelay;
				this._hideDelay = options.hideDelay === undefined ? 0 : options.hideDelay;
				this._node.addEventListener("focus", this._focusHandler = function(event) { //$NON-NLS-0$
					if (lib.contains(self._node, event.target)) {
						self.show();
					}
				}, false);
				
				this._blurHandler = function(event) { //$NON-NLS-0$
					if (lib.contains(self._node, event.target)) {
						self.hide();
					}
				};
				
				this._node.addEventListener("blur", this._blurHandler, false); //$NON-NLS-0$
			}						
		},
		
		_makeTipNode: function() {
			if (!this._tip) {
				this._tip = document.createElement("span"); //$NON-NLS-0$
				this._tip.classList.add("tooltipContainer"); //$NON-NLS-0$
				this._tipInner = document.createElement("div");  //$NON-NLS-0$
				this._tipInner.classList.add("tooltip");  //$NON-NLS-0$
				if (this._text) {
					this._tipTextContent = document.createElement("div");  //$NON-NLS-0$
					this._tipTextContent.classList.add("textContent");  //$NON-NLS-0$
					this._tipInner.appendChild(this._tipTextContent);
					var textNode = document.createTextNode(this._text);
					this._tipTextContent.appendChild(textNode);
				}
				this._tip.appendChild(this._tipInner);
				document.body.appendChild(this._tip);
				var self = this;
				lib.addAutoDismiss([this._tip, this._node], function() {self.hide();});
				if (this._trigger === "mouseover") { //$NON-NLS-0$
					 this._tipInner.role = "tooltip"; //$NON-NLS-0$
					 this._tipInner.id = "tooltip" + new Date().getTime().toString(); //$NON-NLS-0$
					 this._node.setAttribute("aria-describedby", this._tipInner.id); //$NON-NLS-0$
				
					// see https://bugs.eclipse.org/bugs/show_bug.cgi?id=398960
					// mousing over the tip itself will cancel any pending timeout to close it, but then we must
					// also close it when we leave the tip.
					this._tip.addEventListener("mouseover", function(event) { //$NON-NLS-0$
						if (self._timeout) {
							window.clearTimeout(self._timeout);
							self._timeout = null;
						}
						self._tip.addEventListener("mouseout", function(event) { //$NON-NLS-0$
							if (lib.contains(self._tip, event.target)) {
								self.hide();
								lib.stop(event);
							}
						}, false);
					}, false);
				}
			}
			return this._tip;
		},
		
		_positionTip: function(position, force) {
			this._makeTipNode();  // lazy initialize
			
			this._tip.classList.add("tooltipShowing"); //$NON-NLS-0$
			
			// special case for left tooltip to ensure inner span is adjacent to tail.
			if (position === "left") { //$NON-NLS-0$
				this._tipInner.classList.add("left"); //$NON-NLS-0$
			} else {
				this._tipInner.classList.remove("left"); //$NON-NLS-0$
			}

			// Sometimes _node is not visible (eg. if _node is a dropdown menu item in a closed menu), so find
			// the nearest ancestor with a reasonable bound
			var posNode = this._node;
			var rect;
			for (rect = lib.bounds(posNode); posNode && !rect.width && !rect.height; posNode = posNode.parentNode) {
				rect = lib.bounds(posNode);
			}
			var tipRect = lib.bounds(this._tipInner);
			var top, left;
			
			switch (position) {
				case "above": //$NON-NLS-0$
					top = rect.top - tipRect.height - this._tailSize - 1;
					left = rect.left - this._tailSize;
					break;
				case "below": //$NON-NLS-0$
					top = rect.top + rect.height + this._tailSize + 1;
					left = rect.left - this._tailSize;
					break;
				case "left": //$NON-NLS-0$
					top = rect.top - this._tailSize / 2;
					left = rect.left - tipRect.width - this._tailSize - 1;
					break;
				default:  // right
					top = rect.top - this._tailSize / 2;
					left = rect.left + rect.width + this._tailSize + 1;
					break;
			}
			var totalRect = lib.bounds(document.documentElement);
			if (top + tipRect.height > totalRect.height) {
				if (force) {
					top = totalRect.height - tipRect.height - 1;
				} else {
					return false;
				}
			}
			if (left + tipRect.width > totalRect.width) {
				if (force) {
					left = totalRect.width - tipRect.width - 1;
				} else {
					return false;
				}
			}
			if (left < 0) {
				if (force) {
					left = 4;
				} else {
					return false;
				}
			}
			if (top < 0) {
				if (force) {
					top = 4;
				} else {
					return false;
				}
			}
			
			if (this._tail && (this._tail.previousPosition !== position)) {
				//position has changed, tail needs to be modified
				this._tip.removeChild(this._tail);
				this._tail = null;
			}
			
			if (!this._tail) {
				this._tail = document.createElement("span"); //$NON-NLS-0$
				this._tail.classList.add("tooltipTailFrom"+position); //$NON-NLS-0$
				if (position === "above" || position === "left") { //$NON-NLS-1$//$NON-NLS-0$
					// tip goes after content
					this._tip.appendChild(this._tail);
				} else {
					this._tip.insertBefore(this._tail, this._tipInner);
				}
				this._tail.previousPosition = position;
			}
			this._tip.style.top = top + "px"; //$NON-NLS-0$
			this._tip.style.left = left + "px"; //$NON-NLS-0$ 
			return true;
		},
		
		contentContainer: function() {
			this._makeTipNode();
			return this._tipInner;
		},
		
		/**
		 * @return True if this tooltip is visible, false otherwise
		 */
		isShowing: function() {
			return this._tip && this._tip.classList.contains("tooltipShowing"); //$NON-NLS-0$
		},
		
		/**
		 * Show the tooltip.
		 */			
		show: function() {
			if (this.isShowing()) { //$NON-NLS-0$
				return;
			}
			if (this._timeout) {
				window.clearTimeout(this._timeout);
				this._timeout = null;
			}
			if (this._showDelay) {
				this._timeout = window.setTimeout(this._showImmediately.bind(this), this._showDelay);	
			} else {
				this._showImmediately();
			}
		},
		
		_showImmediately: function() {
			var positioned = false;
			var index = 0;
			while (!positioned && index < this._position.length) {
				positioned = this._positionTip(this._position[index]);
				index++;
			}
			if (!positioned) {
				this._positionTip(this._position[0], true);  // force it in, it doesn't fit anywhere
			}
			if (this._afterShowing) {
				this._afterShowing();
			}
		},
		
		/**
		 * Hide the tooltip.
		 */			
		hide: function(hideDelay) {
			if (this._timeout) {
				window.clearTimeout(this._timeout);
				this._timeout = null;
			}
			if (!this.isShowing()) { //$NON-NLS-0$
				return;
			}
			if (hideDelay === undefined) {
				hideDelay = this._hideDelay;
			}
			var self = this;
			this._timeout = window.setTimeout(function() {
				self._tip.classList.remove("tooltipShowing"); //$NON-NLS-0$
				self._tip.removeAttribute("style"); //$NON-NLS-0$
				if (self._afterHiding) {
					self._afterHiding();
				}
			}, hideDelay);
		},
		
		destroy: function() {
			if (this._timeout) {
				window.clearTimeout(this._timeout);
				this._timeout = null;
			}
			if (this._tip) {
				document.body.removeChild(this._tip);
				this._tip = null;
				this._tipInner = null;
				this._tipTextContent = null;
				this._tail = null;
			}
			if (this._node) {
				this._node.removeEventListener("click", this._clickHandler, false); //$NON-NLS-0$
				this._node.removeEventListener("mouseover", this._mouseoverHandler, false); //$NON-NLS-0$
				this._node.removeEventListener("focus", this._focusHandler, false); //$NON-NLS-0$
				this._node.removeEventListener("blur", this._blurHandler, false); //$NON-NLS-0$
				var leave = ["mouseout", "click"];  //$NON-NLS-1$ //$NON-NLS-0$
				for (var i=0; i<leave.length; i++) {
					this._node.removeEventListener(leave[i], this._leaveHandler, false);
				}
			}
		}
	};
	Tooltip.prototype.constructor = Tooltip;
	//return the module exports
	return {Tooltip: Tooltip};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010,2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
 
define('orion/commands',[
	'orion/util',
	'orion/webui/littlelib',
	'orion/webui/dropdown',
	'text!orion/webui/dropdowntriggerbutton.html',
	'text!orion/webui/dropdowntriggerbuttonwitharrow.html',
	'text!orion/webui/checkedmenuitem.html',
	'orion/webui/tooltip'
], function(util, lib, Dropdown, DropdownButtonFragment, DropdownButtonWithArrowFragment, CheckedMenuItemFragment, Tooltip) {
		/**
		 * @name orion.commands.NO_IMAGE
		 * @description Image data for 16x16 transparent png.
		 * @property
		 */
		var NO_IMAGE = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC"; //$NON-NLS-0$

		/* a function that can be set for retrieving bindings stored elsewhere, such as a command registry */
		var getBindings = null;
		
		/* key bindings registered locally
		 *
		 * object keyed by command id, value is { keyBinding: keyBinding, command: command, invocation: commandInvocation }
		 *
		 */
		var localKeyBindings = {};
		
		/*
		 * Set a function that will provide key bindings when key events are processed.  This is used when an external party
		 * (such as a command registry) wants its bindings to be honored by the command key listener.
		 */
		function setKeyBindingProvider(getBindingsFunction) {
			getBindings = getBindingsFunction;
		}

		/**
		 * Executes a binding if possible.
		 * @name orion.commands.executeBinding
		 * @function
		 * @static
		 * @param {Object} binding
		 * @returns {Boolean} <code>true</code> if the binding was executed, <code>false</code> otherwise.
		 */
		function executeBinding(binding) {
			var invocation = binding.invocation;
			if (invocation) {
				var command = binding.command;
				if (command.hrefCallback) {
					var href = command.hrefCallback.call(invocation.handler || window, invocation);
					if (href.then){
						href.then(function(l){
							window.open(l);
						});
					} else {
						// We assume window open since there's no link gesture to tell us what to do.
						window.open(href);
					}
					return true;
				} else if (invocation.commandRegistry) {
					// See https://bugs.eclipse.org/bugs/show_bug.cgi?id=411282
					invocation.commandRegistry._invoke(invocation);
					return true;
				} else if (command.onClick || command.callback) {
					// TODO: what is this timeout for?
					window.setTimeout(function() {
						(command.onClick || command.callback).call(invocation.handler || window, invocation);
					}, 0);
					return true;
				}
			}
			return false;
		}

		/*
		 * Process a key event against the provided bindings.
		 */
		function _processKey(event, bindings) {
			for (var id in bindings) {
				if (bindings[id] && bindings[id].keyBinding && bindings[id].command) {
					if (bindings[id].keyBinding.match(event)) {
						var activeBinding = bindings[id];
						var keyBinding = activeBinding.keyBinding;
						// Check for keys that are scoped to a particular part of the DOM
						if (!keyBinding.domScope || lib.contains(lib.node(keyBinding.domScope), event.target)) {
							if (executeBinding(activeBinding)) {
								lib.stop(event);
								return;
							}
						}
					}
				}
			}
		}
		
		function getKeyBindings() {
			var allBindings = {};
			
			if (getBindings) {
				var i, keys, objectKey;
				keys = Object.keys(localKeyBindings);
				for (i=0; i<keys.length; i++) {
					objectKey = keys[i];
					allBindings[objectKey] = localKeyBindings[objectKey];
				}
				var otherBindings = getBindings();
				keys = Object.keys(otherBindings);
				for (i=0; i<keys.length; i++) {
					objectKey = keys[i];
					allBindings[objectKey] = otherBindings[objectKey];
				}
			} else {
				allBindings = localKeyBindings;
			}
			return allBindings;
		}
		
		function processKey(evt) {
			_processKey(evt, getKeyBindings());
		}
		
		function handleKeyEvent(evt, processKeyFunc) {
			function isContentKey(e) {
				// adapted from handleKey in http://git.eclipse.org/c/platform/eclipse.platform.swt.git/plain/bundles/org.eclipse.swt/Eclipse%20SWT%20Custom%20Widgets/common/org/eclipse/swt/custom/StyledText.java
				if (util.isMac) {
					// COMMAND+ALT combinations produce characters on the mac, but COMMAND or COMMAND+SHIFT do not.
					if (e.metaKey && !e.altKey) {  //command without alt
						// see https://bugs.eclipse.org/bugs/show_bug.cgi?id=390341
						// special case for select all, cut, copy, paste, and undo.  A slippery slope...
						if (!e.shiftKey && !e.ctrlKey && (e.keyCode === 65 || e.keyCode === 67 || e.keyCode === 86 || e.keyCode === 88 || e.keyCode === 90)) {
							return true;
						}
						return false;
					}
					if (e.ctrlKey) {
						return false;
					}
				} else {
					// CTRL or ALT combinations are not characters, however both of them together (CTRL+ALT)
					// are the Alt Gr key on some keyboards.  See Eclipse bug 20953. If together, they might
					// be a character. However there aren't usually any commands associated with Alt Gr keys.
					if (e.ctrlKey && !e.altKey) {
						// special case for select all, cut, copy, paste, and undo.  
						if (!e.shiftKey && (e.keyCode === 65 || e.keyCode === 67 || e.keyCode === 86 || e.keyCode === 88 || e.keyCode === 90)) {
							return true;
						}
						return false;
					}
					if (e.altKey && !e.ctrlKey) {
						return false;
					}
					if (e.ctrlKey && e.altKey){
						return false;
					}
				}
				if (e['char']) { //$NON-NLS-0$
					return e['char'].length > 0;  // empty string for non characters //$NON-NLS-0$
				} else if (e.charCode || e.keyCode) {
					var keyCode= e.charCode || e.keyCode;
					// anything below SPACE is not a character except for line delimiter keys, tab, and delete.
					switch (keyCode) {
						case 8:  // backspace
						case 9:  // tab
						case 13: // enter
						case 46: // delete
							return true;
						default:
							return (keyCode >= 32 && keyCode < 112) || // space key and above until function keys
								keyCode > 123; // above function keys  
					}
				}
				// If we can't identify as a character, assume it's not
				return false;
			}
			
			evt = evt || window.event;
			if (isContentKey(evt)) {
				// bindings that are text content keys are ignored if we are in a text field or editor
				// see https://bugs.eclipse.org/bugs/show_bug.cgi?id=375058
				if (evt.target.contentEditable === "true") { //$NON-NLS-0$
					return;
				}
				var tagType = evt.target.nodeName.toLowerCase();
				if (tagType === 'input') { //$NON-NLS-0$
					var inputType = evt.target.type.toLowerCase();
					// Any HTML5 input type that involves typing text should be ignored
					switch (inputType) {
						case "text": //$NON-NLS-0$
						case "password": //$NON-NLS-0$
						case "search": //$NON-NLS-0$
						case "color": //$NON-NLS-0$
						case "date": //$NON-NLS-0$
						case "datetime": //$NON-NLS-0$
						case "datetime-local": //$NON-NLS-0$
						case "email": //$NON-NLS-0$
						case "month": //$NON-NLS-0$
						case "number": //$NON-NLS-0$
						case "range": //$NON-NLS-0$
						case "tel": //$NON-NLS-0$
						case "time": //$NON-NLS-0$
						case "url": //$NON-NLS-0$
						case "week": //$NON-NLS-0$
							return;
					}
				} else if (tagType === 'textarea') { //$NON-NLS-0$
					return;
				}
			}
			if (processKeyFunc) {
				processKeyFunc(evt);
			} else {
				processKey(evt);
			}
		}
		
		function CommandsProxy() {
			this._init();
		}
		CommandsProxy.prototype = {
			setProxy: function(proxy) {
				this.proxy = proxy;
			},
			setKeyBindings: function(bindings) {
				this.bindings = bindings;
			},
			_init: function() {
				var self = this;
				document.addEventListener("keydown", function(evt) { //$NON-NLS-0$
					return handleKeyEvent(evt, function(evt) {
						var proxy = self.proxy;
						var bindings = self.bindings;
						if (!bindings || !proxy) {
							return;
						}
						for (var i=0; i<bindings.length; i++) {
							if (bindings[i].match(evt)) {
								proxy.processKey({
									type: evt.type,
									keyCode: evt.keyCode,
									altKey: evt.altKey,
									ctrlKey: evt.ctrlKey,
									metaKey: evt.metaKey,
									shiftKey: evt.shiftKey
								});
								lib.stop(evt);
							}
						}
					});
				});
			}
		};

		window.document.addEventListener("keydown", handleKeyEvent, false); //$NON-NLS-0$

	function _addImageToElement(command, element, name) {
		element.classList.add("commandImage"); //$NON-NLS-0$
		var node;
		if (command.imageClass) {
			if (command.addImageClassToElement) {
				element.classList.add(command.imageClass);
			} else {
				node = document.createElement("span"); //$NON-NLS-0$
				element.appendChild(node);
				node.classList.add(command.spriteClass);
				node.classList.add(command.imageClass);
			}
		} else {
			node = new Image();
			node.alt = command.name;
			node.name = name;
			node.id = name;
			node.src = command.image;
			element.appendChild(node);
		}
		return node;
	}

	function createDropdownMenu(parent, name, populateFunction, buttonClass, buttonIconClass, showName, selectionClass, positioningNode, displayDropdownArrow, extraClasses) {
		
		parent = lib.node(parent);
		if (!parent) {
			throw "no parent node was specified"; //$NON-NLS-0$
		}
		var range = document.createRange();
		range.selectNode(parent);
		var buttonFragment = displayDropdownArrow ? range.createContextualFragment(DropdownButtonWithArrowFragment) : range.createContextualFragment(DropdownButtonFragment);
		// bind name to fragment variable
		lib.processTextNodes(buttonFragment, {ButtonText: name});
		parent.appendChild(buttonFragment);
		var newMenu = parent.lastChild;
		var menuButton;
		var dropdownArrow;
		if (displayDropdownArrow) {
			menuButton = newMenu.previousSibling;
			dropdownArrow = menuButton.lastChild;
		} else {
			menuButton = newMenu.previousSibling;
		}
		if (buttonClass) {
			menuButton.classList.add(buttonClass); //$NON-NLS-0$
		} else {
			menuButton.classList.add("orionButton"); //$NON-NLS-0$
			menuButton.classList.add("commandButton"); //$NON-NLS-0$
		}
		if (extraClasses) {
			extraClasses.split(" ").forEach(menuButton.classList.add.bind(menuButton.classList));
		}
		
		if (buttonIconClass) {
			if(!showName) {
				menuButton.textContent = ""; //$NON-NLS-0$
				menuButton.setAttribute("aria-label", name); //$NON-NLS-0$
			}
			_addImageToElement({ spriteClass: "commandSprite", imageClass: buttonIconClass }, menuButton, name); //$NON-NLS-0$
			menuButton.classList.add("orionButton"); //$NON-NLS-0$
		}
		menuButton.dropdown = new Dropdown.Dropdown({
			dropdown: newMenu, 
			populate: populateFunction,
			selectionClass: selectionClass,
			skipTriggerEventListeners: !!dropdownArrow,
			positioningNode: positioningNode
		});
		newMenu.dropdown = menuButton.dropdown;
		return {menuButton: menuButton, menu: newMenu, dropdown: menuButton.dropdown, dropdownArrow: dropdownArrow};
	}
	
	function createCheckedMenuItem(parent, name, checked, onChange) {
		parent = lib.node(parent);
		if (!parent) {
			throw "no parent node was specified"; //$NON-NLS-0$
		}
		var range = document.createRange();
		range.selectNode(parent);
		var buttonFragment = range.createContextualFragment(CheckedMenuItemFragment);
		// bind name to fragment variable
		lib.processTextNodes(buttonFragment, {ItemText: name});
		parent.appendChild(buttonFragment);
		var itemParent = parent.lastChild;
		var checkbox = lib.$(".checkedMenuItem", itemParent); //$NON-NLS-0$
		checkbox.checked = checked;
		checkbox.addEventListener("change", onChange, false); //$NON-NLS-0$
		return checkbox;
	}

	function createCommandItem(parent, command, commandInvocation, id, keyBinding, useImage, callback) {
		var element;
		var clickTarget;
		useImage = useImage || (!command.name && command.hasImage());
		
		var renderButton = function() {
				if (useImage) {
					if (command.hasImage()) {
						_addImageToElement(command, element, id);
						// ensure there is accessible text describing this image
						if (command.name) {
							element.setAttribute("aria-label", command.name); //$NON-NLS-0$
						}
					} else {
						element.classList.add("commandButton"); //$NON-NLS-0$
						element.classList.add("commandMissingImageButton"); //$NON-NLS-0$
						element.appendChild(document.createTextNode(command.name));
					}
				} else {
					element.classList.add("commandButton"); //$NON-NLS-0$
					var text = document.createTextNode(command.name);
					element.appendChild(text);
				}
		};
		
		if (command.hrefCallback) {
			element = clickTarget = document.createElement("a"); //$NON-NLS-0$
			element.id = id;
			if (useImage && command.hasImage()) {
				_addImageToElement(command, element, id);
			} else {
				element.className = "commandLink"; //$NON-NLS-0$
				element.appendChild(document.createTextNode(command.name));
			}
			var href = command.hrefCallback.call(commandInvocation.handler, commandInvocation);
			if (href.then){
				href.then(function(l){
					element.href = l;
				});
			} else if (href) {
				element.href = href; 
			} else {  // no href
				element.href = "#"; //$NON-NLS-0$
			}
		} else {
			if (command.type === "switch") { //$NON-NLS-0$
				element = document.createElement("div"); //$NON-NLS-0$
				element.tabIndex = 0;
				element.className = "orionSwitch"; //$NON-NLS-0$
				var input = clickTarget = document.createElement("input"); //$NON-NLS-0$
				input.type = "checkbox"; //$NON-NLS-0$
				input.className = "orionSwitchCheck"; //$NON-NLS-0$
				input.id = "orionSwitchCheck" + command.id; //$NON-NLS-0$
				if(parent.id) {
					input.id = input.id + parent.id;
				}
				element.appendChild(input);
				var label = document.createElement("label"); //$NON-NLS-0$
				label.className = "orionSwitchLabel"; //$NON-NLS-0$
				label.setAttribute("for", input.id); //$NON-NLS-0$  
				var span1 = document.createElement("span"); //$NON-NLS-0$
				span1.className = "orionSwitchInner"; //$NON-NLS-0$
				var span2 = document.createElement("span"); //$NON-NLS-0$
				span2.className = "orionSwitchSwitch"; //$NON-NLS-0$
				label.appendChild(span1);
				label.appendChild(span2);
				element.appendChild(label);
				element.addEventListener("keydown", function(e) { //$NON-NLS-0$
					if (e.keyCode === lib.KEY.ENTER || e.keyCode === lib.KEY.SPACE) {
						input.click();
					}
				}, false);

				input.checked = command.checked;
				span1.classList.add(command.imageClass);
			} else if (command.type === "toggle") {  //$NON-NLS-0$
				element = clickTarget = document.createElement("button"); //$NON-NLS-0$
				element.className = "orionButton"; //$NON-NLS-0$
				element.classList.add(command.checked ? "orionToggleOn" : "orionToggleOff");  //$NON-NLS-1$ //$NON-NLS-0$
				element.id = "orionToggle" + command.id; //$NON-NLS-0$
				if(parent.id) {
					element.id = element.id + parent.id;
				}
				renderButton();
			} else {
				element = clickTarget = document.createElement("button"); //$NON-NLS-0$
				element.className = "orionButton"; //$NON-NLS-0$
				if (command.extraClass) {
					element.classList.add(command.extraClass);
				}
				renderButton();
			}
			var onClick = callback || command.callback;
			if (onClick) {
				var done = function() {onClick.call(commandInvocation.handler, commandInvocation);};
				command.onClick = onClick;
				clickTarget.addEventListener("click", function(e) { //$NON-NLS-0$
					var onClickThen;
					if (command.type === "switch" || command.type === "toggle") { //$NON-NLS-1$ //$NON-NLS-0$
						onClickThen = function (doIt) {
							if (command.type === "toggle") { //$NON-NLS-0$
								if(doIt) {
									command.checked = !command.checked;
								}
								if (command.checked) {
									element.classList.remove("orionToggleOff"); //$NON-NLS-0$
									element.classList.add("orionToggleOn"); //$NON-NLS-0$
									element.classList.add("orionToggleAnimate"); //$NON-NLS-0$
								} else {
									element.classList.remove("orionToggleOn"); //$NON-NLS-0$
									element.classList.add("orionToggleOff"); //$NON-NLS-0$
									element.classList.add("orionToggleAnimate"); //$NON-NLS-0$
								}
							}else {
								if(doIt) {
									command.checked = input.checked;
								} else {
									input.checked = !input.checked;
								}
							}
							if(doIt) {
								window.setTimeout(done, 250);
							}
						};
					} else {
						onClickThen = function (doIt) { if(doIt) {
								done();
							}
						};
					}
					if(command.preCallback) {
						command.preCallback(commandInvocation).then( function(doIt) {
							onClickThen(doIt);
						});
					} else {
						onClickThen(true);
					}
					e.stopPropagation();
				}, false);
			}
		}
		if (parent.nodeName.toLowerCase() === "ul") { //$NON-NLS-0$
			var li = document.createElement("li"); //$NON-NLS-0$
			parent.appendChild(li);
			parent = li;
		} else {
			element.classList.add("commandMargins"); //$NON-NLS-0$
		}
		parent.appendChild(element);
		if (command.tooltip) {
			element.commandTooltip = new Tooltip.Tooltip({
				node: element,
				text: command.tooltip,
				position: ["above", "below", "right", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			});
		}
		if (keyBinding) {
			localKeyBindings[command.id] = { keyBinding: keyBinding, command: command, invocation: commandInvocation };
		}
		return element;
	}
	
	function createCommandMenuItem(parent, command, commandInvocation, keyBinding, callback, keyBindingString) {
		var element, li;
		var dropdown = parent.dropdown;
		if (command.hrefCallback) {
			li = Dropdown.createMenuItem(command.name, "a"); //$NON-NLS-0$
			element = li.firstElementChild;
			var href = command.hrefCallback.call(commandInvocation.handler, commandInvocation);
			if (href.then){
				href.then(function(l){
					element.href = l;
				});
			} else if (href) {
				element.href = href; 
			} else {  // no href
				element.href = "#"; //$NON-NLS-0$
			}
			element.addEventListener("keydown", function(e) { //$NON-NLS-0$
				if (e.keyCode === lib.KEY.ENTER || e.keyCode === lib.KEY.SPACE) {
					element.click();
				}
			}, false);
		} else {
			li = Dropdown.createMenuItem(command.name); //$NON-NLS-0$
			element = li.firstElementChild;
			var onClick = callback || command.callback;
			if (onClick) {
				command.onClick = onClick;
				element.addEventListener("click", function(e) { //$NON-NLS-0$
					if (dropdown){
						dropdown.close(true);
					}
					onClick.call(commandInvocation.handler, commandInvocation);
				}, false);
				element.addEventListener("keydown", function(e) { //$NON-NLS-0$
					if (e.keyCode === lib.KEY.ENTER || e.keyCode === lib.KEY.SPACE) {
						e.preventDefault(); /* prevents dropdown from receiving event and re-opening */
						element.click();
					}
				}, false);
			}
		}

		if (command.tooltip) {
			/* nested menu items may represent commands, hence require tooltips */
			element.commandTooltip = new Tooltip.Tooltip({
				node: element,
				text: command.tooltip,
				position: ["above", "below", "right", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			});
		}
		
		if (keyBindingString) {
			Dropdown.appendKeyBindingString(element, keyBindingString);
		}
		
		parent.appendChild(li);
		
		if (keyBinding) {
			localKeyBindings[command.id] = { keyBinding: keyBinding, command: command, invocation: commandInvocation };
		}

		return element;
	}
	

	/**
	 * CommandInvocation is a data structure that carries all relevant information about a command invocation.
	 * It represents a unique invocation of a command by the user.  Each time a user invokes a command (by click, keystroke, URL),
	 * a new invocation is passed to the client.
	 * <p>Note:  When retrieving parameters from a command invocation, clients should always use {@link #parameters}
	 * rather than obtaining the parameter object originally specified for the command (using {@link #command}.parameters).
	 * This ensures that the parameter values for a unique invocation are used vs. any default parameters that may have been
	 * specified originally.  Similarly, if a client wishes to store data that will preserved across multiple invocations of a command,
	 * that data can be stored in the original parameters description and a reference maintained by the client.
	 * </p>
	 * 
	 * @name orion.commands.CommandInvocation
	 * @class Carries information about a command invocation.
	 * @param {Object} handler
	 * @param {Array} items
	 * @param {Object} [userData]
	 * @param {orion.commands.Command} command
	 * @param {orion.commandregistry.CommandRegistry} [commandRegistry]
	 */
	/**
	 * @name orion.commands.CommandInvocation#commandRegistry
	 * @type orion.commandregistry.CommandRegistry
	 */
	/**
	 * @name orion.commands.CommandInvocation#handler
	 * @type Object
	 */
	/**
	 * @name orion.commands.CommandInvocation#command
	 * @type orion.commands.Command
	 */
	/**
	 * @name orion.commands.CommandInvocation#items
	 * @type Array
	 */
	/**
	 * @name orion.commands.CommandInvocation#parameters
	 * @type orion.commands.ParametersDescription
	 */
	/**
	 * @name orion.commands.CommandInvocation#userData
	 * @type Object
	 */
	/**
	 * @name orion.commands.CommandInvocation#userData
	 * @type Object
	 */
	function CommandInvocation (handler, items, /* optional */userData, command, /* optional */ commandRegistry) {
		this.commandRegistry = commandRegistry;
		this.handler = handler;
		this.items = items;
		this.userData = userData;
		this.command = command;
		if (command.parameters) {
			this.parameters = command.parameters.makeCopy(); // so that we aren't retaining old values from previous invocations
		}
		this.id = command.id;
	}
	CommandInvocation.prototype = /** @lends orion.commands.CommandInvocation.prototype */ {
		/**
		 * Returns whether this command invocation can collect parameters.
		 * 
		 * @returns {Boolean} whether parameters can be collected
		 */
		collectsParameters: function() {
			return this.commandRegistry && this.commandRegistry.collectsParameters();
		},
	
		/**
		 * Makes and returns a (shallow) copy of this command invocation.
		 * @param {orion.commands.ParametersDescription} parameters A description of parameters to be used in the copy.  Optional.
		 * If not specified, then the existing parameters should be copied.
		 */
		makeCopy: function(parameters) {
			var copy =  new CommandInvocation(this.handler, this.items, this.userData, this.command, this.commandRegistry);
			copy.domNode = this.domNode;
			copy.domParent = this.domParent;
			if (parameters) {
				copy.parameters = parameters.makeCopy();
			} else if (this.parameters) {
				copy.parameters = this.parameters.makeCopy();
			}
			return copy;
		}

	};
	CommandInvocation.prototype.constructor = CommandInvocation;



	/**
	 * Constructs a new command with the given options.
	 * @param {Object} [options] The command options object.
	 * @param {String} [options.id] the unique id to be used when referring to the command in the command service.
	 * @param {String} [options.name] the name to be used when showing the command as text.
	 * @param {String} [options.tooltip] the tooltip description to use when explaining the purpose of the command.
	 * @param {Function} [options.callback] the callback to call when the command is activated.  The callback should either 
	 *  perform the command or return a deferred that represents the asynchronous performance of the command.  Optional.
	 * @param {Function} [options.hrefCallback] if specified, this callback is used to retrieve
	 *  a URL that can be used as the location for a command represented as a hyperlink.  The callback should return 
	 *  the URL.  In this release, the callback may also return a deferred that will eventually return the URL, but this 
	 *  functionality may not be supported in the future.  See https://bugs.eclipse.org/bugs/show_bug.cgi?id=341540.
	 *  Optional.
	 * @param {Function} [options.choiceCallback] a callback which retrieves choices that should be shown in a secondary
	 *  menu from the command itself.  Returns a list of choices that supply the name and image to show, and the callback
	 *  to call when the choice is made.  Optional.
	 * @param {String} [options.imageClass] a CSS class name suitable for showing a background image.  Optional.
	 * @param {Boolean} [options.addImageClassToElement] If true, the image class will be added to the element's
	 *  class list. Otherwise, a span element with the image class is created and appended to the element.  Optional.
	 * @param {String} [options.selectionClass] a CSS class name to be appended when the command button is selected. Optional.
	 * @param {String} [options.spriteClass] an additional CSS class name that can be used to specify a sprite background image.  This
	 *  useful with some sprite generation tools, where imageClass specifies the location in a sprite, and spriteClass describes the
	 *  sprite itself.  Optional.
	 * @param {Function} [options.visibleWhen] A callback that returns a boolean to indicate whether the command should be visible
	 *  given a particular set of items that are selected.  Optional, defaults to always visible.
	 * @param {orion.commands.ParametersDescription} [options.parameters] A description of parameters that should be collected before invoking
	 *  the command.
	 * @param {Image} [options.image] the image that may be used to represent the callback.  A text link will be shown in lieu
	 *  of an image if no image is supplied.  Optional.
	 * @class A command is an object that describes an action a user can perform, as well as when and
	 *  what it should look like when presented in various contexts.  Commands are identified by a
	 *  unique id.
	 * @name orion.commands.Command
	 */
	function Command (options) {
		this._init(options);
	}
	Command.prototype = /** @lends orion.commands.Command.prototype */ {
		_init: function(options) {
			this.id = options.id;  // unique id
			this.name = options.name;
			this.tooltip = options.tooltip;
			this.callback = options.callback; // optional callback that should be called when command is activated (clicked)
			this.preCallback = options.preCallback; // optional callback that should be called when command is activated (clicked)
			this.hrefCallback = options.hrefCallback; // optional callback that returns an href for a command link
			this.choiceCallback = options.choiceCallback; // optional callback indicating that the command will supply secondary choices.  
														// A choice is an object with a name, callback, and optional image
			this.positioningNode = options.positioningNode; // optional positioning node choice command.
			this.image = options.image || NO_IMAGE;
			this.imageClass = options.imageClass;   // points to the location in a sprite
			this.addImageClassToElement = options.addImageClassToElement; // optional boolean if true will add the image class to the 
																		// element's class list
			this.extraClass = options.extraClass;
			this.selectionClass = options.selectionClass;
			this.spriteClass = options.spriteClass || "commandSprite"; // defines the background image containing sprites //$NON-NLS-0$
			this.visibleWhen = options.visibleWhen;
			this.parameters = options.parameters;  // only used when a command is used in the command registry. 
			this.isEditor = options.isEditor;
			this.type = options.type;
			this.checked = options.checked;
			this.track = options.track;
		},
		
		/**
		 * Populate the specified menu with choices using the choiceCallback.
		 * Used internally by the command service.  Not intended to be overridden or called
		 * externally.
		 */
		 populateChoicesMenu: function(parent, items, handler, userData, commandService) {
			var choices = this.getChoices(items, handler, userData);
			var addCheck = choices.some(function(choice) {
				return choice.checked;
			});
			choices.forEach(function(choice) {
				if (choice.name) {
					var itemNode = document.createElement("li"); //$NON-NLS-0$
					parent.appendChild(itemNode);
					var node = document.createElement("span"); //$NON-NLS-0$
					node.tabIndex = 0; 
					node.role = "menuitem"; //$NON-NLS-0$
					node.classList.add("dropdownMenuItem"); //$NON-NLS-0$
					if (addCheck) {
						var check = document.createElement("span"); //$NON-NLS-0$
						check.classList.add("check"); //$NON-NLS-0$
						check.appendChild(document.createTextNode(choice.checked ? "\u25CF" : "")); //$NON-NLS-1$ //$NON-NLS-0$
						node.appendChild(check);
					}
					var text = document.createTextNode(choice.name);
					node.appendChild(text);
					itemNode.appendChild(node);
					node.choice = choice;
					node.addEventListener("click", function(event) { //$NON-NLS-0$
						if (event.target.choice) {
							event.target.choice.callback.call(event.target.choice, items);
						}
					}, false); 
					node.addEventListener("keydown", function(event) { //$NON-NLS-0$
						if (event.keyCode === lib.KEY.ENTER || event.keyCode === lib.KEY.SPACE) {
							if (event.target.choice) {
								event.target.choice.callback.call(event.target.choice, items);
							}
						}
					}, false);
				} else {  // anything not named is a separator
					commandService._generateMenuSeparator(parent);
				}
			});
		},
		
		/**
		 * Get the appropriate choices using the choiceCallback.
		 * Used internally by the command service.  Not intended to be overridden or called
		 * externally.
		 */
		getChoices: function(items, handler, userData) {
			if (this.choiceCallback) {
				return this.choiceCallback.call(handler, items, userData);
			}
			return null;
		},
		
		/**
		 * Make a choice callback appropriate for the given choice and items.
		 * Used internally by the command service.  Not intended to be overridden or called
		 * externally.
		 */
		makeChoiceCallback: function(choice, items) {
			return function(event) {
				if (choice.callback) {
					choice.callback.call(choice, items, event);
				}
			};
		},
		
		/**
		 * Return a boolean indicating whether this command has a specific image associated
		 * with it. Used internally by the command service.  Not intended to be overridden or called
		 * externally.
		 */
		hasImage: function() {
			return this.imageClass || this.image !== NO_IMAGE; //$NON-NLS-0$
		}
	};  // end Command prototype
	Command.prototype.constructor = Command;
	
	//return the module exports
	return {
		Command: Command,
		CommandInvocation: CommandInvocation,
		createDropdownMenu: createDropdownMenu,
		createCheckedMenuItem: createCheckedMenuItem,
		createCommandItem: createCommandItem,
		createCommandMenuItem: createCommandMenuItem,
		executeBinding: executeBinding,
		setKeyBindingProvider: setKeyBindingProvider,
		localKeyBindings: localKeyBindings,
		CommandsProxy: CommandsProxy,
		getKeyBindings: getKeyBindings,
		processKey: processKey,
		NO_IMAGE: NO_IMAGE,
		_testMethodProcessKey: _processKey  // only exported for test cases
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/explorers/explorer',[
	'i18n!orion/nls/messages',
	'orion/webui/littlelib',
	'orion/webui/treetable',
	'orion/explorers/explorerNavHandler',
	'orion/uiUtils',
	'orion/commands'
], function(messages, lib, mTreeTable, mNavHandler, UiUtils, mCommands){

var exports = {};

exports.Explorer = (function() {
	/**
	 * Creates a new explorer.
	 *
	 * @name orion.explorer.Explorer
	 * @class A table-based explorer component.
	 * @param {orion.serviceregistry.ServiceRegistry} serviceRegistry The service registry to
	 * use for any services required by the explorer
	 * @param {orion.selection.Selection} selection The initial selection
	 * @param renderer
	 * @param {orion.commandregistry.CommandRegistry} commandRegistry The command registry to use for commands.  Optional.
	 */
	function Explorer(serviceRegistry, selection, renderer, commandRegistry) {
		this.registry = serviceRegistry;
		this.selection = selection;
		this.commandService = commandRegistry;
		this.setRenderer(renderer);
		
		this.myTree = null;
	}
	Explorer.prototype = /** @lends orion.explorer.Explorer.prototype */ {
	
		setRenderer: function(renderer) {
			if(this.renderer && typeof this.renderer.destroy === "function") { //$NON-NLS-0$
				 this.renderer.destroy();
			}
			this.renderer = renderer;
			if(this.renderer){
				this.renderer.explorer = this;
			}
		},
		destroy: function() {
			if (this._navHandler) {
				this._navHandler.destroy();
			}
			if (this.model) {
				this.model.destroy();
			}
			if (this.myTree) {
				this.myTree.destroy();
			}
			this.destroyed = true;
		},
		
		// we have changed an item on the server at the specified parent node
		changedItem: function(parent, children) {
			if (this.myTree) {
				this.myTree.refresh.bind(this.myTree)(parent, children, true);
			}
		},
		updateCommands: function(item){
			// update the commands in the tree if the tree exists.
			if (this.myTree) {
				this.myTree._renderer.updateCommands.bind(this.myTree._renderer)(item);
			}
		},
		
		makeNewItemPlaceholder: function(item, domId, insertAfter) {
			var placeholder = null;
			var itemRow = this.getRow(item);
			if (itemRow) {
				var parentNode = itemRow.parentNode;
				// make a row and empty column so that the new name appears after checkmarks/expansions
				var tr = document.createElement("tr"); //$NON-NLS-0$
				tr.id = domId+"placeHolderRow"; //$NON-NLS-0$
				tr.classList.add("navRow"); //$NON-NLS-0$
				var td = document.createElement("td"); //$NON-NLS-0$
				td.id = domId+"placeHolderCol"; //$NON-NLS-0$
				td.classList.add("navColumn"); //$NON-NLS-0$
				tr.appendChild(td);
				if (insertAfter) {
					// insert tr after itemRow, i.e. right before itemRow's nextSibling in the parent
					var nextSibling = itemRow.nextSibling;
					parentNode.insertBefore(tr, nextSibling);
				} else {
					// insert tr before itemRow
					parentNode.insertBefore(tr, itemRow);
				}
				
				td.style.paddingLeft = itemRow.firstChild.style.paddingLeft; //itemRow is a <tr>, we want the indentation of its <td>
				
				placeholder = {
					wrapperNode: tr, 
					refNode: td,
					destroyFunction: function() {
						try {
							if (tr && tr.parentNode) {
								tr.parentNode.removeChild(tr);
							}	
						} catch (err) {
							// tr already removed, do nothing
						}
					}
				};
			}
			
			return placeholder;
		},

		getRow: function(item) {
			var rowId = this.model.getId(item);
			if (rowId) {
				return lib.node(rowId);
			}
		},
		
		/**
		 * Collapse all the nodes in the explorer
		 */
		collapseAll: function() {
			var topLevelNodes = this._navHandler.getTopLevelNodes();
			for (var i = 0; i < topLevelNodes.length ; i++){
				this.myTree.collapse(topLevelNodes[i]);
			}
		},
		
		/**
		 * Expand all the nodes under a node in the explorer
		 * @param nodeModel {Object} the node model to be expanded. If not provided the whole tree is expanded recursively
		 */
		expandAll: function(nodeModel) {
			if(nodeModel){
				this._expandRecursively(nodeModel);
			} else {
				if(!this._navHandler){
					return;
				}
				//We already know what the top level children is under the root, from the navigation handler.
				var topLevelNodes = this._navHandler.getTopLevelNodes();
				for (var i = 0; i < topLevelNodes.length ; i++){
					this._expandRecursively(topLevelNodes[i]);
				}
			}
		},
		
		_expandRecursively: function(node){
			//If a node is not expandable, we stop here.
			if(!this._navHandler || !this._navHandler.isExpandable(node)){
				return;
			}
			var that = this;
			this.myTree.expand(node, function(){
				that.model.getChildren(node, function(children){
					if(children === undefined || children === null) {
						return;
					}
					var len = children.length;
					for (var i = 0; i < len ; i++){
						that._expandRecursively(children[i]);
					}
				});
			});
		},
		
		/**
		 * Displays tree table containing filled with data provided by given model
		 * 
		 * @param {String|Element} parentId id of parent dom element, or the element itself
		 * @param {Object} model providing data to display
		 * @param {Object} options optional parameters of the tree(custom indent, onCollapse callback)
		 */
		createTree: function (parentId, model, options){
			parentId = typeof parentId === "string" ? parentId : (parentId.id || parentId); //$NON-NLS-0$
			if(this.selection) {
				this.selection.setSelections([]);
			}
			if(this.getNavHandler()){
				this.getNavHandler()._clearSelection();
			}
			var treeId = parentId + "innerTree"; //$NON-NLS-0$
			var existing = lib.node(treeId);
			if (existing) {
				lib.empty(existing);
			}
			if (model){
				model.rootId = treeId + "Root"; //$NON-NLS-0$
			}
			this.model = model;
			this._parentId = parentId;
			this._treeOptions = options;
			var useSelection = !options || (options && !options.noSelection);
			if(useSelection){
				this.selectionPolicy = options ? options.selectionPolicy : "";
				this._navDict = new mNavHandler.ExplorerNavDict(this.model);
			}
			this.myTree = new mTreeTable.TableTree({
				id: treeId,
				model: model,
				parent: parentId,
				onComplete: options ? options.onComplete : undefined,
				labelColumnIndex: this.renderer.getLabelColumnIndex(),
				renderer: this.renderer,
				showRoot: options ? !!options.showRoot : false,  
				indent: options ? options.indent: undefined,
				preCollapse: options ? options.preCollapse: undefined,
				onCollapse: options ? options.onCollapse: undefined,
				navHandlerFactory: options ? options.navHandlerFactory: undefined,
				tableElement: options ? options.tableElement : undefined,
				tableBodyElement: options ? options.tableBodyElement : undefined,
				tableRowElement: options ? options.tableRowElement : undefined
			});
			this.renderer._initializeUIState();
			if(this.selectionPolicy === "cursorOnly"){ //$NON-NLS-0$
				this.initNavHandler();
			}
		},
		getNavHandler: function(){
			return this._navHandler;
		},
		
		getNavDict: function(){
			return this._navDict;
		},
		
		select: function(item) {
			var navHandler = this.getNavHandler();
			if (navHandler) {
				navHandler.cursorOn(item, true);
				navHandler.setSelection(item);
			}
		},
		
		refreshSelection: function(){
			if(this.selection) {
				var navHandler = this.getNavHandler();
				var selections = [];
				if(navHandler && this.getNavDict()){
					var existingSels = navHandler.getSelection();
					for(var i = 0; i < existingSels.length; i++){
						var rowDiv = navHandler.getRowDiv(existingSels[i]);
						if(rowDiv && rowDiv.parentNode){
							var value = this.getNavDict().getValue(this.model.getId(existingSels[i]));
							if(value.model){
								selections.push(value.model);
							}
						}
					}
				}
				this.selection.setSelections(selections);
			}
		},
		
		getRootPath: function() {
			if (this.model && this.model.root) {
				return this.model.root.Location;
			}
			return null;
		},
		
		initNavHandler: function(){
			var options = this._treeOptions;
			
			var useSelection = !options || (options && !options.noSelection);
			if(!useSelection){
				return;
			}
			if(!this.getNavHandler()){
				if (options && options.navHandlerFactory && typeof options.navHandlerFactory.createNavHandler === "function") { //$NON-NLS-0$
					this._navHandler = options.navHandlerFactory.createNavHandler(this, this._navDict, options);
				} else {
					var getChildrenFunc = options ? options.getChildrenFunc : null;
					this._navHandler = new mNavHandler.ExplorerNavHandler(this, this._navDict, {getChildrenFunc: getChildrenFunc, setFocus: options && options.setFocus, selectionPolicy: (options ? options.selectionPolicy : null)});
				}
			}
			var that = this;
			this.model.getRoot(function(itemOrArray){
				if(itemOrArray instanceof Array){
					that.getNavHandler().refreshModel(that.getNavDict(), that.model, itemOrArray);
				} else if(itemOrArray.children && itemOrArray.children instanceof Array){
					that.getNavHandler().refreshModel(that.getNavDict(), that.model, itemOrArray.children);
				}
				if(options && options.setFocus){
					that.getNavHandler().cursorOn(null, false, false, true);
				}
			});
		},
	    
	    _lastHash: null,
	    checkbox: false
	};
	return Explorer;
}());

/**
 * Creates generic explorer commands, like expand all and collapse all.
 * @param {orion.commands.CommandService} commandService the command service where the commands wil be added
 * @param {Function} visibleWhen optional if not provided we always display the commands
 */
exports.createExplorerCommands = function(commandService, visibleWhen, commandIdExpand, commandIdCollaspe) {
	function isVisible(item){
		if( typeof(item.getItemCount) === "function"){ //$NON-NLS-0$
			if(item.getItemCount() > 0){
				return visibleWhen ? visibleWhen(item) : true; 
			}
			return false;
		}
		return false;
	}
	var expandAllCommand = new mCommands.Command({
		tooltip : messages["Expand all"],
		imageClass : "core-sprite-expandAll", //$NON-NLS-0$
		id: commandIdExpand ? commandIdExpand : "orion.explorer.expandAll", //$NON-NLS-0$
		groupId: "orion.explorerGroup", //$NON-NLS-0$
		visibleWhen : function(item) {
			return isVisible(item);
		},
		callback : function(data) {
			data.items.expandAll();
	}});
	var collapseAllCommand = new mCommands.Command({
		tooltip : messages["Collapse all"],
		imageClass : "core-sprite-collapseAll", //$NON-NLS-0$
		id: commandIdCollaspe ? commandIdCollaspe : "orion.explorer.collapseAll", //$NON-NLS-0$
		groupId: "orion.explorerGroup", //$NON-NLS-0$
		visibleWhen : function(item) {
			return isVisible(item);
		},
		callback : function(data) {
			if(typeof data.items.preCollapseAll === "function") { //$NON-NLS-0$
				data.items.preCollapseAll().then(function (result){
					if(!result) {
						return;
					}
					data.items.collapseAll();
				});
			} else {
				data.items.collapseAll();
			}
	}});
	commandService.addCommand(expandAllCommand);
	commandService.addCommand(collapseAllCommand);
};

exports.ExplorerModel = (function() {
	/**
	 * Creates a new explorer model instance.
	 * @name orion.explorer.ExplorerModel
	 * @class Simple tree model using Children and ChildrenLocation attributes to fetch children
	 * and calculating id based on Location attribute.
	 */
	function ExplorerModel(rootPath, /* function returning promise */fetchItems, idPrefix) {
		this.rootPath = rootPath;
		this.fetchItems = fetchItems;
		this.idPrefix = idPrefix || "";
	}
	ExplorerModel.prototype = /** @lends orion.explorer.ExplorerModel.prototype */{
		destroy: function(){
			this.destroyed = true;
		},
		getRoot: function(onItem){
			var self = this;
			this.fetchItems(this.rootPath).then(function(item){
				self.root = item;
				onItem(item);
			});
		},
		getChildren: function(parentItem, /* function(items) */ onComplete){
			// the parent already has the children fetched
			if (parentItem.Children) {
				onComplete(parentItem.Children);
			} else if (parentItem.ChildrenLocation) {
				this.fetchItems(parentItem.ChildrenLocation).then( 
					function(Children) {
						parentItem.Children = Children;
						onComplete(Children);
					}
				);
			} else {
				onComplete([]);
			}
		},
		getId: function(/* item */ item){
			if (item.Location === this.root.Location) {
				return this.rootId;
			} 
			// first strip slashes so we aren't processing path separators.
			var stripSlashes = item.Location.replace(/[\\\/]/g, "");
			// these id's are used in the DOM, so we can't use characters that aren't valid in DOM id's.
			// However we need a unique substitution string for these characters, so that we don't duplicate id's
			// So we are going to substitute ascii values for invalid characters.
			// See https://bugs.eclipse.org/bugs/show_bug.cgi?id=363062
			
			var id = this.idPrefix;
			for (var i=0; i<stripSlashes.length; i++) {
				if (stripSlashes[i].match(/[^\.\:\-\_0-9A-Za-z]/g)) {
					id += stripSlashes.charCodeAt(i);
				} else {
					id += stripSlashes[i];
				}
			}
			return id;
		}
	};
	return ExplorerModel;
}());

exports.ExplorerFlatModel = (function() {
	/**
	 * Creates a new flat explorer model.
	 * @name orion.explorer.ExplorerFlatModel
	 * @class Tree model used by orion.explorer.Explorer for flat structures
	 * @param {String} rootPath path to load tree table root, response should contain a list of items
	 * @param {Function} fetchItems A function that returns a promise that resolves to the
	 * items at the provided location.
	 */
	function ExplorerFlatModel(rootPath, fetchItems, root) {
		this.rootPath = rootPath;
		this.fetchItems = fetchItems;
		this.root = root;
	}
	
	ExplorerFlatModel.prototype = new exports.ExplorerModel();
	
	ExplorerFlatModel.prototype.getRoot = function(onItem){
		if(this.root){
			onItem(this.root);
		} else {
			var self = this;
			this.fetchItems(this.rootPath).then(function(item){
				self.root = item;
				onItem(item);
			});
		}
	};
	
	ExplorerFlatModel.prototype.getChildren = function(parentItem, /* function(items) */ onComplete){
		if(parentItem === this.root){
			onComplete(this.root);
		}else{
			onComplete([]);
		}
	};
	
	return ExplorerFlatModel;
}());

/********* Rendering json items into columns in the tree **************/
exports.ExplorerRenderer = (function() {
	function ExplorerRenderer (options, explorer) {
		this.explorer = explorer;
		this._init(options);
		this._expandImageClass = "core-sprite-openarrow"; //$NON-NLS-0$
		this._collapseImageClass = "core-sprite-closedarrow"; //$NON-NLS-0$
		this._progressImageClass = "core-sprite-progress"; //$NON-NLS-0$
		this._twistieSpriteClass = "modelDecorationSprite"; //$NON-NLS-0$
	}
	ExplorerRenderer.prototype = {
	
		_init: function(options) {
			if (options) {
				this._useCheckboxSelection = options.checkbox === undefined ? false : options.checkbox;
				this.selectionPolicy = options.singleSelection ? "singleSelection" : "";//$NON-NLS-0$
				this._cachePrefix = options.cachePrefix;
				if (options.getCheckedFunc) {
					this.getCheckedFunc = options.getCheckedFunc;
				}
				if (options.onCheckedFunc) {
					this.onCheckedFunc = options.onCheckedFunc;
				}
				this._noRowHighlighting = options.noRowHighlighting; // Whether to have alternating light/dark rows
				this._highlightSelection = true;
				this._treeTableClass = options.treeTableClass || "treetable";  //$NON-NLS-0$
				if (options.highlightSelection === false){
					this._highlightSelection = false;
				}
				if (!this.actionScopeId) {
					this.actionScopeId = options.actionScopeId;
				}
				if (!this.commandService) {
					this.commandService = options.commandService;
				}
			}
		},
		
		getLabelColumnIndex: function() {
			return this.explorer.checkbox ? 1 : 0;  // 0 if no checkboxes
		}, 
		
		initTable: function (tableNode, tableTree) {
			this.tableTree = tableTree;
			this.tableNode = tableNode;
			lib.empty(tableNode);
			if (this._treeTableClass) {
				tableNode.classList.add(this._treeTableClass); 
			}
			this.renderTableHeader(tableNode);
			var self = this;
			tableNode.onclick = function(evt) {
				var target = evt.target;
				var tableRow = target;
				while (tableRow && tableRow !== tableNode) {
					if (tableRow._item) break;
					tableRow = tableRow.parentNode;
				}
				if (!tableRow) return;
				var expandImage = lib.node(self.expandCollapseImageId(tableRow.id));
				if (!expandImage) return;
				if (expandImage !== target) {
					var item = tableRow._item;
					if (!self.explorer.isRowSelectable || self.explorer.isRowSelectable(item)) {
						if (item.selectable === undefined || item.selectable) return;
					}
					if (UiUtils.isFormElement(target, tableRow)) {
						return;
					}
				}
				if (!self.explorer.getNavHandler().isDisabled(tableRow)) {
					self.tableTree.toggle(tableRow.id);
					var expanded = self.tableTree.isExpanded(tableRow.id);
					if (expanded) {
						self._expanded.push(tableRow.id);
						if (self.explorer.postUserExpand) {
							self.explorer.postUserExpand(tableRow.id);
						}
					} else {
						for (var i in self._expanded) {
							if (self._expanded[i] === tableRow.id) {
								self._expanded.splice(i, 1);
								break;
							}
						}
					}
					var prefPath = self._getUIStatePreferencePath();
					if (prefPath && window.sessionStorage) {
						self._storeExpansions(prefPath);
					}
				}
			};
		},
		getActionsColumn: function(item, tableRow, renderType, columnClass, renderAsGrid){
			renderType = renderType || "tool"; //$NON-NLS-0$
			var actionsColumn = document.createElement('td'); //$NON-NLS-0$
			actionsColumn.id = tableRow.id + "actionswrapper"; //$NON-NLS-0$
			if (columnClass) {
				actionsColumn.classList.add(columnClass);
			}
			// contact the command service to render appropriate commands here.
			if (this.actionScopeId && this.commandService) {
				this.commandService.renderCommands(this.actionScopeId, actionsColumn, item, this.explorer, renderType, null, (renderAsGrid && this.explorer.getNavDict()) ? this.explorer.getNavDict().getGridNavHolder(item, true) : null);
			} else {
				window.console.log("Warning, no command service or action scope was specified.  No commands rendered."); //$NON-NLS-0$
			}
			return actionsColumn;
		},
		initCheckboxColumn: function(tableNode){
			if (this._useCheckboxSelection) {
				var th = document.createElement('th'); //$NON-NLS-0$
				return th;
			}
		},
		getCheckboxColumn: function(item, tableRow){
			if (this._useCheckboxSelection) {
				var checkColumn = document.createElement('td'); //$NON-NLS-0$
				var check = document.createElement("span"); //$NON-NLS-0$
				check.id = this.getCheckBoxId(tableRow.id);
				check.classList.add("core-sprite-check"); //$NON-NLS-0$
				check.classList.add("selectionCheckmarkSprite"); //$NON-NLS-0$
				check.rowId = tableRow.id;
				if(this.getCheckedFunc){
					check.checked = this.getCheckedFunc(item);
					if (check.checked) {
						if(this._highlightSelection){
							tableRow.classList.add("checkedRow"); //$NON-NLS-0$
						}
						check.classList.add("core-sprite-check_on"); //$NON-NLS-0$
					} else {
						if(this._highlightSelection){
							tableRow.classList.remove("checkedRow"); //$NON-NLS-0$
						}
						check.classList.remove("core-sprite-check_on");  //$NON-NLS-0$
					}
				}
				checkColumn.appendChild(check);
				var self = this;
				check.addEventListener("click", function(evt) { //$NON-NLS-0$
					var newValue = evt.target.checked ? false : true;
					self.onCheck(tableRow, evt.target, newValue, true, false, item);
					lib.stop(evt);
				}, false);
				return checkColumn;
			}
		},
		
		getCheckBoxId: function(rowId){
			return rowId + "selectedState"; //$NON-NLS-0$
		},
			
		onCheck: function(tableRow, checkBox, checked, manually, setSelection, item){
			checkBox.checked = checked;
			if (checked) {
				checkBox.classList.add("core-sprite-check_on"); //$NON-NLS-0$
			} else {
				checkBox.classList.remove("core-sprite-check_on"); //$NON-NLS-0$
			}
			if(this.onCheckedFunc){
				this.onCheckedFunc(checkBox.rowId, checked, manually, item);
			}
			if(this.explorer.getNavHandler() && setSelection){
				this.explorer.getNavHandler().setSelection(this.explorer.getNavDict().getValue(tableRow.id).model, true);	
			}
		},
		
		storeSelections: function() {
			if(this.explorer.getNavHandler()){
				var selectionIDs = this.explorer.getNavHandler().getSelectionIds();
				var prefPath = this._getUIStatePreferencePath();
				if (prefPath && window.sessionStorage) {
					window.sessionStorage[prefPath+"selection"] = JSON.stringify(selectionIDs); //$NON-NLS-0$
				}
			}
		},
		
		_restoreSelections: function(prefPath) {
			var navDict = this.explorer.getNavDict();
			var navHandler = this.explorer.getNavHandler();
			if (!navHandler || !navDict || navHandler.getSelectionPolicy() === "cursorOnly") { //$NON-NLS-0$
				return;
			}
			var selections = window.sessionStorage[prefPath+"selection"]; //$NON-NLS-0$
			if (typeof selections === "string") { //$NON-NLS-0$
				if (selections.length > 0) {
					selections = JSON.parse(selections);
				} else {
					selections = null;
				}
			}
			var i;
			if (selections) {
				var selectedItems = [];
				for (i=0; i<selections.length; i++) {
					var wrapper = navDict.getValue(selections[i]);
					if(wrapper && wrapper.rowDomNode && wrapper.model){
						selectedItems.push(wrapper.model);
						if(this._highlightSelection){
							wrapper.rowDomNode.classList.add("checkedRow"); //$NON-NLS-0$
						}
						var check = lib.node(this.getCheckBoxId(wrapper.rowDomNode.id));
						if (check) {
							check.checked = true;
							check.classList.add("core-sprite-check_on"); //$NON-NLS-0$
						}
					}
				}
				// notify the selection service of our new selections
				if(this.explorer.selection) {
					this.explorer.selection.setSelections(selectedItems);
					if(this.explorer.getNavHandler()){
						this.explorer.getNavHandler().refreshSelection();
					}
				}
			}	
		},
		
		_storeExpansions: function(prefPath) {
			window.sessionStorage[prefPath+"expanded"] = JSON.stringify(this._expanded); //$NON-NLS-0$
		},
		
		// returns true if the selections also need to be restored.
		_restoreExpansions: function(prefPath) {
			var didRestoreSelections = false;
			var expanded = window.sessionStorage[prefPath+"expanded"]; //$NON-NLS-0$
			if (typeof expanded=== "string") { //$NON-NLS-0$
				if (expanded.length > 0) {
					expanded= JSON.parse(expanded);
				} else {
					expanded = null;
				}
			}
			var i;
			if (expanded) {
				for (i=0; i<expanded.length; i++) {
					var row= lib.node(expanded[i]);
					if (row) {
						this._expanded.push(expanded[i]);
						// restore selections after expansion in case an expanded item was selected.
						var self = this;
						this.tableTree.expand(expanded[i], function() {
							self._restoreSelections(prefPath);
						});
						didRestoreSelections = true;
					}
				}
			}
			return !didRestoreSelections;
		},
		
		_getUIStatePreferencePath: function() {
			if (this.explorer) {
				var rootPath = this.explorer.getRootPath();
				if (this._cachePrefix && rootPath) {
					var rootSegmentId = rootPath.replace(/[^\.\:\-\_0-9A-Za-z]/g, "");
					return "/" + this._cachePrefix + "/" + rootSegmentId + "/uiState"; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				}
			}
			return null;
						
		},
		
		expandCollapseImageId: function(rowId) {
			return rowId+"__expand"; //$NON-NLS-0$
		},
		
		updateExpandVisuals: function(tableRow, isExpanded) {
			var expandImage = lib.node(this.expandCollapseImageId(tableRow.id));
			if (expandImage) {
				expandImage.classList.remove(this._expandImageClass);
				expandImage.classList.remove(this._collapseImageClass);
				expandImage.classList.remove(this._progressImageClass);
				expandImage.classList.add(isExpanded === "progress" ? this._progressImageClass : isExpanded ? this._expandImageClass : this._collapseImageClass); //$NON-NLS-0$
			}
		},

		/**
		 * Appends the image node with expand/collapse behavior
		 * @param {Element} tableRow
		 * @param {Element} placeHolder
		 * @param {String} decorateImageClass
		 * @param {String} spriteClass
		 * @returns {Element} The image node
		 */
		getExpandImage: function(tableRow, placeHolder, /* optional extra decoration */ decorateImageClass, /* optional sprite class for extra decoration */ spriteClass){
			var expandImage = document.createElement("span"); //$NON-NLS-0$
			expandImage.id = this.expandCollapseImageId(tableRow.id);
			placeHolder.appendChild(expandImage);
			expandImage.classList.add(this._twistieSpriteClass);
			expandImage.classList.add(this._collapseImageClass);
			if (decorateImageClass) {
				var decorateImage = document.createElement("span"); //$NON-NLS-0$
				placeHolder.appendChild(decorateImage);
				decorateImage.classList.add(spriteClass || "imageSprite"); //$NON-NLS-0$
				decorateImage.classList.add(decorateImageClass);
			}
			return expandImage;
		},
		
		render: function(item, tableRow){
			tableRow.classList.add("navRow"); //$NON-NLS-0$
			this.renderRow(item, tableRow);
		},
		
		rowsChanged: function() {
			// notify the selection service of the change in state.
			if(this.explorer.selectionPolicy !== "cursorOnly"){ //$NON-NLS-0$
				this.explorer.refreshSelection();
				this.explorer.initNavHandler();			
			}
			if (!this._noRowHighlighting){
				var even = "darkSectionTreeTableRow"; //$NON-NLS-0$
				var odd = "lightSectionTreeTableRow"; //$NON-NLS-0$
				if(lib.$(".sectionTreeTable", this.tableNode.parentNode) || lib.$(".treetable", this.tableNode.parentNode)) { //$NON-NLS-1$ //$NON-NLS-0$
					lib.$$array(".treeTableRow", this.tableNode).forEach(function(node, i) { //$NON-NLS-0$
						var on = (!(i % 2)) ? odd : even;
						var off = (on === odd) ? even : odd;
						node.classList.add(on);
						node.classList.remove(off);
					});
				}
			}
		},
		updateCommands: function(){
			if (this.commandService) {
				var rows = lib.$$array(".treeTableRow"); //$NON-NLS-0$
				for (var i=0; i<rows.length; i++) {
					var node = rows[i];			
					var actionsWrapperId = node.id + "actionswrapper"; //$NON-NLS-0$
					var actionsWrapper = lib.node(actionsWrapperId);
					this.commandService.destroy(actionsWrapper);
					// contact the command service to render appropriate commands here.
					if (this.actionScopeId) {
						this.commandService.renderCommands(this.actionScopeId, actionsWrapper, node._item, this.explorer, "tool"); //$NON-NLS-0$
					}
				}
			}
		},
		
		_initializeUIState: function() {
			this._expanded = [];
			var prefsPath = this._getUIStatePreferencePath();
			if (prefsPath && window.sessionStorage) {
				if (this._restoreExpansions(prefsPath)) {
					this._restoreSelections(prefsPath);
				}
			}
		}
	};
	return ExplorerRenderer;
}());

/**
 * @name orion.explorer.SelectionRenderer
 * @class This  renderer renders a tree table and installs a selection and cursoring model to
 * allow the user to make selections without using checkboxes.
 * Override {@link orion.explorer.SelectionRenderer#getCellHeaderElement}  and
 * {@link orion.explorer.SelectionRenderer#getCellElement} to generate table content.
 */
exports.SelectionRenderer = (function(){
	/**
	 * Create a selection renderer with the specified options.  Options are defined in
	 * ExplorerRenderer.  An additional option is added here.
	 * @param {Boolean}singleSelection If true, set the selection policy to "singleSelection".
	 *
	 */
	function SelectionRenderer(options, explorer) {
		this._init(options);
		this.explorer = explorer;
	}
	SelectionRenderer.prototype = new exports.ExplorerRenderer();

	SelectionRenderer.prototype.renderTableHeader = function(tableNode){
		var thead = document.createElement('thead'); //$NON-NLS-0$
		var row = document.createElement('tr'); //$NON-NLS-0$
		thead.classList.add("navTableHeading"); //$NON-NLS-0$
		if (this._useCheckboxSelection) {
			row.appendChild(this.initCheckboxColumn(tableNode));
		}
		
		var i = 0;
		var cell = this.getCellHeaderElement(i);
		while(cell){
			if (cell.innerHTML.length > 0) {
				cell.classList.add("navColumn"); //$NON-NLS-0$
			}
			row.appendChild(cell);			
			cell = this.getCellHeaderElement(++i);
		}
		thead.appendChild(row);
		if (i > 0) {
			tableNode.appendChild(thead);
		}
	};
	
	SelectionRenderer.prototype.initSelectableRow = function(item, tableRow) {
		var self = this;
		tableRow.addEventListener("click", function(evt) { //$NON-NLS-0$
			if(self.explorer.getNavHandler()){
				self.explorer.getNavHandler().onClick(item, evt);
			}
		}, false);
	};
	
	SelectionRenderer.prototype.renderRow = function(item, tableRow) {
		tableRow.verticalAlign = "baseline"; //$NON-NLS-0$
		tableRow.classList.add("treeTableRow"); //$NON-NLS-0$

		var navDict = this.explorer.getNavDict();
		if(navDict){
			if (this.explorer.selectionPolicy !== "cursorOnly") { //$NON-NLS-0$
				tableRow.classList.add("selectableNavRow"); //$NON-NLS-0$
			}
			
			navDict.addRow(item, tableRow);
		}
		if (item.selectable === undefined || item.selectable) {
			var checkColumn = this.getCheckboxColumn(item, tableRow);
			if(checkColumn) {
				checkColumn.classList.add('checkColumn'); //$NON-NLS-0$
				tableRow.appendChild(checkColumn);
			}
		}

		var i = 0;
		var cell = this.getCellElement(i, item, tableRow);
		while(cell){
			tableRow.appendChild(cell);
			if (i===0) {
				if(this.getPrimColumnStyle){
					cell.classList.add(this.getPrimColumnStyle(item)); //$NON-NLS-0$
				} else {
					cell.classList.add("navColumn"); //$NON-NLS-0$
				}
			} else {
				if(this.getSecondaryColumnStyle){
					cell.classList.add(this.getSecondaryColumnStyle()); //$NON-NLS-0$
				} else {
					cell.classList.add("secondaryColumn"); //$NON-NLS-0$
				}
			}
			cell = this.getCellElement(++i, item, tableRow);
		}
	};

	/**
	 * Override to return a dom element containing table header, preferably <code>th</code>
	 * @name orion.explorer.SelectionRenderer#getCellHeaderElement
	 * @function
	 * @param col_no number of column
	 */
	SelectionRenderer.prototype.getCellHeaderElement = function(col_no){};

	/**
	 * Override to return a dom element containing table cell, preferable <code>td</code>
	 * @name orion.explorer.SelectionRenderer#getCellElement
	 * @function
	 * @param col_no number of column
	 * @param item item to be rendered
	 * @param tableRow the current table row
	 */
	SelectionRenderer.prototype.getCellElement = function(col_no, item, tableRow){};
	
	return SelectionRenderer;
}());

exports.SimpleFlatModel = (function() {	
	/**
	 * Creates a new flat model based on an array of items already known.
	 *
	 * @name orion.explorer.SimpleFlatModel
	 * @param {Array} items the items in the model
	 * @param {String} idPrefix string used to prefix generated id's
	 * @param {Function} getKey function used to get the property name used for generating an id in the model
	 */
	function SimpleFlatModel(items, idPrefix, getKey) {
		this.items = items;
		this.getKey = getKey;
		this.idPrefix = idPrefix;
		this.root = {children: items};
	}
	
	SimpleFlatModel.prototype = new exports.ExplorerModel();
		
	SimpleFlatModel.prototype.getRoot = function(onItem){
		onItem(this.root);
	};
	
	SimpleFlatModel.prototype.getId = function(/* item */ item){
		var key = this.getKey(item);
		// this might be a path, so strip slashes
		var stripSlashes = key.replace(/[\\\/]/g, "");
		var id = "";
		for (var i=0; i<stripSlashes.length; i++) {
			if (stripSlashes[i].match(/[^\.\:\-\_0-9A-Za-z]/g)) {
				id += stripSlashes.charCodeAt(i);
			} else {
				id += stripSlashes[i];
			}
		}
		return this.idPrefix + id;
	};
		
	SimpleFlatModel.prototype.getChildren = function(parentItem, /* function(items) */ onComplete){
		if(parentItem === this.root){
			onComplete(this.items);
		}else{
			onComplete([]);
		}
	};
	return SimpleFlatModel;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/nls/messages',{
	root: {//Default message bundle
		"CpCurChangeRightToLeft": "Copy current change from right to left",
		"CpCurChangeLeftToRight": "Copy current change from left to right",
		"Switch to unified diff": "Switch to unified diff",
		"Unified": "Unified",
		"Switch to side by side diff": "Switch to side by side diff",
		"Side by side": "Side by side",
		"GenerateCurDiffLink": "Generate link of the current diff",
		"Generate Link": "Generate Link",
		"Next diff block": "Next diff block",
		"Previous diff block": "Previous diff block",
		"Next diff change": "Next diff change",
		"Previous diff change": "Previous diff change",
		"Copy the link URL:": "Copy the link URL:",
		"Compare": "Compare",
		"Open the compare page": "Open the compare page",
		"fetching...": "fetching...",
		"There are unsaved changes.": "There are unsaved changes.",
		"ERROR: ": "ERROR: ",
		"Compare...": "Compare...",
		"files changed": " files changed",
		"Location": "Location",
		"Options": "Options",
		"Sort by folders": "Sort by folders",
		"Line 0 : Col 0": "Line 0 : Col 0",
		"NoDiffServiceLocationMatched": "No Matching DiffService for location:",
		"NoFoldersIdentical": "${0} files compared. The two folders are identical.",
		'generatingTreeResult': 'Generating compare result...',  //$NON-NLS-0$  //$NON-NLS-1$
		'fetchingFolder': 'Fetching folder: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
		'readingFile': 'Reading file: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
		'readingFileMetadata': 'Reading file metadata: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
		'comparingFile': 'Comparing: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
		'compareTreeTitle': 'Compare Folders',  //$NON-NLS-0$  //$NON-NLS-1$
		'IgnoreWhitespace': 'Ignore white space', //$NON-NLS-0$  //$NON-NLS-1$
		'IgnoreWhitespaceTooltip': 'Ignore white space where applicable', //$NON-NLS-0$  //$NON-NLS-1$
		'UseWhitespace': 'Use white space', //$NON-NLS-0$  //$NON-NLS-1$
		'UseWhitespaceTooltip': 'Compare white space where applicable', //$NON-NLS-0$  //$NON-NLS-1$
		'confirmUnsavedChanges': 'There are unsaved changes. Do you want to save them?' //$NON-NLS-1$ //$NON-NLS-0$
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/ja/messages',{
	"CpCurChangeRightToLeft": "右から左へ現在の変更をコピーします",
	"CpCurChangeLeftToRight": "左から右へ現在の変更をコピーします",
	"Switch to unified diff": "diff を縦並びに表示します",
	"Unified": "縦並び",
	"Switch to side by side diff": "diff を横並びに表示します",
	"Side by side": "横並び",
	"GenerateCurDiffLink": "現在の diff の リンクを生成します",
	"Generate Link": "リンクの生成",
	"Next diff block": "次の diff ブロック",
	"Previous diff block": "前の diff ブロック",
	"Next diff change": "次の diff の変更",
	"Previous diff change": "前の diff の変更",
	"Copy the link URL:": "リンク URL のコピー:",
	"Compare": "比較",
	"Open the compare page": "比較ページを開きます",
	"fetching...": "取り出し中...",
	"There are unsaved changes.": "保存されていない変更があります。",
	"ERROR: ": "エラー: ",
	"Compare...": "比較...",
	"files changed": " ファイルは変更されました",
	"Location": "ロケーション",
	"Options": "オプション",
	"Sort by folders": "フォルダーでソートします",
	"Line 0 : Col 0": "0 行 : 0 列",
	"NoDiffServiceLocationMatched": "ロケーションの一致する DiffService がありません:",
	"NoFoldersIdentical": "${0} ファイルが比較されました。2 つのフォルダーは同一です。",
	'generatingTreeResult': '比較結果を生成中...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'フォルダーの取り出し中: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'ファイルの読み取り中: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'ファイル・メタデータの読み取り中: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': '比較中: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': '比較フォルダー',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': '空白を無視', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': '空白を可能な限り無視する', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': '空白を使用', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': '空白を可能な限り比較する', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '保存されていない変更があります。 保存しますか?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/zh/messages',{
	"CpCurChangeRightToLeft": "将当前更改从右边复制到左边",
	"CpCurChangeLeftToRight": "将当前更改从左边复制到右边",
	"Switch to unified diff": "切换到统一差别",
	"Unified": "统一",
	"Switch to side by side diff": "切换到并排差别",
	"Side by side": "并排",
	"GenerateCurDiffLink": "生成当前差别的链接",
	"Generate Link": "生成链接",
	"Next diff block": "下一个差别块",
	"Previous diff block": "前一个差别块",
	"Next diff change": "下一个差别更改",
	"Previous diff change": "前一个差别更改",
	"Copy the link URL:": "复制链接 URL：",
	"Compare": "比较",
	"Open the compare page": "打开比较页面",
	"fetching...": "正在访存...",
	"There are unsaved changes.": "存在未保存的更改。",
	"ERROR: ": "错误：",
	"Compare...": "比较...",
	"files changed": " 文件更改",
	"Location": "位置",
	"Options": "选项",
	"Sort by folders": "按文件夹排序",
	"Line 0 : Col 0": "第 0 行：第 0 列",
	"NoDiffServiceLocationMatched": "以下位置没有相匹配的 DiffService：",
	"NoFoldersIdentical": "已对 ${0} 个文件进行比较。这两个文件夹完全相同。",
	'generatingTreeResult': '正在生成比较结果...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': '正在访存文件夹：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': '正在读取文件：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': '正在读取文件元数据：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': '正在比较：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': '比较文件夹',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': '忽略空格', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': '适当时忽略空格', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': '使用空格', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': '适当时比较空格', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '存在未保存的更改。要保存这些更改吗？' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/zh-tw/messages',{
	"CpCurChangeRightToLeft": "由右向左複製現行變更",
	"CpCurChangeLeftToRight": "由左向右複製現行變更",
	"Switch to unified diff": "切換至統一差異",
	"Unified": "統一",
	"Switch to side by side diff": "切換至並列差異",
	"Side by side": "並列",
	"GenerateCurDiffLink": "產生現行差異的鏈結",
	"Generate Link": "產生鏈結",
	"Next diff block": "下一個差異區塊",
	"Previous diff block": "上一個差異區塊",
	"Next diff change": "下一個差異變更",
	"Previous diff change": "上一個差異變更",
	"Copy the link URL:": "複製鏈結 URL：",
	"Compare": "比較",
	"Open the compare page": "開啟比較頁面",
	"fetching...": "正在提取...",
	"There are unsaved changes.": "有未儲存的變更。",
	"ERROR: ": "錯誤： ",
	"Compare...": "比較...",
	"files changed": " 檔案變更",
	"Location": "位置",
	"Options": "選項",
	"Sort by folders": "依資料夾排序",
	"Line 0 : Col 0": "行 0 ：欄 0",
	"NoDiffServiceLocationMatched": "位置沒有相符合的 DiffService：",
	"NoFoldersIdentical": "比較了 ${0} 個檔案。 有兩個資料夾相同。",
	'generatingTreeResult': '正在產生比較結果...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': '正在提取資料夾：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': '正在讀取檔案：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': '正在讀取檔案 meta 資料：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': '正在比較：${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': '比較資料夾',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': '忽略空格', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': '在適當處忽略空格', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': '使用空格', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': '在適當處比較空格', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': '有未儲存的變更。您要儲存它們嗎？' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/fr/messages',{
	"CpCurChangeRightToLeft": "Copier le changement en cours de droite à gauche",
	"CpCurChangeLeftToRight": "Copier le changement en cours de gauche à droite",
	"Switch to unified diff": "Basculer vers le fichier diff unifié",
	"Unified": "Unifié",
	"Switch to side by side diff": "Basculer vers le fichier diff juxtaposé",
	"Side by side": "Juxtaposé",
	"GenerateCurDiffLink": "Générer le lien du fichier diff en cours",
	"Generate Link": "Générer un lien",
	"Next diff block": "Bloc diff suivant",
	"Previous diff block": "Bloc diff précédent",
	"Next diff change": "Changement diff suivant",
	"Previous diff change": "Changement diff précédent",
	"Copy the link URL:": "Copier le lien d'URL :",
	"Compare": "Comparer",
	"Open the compare page": "Ouvrir la page de comparaison",
	"fetching...": "extraction...",
	"There are unsaved changes.": "Certaines modifications n'ont pas été sauvegardées.",
	"ERROR: ": "ERREUR : ",
	"Compare...": "Comparer...",
	"files changed": " fichiers modifiés",
	"Location": "Emplacement",
	"Options": "Options",
	"Sort by folders": "Trier par dossier",
	"Line 0 : Col 0": "Ligne 0 : Col 0",
	"NoDiffServiceLocationMatched": "Aucun service diff ne correspond à l'emplacement :",
	"NoFoldersIdentical": "${0} fichiers comparés. Les deux dossiers sont identiques.",
	'generatingTreeResult': 'Génération du résultat de comparaison...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'Extraction du dossier : ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'Lecture du fichier : ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'Lecture des métadonnées du fichier : ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': 'Comparaison : ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': 'Comparer les dossiers',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': 'Ignorer les espaces', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': 'Ignorer les espaces le cas échéant', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': 'Utiliser un espace', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': 'Comparer l\'espace si applicable', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Certaines modifications n\'ont pas été sauvegardées. Voulez-vous les sauvegarder ?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/de/messages',{
	"CpCurChangeRightToLeft": "Aktuelle Änderung von rechts nach links kopieren",
	"CpCurChangeLeftToRight": "Aktuelle Änderung von links nach rechts kopieren",
	"Switch to unified diff": "Zu einheitlicher Differenz umschalten",
	"Unified": "Beides",
	"Switch to side by side diff": "Zu nebeneinanderliegender Differenz umschalten",
	"Side by side": "Nebeneinander",
	"GenerateCurDiffLink": "Link der aktuellen Differenz generieren",
	"Generate Link": "Link generieren",
	"Next diff block": "Nächster Differenzblock",
	"Previous diff block": "Vorheriger Differenzblock",
	"Next diff change": "Nächste Differenzänderung",
	"Previous diff change": "Vorherige Differenzänderung",
	"Copy the link URL:": "Link-URL kopieren:",
	"Compare": "Vergleichen",
	"Open the compare page": "Vergleichsseite öffnen",
	"fetching...": "Abruf läuft...",
	"There are unsaved changes.": "Nicht gespeicherte Änderungen vorhanden.",
	"ERROR: ": "FEHLER: ",
	"Compare...": "Vergleichen...",
	"files changed": " Dateien geändert",
	"Location": "Position",
	"Options": "Optionen",
	"Sort by folders": "Nach Ordnern sortieren",
	"Line 0 : Col 0": "Zeile 0 : Spalte 0",
	"NoDiffServiceLocationMatched": "Kein übereinstimmender DiffService für Position:",
	"NoFoldersIdentical": "${0} Dateien verglichen. Die zwei Ordner sind identisch.",
	'generatingTreeResult': 'Ergebnis des Vergleichs wird generiert...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'Ordner wird angerufen: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'Datei wird gelesen: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'Dateimetadaten werden gelesen: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': 'Vergleichen von: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': 'Ordner vergleichen',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': 'Leerzeichen ignorieren', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': 'Leerzeichen soweit zutreffend ignorieren', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': 'Leerzeichen verwenden', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': 'Leerzeichen soweit zutreffend vergleichen', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Nicht gespeicherte Änderungen vorhanden. Möchten Sie sie speichern?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/it/messages',{
	"CpCurChangeRightToLeft": "Copia la modifica corrente da destra a sinistra",
	"CpCurChangeLeftToRight": "Copia la modifica corrente da sinistra a destra",
	"Switch to unified diff": "Passa alla differenza unificata",
	"Unified": "Unificata",
	"Switch to side by side diff": "Passa alla differenza lato per lato",
	"Side by side": "Lato per lato",
	"GenerateCurDiffLink": "Genera collegamento della differenza corrente",
	"Generate Link": "Genera collegamento",
	"Next diff block": "Blocco differenza successivo",
	"Previous diff block": "Blocco differenza precedente",
	"Next diff change": "Modifica differenza successiva",
	"Previous diff change": "Modifica differenza precedente",
	"Copy the link URL:": "Copia URL di collegamento:",
	"Compare": "Confronta",
	"Open the compare page": "Apri la pagina di confronto",
	"fetching...": "richiamo dati...",
	"There are unsaved changes.": "Esistono modifiche non salvate.",
	"ERROR: ": "ERRORE: ",
	"Compare...": "Confronto in corso...",
	"files changed": " file modificati",
	"Location": "Ubicazione",
	"Options": "Opzioni",
	"Sort by folders": "Ordina per cartelle",
	"Line 0 : Col 0": "Riga 0 : Colonna 0",
	"NoDiffServiceLocationMatched": "Nessun DiffService corrispondente per la posizione:",
	"NoFoldersIdentical": "${0} file confrontati. Le due cartelle sono identiche.",
	'generatingTreeResult': 'Generazione risultato confronto...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'Richiamo cartella: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'Lettura file: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'Lettura metadati del file: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': 'Confronto: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': 'Confronta cartelle',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': 'Ignora spazio vuoto', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': 'Ignora spazi quando applicabile', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': 'Usa spazio vuoto', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': 'Confronta spazio vuoto dove applicabile', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Esistono modifiche non salvate. Salvarle?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/es/messages',{
	"CpCurChangeRightToLeft": "Copiar cambio actual de derecha a izquierda",
	"CpCurChangeLeftToRight": "Copiar cambio actual de izquierda a derecha",
	"Switch to unified diff": "Cambiar a diferencia unificada",
	"Unified": "Unificado",
	"Switch to side by side diff": "Cambiar a diferencia en paralelo",
	"Side by side": "En paralelo",
	"GenerateCurDiffLink": "Generar enlace de la diferencia actual",
	"Generate Link": "Generar enlace",
	"Next diff block": "Bloque de diferencias siguiente",
	"Previous diff block": "Bloque de diferencias anterior",
	"Next diff change": "Cambio de diferencia siguiente",
	"Previous diff change": "Cambio de diferencia anterior",
	"Copy the link URL:": "Copiar el URL del enlace:",
	"Compare": "Comparar",
	"Open the compare page": "Abrir la página de comparación",
	"fetching...": "extrayendo...",
	"There are unsaved changes.": "Hay cambios no guardados.",
	"ERROR: ": "ERROR: ",
	"Compare...": "Comparar...",
	"files changed": " archivos cambiados",
	"Location": "Ubicación",
	"Options": "Opciones",
	"Sort by folders": "Ordenar por carpetas",
	"Line 0 : Col 0": "Línea 0 : Columna 0",
	"NoDiffServiceLocationMatched": "No hay DiffService coincidente para la ubicación:",
	"NoFoldersIdentical": "${0} archivos comparados. Las dos carpetas son idénticas.",
	'generatingTreeResult': 'Generando resultado de comparación...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'Captando carpeta: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'Leyendo archivo: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'Leyendo metadatos de archivo: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': 'Comparando: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': 'Comparar carpetas',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': 'Ignorar espacio en blanco', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': 'Omitir espacio en blanco cuando proceda', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': 'Utilizar espacio en blanco', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': 'Comparar espacio en blanco cuando proceda', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Hay cambios no guardados. ¿Desea guardarlos?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/compare/nls/pt-br/messages',{
	"CpCurChangeRightToLeft": "Copiar a alteração atual da direita para a esquerda.",
	"CpCurChangeLeftToRight": "Copiar a mudança atual da esquerda para a direita",
	"Switch to unified diff": "Alternar para dif unificada",
	"Unified": "Unificado(a)",
	"Switch to side by side diff": "Alternar para dif de lado a lado",
	"Side by side": "Lado a lado",
	"GenerateCurDiffLink": "Gerar link da dif atual",
	"Generate Link": "Gerar Link",
	"Next diff block": "Próximo bloco de dif",
	"Previous diff block": "Bloco de dif anteriork",
	"Next diff change": "Próxima alteração de dif",
	"Previous diff change": "Alteração de dif anterior",
	"Copy the link URL:": "Copiar a URL do link:",
	"Compare": "Comparação",
	"Open the compare page": "Abrir a página de comparação",
	"fetching...": "buscando...",
	"There are unsaved changes.": "Há mudanças não salvas.",
	"ERROR: ": "ERRO: ",
	"Compare...": "Comparar...",
	"files changed": " arquivos alterados",
	"Location": "Localização",
	"Options": "Opções",
	"Sort by folders": "Classificar por pastas",
	"Line 0 : Col 0": "Linha 0 : Col 0",
	"NoDiffServiceLocationMatched": "Nenhum DiffService correspondente para localização",
	"NoFoldersIdentical": "${0} arquivos comparados. As duas pastas são idênticas.",
	'generatingTreeResult': 'Gerando resultado de comparação...',  //$NON-NLS-0$  //$NON-NLS-1$
	'fetchingFolder': 'Buscando pasta: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFile': 'Lendo arquivo: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'readingFileMetadata': 'Lendo metadados do arquivo: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'comparingFile': 'Comparando: ${0}...',  //$NON-NLS-0$  //$NON-NLS-1$
	'compareTreeTitle': 'Comparar pastas',  //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespace': 'Ignorar espaço em branco', //$NON-NLS-0$  //$NON-NLS-1$
	'IgnoreWhitespaceTooltip': 'Ignorar espaço em branco onde aplicável', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespace': 'Usar espaço em branco', //$NON-NLS-0$  //$NON-NLS-1$
	'UseWhitespaceTooltip': 'Comparar espaço em branco onde aplicável', //$NON-NLS-0$  //$NON-NLS-1$
	'confirmUnsavedChanges': 'Há mudanças não salvas. Deseja salvá-las?' //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/keyBinding", ['orion/util'], function(util) { //$NON-NLS-1$ //$NON-NLS-0$

    /**
	 * @class A KeyBinding is an interface used to define keyboard shortcuts.
	 * @name orion.KeyBinding
	 * 
	 * @property {Function} match The function to match events.
	 * @property {Function} equals The funtion to compare to key bindings.
	 *
	 * @see orion.KeyStroke
	 * @see orion.KeySequence
	 */

	/**
	 * Constructs a new key stroke with the given key code, modifiers and event type.
	 * 
	 * @param {String|Number} keyCode the key code.
	 * @param {Boolean} mod1 the primary modifier (usually Command on Mac and Control on other platforms).
	 * @param {Boolean} mod2 the secondary modifier (usually Shift).
	 * @param {Boolean} mod3 the third modifier (usually Alt).
	 * @param {Boolean} mod4 the fourth modifier (usually Control on the Mac).
	 * @param {String} type the type of event that the keybinding matches; either "keydown" or "keypress".
	 * 
	 * @class A KeyStroke represents of a key code and modifier state that can be triggered by the user using the keyboard.
	 * @name orion.KeyStroke
	 * 
	 * @property {String|Number} keyCode The key code.
	 * @property {Boolean} mod1 The primary modifier (usually Command on Mac and Control on other platforms).
	 * @property {Boolean} mod2 The secondary modifier (usually Shift).
	 * @property {Boolean} mod3 The third modifier (usually Alt).
	 * @property {Boolean} mod4 The fourth modifier (usually Control on the Mac).
	 * @property {String} [type=keydown] The type of event that the keybinding matches; either "keydown" or "keypress"
	 *
	 * @see orion.editor.TextView#setKeyBinding
	 */
	function KeyStroke (keyCode, mod1, mod2, mod3, mod4, type) {
		this.type = type || "keydown"; //$NON-NLS-0$
		if (typeof(keyCode) === "string" && this.type === "keydown") { //$NON-NLS-1$ //$NON-NLS-0$
			this.keyCode = keyCode.toUpperCase().charCodeAt(0);
		} else {
			this.keyCode = keyCode;
		}
		this.mod1 = mod1 !== undefined && mod1 !== null ? mod1 : false;
		this.mod2 = mod2 !== undefined && mod2 !== null ? mod2 : false;
		this.mod3 = mod3 !== undefined && mod3 !== null ? mod3 : false;
		this.mod4 = mod4 !== undefined && mod4 !== null ? mod4 : false;
	}
	KeyStroke.prototype = /** @lends orion.KeyStroke.prototype */ {
		getKeys: function() {
			return [this];
		},
		/**
		 * Determines either this key stroke matches the specifed event.  It can match either a
		 * a whole sequence of key events or a single key event at a specified index.
		 * <p>
		 * <code>KeyStroke</code> only matches single key events. <code>KeySequence</code> handles
		 * matching a sequence of events.
		 * </p>
		 * TODO explain this better
		 * 
		 * @param {DOMEvent|DOMEvent[]} e the key event or list of events to match.
		 * @param index the key event to match.
		 * @returns {Boolean} <code>true</code> whether the key binding matches the key event.
		 *
		 * @see orion.KeySequence#match
		 */
		match: function (e, index) {
			if (index !== undefined) {
				if (index !== 0) {
					return false;
				}
			} else {
				if (e instanceof Array) {
					if (e.length > 1) {
						return false;
					}
					e = e[0];
				}
			}
			if (e.type !== this.type) {
				return false;
			}
			if (this.keyCode === e.keyCode || this.keyCode === String.fromCharCode(util.isOpera ? e.which : (e.charCode !== undefined ? e.charCode : e.keyCode))) {
				var mod1 = util.isMac ? e.metaKey : e.ctrlKey;
				if (this.mod1 !== mod1) { return false; }
				if (this.type === "keydown") { //$NON-NLS-0$
					if (this.mod2 !== e.shiftKey) { return false; }
				}
				if (this.mod3 !== e.altKey) { return false; }
				if (util.isMac && this.mod4 !== e.ctrlKey) { return false; }
				return true;
			}
			return false;
		},
		/**
		 * Returns whether this key stroke is the same as the given parameter.
		 * 
		 * @param {orion.KeyBinding} kb the key binding to compare with.
		 * @returns {Boolean} whether or not the parameter and the receiver describe the same key binding.
		 */
		equals: function(kb) {
			if (!kb) { return false; }
			if (this.keyCode !== kb.keyCode) { return false; }
			if (this.mod1 !== kb.mod1) { return false; }
			if (this.mod2 !== kb.mod2) { return false; }
			if (this.mod3 !== kb.mod3) { return false; }
			if (this.mod4 !== kb.mod4) { return false; }
			if (this.type !== kb.type) { return false; }
			return true;
		} 
	};
	
	/**
	 * Constructs a new key sequence with the given key strokes.
	 * 
	 * @param {orion.KeyStroke[]} keys the key strokes for this sequence.
	 * 
	 * @class A KeySequence represents of a list of key codes and a modifiers state that can be triggered by the user using the keyboard.
	 * @name orion.KeySequence
	 * 
	 * @property {orion.KeyStroke[]} keys the list of key strokes.
	 *
	 * @see orion.editor.TextView#setKeyBinding
	 */
	function KeySequence (keys) {
		this.keys = keys;
	}
	KeySequence.prototype = /** @lends orion.KeySequence.prototype */ {
		getKeys: function() {
			return this.keys.slice(0);
		},
		match: function (e, index) {
			var keys = this.keys;
			if (index !== undefined) {
				if (index > keys.length) {
					return false;
				}
				if (keys[index].match(e)) {
					if (index === keys.length - 1) {
						return true;
					}
					return index + 1;
				}
				return false;
			} else {
				if (!(e instanceof Array)) {
					e = [e];
				}
				if (e.length > keys.length) {
					return false;
				}
				var i;
				for (i = 0; i < e.length; i++) {
					if (!keys[i].match(e[i])) {
						return false;
					}
				}
				if (i === keys.length) {
					return true;
				}
				return i;
			}
		},
		/**
		 * Returns whether this key sequence is the same as the given parameter.
		 * 
		 * @param {orion.KeyBinding|orion.KeySequence} kb the key binding to compare with.
		 * @returns {Boolean} whether or not the parameter and the receiver describe the same key binding.
		 */
		equals: function(kb) {
			if (!kb.keys) { return false; }
			if (kb.keys.length !== this.keys.length) { return false; }
			for (var i=0; i<kb.keys.length; i++) {
				if (!kb.keys[i].equals(this.keys[i])) { return false; }
			}
			return true;
		}	
	};
	
	return {
		KeyBinding: KeyStroke, // for backwards compatibility
		KeyStroke: KeyStroke,
		KeySequence: KeySequence
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/

define('orion/compare/compareCommands',['i18n!orion/compare/nls/messages', 'orion/commands', 'orion/Deferred', 'orion/keyBinding', 'orion/webui/littlelib', 'orion/EventTarget'], 
function(messages, mCommands, Deferred, mKeyBinding, lib, EventTarget) {

var exports = {};
/**
 * @name orion.compare.CompareCommandFactory
 * @class Represents a command renderer to render all commands and key bindings of the command view.
 * @property {String} options.commandSpanId The DOM element id where the commands are rendered. Required.
 * @property {orion.commandregistry.CommandRegistry} options.commandService The command service that is used to register all the commands. Required.
 */
exports.CompareCommandFactory = (function() {
	function CompareCommandFactory(options){
		EventTarget.attach(this);
		this.setOptions(options, true);
	}	
	CompareCommandFactory.prototype = {
		setOptions: function(options, clearExisting){
			if(clearExisting){
				this.options = {};
			}
			if(!this.options) {
				this.options = {};
			}
			if(options) {
				Object.keys(options).forEach(function(option) {
					this.options[option] = options[option];
				}.bind(this));
			}
		},
		getOptions: function() {
			return this.options;
		},
		initCommands: function(compareWidget){	
			var commandSpanId = this.options.commandSpanId;
			var toggleCommandSpanId = this.options.toggleCommandSpanId;
			var commandService = this.options.commandService;
			if(!commandService || (!commandSpanId && !toggleCommandSpanId)){
				return;
			}
			var copyToLeftCommand = new mCommands.Command({
				name : messages["CpCurChangeRightToLeft"],
				tooltip : messages["CpCurChangeRightToLeft"],
				imageClass : "core-sprite-leftarrow", //$NON-NLS-0$
				id: "orion.compare.copyToLeft", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return compareWidget.type === "twoWay" && !compareWidget.getImageMode() && compareWidget.options.newFile && !compareWidget.options.newFile.readonly; //$NON-NLS-0$
				}.bind(this),
				callback : function(data) {
					data.items.copyToLeft();
			}});
			var copyToRightCommand = new mCommands.Command({
				name : messages["CpCurChangeLeftToRight"],
				tooltip : messages["CpCurChangeLeftToRight"],
				imageClass : "core-sprite-rightarrow", //$NON-NLS-0$
				id: "orion.compare.copyToRight", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return compareWidget.type === "twoWay" && !compareWidget.getImageMode() && compareWidget.options.oldFile && !compareWidget.options.oldFile.readonly; //$NON-NLS-0$
				}.bind(this),
				callback : function(data) {
					data.items.copyToRight();
			}});
			var ignoreWhitespaceCommand = new mCommands.Command({
				tooltip : messages["IgnoreWhitespaceTooltip"],
				name: messages["IgnoreWhitespace"],
				imageClass : "core-sprite-whitespace", //$NON-NLS-0$
				id: "orion.compare.ignoreWhitespace", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				type: "toggle",
				visibleWhen: function(item) {
					var isWhitespaceIgnored = item.isWhitespaceIgnored();
					ignoreWhitespaceCommand.checked = isWhitespaceIgnored;
					ignoreWhitespaceCommand.name = isWhitespaceIgnored ? messages["UseWhitespace"] : messages["IgnoreWhitespace"];
					ignoreWhitespaceCommand.tooltip = isWhitespaceIgnored ? messages["UseWhitespaceTooltip"] :  messages["IgnoreWhitespaceTooltip"];
					return true;
				},
				preCallback: function(data) {
					var widget = data.handler.getWidget();
					if(typeof widget.options.onSave === "function" && widget.isDirty()) { //$NON-NLS-0$
						var doSave = window.confirm(messages.confirmUnsavedChanges);
						if(!doSave) {
							return new Deferred().resolve();
						}
						return widget.options.onSave(doSave);
					}
					return new Deferred().resolve(true);
				},
				callback : function(data) {
					data.items.ignoreWhitespace(ignoreWhitespaceCommand.checked);
					this.dispatchEvent({type:"compareConfigChanged", name: "ignoreWhiteSpace", value: ignoreWhitespaceCommand.checked}); //$NON-NLS-0$
			}.bind(this)});
			var toggleInline2WayCommand = new mCommands.Command({
				tooltip : messages["Switch to unified diff"],
				name: messages["Unified"],
				imageClass : "compare-sprite-inline-2way", //$NON-NLS-0$
				id: "orion.compare.toggleInline2Way", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				type: "switch",
				visibleWhen: function(item) {
					if(!item.options.toggler) {
						return false;
					}
					var is2Way = item.options.toggler.getWidget().type === "twoWay";
					toggleInline2WayCommand.checked = !is2Way;
					toggleInline2WayCommand.name = is2Way ? messages["Unified"] : messages["Side by side"];
					toggleInline2WayCommand.tooltip = is2Way ? messages["Switch to unified diff"] :  messages["Switch to side by side diff"];
					return true;
				},
				preCallback: function(data) {
					var widget = data.handler.getWidget();
					if(typeof widget.options.onSave === "function" && widget.isDirty()) { //$NON-NLS-0$
						var doSave = window.confirm(messages.confirmUnsavedChanges);
						if(!doSave) {
							return new Deferred().resolve();
						}
						return widget.options.onSave(doSave);
					}
					return new Deferred().resolve(true);
				},
				callback : function(data) {
					this.dispatchEvent({type:"compareConfigChanged", name: "mode", value: data.items.options.toggler.getWidget().type === "twoWay" ? "inline" : "twoWay"}); //$NON-NLS-0$
					data.items.options.toggler.toggle();
			}.bind(this)});
			var nextDiffCommand = new mCommands.Command({
				name: messages["Next diff block"],
				tooltip : messages["Next diff block"],
				imageClass : "core-sprite-move-down", //$NON-NLS-0$
				id: "orion.compare.nextDiff", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return !compareWidget.getImageMode();
				},
				callback : function(data) {
					data.items.nextDiff();
			}});
			var prevDiffCommand = new mCommands.Command({
				name : messages["Previous diff block"],
				tooltip : messages["Previous diff block"],
				imageClass : "core-sprite-move-up", //$NON-NLS-0$
				id: "orion.compare.prevDiff", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return !compareWidget.getImageMode();
				},
				callback : function(data) {
					data.items.prevDiff();
			}});
			var nextChangeCommand = new mCommands.Command({
				name : messages["Next diff change"],
				tooltip : messages["Next diff change"],
				imageClass : "core-sprite-move-down", //$NON-NLS-0$
				id: "orion.compare.nextChange", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return !compareWidget.getImageMode();
				},
				callback : function(data) {
					data.items.nextChange();
			}});
			var prevChangeCommand = new mCommands.Command({
				name : messages["Previous diff change"],
				tooltip : messages["Previous diff change"],
				imageClass : "core-sprite-move-up", //$NON-NLS-0$
				id: "orion.compare.prevChange", //$NON-NLS-0$
				groupId: "orion.compareGroup", //$NON-NLS-0$
				visibleWhen: function(item) {
					return !compareWidget.getImageMode();
				},
				callback : function(data) {
					data.items.prevChange(data);
			}});
			commandService.addCommand(copyToLeftCommand);
			commandService.addCommand(copyToRightCommand);
			commandService.addCommand(ignoreWhitespaceCommand);
			commandService.addCommand(toggleInline2WayCommand);
			commandService.addCommand(nextDiffCommand);
			commandService.addCommand(prevDiffCommand);
			commandService.addCommand(nextChangeCommand);
			commandService.addCommand(prevChangeCommand);
				
			// Register command contributions
			//If there is a separate DIV to render the toggle command, we use it here
			if(toggleCommandSpanId) {
				commandService.registerCommandContribution(toggleCommandSpanId, "orion.compare.toggleInline2Way", 108); //$NON-NLS-0$
			} else if(commandSpanId) {
				commandService.registerCommandContribution(commandSpanId, "orion.compare.toggleInline2Way", 108); //$NON-NLS-0$
			}
			//Render all other commands
			if(commandSpanId) {
				commandService.registerCommandContribution(commandSpanId, "orion.compare.copyToLeft", 110, null, false, new mKeyBinding.KeyBinding(37/*left arrow key*/, true, false, true)); //$NON-NLS-0$
				commandService.registerCommandContribution(commandSpanId, "orion.compare.copyToRight", 111, null, false, new mKeyBinding.KeyBinding(39/*left arrow key*/, true, false, true)); //$NON-NLS-0$
				commandService.registerCommandContribution(commandSpanId, "orion.compare.nextDiff", 112, null, false, new mKeyBinding.KeyBinding(40/*down arrow key*/, true)); //$NON-NLS-0$
				commandService.registerCommandContribution(commandSpanId, "orion.compare.prevDiff", 113, null, false, new mKeyBinding.KeyBinding(38/*up arrow key*/, true)); //$NON-NLS-0$
				if(compareWidget.options.wordLevelNav){
					commandService.registerCommandContribution(commandSpanId, "orion.compare.nextChange", 114, null, false, new mKeyBinding.KeyBinding(40/*down arrow key*/, true, true)); //$NON-NLS-0$
					commandService.registerCommandContribution(commandSpanId, "orion.compare.prevChange", 115, null, false, new mKeyBinding.KeyBinding(38/*up arrow key*/, true, true)); //$NON-NLS-0$
				} else {
					commandService.registerCommandContribution(commandSpanId, "orion.compare.nextChange", 114, null, true, new mKeyBinding.KeyBinding(40/*down arrow key*/, true, true)); //$NON-NLS-0$
					commandService.registerCommandContribution(commandSpanId, "orion.compare.prevChange", 115, null, true, new mKeyBinding.KeyBinding(38/*up arrow key*/, true, true)); //$NON-NLS-0$
				}
				commandService.registerCommandContribution(commandSpanId, "orion.compare.ignoreWhitespace", 109); //$NON-NLS-0$
			}
		},
		
		renderCommands: function(compareWidget){
			var commandSpanId = this.options.commandSpanId;
			var toggleCommandSpanId = this.options.toggleCommandSpanId;
			var commandService = this.options.commandService;
			if(!commandService || (!commandSpanId && !toggleCommandSpanId)){
				return;
			}
			if(toggleCommandSpanId) {
				lib.empty(lib.node(toggleCommandSpanId));
				commandService.renderCommands(toggleCommandSpanId, toggleCommandSpanId, compareWidget, compareWidget, "tool", null); //$NON-NLS-0$
			}
			if(commandSpanId) {
				lib.empty(lib.node(commandSpanId));
				if(this.options.gridRenderer && this.options.gridRenderer.navGridHolder){
					this.options.gridRenderer.navGridHolder.splice(0, this.options.gridRenderer.navGridHolder.length);
					if(this.options.gridRenderer.additionalCmdRender){
						if(this.options.gridRenderer.before){
							this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder);
							commandService.renderCommands(commandSpanId, commandSpanId, compareWidget, compareWidget, "tool", null, this.options.gridRenderer.navGridHolder); //$NON-NLS-0$
						} else {
							commandService.renderCommands(commandSpanId, commandSpanId, compareWidget, compareWidget, "tool", null, this.options.gridRenderer.navGridHolder); //$NON-NLS-0$
							this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder);
						}
					} else {
						commandService.renderCommands(commandSpanId, commandSpanId, compareWidget, compareWidget, "tool", null, this.options.gridRenderer.navGridHolder); //$NON-NLS-0$
					}
				} else {
					commandService.renderCommands(commandSpanId, commandSpanId, compareWidget, compareWidget, "tool", null); //$NON-NLS-0$
				}
			}
		}
	};
	return CompareCommandFactory;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/URITemplate',[],function(){
	
	var OPERATOR = {
		NUL: {first:"", sep:",", named: false, ifemp: "", allow: "U"}, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"+": {first:"", sep:",", named: false, ifemp: "", allow: "U+R"}, //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		".": {first:".", sep:",", named: false, ifemp: "", allow: "U"}, //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"/": {first:"/", sep:"/", named: false, ifemp: "", allow: "U"}, //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		";": {first:";", sep:";", named: true, ifemp: "", allow: "U"}, //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"?": {first:"?", sep:"&", named: true, ifemp: "=", allow: "U"}, //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"&": {first:"&", sep:"&", named: true, ifemp: "=", allow: "U"}, //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"#": {first:"#", sep:",", named: false, ifemp: "", allow: "U+R"}, //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		",": {first:"", sep:",", named: false, ifemp: "", allow: "U+R-,"} //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	};

	var VARSPEC_REGEXP = /^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/;
	var PCT_ENCODED_G = /%25[0-9A-F][0-9A-F]/g;

	function Literal(text) {
		this._text = text;
	}

	Literal.prototype = {
		expand: function(vars) {
			return encodeURI(this._text);
		}
	};
	
	function decodePercent(str) {
		return str.replace("%25", "%");
	}
	
	function encodeString(value, encoding) {
		if (encoding === "U") { //$NON-NLS-0$
			return encodeURIComponent(value).replace(/[!'()*]/g, function(str) {
				return '%' + str.charCodeAt(0).toString(16).toUpperCase(); //$NON-NLS-0$
			});
		}
		if (encoding === "U+R") { //$NON-NLS-0$
			return encodeURI(value).replace(/%5B/g, '[').replace(/%5D/g, ']').replace(PCT_ENCODED_G, decodePercent); //$NON-NLS-1$ //$NON-NLS-0$
		}
		if (encoding === "U+R-,") { //$NON-NLS-0$
			return encodeURI(value).replace(/%5B/g, '[').replace(/%5D/g, ']').replace(/,/g, '%2C'); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		}
		throw new Error("Unknown allowed character set: " + encoding);
	}
	
	function encodeArray(value, encoding, separator) {
		var result = [];
		for (var i=0; i < value.length; i++) {
			if (typeof(value[i]) !== "undefined") { //$NON-NLS-0$
				result.push(encodeString(value[i], encoding));
			}
		}
		return result.join(separator);
	}
	
	function encodeObject(value, encoding, nameValueSeparator, pairSeparator ) {
		var keys = Object.keys(value);
		var result = [];
		for (var i=0; i < keys.length; i++) {
			if (typeof(value[keys[i]]) !== "undefined") { //$NON-NLS-0$
				result.push(encodeString(keys[i], encoding) + nameValueSeparator + encodeString(value[keys[i]], encoding));
			}
		}
		return result.join(pairSeparator);
	}
	
	function parseVarSpecs(text) {
		var result = [];
		var rawSpecs = text.split(","); //$NON-NLS-0$
		for (var i=0; i < rawSpecs.length; i++) {
			var match = rawSpecs[i].match(VARSPEC_REGEXP);
			if (match === null) {
				throw new Error("Bad VarSpec: " + text); //$NON-NLS-0$
			}
			result.push({
				name: match[1], 
				explode: !!match[2], 
				prefix: match[3] ? parseInt(match[3], 10) : -1
			}); 
		}
		return result;
	}
	
	function Expression(text) {
		if (text.length === 0) {
			throw new Error("Invalid Expression: 0 length expression"); //$NON-NLS-0$
		}
		
		this._operator = OPERATOR[text[0]];
		if (this._operator) {
			text = text.substring(1);
		} else {
			this._operator = OPERATOR.NUL;
		}
		
		this._varSpecList = parseVarSpecs(text);
	}
	
	Expression.prototype = {
		expand: function(params) {
			var result = [];
			for (var i=0; i < this._varSpecList.length; i++) {
				var varSpec = this._varSpecList[i];
				var name = varSpec.name;
				var value = params[name];
				var valueType = typeof(value);
				if (valueType !== "undefined" && value !== null) { //$NON-NLS-0$
					var resultText = result.length === 0 ? this._operator.first: this._operator.sep;			
					if (valueType === "string") { //$NON-NLS-0$
						if (this._operator.named) {
							resultText += encodeString(name, "U+R"); //$NON-NLS-0$
							resultText += (value.length === 0) ? this._operator.ifemp : "="; //$NON-NLS-0$
						}
						if (varSpec.prefix !== -1 && varSpec.prefix < value.length) {
							value = value.substring(0, varSpec.prefix);
						}
						
						resultText += encodeString(value, this._operator.allow);
					} else if (Array.isArray(value)) {
						if (value.length === 0) {
							continue; // treated as undefined and skipped
						}
						if (!varSpec.explode) {
							var encodedArray = encodeArray(value, this._operator.allow, ","); //$NON-NLS-0$
							if (this._operator.named) {
								resultText += encodeString(name, "U+R"); //$NON-NLS-0$
								resultText += (encodedArray.length === 0) ? this._operator.ifemp : "="; //$NON-NLS-0$
							}
							resultText += encodedArray;
						} else {
							resultText += encodeArray(value, this._operator.allow, this._operator.sep);
						}				
					} else if (valueType === "object") { //$NON-NLS-0$
						if (Object.keys(value).length === 0) {
							continue; // treated as undefined and skipped
						}
						if (!varSpec.explode) {
							var encodedObject = encodeObject(value, this._operator.allow, ",", ","); //$NON-NLS-1$ //$NON-NLS-0$
							if (this._operator.named) {
								resultText += encodeString(name, "U+R"); //$NON-NLS-0$
								resultText += (encodedObject.length === 0) ? this._operator.ifemp : "="; //$NON-NLS-0$
							}
							resultText += encodedObject; //$NON-NLS-0$
						} else {
							resultText += encodeObject(value, this._operator.allow, "=", this._operator.sep); //$NON-NLS-0$
						}
					} else {
						throw new Error("bad param type: " + name + " : " + valueType); //$NON-NLS-1$ //$NON-NLS-0$
					}
					result.push(resultText);
				}
			}
			return result.join("");
		}
	};

	function parseTemplate(text) {
		var result = [];
		var current = 0;	
		var curlyStartIndex = text.indexOf("{", current); //$NON-NLS-0$
		while (curlyStartIndex !== -1) {
			result.push(new Literal(text.substring(current, curlyStartIndex)));
			var curlyEndIndex = text.indexOf("}", curlyStartIndex + 1); //$NON-NLS-0$
			if (curlyEndIndex === -1) {
				throw new Error("Invalid template: " + text); //$NON-NLS-0$
			}
			result.push(new Expression(text.substring(curlyStartIndex + 1, curlyEndIndex)));
			current = curlyEndIndex + 1;
			curlyStartIndex = text.indexOf("{", current);			 //$NON-NLS-0$
		}
		result.push(new Literal(text.substring(current)));
		return result;
	}

	/**
	 * @name orion.URITemplate
	 * @class A URITemplate describes a range of Uniform Resource Identifiers through variable expansion, and allows for particular URIs to 
	 * be generated by expanding variables to actual values.</p>
	 * <p>Because the syntax and encoding rules of URIs can be complex, URITemplates are recommended over manual construction of URIs through 
	 * string concatenation or other means.</p>
	 * <p>A URITemplate is created by invoking the constructor, passing a <em>template string</em>:</p>
	 * <p><code>new URITemplate(template)</code></p>
	 * <p>The <dfn>template string</dfn> is an expression following a well-defined syntax (see <a href="http://tools.ietf.org/html/rfc6570#section-1.2">here</a>
	 * for an introduction). Most notably, the template may include variables.</p>
	 * <p>Once created, a URITemplate's {@link #expand} method can be invoked to generate a URI. Arguments to {@link #expand} give the values to be 
	 * substituted for the template variables.</p>
	 * @description Creates a new URITemplate.
	 * @param {String} template The template string. Refer to <a href="http://tools.ietf.org/html/rfc6570#section-2">RFC 6570</a> for details
	 * of the template syntax.
	 */
	function URITemplate(template) {
		this._templateComponents = parseTemplate(template);
	}
	
	URITemplate.prototype = /** @lends orion.URITemplate.prototype */ {
		/**
		 * Expands this URITemplate to a URI.
		 * @param {Object} params The parameters to use for expansion. This object is a map of keys (variable names) to values (the variable's
		 * value in the <a href="http://tools.ietf.org/html/rfc6570#section-3.2.1">expansion algorithm</a>).
		 * @returns {String} The resulting URI.
		 */
		expand: function(params) {
			var result = [];
			for (var i = 0; i < this._templateComponents.length; i++) {
				result.push(this._templateComponents[i].expand(params));
			}
			return result.join("");
		}
	};

	return URITemplate;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/compareUtils',['orion/URITemplate'], function(URITemplate) {

var orion = orion || {};

/**
 * Utility methods
 * @namespace orion.compareUtils 
 */
 
orion.compareUtils = orion.compareUtils || {};

/**
 * Look up the mapper item by a given line index (zero based)
 * @static
 * @param {Array} mapper , the mapper generated by the  diffParser
 * @param {int} action , mapperColumnIndex , the column index of the mapper , should be 0 or 1
 * @param {int} lineIndex , the given line index
 * @return {Object} the object with two fields : the mapper index that collides with the lineIndex , the start line of the mapper
 */
orion.compareUtils.lookUpMapper = function(mapper , mapperColumnIndex , lineIndex) {
	var curLineindex = 0;//zero based
	for (var i = 0 ; i < mapper.length ; i++){
		var size = mapper[i][mapperColumnIndex];
		if(size === 0){
			size = 1;
		}
		if(lineIndex >= curLineindex && lineIndex < (curLineindex + size)){
			return {mapperIndex:i , startFrom:curLineindex};
		}
		if(i === (mapper.length - 1 )){
			break;
		}
		curLineindex += mapper[i][mapperColumnIndex];
	}
	return  {mapperIndex:mapper.length-1 , startFrom:curLineindex};
};

orion.compareUtils.lookUpLineIndex = function(mapper , mapperColumnIndex , mapperIndex){
	if(mapperIndex === 0){
		return 0;
	}
	var curLineindex = 0;//zero based
	for (var i = 0 ; i < mapperIndex ; i++){
		curLineindex += mapper[i][mapperColumnIndex];
	}
	return curLineindex;
};

orion.compareUtils.updateMapper = function(mapper , mapperColumnIndex , startLineIndex, removedLineCount, addedLineCount){
	if(removedLineCount === addedLineCount){
		return;
	}
	if(removedLineCount > 0 || addedLineCount > 0){
		var mapperItem = orion.compareUtils.lookUpMapper(mapper , mapperColumnIndex ,startLineIndex);
		if(mapperItem.mapperIndex < 0){
			return;
		}
		if(removedLineCount > 0){
			var linesLeft = removedLineCount;
			var startInMapper = startLineIndex - mapperItem.startFrom;
			for(var i = mapperItem.mapperIndex ; i < mapper.length ; i++){
				var wipeOutLines = mapper[i][mapperColumnIndex] - startInMapper;
				if(linesLeft <= wipeOutLines){
					mapper[i][mapperColumnIndex] -= linesLeft;
					break;
				}
				mapper[i][mapperColumnIndex] -= wipeOutLines;
				linesLeft -= wipeOutLines;
				startInMapper = 0;
			}
		}
		if(addedLineCount > 0){
			mapper[mapperItem.mapperIndex][mapperColumnIndex] += addedLineCount;
		}
	}
};

orion.compareUtils.overlapMapper = function(mapperItem , mapperColumnIndex , startLineIndex, lineFrom , lineTo){
	var endLineIndex = startLineIndex + mapperItem[mapperColumnIndex] - 1;
	
	if(endLineIndex < startLineIndex){
		endLineIndex = startLineIndex;
	}
	if(lineTo < lineFrom){
		lineTo = lineFrom;
	}
	if (endLineIndex < lineFrom || lineTo < startLineIndex){
		return false;
	}
	return true; 
};

orion.compareUtils.findFirstDiff = function(mapper , mapperColumnIndex , lineFrom , lineTo){
	var curLineIndex = 0;
	var retValue = null;
	for (var i = 0 ; i < mapper.length ; i++){
		if(curLineIndex > lineTo){
			break;
		}
		if(orion.compareUtils.overlapMapper( mapper[i] , mapperColumnIndex , curLineIndex , lineFrom , lineTo)){
			retValue = {mapperIndex:i , startFrom:curLineIndex };
			if( mapper[i][2] !== 0 ){
				break;
			}
		}
		curLineIndex  +=  mapper[i][mapperColumnIndex];
	}
	return  retValue;
};


//returns the line index at the top of the other editor , when scroll happens on the eidotr
orion.compareUtils.matchMapper = function(mapper , mapperColumnIndex , lineFrom , lineTo){
	if(mapper.length === 0){
		return lineFrom;
	}
	var baseLine = lineFrom + Math.round((lineTo -lineFrom)/3);
	var first = orion.compareUtils.findFirstDiff(mapper , mapperColumnIndex , lineFrom , lineTo);
	var mapperEndAt = mapper[first.mapperIndex][mapperColumnIndex] === 0 ? first.startFrom : first.startFrom + mapper[first.mapperIndex][mapperColumnIndex] -1;
	
	var startLineAtOther = orion.compareUtils.lookUpLineIndex(mapper , 1-mapperColumnIndex , first.mapperIndex);
	var delta = first.startFrom - lineFrom;
	
	if( mapper[first.mapperIndex][2] === 0){
		return (startLineAtOther -delta);
	}
	if(baseLine >= first.startFrom && baseLine <= mapperEndAt){
		return startLineAtOther -  Math.round((lineTo -lineFrom)/3);
	}	
	if(baseLine < first.startFrom){
		return (startLineAtOther -delta);
	}
	
	var mapperEndAtOther = mapper[first.mapperIndex][1-mapperColumnIndex] === 0 ? startLineAtOther : startLineAtOther + mapper[first.mapperIndex][1-mapperColumnIndex] -1;
	return ( mapperEndAtOther- (mapperEndAt - lineFrom));
	
};

orion.compareUtils.getMapperLineCount = function(mapper){
	var curLineindex = 0;//zero based
	for (var i = 0 ; i < mapper.length ; i++){
		curLineindex += Math.max(mapper[i][0] ,mapper[i][1]);
	}
	return curLineindex;
};

orion.compareUtils.getAnnotationIndex = function(annotations, lineIndex){
	for (var i = 0 ; i < annotations.length ; i++){
		if(annotations[i][0] === lineIndex){
			return i;
		}
	}
	return -1;
};

orion.compareUtils.getAnnotationMapperIndex = function(annotations, annotationIndex){
	return annotations[annotationIndex][1];
};

orion.compareUtils.getAnnotationIndexByMapper = function(annotations, mapperIndex){
	for (var i = 0 ; i < annotations.length ; i++){
		if(annotations[i][1] === mapperIndex){
			return {current:i,prev:i-1,next:i+1};
		}
	}
	return {current:-1,prev:-1,next:-1};
};

orion.compareUtils.isMapperConflict = function(mapper, mapperIndex){
	if(mapperIndex < 0){
		return false;
	}
	if(!mapper[mapperIndex][3]){
		return false;
	}
	return mapper[mapperIndex][3] === 1;
};

orion.compareUtils.mergeDiffBlocks = function(oldTextModel, newDiffBlocks, mapper, diffArray, diffArraySubstrIndex, lineDelim){
	for(var i = 0; i < newDiffBlocks.length; i++){
		var startLineIndex = newDiffBlocks[i][0];
		var mapperIndex = newDiffBlocks[i][1];
		var mapperItem = mapper[mapperIndex];
		if(mapperItem[0] > 0){
			var text = "";
			for(var j = 0; j < mapperItem[0]; j++){
				var lineText = diffArray[mapperItem[2]-1+j];
				if(lineText) {
					text = text + lineText.substring(diffArraySubstrIndex) + lineDelim;
				} else {
					text = text + lineDelim;
				}
			}
			var lineCount = oldTextModel.getLineCount();
			if(startLineIndex >= lineCount){
				//Check if the last line of the text model has line delimeter or not
				var lineEnd1 = oldTextModel.getLineEnd(lineCount - 1);
				var lineEnd2 = oldTextModel.getLineEnd(lineCount - 1, true);
				if(lineEnd1 === lineEnd2){//last line has no line delimeter, we need to fake one
					oldTextModel.setText(lineDelim, lineEnd1, lineEnd1);
					startLineIndex = lineCount;
				} else {
					startLineIndex = lineCount -1;
				}
			}
			var startOffset = oldTextModel.getLineStart(startLineIndex);
			oldTextModel.setText(text, startOffset, startOffset);
		}
	}
};

orion.compareUtils.convertMergedLineNumber = function(mapper, lineindex/*zero based*/){
	var mapperItem = orion.compareUtils.lookUpMapper(mapper, 0, lineindex);
	var returnValue = lineindex;
	if(mapperItem.mapperIndex < 0){
		return returnValue;
	}
	for(var i = 0; i < mapperItem.mapperIndex; i++){
		if(mapper[i][2] !== 0) {
			returnValue = returnValue + mapper[i][0];
		}
	}
	return returnValue;
};

orion.compareUtils.generateCompareHref = function(diffLocation, options) {
	var base =  "../compare/compare.html"; //$NON-NLS-0$
	if(!options.conflict){
		options.conflict = undefined;
	}
	if(!options.readonly){
		options.readonly = undefined;
	}
	var href = new URITemplate(base + "#{,resource,params*}").expand({ //$NON-NLS-0$
		resource: diffLocation,
		params: options
	});
	return href;
};

orion.compareUtils.generateCompareTreeHref = function(folderToCompare, options) {
	var base =  "../compare-tree/compare-tree.html"; //$NON-NLS-0$
	var href = new URITemplate(base + "#{,resource,params*}").expand({ //$NON-NLS-0$
		resource: folderToCompare,
		params: options
	});
	return href;
};

return orion.compareUtils;
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/compare/diffProvider',['i18n!orion/compare/nls/messages', 'orion/Deferred'], function(messages, Deferred) {

	function _doServiceCall(fileService, funcName, funcArgs) {
	
		var clientDeferred = new Deferred();
		fileService[funcName].apply(fileService, funcArgs).then(
			//on success, just forward the result to the client
			function(result) {
				clientDeferred.resolve(result);
			},
			//on failure we might need to retry
			function(error) {
				//forward other errors to client
				clientDeferred.reject(error);
			}
		);
		return clientDeferred;
	}
	
	function _normalizeURL(location) {
		if (location.indexOf("://") === -1) { //$NON-NLS-0$
			var temp = document.createElement('a'); //$NON-NLS-0$
			temp.href = location;
	        return temp.href;
		}
		return location;
	}
	
	
	/**
	 * Creates a new diff provider.
	 * @class Provides operations on Diff in a compare editor
	 * @name orion.compare.DiffProvider
	 */
	function DiffProvider(serviceRegistry, filter) {
		var allReferences = serviceRegistry.getServiceReferences("orion.core.diff"); //$NON-NLS-0$
		var i, _references = allReferences;
		if (filter) {
			_references = [];
			for(i = 0; i < allReferences.length; ++i) {
				if (filter(allReferences[i])) {
					_references.push(allReferences[i]);
				}
			}
		}
		var _patterns = [];
		var _services = [];
		
		for(i = 0; i < _references.length; ++i) {
			_patterns[i] = new RegExp(_references[i].getProperty("pattern") || ".*");//$NON-NLS-1$ //$NON-NLS-0$
			_services[i] = serviceRegistry.getService(_references[i]);
		}

		this._getService = function(location) {
			location = _normalizeURL(location);
			for(var i = 0; i < _patterns.length; ++i) {
				if (_patterns[i].test(location)) {
					return _services[i];
				}
			}
			throw messages["NoDiffServiceLocationMatched"] + location;
		};
	}

	DiffProvider.prototype = /** @lends orion.compare.DiffProvider.prototype */
	{
		getDiffContent: function(diffURI, options){
			return _doServiceCall(this._getService(diffURI, options), "getDiffContent", arguments); //$NON-NLS-0$
		},
		getDiffFileURI: function(diffURI){
			return _doServiceCall(this._getService(diffURI), "getDiffFileURI", arguments); //$NON-NLS-0$
		}
		
	};
	return {DiffProvider: DiffProvider};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/diffParser',[], function() {

var orion = orion || {};

orion.DiffParser = (function() {
	var isWindows = window.navigator.platform.indexOf("Win") !== -1; //$NON-NLS-0$
	var NO_NEW_LINE = "\\ No newline at end of file"; //$NON-NLS-0$
	/** @private */
	function DiffParser(lineDelimiter, diffLineDilemeter) {
		this._lineDelimiter = lineDelimiter ? lineDelimiter : (isWindows ? "\r\n" : "\n");  //$NON-NLS-1$ //$NON-NLS-0$
		this._diffLineDelimiter = diffLineDilemeter ? diffLineDilemeter : this._lineDelimiter;
		this._DEBUG = false;
	}
	DiffParser.prototype = {
		_init: function(){
			//Input
			this._oFileContents = [];
			this._diffContents = [];

			//All the middle result when computing
			this._oBlocks = []; //each item inside original block will be formatted as [startAtLine , linesInBlock]
			this._nBlocks = []; //each item inside new block will be formatted as [startAtLine , linesInBlock , indexInDiffLines]
			this._hunkRanges = [];
			this._lastToken = " "; //$NON-NLS-0$

			//Final result as out put
			this._deltaMap = [];
			this._nFileContents = [];

			//Flag of new line at file end
			this._oNewLineAtEnd = true;
			this._nNewLineAtEnd = true;
			this._diffContentIndex = 1;
		},

		/**
		 * Returns an array of arrays of the parsed original blocks of the file.
		 * This is formatted as [[startAtLine, linesInBlock]] where startAtLine is
		 * the start line of the new diff block, and linesInBlock is the number of
		 * lines that were affected
		 */
		getOriginalBlocks: function() {
			return this._oBlocks;
		},

		/**
		 * Returns an array of arrays of the parsed diffs of the new blocks in the file.
		 * This is formatted as [[startAtLine, linesInBlock, indexInDiffLines]]
		 * where startAtLine is the start line of the new diff block, linesInBlock is
		 * the number of lines that were affected, and indexInDiffLines is the starting
		 * index of the diff in the line block.
		 */
		getNewBlocks: function() {
			return this._nBlocks;
		},

		setLineDelim: function(lineDelimiter){
			this._lineDelimiter = lineDelimiter;
			this._diffLineDelimiter = lineDelimiter;
		},

		getDiffArray: function(){
			return {array:this._diffContents , index:this._diffContentIndex};
		},

		parse: function(oFileString , diffString , detectConflicts ,doNotBuildNewFile){
			this._init();
			if(diffString === ""){
				return {outPutFile: oFileString, mapper: []};
			}
			this._oFileContents = oFileString === "" ? []:oFileString.split(this._lineDelimiter);
			this._diffContents = diffString.split(this._diffLineDelimiter);
			var totalLines = this._diffContents.length;
			this._hunkRanges = [];
			for(var i = 0; i <totalLines ; i++){
				var hunkRange = this._parseHunkRange(i);
				if (hunkRange) {
				    this._hunkRanges.push(hunkRange);
				}
		    }
			if(0 === this._hunkRanges.length){
				return {outPutFile:oFileString,mapper:[]};
			}

			if(this._DEBUG){
				console.log("***Diff contents: \n"); //$NON-NLS-0$
				this._diffContents.forEach(function(singleLine) {
					console.log(singleLine);
				});
				console.log("***Hunk ranges: \n"); //$NON-NLS-0$
				console.log(JSON.stringify(this._hunkRanges));
			}
			for(var j = 0; j <this._hunkRanges.length ; j++){
				this._parseHunkBlock(j);
			}
			if(this._DEBUG){
				console.log("***Original Hunk range blocks: \n"); //$NON-NLS-0$
				console.log(JSON.stringify(this._oBlocks));
				console.log("***New Hunk range blocks: \n"); //$NON-NLS-0$
				console.log(JSON.stringify(this._nBlocks));
			}
			this._buildMap(detectConflicts);
			if(this._DEBUG){
				console.log("***New Line at end of file(original): \n"); //$NON-NLS-0$
				console.log(JSON.stringify(this._oNewLineAtEnd));
				console.log("***New Line at end of file(new): \n"); //$NON-NLS-0$
				console.log(JSON.stringify(this._nNewLineAtEnd));
				console.log("***Mapper: \n"); //$NON-NLS-0$
				this._logMap();
				console.log("***Total line number in original file: " + this._oFileContents.length); //$NON-NLS-0$
			}
			if(!doNotBuildNewFile){
				this._buildNewFile();
			}
			if(this._DEBUG){
				//console.log("***New File: \n");
				//this._logNewFile();
				//console.log("***Total line number in new file: " + this._nFileContents.length);
			}
			return {outPutFile:this._nFileContents.join(this._diffLineDelimiter),mapper:this._deltaMap};
		},

		_logMap: function(){
			for(var i = 0;i < this._deltaMap.length ; i++){
				console.log(JSON.stringify(this._deltaMap[i]));
				if(this._deltaMap[i][2] > 0){
					console.log("    **Diff content on change/add: \n"); //$NON-NLS-0$
					for(var j = 0;j < this._deltaMap[i][0] ; j++){
						console.log("    " + this._diffContents[this._deltaMap[i][2]+j-1]); //$NON-NLS-0$
					}
				}
			}
		},

		_logNewFile: function(){
			for(var i = 0;i < this._nFileContents.length ; i++){
				console.log(this._nFileContents[i]);
			}
		},

		_createBlock: function(token , blocks , startAtLine , endAtLine){
			if(endAtLine === startAtLine && token === " "){ //$NON-NLS-0$
				return;
			}
			var block = [startAtLine , endAtLine - startAtLine ,"s" ]; //$NON-NLS-0$
			if(token === "-"){ //$NON-NLS-0$
				block[2] = "r"; //$NON-NLS-0$
			} else if(token === "+"){ //$NON-NLS-0$
				block[2] = "a"; //$NON-NLS-0$
			} else if(token === "c"){ //$NON-NLS-0$
				block[2] = "c"; //$NON-NLS-0$
			}
			blocks.push(block);
		},

		_createMinusBlock: function(oBlkStart , nBlkStart , oBlockLength, lastMinusPos){
			var len = this._oBlocks.length;
			if(len === 0 || oBlkStart !== this._oBlocks[len-1][0]){
				this._oBlocks.push([oBlkStart === 0 ? 1 : oBlkStart , oBlockLength, lastMinusPos]);
				this._nBlocks.push([nBlkStart , 0 , -2]);
			} else {
				this._oBlocks[len-1][1] = this._oBlocks[len-1][1] + oBlockLength;
				this._oBlocks[len-1][2] = lastMinusPos;
			}
		},

		_createPlusBlock: function(oBlkStart , nBlkStart , nBlockLength , lastPlusPos ){
			var len = this._nBlocks.length;
			if(len === 0 || nBlkStart !== this._nBlocks[len-1][0]){
				this._oBlocks.push([oBlkStart === 0 ? 1 : oBlkStart , 0]);
				this._nBlocks.push([nBlkStart , nBlockLength , lastPlusPos]);
			} else {
				this._nBlocks[len-1][1] = this._nBlocks[len-1][1] + nBlockLength;
				this._nBlocks[len-1][2] = lastPlusPos;
			}
		},

		//read line by line in a hunk range
		_parseHunkBlock: function(hunkRangeNo ){
			var lastToken = " "; //$NON-NLS-0$
			var startNo = this._hunkRanges[hunkRangeNo][0] + 1;
			var endNo = (hunkRangeNo === (this._hunkRanges.length - 1) ) ? this._diffContents.length : this._hunkRanges[hunkRangeNo+1][0];

			var oCursor = 0;
			var nCursor = 0;
			var oBlkStart = this._hunkRanges[hunkRangeNo][1];
			var nBlkStart = this._hunkRanges[hunkRangeNo][3];
			var lastPlusPos = startNo;
			var lastMinusPos = startNo;
			for (var i = startNo ; i< endNo ; i++){
				if( 0 === this._diffContents[i].length){
					continue;
				}
				var curToken = this._diffContents[i][0];
				if(curToken === "\\"){ //$NON-NLS-0$
					if( NO_NEW_LINE === this._diffContents[i].substring(0 , this._diffContents[i].length-1) ||
						NO_NEW_LINE === this._diffContents[i]){
						if(lastToken === "-"){ //$NON-NLS-0$
							this._oNewLineAtEnd = false;
						} else if(lastToken === " "){ //$NON-NLS-0$
							this._nNewLineAtEnd = false;
							this._oNewLineAtEnd = false;
						} else {
							this._nNewLineAtEnd = false;
						}
						if(i > startNo && this._diffContents[i-1][this._diffContents[i-1].length-1] === "\r"){ //$NON-NLS-0$
							this._diffContents[i-1] = this._diffContents[i-1].substring(0 , this._diffContents[i-1].length-1);
						}
						continue;
					}
				}
				switch(curToken){
				case "-": //$NON-NLS-0$
				case "+": //$NON-NLS-0$
				case " ": //$NON-NLS-0$
					break;
				default:
					continue;
				}

				if(lastToken !== curToken){
					if(curToken === "+"){ //$NON-NLS-0$
						lastPlusPos = i;
					}
					if(curToken === "-"){ //$NON-NLS-0$
						lastMinusPos = i;
					}
					switch(lastToken){
					case " ": //$NON-NLS-0$
						oBlkStart = this._hunkRanges[hunkRangeNo][1] + oCursor;
						nBlkStart = this._hunkRanges[hunkRangeNo][3] + nCursor;
						break;
					case "-": //$NON-NLS-0$
						this._createMinusBlock(oBlkStart , nBlkStart ,this._hunkRanges[hunkRangeNo][1] + oCursor - oBlkStart, lastMinusPos);
						break;
					case "+": //$NON-NLS-0$
						this._createPlusBlock(oBlkStart , nBlkStart ,this._hunkRanges[hunkRangeNo][3] + nCursor - nBlkStart , lastPlusPos);
						break;
					default:
					}
					lastToken = curToken;
				}

				switch(curToken){
				case "-": //$NON-NLS-0$
					oCursor++;
					break;
				case "+": //$NON-NLS-0$
					nCursor++;
					break;
				case " ": //$NON-NLS-0$
					oCursor++;
					nCursor++;
					break;
				}
			}
			switch(lastToken){
			case "-": //$NON-NLS-0$
				this._createMinusBlock(oBlkStart , nBlkStart ,this._hunkRanges[hunkRangeNo][1] + oCursor - oBlkStart, lastMinusPos);
				break;
			case "+": //$NON-NLS-0$
				this._createPlusBlock(oBlkStart , nBlkStart ,this._hunkRanges[hunkRangeNo][3] + nCursor - nBlkStart , lastPlusPos);
				break;
			}
		},

		_detectConflictes: function(startIndexInDiff , lines){
			if(startIndexInDiff < 0){
				return false;
			}
			var endIndex = startIndexInDiff + lines;
			for(var i = startIndexInDiff ; i < endIndex ; i++){
				var line = this._diffContents[i];
				if(line.indexOf("<<<<<") > -1 || line.indexOf(">>>>>") > -1){ //$NON-NLS-1$ //$NON-NLS-0$
					return true;
				}
			}
			return false;
		},

		_buildMap: function(detectConflicts){
			var  blockLen = this._oBlocks.length;
			var oFileLen = this._oFileContents.length;
			var oFileLineCounter = 0;
			var delta, lastSamePos = 1;
			for(var i = 0 ; i < blockLen ; i++){
				delta =  this._oBlocks[i][0] - lastSamePos;
				//Create the "same on both" delta
				if(delta > 0){
					this._deltaMap.push([delta , delta , 0]);
					oFileLineCounter += delta;
				}
				if(detectConflicts && this._detectConflictes(this._nBlocks[i][2] , this._nBlocks[i][1])){
					this._deltaMap.push([this._nBlocks[i][1] , this._oBlocks[i][1] , this._nBlocks[i][2]+1 , 1]);
				} else {
					this._deltaMap.push([this._nBlocks[i][1] , this._oBlocks[i][1] , this._nBlocks[i][2]+1]);
				}
				oFileLineCounter += this._oBlocks[i][1];
				lastSamePos = this._oBlocks[i][0] + this._oBlocks[i][1];
			}
			if(0 < (oFileLen - lastSamePos)){
				this._deltaMap.push([oFileLen - lastSamePos+1 , oFileLen - lastSamePos+1 , 0]);
				oFileLineCounter += (oFileLen - lastSamePos+1);
			}
			if(oFileLineCounter < oFileLen){
				delta = oFileLen - oFileLineCounter;
				var lastMapItem = this._deltaMap[this._deltaMap.length-1];
				if(lastMapItem[2] === 0){
					lastMapItem[0] += delta;
					lastMapItem[1] += delta;
				} else if (lastMapItem[2] === -1){
					this._deltaMap.push([delta , delta , 0]);
				} else if(this._nNewLineAtEnd === this._oNewLineAtEnd){
					this._deltaMap.push([delta , delta , 0]);
				} else {
					if(this._nNewLineAtEnd){
						lastMapItem[0] += delta;
					}
					if(this._oNewLineAtEnd){
						lastMapItem[1] += delta;
					}
				}
			}
		},

		_buildNewFile: function(){
			var oFileCursor = 1;
			var lastUpdateBySameBlk = false;
			var len = this._deltaMap.length;
			var i, j;
			for(i = 0;i < len ; i++){
				lastUpdateBySameBlk = false;
				if(this._deltaMap[i][2] === 0){
					for(j = 0;j < this._deltaMap[i][0] ; j++){
						this._nFileContents.push(this._oFileContents[oFileCursor+j-1]);
					}
					lastUpdateBySameBlk = true;
				} else if(this._deltaMap[i][2] > 0){
					for(j = 0;j < this._deltaMap[i][0] ; j++){
						this._nFileContents.push(this._diffContents[this._deltaMap[i][2]+j-1].substring(1));
					}
				}
				oFileCursor = oFileCursor + this._deltaMap[i][1];
			}
			if(this._nNewLineAtEnd && !lastUpdateBySameBlk){
				this._nFileContents.push("");
				//this._deltaMap[len-1][0] = this._deltaMap[len-1][0] + 1;
			}
		},

		//In many versions of GNU diff, each range can omit the comma and trailing value s, in which case s defaults to 1.
		_converHRangeBody: function(body , retVal){
			if( body ){
				var number =  parseInt(body, 10);
				retVal.push( number >= 0 ? number : 1);
			} else {
				retVal.push(1);
			}
		},

		//The hunk range information contains two hunk ranges.
		//The range for the hunk of the original file is preceded by a minus symbol, and the range for the new file is preceded by a plus symbol.
		//Each hunk range is of the format l,s where l is the starting line number and s is the number of lines the change hunk applies to for each respective file.
		//In many versions of GNU diff, each range can omit the comma and trailing value s, in which case s defaults to 1.
		//Note that the only really interesting value is the l line number of the first range; all the other values can be computed from the diff.
		/*
		 * return value :
		 * [lineNumberInDiff , OriginalL , OriginalS , NewL ,NewS] , no matter "-l,s +l,s" or "+l,s -l,s"
		 */
		_parseHunkRange: function(lineNumber){
			var oneLine = this._diffContents[lineNumber];
			var regex = /^@@\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/;// Pattern : "@@-l,s +l,s@@" or "@@-l,s +l@@" or "@@-l +l,s@@" or even "@@--l,s +-l,s@@"
			var regexReverse = /^@@\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/;// Pattern : "@@+l,s -l,s@@" or "@@+l,s -l@@" or "@@+l -l,s@@" or even "@@+-l,s --l,s@@"
			var match = regex.exec(oneLine);
			var retVal = null;
			if(match && match.length === 5) {
				retVal = [lineNumber];
				this._converHRangeBody(match[1], retVal);
				this._converHRangeBody(match[2], retVal);
				this._converHRangeBody(match[3], retVal);
				this._converHRangeBody(match[4], retVal);
			} else {
				match = regexReverse.exec(oneLine);
				if(match && match.length === 5) {
					retVal = [lineNumber];
					this._converHRangeBody(match[3], retVal);
					this._converHRangeBody(match[4], retVal);
					this._converHRangeBody(match[1], retVal);
					this._converHRangeBody(match[2], retVal);
				}
			}
			return retVal;
		}

	};
	return DiffParser;
}());
return orion;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/compare/compareRulers',['orion/compare/compareUtils'], function(mCompareUtils) {
var orion = orion || {};

orion.CompareRuler = (function() {
	/**
	 * Creates a new ruler for the compare editor.
	 * @class The compare ruler is used by the compare editor to render trim around the editor.
	 * @name orion.compare.rulers.CompareRuler
	 */
	function CompareRuler (rulerLocation, rulerOverview, rulerStyle) {
		this._location = rulerLocation || "left"; //$NON-NLS-0$
		this._overview = rulerOverview || "page"; //$NON-NLS-0$
		this._rulerStyle = rulerStyle;
		this._editor = null;
		var self = this;
		this._listener = {
			onModelChanged: function(e) {
				self._onModelChanged(e);
			}
		};
	}
	CompareRuler.prototype = /** @lends orion.compare.rulers.CompareRuler.prototype */ {
		setView: function (editor) {
			if (this._onModelChanged && this._editor) {
				this._editor.removeEventListener("ModelChanged", this._listener.onModelChanged);  //$NON-NLS-0$
			}
			this._editor = editor;
			if (this._onModelChanged && this._editor) {
				this._editor.addEventListener("ModelChanged", this._listener.onModelChanged); //$NON-NLS-0$
			}
		},
		getLocation: function() {
			return this._location;
		},
		getOverview: function(editor) {
			return this._overview;
		},
		getAnnotationModel: function() {
			return null;
		},
		addAnnotationType: function(type) {
		},
		isAnnotationTypeVisible: function(type) {
			return false;
		},
		removeAnnotationType: function(type) {
		},
		setAnnotationModel: function (annotationModel) {
		},
		getAnnotations: function(startLine, endLine) {
			var result = [];
			for (var i=startLine; i<endLine; i++) {
				var style = this.getStyle(i);
				if(style){
					result[i] = {html: this.getHTML(i), style: style};
				}
			}
			return result;
		},
		getWidestAnnotation: function() {
			return {html: this.getHTML(-1), style: this.getStyle(-1)};
		},
		getRulerStyle: function() {
			return this.getStyle(undefined);
		}
	};
	return CompareRuler;
}());

orion.LineNumberCompareRuler = (function() {
	/**
	 * Creates a new line number ruler for the compare editor.
	 * @class The line number ruler is used by the compare editor to render line numbers next to the editor
	 * @name orion.compare.rulers.LineNumberCompareRuler
	 */
	function LineNumberCompareRuler (diffNavigator, mapperColumnIndex , rulerLocation, rulerStyle, oddStyle, evenStyle) {
		orion.CompareRuler.call(this, rulerLocation, "page", rulerStyle); //$NON-NLS-0$
		this._diffNavigator = diffNavigator;
		this._oddStyle = oddStyle || {style: {backgroundColor: "white"}}; //$NON-NLS-0$
		this._evenStyle = evenStyle || {style: {backgroundColor: "white"}}; //$NON-NLS-0$
		this._numOfDigits = 0;
		this._mapperColumnIndex = mapperColumnIndex;
	}
	LineNumberCompareRuler.prototype = new orion.CompareRuler(); 
	LineNumberCompareRuler.prototype.getStyle = function(lineIndex) {
		if (lineIndex === undefined) {
			return this._rulerStyle;
		} else {
			return this._evenStyle;
		}
	};
	LineNumberCompareRuler.prototype.getHTML = function(lineIndex) {
		var model = this._editor.getModel();
		var diffFeeder = this._diffNavigator.getFeeder(this._mapperColumnIndex === 0);
		if(!diffFeeder){
			return "";
		}
		if (lineIndex === -1) {
			return model.getLineCount();
		} else {
			if( diffFeeder.getLineNumber){
				var realIndex = diffFeeder.getLineNumber(lineIndex);
				if(realIndex === -1){
					return "";
				}
				return  realIndex + 1;
			} 
			return lineIndex + 1;
		}
	};
	LineNumberCompareRuler.prototype._onModelChanged = function(e) {
		var start = e.start;
		var model = this._editor.getModel();
		var lineCount = model.getLineCount();
		var numOfDigits = (lineCount+"").length;
		if (this._numOfDigits !== numOfDigits) {
			this._numOfDigits = numOfDigits;
			var startLine = model.getLineAtOffset(start);
			this._editor.redrawLines(startLine, lineCount, this);
		}
	};
	return LineNumberCompareRuler;
}());

orion.CompareOverviewRuler = (function() {
	function CompareOverviewRuler ( rulerLocation, rulerStyle , diffNavigator , onClick) {
		this._diffNavigator = diffNavigator;
		this._onClick = onClick;
		orion.CompareRuler.call(this, rulerLocation, "document", rulerStyle); //$NON-NLS-0$
	}
	CompareOverviewRuler.prototype = new orion.CompareRuler();
	CompareOverviewRuler.prototype.getStyle = function(lineIndex) {
		var result, style;
		if (lineIndex === undefined) {
			result = this._rulerStyle || {};
			style = result.style || (result.style = {});
			style.lineHeight = "1px"; //$NON-NLS-0$
			style.fontSize = "1px"; //$NON-NLS-0$
			style.width = "14px"; //$NON-NLS-0$
		} else {
			if (lineIndex !== -1) {
				result = {styleClass: "annotationOverview breakpoint"} || {}; //$NON-NLS-0$
			} else {
				result = {};
			}
			style = result.style || (result.style = {});
			style.cursor = "pointer"; //$NON-NLS-0$
			style.width = "8px"; //$NON-NLS-0$
			//style.height = "3px";
			style.left = "2px"; //$NON-NLS-0$
			if(lineIndex >= 0 ){
				var diffBlocks;
				if(this._diffNavigator && this._diffNavigator.getFeeder()){
					diffBlocks = this._diffNavigator.getFeeder().getDiffBlocks();
				} else {
					return null;
				}
				
				var annotationIndex = mCompareUtils.getAnnotationIndex(diffBlocks, lineIndex);
				if (annotationIndex === -1){
					return null;
				}
				var mapperIndex = mCompareUtils.getAnnotationMapperIndex(diffBlocks, annotationIndex);
				var mapper;
				mapper = this._diffNavigator.getMapper();
				var conflict = mCompareUtils.isMapperConflict(mapper, mapperIndex);
				if(conflict){
					style.border = "1px #FF0000 solid"; //$NON-NLS-0$
				}
				if(annotationIndex === this._diffNavigator.getCurrentBlockIndex()){
					style.backgroundColor = conflict ? "red" :"blue"; //$NON-NLS-1$ //$NON-NLS-0$
				}
				var anH = this._diffNavigator.getFeeder().getDiffBlockH(annotationIndex);
				var lC = this._diffNavigator.getFeeder().getOverviewLineCount();
				if(anH < 0){
					return null;
				}
				var clientArea = this._editor.getClientArea();
				var height =  Math.floor(clientArea.height*anH/lC);
				if (height < 2){
					height = 2;
				}
				style.height = height +"px"; //$NON-NLS-0$
			} else {
				return null;
			}
		}
		return result;
	};
	CompareOverviewRuler.prototype.setDiffNavigator = function(diffNavigator) {
		this._diffNavigator = diffNavigator;
	};
	CompareOverviewRuler.prototype.getHTML = function(lineIndex) {
		return "&nbsp;"; //$NON-NLS-0$
	};
	CompareOverviewRuler.prototype.onClick = function(lineIndex, e) {
		if (lineIndex === undefined) { return; }
		this._onClick(lineIndex , this);
	};
	CompareOverviewRuler.prototype._onModelChanged = function(e) {
		var model = this._editor.getModel();
		var lineCount = model.getLineCount();
		if(lineCount > 0){
			this._editor.redrawLines(0, 1, this);
		}
	};
	return CompareOverviewRuler;
}());


orion.CompareCurveRuler =  (function() {

	function CompareCurveRuler(canvasDiv) {
		this._canvasDiv = canvasDiv;
		this._mapper = undefined;
	}

	CompareCurveRuler.prototype =  {
		init: function(mapper , leftEditor , rightEditor, diffNavigator ){
			this._leftIniting = true;
			this._rightIniting = true;
			this._rightIniting = true;
			this._mapper = mapper;
			this._leftEditor = leftEditor;
			this._rightEditor = rightEditor;
			this._leftTextView = leftEditor.getTextView();
			this._rightTextView = rightEditor.getTextView();
			this._diffNavigator = diffNavigator;
			this.render();
		},
		
		matchPositionFrom: function(fromLeft){
			var baseEditor = fromLeft ? this._leftTextView : this._rightTextView;
			var matchEditor = fromLeft ? this._rightTextView : this._leftTextView;
			var topLine = baseEditor.getTopIndex();
			var bottomLine = baseEditor.getBottomIndex();
			var matchLine = mCompareUtils.matchMapper(this._mapper , fromLeft ? 0: 1 , topLine , bottomLine);
			matchEditor.setTopIndex(matchLine);
		},

		copyTo: function(left){
			if(!this._diffNavigator.iterator){
				return;
			}
			var currentDiff = this._diffNavigator.iterator.cursor();
			if(currentDiff){
				var shouldCopy;
				if(currentDiff.type === "word") {  //$NON-NLS-0$}
					shouldCopy = (!currentDiff.copied && !currentDiff.parent.copied);
				} else {
					shouldCopy = !currentDiff.copied;
				}
				if(!shouldCopy) {
					return;
				}
				var textToCopy = left ? this._rightTextView.getText(currentDiff.oldA.start , currentDiff.oldA.end) : this._leftTextView.getText(currentDiff.newA.start , currentDiff.newA.end);
				var rangeToPaste = left ? currentDiff.newA :  currentDiff.oldA;
				var viewToPaste = left ? this._leftTextView : this._rightTextView;
				viewToPaste.setText(textToCopy , rangeToPaste.start , rangeToPaste.end);
				currentDiff.copied = true;
			}
		},
	
		render: function(){
			if(!this._mapper){
				return;
			}
			var context=this._canvasDiv.getContext("2d"); //$NON-NLS-0$
			context.clearRect(0,0,this._canvasDiv.width,this._canvasDiv.height);
			context.strokeStyle = '#AAAAAA';  //$NON-NLS-0$
			context.lineWidth   = 1;
			context.beginPath();
			
			var leftTop = this._leftTextView.getTopIndex();
			var leftBottom = this._leftTextView.getBottomIndex();
			var rightTop = this._rightTextView.getTopIndex();
			var rightBottom = this._rightTextView.getBottomIndex();
			this._leftLineH = this._leftTextView.getLineHeight();
			this._rightLineH = this._rightTextView.getLineHeight();
		
			var curLeftIndex = 0;
			var curRightIndex = 0;
			var rendering = false;
			for (var i = 0 ; i < this._mapper.length ; i++){
				if(this._mapper[i][2] !== 0){
					if(mCompareUtils.overlapMapper( this._mapper[i] , 0 , curLeftIndex , leftTop ,leftBottom) ||
							mCompareUtils.overlapMapper( this._mapper[i] , 1 , curRightIndex , rightTop ,rightBottom) ){
						this._renderCurve(i, curLeftIndex , curRightIndex , this._canvasDiv , context , leftTop , leftBottom , rightTop , rightBottom);
						rendering = true;
					} else if (rendering) {
						break;
					}
				}
				curLeftIndex += this._mapper[i][0];
				curRightIndex += this._mapper[i][1];
			}
			context.stroke();		
		},
		
		_renderCurve: function (mapperIndex , leftStart , rightStart , canvas , context , leftTop , leftBottom , rightTop , rightBottom){
			var mapperItem = this._mapper[mapperIndex];
			var leftMiddle =  this._leftTextView.getLinePixel(leftStart + (mapperItem[0]/2)) + (mapperItem[0]%2)*this._leftLineH/3 - this._leftTextView.getTopPixel();
			var rightMiddle =  this._rightTextView.getLinePixel(rightStart + (mapperItem[1]/2)) + (mapperItem[1]%2)*this._rightLineH/3- this._rightTextView.getTopPixel();
			
			var w =  canvas.parentNode.clientWidth;
			
			if(mapperIndex === this._diffNavigator.getCurrentMapperIndex()){
				context.stroke();
				context.strokeStyle = '#000';  //$NON-NLS-0$
				context.lineWidth   = 1;
				context.beginPath();
				context.moveTo(0 , leftMiddle);
				context.bezierCurveTo( w/3, leftMiddle, w*0.666  ,rightMiddle , w ,rightMiddle);
				context.stroke();
				context.strokeStyle = '#AAAAAA';  //$NON-NLS-0$
				context.lineWidth   = 1;
				context.beginPath();
				return;
			}
			context.moveTo(0 , leftMiddle);
			context.bezierCurveTo( w/3, leftMiddle, w*0.666  ,rightMiddle , w ,rightMiddle);
			context.stroke();
		},
		
		onChanged: function(e, isRightSide) {
			var initing = isRightSide ? this._rightIniting : this._leftIniting;
			if(e.removedLineCount !== e.addedLineCount){
				var tView = isRightSide ? this._rightTextView : this._leftTextView;
				if(!initing){
					mCompareUtils.updateMapper(this._mapper , isRightSide ? 1 : 0 , tView.getModel().getLineAtOffset(e.start) , e.removedLineCount, e.addedLineCount);
				}
				if(e.removedLineCount > 0 || e.addedLineCount > 0){
					this.render();
				}
			}
			if(isRightSide) {
				this._rightIniting = false;
			} else {
				this._leftIniting = false;
			}
			return initing;
		}
	};
	return CompareCurveRuler;
}()); 

return orion;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/editor/nls/messages',{
	root: {//Default message bundle
		"multipleAnnotations": "Multiple annotations:", //$NON-NLS-1$ //$NON-NLS-0$
		"line": "Line: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"breakpoint": "Breakpoint", //$NON-NLS-1$ //$NON-NLS-0$
		"bookmark": "Bookmark", //$NON-NLS-1$ //$NON-NLS-0$
		"task": "Task", //$NON-NLS-1$ //$NON-NLS-0$
		"error": "Error", //$NON-NLS-1$ //$NON-NLS-0$
		"warning": "Warning", //$NON-NLS-1$ //$NON-NLS-0$
		"matchingSearch": "Matching Search", //$NON-NLS-1$ //$NON-NLS-0$
		"currentSearch": "Current Search", //$NON-NLS-1$ //$NON-NLS-0$
		"currentLine": "Current Line", //$NON-NLS-1$ //$NON-NLS-0$
		"matchingBracket": "Matching Bracket", //$NON-NLS-1$ //$NON-NLS-0$
		"currentBracket": "Current Bracket", //$NON-NLS-1$ //$NON-NLS-0$
		"diffAdded": "Diff Added Lines", //$NON-NLS-1$ //$NON-NLS-0$
		"diffDeleted": "Diff Deleted Lines", //$NON-NLS-1$ //$NON-NLS-0$
		"diffModified": "Diff Modified Lines", //$NON-NLS-1$ //$NON-NLS-0$
		
		"lineUp": "Line Up", //$NON-NLS-1$ //$NON-NLS-0$
		"lineDown": "Line Down", //$NON-NLS-1$ //$NON-NLS-0$
		"lineStart": "Line Start", //$NON-NLS-1$ //$NON-NLS-0$
		"lineEnd": "Line End", //$NON-NLS-1$ //$NON-NLS-0$
		"charPrevious": "Previous Character", //$NON-NLS-1$ //$NON-NLS-0$
		"charNext": "Next Character", //$NON-NLS-1$ //$NON-NLS-0$
		"pageUp": "Page Up", //$NON-NLS-1$ //$NON-NLS-0$
		"pageDown": "Page Down", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollPageUp": "Scroll Page Up", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollPageDown": "Scroll Page Down", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollLineUp": "Scroll Line Up", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollLineDown": "Scroll Line Down", //$NON-NLS-1$ //$NON-NLS-0$
		"wordPrevious": "Previous Word", //$NON-NLS-1$ //$NON-NLS-0$
		"wordNext": "Next Word", //$NON-NLS-1$ //$NON-NLS-0$
		"textStart": "Document Start", //$NON-NLS-1$ //$NON-NLS-0$
		"textEnd": "Document End", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollTextStart": "Scroll Document Start", //$NON-NLS-1$ //$NON-NLS-0$
		"scrollTextEnd": "Scroll Document End", //$NON-NLS-1$ //$NON-NLS-0$
		"centerLine": "Center Line", //$NON-NLS-1$ //$NON-NLS-0$
		
		"selectLineUp": "Select Line Up", //$NON-NLS-1$ //$NON-NLS-0$
		"selectLineDown": "Select Line Down", //$NON-NLS-1$ //$NON-NLS-0$
		"selectWholeLineUp": " Select Whole Line Up", //$NON-NLS-1$ //$NON-NLS-0$
		"selectWholeLineDown": "Select Whole Line Down", //$NON-NLS-1$ //$NON-NLS-0$
		"selectLineStart": "Select Line Start", //$NON-NLS-1$ //$NON-NLS-0$
		"selectLineEnd": "Select Line End", //$NON-NLS-1$ //$NON-NLS-0$
		"selectCharPrevious": "Select Previous Character", //$NON-NLS-1$ //$NON-NLS-0$
		"selectCharNext": "Select Next Character", //$NON-NLS-1$ //$NON-NLS-0$
		"selectPageUp": "Select Page Up", //$NON-NLS-1$ //$NON-NLS-0$
		"selectPageDown": "Select Page Down", //$NON-NLS-1$ //$NON-NLS-0$
		"selectWordPrevious": "Select Previous Word", //$NON-NLS-1$ //$NON-NLS-0$
		"selectWordNext": "Select Next Word", //$NON-NLS-1$ //$NON-NLS-0$
		"selectTextStart": "Select Document Start", //$NON-NLS-1$ //$NON-NLS-0$
		"selectTextEnd": "Select Document End", //$NON-NLS-1$ //$NON-NLS-0$
	
		"deletePrevious": "Delete Previous Character", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteNext": "Delete Next Character", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteWordPrevious": "Delete Previous Word", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteWordNext": "Delete Next Word", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteLineStart": "Delete Line Start", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteLineEnd": "Delete Line End", //$NON-NLS-1$ //$NON-NLS-0$
		"tab": "Insert Tab", //$NON-NLS-1$ //$NON-NLS-0$
		"enter": "Insert Line Delimiter", //$NON-NLS-1$ //$NON-NLS-0$
		"enterNoCursor": "Insert Line Delimiter", //$NON-NLS-1$ //$NON-NLS-0$
		"escape": "Escape", //$NON-NLS-1$ //$NON-NLS-0$
		"selectAll": "Select All", //$NON-NLS-1$ //$NON-NLS-0$
		"copy": "Copy", //$NON-NLS-1$ //$NON-NLS-0$
		"cut": "Cut", //$NON-NLS-1$ //$NON-NLS-0$
		"paste": "Paste", //$NON-NLS-1$ //$NON-NLS-0$
		
		"uppercase": "To Upper Case", //$NON-NLS-1$ //$NON-NLS-0$
		"lowercase": "To Lower Case", //$NON-NLS-1$ //$NON-NLS-0$
		"capitalize": "Capitalize", //$NON-NLS-1$ //$NON-NLS-0$
		"reversecase" : "Reverse Case", //$NON-NLS-1$ //$NON-NLS-0$
		
		"toggleWrapMode": "Toggle Wrap Mode", //$NON-NLS-1$ //$NON-NLS-0$
		"toggleTabMode": "Toggle Tab Mode", //$NON-NLS-1$ //$NON-NLS-0$
		"toggleOverwriteMode": "Toggle Overwrite Mode", //$NON-NLS-1$ //$NON-NLS-0$
		
		"committerOnTime": "${0} on ${1}", //$NON-NLS-1$ //$NON-NLS-0$
		
		//Emacs
		"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
		"exchangeMarkPoint": "Exchange Mark and Point", //$NON-NLS-1$ //$NON-NLS-0$
		"setMarkCommand": "Set Mark", //$NON-NLS-1$ //$NON-NLS-0$
		"clearMark": "Clear Mark", //$NON-NLS-1$ //$NON-NLS-0$
		"digitArgument": "Digit Argument ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"negativeArgument": "Negative Argument", //$NON-NLS-1$ //$NON-NLS-0$
				
		"Comment": "Comment", //$NON-NLS-1$ //$NON-NLS-0$
		"Flat outline": "Flat outline", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFindStr": "Incremental find: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFindStrNotFound": "Incremental find: ${0} (not found)", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFindReverseStr": "Reverse Incremental find: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFindReverseStrNotFound": "Reverse Incremental find: ${0} (not found)", //$NON-NLS-1$ //$NON-NLS-0$
		"find": "Find...", //$NON-NLS-1$ //$NON-NLS-0$
		"undo": "Undo", //$NON-NLS-1$ //$NON-NLS-0$
		"redo": "Redo", //$NON-NLS-1$ //$NON-NLS-0$
		"cancelMode": "Cancel Current Mode", //$NON-NLS-1$ //$NON-NLS-0$
		"findNext": "Find Next Occurrence", //$NON-NLS-1$ //$NON-NLS-0$
		"findPrevious": "Find Previous Occurrence", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFind": "Incremental Find", //$NON-NLS-1$ //$NON-NLS-0$
		"incrementalFindReverse": "Incremental Find Reverse", //$NON-NLS-1$ //$NON-NLS-0$
		"indentLines": "Indent Lines", //$NON-NLS-1$ //$NON-NLS-0$
		"unindentLines": "Unindent Lines", //$NON-NLS-1$ //$NON-NLS-0$
		"moveLinesUp": "Move Lines Up", //$NON-NLS-1$ //$NON-NLS-0$
		"moveLinesDown": "Move Lines Down", //$NON-NLS-1$ //$NON-NLS-0$
		"copyLinesUp": "Copy Lines Up", //$NON-NLS-1$ //$NON-NLS-0$
		"copyLinesDown": "Copy Lines Down", //$NON-NLS-1$ //$NON-NLS-0$
		"deleteLines": "Delete Lines", //$NON-NLS-1$ //$NON-NLS-0$
		"gotoLine": "Goto Line...", //$NON-NLS-1$ //$NON-NLS-0$
		"gotoLinePrompty": "Goto Line:", //$NON-NLS-1$ //$NON-NLS-0$
		"nextAnnotation": "Next Annotation", //$NON-NLS-1$ //$NON-NLS-0$
		"prevAnnotation": "Previous Annotation", //$NON-NLS-1$ //$NON-NLS-0$
		"expand": "Expand", //$NON-NLS-1$ //$NON-NLS-0$
		"collapse": "Collapse", //$NON-NLS-1$ //$NON-NLS-0$
		"expandAll": "Expand All", //$NON-NLS-1$ //$NON-NLS-0$
		"collapseAll": "Collapse All", //$NON-NLS-1$ //$NON-NLS-0$
		"lastEdit": "Last Edit Location", //$NON-NLS-1$ //$NON-NLS-0$
		"trimTrailingWhitespaces": "Trim Trailing Whitespaces", //$NON-NLS-1$ //$NON-NLS-0$
		"toggleLineComment": "Toggle Line Comment", //$NON-NLS-1$ //$NON-NLS-0$
		"addBlockComment": "Add Block Comment", //$NON-NLS-1$ //$NON-NLS-0$
		"removeBlockComment": "Remove Block Comment", //$NON-NLS-1$ //$NON-NLS-0$
		"linkedModeEntered": "Linked Mode entered", //$NON-NLS-1$ //$NON-NLS-0$
		"linkedModeExited": "Linked Mode exited", //$NON-NLS-1$ //$NON-NLS-0$
		"syntaxError": "Syntax Error", //$NON-NLS-1$ //$NON-NLS-0$
		"contentAssist": "Content Assist", //$NON-NLS-1$ //$NON-NLS-0$
		"lineColumn": "Line ${0} : Column ${1}", //$NON-NLS-1$ //$NON-NLS-0$
		"multiSelections": "${0} selection regions", //$NON-NLS-1$ //$NON-NLS-0$
		
		//vi
		"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
		"vimove": "(Move)", //$NON-NLS-1$ //$NON-NLS-0$
		"viyank": "(Yank)", //$NON-NLS-1$ //$NON-NLS-0$
		"videlete": "(Delete)", //$NON-NLS-1$ //$NON-NLS-0$
		"vichange": "(Change)", //$NON-NLS-1$ //$NON-NLS-0$
		"viLeft": "${0} Left", //$NON-NLS-1$ //$NON-NLS-0$
		"viRight": "${0} Right", //$NON-NLS-1$ //$NON-NLS-0$
		"viUp": "${0} Up", //$NON-NLS-1$ //$NON-NLS-0$
		"viDown": "${0} Down", //$NON-NLS-1$ //$NON-NLS-0$
		"viw": "${0} Next Word", //$NON-NLS-1$ //$NON-NLS-0$
		"vib": "${0} Beginning of Word", //$NON-NLS-1$ //$NON-NLS-0$
		"viW": "${0} Next Word (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
		"viB": "${0} Beginning of Word (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
		"vie": "${0} End of Word", //$NON-NLS-1$ //$NON-NLS-0$
		"viE": "${0} End of Word (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
		"vi$": "${0} End of the line", //$NON-NLS-1$ //$NON-NLS-0$
		"vi^_": "${0} First non-blank Char Current Line", //$NON-NLS-1$ //$NON-NLS-0$
		"vi+": "${0} First Char Next Line", //$NON-NLS-1$ //$NON-NLS-0$
		"vi-": "${0} First Char Previous Line", //$NON-NLS-1$ //$NON-NLS-0$
		"vi|": "${0} nth Column in Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viH": "${0} Top of Page", //$NON-NLS-1$ //$NON-NLS-0$
		"viM": "${0} Middle of Page", //$NON-NLS-1$ //$NON-NLS-0$
		"viL": "${0} Bottom of Page", //$NON-NLS-1$ //$NON-NLS-0$
		"vi/": "${0} Search Forward", //$NON-NLS-1$ //$NON-NLS-0$
		"vi?": "${0} Search Backward", //$NON-NLS-1$ //$NON-NLS-0$
		"vin": "${0} Next Search", //$NON-NLS-1$ //$NON-NLS-0$
		"viN": "${0} Previous Search", //$NON-NLS-1$ //$NON-NLS-0$
		"vif": "${0} Search Char Fwd", //$NON-NLS-1$ //$NON-NLS-0$
		"viF": "${0} Search Char Bckwd", //$NON-NLS-1$ //$NON-NLS-0$
		"vit": "${0} Search Before Char Fwd", //$NON-NLS-1$ //$NON-NLS-0$
		"viT": "${0} Search Before Char Bckwd", //$NON-NLS-1$ //$NON-NLS-0$
		"vi,": "${0} Repeat Reverse Char Search", //$NON-NLS-1$ //$NON-NLS-0$
		"vi;": "${0} Repeat Char Search", //$NON-NLS-1$ //$NON-NLS-0$
		"viG": "${0} Go to Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viycd": "${0} Current Line", //$NON-NLS-1$ //$NON-NLS-0$
		"via": "Append After Cursor", //$NON-NLS-1$ //$NON-NLS-0$
		"viA": "Append to End of Line", //$NON-NLS-1$ //$NON-NLS-0$
		"vii": "Insert Before Cursor", //$NON-NLS-1$ //$NON-NLS-0$
		"viI": "Insert at Beginning of Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viO": "Insert Line Above", //$NON-NLS-1$ //$NON-NLS-0$
		"vio": "Insert Line Below", //$NON-NLS-1$ //$NON-NLS-0$
		"viR": "Begin Overwriting Text", //$NON-NLS-1$ //$NON-NLS-0$
		"vis": "Substitute a Character", //$NON-NLS-1$ //$NON-NLS-0$
		"viS": "Substitute Entire Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viC": "Change Text Until Line End", //$NON-NLS-1$ //$NON-NLS-0$
		"vip": "Paste After Char or Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viP": "Paste Before Char or Line", //$NON-NLS-1$ //$NON-NLS-0$
		"viStar": "Search Word Under Cursor", //$NON-NLS-1$ //$NON-NLS-0$
		
		"next": "Next", //$NON-NLS-1$ //$NON-NLS-0$
		"previous": "Previous", //$NON-NLS-1$ //$NON-NLS-0$
		"replace": "Replace", //$NON-NLS-1$ //$NON-NLS-0$
		"replaceAll": "Replace All", //$NON-NLS-1$ //$NON-NLS-0$
		"findWith": "Find With", //$NON-NLS-1$ //$NON-NLS-0$
		"replaceWith": "Replace With", //$NON-NLS-1$ //$NON-NLS-0$
		"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
		"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
		"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
		"caseInsensitiveTooltip": "Toggle Case Insensitive", //$NON-NLS-1$ //$NON-NLS-0$
		"regexTooltip": "Toggle Regex", //$NON-NLS-1$ //$NON-NLS-0$
		"wholeWordTooltip": "Toggle Whole Word", //$NON-NLS-1$ //$NON-NLS-0$
		"closeTooltip": "Close", //$NON-NLS-1$ //$NON-NLS-0$
	
		"replacingAll": "Replacing all...", //$NON-NLS-1$ //$NON-NLS-0$
		"replacedMatches": "Replaced ${0} matches", //$NON-NLS-1$ //$NON-NLS-0$
		"nothingReplaced": "Nothing replaced", //$NON-NLS-1$ //$NON-NLS-0$
		"notFound": "Not found" //$NON-NLS-1$ //$NON-NLS-0$
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/ja/messages',{
	"multipleAnnotations": "複数の注釈:", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "行: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "ブレークポイント", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "ブックマーク", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "タスク", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "エラー", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "警告", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "一致検索", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "現行検索", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "現在行", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "対応する大括弧", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "現行大括弧", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "1 行上へ", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "1 行下へ", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "行の先頭", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "行の末尾", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "前の文字", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "次の文字", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Page Up", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Page Down", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "ページのスクロールアップ", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "ページのスクロールダウン", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "行のスクロールアップ", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "行のスクロールダウン", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "前の単語", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "次の単語", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "文書の開始", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "文書の終了", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "文書の開始のスクロール", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "文書の終了のスクロール", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "中心線", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "行を上に選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "行を下に選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " 行の全体を上に選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "行の全体を下に選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "行の先頭まで選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "行の末尾まで選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "前の文字を選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "次の文字を選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "ページの上部まで選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "ページの下部まで選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "前の単語を選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "次の単語を選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "文書の開始の選択", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "文書の終了の選択", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "前の文字を削除", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "次の文字を削除", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "前の単語を削除", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "次の単語を削除", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "行の先頭まで削除", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "行の末尾まで削除", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "タブを挿入", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "行区切り文字を挿入", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "行区切り文字を挿入", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "すべて選択", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "コピー", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "切り取り", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "貼り付け", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "大文字に変更", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "小文字に変更", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "先頭文字のみ大文字", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "大文字/小文字を反転", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "折り返しモードの切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "タブ・モードの切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "上書きモードの切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} (時刻: ${1})", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "マークとポイントの交換", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "マークの設定", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "マークのクリア", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "数字の引数 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "負の引数", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "コメント", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "フラット・アウトライン", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "インクリメンタル検索: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "インクリメンタル検索: ${0} (未検出)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "逆方向のインクリメンタル検索: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "逆方向のインクリメンタル検索: ${0} (見つかりません)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "検索...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "元に戻す", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "やり直し", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "現行モードのキャンセル", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "次のオカレンスの検索", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "前のオカレンスの検索", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "インクリメンタル検索", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "逆インクリメンタル検索", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "行のインデント", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "行のインデントを解除", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "行を上へ移動", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "行を下へ移動", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "行を上へコピー", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "行を下へコピー", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "行削除", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "行への移動...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "移動先の行:", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "次の注釈", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "前の注釈", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "展開", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "省略", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "すべて展開", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "すべて省略表示", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "最後の編集位置", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "末尾の空白を削除", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "行コメントの切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "ブロック・コメントの追加", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "ブロック・コメントの削除", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "リンクされたモードに入りました", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "リンクされたモードを終了しました", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "構文エラー", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "コンテンツ・アシスト", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "${0} 行 : ${1} 列", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(移動)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(ヤンク)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(削除)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(変更)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} 左", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} 右", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} 上", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} 下", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} 次の単語", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} 単語の開始", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} 次の単語 (空白文字停止)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} 単語の開始 (空白文字停止)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} 単語の終わり", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} 単語の終わり (空白文字停止)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} 行の終わり", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} 現在行の最初の非ブランク文字", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} 次の行の最初の文字", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} 前の行の最初の文字", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} 行内の n 番目の列", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} ページの先頭", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} ページの中央", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} ページの下部", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} 順方向検索", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} 逆方向検索", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} 次の検索", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} 前の検索", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} 文字を順方向に検索", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} 文字を逆方向に検索", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} 文字を順方向に検索 (キャレットは 1 スペース前)", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} 文字を逆方向に検索 (キャレットは 1 スペース前)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} 文字検索を逆方向で繰り返す", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} 文字検索を繰り返す", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} 指定行へジャンプ", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} 現在行", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "カーソルの後ろに追加", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "行末に追加", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "カーソルの前に追加", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "行の先頭に追加", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "上に行を挿入", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "下に行を挿入", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "テキストの上書きを開始", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "文字の置換", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "行全体の置換", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "テキストを行末まで変更", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "文字または行の後ろに貼り付け", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "文字または行の前に貼り付け", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "カーソル位置の単語を検索", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "次へ", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "前へ", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "置換", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "すべて置換", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "検索内容", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "置換", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "大/小文字の区別の有無を切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "正規表現を切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "完全一致が必要かどうかを切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "閉じる", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "すべてを置換中...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "${0} 個の一致を置換しました", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "何も置き換えられていません", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "未検出" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/zh/messages',{
	"multipleAnnotations": "多个注释：", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "行：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "断点", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "书签", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "任务", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "错误", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "警告", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "相匹配的搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "当前搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "当前行", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "配对的方括号", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "当前方括号", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "上移", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "下移", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "行首", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "行末", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "前一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "下一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "向上翻页", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "向下翻页", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "将页面向上滚动", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "将页面向下滚动", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "向上滚动一行", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "向下滚动一行", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "上一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "下一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "文档开头", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "文档末尾", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "滚动文档开头", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "滚动文档末尾", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "中心行", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "选择上一行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "选择下一行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " 选择整个上一行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "选择整个下一行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "选择行首", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "选择行末", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "选择前一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "选择下一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "选择页面顶部", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "选择页面底部", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "选择上一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "选择下一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "选择文档开头", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "选择文档末尾", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "删除前一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "删除下一个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "删除上一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "删除下一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "删除行首", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "删除行末", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "插入制表符", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "插入行定界符", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "插入行定界符", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "全选", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "复制", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "剪切", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "粘贴", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "更改为大写", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "更改为小写", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "转为大写", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "撤销大小写", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "切换回绕方式", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "切换跳格方式", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "切换改写方式", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} 于 ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "交换标记和点", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "设置标记", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "清除标记", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "数字自变量 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "负数自变量", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "注释", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "平面大纲", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "增量查找：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "增量查找：${0}（找不到）", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "逆向增量查找：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "逆向增量查找：${0}（找不到）", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "查找...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "撤销", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "重做", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "取消当前方式", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "查找下一个实例", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "查找上一个实例", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "增量查找", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "逆向增量查找", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "缩进行", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "非缩进行", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "将行上移", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "将行下移", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "向上复制行", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "向下复制行", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "删除行", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "转至行...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "转至行：", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "下一个注释", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "上一个注释", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "展开", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "折叠", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "全部展开", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "全部折叠", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "上一个编辑位置", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "删除结尾空格", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "切换行注释", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "添加块注释", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "除去块注释", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "已进入链接方式", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "已退出链接方式", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "语法错误", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "内容辅助", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "第 ${0} 行：第 ${1} 列", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "（移动）", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "（拖拽）", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "（删除）", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "（更改）", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0}左对齐", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0}右对齐", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0}向上", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0}向下", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0}下一个单词", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0}单词开头", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0}下一个单词 (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0}单词开头 (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0}单词结尾", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0}单词结尾 (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0}行结尾", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0}当前行首个非空字符", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0}下一行首个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0}前一行首个字符", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0}行中的 nth 列", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0}页首", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0}页中", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0}页底", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0}向前搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0}向后搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0}下一个搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0}前一个搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0}向前搜索字符", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0}向后搜索字符", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0}在字符前向前搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0}在字符前向后搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0}重复撤销字符搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0}重复字符搜索", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0}转至行", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0}当前行", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "在光标后追加", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "追加到行结尾", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "在光标前插入", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "在行首插入", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "在行上插入", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "在行下插入", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "开始覆盖文本", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "替换字符", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "替换整行", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "更改文本直到行末", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "在字符后或行后粘贴", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "在字符后或行前粘贴", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "在光标下方搜索词语", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "下一个", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "上一个", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "替换", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "全部替换", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "查找方式", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "替换为", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "切换不区分大小写", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "切换正则表达式", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "切换整个词语", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "关闭", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "正在全部替换...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "已替换 ${0} 个匹配项", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "未替换任何对象", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "找不到" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/zh-tw/messages',{
	"multipleAnnotations": "多個註釋：", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "行：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "岔斷點", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "書籤", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "作業", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "錯誤", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "警告", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "符合搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "現行搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "現行行", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "對稱的方括弧", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "現行方括弧", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "上移一行", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "下移一行", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "行首", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "前一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "下一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "上一頁", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "下一頁", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "往上捲動頁面", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "往下捲動頁面", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "上捲一行", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "下捲一行", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "上一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "下一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "文件開頭", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "文件末尾", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "捲動到文件開頭", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "捲動到文件末尾", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "中線", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "往上選取字行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "往下選取字行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " 往上選取整行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "往下選取整行", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "選取行首", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "選取行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "選取前一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "選取下一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "往上選取頁面", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "往下選取頁面", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "選取上一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "選取下一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "選取文件開頭", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "選取文件末尾", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "刪除前一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "刪除下一個字元", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "刪除上一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "刪除下一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "刪除行首", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "刪除行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "插入欄標", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "插入行定界字元", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "插入行定界字元", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "全選", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "複製", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "剪下", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "貼上", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "成為大寫", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "成為小寫", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "字母大小寫", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "反向大小寫", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "切換折行模式", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "切換欄標模式", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "切換改寫模式", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} 於 ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "交換標示和點", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "設定標示", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "清除標示", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "數字引數 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "負數引數", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "註解", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "平面大綱", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "漸進式尋找：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "漸進式尋找：${0}（找不到）", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "反向漸進式尋找：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "反向漸進式尋找：${0}（找不到）", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "尋找...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "復原", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "重做", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "取消現行模式", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "尋找下一個出現項目", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "尋找上一個出現項目", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "漸進式尋找", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "逆向漸進式尋找", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "縮排行", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "取消縮排行", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "將各行向上移動", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "將各行向下移動", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "將行向上複製", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "將行向下複製", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "刪除行", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "移至行...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "移至行：", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "下一個註釋", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "上一個註釋", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "展開", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "收合", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "全部展開", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "全部收合", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "前次編輯位置", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "修整尾端空格", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "切換行註解", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "新增區塊註解", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "移除區塊註解", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "進入鏈結模式", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "離開鏈結模式", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "語法錯誤", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "內容輔助", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "行 ${0}：欄 ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "（移動）", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "（召回）", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "（刪除）", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "（變更）", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} 左", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} 右", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} 上", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} 下", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} 下一個單字", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} 單字的開頭", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} 下一個單字（ws 停止）", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} 單字的開頭（ws 停止）", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} 單字的結尾", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} 單字的結尾（ws 停止）", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} 行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} 第一個非空白字元現行行", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} 第一個字元下一行", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} 第一個字元上一行", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} 行的第 n 欄", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} 頁面頂端", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} 頁面中間", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} 頁面底端", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} 向前搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} 向後搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} 下一個搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} 上一個搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} 向前搜尋字元", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} 向後搜尋字元", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} 在字元之前向前搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} 在字元之前向後搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} 重複反向字元搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} 重複字元搜尋", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} 移至行", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} 現行行", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "附加在游標之後", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "附加在行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "插入在游標之前", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "插入在行首", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "插入上方列", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "插入下方列", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "開始改寫文字", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "替換字元", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "替換整行", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "變更文字直到行尾", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "貼在字元或行之後", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "貼在字元或行之前", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "搜尋游標之下的單字", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "下一步", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "上一步", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "取代", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "全部取代", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "尋找", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "取代為", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "切換區分大小寫", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "切換正規表示式", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "切換完整單字", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "關閉", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "正在全部取代...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "已取代 ${0} 個相符項", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "未取代", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "找不到" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/fr/messages',{
	"multipleAnnotations": "Plusieurs annotations :", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "Ligne : ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "Point d'arrêt", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "Signet", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "Tâche", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "Erreur", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "Avertissement", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "Recherche correspondante", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "Recherche en cours", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "Ligne en cours", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "Crochet correspondant", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "Crochet en cours", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "Ligne précédente", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "Ligne suivante", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "Début de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "Fin de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "Caractère précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "Caractère suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Page arrière", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Page avant", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "Faire défiler la page vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "Faire défiler la page vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "Défiler vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "Défiler vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "Mot précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "Mot suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "Début du document", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "Fin du document", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "Aller au début du document", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "Aller à la fin du document", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "Ligne centrale", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "Sélectionner la ligne vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "Sélectionner la ligne vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " Sélectionner la ligne entière vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "Sélectionner la ligne entière vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "Sélectionner début de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "Sélectionner fin de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "Sélectionner le caractère précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "Sélectionner le caractère suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "Sélectionner haut de page", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "Sélectionner bas de page", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "Sélectionner mot précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "Sélectionner mot suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "Sélectionner le début du document", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "Sélectionner la fin du document", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "Supprimer le caractère précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "Supprimer le caractère suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "Supprimer le mot précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "Supprimer le mot suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "Supprimer le début de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "Supprimer la fin de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "Insérer une tabulation", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "Insérer un délimiteur de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "Insérer un délimiteur de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "Sélectionner tout", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "Copier", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "Couper", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "Coller", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "Majuscule", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "Minuscule", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "Mettre en majuscules", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "Inverser la casse", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "Activer/désactiver le mode retour à la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "Activer/désactiver le mode tabulation", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "Activer/Désactiver le mode remplacement", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} le ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "Echanger la marque et le point", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "Définir une marque", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "Effacer la marque", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "Argument numérique ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "Argument négatif", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "Mettre en commentaire", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "Nomenclature non hiérarchique", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "Recherche incrémentielle : ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "Recherche incrémentielle : ${0} (non trouvé)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "Recherche incrémentielle inversée : ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "Recherche incrémentielle inversée : ${0} (introuvable)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "Rechercher...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "Annuler", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "Répéter", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "Annuler le mode en cours", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "Rechercher l'occurrence suivante", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "Rechercher l'occurrence précédente", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "Recherche incrémentielle", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "Recherche incrémentielle inversée", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "Appliquer un retrait de lignes", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "Supprimer le retrait de lignes", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "Déplacer les lignes vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "Déplacer les lignes vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "Copier les lignes au-dessus", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "Copier les lignes en dessous", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "Supprimer les lignes", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Accéder à la ligne...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "Accéder à la ligne :", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "Annotation suivante", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "Annotation précédente", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "Développer", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "Réduire", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "Développer tout", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "Réduire tout", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "Dernier emplacement d'édition", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "Supprimer les espaces de fin", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "Activer/désactiver le commentaire de ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "Ajouter une mise en commentaire de bloc", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "Supprimer une mise en commentaire de bloc", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "Entrée en mode lié", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "Sortie du mode lié", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "Erreur de syntaxe", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "Affiche l'assistant de contenu", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "Ligne ${0} : Col ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(Déplacer)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(Coller)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(Supprimer)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(Changer)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} Gauche", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} Droite", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} Vers le haut", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} Vers le bas", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} Mot suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} Début du mot", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} Mot suivant (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} Début du mot (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} Fin du mot", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} Fin du mot (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} Fin de la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} Premier caractère non blanc sur la ligne en cours", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} Premier caractère sur la ligne suivante", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} Premier caractère sur la ligne précédente", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} Nième colonne sur la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} Haut de page", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} Milieu de page", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} Bas de page", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} Rechercher en avant", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} Rechercher en arrière", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} Recherche suivante", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} Recherche précédente", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} Rechercher le caractère en avant", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} Rechercher le caractère en arrière", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} Rechercher le caractère en avant et placer le caret un espace avant", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} Rechercher le caractère en arrière et placer le caret un espace avant", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} Répéter la recherche du caractère dans le sens inverse", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} Répéter la recherche du caractère", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} Aller à la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} Ligne en cours", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "Ajouter après le curseur", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "Ajouter à la fin de la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "Insérer avant le curseur", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "Insérer au début de la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "Insérer une ligne au-dessus", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "Insérer une ligne en dessous", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "Commencer à remplacer le texte", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "Substituer un caractère", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "Substituer une ligne entière", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "Changer le texte jusqu'à la ligne de fin", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "Coller après le caractère ou la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "Coller avant le caractère ou la ligne", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "Rechercher le mot sous le curseur", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "Suivant", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "Précédent", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "Remplacement", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "Remplacer tout", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "Rechercher avec", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "Remplacer par", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "Activer/désactiver l'insensibilité à la casse", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "Activer/désactiver l'expression régulière", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "Activer/désactiver le mot entier", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "Fermer", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "Remplacement global en cours...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "${0} correspondance(s) remplacée(s)", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "Aucun élément remplacé", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "Introuvable" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/de/messages',{
	"multipleAnnotations": "Mehrere Anmerkungen:", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "Zeile: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "Unterbrechungspunkt", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "Lesezeichen", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "Aufgabe", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "Fehler", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "Warnung", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "Übereinstimmung mit Suchbegriff", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "Aktuelle Suche", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "Aktuelle Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "Übereinstimmende eckige Klammer", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "Aktuelle eckige Klammer", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "Zeile nach oben", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "Zeile nach unten", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "Zeilenanfang", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "Zeilenende", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "Vorheriges Zeichen", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "Nächstes Zeichen", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Zurückblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Vorblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "Seite zurückblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "Seite vorblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "Zeile zurückblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "Zeile vorblättern", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "Vorheriges Wort", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "Nächstes Wort", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "Dokumentanfang", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "Dokumentende", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "Zum Dokumentanfang blättern", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "Zum Dokumentende blättern", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "Mittellinie", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "Vorherige Zeile auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "Folgezeile auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " Ganze vorherige Zeile auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "Ganze Folgezeile auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "Bis Zeilenanfang auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "Bis Zeilenende auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "Vorheriges Zeichen auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "Nächstes Zeichen auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "Bis Seitenanfang auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "Bis Seitenende auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "Vorheriges Wort auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "Nächstes Wort auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "Bis Dokumentanfang auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "Bis Dokumentende auswählen", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "Vorheriges Zeichen löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "Nächstes Zeichen löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "Vorheriges Wort löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "Nächstes Wort löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "Bis Zeilenanfang löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "Bis Zeilenende auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "Tabulator einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "Zeilenbegrenzer einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "Zeilenbegrenzer einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "Alles auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "Kopieren", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "Ausschneiden", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "Einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "In Großbuchstaben", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "In Kleinbuchstaben", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "In Großbuchstaben", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "Schreibung umkehren", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "Umbruchmodus umschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "Tabulatormodus umschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "Überschreibungsmodus umschalten", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} am ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "Markierung und Punkt austauschen", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "Markierung setzen", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "Markierung löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "Ziffernargument ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "Negatives Argument", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "Kommentar", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "Unstrukturierte Gliederung", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "Schrittweise suchen: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "Schrittweise suchen: ${0} (nicht gefunden)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "Schrittweise Suche zurücksetzen: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "Schrittweise Suche zurücksetzen: ${0} (nicht gefunden)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "Suchen...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "Widerrufen", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "Widerruf zurücknehmen", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "Aktuellen Modus abbrechen", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "Nächstes Vorkommen suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "Vorheriges Vorkommen suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "Schrittweise suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "Schrittweise Suche rückwärts", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "Zeilen einrücken", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "Zeileneinrückung aufheben", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "Zeilen nach oben verschieben", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "Zeilen nach unten verschieben", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "Zeilen nach oben kopieren", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "Zeilen nach unten kopieren", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "Zeilen löschen", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Wechseln zu Zeile...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "Weiter mit Zeile:", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "Nächste Anmerkung", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "Vorherige Anmerkung", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "Einblenden", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "Ausblenden", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "Alles einblenden", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "Alles ausblenden", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "Letzte Bearbeitungsposition", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "Abschließende Leerzeichen abschneiden", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "Kommentarzeile ein-/ausschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "Blockkommentar hinzufügen", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "Blockkommentar entfernen", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "Verknüpfter Modus aktiviert", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "Verknüpfter Modus beendet", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "Syntaxfehler", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "Inhaltshilfe", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "Zeile ${0} : Spalte ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(Verschieben)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(In den Speicher stellen)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(Löschen)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(Ändern)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} Links", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} Rechts", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} Nach oben", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} Nach unten", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} Nächstes Wort", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} Beginn des Worts", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} Nächstes Wort (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} Beginn des Worts (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} Ende des Worts", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} Ende des Worts (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} Ende der Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} Erstes belegtes Zeichen in der aktuellen Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} Erstes Zeichen nächste Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} Erstes Zeichen vorherige Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} nte Spalte in Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} Seitenanfang", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} Seitenmitte", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} Seitenende", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} Vorwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} Rückwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} Nächste Suche", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} Vorherige Suche", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} Zeichen vorwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} Zeichen rückwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} Vor dem Zeichen vorwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} Nach dem Zeichen rückwärts suchen", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} Umgekehrte Zeichensuche wiederholen", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} Zeichensuche wiederholen", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} Gehe zu Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} Aktuelle Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "Nach Cursor anhängen", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "An Zeilenende anhängen", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "Vor Cursor einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "Am Zeilenanfang einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "Zeile darüber einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "Zeile darunter einfügen", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "Überschreiben von Text beginnen", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "Zeichen ersetzen", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "Gesamte Zeile ersetzen", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "Bis Zeilenende ändern", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "Einfügen nach Zeichen oder Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "Einfügen vor Zeichen oder Zeile", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "Wort nach Cursor suchen", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "Nächste", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "Vorherige", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "Ersetzen", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "Global ersetzen", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "Suchen mit", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "Ersetzen durch", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "Beachtung von Groß-/Kleinschreibung umschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "Regulären Ausdruck wechseln", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "Ganzes Wort umschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "Schließen", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "Alle ersetzen...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "${0} Übereinstimmungen ersetzt", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "Nichts ersetzt", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "Nicht gefunden" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/it/messages',{
	"multipleAnnotations": "Annotazioni multiple:", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "Riga: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "Punto di interruzione", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "Segnalibro", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "Attività", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "Errore", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "Avviso", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "Ricerca corrispondente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "Ricerca corrente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "Riga corrente", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "Parentesi corrispondente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "Parentesi corrente", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "Riga su", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "Riga giù", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "Inizio riga", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "Fine riga", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "Carattere precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "Carattere successivo", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Pagina su", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Pagina giù", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "Scorri pagina su", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "Scorri pagina giù", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "Scorri di una riga in alto", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "Scorri di una riga in basso", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "Parola precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "Parola successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "Inizio documento", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "Fine documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "Scorri inizio documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "Scorri fine documento", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "Linea di centro", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "Seleziona riga su", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "Seleziona riga giù", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " Seleziona tutta la riga su", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "Seleziona tutta la riga giù", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "Seleziona inizio riga", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "Seleziona fine riga", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "Seleziona carattere precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "Seleziona carattere successivo", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "Seleziona pagina su", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "Seleziona pagina giù", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "Seleziona parola precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "Seleziona parola successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "Seleziona inizio documento", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "Seleziona fine documento", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "Elimina carattere precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "Elimina carattere successivo", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "Elimina parola precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "Elimina parola successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "Elimina inizio riga", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "Elimina fine riga", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "Inserisci tabulazione", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "Inserisci delimitatore di riga", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "Inserisci delimitatore di riga", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "Seleziona tutto", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "Copia", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "Taglia", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "Incolla", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "In maiuscolo", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "In minuscolo", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "Iniziale maiuscola", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "Inverti maiuscolo/minuscolo", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "Attiva/disattiva modalità a capo", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "Attiva/disattiva modalità di tabulazione", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "Attiva/disattiva modalità Sovrascrivi", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} su ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "Scambia contrassegno e punto", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "Imposta contrassegno", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "Cancella contrassegno", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "Argomento cifra ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "Argomento negativo", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "Commento", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "Descrizione semplice", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "Ricerca incrementale: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "Ricerca incrementale: ${0} (non trovata)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "Ricerca incrementale inversa: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "Ricerca incrementale inversa: ${0} (non trovata)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "Trova...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "Annulla", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "Riesegui", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "Annulla modalità corrente", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "Trova ricorrenza successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "Trova ricorrenza precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "Ricerca incrementale", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "Inversione ricerca incrementale", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "Rientro righe", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "Annulla rientro righe", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "Sposta righe verso l'alto", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "Sposta righe verso il basso", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "Copia righe in alto", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "Copia righe in basso", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "Elimina righe", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Vai alla riga...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "Vai alla riga:", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "Annotazione successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "Annotazione precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "Espandi", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "Comprimi", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "Espandi tutto", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "Riduci tutto", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "Posizione ultima modifica", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "Taglia spazi finali", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "Attiva/disattiva commento riga", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "Aggiungi commento al blocco", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "Rimuovi commento dal blocco", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "Entrata in modalità collegata", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "Uscita dalla modalità collegata", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "Errore di sintassi", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "Assistente ai contenuti", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "Riga ${0} : Col ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(Sposta)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(Strappa)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(Elimina)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(Modifica)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} Sinistra", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} Destra", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} Su", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} Giù", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} Parola successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} Inizio della parola", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} Parola successiva (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} Inizio della parola (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} Fine della parola", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} Fine della parola (ws stop)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} Fine della riga", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} Riga corrente primo carattere non vuoto", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} Riga successiva primo carattere", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} Riga precedente primo carattere", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} ennesima colonna nella riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} Inizio pagina", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} Metà pagina", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} Fine pagina", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} Ricerca avanti", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} Ricerca indietro", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} Ricerca successiva", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} Ricerca precedente", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} Ricerca carattere avanti", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} Ricerca carattere indietro", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} Ricerca prima del carattere avanti", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} Ricerca prima del carattere indietro", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} Ripeti ricerca carattere inverso", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} Ripeti ricerca carattere", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} Vai alla riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} Riga corrente", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "Accoda dopo cursore", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "Accoda alla fine del file", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "Inserisci prima del cursore", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "Inserisci all'inizio della riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "Inserisci sopra riga", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "Inserisci sotto riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "Inizia sovrascrittura testo", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "Sostituisci un carattere", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "Sostituisci intera riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "Modifica testo fino alla fine della riga", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "Incolla dopo carattere o riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "Incolla prima del carattere o riga", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "Ricerca parola sotto al cursore", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "Avanti", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "Indietro", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "Sostituisci", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "Sostituisci tutto", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "Trova con", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "Sostituisci con", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "Attiva/disattiva non sensibile al maiuscolo/minuscolo", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "Attiva/disattiva Regex", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "Attiva/disattiva intera parola", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "Chiuso", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "Sostituzione completa...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "Sostituito ${0} corrispondenze", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "Nessuna sostituzione", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "Non trovato" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/es/messages',{
	"multipleAnnotations": "Varias anotaciones:", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "Línea: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "Punto de interrupción", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "Marcador", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "Tarea", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "Error", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "Aviso", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "Búsqueda coincidente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "Búsqueda actual", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "Línea actual", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "Corchete coincidente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "Corchete actual", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "Retroceso línea", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "Avance línea", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "Inicio de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "Final de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "Carácter anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "Carácter siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Retroceder página", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Avanzar página", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "Desplazar página hacia arriba", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "Desplazar página hacia abajo", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "Desplazar línea hacia arriba", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "Desplazar línea hacia abajo", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "Palabra anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "Palabra siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "Inicio de documento", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "Fin de documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "Desplazar a inicio de documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "Desplazar a fin de documento", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "Línea central", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "Seleccionar línea de arriba", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "Seleccionar línea de abajo", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " Seleccionar línea de arriba completa", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "Seleccionar línea de abajo completa", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "Seleccionar hasta el inicio de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "Seleccionar hasta el final de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "Seleccionar carácter anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "Seleccionar carácter siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "Seleccionar hasta el inicio de página", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "Seleccionar hasta el final de página", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "Seleccionar palabra anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "Seleccionar palabra siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "Seleccionar inicio de documento", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "Seleccionar fin de documento", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "Suprimir carácter anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "Suprimir carácter siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "Suprimir palabra anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "Suprimir palabra siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "Suprimir inicio de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "Suprimir final de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "Insertar tabulador", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "Insertar delimitador de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "Insertar delimitador de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "Seleccionar todo", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "Copiar", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "Cortar", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "Pegar", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "En mayúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "En minúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "Mayúscula inicial", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "Invertir mayúsculas/minúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "Conmutar modalidad de recorte", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "Conmutar modalidad de tabulación", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "Conmutar modalidad de sobrescritura", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0} en ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "Intercambiar marca y punto", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "Establecer marca", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "Borrar marca", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "Argumento de dígito ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "Argumento negativo", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "Comentario", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "Esquema plano", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "Búsqueda incremental: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "Búsqueda incremental: ${0} (no encontrado)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "Búsqueda incremental inversa: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "Búsqueda incremental inversa: ${0} (no encontrado)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "Buscar...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "Deshacer", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "Rehacer", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "Cancelar modalidad actual", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "Buscar siguiente aparición", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "Buscar aparición anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "Búsqueda incremental", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "Búsqueda incremental inversa", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "Sangrar líneas", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "Deshacer sangrado de líneas", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "Subir líneas", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "Bajar líneas", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "Copiar líneas arriba", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "Copiar líneas abajo", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "Suprimir líneas", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Ir a línea...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "Ir a línea:", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "Siguiente anotación", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "Anotación anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "Expandir", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "Contraer", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "Expandir todo", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "Contraer todo", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "Última ubicación de edición", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "Recortar espacios en blanco finales", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "Conmutar comentario de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "Añadir comentario de bloque", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "Eliminar comentario de bloque", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "Modalidad enlazada en la que se ha entrado", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "Modalidad enlazada de la que se ha salido", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "Error de sintaxis", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "Asistencia de contenido", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "Línea ${0} : Col ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(Mover)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(Copiar)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(Suprimir)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(Cambiar)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} Izquierda", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} Derecha", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} Arriba", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} Abajo", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} Palabra siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} Inicio de palabra", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} Palabra siguiente (detención de ws)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} Inicio de palabra (detención de ws)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} Fin de palabra", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} Fin de palabra (detención de ws)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} Fin de la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} Primer carácter no en blanco de línea actual", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} Primer carácter de línea siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} Primer carácter de línea anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} Enésima columna de la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} Inicio de página", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} Mitad de página", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} Final de página", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} Buscar hacia delante", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} Buscar hacia atrás", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} Búsqueda siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} Búsqueda anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} Buscar carácter hacia delante", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} Buscar carácter hacia atrás", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} Buscar antes de carácter hacia delante", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} Buscar antes de carácter hacia atrás", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} Repetir búsqueda de carácter inversa", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} Repetir búsqueda de carácter", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} Ir a línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} Línea actual", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "Añadir tras cursor", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "Añadir al final de línea", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "Insertar antes de cursor", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "Insertar al principio de la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "Insertar línea encima", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "Insertar línea debajo", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "Empezar a sobrescribir texto", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "Sustituir un carácter", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "Sustituir toda la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "Cambiar texto hasta el final de la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "Pegar detrás del carácter o la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "Pegar antes del carácter o la línea", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "Buscar palabra bajo cursor", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "Siguiente", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "Sustituir", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "Sustituir todo", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "Buscar con", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "Sustituir por", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "Conmutar insensibilidad a mayúsculas/minúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "Conmutar expresión regular", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "Conmutar palabra completa", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "Cerrar", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "Sustituir todo...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "Se han sustituido ${0} coincidencias", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "Nada sustituido", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "No encontrado" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

//NLS_CHARSET=UTF-8

/*eslint-env browser, amd*/

define('orion/editor/nls/pt-br/messages',{
	"multipleAnnotations": "Anotações Múltiplas:", //$NON-NLS-1$ //$NON-NLS-0$
	"line": "Linha: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"breakpoint": "Ponto de Interrupção", //$NON-NLS-1$ //$NON-NLS-0$
	"bookmark": "Favoritos", //$NON-NLS-1$ //$NON-NLS-0$
	"task": "Tarefa", //$NON-NLS-1$ //$NON-NLS-0$
	"error": "Erro", //$NON-NLS-1$ //$NON-NLS-0$
	"warning": "Aviso", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingSearch": "Procura Correspondente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentSearch": "Procura Atual", //$NON-NLS-1$ //$NON-NLS-0$
	"currentLine": "Linha Atual", //$NON-NLS-1$ //$NON-NLS-0$
	"matchingBracket": "Colchete Correspondente", //$NON-NLS-1$ //$NON-NLS-0$
	"currentBracket": "Colchete Atual", //$NON-NLS-1$ //$NON-NLS-0$
	
	"lineUp": "Linha Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"lineDown": "Linha Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"lineStart": "Início da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"lineEnd": "Final da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"charPrevious": "Caractere Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"charNext": "Próximo Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"pageUp": "Página Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"pageDown": "Página Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageUp": "Rolar Página para Cima", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollPageDown": "Rolar Página para Baixo", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineUp": "Rolar Linha para Cima", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollLineDown": "Rolar Linha para Baixo", //$NON-NLS-1$ //$NON-NLS-0$
	"wordPrevious": "Palavra Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"wordNext": "Próxima Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"textStart": "Início do Documento", //$NON-NLS-1$ //$NON-NLS-0$
	"textEnd": "Fim do Documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextStart": "Rolar para o Início do Documento", //$NON-NLS-1$ //$NON-NLS-0$
	"scrollTextEnd": "Rolar Para o Fim do Documento", //$NON-NLS-1$ //$NON-NLS-0$
	"centerLine": "Center Line", //$NON-NLS-1$ //$NON-NLS-0$
	
	"selectLineUp": "Selecionar Linha Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineDown": "Selecionar Linha para Baixo", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineUp": " Selecionar Toda Linha Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWholeLineDown": "Selecionar Toda Linha Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineStart": "Selecionar Início da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"selectLineEnd": "Selecionar Final da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharPrevious": "Selecione Caractere Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"selectCharNext": "Selecionar o Próximo Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageUp": "Selecionar Página para Cima", //$NON-NLS-1$ //$NON-NLS-0$
	"selectPageDown": "Selecionar Página para Baixo", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordPrevious": "Selecionar Palavra Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"selectWordNext": "Selecionar Próxima Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextStart": "Selecionar Início do Documento", //$NON-NLS-1$ //$NON-NLS-0$
	"selectTextEnd": "Selecione Fim do Documento", //$NON-NLS-1$ //$NON-NLS-0$

	"deletePrevious": "Excluir Caractere Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteNext": "Excluir Próxima Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordPrevious": "Excluir Palavra Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteWordNext": "Excluir Próxima Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineStart": "Excluir Início da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLineEnd": "Excluir Fim da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"tab": "Guia Inserir", //$NON-NLS-1$ //$NON-NLS-0$
	"enter": "Inserir Delimitador de Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"enterNoCursor": "Inserir Delimitador de Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"selectAll": "Selecionar Todos", //$NON-NLS-1$ //$NON-NLS-0$
	"copy": "Copiar", //$NON-NLS-1$ //$NON-NLS-0$
	"cut": "Recortar", //$NON-NLS-1$ //$NON-NLS-0$
	"paste": "Colar", //$NON-NLS-1$ //$NON-NLS-0$
	
	"uppercase": "Para Maiúscula", //$NON-NLS-1$ //$NON-NLS-0$
	"lowercase": "Para Minúscula", //$NON-NLS-1$ //$NON-NLS-0$
	"capitalize": "Colocar em Maiúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	"reversecase" : "Caso Reverso", //$NON-NLS-1$ //$NON-NLS-0$
	
	"toggleWrapMode": "Comutar Modo Quebra", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleTabMode": "Comutar Modo de Tabulação", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleOverwriteMode": "Comutar Modo Sobrescrever", //$NON-NLS-1$ //$NON-NLS-0$
	
	"committerOnTime": "${0}  em ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//Emacs
	"emacs": "Emacs", //$NON-NLS-1$ //$NON-NLS-0$
	"exchangeMarkPoint": "Trocar Marca e Ponto", //$NON-NLS-1$ //$NON-NLS-0$
	"setMarkCommand": "Configurar Marca", //$NON-NLS-1$ //$NON-NLS-0$
	"clearMark": "Limpar Marca", //$NON-NLS-1$ //$NON-NLS-0$
	"digitArgument": "Argumento de Dígito ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"negativeArgument": "Argumento Negativo", //$NON-NLS-1$ //$NON-NLS-0$
			
	"Comment": "Comentários", //$NON-NLS-1$ //$NON-NLS-0$
	"Flat outline": "Estrutura de tópicos simples", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStr": "Localização incremental: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindStrNotFound": "Localização incremental: ${0} (não localizado)", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStr": "Localização incremental reversa: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverseStrNotFound": "Localização incremental reversa: ${0} (não localizada)", //$NON-NLS-1$ //$NON-NLS-0$
	"find": "Localizar...", //$NON-NLS-1$ //$NON-NLS-0$
	"undo": "Desfazer", //$NON-NLS-1$ //$NON-NLS-0$
	"redo": "Refazer", //$NON-NLS-1$ //$NON-NLS-0$
	"cancelMode": "Cancelar Modo Atual", //$NON-NLS-1$ //$NON-NLS-0$
	"findNext": "Localizar Próxima Ocorrência", //$NON-NLS-1$ //$NON-NLS-0$
	"findPrevious": "Localizar Ocorrência Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFind": "Local Incremental", //$NON-NLS-1$ //$NON-NLS-0$
	"incrementalFindReverse": "Localização Incremental Reversa", //$NON-NLS-1$ //$NON-NLS-0$
	"indentLines": "Linhas Indentadas", //$NON-NLS-1$ //$NON-NLS-0$
	"unindentLines": "Linhas Não Indentadas", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesUp": "Mover Linhas para Cima", //$NON-NLS-1$ //$NON-NLS-0$
	"moveLinesDown": "Mover Linhas para Baixo", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesUp": "Copiar Linhas Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"copyLinesDown": "Copiar Linhas Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"deleteLines": "Excluir Linhas", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Acessar a Linha...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompty": "Acessar a Linha:", //$NON-NLS-1$ //$NON-NLS-0$
	"nextAnnotation": "Próxima Anotação", //$NON-NLS-1$ //$NON-NLS-0$
	"prevAnnotation": "Anotação Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"expand": "Expandir", //$NON-NLS-1$ //$NON-NLS-0$
	"collapse": "Reduzir", //$NON-NLS-1$ //$NON-NLS-0$
	"expandAll": "Expandir Tudo", //$NON-NLS-1$ //$NON-NLS-0$
	"collapseAll": "Reduzir Tudo", //$NON-NLS-1$ //$NON-NLS-0$
	"lastEdit": "Último Local de Edição", //$NON-NLS-1$ //$NON-NLS-0$
	"trimTrailingWhitespaces": "Cortar espaços em branco à direita", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleLineComment": "Alternar Comentário da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"addBlockComment": "Incluir Comentário de Bloco", //$NON-NLS-1$ //$NON-NLS-0$
	"removeBlockComment": "Remover Comentário de Bloco", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeEntered": "Modo Vinculado inserido", //$NON-NLS-1$ //$NON-NLS-0$
	"linkedModeExited": "Saída do Modo Vinculado", //$NON-NLS-1$ //$NON-NLS-0$
	"syntaxError": "Erro de Sintaxe", //$NON-NLS-1$ //$NON-NLS-0$
	"contentAssist": "Assistente de Conteúdo", //$NON-NLS-1$ //$NON-NLS-0$
	"lineColumn": "Linha ${0} : Col ${1}", //$NON-NLS-1$ //$NON-NLS-0$
	
	//vi
	"vi": "vi", //$NON-NLS-1$ //$NON-NLS-0$
	"vimove": "(Mover)", //$NON-NLS-1$ //$NON-NLS-0$
	"viyank": "(Yank)", //$NON-NLS-1$ //$NON-NLS-0$
	"videlete": "(Excluir)", //$NON-NLS-1$ //$NON-NLS-0$
	"vichange": "(Alterar)", //$NON-NLS-1$ //$NON-NLS-0$
	"viLeft": "${0} Esquerda", //$NON-NLS-1$ //$NON-NLS-0$
	"viRight": "${0} Direita", //$NON-NLS-1$ //$NON-NLS-0$
	"viUp": "${0} Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"viDown": "${0} Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"viw": "${0} Próxima Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"vib": "${0} Início da Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"viW": "${0} Próxima Palavra (ws pare)", //$NON-NLS-1$ //$NON-NLS-0$
	"viB": "${0} Início da Palavra (ws pare)", //$NON-NLS-1$ //$NON-NLS-0$
	"vie": "${0} Término da Palavra", //$NON-NLS-1$ //$NON-NLS-0$
	"viE": "${0} Término da Palavra (ws pare)", //$NON-NLS-1$ //$NON-NLS-0$
	"vi$": "${0} Fim da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"vi^_": "${0} Primeira Linha Atual de Caractere não vazia", //$NON-NLS-1$ //$NON-NLS-0$
	"vi+": "${0} Primeira Linha de Próximo Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"vi-": "${0} Primeira Linha de Caractere Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"vi|": "${0} Coluna nth em Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"viH": "${0} Parte Superior da Página", //$NON-NLS-1$ //$NON-NLS-0$
	"viM": "${0} Meio da Página", //$NON-NLS-1$ //$NON-NLS-0$
	"viL": "${0} Parte Inferior da Página", //$NON-NLS-1$ //$NON-NLS-0$
	"vi/": "${0} Encaminhamento de Procura", //$NON-NLS-1$ //$NON-NLS-0$
	"vi?": "${0} Procurar Atrás", //$NON-NLS-1$ //$NON-NLS-0$
	"vin": "${0} Próxima Procura", //$NON-NLS-1$ //$NON-NLS-0$
	"viN": "${0} Procura Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"vif": "${0} Procurar Caractere Fwd", //$NON-NLS-1$ //$NON-NLS-0$
	"viF": "${0} Procurar Caracter Bckwd", //$NON-NLS-1$ //$NON-NLS-0$
	"vit": "${0} Procurar Caractere Fwd Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"viT": "${0} Procurar Caracter Bckwd Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"vi,": "${0} Repetir Procura de Caractere Reversa", //$NON-NLS-1$ //$NON-NLS-0$
	"vi;": "${0} Repetir Procura de Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"viG": "${0} Ir para Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"viycd": "${0} Linha Atual", //$NON-NLS-1$ //$NON-NLS-0$
	"via": "Anexar Cursor Posterior", //$NON-NLS-1$ //$NON-NLS-0$
	"viA": "Anexar ao Término da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"vii": "Inserir Cursor Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"viI": "Inserir no Começo de Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"viO": "Inserir Linha Acima", //$NON-NLS-1$ //$NON-NLS-0$
	"vio": "Inserir Linha Abaixo", //$NON-NLS-1$ //$NON-NLS-0$
	"viR": "Iniciar Texto de Sobrescrição", //$NON-NLS-1$ //$NON-NLS-0$
	"vis": "Substituir um Caractere", //$NON-NLS-1$ //$NON-NLS-0$
	"viS": "Substituir Linha Inteira", //$NON-NLS-1$ //$NON-NLS-0$
	"viC": "Alterar Texto até o Fim da Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"vip": "Colar após Caractere ou Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"viP": "Colar antes de Caractere ou Linha", //$NON-NLS-1$ //$NON-NLS-0$
	"viStar": "Procurar palavra sob o cursor", //$NON-NLS-1$ //$NON-NLS-0$
	
	"next": "Próximo", //$NON-NLS-1$ //$NON-NLS-0$
	"previous": "Anterior", //$NON-NLS-1$ //$NON-NLS-0$
	"replace": "Substituir", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceAll": "Substituir Tudo", //$NON-NLS-1$ //$NON-NLS-0$
	"findWith": "Localizar Com", //$NON-NLS-1$ //$NON-NLS-0$
	"replaceWith": "Substituir por", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitive": "Aa", //$NON-NLS-1$ //$NON-NLS-0$
	"regex": "/.*/", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWord": "\\b", //$NON-NLS-1$ //$NON-NLS-0$
	"caseInsensitiveTooltip": "Alternar sem distinção entre maiúsculas e minúsculas", //$NON-NLS-1$ //$NON-NLS-0$
	"regexTooltip": "Alternar expressão regular", //$NON-NLS-1$ //$NON-NLS-0$
	"wholeWordTooltip": "Alternar palavra inteira", //$NON-NLS-1$ //$NON-NLS-0$
	"closeTooltip": "Fechar", //$NON-NLS-1$ //$NON-NLS-0$

	"replacingAll": "Substituindo tudo...", //$NON-NLS-1$ //$NON-NLS-0$
	"replacedMatches": "Substituídas ${0} correspondências", //$NON-NLS-1$ //$NON-NLS-0$
	"nothingReplaced": "Nada substituído", //$NON-NLS-1$ //$NON-NLS-0$
	"notFound": "Não localizado" //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/eventTarget", [], function() { //$NON-NLS-0$
	/** 
	 * Constructs a new EventTarget object.
	 * 
	 * @class 
	 * @name orion.editor.EventTarget
	 */
	function EventTarget() {
	}
	/**
	 * Adds in the event target interface into the specified object.
	 *
	 * @param {Object} object The object to add in the event target interface.
	 */
	EventTarget.addMixin = function(object) {
		var proto = EventTarget.prototype;
		for (var p in proto) {
			if (proto.hasOwnProperty(p)) {
				object[p] = proto[p];
			}
		}
	};
	EventTarget.prototype = /** @lends orion.editor.EventTarget.prototype */ {
		/**
		 * Adds an event listener to this event target.
		 * 
		 * @param {String} type The event type.
		 * @param {Function|EventListener} listener The function or the EventListener that will be executed when the event happens. 
		 * @param {Boolean} [useCapture=false] <code>true</code> if the listener should be trigged in the capture phase.
		 * 
		 * @see orion.editor.EventTarget#removeEventListener
		 */
		addEventListener: function(type, listener, useCapture) {
			if (!this._eventTypes) { this._eventTypes = {}; }
			var state = this._eventTypes[type];
			if (!state) {
				state = this._eventTypes[type] = {level: 0, listeners: []};
			}
			var listeners = state.listeners;
			listeners.push({listener: listener, useCapture: useCapture});
		},
		/**
		 * Dispatches the given event to the listeners added to this event target.
		 * @param {Event} evt The event to dispatch.
		 */
		dispatchEvent: function(evt) {
			var type = evt.type;
			this._dispatchEvent("pre" + type, evt); //$NON-NLS-0$
			this._dispatchEvent(type, evt);
			this._dispatchEvent("post" + type, evt); //$NON-NLS-0$
		},
		_dispatchEvent: function(type, evt) {
			var state = this._eventTypes ? this._eventTypes[type] : null;
			if (state) {
				var listeners = state.listeners;
				try {
					state.level++;
					if (listeners) {
						for (var i=0, len=listeners.length; i < len; i++) {
							if (listeners[i]) {
								var l = listeners[i].listener;
								if (typeof l === "function") { //$NON-NLS-0$
									l.call(this, evt);
								} else if (l.handleEvent && typeof l.handleEvent === "function") { //$NON-NLS-0$
									l.handleEvent(evt);
								}
							}
						}
					}
				} finally {
					state.level--;
					if (state.compact && state.level === 0) {
						for (var j=listeners.length - 1; j >= 0; j--) {
							if (!listeners[j]) {
								listeners.splice(j, 1);
							}
						}
						if (listeners.length === 0) {
							delete this._eventTypes[type];
						}
						state.compact = false;
					}
				}
			}
		},
		/**
		 * Returns whether there is a listener for the specified event type.
		 * 
		 * @param {String} type The event type
		 * 
		 * @see orion.editor.EventTarget#addEventListener
		 * @see orion.editor.EventTarget#removeEventListener
		 */
		isListening: function(type) {
			if (!this._eventTypes) { return false; }
			return this._eventTypes[type] !== undefined;
		},		
		/**
		 * Removes an event listener from the event target.
		 * <p>
		 * All the parameters must be the same ones used to add the listener.
		 * </p>
		 * 
		 * @param {String} type The event type
		 * @param {Function|EventListener} listener The function or the EventListener that will be executed when the event happens. 
		 * @param {Boolean} [useCapture=false] <code>true</code> if the listener should be trigged in the capture phase.
		 * 
		 * @see orion.editor.EventTarget#addEventListener
		 */
		removeEventListener: function(type, listener, useCapture){
			if (!this._eventTypes) { return; }
			var state = this._eventTypes[type];
			if (state) {
				var listeners = state.listeners;
				for (var i=0, len=listeners.length; i < len; i++) {
					var l = listeners[i];
					if (l && l.listener === listener && l.useCapture === useCapture) {
						if (state.level !== 0) {
							listeners[i] = null;
							state.compact = true;
						} else {
							listeners.splice(i, 1);
						}
						break;
					}
				}
				if (listeners.length === 0) {
					delete this._eventTypes[type];
				}
			}
		}
	};
	return {EventTarget: EventTarget};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/**
 * @name orion.regex
 * @class Utilities for dealing with regular expressions.
 * @description Utilities for dealing with regular expressions.
 */
define("orion/regex", [], function() { //$NON-NLS-0$
	/**
	 * @memberOf orion.regex
	 * @function
	 * @static
	 * @description Escapes regex special characters in the input string.
	 * @param {String} str The string to escape.
	 * @returns {String} A copy of <code>str</code> with regex special characters escaped.
	 */
	function escape(str) {
		return str.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g, "\\$&"); //$NON-NLS-0$
	}

	/**
	 * @memberOf orion.regex
	 * @function
	 * @static
	 * @description Parses a pattern and flags out of a regex literal string.
	 * @param {String} str The string to parse. Should look something like <code>"/ab+c/"</code> or <code>"/ab+c/i"</code>.
	 * @returns {Object} If <code>str</code> looks like a regex literal, returns an object with properties
	 * <code><dl>
	 * <dt>pattern</dt><dd>{String}</dd>
	 * <dt>flags</dt><dd>{String}</dd>
	 * </dl></code> otherwise returns <code>null</code>.
	 */
	function parse(str) {
		var regexp = /^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(str);
		if (regexp) {
			return {
				pattern : regexp[1],
				flags : regexp[2]
			};
		}
		return null;
	}

	return {
		escape: escape,
		parse: parse
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/textModel", ['orion/editor/eventTarget', 'orion/regex', 'orion/util'], function(mEventTarget, mRegex, util) { //$NON-NLS-2$  //$NON-NLS-1$ //$NON-NLS-0$

	/**
	 * Constructs a new TextModel with the given text and default line delimiter.
	 *
	 * @param {String} [text=""] the text that the model will store
	 * @param {String} [lineDelimiter=platform delimiter] the line delimiter used when inserting new lines to the model.
	 *
	 * @name orion.editor.TextModel
	 * @class The TextModel is an interface that provides text for the view. Applications may
	 * implement the TextModel interface to provide a custom store for the view content. The
	 * view interacts with its text model in order to access and update the text that is being
	 * displayed and edited in the view. This is the default implementation.
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.TextView}<br/>
	 * {@link orion.editor.TextView#setModel}
	 * </p>
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function TextModel(text, lineDelimiter) {
		this._lastLineIndex = -1;
		this._text = [""];
		this._lineOffsets = [0];
		this.setText(text);
		this.setLineDelimiter(lineDelimiter);
	}

	TextModel.prototype = /** @lends orion.editor.TextModel.prototype */ {
		/**
		 * Destroys this text model.
		 */
		destroy: function() {
		},
		/**
		 * @class This object describes the options to use while finding occurrences of a string in a text model.
		 * @name orion.editor.FindOptions
		 *
		 * @property {String} string the search string to be found.
		 * @property {Boolean} [regex=false] whether or not the search string is a regular expression.
		 * @property {Boolean} [wrap=false] whether or not to wrap search.
		 * @property {Boolean} [wholeWord=false] whether or not to search only whole words.
		 * @property {Boolean} [caseInsensitive=false] whether or not search is case insensitive.
		 * @property {Boolean} [reverse=false] whether or not to search backwards.
		 * @property {Number} [start=0] The start offset to start searching
		 * @property {Number} [end=charCount] The end offset of the search. Used to search in a given range.
		 */
		/**
		 * @class This object represents a find occurrences iterator.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextModel#find}<br/>
		 * </p>		 
		 * @name orion.editor.FindIterator
		 * 
		 * @property {Function} hasNext Determines whether there are more occurrences in the iterator.
		 * @property {Function} next Returns the next matched range {start,end} in the iterator.
		 */	
		/**
		 * Finds occurrences of a string in the text model.
		 *
		 * @param {orion.editor.FindOptions} options the search options
		 * @return {orion.editor.FindIterator} the find occurrences iterator.
		 */
		find: function(options) {
			if (this._text.length > 1) {
				this._text = [this._text.join("")];
			}
			var string = options.string;
			var regex = options.regex;
			var pattern = string;
			var flags = "";
			var caseInsensitive = options.caseInsensitive;
			if (pattern) {
				if (regex) {
					var parsed = mRegex.parse(pattern);
					if (parsed) {
						pattern = parsed.pattern;
						flags = parsed.flags;
					}
				} else {
					pattern = string.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g, "\\$&"); //$NON-NLS-0$
					/*
					* Bug in JS RegEx. In a Turkish locale, dotless i (u0131) capitalizes to I (u0049) and i (u0069) 
					* capitalizes to dot I (u0130). The JS RegEx does not match correctly the Turkish i's in case
					* insensitive mode. The fix is to detect the presence of Turkish i's in the search pattern and 
					* to modify the pattern to search for both upper and lower case.
					*/
					if (caseInsensitive) {  //$NON-NLS-1$ //$NON-NLS-0$
						pattern = pattern.replace(/[iI\u0130\u0131]/g, "[Ii\u0130\u0131]"); //$NON-NLS-0$
					}
				}
			}
			var current = null, skip;
			if (pattern) {
				var reverse = options.reverse;
				var wrap = options.wrap;
				var wholeWord = options.wholeWord;
				var start = options.start || 0;
				var end = options.end;
				var isRange = (end !== null && end !== undefined);
				if (flags.indexOf("g") === -1) { flags += "g"; } //$NON-NLS-1$ //$NON-NLS-0$
				if (flags.indexOf("m") === -1) { flags += "m"; } //$NON-NLS-1$ //$NON-NLS-0$
				if (caseInsensitive) {
					if (flags.indexOf("i") === -1) { flags += "i"; } //$NON-NLS-1$ //$NON-NLS-0$
				}
				if (wholeWord) {
					pattern = "\\b" + pattern + "\\b"; //$NON-NLS-1$ //$NON-NLS-0$
				}
				var text = this._text[0], result, lastIndex, offset = 0;
				if (isRange) {
					var s = start < end ? start : end;
					var e = start < end ? end : start;
					text = text.substring(s, e);
					offset = s;
				}
				var re = new RegExp(pattern, flags);
				if (reverse) {
					skip = function() {
						var match = null;
						re.lastIndex = 0;
						while (true) {
							lastIndex = re.lastIndex;
							result = re.exec(text);
							if (lastIndex === re.lastIndex) {
								return null;
							}
							if (result) {
								if (result.index + offset < start) {
									match = {start: result.index + offset, end: re.lastIndex + offset};
								} else {
									if (!wrap || match) {
										break;
									}
									start = text.length + offset;
									match = {start: result.index + offset, end: re.lastIndex + offset};
								}
							} else {
								break;
							}
						}
						if (match) { start = match.start; }
						return match;
					};
				} else {
					if (!isRange) {
						re.lastIndex = start;
					}
					skip = function() {
						while (true) {
							lastIndex = re.lastIndex;
							result = re.exec(text);
							if (lastIndex === re.lastIndex) {
								return null;
							}
							if (result) {
								return {start: result.index + offset, end: re.lastIndex + offset};
							}
							if (lastIndex !== 0) {
								if (wrap) {
									continue;
								}
							}
							break;
						}
						return null;
					};
				}
				current = skip();
			}
			return {
				next: function() {
					var result = current;
					if (result) { current = skip(); }
					return result;					
				},
				hasNext: function() {
					return current !== null;
				}
			};
		},
		/**
		 * Returns the number of characters in the model.
		 *
		 * @returns {Number} the number of characters in the model.
		 */
		getCharCount: function() {
			var count = 0;
			for (var i = 0; i<this._text.length; i++) {
				count += this._text[i].length;
			}
			return count;
		},
		/**
		 * Returns the text of the line at the given index.
		 * <p>
		 * The valid indices are 0 to line count exclusive.  Returns <code>null</code> 
		 * if the index is out of range. 
		 * </p>
		 *
		 * @param {Number} lineIndex the zero based index of the line.
		 * @param {Boolean} [includeDelimiter=false] whether or not to include the line delimiter. 
		 * @returns {String} the line text or <code>null</code> if out of range.
		 *
		 * @see orion.editor.TextModel#getLineAtOffset
		 */
		getLine: function(lineIndex, includeDelimiter) {
			var lineCount = this.getLineCount();
			if (!(0 <= lineIndex && lineIndex < lineCount)) {
				return null;
			}
			var start = this._lineOffsets[lineIndex];
			if (lineIndex + 1 < lineCount) {
				var text = this.getText(start, this._lineOffsets[lineIndex + 1]);
				if (includeDelimiter) {
					return text;
				}
				var end = text.length, c;
				while (((c = text.charCodeAt(end - 1)) === 10) || (c === 13)) {
					end--;
				}
				return text.substring(0, end);
			} else {
				return this.getText(start); 
			}
		},
		/**
		 * Returns the line index at the given character offset.
		 * <p>
		 * The valid offsets are 0 to char count inclusive. The line index for
		 * char count is <code>line count - 1</code>. Returns <code>-1</code> if
		 * the offset is out of range.
		 * </p>
		 *
		 * @param {Number} offset a character offset.
		 * @returns {Number} the zero based line index or <code>-1</code> if out of range.
		 */
		getLineAtOffset: function(offset) {
			var charCount = this.getCharCount();
			if (!(0 <= offset && offset <= charCount)) {
				return -1;
			}
			var lineCount = this.getLineCount();
			if (offset === charCount) {
				return lineCount - 1; 
			}
			var lineStart, lineEnd;
			var index = this._lastLineIndex;
			if (0 <= index && index < lineCount) {
				lineStart = this._lineOffsets[index];
				lineEnd = index + 1 < lineCount ? this._lineOffsets[index + 1] : charCount;
				if (lineStart <= offset && offset < lineEnd) {
					return index;
				}
			}
			var high = lineCount;
			var low = -1;
			while (high - low > 1) {
				index = Math.floor((high + low) / 2);
				lineStart = this._lineOffsets[index];
				lineEnd = index + 1 < lineCount ? this._lineOffsets[index + 1] : charCount;
				if (offset <= lineStart) {
					high = index;
				} else if (offset < lineEnd) {
					high = index;
					break;
				} else {
					low = index;
				}
			}
			this._lastLineIndex = high;
			return high;
		},
		/**
		 * Returns the number of lines in the model.
		 * <p>
		 * The model always has at least one line.
		 * </p>
		 *
		 * @returns {Number} the number of lines.
		 */
		getLineCount: function() {
			return this._lineOffsets.length;
		},
		/**
		 * Returns the line delimiter that is used by the view
		 * when inserting new lines. New lines entered using key strokes 
		 * and paste operations use this line delimiter.
		 *
		 * @return {String} the line delimiter that is used by the view when inserting new lines.
		 */
		getLineDelimiter: function() {
			return this._lineDelimiter;
		},
		/**
		 * Returns the end character offset for the given line. 
		 * <p>
		 * The end offset is not inclusive. This means that when the line delimiter is included, the 
		 * offset is either the start offset of the next line or char count. When the line delimiter is
		 * not included, the offset is the offset of the line delimiter.
		 * </p>
		 * <p>
		 * The valid indices are 0 to line count exclusive.  Returns <code>-1</code> 
		 * if the index is out of range. 
		 * </p>
		 *
		 * @param {Number} lineIndex the zero based index of the line.
		 * @param {Boolean} [includeDelimiter=false] whether or not to include the line delimiter. 
		 * @return {Number} the line end offset or <code>-1</code> if out of range.
		 *
		 * @see orion.editor.TextModel#getLineStart
		 */
		getLineEnd: function(lineIndex, includeDelimiter) {
			var lineCount = this.getLineCount();
			if (!(0 <= lineIndex && lineIndex < lineCount)) {
				return -1;
			}
			if (lineIndex + 1 < lineCount) {
				var end = this._lineOffsets[lineIndex + 1];
				if (includeDelimiter) {
					return end;
				}
				var text = this.getText(Math.max(this._lineOffsets[lineIndex], end - 2), end);
				var i = text.length, c;
				while (((c = text.charCodeAt(i - 1)) === 10) || (c === 13)) {
					i--;
				}
				return end - (text.length - i);
			} else {
				return this.getCharCount();
			}
		},
		/**
		 * Returns the start character offset for the given line.
		 * <p>
		 * The valid indices are 0 to line count exclusive.  Returns <code>-1</code> 
		 * if the index is out of range. 
		 * </p>
		 *
		 * @param {Number} lineIndex the zero based index of the line.
		 * @return {Number} the line start offset or <code>-1</code> if out of range.
		 *
		 * @see orion.editor.TextModel#getLineEnd
		 */
		getLineStart: function(lineIndex) {
			if (!(0 <= lineIndex && lineIndex < this.getLineCount())) {
				return -1;
			}
			return this._lineOffsets[lineIndex];
		},
		/**
		 * Returns the text for the given range.
		 * <p>
		 * The end offset is not inclusive. This means that character at the end offset
		 * is not included in the returned text.
		 * </p>
		 *
		 * @param {Number} [start=0] the zero based start offset of text range.
		 * @param {Number} [end=char count] the zero based end offset of text range.
		 *
		 * @see orion.editor.TextModel#setText
		 */
		getText: function(start, end) {
			if (start === undefined) { start = 0; }
			if (end === undefined) { end = this.getCharCount(); }
			if (start === end) { return ""; }
			var offset = 0, chunk = 0, length;
			while (chunk<this._text.length) {
				length = this._text[chunk].length; 
				if (start <= offset + length) { break; }
				offset += length;
				chunk++;
			}
			var firstOffset = offset;
			var firstChunk = chunk;
			while (chunk<this._text.length) {
				length = this._text[chunk].length; 
				if (end <= offset + length) { break; }
				offset += length;
				chunk++;
			}
			var lastOffset = offset;
			var lastChunk = chunk;
			if (firstChunk === lastChunk) {
				return this._text[firstChunk].substring(start - firstOffset, end - lastOffset);
			}
			var beforeText = this._text[firstChunk].substring(start - firstOffset);
			var afterText = this._text[lastChunk].substring(0, end - lastOffset);
			return beforeText + this._text.slice(firstChunk+1, lastChunk).join("") + afterText; 
		},
		/**
		 * Notifies all listeners that the text is about to change.
		 * <p>
		 * This notification is intended to be used only by the view. Application clients should
		 * use {@link orion.editor.TextView#event:onModelChanging}.
		 * </p>
		 * <p>
		 * NOTE: This method is not meant to called directly by application code. It is called internally by the TextModel
		 * as part of the implementation of {@link #setText}. This method is included in the public API for documentation
		 * purposes and to allow integration with other toolkit frameworks.
		 * </p>
		 *
		 * @param {orion.editor.ModelChangingEvent} modelChangingEvent the changing event
		 */
		onChanging: function(modelChangingEvent) {
			return this.dispatchEvent(modelChangingEvent);
		},
		/**
		 * Notifies all listeners that the text has changed.
		 * <p>
		 * This notification is intended to be used only by the view. Application clients should
		 * use {@link orion.editor.TextView#event:onModelChanged}.
		 * </p>
		 * <p>
		 * NOTE: This method is not meant to called directly by application code. It is called internally by the TextModel
		 * as part of the implementation of {@link #setText}. This method is included in the public API for documentation
		 * purposes and to allow integration with other toolkit frameworks.
		 * </p>
		 *
		 * @param {orion.editor.ModelChangedEvent} modelChangedEvent the changed event
		 */
		onChanged: function(modelChangedEvent) {
			return this.dispatchEvent(modelChangedEvent);
		},
		/**
		 * Sets the line delimiter that is used by the view
		 * when new lines are inserted in the model due to key
		 * strokes and paste operations. The line delimiter of
		 * existing lines are unchanged unless the to <code>all</code>
		 * argument is <code>true</code>.
		 * <p>
		 * If lineDelimiter is "auto", the delimiter is computed to be
		 * the first delimiter found in the current text. If lineDelimiter
		 * is undefined or if there are no delimiters in the current text, the
		 * platform delimiter is used.
		 * </p>
		 *
		 * @param {String} lineDelimiter the line delimiter that is used by the view when inserting new lines.
		 * @param {Boolean} [all=false] whether or not the delimiter of existing lines are changed.
		 */
		setLineDelimiter: function(lineDelimiter, all) {
			if (lineDelimiter === "auto") { //$NON-NLS-0$
				lineDelimiter = undefined;
				if (this.getLineCount() > 1) {
					lineDelimiter = this.getText(this.getLineEnd(0), this.getLineEnd(0, true));
				}
			}
			this._lineDelimiter = lineDelimiter ? lineDelimiter : util.platformDelimiter;
			if (all) {
				var lineCount = this.getLineCount();
				if (lineCount > 1) {
					var lines = new Array(lineCount);
					for (var i=0; i<lineCount; i++) {
						lines[i] = this.getLine(i);
					}
					this.setText(lines.join(this._lineDelimiter));
				}
			}
		},
		/**
		 * Replaces the text in the given range with the given text.
		 * <p>
		 * The end offset is not inclusive. This means that the character at the 
		 * end offset is not replaced.
		 * </p>
		 * <p>
		 * The text model must notify the listeners before and after the
		 * the text is changed by calling {@link #onChanging} and {@link #onChanged}
		 * respectively. 
		 * </p>
		 *
		 * @param {String} [text=""] the new text.
		 * @param {Number} [start=0] the zero based start offset of text range.
		 * @param {Number} [end=char count] the zero based end offset of text range.
		 *
		 * @see orion.editor.TextModel#getText
		 */
		setText: function(text, start, end) {
			if (text === undefined) { text = ""; }
			if (start === undefined) { start = 0; }
			if (end === undefined) { end = this.getCharCount(); }
			if (start === end && text === "") { return; }
			var startLine = this.getLineAtOffset(start);
			var endLine = this.getLineAtOffset(end);
			var eventStart = start;
			var removedCharCount = end - start;
			var removedLineCount = endLine - startLine;
			var addedCharCount = text.length;
			var addedLineCount = 0;
			var lineCount = this.getLineCount();
			
			var cr = 0, lf = 0, index = 0;
			var newLineOffsets = [];
			while (true) {
				if (cr !== -1 && cr <= index) { cr = text.indexOf("\r", index); } //$NON-NLS-0$
				if (lf !== -1 && lf <= index) { lf = text.indexOf("\n", index); } //$NON-NLS-0$
				if (lf === -1 && cr === -1) { break; }
				if (cr !== -1 && lf !== -1) {
					if (cr + 1 === lf) {
						index = lf + 1;
					} else {
						index = (cr < lf ? cr : lf) + 1;
					}
				} else if (cr !== -1) {
					index = cr + 1;
				} else {
					index = lf + 1;
				}
				newLineOffsets.push(start + index);
				addedLineCount++;
			}
		
			var modelChangingEvent = {
				type: "Changing", //$NON-NLS-0$
				text: text,
				start: eventStart,
				removedCharCount: removedCharCount,
				addedCharCount: addedCharCount,
				removedLineCount: removedLineCount,
				addedLineCount: addedLineCount
			};
			this.onChanging(modelChangingEvent);
			
			//TODO this should be done the loops below to avoid getText()
			if (newLineOffsets.length === 0) {
				var startLineOffset = this.getLineStart(startLine), endLineOffset;
				if (endLine + 1 < lineCount) {
					endLineOffset = this.getLineStart(endLine + 1);
				} else {
					endLineOffset = this.getCharCount();
				}
				if (start !== startLineOffset) {
					text = this.getText(startLineOffset, start) + text;
					start = startLineOffset;
				}
				if (end !== endLineOffset) {
					text = text + this.getText(end, endLineOffset);
					end = endLineOffset;
				}
			}
			
			var changeCount = addedCharCount - removedCharCount;
			for (var j = startLine + removedLineCount + 1; j < lineCount; j++) {
				this._lineOffsets[j] += changeCount;
			}
			
			/*
			* Feature in Chrome.  Chrome exceeds the maximum call stack when calling splice
			* around 62k arguments. The limit seems to be higher on IE (250K) and Firefox (450k).
			* The fix is to break the splice in junks of 50k.
			*/
			var SPLICE_LIMIT = 50000;
			var limit = SPLICE_LIMIT, args;
			if (newLineOffsets.length < limit) {
				args = [startLine + 1, removedLineCount].concat(newLineOffsets);
				Array.prototype.splice.apply(this._lineOffsets, args);
			} else {
				index = startLine + 1;
				this._lineOffsets.splice(index, removedLineCount);
				for (var k = 0; k < newLineOffsets.length; k += limit) {
					args = [index, 0].concat(newLineOffsets.slice(k, Math.min(newLineOffsets.length, k + limit)));
					Array.prototype.splice.apply(this._lineOffsets, args);
					index += limit;
				}
			}
			
			var offset = 0, chunk = 0, length;
			while (chunk<this._text.length) {
				length = this._text[chunk].length; 
				if (start <= offset + length) { break; }
				offset += length;
				chunk++;
			}
			var firstOffset = offset;
			var firstChunk = chunk;
			while (chunk<this._text.length) {
				length = this._text[chunk].length; 
				if (end <= offset + length) { break; }
				offset += length;
				chunk++;
			}
			var lastOffset = offset;
			var lastChunk = chunk;
			var firstText = this._text[firstChunk];
			var lastText = this._text[lastChunk];
			var beforeText = firstText.substring(0, start - firstOffset);
			var afterText = lastText.substring(end - lastOffset);
			var params = [firstChunk, lastChunk - firstChunk + 1];
			if (beforeText) { params.push(beforeText); }
			if (text) { params.push(text); }
			if (afterText) { params.push(afterText); }
			Array.prototype.splice.apply(this._text, params);
			if (this._text.length === 0) { this._text = [""]; }
			
			var modelChangedEvent = {
				type: "Changed", //$NON-NLS-0$
				start: eventStart,
				removedCharCount: removedCharCount,
				addedCharCount: addedCharCount,
				removedLineCount: removedLineCount,
				addedLineCount: addedLineCount
			};
			this.onChanged(modelChangedEvent);
		}
	};
	mEventTarget.EventTarget.addMixin(TextModel.prototype);
	
	return {TextModel: TextModel};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/keyModes", [ //$NON-NLS-0$
		"orion/keyBinding", //$NON-NLS-0$
		"orion/util" //$NON-NLS-0$
], function(mKeyBinding, util) {

	function KeyMode(view) {
		if (!view) {
			return;
		}
		this._view = view;
		this._keyBindings = this.createKeyBindings();
		this._keyBindingIndex = 0;
	}
	KeyMode.prototype = /** @lends orion.editor.KeyMode.prototype */ {
		createKeyBindings: function () {
			return [];
		},
		/**
		 * Returns all the key bindings associated to the given action ID.
		 *
		 * @param {String} actionID the action ID.
		 * @returns {orion.KeyBinding[]} the array of key bindings associated to the given action ID.
		 *
		 * @see orion.editor.KeyModesetKeyBinding
		 * @see orion.editor.KeyModesetAction
		 */
		getKeyBindings: function (actionID) {
			var result = [];
			var keyBindings = this._keyBindings;
			for (var i = 0; i < keyBindings.length; i++) {
				if (keyBindings[i].actionID === actionID) {
					result.push(keyBindings[i].keyBinding);
				}
			}
			return result;
		},
		getView: function() {
			return this._view;
		},
		isActive: function () {
			return this._view.getKeyModes().indexOf(this) !== -1;
		},
		match: function(e) {
			if (e.type === "keydown") { //$NON-NLS-0$
				switch (e.keyCode) {
					case 16: /* Shift */
					case 17: /* Control */
					case 18: /* Alt */
					case 91: /* Command */
						return undefined;
				}
			}
			var keyBindingIndex = this._keyBindingIndex;
			var keyBindings = this._matchingKeyBindings || this._keyBindings;
			var matchingKeyBindings = [];
			for (var i = 0; i < keyBindings.length; i++) {
				var kb = keyBindings[i];
				var keyBinding = kb.keyBinding;
				var match = keyBinding.match(e, keyBindingIndex);
				if (match === true) {
					this._keyBindingIndex = 0;
					this._matchingKeyBindings = null;
					return kb.actionID;
				} else if (typeof match === "number") { //$NON-NLS-0$
					matchingKeyBindings.push(kb);
				}
			}
			if (matchingKeyBindings.length === 0) {
				this._keyBindingIndex = 0;
				this._matchingKeyBindings = null;
			} else {
				this._keyBindingIndex++;
				this._matchingKeyBindings = matchingKeyBindings;
				return "noop"; //$NON-NLS-0$
			}
			return undefined;
		},
		/**
		 * Associates a key binding with the given action ID. Any previous
		 * association with the specified key binding is overwriten. If the
		 * action ID is <code>null</code>, the association is removed.
		 * 
		 * @param {orion.KeyBinding} keyBinding the key binding
		 * @param {String} actionID the action ID
		 */
		setKeyBinding: function(keyBinding, actionID) {
			var keyBindings = this._keyBindings;
			for (var i = 0; i < keyBindings.length; i++) {
				var kb = keyBindings[i]; 
				if (kb.keyBinding.equals(keyBinding)) {
					if (actionID) {
						kb.actionID = actionID;
					} else {
						if (kb.predefined) {
							kb.actionID = "noop"; //$NON-NLS-0$
						} else {
							keyBindings.splice(i, 1);
						}
					}
					return;
				}
			}
			if (actionID) {
				keyBindings.push({keyBinding: keyBinding, actionID: actionID});
			}
		},
		setView: function(view) {
			this._view = view;
		}
	};
	
	function DefaultKeyMode(view) {
		KeyMode.call(this, view);
	}
	DefaultKeyMode.prototype = new KeyMode();
	DefaultKeyMode.prototype.createKeyBindings = function () {
		var KeyBinding = mKeyBinding.KeyBinding;
		//no duplicate keybindings
		var bindings = [];

		// Cursor Navigation
		bindings.push({actionID: "lineUp",		keyBinding: new KeyBinding(38), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "lineDown",	keyBinding: new KeyBinding(40), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "charPrevious",	keyBinding: new KeyBinding(37), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "charNext",	keyBinding: new KeyBinding(39), predefined: true}); //$NON-NLS-0$
		if (util.isMac) {
			bindings.push({actionID: "scrollPageUp",		keyBinding: new KeyBinding(33), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollPageDown",	keyBinding: new KeyBinding(34), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "pageUp",		keyBinding: new KeyBinding(33, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "pageDown",	keyBinding: new KeyBinding(34, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineStart",	keyBinding: new KeyBinding(37, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineEnd",		keyBinding: new KeyBinding(39, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "wordPrevious",	keyBinding: new KeyBinding(37, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "wordNext",	keyBinding: new KeyBinding(39, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollTextStart",	keyBinding: new KeyBinding(36), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollTextEnd",		keyBinding: new KeyBinding(35), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "textStart",	keyBinding: new KeyBinding(38, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "textEnd",		keyBinding: new KeyBinding(40, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollPageUp",	keyBinding: new KeyBinding(38, null, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollPageDown",		keyBinding: new KeyBinding(40, null, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineStart",	keyBinding: new KeyBinding(37, null, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineEnd",		keyBinding: new KeyBinding(39, null, null, null, true), predefined: true}); //$NON-NLS-0$
			//TODO These two actions should be changed to paragraph start and paragraph end  when word wrap is implemented
			bindings.push({actionID: "lineStart",	keyBinding: new KeyBinding(38, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineEnd",		keyBinding: new KeyBinding(40, null, null, true), predefined: true}); //$NON-NLS-0$
		} else {
			bindings.push({actionID: "pageUp",		keyBinding: new KeyBinding(33), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "pageDown",	keyBinding: new KeyBinding(34), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineStart",	keyBinding: new KeyBinding(36), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineEnd",		keyBinding: new KeyBinding(35), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "wordPrevious",	keyBinding: new KeyBinding(37, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "wordNext",	keyBinding: new KeyBinding(39, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "textStart",	keyBinding: new KeyBinding(36, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "textEnd",		keyBinding: new KeyBinding(35, true), predefined: true}); //$NON-NLS-0$
		}
		if (util.isFirefox && util.isLinux) {
			bindings.push({actionID: "lineUp",		keyBinding: new KeyBinding(38, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "lineDown",	keyBinding: new KeyBinding(40, true), predefined: true}); //$NON-NLS-0$
		}
		if (util.isWindows) {
			bindings.push({actionID: "scrollLineUp",	keyBinding: new KeyBinding(38, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "scrollLineDown",	keyBinding: new KeyBinding(40, true), predefined: true}); //$NON-NLS-0$
		}

		// Select Cursor Navigation
		bindings.push({actionID: "selectLineUp",		keyBinding: new KeyBinding(38, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectLineDown",		keyBinding: new KeyBinding(40, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectCharPrevious",	keyBinding: new KeyBinding(37, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectCharNext",		keyBinding: new KeyBinding(39, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectPageUp",		keyBinding: new KeyBinding(33, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectPageDown",		keyBinding: new KeyBinding(34, null, true), predefined: true}); //$NON-NLS-0$
		if (util.isMac) {
			bindings.push({actionID: "selectLineStart",	keyBinding: new KeyBinding(37, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectLineEnd",		keyBinding: new KeyBinding(39, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectWordPrevious",	keyBinding: new KeyBinding(37, null, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectWordNext",	keyBinding: new KeyBinding(39, null, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextStart",	keyBinding: new KeyBinding(36, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextEnd",		keyBinding: new KeyBinding(35, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextStart",	keyBinding: new KeyBinding(38, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextEnd",		keyBinding: new KeyBinding(40, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectLineStart",	keyBinding: new KeyBinding(37, null, true, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectLineEnd",		keyBinding: new KeyBinding(39, null, true, null, true), predefined: true}); //$NON-NLS-0$
			//TODO These two actions should be changed to select paragraph start and select paragraph end  when word wrap is implemented
			bindings.push({actionID: "selectLineStart",	keyBinding: new KeyBinding(38, null, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectLineEnd",		keyBinding: new KeyBinding(40, null, true, true), predefined: true}); //$NON-NLS-0$
		} else {
			if (util.isLinux) {
				bindings.push({actionID: "selectWholeLineUp",		keyBinding: new KeyBinding(38, true, true), predefined: true}); //$NON-NLS-0$
				bindings.push({actionID: "selectWholeLineDown",		keyBinding: new KeyBinding(40, true, true), predefined: true}); //$NON-NLS-0$
			}
			bindings.push({actionID: "selectLineStart",		keyBinding: new KeyBinding(36, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectLineEnd",		keyBinding: new KeyBinding(35, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectWordPrevious",	keyBinding: new KeyBinding(37, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectWordNext",		keyBinding: new KeyBinding(39, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextStart",		keyBinding: new KeyBinding(36, true, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "selectTextEnd",		keyBinding: new KeyBinding(35, true, true), predefined: true}); //$NON-NLS-0$
		}
		
		//Undo stack
		bindings.push({actionID: "undo", keyBinding: new mKeyBinding.KeyBinding('z', true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		if (util.isMac) {
			bindings.push({actionID: "redo", keyBinding: new mKeyBinding.KeyBinding('z', true, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		} else {
			bindings.push({actionID: "redo", keyBinding: new mKeyBinding.KeyBinding('y', true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		}

		//Misc
		bindings.push({actionID: "deletePrevious",		keyBinding: new KeyBinding(8), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "deletePrevious",		keyBinding: new KeyBinding(8, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "deleteNext",		keyBinding: new KeyBinding(46), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "deleteWordPrevious",	keyBinding: new KeyBinding(8, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "deleteWordPrevious",	keyBinding: new KeyBinding(8, true, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "deleteWordNext",		keyBinding: new KeyBinding(46, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "tab",			keyBinding: new KeyBinding(9), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "shiftTab",			keyBinding: new KeyBinding(9, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "enter",			keyBinding: new KeyBinding(13), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "enter",			keyBinding: new KeyBinding(13, null, true), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "escape",			keyBinding: new KeyBinding(27), predefined: true}); //$NON-NLS-0$
		bindings.push({actionID: "selectAll",		keyBinding: new KeyBinding('a', true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		bindings.push({actionID: "toggleTabMode",	keyBinding: new KeyBinding('m', true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		if (util.isMac) {
			bindings.push({actionID: "deleteNext",		keyBinding: new KeyBinding(46, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "deleteWordPrevious",	keyBinding: new KeyBinding(8, null, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "deleteWordNext",		keyBinding: new KeyBinding(46, null, null, true), predefined: true}); //$NON-NLS-0$
		}
		
		bindings.push({actionID: "toggleWrapMode",		keyBinding: new mKeyBinding.KeyBinding('w', true, false, true)}); //$NON-NLS-1$ //$NON-NLS-0$
		bindings.push({actionID: "toggleOverwriteMode",		keyBinding: new mKeyBinding.KeyBinding(45)}); //$NON-NLS-0$
		
		/*
		* Feature in IE/Chrome: prevent ctrl+'u', ctrl+'i', and ctrl+'b' from applying styles to the text.
		*
		* Note that Chrome applies the styles on the Mac with Ctrl instead of Cmd.
		*/
		if (!util.isFirefox) {
			var isMacChrome = util.isMac && util.isChrome;
			bindings.push({actionID: "noop", keyBinding: new KeyBinding('u', !isMacChrome, false, false, isMacChrome), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "noop", keyBinding: new KeyBinding('i', !isMacChrome, false, false, isMacChrome), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "noop", keyBinding: new KeyBinding('b', !isMacChrome, false, false, isMacChrome), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
		}

		if (util.isFirefox) {
			bindings.push({actionID: "copy", keyBinding: new KeyBinding(45, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "paste", keyBinding: new KeyBinding(45, null, true), predefined: true}); //$NON-NLS-0$
			bindings.push({actionID: "cut", keyBinding: new KeyBinding(46, null, true), predefined: true}); //$NON-NLS-0$
		}

		// Add the emacs Control+ ... key bindings.
		if (util.isMac) {
			bindings.push({actionID: "lineStart", keyBinding: new KeyBinding("a", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "lineEnd", keyBinding: new KeyBinding("e", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "lineUp", keyBinding: new KeyBinding("p", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "lineDown", keyBinding: new KeyBinding("n", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "charPrevious", keyBinding: new KeyBinding("b", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "charNext", keyBinding: new KeyBinding("f", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "deletePrevious", keyBinding: new KeyBinding("h", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "deleteNext", keyBinding: new KeyBinding("d", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "deleteLineEnd", keyBinding: new KeyBinding("k", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			if (util.isFirefox) {
				bindings.push({actionID: "scrollPageDown", keyBinding: new KeyBinding("v", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
				bindings.push({actionID: "deleteLineStart", keyBinding: new KeyBinding("u", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
				bindings.push({actionID: "deleteWordPrevious", keyBinding: new KeyBinding("w", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
			} else {
				bindings.push({actionID: "pageDown", keyBinding: new KeyBinding("v", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
				bindings.push({actionID: "centerLine", keyBinding: new KeyBinding("l", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
				bindings.push({actionID: "enterNoCursor", keyBinding: new KeyBinding("o", false, false, false, true), predefined: true}); //$NON-NLS-1$ //$NON-NLS-0$
				//TODO implement: y (yank), t (transpose)
			}
		}
		return bindings;
	};
	
	return {
		KeyMode: KeyMode,
		DefaultKeyMode: DefaultKeyMode
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013,2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/textTheme", //$NON-NLS-0$
[
	'require', //$NON-NLS-0$
	'orion/editor/eventTarget', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(require, mEventTarget, util) {
	var THEME_PREFIX = "orion-theme-"; //$NON-NLS-0$
	
	var Themes = {};

	/**
	 * Constructs a new text theme. 
	 * 
	 * @class A TextTheme is a class used to specify an editor theme.
	 * @name orion.editor.TextTheme
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function TextTheme(options) {
		options = options || {};
		this._document = options.document || document;
	}

	/**
	 * Gets an instance of <code>orion.editor.TextTheme</code> by name. If the name
	 * paramenter is not speficed the default text theme instance is returned.
	 * Subsequent calls of <code>getTheme</code> with the same name will return
	 * the same instance.
	 */
	TextTheme.getTheme = function(name) {
		name = name || "default"; //$NON-NLS-0$
		var theme = Themes[name];
		if (!theme) {
			theme = Themes[name] = new TextTheme();
		}
		return theme;
	};

	TextTheme.prototype = /** @lends orion.editor.TextTheme.prototype */ {
		/**
		 * Returns the theme className.
		 *
		 * @see orion.editor.TextTheme#setThemeClass
		 */
		getThemeClass: function() {
			return this._themeClass;
		},
		/**
		 * @class This object represents a style sheet for a theme manager.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextTheme#setThemeClass}
		 * </p>
		 * @name orion.editor.ThemeStyleSheet
		 * 
		 * @property {String} href The href of the stylesheet
		 */
		/**
		 * Sets the theme className and style sheet.
		 * <p>
		 * If the <code>stylesheet</code> parameter is a string, it represents an inline
		 * CSS and it will be added to the document as a <i>STYLE</i> tag element.  If the
		 * <code>stylesheet</code> parameter is a <code>orion.editor.ThemeStyleSheet</code>,
		 * its href property is loaded as either a <i>STYLE</i> tag element or as a <i>LINK</i>
		 * tag element.
		 * </p>
		 * <p>
		 * Listeners of the ThemeChanged event are notify once the styled sheet is loaded
		 * into the document.
		 * </p>
		 *
		 * @param {String} className the new theme className.
		 * @param {String|orion.editor.ThemeStyleSheet} styleSheet the CSS stylesheet for the new theme className.
		 *
		 * @see orion.editor.TextTheme#getThemeClass
		 * @see orion.editor.TextTheme#onThemeChanged
		 */
		 setThemeClass: function(className, styleSheet) {
			var self = this;
			var oldThemeClass = self._themeClass;	
			self._themeClass = className;
			this._load(className, styleSheet, function() {
				self.onThemeChanged({
					type: "ThemeChanged", //$NON-NLS-0$
					oldValue: oldThemeClass,
					newValue: self.getThemeClass()
				});
			});
		},
		/**
		 * @class This is the event sent when the theme className or style sheet has changed.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextTheme}<br/>
		 * {@link orion.editor.TextTheme#event:onThemeChanged}
		 * </p>
		 * @name orion.editor.ThemeChangedEvent
		 * 
		 * @property {String} oldValue The old theme clasName.
		 * @property {String} newValue The new theme className.
		 */
		/**
		 * This event is sent when the theme clasName has changed and its style sheet has been loaded in the document.
		 *
		 * @event
		 * @param {orion.editor.ThemeChangedEvent} themeChangedEvent the event
		 */
		onThemeChanged: function(themeChangedEvent) {
			return this.dispatchEvent(themeChangedEvent);
		},
		buildStyleSheet: function(themeClass, settings) {
			var convertCSSname = function(name) {
				return name.replace(this._capitalRegEx, function(match) {
					return "-" + match; //$NON-NLS-0$
				}.bind(this)).toLowerCase();
			}.bind(this);

			var parseStyles = function(object, ancestors, className, isTopLevel, result) {
				var localResult = [];
				var keys = Object.keys(object);
				keys.forEach(function(key) {
					var value = object[key];
					if (typeof(value) === "string") { //$NON-NLS-0$
						localResult.push("\t" + convertCSSname(key) + ": " + value + ";"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
					} else {
						parseStyles(
							value,
							className === key ? ancestors : ancestors + (isTopLevel ? " ." : ".") + key, //$NON-NLS-1$ //$NON-NLS-0$
							className,
							false,
							result);
					}
				});
				if (localResult.length) {
					result.push(ancestors + (isTopLevel ? ".textview" : "") + " {"); //$NON-NLS-0$
					result.push.apply(result, localResult);
					result.push("}"); //$NON-NLS-0$
				}
			};

			var result = [""];
			parseStyles(settings.styles, "." + themeClass, settings.className, true, result); //$NON-NLS-0$
			return result.join("\n"); //$NON-NLS-0$
		},

		/**
		 * @private
		 */
		_createStyle: function(className, styleSheet, callback, link) {
			var document = this._document;
			var id = THEME_PREFIX + className;
			var node = document.getElementById(id);
			if (node) {
				if (link || node.firstChild.data === styleSheet) {
					return;
				}
				node.removeChild(node.firstChild);
				node.appendChild(document.createTextNode(styleSheet));
			} else {
				if (link) {
					node = util.createElement(document, "link"); //$NON-NLS-0$
					node.rel = "stylesheet"; //$NON-NLS-0$
					node.type = "text/css"; //$NON-NLS-0$
					node.href = styleSheet;
					node.addEventListener("load", function() { //$NON-NLS-0$
						callback();
					});
				} else {
					node = util.createElement(document, "style"); //$NON-NLS-0$
					node.appendChild(document.createTextNode(styleSheet));
				}
				node.id = id;
				var head = document.getElementsByTagName("head")[0] || document.documentElement; //$NON-NLS-0$
				head.appendChild(node);
			}
			if (!link) {
				callback();
			}
		},
		/**
		 * @private
		 */
		_load: function (className, styleSheet, callback) {
			if (!className) {
				callback();
				return;
			}
			if (typeof styleSheet === "string") { //$NON-NLS-0$
				this._createStyle(className, styleSheet, callback);
				return;
			}
			var href = styleSheet.href;
			var extension = ".css"; //$NON-NLS-0$
			if (href.substring(href.length - extension.length) !== extension) {
				href += extension;
			}
			if (/^\//.test(href) || /[a-zA-Z0-9]+:\/\//i.test(href) || !require.toUrl /* almond cannot load dynamically */) {
				this._createStyle(className, href, callback, true);
			} else {
				var self = this;
				require(["text!" + href], function(cssText) { //$NON-NLS-0$
					self._createStyle(className, cssText, callback, false);
				});
			}
		},
		_capitalRegEx: /[A-Z]/g
	};
	mEventTarget.EventTarget.addMixin(TextTheme.prototype);
	
	return {
		TextTheme: TextTheme
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/util", [], function() { //$NON-NLS-0$
	
	/** @private */
	function addEventListener(node, type, handler, capture) {
		if (typeof node.addEventListener === "function") { //$NON-NLS-0$
			node.addEventListener(type, handler, capture === true);
		} else {
			node.attachEvent("on" + type, handler); //$NON-NLS-0$
		}
	}
	/** @private */
	function removeEventListener(node, type, handler, capture) {
		if (typeof node.removeEventListener === "function") { //$NON-NLS-0$
			node.removeEventListener(type, handler, capture === true);
		} else {
			node.detachEvent("on" + type, handler); //$NON-NLS-0$
		}
	}
	/** @private */
	function contains(topNode, node) {
		if (!node) { return false; }
		if (!topNode.compareDocumentPosition) {
			var temp = node;
			while (temp) {
				if (topNode === temp) {
					return true;
				}
				temp = temp.parentNode;
			}
			return false;
		}
		return topNode === node || (topNode.compareDocumentPosition(node) & 16) !== 0;
	}
	/** @private */
	function getNodeStyle(node, prop, defaultValue) {
		var value;
		if (node) {
			value = node.style[prop];
			if (!value) {
				if (node.currentStyle) {
					var index = 0, p = prop;
					while ((index = p.indexOf("-", index)) !== -1) { //$NON-NLS-0$
						p = p.substring(0, index) + p.substring(index + 1, index + 2).toUpperCase() + p.substring(index + 2);
					}
					value = node.currentStyle[p];
				} else {
					var css = node.ownerDocument.defaultView.getComputedStyle(node, null);
					value = css ? css.getPropertyValue(prop) : null;
				}
			}
		}
		return value || defaultValue;
	}

	/**
	 * @class
	 * @private
	 * @name orion.editor.Animation
	 * @description Creates an animation.
	 * @param {Object} options Options controlling the animation.
	 * @param {Array} options.curve Array of 2 values giving the start and end points for the animation.
	 * @param {Number} [options.duration=350] Duration of the animation, in milliseconds.
	 * @param {Function} [options.easing]
	 * @param {Function} [options.onAnimate]
	 * @param {Function} [options.onEnd]
	 * @param {Number} [options.rate=20] The time between frames, in milliseconds.
	 */
	var Animation = /** @ignore */ (function() {
		function Animation(options) {
			this.options = options;
		}
		/**
		 * Plays this animation.
		 * @function
		 * @memberOf orion.editor.Animation.prototype
		 * @name play
		 */
		Animation.prototype.play = function() {
			var duration = (typeof this.options.duration === "number") ? this.options.duration : 350, //$NON-NLS-0$
			    rate = (typeof this.options.rate === "number") ? this.options.rate : 20, //$NON-NLS-0$
			    easing = this.options.easing || this.defaultEasing,
			    onAnimate = this.options.onAnimate || function() {},
			    start = this.options.curve[0],
			    end = this.options.curve[1],
			    range = (end - start),
			    startedAt = -1,
				propertyValue,
				self = this;

			function onFrame() {
				startedAt = (startedAt === -1) ? new Date().getTime() : startedAt;
				var now = new Date().getTime(),
				    percentDone = (now - startedAt) / duration;
				if (percentDone < 1) {
					var eased = easing(percentDone);
					propertyValue = start + (eased * range);
					onAnimate(propertyValue);
				} else {
					onAnimate(end);
					self.stop();
				}
			}
			this.interval = this.options.window.setInterval(onFrame, rate);
		};
		/**
		 * Stops this animation.
		 * @function
		 * @memberOf orion.editor.Animation.prototype
		 */
		Animation.prototype.stop = function() {
			this.options.window.clearInterval(this.interval);
		    var onEnd = this.options.onEnd || function () {};
			onEnd();
		};
		Animation.prototype.defaultEasing = function(x) {
			return Math.sin(x * (Math.PI / 2));
		};
		return Animation;
	}());

	return {
		contains: contains,
		getNodeStyle: getNodeStyle,
		addEventListener: addEventListener,
		removeEventListener: removeEventListener,
		Animation: Animation
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/metrics',["orion/Deferred"], function(Deferred) {
	var GA_ID = "OrionGA"; //$NON-NLS-0$
	var queue = [];

	var init = function(serviceRegistry, args) {
		var refs = serviceRegistry.getServiceReferences("orion.analytics.google"); //$NON-NLS-0$
		if (refs.length) {
			var ref = refs[0];
			var service = serviceRegistry.getService(ref);
			if (service && service.init) {
				service.init().then(
					function(result) {
						if (!result.tid) { /* not tracking */
							queue = null;
							return;
						}

						(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
						(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
						m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
						})(window,document,'script','//www.google-analytics.com/analytics.js',GA_ID);

						args = args || {};
						if (result.siteSpeedSampleRate) {
							args.siteSpeedSampleRate = result.siteSpeedSampleRate;
						}
						window[GA_ID]("create", result.tid, args); //$NON-NLS-0$
						window[GA_ID]("send", "pageview"); //$NON-NLS-1$ //$NON-NLS-0$

						queue.forEach(function(current) {
							window[GA_ID](current.command, current.arg0, current.arg1, current.arg2, current.arg3, current.arg4); //$NON-NLS-0$
						});
						queue = null; /* no longer needed */
					}
				);
			}
		}
		if (!(service && service.init)) {
			queue = null; /* not tracking */
		}
	};

	function logEvent(category, action, label, value) {
		if (window[GA_ID]) {
			window[GA_ID]("send", "event", category, action, label, value); //$NON-NLS-1$ //$NON-NLS-0$
		} else {
			if (queue) {
				queue.push({command: "send", arg0: "event", arg1: category, arg2: action, arg3: label, arg4: value}); //$NON-NLS-1$ //$NON-NLS-0$
			}
		}
	}

	function logPageLoadTiming(timingVar, timingLabel) {
		/* 
		 * The level of window.performance implementation varies across the browsers,
		 * so check for the existence of all utilized functions up-front.
		 */
		if (window.performance && window.performance.getEntriesByName && window.performance.mark && !window.performance.getEntriesByName(timingVar).length) {
			window.performance.mark(timingVar); /* ensure that no more timings of this type are logged for this page */
			logTiming("page", timingVar, window.performance.now(), timingLabel); //$NON-NLS-0$
		}
	}

	function logTiming(timingCategory, timingVar, timingValue, timingLabel) {
		if (window[GA_ID]) {
			window[GA_ID]("send", "timing", timingCategory, timingVar, Math.round(timingValue), timingLabel); //$NON-NLS-1$ //$NON-NLS-0$
		} else {
			if (queue) {
				queue.push({command: "send", arg0: "timing", arg1: timingCategory, arg2: timingVar, arg3: Math.round(timingValue), arg4: timingLabel}); //$NON-NLS-1$ //$NON-NLS-0$
			}
		}
	}

	function setDimension(dimensionId, value) {
		if (window[GA_ID]) {
			window[GA_ID]("set", dimensionId, value); //$NON-NLS-0$
		} else {
			if (queue) {
				queue.push({command: "set", arg0: dimensionId, arg1: value}); //$NON-NLS-0$
			}
		}
	}

	return {
		init: init,
		logEvent: logEvent,
		logPageLoadTiming: logPageLoadTiming,
		logTiming: logTiming,
		setDimension: setDimension
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 *		Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/textView", [  //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/editor/textModel', //$NON-NLS-0$
	'orion/editor/keyModes', //$NON-NLS-0$
	'orion/editor/eventTarget', //$NON-NLS-0$
	'orion/editor/textTheme', //$NON-NLS-0$
	'orion/editor/util', //$NON-NLS-0$
	'orion/util', //$NON-NLS-0$
	'orion/metrics' //$NON-NLS-0$
], function(messages, mTextModel, mKeyModes, mEventTarget, mTextTheme, textUtil, util, mMetrics) {

	/** @private */
	function getWindow(document) {
		return document.defaultView || document.parentWindow;
	}
	function newArray(length) {
		return new Array(length);
	}
	var addHandler = textUtil.addEventListener;
	var removeHandler = textUtil.removeEventListener;
	/** @private */
	function applyStyle(style, node, reset) {
		if (reset) {
			node.className = "";
			var attrs = node.attributes;
			for (var i= attrs.length; i-->0;) {
				if (!util.isIE || util.isIE >= 9 || (util.isIE < 9 && attrs[i].specified)) {
					node.removeAttribute(attrs[i].name); 
				}
			}
		}
		if (!style) {
			return;
		}
		if (style.styleClass) {
			node.className = style.styleClass;
		}
		var properties = style.style;
		if (properties) {
			for (var s in properties) {
				if (properties.hasOwnProperty(s)) {
					node.style[s] = properties[s];
				}
			}
		}
		var attributes = style.attributes;
		if (attributes) {
			for (var a in attributes) {
				if (attributes.hasOwnProperty(a)) {
					node.setAttribute(a, attributes[a]);
				}
			}
		}
	}
	/** @private */
	function clone(obj) {
		/*Note that this code only works because of the limited types used in TextViewOptions */
		if (obj instanceof Array) {
			return obj.slice(0);
		}
		return obj;
	}
	/**	@private */
	function merge(obj1, obj2) {
		if (!obj1) {
			return obj2;
		}
		if (!obj2) {
			return obj1;
		}
		for (var p in obj2) {
			if (obj2.hasOwnProperty(p)) {
				if (!obj1.hasOwnProperty(p)) {
					obj1[p] = obj2[p];
				}
			}
		}
		return obj1;
	}
	/** @private */
	function compare(s1, s2) {
		if (s1 === s2) { return true; }
		if (s1 && !s2 || !s1 && s2) { return false; }
		if ((s1 && s1.constructor === String) || (s2 && s2.constructor === String)) { return false; }
		if (s1 instanceof Array || s2 instanceof Array) {
			if (!(s1 instanceof Array && s2 instanceof Array)) { return false; }
			if (s1.length !== s2.length) { return false; }
			for (var i = 0; i < s1.length; i++) {
				if (!compare(s1[i], s2[i])) {
					return false;
				}
			}
			return true;
		}
		if (!(s1 instanceof Object) || !(s2 instanceof Object)) { return false; }
		var p;
		for (p in s1) {
			if (s1.hasOwnProperty(p)) {
				if (!s2.hasOwnProperty(p)) { return false; }
				if (!compare(s1[p], s2[p])) {return false; }
			}
		}
		for (p in s2) {
			if (!s1.hasOwnProperty(p)) { return false; }
		}
		return true;
	}
	/** @private */
	function convertDelimiter(text, addTextFunc, addDelimiterFunc) {
		var cr = 0, lf = 0, index = 0, length = text.length;
		while (index < length) {
			if (cr !== -1 && cr <= index) { cr = text.indexOf("\r", index); } //$NON-NLS-0$
			if (lf !== -1 && lf <= index) { lf = text.indexOf("\n", index); } //$NON-NLS-0$
			var start = index, end;
			if (lf === -1 && cr === -1) {
				addTextFunc(text.substring(index));
				break;
			}
			if (cr !== -1 && lf !== -1) {
				if (cr + 1 === lf) {
					end = cr;
					index = lf + 1;
				} else {
					end = cr < lf ? cr : lf;
					index = (cr < lf ? cr : lf) + 1;
				}
			} else if (cr !== -1) {
				end = cr;
				index = cr + 1;
			} else {
				end = lf;
				index = lf + 1;
			}
			addTextFunc(text.substring(start, end));
			if (addDelimiterFunc) {
				addDelimiterFunc();
			} else {
				if (index === length) addTextFunc("");
			}
		}
	}
	/** @private */
	function getBorder(node) {
		var left,top,right,bottom;
		var window = getWindow(node.ownerDocument);
		if (window.getComputedStyle) {
			var style = window.getComputedStyle(node, null);
			left = style.getPropertyValue("border-left-width"); //$NON-NLS-0$
			top = style.getPropertyValue("border-top-width"); //$NON-NLS-0$
			right = style.getPropertyValue("border-right-width"); //$NON-NLS-0$
			bottom = style.getPropertyValue("border-bottom-width"); //$NON-NLS-0$
		} else if (node.currentStyle) {
			left = node.currentStyle.borderLeftWidth;
			top = node.currentStyle.borderTopWidth;
			right = node.currentStyle.borderRightWidth;
			bottom = node.currentStyle.borderBottomWidth;
		}
		return {
			left: parseInt(left, 10) || 0,
			top: parseInt(top, 10) || 0,
			right: parseInt(right, 10) || 0,
			bottom: parseInt(bottom, 10) || 0
		};
	}
	/** @private */
	function getPadding(node) {
		var left,top,right,bottom;
		var window = getWindow(node.ownerDocument);
		if (window.getComputedStyle) {
			var style = window.getComputedStyle(node, null);
			left = style.getPropertyValue("padding-left"); //$NON-NLS-0$
			top = style.getPropertyValue("padding-top"); //$NON-NLS-0$
			right = style.getPropertyValue("padding-right"); //$NON-NLS-0$
			bottom = style.getPropertyValue("padding-bottom"); //$NON-NLS-0$
		} else if (node.currentStyle) {
			left = node.currentStyle.paddingLeft;
			top = node.currentStyle.paddingTop;
			right = node.currentStyle.paddingRight;
			bottom = node.currentStyle.paddingBottom;
		}
		return {
			left: parseInt(left, 10) || 0, 
			top: parseInt(top, 10) || 0,
			right: parseInt(right, 10) || 0,
			bottom: parseInt(bottom, 10) || 0
		};
	}
	/** @private */
	function getLineTrim(line) {
		var trim = line._trim;
		if (!trim) {
			trim = getPadding(line);
			var border = getBorder(line);
			trim.left += border.left;
			trim.top += border.top;
			trim.right += border.right;
			trim.bottom += border.bottom;
			line._trim = trim;
		}
		return trim;
	}
	/** @private */
	function DOMReady(document, parent, className, callback) {
		className = "_" + className + "DOMReady"; //$NON-NLS-1$ //$NON-NLS-0$
		parent.className = parent.className ? parent.className + " " + className : className; //$NON-NLS-0$
		parent.__DOMReady = callback;
		var id = className + "Style"; //$NON-NLS-0$
		if (document.getElementById(id)) { return; }
		var animationName = className + "Animation"; //$NON-NLS-0$
		function insertListener(event) {
			if (event.animationName === animationName) {
				var target = event.target;
				if (typeof target.__DOMReady === "function") { //$NON-NLS-0$
					getWindow(document).setTimeout(function() {
						target.__DOMReady();
					}, 0);
				}
			}
		}
		function template(className, animationName) {
			var props = ["", "-webkit-", "-moz-", "-ms-", "-o-"]; //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			var frames = "", classRule = "body ." + className + " {\n"; //$NON-NLS-1$ //$NON-NLS-0$
			for (var i=0; i<props.length; i++) {
				frames +=
				"@" + props[i] + "keyframes " + animationName + " {\n" + //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				"from { opacity: 0.99; }\n" + //$NON-NLS-0$
				"to { opacity: 1; }\n" + //$NON-NLS-0$
				"}\n"; //$NON-NLS-0$
				classRule +=
				props[i] + "animation-duration: 0.001s;\n" + //$NON-NLS-0$
				props[i] + "animation-name: " + animationName + ";\n"; //$NON-NLS-1$ //$NON-NLS-0$
			}
			classRule += "}"; //$NON-NLS-0$
			return frames + classRule;
		}
		addHandler(document, "animationstart", insertListener, false); //$NON-NLS-0$
		addHandler(document, "MSAnimationStart", insertListener, false);  //$NON-NLS-0$
		addHandler(document, "webkitAnimationStart", insertListener, false); //$NON-NLS-0$
		var style = document.createElement("style"); //$NON-NLS-0$
		style.id = id;
		var head = document.getElementsByTagName("head")[0] || document.documentElement; //$NON-NLS-0$
		style.appendChild(document.createTextNode(template(className, animationName)));
		head.insertBefore(style, head.firstChild);
	}
	
	var Animation = textUtil.Animation;
	
	/** 
	 * Constructs a new Selection object.
	 * 
	 * @class A Selection represents a range of selected text in the view.
	 * @name orion.editor.Selection
	 */
	function Selection (start, end, caret) {
		/**
		 * The selection start offset.
		 *
		 * @name orion.editor.Selection#start
		 */
		this.start = start;
		/**
		 * The selection end offset.
		 *
		 * @name orion.editor.Selection#end
		 */
		this.end = end;
		/** @private */
		this.caret = caret; //true if the start, false if the caret is at end
		/** @private */
		this._columnX = -1;
	}
	/** @private */
	Selection.compare = function(s1, s2) {
		if (s1.length !== s2.length) return false;
		for (var i = 0; i < s1.length; i++) {
			if (!s1[i].equals(s2[i])) return false;
		}
		return true;
	};
	Selection.editing = function(selections, back) {
		var i;
		if (back) {
			for (i = selections.length - 1; i >= 0; i--) {
				if (selections[i]._editing) return selections[i];
			}
			return selections[selections.length - 1];
		}
		for (i = 0; i < selections.length; i++) {
			if (selections[i]._editing) return selections[i];
		}
		return selections[0];
	};
	/** @private */
	Selection.convert = function(selections) {
		if (selections.length === 1) return selections[0];
		return selections;
	};
	/** @private */
	Selection.contains = function(selections, offset) {
		return selections.some(function(selection) {
			return selection.contains(offset);
		});
	};
	/** @private */
	Selection.merge = function(selections) {
		if (selections.length <= 1) return selections;
		selections.sort(function(a, b) {
			return a.start - b.start;
		});
		var result = [];
		var current = selections[0];
		for (var i = 1; i < selections.length; i++) {
			if (selections[i].start >= current.end || current._editing || selections[i]._editing) {
				result.push(current);
				current = selections[i];
			} else {
				current.end = Math.max(current.end, selections[i].end);
			}
		}
		result.push(current);
		return result;
	};
	Selection.prototype = /** @lends orion.editor.Selection.prototype */ {
		/** @private */
		clone: function() {
			var result = new Selection(this.start, this.end, this.caret);
			result._columnX = this._columnX;
			result._editing = this._editing;
			result._docX = this._docX;
			return result;
		},
		/** @private */
		contains: function(offset) {
			if (this.start <= offset && offset < this.end) {
				return true;
			}
			return false;
		},
		/** @private */
		collapse: function() {
			if (this.caret) {
				this.end = this.start;
			} else {
				this.start = this.end;
			}
		},
		/** @private */
		extend: function (offset) {
			if (this.caret) {
				this.start = offset;
			} else {
				this.end = offset;
			}
			if (this.start > this.end) {
				var tmp = this.start;
				this.start = this.end;
				this.end = tmp;
				this.caret = !this.caret;
			}
		},
		/** @private */
		setCaret: function(offset) {
			this.start = offset;
			this.end = offset;
			this.caret = false;
		},
		/** @private */
		getCaret: function() {
			return this.caret ? this.start : this.end;
		},
		/** @private */
		getAnchor: function() {
			return this.caret ? this.end : this.start;
		},
		/** @private */
		toString: function() {
			return "start=" + this.start + " end=" + this.end + (this.caret ? " caret is at start" : " caret is at end"); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		},
		/** @private */
		isEmpty: function() {
			return this.start === this.end;
		},
		/** @private */
		equals: function(object) {
			return this.caret === object.caret && this.start === object.start && this.end === object.end && this._editing === object._editing;
		}
	};
	/** @private */
	function DOMSelection (view) {
		this._view = view;
		this._divs = [];
		var parent = view._clipDiv || view._rootDiv;
		for (var i=0; i<3; i++) {
			var div = view._createSelectionDiv();
			parent.appendChild(div);
			this._divs.push(div);
		}
	}
	DOMSelection.prototype = /** @lends orion.editor.DOMSelection.prototype */ {
		/** @private */
		destroy: function() {
			if (!this._divs) return;
			this._divs.forEach(function(div) {
				div.parentNode.removeChild(div);
			});
			this._divs = null;
		},
		/** @private */
		setPrimary: function(enabled) {
			this.primary = enabled;
		},
		/** @private */
		update: function() {
			var view = this._view;
			var primary = this.primary;
			var focused = view._hasFocus;
			var visible = view._cursorVisible;
			var cursor = !this.primary && this._selection && this._selection.isEmpty();
			var className;
			if (cursor) {
				className = "textviewSelectionCaret"; //$NON-NLS-0$
			} else {
				className = focused ? "textviewSelection" : "textviewSelectionUnfocused"; //$NON-NLS-1$ //$NON-NLS-0$
			}
			this._divs[0].style.visibility = (cursor && visible && focused) || !cursor ? "visible" : "hidden"; //$NON-NLS-1$ //$NON-NLS-0$
			this._divs[0].style.zIndex = visible && cursor ? "2" : "0"; //$NON-NLS-1$ //$NON-NLS-0$
			this._divs.forEach(function(div) {
				div.className = className;
				if (util.isWebkit && primary) {
					div.style.background = focused ? "transparent" : ""; //$NON-NLS-0$
				}
			});
		},
		/** @private */
		setSelection: function (selection) {
			this._selection = selection;
			this.update();
			var view = this._view;
			var model = view._model;
			var startLine = model.getLineAtOffset(selection.start);
			var endLine = model.getLineAtOffset(selection.end);
			var firstNode = view._getLineNext();
			/*
			* Bug in Firefox. For some reason, after a update page sometimes the 
			* firstChild returns null incorrectly. The fix is to ignore show selection.
			*/
			if (!firstNode) { return; }
			var lastNode = view._getLinePrevious();
			
			var topNode, bottomNode, topOffset, bottomOffset;
			if (startLine < firstNode.lineIndex) {
				topNode = firstNode;
				topOffset = model.getLineStart(firstNode.lineIndex);
			} else if (startLine > lastNode.lineIndex) {
				topNode = lastNode;
				topOffset = model.getLineStart(lastNode.lineIndex);
			} else {
				topNode = view._getLineNode(startLine);
				topOffset = selection.start;
			}

			if (endLine < firstNode.lineIndex) {
				bottomNode = firstNode;
				bottomOffset = model.getLineStart(firstNode.lineIndex);
			} else if (endLine > lastNode.lineIndex) {
				bottomNode = lastNode;
				bottomOffset = model.getLineStart(lastNode.lineIndex);
			} else {
				bottomNode = view._getLineNode(endLine);
				bottomOffset = selection.end;
			}
			this._setDOMSelection(topNode, topOffset, bottomNode, bottomOffset, selection.caret);
		},
		/** @private */
		_setDOMSelection: function (startNode, startOffset, endNode, endOffset, startCaret) {
			this._setDOMFullSelection(startNode, startOffset, endNode, endOffset);
			if (!this.primary) { return; }
			var view = this._view;
			var start = startNode._line.getNodeOffset(startOffset);
			var end = endNode._line.getNodeOffset(endOffset);
			if (!start.node || !end.node) return;
			var range;
			var window = view._getWindow();
			var document = view._parent.ownerDocument;
			if (window.getSelection) {
				//W3C
				var sel = window.getSelection();
				range = document.createRange();
				range.setStart(start.node, start.offset);
				range.setEnd(end.node, end.offset);
				if (view._hasFocus && (
					sel.anchorNode !== start.node || sel.anchorOffset !== start.offset ||
					sel.focusNode !== end.node || sel.focusOffset !== end.offset ||
					sel.anchorNode !== end.node || sel.anchorOffset !== end.offset ||
					sel.focusNode !== start.node || sel.focusOffset !== start.offset))
				{
					view._anchorNode = start.node;
					view._anchorOffset = start.offset;
					view._focusNode = end.node;
					view._focusOffset = end.offset;
					view._ignoreSelect = false;
					if (sel.rangeCount > 0) { sel.removeAllRanges(); }
					sel.addRange(range);
					view._ignoreSelect = true;
				}
				if (view._cursorDiv) {
					range = document.createRange();
					if (startCaret) {
						range.setStart(start.node, start.offset);
						range.setEnd(start.node, start.offset);
					} else {
						range.setStart(end.node, end.offset);
						range.setEnd(end.node, end.offset);
					}
					var rect = range.getClientRects()[0];
					var cursorParent = view._cursorDiv.parentNode;
					var clientRect = cursorParent.getBoundingClientRect();
					if (rect && clientRect) {
						view._cursorDiv.style.top = (rect.top - clientRect.top + cursorParent.scrollTop) + "px"; //$NON-NLS-0$
						view._cursorDiv.style.left = (rect.left - clientRect.left + cursorParent.scrollLeft) + "px"; //$NON-NLS-0$
					}
				}
			} else if (document.selection) {
				if (!view._hasFocus) { return; }
				//IE < 9
				var body = document.body;

				/*
				* Bug in IE. For some reason when text is deselected the overflow
				* selection at the end of some lines does not get redrawn.  The
				* fix is to create a DOM element in the body to force a redraw.
				*/
				var child = util.createElement(document, "div"); //$NON-NLS-0$
				body.appendChild(child);
				body.removeChild(child);
				
				range = body.createTextRange();
				range.moveToElementText(start.node.parentNode);
				range.moveStart("character", start.offset); //$NON-NLS-0$
				var endRange = body.createTextRange();
				endRange.moveToElementText(end.node.parentNode);
				endRange.moveStart("character", end.offset); //$NON-NLS-0$
				range.setEndPoint("EndToStart", endRange); //$NON-NLS-0$
				view._ignoreSelect = false;
				range.select();
				view._ignoreSelect = true;
			}
		},
		/** @private */
		_setDOMFullSelection: function(startNode, startOffset, endNode, endOffset) {
			this._divs.forEach(function(div) {
				div.style.width = div.style.height = "0px"; //$NON-NLS-0$
			});
			var view = this._view;
			if (!view._fullSelection) { return; }
			if (util.isIOS) { return; }
			if (startNode === endNode && startOffset === endOffset && this.primary) { return; }
			var viewPad = view._getViewPadding();
			var clientRect = view._clientDiv.getBoundingClientRect();
			var viewRect = view._viewDiv.getBoundingClientRect();
			var left = viewRect.left + viewPad.left;
			var right = clientRect.right;
			var top = viewRect.top + viewPad.top;
			var bottom = clientRect.bottom;
			var hd = 0, vd = 0;
			if (view._clipDiv) {
				var clipRect = view._clipDiv.getBoundingClientRect();
				hd = clipRect.left - view._clipDiv.scrollLeft;
				vd = clipRect.top;
			} else {
				var rootpRect = view._rootDiv.getBoundingClientRect();
				hd = rootpRect.left;
				vd = rootpRect.top;
			}
			view._ignoreDOMSelection = true;
			var startLine = new TextLine(view, startNode.lineIndex, startNode);
			var startRect = startLine.getBoundingClientRect(startOffset, false);
			var l = startRect.left, endLine, endRect;
			if (startNode === endNode && startOffset === endOffset) {
				endLine = startLine;
				endRect = startRect;
			} else {
				endLine = new TextLine(view, endNode.lineIndex, endNode);
				endRect = endLine.getBoundingClientRect(endOffset, false);
			}
			var r = endRect.left;
			view._ignoreDOMSelection = false;
			var sel1Div = this._divs[0];
			var sel1Left = Math.min(right, Math.max(left, l));
			var sel1Top = Math.min(bottom, Math.max(top, startRect.top));
			var sel1Right = right;
			var sel1Bottom = Math.min(bottom, Math.max(top, startRect.bottom));
			sel1Div.style.left = (sel1Left - hd) + "px"; //$NON-NLS-0$
			sel1Div.style.top = (sel1Top - vd) + "px"; //$NON-NLS-0$
			sel1Div.style.width = Math.max(0, sel1Right - sel1Left) + "px"; //$NON-NLS-0$
			sel1Div.style.height = Math.max(0, sel1Bottom - sel1Top) + "px"; //$NON-NLS-0$
			if (startNode.lineIndex === endNode.lineIndex) {
				sel1Right = Math.min(r, right);
				sel1Div.style.width = Math.max(this.primary ? 0 : 1, sel1Right - sel1Left) + "px"; //$NON-NLS-0$
			} else {
				var sel3Left = left;
				var sel3Top = Math.min(bottom, Math.max(top, endRect.top));
				var sel3Right = Math.min(right, Math.max(left, r));
				var sel3Bottom = Math.min(bottom, Math.max(top, endRect.bottom));
				var sel3Div = this._divs[2];
				sel3Div.style.left = (sel3Left - hd) + "px"; //$NON-NLS-0$
				sel3Div.style.top = (sel3Top - vd) + "px"; //$NON-NLS-0$
				sel3Div.style.width = Math.max(0, sel3Right - sel3Left) + "px"; //$NON-NLS-0$
				sel3Div.style.height = Math.max(0, sel3Bottom - sel3Top) + "px"; //$NON-NLS-0$
				if (Math.abs(startNode.lineIndex - endNode.lineIndex) > 1) {
					var sel2Div = this._divs[1];
					sel2Div.style.left = (left - hd)  + "px"; //$NON-NLS-0$
					sel2Div.style.top = (sel1Bottom - vd) + "px"; //$NON-NLS-0$
					sel2Div.style.width = Math.max(0, right - left) + "px"; //$NON-NLS-0$
					sel2Div.style.height = Math.max(0, sel3Top - sel1Bottom) + "px"; //$NON-NLS-0$
				}
			}
		}
	};
	/** @private */
	function TextRect (rect) {
		this.left = rect.left;
		this.top = rect.top;
		this.right = rect.right;
		this.bottom = rect.bottom;
	}
	TextRect.prototype = /** @lends orion.editor.TextRect.prototype */ {
		/** @private */
		toString: function() {
			return "{l=" + this.left + ", t=" + this.top + ", r=" + this.right + ", b=" + this.bottom + "}"; //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		}
	};
	/** 
	 * Constructs a new TextLine object.
	 * 
	 * @class A TextLine represents a line of text in the view.
	 * @name orion.editor.TextLine
	 * @private
	 */
	function TextLine (view, lineIndex, lineDiv) {
		/**
		 * The view.
		 *
		 * @name orion.editor.TextLine#view
		 * @private
		 */
		this.view = view;
		/**
		 * The line index.
		 *
		 * @name orion.editor.TextLine#lineIndex
		 * @private
		 */
		this.lineIndex = lineIndex;
		
		this._lineDiv = lineDiv;
	}
	TextLine.prototype = /** @lends orion.editor.TextLine.prototype */ {
		/** @private */
		create: function(parent, div) {
			if (this._lineDiv) { return; }
			var child = this._lineDiv = this._createLine(parent, div, this.lineIndex);
			child._line = this;
			return child;
		},
		_createLine: function(parent, div, lineIndex) {
			var view = this.view;
			var model = view._model;
			var lineText = model.getLine(lineIndex);
			var lineStart = model.getLineStart(lineIndex);
			var e = {type:"LineStyle", textView: view, lineIndex: lineIndex, lineText: lineText, lineStart: lineStart}; //$NON-NLS-0$
			view.onLineStyle(e);
			var document = parent.ownerDocument;
			var lineDiv = div || util.createElement(document, "div"); //$NON-NLS-0$
			if (!div || !compare(div.viewStyle, e.style)) {
				applyStyle(e.style, lineDiv, div);
				if (div) { div._trim = null; }
				lineDiv.viewStyle = e.style;
				lineDiv.setAttribute("role", "presentation"); //$NON-NLS-1$ //$NON-NLS-0$
			}
			lineDiv.lineIndex = lineIndex;
			
			if (div && lineDiv.viewLineText === lineText && compare(e.ranges, lineDiv.viewRanges)) {
				return lineDiv;
			}
			lineDiv.viewRanges = e.ranges;
			lineDiv.viewLineText = lineText;
			
			var ranges = [];
			var data = {tabOffset: 0, ranges: ranges};
			this._createRanges(e.ranges, lineText, 0, lineText.length, lineStart, data);
			
			/*
			* A trailing span with a whitespace is added for three different reasons:
			* 1. Make sure the height of each line is the largest of the default font
			* in normal, italic, bold, and italic-bold.
			* 2. When full selection is off, Firefox, Opera and IE9 do not extend the 
			* selection at the end of the line when the line is fully selected. 
			* 3. The height of a div with only an empty span is zero.
			*/
			var c = " "; //$NON-NLS-0$
			if (!view._fullSelection && util.isIE < 9) {
				/* 
				* IE8 already selects extra space at end of a line fully selected,
				* adding another space at the end of the line causes the selection 
				* to look too big. The fix is to use a zero-width space (\uFEFF) instead. 
				*/
				c = "\uFEFF"; //$NON-NLS-0$
			}
			var range = {text: c, style: view._metrics.largestFontStyle, ignoreChars: 1};
			if (ranges.length === 0 || !ranges[ranges.length - 1].style || ranges[ranges.length - 1].style.tagName !== "div") { //$NON-NLS-0$
				ranges.push(range);
			} else {
				ranges.splice(ranges.length - 1, 0, range);
			}
		
			var span, style, oldSpan, oldStyle, text, oldText, end = 0, oldEnd = 0, next, i;
			if (util.isFirefox && lineText.length > 2000) {
				if (div) {
					lineDiv.innerHTML = "";
					div.lineWidth = undefined;
				}
				var frag = document.createDocumentFragment();
				for (i = 0; i < ranges.length; i++) {
					range = ranges[i];
					text = range.text;
					style = range.style;
					span = this._createSpan(lineDiv, text, style, range.ignoreChars);
					frag.appendChild(span);
				}
				lineDiv.appendChild(frag);
			} else {
				var changeCount, changeStart;
				if (div) {
					var modelChangedEvent = div.modelChangedEvent;
					if (modelChangedEvent) {
						if (modelChangedEvent.removedLineCount === 0 && modelChangedEvent.addedLineCount === 0) {
							changeStart = modelChangedEvent.start - lineStart;
							changeCount = modelChangedEvent.addedCharCount - modelChangedEvent.removedCharCount;
						} else {
							changeStart = -1;
						}
						div.modelChangedEvent = undefined;
					}
					oldSpan = div.firstChild;
				}
				for (i = 0; i < ranges.length; i++) {
					range = ranges[i];
					text = range.text;
					end += text.length;
					style = range.style;
					if (oldSpan) {
						oldText = oldSpan.firstChild.data;
						oldStyle = oldSpan.viewStyle;
						if (oldText === text && compare(style, oldStyle)) {
							oldEnd += oldText.length;
							oldSpan._rectsCache = undefined;
							span = oldSpan = oldSpan.nextSibling;
							continue;
						} else {
							while (oldSpan) {
								if (changeStart !== -1) {
									var spanEnd = end;
									if (spanEnd >= changeStart) {
										spanEnd -= changeCount;
									}
									var t = oldSpan.firstChild.data;
									var length = t ? t.length : 0;
									if (oldEnd + length > spanEnd) { break; }
									oldEnd += length;
								}
								next = oldSpan.nextSibling;
								lineDiv.removeChild(oldSpan);
								oldSpan = next;
							}
						}
					}
					span = this._createSpan(lineDiv, text, style, range.ignoreChars);
					if (oldSpan) {
						lineDiv.insertBefore(span, oldSpan);
					} else {
						lineDiv.appendChild(span);
					}
					if (div) {
						div.lineWidth = undefined;
					}
				}
				if (div) {
					var tmp = span ? span.nextSibling : null;
					while (tmp) {
						next = tmp.nextSibling;
						div.removeChild(tmp);
						tmp = next;
					}
				}
			}
			if (!lineDiv.parentNode) {
				parent.appendChild(lineDiv);
			}
			return lineDiv;
		},
		_createRanges: function(ranges, text, start, end, lineStart, data) {
			if (start > end) { return; }
			if (ranges) {
				for (var i = 0; i < ranges.length; i++) {
					var range = ranges[i];
					if (range.end < lineStart + start) { continue; }
					var styleStart = Math.max(lineStart + start, range.start) - lineStart;
					if (styleStart > end) { break; }
					var styleEnd = Math.min(lineStart + end, range.end) - lineStart;
					if (styleStart <= styleEnd) {
						styleStart = Math.max(start, styleStart);
						styleEnd = Math.min(end, styleEnd);
						if (start < styleStart) {
							this._createRange(text, start, styleStart, null, data);
						}
						if (!range.style || !range.style.unmergeable) {
							while (i + 1 < ranges.length && ranges[i + 1].start - lineStart === styleEnd && compare(range.style, ranges[i + 1].style)) {
								range = ranges[i + 1];
								styleEnd = Math.min(lineStart + end, range.end) - lineStart;
								i++;
							}
						}
						this._createRange(text, styleStart, styleEnd, range.style, data);
						start = styleEnd;
					}
				}
			}
			if (start < end) {
				this._createRange(text, start, end, null, data);
			}
		},
		_createRange: function(text, start, end, style, data) {
			if (start > end) { return; }
			var tabSize = this.view._customTabSize, range;
			if (tabSize && tabSize !== 8) {
				var tabIndex = text.indexOf("\t", start); //$NON-NLS-0$
				while (tabIndex !== -1 && tabIndex < end) {
					if (start < tabIndex) {
						range = {text: text.substring(start, tabIndex), style: style};
						data.ranges.push(range);
						data.tabOffset += range.text.length;
					}
					var spacesCount = tabSize - (data.tabOffset % tabSize);
					if (spacesCount > 0) {
						//TODO hack to preserve tabs in getDOMText()
						var spaces = "\u00A0"; //$NON-NLS-0$
						for (var i = 1; i < spacesCount; i++) {
							spaces += " "; //$NON-NLS-0$
						}
						range = {text: spaces, style: style, ignoreChars: spacesCount - 1};
						data.ranges.push(range);
						data.tabOffset += range.text.length;
					}
					start = tabIndex + 1;
					if (start === end) {
						return;
					}
					tabIndex = text.indexOf("\t", start); //$NON-NLS-0$
				}
			}
			if (start <= end) {
				range = {text: text.substring(start, end), style: style};
				data.ranges.push(range);
				data.tabOffset += range.text.length;
			}
		},
		_createSpan: function(parent, text, style, ignoreChars) {
			var view = this.view;
			var tagName = "span"; //$NON-NLS-0$
			if (style && style.tagName) {
				tagName = style.tagName.toLowerCase();
			}
			var isLink = tagName === "a"; //$NON-NLS-0$
			if (isLink) { this.hasLink = true; }
			if (isLink && !view._linksVisible) {
				tagName = "span"; //$NON-NLS-0$
			}
			var document = parent.ownerDocument;
			var child = util.createElement(parent.ownerDocument, tagName);
			child.appendChild(document.createTextNode(style && style.text ? style.text : text));
			if (style && style.html) {
				child.innerHTML = style.html;
				child.ignore = true;
			} else if (style && style.node) {
				child.appendChild(style.node);
				child.ignore = true;
			}
			applyStyle(style, child);
			if (tagName === "a") { //$NON-NLS-0$
				var window = view._getWindow();
				addHandler(child, "click", function(e) { return view._handleLinkClick(e ? e : window.event); }, false); //$NON-NLS-0$
			}
			child.viewStyle = style;
			if (ignoreChars) {
				child.ignoreChars = ignoreChars;
			}
			return child;
		},
		_ensureCreated: function() {
			if (this._lineDiv) { return this._lineDiv; }
			return (this._createdDiv = this.create(this.view._clientDiv, null));
		},
		/** @private */
		getBoundingClientRect: function(offset, absolute) {
			var child = this._ensureCreated();
			var view = this.view;
			if (offset === undefined) {
				return this._getLineBoundingClientRect(child, true);
			}
			var model = view._model;
			var document = child.ownerDocument;
			var lineIndex = this.lineIndex;
			var result = null;
			if (offset < model.getLineEnd(lineIndex)) {
				var lineOffset = model.getLineStart(lineIndex);
				this.forEach(function(lineChild) {
					var textNode = lineChild.firstChild;
					var nodeLength = this._nodeLength(lineChild); 
					if (lineOffset + nodeLength > offset) {
						var index = offset - lineOffset;
						var range;
						if (textNode.length === 1) {
							result = new TextRect(lineChild.getBoundingClientRect());
						} else if (view._isRangeRects) {
							range = document.createRange();
							range.setStart(textNode, index);
							range.setEnd(textNode, index + 1);
							result = new TextRect(range.getBoundingClientRect());
						} else if (util.isIE) {
							range = document.body.createTextRange();
							range.moveToElementText(lineChild);
							range.collapse();
							/*
							* Bug in IE8. TextRange.getClientRects() and TextRange.getBoundingClientRect() fails
							* if the line child is not the first element in the line and if the start offset is 0. 
							* The fix is to use Node.getClientRects() left edge instead.
							*/
							var fixIE8 = index === 0 && util.isIE === 8;
							if (fixIE8) { index = 1; }
							range.moveEnd("character", index + 1); //$NON-NLS-0$
							range.moveStart("character", index); //$NON-NLS-0$
							result = new TextRect(range.getBoundingClientRect());
							if (fixIE8) {
								result.left = lineChild.getClientRects()[0].left;
							}
						} else {
							var text = textNode.data;
							lineChild.removeChild(textNode);
							lineChild.appendChild(document.createTextNode(text.substring(0, index)));
							var span = util.createElement(document, "span"); //$NON-NLS-0$
							span.appendChild(document.createTextNode(text.substring(index, index + 1)));
							lineChild.appendChild(span);
							lineChild.appendChild(document.createTextNode(text.substring(index + 1)));
							result = new TextRect(span.getBoundingClientRect());
							lineChild.innerHTML = "";
							lineChild.appendChild(textNode);
							if (!this._createdDiv) {
								/*
								 * Removing the element node that holds the selection start or end
								 * causes the selection to be lost. The fix is to detect this case
								 * and restore the selection. 
								 */
								var s = view._getSelections()[0];
								if ((lineOffset <= s.start && s.start < lineOffset + nodeLength) ||  (lineOffset <= s.end && s.end < lineOffset + nodeLength)) {
									view._updateDOMSelection();
								}
							}
						}
						if (util.isIE) {
							var window = getWindow(child.ownerDocument);
							var xFactor = window.screen.logicalXDPI / window.screen.deviceXDPI;
							var yFactor = window.screen.logicalYDPI / window.screen.deviceYDPI;
							result.left = result.left * xFactor;
							result.right = result.right * xFactor;
							result.top = result.top * yFactor;
							result.bottom = result.bottom * yFactor;
						}
						return false;
					}
					lineOffset += nodeLength;
					return true;
				});
			}
			var rect = this.getBoundingClientRect();
			if (!result) {
				if (view._wrapMode) {
					var rects = this.getClientRects();
					result = rects[rects.length - 1];
					result.left = result.right;
					result.left += rect.left;
					result.top += rect.top;
					result.right += rect.left;
					result.bottom += rect.top;
				} else {
					result = new TextRect(rect);
					result.left = result.right;
				}
			}
			if (absolute || absolute === undefined) {
				result.left -= rect.left;
				result.top -= rect.top;
				result.right -= rect.left;
				result.bottom -= rect.top;
			}
			return result;
		},
		forEach: function(callback) {
			var child = this._ensureCreated();
			var lineChild = child.firstChild;
			while (lineChild) {
				var next = lineChild.nextSibling;
				if (!lineChild.ignore) {
					if (!callback.call(this, lineChild)) {
						break;
					}
				}
				lineChild = next;
			}
		},
		/** @private */
		_getClientRects: function(element, parentRect) {
			var rects, newRects, rect, i;
			if (!element._rectsCache) {
				rects = element.getClientRects();
				newRects = newArray(rects.length);
				for (i = 0; i<rects.length; i++) {
					rect = newRects[i] = new TextRect(rects[i]);
					rect.left -= parentRect.left;
					rect.top -= parentRect.top;
					rect.right -= parentRect.left;
					rect.bottom -= parentRect.top;
				}
				element._rectsCache = newRects;
			}
			rects = element._rectsCache;
			newRects = [rects.length];
			for (i = 0; i<rects.length; i++) {
				newRects[i] = new TextRect(rects[i]);
			}
			return newRects;
		},
		getClientRects: function(lineIndex) {
			if (!this.view._wrapMode) { return [this.getBoundingClientRect()]; }
			var child = this._ensureCreated();
			//TODO [perf] cache rects
			var result = [];
			var parentRect = child.getBoundingClientRect();
			this.forEach(function(lineChild) {
				var rects = this._getClientRects(lineChild, parentRect);
				for (var i = 0; i < rects.length; i++) {
					var rect = rects[i], j, r;
					if (rect.top === rect.bottom) { continue; }
					var center = rect.top + (rect.bottom - rect.top) / 2;
					for (j = 0; j < result.length; j++) {
						r = result[j];
						if ((r.top <= center && center < r.bottom)) {
							break;
						}
					}
					if (j === result.length) {
						result.push(rect);
					} else {
						if (rect.left < r.left) { r.left = rect.left; }
						if (rect.top < r.top) { r.top = rect.top; }
						if (rect.right > r.right) { r.right = rect.right; }
						if (rect.bottom > r.bottom) { r.bottom = rect.bottom; }
					}
				}
				return true;
			});
			if (lineIndex !== undefined) {
				return result[lineIndex];
			}
			return result;
		},
		/** @private */
		_getLineBoundingClientRect: function (child, noTrim) {
			var rect = new TextRect(child.getBoundingClientRect());
			if (this.view._wrapMode) {
			} else {
				rect.right = rect.left;
				var lastChild = child.lastChild;
				//Remove any artificial trailing whitespace in the line
				while (lastChild && lastChild.ignoreChars === lastChild.firstChild.length) {
					lastChild = lastChild.previousSibling;
				}
				if (lastChild) {
					var lastRect = lastChild.getBoundingClientRect();
					rect.right = lastRect.right + getLineTrim(child).right;
				}
			}
			if (noTrim) {
				var padding = getLineTrim(child);
				rect.left = rect.left + padding.left;
				rect.right = rect.right - padding.right;
			}
			return rect;
		},
		/** @private */
		getLineCount: function () {
			if (!this.view._wrapMode) { return 1; }
			return this.getClientRects().length;
		},
		/** @private */
		getLineIndex: function(offset) {
			if (!this.view._wrapMode) { return 0; }
			var rects = this.getClientRects();
			var rect = this.getBoundingClientRect(offset);
			var center = rect.top + ((rect.bottom - rect.top) / 2);
			for (var i = 0; i < rects.length; i++) {
				if (rects[i].top <= center && center < rects[i].bottom) {
					return i;
				}
			}
			return rects.length - 1;
		},
		/** @private */
		getLineStart: function (lineIndex) {
			if (!this.view._wrapMode || lineIndex === 0) {
				return this.view._model.getLineStart(this.lineIndex);
			}
			var rects = this.getClientRects();
			return this.getOffset(rects[lineIndex].left + 1, rects[lineIndex].top + 1);
		},
		_nodeLength: function(lineChild) {
			if (!lineChild || lineChild.ignore) return 0;
			var length = lineChild.firstChild.length; 
			if (lineChild.ignoreChars) {
				length -= lineChild.ignoreChars;
			}
			return length;
		},
		getModelOffset: function(node, offset) {
			if (!node) { return 0; }
			var lineOffset = 0;
			this.forEach(function(lineChild) {
				var textNode = lineChild.firstChild;
				if (textNode === node) {
					if (lineChild.ignoreChars) { lineOffset -= lineChild.ignoreChars; }
					lineOffset += offset;
					return false;
				}
				if (lineChild.ignoreChars) { lineOffset -= lineChild.ignoreChars; }
				lineOffset += textNode.data.length;
				return true;
			});
			return Math.max(0, lineOffset) + this.view._model.getLineStart(this.lineIndex);
		},
		getNodeOffset: function(modelOffset) {
			var offset = 0;
			var lineNode, lineNodeOffset;
			var model = this.view._model;
			var lineStart = model.getLineStart(this.lineIndex);
			var lineOffset = modelOffset - lineStart;
			var end = model.getLineEnd(this.lineIndex) - lineStart;
			this.forEach(function(lineChild) {
				var node = lineChild.firstChild;
				var nodeLength = this._nodeLength(lineChild);
				if (nodeLength + offset > lineOffset || offset + nodeLength >= end) {
					lineNode = node;
					lineNodeOffset = lineOffset - offset;
					if (lineChild.ignoreChars && nodeLength > 0 && lineNodeOffset === nodeLength) {
						lineNodeOffset += lineChild.ignoreChars; 
					}
					return false;
				}
				offset += nodeLength;
				return true;
			});
			return {node: lineNode, offset: lineNodeOffset};
		},
		getText: function(offsetNode) {
			var text = "", offset = 0;
			this.forEach(function(lineChild) {
				var textNode;
				if (lineChild.ignoreChars) {
					textNode = lineChild.lastChild;
					var ignored = 0, childText = [], childOffset = -1;
					while (textNode) {
						var data = textNode.data;
						if (data) {
							for (var i = data.length - 1; i >= 0; i--) {
								var ch = data.substring(i, i + 1);
								if (ignored < lineChild.ignoreChars && (ch === " " || ch === "\uFEFF")) { //$NON-NLS-1$ //$NON-NLS-0$
									ignored++;
								} else {
									childText.push(ch === "\u00A0" ? "\t" : ch); //$NON-NLS-1$ //$NON-NLS-0$
								}
							}
						}
						if (offsetNode === textNode) {
							childOffset = childText.length;
						}
						textNode = textNode.previousSibling;
					}
					childText = childText.reverse().join("");
					if (childOffset !== -1) {
						offset = text.length + childText.length - childOffset;
					}
					text += childText;
				} else {
					textNode = lineChild.firstChild;
					while (textNode) {
						if (offsetNode === textNode) {
							offset = text.length;
						}
						text += textNode.data;
						textNode = textNode.nextSibling;
					}
				}
				return true;
			});
			return {text: text, offset: offset};
		},
		/** @private */
		getOffset: function(x, y) {
			var view = this.view;
			var model = view._model;
			var lineIndex = this.lineIndex;
			var lineStart = model.getLineStart(lineIndex);
			var lineEnd = model.getLineEnd(lineIndex);
			if (lineStart === lineEnd) {
				return lineStart;
			}
			var child = this._ensureCreated();
			var lineRect = this.getBoundingClientRect();
			
			var self = this;
			function hitChild(lineChild, offset, rect) {
				var textNode = lineChild.firstChild;
				var nodeLength = self._nodeLength(lineChild);
				var document = child.ownerDocument;
				var window = getWindow(document);
				var xFactor = util.isIE ? window.screen.logicalXDPI / window.screen.deviceXDPI : 1;
				var yFactor = util.isIE ? window.screen.logicalYDPI / window.screen.deviceYDPI : 1;
				var rangeLeft, rangeTop, rangeRight, rangeBottom;
				var range, start, end;
				var rl = rect.left + lineRect.left, fixIE8, rects1;
				if (util.isIE || view._isRangeRects) {
					range = view._isRangeRects ? document.createRange() : document.body.createTextRange();
					var high = nodeLength;
					var low = -1;
					while ((high - low) > 1) {
						var mid = Math.floor((high + low) / 2);
						start = low + 1;
						end = mid === nodeLength - 1 && lineChild.ignoreChars ? textNode.length : mid + 1;
						/*
						* Bug in IE8. TextRange.getClientRects() and TextRange.getBoundingClientRect() fails
						* if the line child is not the first element in the line and if the start offset is 0. 
						* The fix is to use Node.getClientRects() left edge instead.
						*/
						fixIE8 = start === 0 && util.isIE === 8;
						if (view._isRangeRects) {
							range.setStart(textNode, start);
							range.setEnd(textNode, end);
						} else {
							if (fixIE8) { start = 1; } 
							range.moveToElementText(lineChild);
							range.move("character", start); //$NON-NLS-0$
							range.moveEnd("character", end - start); //$NON-NLS-0$
						}
						rects1 = range.getClientRects();
						var found = false;
						for (var k = 0; k < rects1.length; k++) {
							rect = rects1[k];
							rangeLeft = (fixIE8 ? rl : rect.left) * xFactor - lineRect.left;
							rangeRight = rect.right * xFactor - lineRect.left;
							rangeTop = rect.top * yFactor - lineRect.top;
							rangeBottom = rect.bottom * yFactor - lineRect.top;
							if (rangeLeft <= x && x < rangeRight && (!view._wrapMode || (rangeTop <= y && y <= rangeBottom))) {
								found = true;
								break;
							}
						}
						if (found) {
							high = mid;
						} else {
							low = mid;
						}
					}
					offset += high;
					start = high;
					end = high === nodeLength - 1 && lineChild.ignoreChars ? textNode.length : Math.min(high + 1, textNode.length);
					if (view._isRangeRects) {
						range.setStart(textNode, start);
						range.setEnd(textNode, end);
					} else {
						range.moveToElementText(lineChild);
						range.move("character", start); //$NON-NLS-0$
						range.moveEnd("character", end - start); //$NON-NLS-0$
					}
					rects1 = range.getClientRects();
					var trailing = false;
					if (rects1.length > 0) {
						rect = rects1[0];
						rangeLeft = (fixIE8 ? rl : rect.left) * xFactor - lineRect.left;
						rangeRight = rect.right * xFactor - lineRect.left;
						//TODO test for character trailing (wrong for bidi)
						trailing = x > (rangeLeft + (rangeRight - rangeLeft) / 2);
					}
					// Handle Unicode surrogates
					var offsetInLine = offset - lineStart;
					var lineText = model.getLine(lineIndex);
					var c = lineText.charCodeAt(offsetInLine);
					if (0xD800 <= c && c <= 0xDBFF && trailing) {
						if (offsetInLine < lineText.length) {
							c = lineText.charCodeAt(offsetInLine + 1);
							if (0xDC00 <= c && c <= 0xDFFF) {
								offset += 1;
							}
						}
					} else if (0xDC00 <= c && c <= 0xDFFF && !trailing) {
						if (offsetInLine > 0) {
							c = lineText.charCodeAt(offsetInLine - 1);
							if (0xD800 <= c && c <= 0xDBFF) {
								offset -= 1;
							}
						}
					}
					if (trailing) {
						offset++;
					}
				} else {
					var newText = [];
					for (var q = 0; q < nodeLength; q++) {
						newText.push("<span>"); //$NON-NLS-0$
						if (q === nodeLength - 1) {
							newText.push(textNode.data.substring(q));
						} else {
							newText.push(textNode.data.substring(q, q + 1));
						}
						newText.push("</span>"); //$NON-NLS-0$
					}
					lineChild.innerHTML = newText.join("");
					var rangeChild = lineChild.firstChild;
					while (rangeChild) {
						rect = rangeChild.getBoundingClientRect();
						rangeLeft = rect.left - lineRect.left;
						rangeRight = rect.right - lineRect.left;
						if (rangeLeft <= x && x < rangeRight) {
							//TODO test for character trailing (wrong for bidi)
							if (x > rangeLeft + (rangeRight - rangeLeft) / 2) {
								offset++;
							}
							break;
						}
						offset++;
						rangeChild = rangeChild.nextSibling;
					}
					if (!self._createdDiv) {
						lineChild.innerHTML = "";
						lineChild.appendChild(textNode);
						/*
						 * Removing the element node that holds the selection start or end
						 * causes the selection to be lost. The fix is to detect this case
						 * and restore the selection. 
						 */
						var s = view._getSelections()[0];
						if ((offset <= s.start && s.start < offset + nodeLength) || (offset <= s.end && s.end < offset + nodeLength)) {
							view._updateDOMSelection();
						}
					}
				}
				return offset;
			}
			
			var rects, rect;
			if (view._wrapMode) {
				rects = this.getClientRects();
				if (y < rects[0].top) {
					y = rects[0].top;
				}
				for (var i = 0; i < rects.length; i++) {
					rect = rects[i];
					if (rect.top <= y && y < rect.bottom) {
						break;
					}
				}
				if (x < rect.left) { x = rect.left; }
				if (x > rect.right) { x = rect.right - 1; }
			} else {
				if (x < 0) { x = 0; }
				if (x > (lineRect.right - lineRect.left)) { x = lineRect.right - lineRect.left; }
			}
			
			function hitRects(child) {
				if (child.ignore) return null;
				var rects1 = self._getClientRects(child, lineRect);
				for (var j = 0; j < rects1.length; j++) {
					var rect1 = rects1[j];
					if (rect1.left <= x && x < rect1.right && (!view._wrapMode || (rect1.top <= y && y <= rect1.bottom))) {
						return rect1;
					}
				}
				return null;
			}
			
			var offset, lineChild;
			if (this._lastHitChild && this._lastHitChild.parentNode) {
				// Search last hit child first, then search around the last hit child
				offset = this._lastHitOffset;
				lineChild = this._lastHitChild;
				rect = hitRects(lineChild);
				if (!rect ) {
					var previousOffset = offset, nextOffset = offset + this._nodeLength(lineChild);
					var previousChild = lineChild.previousSibling, nextChild = lineChild.nextSibling;
					while (previousChild || nextChild) {
						if (previousChild) {
							previousOffset -= this._nodeLength(previousChild);
							if (rect = hitRects(previousChild)) {
								lineChild = previousChild;
								offset = previousOffset;
								break;
							}
							previousChild = previousChild.previousSibling;
						}
						if (nextChild) {
							if (rect = hitRects(nextChild)) {
								lineChild = nextChild;
								offset = nextOffset;
								break;
							}
							nextOffset += this._nodeLength(nextChild);
							nextChild = nextChild.nextSibling;
						}
					}
				}
			} else {
				// Start searching from the beginning of the line
				offset = lineStart;
				this.forEach(function(c) {
					lineChild = c;
					if (rect = hitRects(lineChild)) {
						return false;
					}
					offset += this._nodeLength(lineChild);
					return true;
				});
			}
			
			if (lineChild && rect) {
				// Cache the last hit child
				this._lastHitChild = lineChild;
				this._lastHitOffset = offset;

				offset = hitChild(lineChild, offset, rect);
			}

			return Math.min(lineEnd, Math.max(lineStart, offset));
		},
		/** @private */
		getNextOffset: function (offset, data) {
			if (data.unit === "line") { //$NON-NLS-0$
				var view = this.view;
				var model = view._model;
				var lineIndex = model.getLineAtOffset(offset);
				if (data.count > 0) {
					data.count--;
					return model.getLineEnd(lineIndex);
				}
				data.count++;
				return model.getLineStart(lineIndex);
			}
			if (data.unit === "wordend" || data.unit === "wordWS" || data.unit === "wordendWS") { //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				return this._getNextOffset_W3C(offset, data);
			}
			return util.isIE ? this._getNextOffset_IE(offset, data) : this._getNextOffset_W3C(offset, data);
		},
		/** @private */
		_getNextOffset_W3C: function (offset, data) {
			function _isPunctuation(c) {
				return (33 <= c && c <= 47) || (58 <= c && c <= 64) || (91 <= c && c <= 94) || c === 96 || (123 <= c && c <= 126);
			}
			function _isWhitespace(c) {
				return c === 32 || c === 9;
			}
			var view = this.view;
			var model = view._model;
			var lineIndex = model.getLineAtOffset(offset);
			var lineText = model.getLine(lineIndex);
			var lineStart = model.getLineStart(lineIndex);
			var lineEnd = model.getLineEnd(lineIndex);
			var lineLength = lineText.length;
			var offsetInLine = offset - lineStart;
			var c;
			var step = data.count < 0 ? -1 : 1;
			if (data.unit === "word" || data.unit === "wordend" || data.unit === "wordWS" || data.unit === "wordendWS") { //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				var previousPunctuation, previousLetterOrDigit, punctuation, letterOrDigit;
				while (data.count !== 0) {
					if (data.count > 0) {
						if (offsetInLine === lineLength) { return lineEnd; }
						c = lineText.charCodeAt(offsetInLine);
						previousPunctuation = _isPunctuation(c); 
						previousLetterOrDigit = !previousPunctuation && !_isWhitespace(c);
						offsetInLine++;
						while (offsetInLine < lineLength) {
							c = lineText.charCodeAt(offsetInLine);
							if (data.unit !== "wordWS" && data.unit !== "wordendWS") { //$NON-NLS-1$ //$NON-NLS-0$
								punctuation = _isPunctuation(c);
								if (data.unit === "wordend") { //$NON-NLS-0$
									if (!punctuation && previousPunctuation) { break; }
								} else {
									if (punctuation && !previousPunctuation) { break; }
								}
								letterOrDigit  = !punctuation && !_isWhitespace(c);
							} else {
								letterOrDigit  = !_isWhitespace(c);
							}
							if (data.unit === "wordend" || data.unit === "wordendWS") { //$NON-NLS-1$ //$NON-NLS-0$
								if (!letterOrDigit && previousLetterOrDigit) { break; }
							} else {
								if (letterOrDigit && !previousLetterOrDigit) { break; }
							}
							previousLetterOrDigit = letterOrDigit;
							previousPunctuation = punctuation;
							offsetInLine++;
						}
					} else {
						if (offsetInLine === 0) { return lineStart; }
						offsetInLine--;
						c = lineText.charCodeAt(offsetInLine);
						previousPunctuation = _isPunctuation(c); 
						previousLetterOrDigit = !previousPunctuation && !_isWhitespace(c);
						while (0 < offsetInLine) {
							c = lineText.charCodeAt(offsetInLine - 1);
							if (data.unit !== "wordWS" && data.unit !== "wordendWS") { //$NON-NLS-1$ //$NON-NLS-0$ 
								punctuation = _isPunctuation(c);
								if (data.unit === "wordend") { //$NON-NLS-0$
									if (punctuation && !previousPunctuation) { break; }
								} else {
									if (!punctuation && previousPunctuation) { break; }
								}
								letterOrDigit  = !punctuation && !_isWhitespace(c);
							} else {
								letterOrDigit  = !_isWhitespace(c);
							}
							if (data.unit === "wordend" || data.unit === "wordendWS") { //$NON-NLS-1$ //$NON-NLS-0$
								if (letterOrDigit && !previousLetterOrDigit) { break; }
							} else {
								if (!letterOrDigit && previousLetterOrDigit) { break; }
							}
							previousLetterOrDigit = letterOrDigit;
							previousPunctuation = punctuation;
							offsetInLine--;
						}
						if (offsetInLine === 0) {
							//get previous line
						}
					}
					data.count -= step;
				}
			} else {
				while (data.count !== 0 && (0 <= offsetInLine + step && offsetInLine + step <= lineLength)) {
					offsetInLine += step;
					c = lineText.charCodeAt(offsetInLine);
					// Handle Unicode surrogates
					if (0xDC00 <= c && c <= 0xDFFF) {
						if (offsetInLine > 0) {
							c = lineText.charCodeAt(offsetInLine - 1);
							if (0xD800 <= c && c <= 0xDBFF) {
								offsetInLine += step;
							}
						}
					}
					data.count -= step;
				}
			}
			return lineStart + offsetInLine;
		},
		/** @private */
		_getNextOffset_IE: function (offset, data) {
			var child = this._ensureCreated();
			var view = this.view;
			var model = view._model;
			var lineIndex = this.lineIndex;
			var result = 0, range, length;
			var lineOffset = model.getLineStart(lineIndex);
			var lineText = model.getLine(lineIndex);
			var lineStart = model.getLineStart(lineIndex);
			var document = child.ownerDocument;
			var lineChild;
			var step = data.count < 0 ? -1 : 1;
			if (offset === model.getLineEnd(lineIndex)) {
				lineChild = child.lastChild;
				while (lineChild && lineChild.ignoreChars === lineChild.firstChild.length) {
					lineChild = lineChild.previousSibling;
				}
				if (!lineChild) {
					return lineOffset;
				}
				range = document.body.createTextRange();
				range.moveToElementText(lineChild);
				length = range.text.length;
				range.moveEnd(data.unit, step);
				result = offset + range.text.length - length;
			} else if (offset === lineOffset && data.count < 0) {
				result = lineOffset;
			} else {
				lineChild = child.firstChild;
				while (lineChild) {
					var nodeLength = this._nodeLength(lineChild);
					if (lineOffset + nodeLength > offset) {
						range = document.body.createTextRange();
						if (offset === lineOffset && data.count < 0) {
							var temp = lineChild.previousSibling;
							// skip empty nodes
							while (temp) {
								if (temp.firstChild && temp.firstChild.length) {
									break;
								}
								temp = temp.previousSibling;
							}
							range.moveToElementText(temp ? temp : lineChild.previousSibling);
						} else {
							range.moveToElementText(lineChild);
							range.collapse();
							range.moveEnd("character", offset - lineOffset); //$NON-NLS-0$
						}
						length = range.text.length;
						range.moveEnd(data.unit, step);
						result = offset + range.text.length - length;
						break;
					}
					lineOffset = nodeLength + lineOffset;
					lineChild = lineChild.nextSibling;
				}
			}
			var offsetInLine = result - lineStart;
			var c = lineText.charCodeAt(offsetInLine);
			// Handle Unicode surrogates
			if (0xDC00 <= c && c <= 0xDFFF) {
				if (offsetInLine > 0) {
					c = lineText.charCodeAt(offsetInLine - 1);
					if (0xD800 <= c && c <= 0xDBFF) {
						offsetInLine += step;
					}
				}
			}
			result = offsetInLine + lineStart;
			data.count -= step;
			return result;
		},
		updateLinks: function() {
			var child = this._ensureCreated();
			if (!this.hasLink) { return; }
			var self = this;
			this.forEach(function(span) {
				var style = span.viewStyle;
				if (style && style.tagName && style.tagName.toLowerCase() === "a") { //$NON-NLS-0$
					child.replaceChild(self._createSpan(child, span.firstChild.data, style), span);
				}
				return true;
			});
		},
		/** @private */
		destroy: function() {
			var div = this._createdDiv;
			if (div) {
				div.parentNode.removeChild(div);
				this._createdDiv = null;
			}
		}
	};
	
	/**
	 * @class This object describes the options for the text view.
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.TextView}<br/>
	 * {@link orion.editor.TextView#setOptions}
	 * {@link orion.editor.TextView#getOptions}	 
	 * </p>		 
	 * @name orion.editor.TextViewOptions
	 *
	 * @property {String|DOMElement} parent the parent element for the view, it can be either a DOM element or an ID for a DOM element.
	 * @property {orion.editor.TextModel} [model] the text model for the view. If it is not set the view creates an empty {@link orion.editor.TextModel}.
	 * @property {Boolean} [readonly=false] whether or not the view is read-only.
	 * @property {Boolean} [fullSelection=true] whether or not the view is in full selection mode.
	 * @property {Boolean} [tabMode=true] whether or not the tab keypress is consumed by the view or is used for focus traversal.
	 * @property {Boolean} [expandTab=false] whether or not the tab key inserts white spaces.
	 * @property {orion.editor.TextTheme} [theme=orion.editor.TextTheme.getTheme()] the TextTheme manager. TODO more info on this
	 * @property {orion.editor.UndoStack} [undoStack] the Undo Stack.
	 * @property {String} [themeClass] the CSS class for the view theming.
	 * @property {Number} [tabSize=8] The number of spaces in a tab.
	 * @property {Boolean} [overwriteMode=false] whether or not the view is in insert/overwrite mode.
	 * @property {Boolean} [singleMode=false] whether or not the editor is in single line mode.
	 * @property {Number} [marginOffset=0] the offset in a line where the print margin should be displayed. <code>0</code> means no print margin.
	 * @property {Number} [wrapOffset=0] the offset in a line where text should wrap. <code>0</code> means wrap at the client area right edge.
	 * @property {Boolean} [wrapMode=false] whether or not the view wraps lines.
	 * @property {Boolean} [wrapable=false] whether or not the view is wrappable.
	 * @property {Number} [scrollAnimation=0] the time duration in miliseconds for scrolling animation. <code>0</code> means no animation.
	 * @property {Boolean} [blockCursorVisible=false] whether or not to show the block cursor.
	 */
	/**
	 * Constructs a new text view.
	 * 
	 * @param {orion.editor.TextViewOptions} options the view options.
	 * 
	 * @class A TextView is a user interface for editing text.
	 * @name orion.editor.TextView
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function TextView (options) {
		this._init(options || {});
	}
	
	TextView.prototype = /** @lends orion.editor.TextView.prototype */ {
		/**
		 * Adds a keyMode to the text view at the specified position.
		 *
		 * @param {orion.editor.KeyMode} mode the editor keyMode.
		 * @param {Number} [index=length] the index.
		 */
		addKeyMode: function(mode, index) {
			var keyModes = this._keyModes;
			if (index !== undefined) {
				keyModes.splice(index, 0, mode);
			} else {
				keyModes.push(mode);
			}
			//TODO: API needed for this
			if (mode._modeAdded) {
				mode._modeAdded();
			}
		},
		/**
		 * Adds a ruler to the text view at the specified position.
		 * <p>
		 * The position is relative to the ruler location.
		 * </p>
		 *
		 * @param {orion.editor.Ruler} ruler the ruler.
		 * @param {Number} [index=length] the ruler index.
		 */
		addRuler: function (ruler, index) {
			var rulers = this._rulers;
			if (index !== undefined) {
				var i, sideIndex;
				for (i = 0, sideIndex=0; i < rulers.length && sideIndex < index; i++) {
					if (ruler.getLocation() === rulers[i].getLocation()) {
						sideIndex++;
					}
				}
				rulers.splice(sideIndex, 0, ruler);
				index = sideIndex;
			} else {
				rulers.push(ruler);
			}
			this._createRuler(ruler, index);
			ruler.setView(this);
			this._update();
		},
		computeSize: function() {
			var w = 0, h = 0;
			var model = this._model, clientDiv = this._clientDiv;
			if (!clientDiv) { return {width: w, height: h}; }
			var clientWidth = clientDiv.style.width;
			/*
			* Feature in WekKit. Webkit limits the width of the lines
			* computed below to the width of the client div.  This causes
			* the lines to be wrapped even though "pre" is set.  The fix
			* is to set the width of the client div to a "0x7fffffffpx"
			* before computing the lines width.  Note that this value is
			* reset to the appropriate value further down.
			*/
			if (util.isWebkit) {
				clientDiv.style.width = "0x7fffffffpx"; //$NON-NLS-0$
			}
			var lineCount = model.getLineCount();
			for (var lineIndex=0; lineIndex<lineCount; lineIndex++) {
				var line = this._getLine(lineIndex);
				var rect = line.getBoundingClientRect();
				w = Math.max(w, rect.right - rect.left);
				h += rect.bottom - rect.top;
				line.destroy();
			}
			if (util.isWebkit) {
				clientDiv.style.width = clientWidth;
			}
			var viewPadding = this._getViewPadding();
			w += viewPadding.right + viewPadding.left + this._metrics.scrollWidth;
			h += viewPadding.bottom + viewPadding.top + this._metrics.scrollWidth;
			return {width: w, height: h};
		},
		/**
		 * Converts the given rectangle from one coordinate spaces to another.
		 * <p>The supported coordinate spaces are:
		 * <ul>
		 *   <li>"document" - relative to document, the origin is the top-left corner of first line</li>
		 *   <li>"page" - relative to html page that contains the text view</li>
		 * </ul>
		 * </p>
		 * <p>All methods in the view that take or return a position are in the document coordinate space.</p>
		 *
		 * @param rect the rectangle to convert.
		 * @param rect.x the x of the rectangle.
		 * @param rect.y the y of the rectangle.
		 * @param rect.width the width of the rectangle.
		 * @param rect.height the height of the rectangle.
		 * @param {String} from the source coordinate space.
		 * @param {String} to the destination coordinate space.
		 *
		 * @see orion.editor.TextView#getLocationAtOffset
		 * @see orion.editor.TextView#getOffsetAtLocation
		 * @see orion.editor.TextView#getTopPixel
		 * @see orion.editor.TextView#setTopPixel
		 */
		convert: function(rect, from, to) {
			if (!this._clientDiv) { return rect; }
			var scroll = this._getScroll();
			var viewPad = this._getViewPadding();
			var viewRect = this._viewDiv.getBoundingClientRect();
			if (from === "document") { //$NON-NLS-0$
				if (rect.x !== undefined) {
					rect.x += - scroll.x + viewRect.left + viewPad.left;
				}
				if (rect.y !== undefined) {
					rect.y += - scroll.y + viewRect.top + viewPad.top;
				}
			}
			//At this point rect is in the widget coordinate space
			if (to === "document") { //$NON-NLS-0$
				if (rect.x !== undefined) {
					rect.x += scroll.x - viewRect.left - viewPad.left;
				}
				if (rect.y !== undefined) {
					rect.y += scroll.y - viewRect.top - viewPad.top;
				}
			}
			return rect;
		},
		/**
		 * Destroys the text view. 
		 * <p>
		 * Removes the view from the page and frees all resources created by the view.
		 * Calling this function causes the "Destroy" event to be fire so that all components
		 * attached to view can release their references.
		 * </p>
		 *
		 * @see orion.editor.TextView#onDestroy
		 */
		destroy: function() {
			/* Destroy rulers*/
			for (var i=0; i< this._rulers.length; i++) {
				this._rulers[i].setView(null);
			}
			this.rulers = null;
			
			this._destroyView();

			var e = {type: "Destroy"}; //$NON-NLS-0$
			this.onDestroy(e);

			this._parent = null;
			if (this._model && this._model.destroy) {
				this._model.destroy();
			}
			this._model = null;
			this._theme = null;
			this._selection = null;
			this._doubleClickSelection = null;
			this._keyModes = null;
			this._actions = null;
		},
		/**
		 * Gives focus to the text view.
		 */
		focus: function() {
			if (!this._clientDiv) { return; }
			/*
			* Feature in Chrome. When focus is called in the clientDiv without
			* setting selection the browser will set the selection to the first dom 
			* element, which can be above the client area. When this happen the 
			* browser also scrolls the window to show that element.
			* The fix is to call _updateDOMSelection() before calling focus().
			*/
			this._updateDOMSelection();
			this._clientDiv.focus();
			/*
			* Feature in Safari. When focus is called the browser selects the clientDiv
			* itself. The fix is to call _updateDOMSelection() after calling focus().
			*/
			this._updateDOMSelection();
		},
		/**
		 * Check if the text view has focus.
		 *
		 * @returns {Boolean} <code>true</code> if the text view has focus, otherwise <code>false</code>.
		 */
		hasFocus: function() {
			return this._hasFocus;
		},
		/**
		 * Returns the action description for a given action ID.
		 *
		 * @returns {orion.editor.ActionDescrition} the action description
		 */
		getActionDescription: function(actionID) {
			var action = this._actions[actionID];
			if (action) {
				return action.actionDescription;
			}
			return undefined;
		},
		/**
		 * Returns all action IDs defined in the text view.
		 * <p>
		 * There are two types of actions, the predefined actions of the view 
		 * and the actions added by application code.
		 * </p>
		 * <p>
		 * The predefined actions are:
		 * <ul>
		 *   <li>Navigation actions. These actions move the caret collapsing the selection.</li>
		 *     <ul>
		 *       <li>"lineUp" - moves the caret up by one line</li>
		 *       <li>"lineDown" - moves the caret down by one line</li>
		 *       <li>"lineStart" - moves the caret to beginning of the current line</li>
		 *       <li>"lineEnd" - moves the caret to end of the current line </li>
		 *       <li>"charPrevious" - moves the caret to the previous character</li>
		 *       <li>"charNext" - moves the caret to the next character</li>
		 *       <li>"pageUp" - moves the caret up by one page</li>
		 *       <li>"pageDown" - moves the caret down by one page</li>
		 *       <li>"wordPrevious" - moves the caret to the previous word</li>
		 *       <li>"wordNext" - moves the caret to the next word</li>
		 *       <li>"textStart" - moves the caret to the beginning of the document</li>
		 *       <li>"textEnd" - moves the caret to the end of the document</li>
		 *     </ul>
		 *   <li>Selection actions. These actions move the caret extending the selection.</li>
		 *     <ul>
		 *       <li>"selectLineUp" - moves the caret up by one line</li>
		 *       <li>"selectLineDown" - moves the caret down by one line</li>
		 *       <li>"selectLineStart" - moves the caret to beginning of the current line</li>
		 *       <li>"selectLineEnd" - moves the caret to end of the current line </li>
		 *       <li>"selectCharPrevious" - moves the caret to the previous character</li>
		 *       <li>"selectCharNext" - moves the caret to the next character</li>
		 *       <li>"selectPageUp" - moves the caret up by one page</li>
		 *       <li>"selectPageDown" - moves the caret down by one page</li>
		 *       <li>"selectWordPrevious" - moves the caret to the previous word</li>
		 *       <li>"selectWordNext" - moves the caret to the next word</li>
		 *       <li>"selectTextStart" - moves the caret to the beginning of the document</li>
		 *       <li>"selectTextEnd" - moves the caret to the end of the document</li>
		 *       <li>"selectAll" - selects the entire document</li>
		 *     </ul>
		 *   <li>Edit actions. These actions modify the text view text</li>
		 *     <ul>
		 *       <li>"deletePrevious" - deletes the character preceding the caret</li>
		 *       <li>"deleteNext" - deletes the charecter following the caret</li>
		 *       <li>"deleteWordPrevious" - deletes the word preceding the caret</li>
		 *       <li>"deleteWordNext" - deletes the word following the caret</li>
		 *       <li>"deleteLineStart" - deletes characteres to the beginning of the line</li>
		 *       <li>"deleteLineEnd" - deletes characteres to the end of the line</li>
		 *       <li>"tab" - inserts a tab character at the caret</li>
		 *       <li>"shiftTab" - noop</li>
		 *       <li>"enter" - inserts a line delimiter at the caret</li>
		 *       <li>"uppercase" - upper case the text at the caret</li>
		 *       <li>"lowercase" - lower case the text at the caret</li>
		 *       <li>"capitalize" - capitilize case the text at the caret</li>
		 *       <li>"reversecase" - reverse the case the text at the caret</li>
		 *     </ul>
		 *   <li>Clipboard actions. These actions modify the view text as well</li>
		 *     <ul>
		 *       <li>"copy" - copies the selected text to the clipboard</li>
		 *       <li>"cut" - copies the selected text to the clipboard and deletes the selection</li>
		 *       <li>"paste" - replaces the selected text with the clipboard contents</li>
		 *     </ul>
		 *   <li>Scrolling actions.</li>
		 *     <ul>
		 *       <li>"scrollLineUp" - scrolls the view up by one line</li>
		 *       <li>"scrollLineDown" - scrolls the view down by one line</li>
		 *       <li>"scrollPageUp" - scrolls the view up by one page</li>
		 *       <li>"scrollPageDown" - scrolls the view down by one page</li>
		 *       <li>"scrollTextStart" - scrolls the view to the beginning of the document</li>
		 *       <li>"scrollTextEnd" - scrolls the view to the end of the document</li>
		 *     </ul>
		 *   <li>Mode actions.</li>
		 *     <ul>
		 *       <li>"toggleTabMode" - toggles tab mode.</li>
		 *       <li>"toggleWrapMode" - toggles wrap mode.</li>
		 *       <li>"toggleOverwriteMode" - toggles overwrite mode.</li>
		 *     </ul>
		 * </ul>
		 * </p>
		 * 
		 * @param {Boolean} [defaultAction=false] whether or not the predefined actions are included.
		 * @returns {String[]} an array of action IDs defined in the text view.
		 *
		 * @see orion.editor.TextView#invokeAction
		 * @see orion.editor.TextView#setAction
		 * @see orion.editor.TextView#setKeyBinding
		 * @see orion.editor.TextView#getKeyBindings
		 */
		getActions: function (defaultAction) {
			var result = [];
			var actions = this._actions;
			for (var i in actions) {
				if (actions.hasOwnProperty(i)) {
					if (!defaultAction && actions[i].defaultHandler) { continue; }
					result.push(i);
				}
			}
			return result;
		},
		/**
		 * Returns the bottom index.
		 * <p>
		 * The bottom index is the line that is currently at the bottom of the view.  This
		 * line may be partially visible depending on the vertical scroll of the view. The parameter
		 * <code>fullyVisible</code> determines whether to return only fully visible lines. 
		 * </p>
		 *
		 * @param {Boolean} [fullyVisible=false] if <code>true</code>, returns the index of the last fully visible line. This
		 *    parameter is ignored if the view is not big enough to show one line.
		 * @returns {Number} the index of the bottom line.
		 *
		 * @see orion.editor.TextView#getTopIndex
		 * @see orion.editor.TextView#setTopIndex
		 */
		getBottomIndex: function(fullyVisible) {
			if (!this._clientDiv) { return 0; }
			return this._getBottomIndex(fullyVisible);
		},
		/**
		 * Returns the bottom pixel.
		 * <p>
		 * The bottom pixel is the pixel position that is currently at
		 * the bottom edge of the view.  This position is relative to the
		 * beginning of the document.
		 * </p>
		 *
		 * @returns {Number} the bottom pixel.
		 *
		 * @see orion.editor.TextView#getTopPixel
		 * @see orion.editor.TextView#setTopPixel
		 * @see orion.editor.TextView#convert
		 */
		getBottomPixel: function() {
			if (!this._clientDiv) { return 0; }
			return this._getScroll().y + this._getClientHeight();
		},
		/**
		 * Returns the caret offset relative to the start of the document.
		 *
		 * @returns {Number} the caret offset relative to the start of the document.
		 *
		 * @see orion.editor.TextView#setCaretOffset
		 * @see orion.editor.TextView#setSelection
		 * @see orion.editor.TextView#getSelection
		 */
		getCaretOffset: function () {
			var s = this._getSelection();
			return s.getCaret();
		},
		/**
		 * Returns the client area.
		 * <p>
		 * The client area is the portion in pixels of the document that is visible. The
		 * client area position is relative to the beginning of the document.
		 * </p>
		 *
		 * @returns {Object} the client area rectangle {x, y, width, height}.
		 *
		 * @see orion.editor.TextView#getTopPixel
		 * @see orion.editor.TextView#getBottomPixel
		 * @see orion.editor.TextView#getHorizontalPixel
		 * @see orion.editor.TextView#convert
		 */
		getClientArea: function() {
			if (!this._clientDiv) { return {x: 0, y: 0, width: 0, height: 0}; }
			var scroll = this._getScroll();
			return {x: scroll.x, y: scroll.y, width: this._getClientWidth(), height: this._getClientHeight()};
		},
		/**
		 * Returns the horizontal pixel.
		 * <p>
		 * The horizontal pixel is the pixel position that is currently at
		 * the left edge of the view.  This position is relative to the
		 * beginning of the document.
		 * </p>
		 *
		 * @returns {Number} the horizontal pixel.
		 *
		 * @see orion.editor.TextView#setHorizontalPixel
		 * @see orion.editor.TextView#convert
		 */
		getHorizontalPixel: function() {
			if (!this._clientDiv) { return 0; }
			return this._getScroll().x;
		},
		/**
		 * Returns all the key bindings associated to the given action ID.
		 *
		 * @param {String} actionID the action ID.
		 * @returns {orion.KeyBinding[]} the array of key bindings associated to the given action ID.
		 *
		 * @see orion.editor.TextView#setKeyBinding
		 * @see orion.editor.TextView#setAction
		 */
		getKeyBindings: function (actionID) {
			var result = [];
			var keyModes = this._keyModes;
			for (var i = 0; i < keyModes.length; i++) {
				result = result.concat(keyModes[i].getKeyBindings(actionID));
			}
			return result;
		},
		/**
		 * Returns all the key modes added to text view.
		 *
		 * @returns {orion.editor.KeyMode[]} the array of key modes.
		 *
		 * @see orion.editor.TextView#addKeyMode
		 * @see orion.editor.TextView#removeKeyMode
		 */
		getKeyModes: function() {
			return this._keyModes.slice(0);
		},
		/**
		 * Returns the line height for a given line index.  Returns the default line
		 * height if the line index is not specified.
		 *
		 * @param {Number} [lineIndex] the line index.
		 * @returns {Number} the height of the line in pixels.
		 *
		 * @see orion.editor.TextView#getLinePixel
		 */
		getLineHeight: function(lineIndex) {
			if (!this._clientDiv) { return 0; }
			return this._getLineHeight(lineIndex);
		},
		/**
		 * Returns the line index for a given line pixel position relative to the document.
		 *
		 * @param {Number} [y] the line pixel.
		 * @returns {Number} the line index for the specified pixel position.
		 *
		 * @see orion.editor.TextView#getLinePixel
		 */
		getLineIndex: function(y) {
			if (!this._clientDiv) { return 0; }
			return this._getLineIndex(y);
		},
		/**
		 * Returns the top pixel position of a given line index relative to the beginning
		 * of the document.
		 * <p>
		 * Clamps out of range indices.
		 * </p>
		 *
		 * @param {Number} lineIndex the line index.
		 * @returns {Number} the pixel position of the line.
		 *
		 * @see orion.editor.TextView#setTopPixel
		 * @see orion.editor.TextView#getLineIndex
		 * @see orion.editor.TextView#convert
		 */
		getLinePixel: function(lineIndex) {
			if (!this._clientDiv) { return 0; }
			return this._getLinePixel(lineIndex);
		},
		/**
		 * Returns the {x, y} pixel location of the top-left corner of the character
		 * bounding box at the specified offset in the document.  The pixel location
		 * is relative to the document.
		 * <p>
		 * Clamps out of range offsets.
		 * </p>
		 *
		 * @param {Number} offset the character offset
		 * @returns {Object} the {x, y} pixel location of the given offset.
		 *
		 * @see orion.editor.TextView#getOffsetAtLocation
		 * @see orion.editor.TextView#convert
		 */
		getLocationAtOffset: function(offset) {
			if (!this._clientDiv) { return {x: 0, y: 0}; }
			var model = this._model;
			offset = Math.min(Math.max(0, offset), model.getCharCount());
			var lineIndex = model.getLineAtOffset(offset);
			var line = this._getLine(lineIndex);
			var rect = line.getBoundingClientRect(offset);
			line.destroy();
			var x = rect.left;
			var y = this._getLinePixel(lineIndex) + rect.top;
			return {x: x, y: y};
		},
		/**
		 * Returns the next character offset after the given offset and options
		 *
		 * @param {Number} offset the offset to start from
		 * @param {Object} options
		 *   { unit: the type of unit to advance to (eg "character", "word", "wordend", "wordWS", "wordendWS"),
		 *    count: the number of units to advance (negative to advance backwards) }
		 * @returns {Number} the next character offset
		 */
		getNextOffset: function(offset, options) {
			var selection = new Selection(offset, offset, false);
			this._doMove(options, selection);
			return selection.getCaret();
		},
		/**
		 * Returns the specified view options.
		 * <p>
		 * The returned value is either a <code>orion.editor.TextViewOptions</code> or an option value. An option value is returned when only one string parameter
		 * is specified. A <code>orion.editor.TextViewOptions</code> is returned when there are no paremeters, or the parameters are a list of options names or a
		 * <code>orion.editor.TextViewOptions</code>. All view options are returned when there no paremeters.
		 * </p>
		 *
		 * @param {String|orion.editor.TextViewOptions} [options] The options to return.
		 * @return {Object|orion.editor.TextViewOptions} The requested options or an option value.
		 *
		 * @see orion.editor.TextView#setOptions
		 */
		getOptions: function() {
			var options;
			if (arguments.length === 0) {
				options = this._defaultOptions();
			} else if (arguments.length === 1) {
				var arg = arguments[0];
				if (typeof arg === "string") { //$NON-NLS-0$
					return clone(this["_" + arg]); //$NON-NLS-0$
				}
				options = arg;
			} else {
				options = {};
				for (var index in arguments) {
					if (arguments.hasOwnProperty(index)) {
						options[arguments[index]] = undefined;
					}
				}
			}
			for (var option in options) {
				if (options.hasOwnProperty(option)) {
					options[option] = clone(this["_" + option]); //$NON-NLS-0$
				}
			}
			return options;
		},
		/**
		 * Returns the text model of the text view.
		 *
		 * @returns {orion.editor.TextModel} the text model of the view.
		 */
		getModel: function() {
			return this._model;
		},
		/**
		 * Returns the character offset nearest to the given pixel location.  The
		 * pixel location is relative to the document.
		 *
		 * @param x the x of the location
		 * @param y the y of the location
		 * @returns {Number} the character offset at the given location.
		 *
		 * @see orion.editor.TextView#getLocationAtOffset
		 */
		getOffsetAtLocation: function(x, y) {
			if (!this._clientDiv) { return 0; }
			var lineIndex = this._getLineIndex(y);
			var line = this._getLine(lineIndex);
			var offset = line.getOffset(x, y - this._getLinePixel(lineIndex));
			line.destroy();
			return offset;
		},
		/**
		 * @name getLineAtOffset
		 * @description Compute the editor line number for the given offset
		 * @function
		 * @public
		 * @memberof orion.editor.TextView
		 * @param {Number} offset The offset into the editor
		 * @returns {Number} Returns the line number in the editor corresponding to the given offset or <code>-1</code> if the offset is 
		 * out of range
		 * @since 5.0
		 */
		getLineAtOffset: function(offset) {
			return this.getModel().getLineAtOffset(offset);
		},
		/**
		 * @name getLineStart
		 * @description Compute the editor start offset of the given line number
		 * @function
		 * @public
		 * @memberof orion.editor.TextView
		 * @param {Number} line The line number in the editor
		 * @returns {Number} Returns the start offset of the given line number in the editor.
		 * @since 5.0
		 */
		getLineStart: function(line) {
			return this.getModel().getLineStart(line);
		},
		/**
		 * Get the view rulers.
		 *
		 * @returns {orion.editor.Ruler[]} the view rulers
		 *
		 * @see orion.editor.TextView#addRuler
		 */
		getRulers: function() {
			return this._rulers.slice(0);
		},
		/**
		 * Returns the text view selection.
		 * <p>
		 * The selection is defined by a start and end character offset relative to the
		 * document. The character at end offset is not included in the selection.
		 * </p>
		 * 
		 * @returns {orion.editor.Selection} the view selection
		 *
		 * @see orion.editor.TextView#setSelection
		 */
		getSelection: function () {
			return this._getSelection();
		},
		getSelections: function () {
			return this._getSelections();
		},
		getSelectionText: function(delimiter) {
			var text = [];
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (!selection.isEmpty()) {
					text.push(self._getBaseText(selection.start, selection.end));
				}
			});
			return text.join(delimiter !== undefined ? delimiter : this._model.getLineDelimiter());
		},
		/**
		 * Returns the text for the given range.
		 * <p>
		 * The text does not include the character at the end offset.
		 * </p>
		 *
		 * @param {Number} [start=0] the start offset of text range.
		 * @param {Number} [end=char count] the end offset of text range.
		 *
		 * @see orion.editor.TextView#setText 	
		 */
		getText: function(start, end) {
			var model = this._model;
			return model.getText(start, end);
		},
		/**
		 * Returns the top index.
		 * <p>
		 * The top index is the line that is currently at the top of the view.  This
		 * line may be partially visible depending on the vertical scroll of the view. The parameter
		 * <code>fullyVisible</code> determines whether to return only fully visible lines. 
		 * </p>
		 *
		 * @param {Boolean} [fullyVisible=false] if <code>true</code>, returns the index of the first fully visible line. This
		 *    parameter is ignored if the view is not big enough to show one line.
		 * @returns {Number} the index of the top line.
		 *
		 * @see orion.editor.TextView#getBottomIndex
		 * @see orion.editor.TextView#setTopIndex
		 */
		getTopIndex: function(fullyVisible) {
			if (!this._clientDiv) { return 0; }
			return this._getTopIndex(fullyVisible);
		},
		/**
		 * Returns the top pixel.
		 * <p>
		 * The top pixel is the pixel position that is currently at
		 * the top edge of the view.  This position is relative to the
		 * beginning of the document.
		 * </p>
		 *
		 * @returns {Number} the top pixel.
		 *
		 * @see orion.editor.TextView#getBottomPixel
		 * @see orion.editor.TextView#setTopPixel
		 * @see orion.editor.TextView#convert
		 */
		getTopPixel: function() {
			if (!this._clientDiv) { return 0; }
			return this._getScroll().y;
		},
		/**
		 * Executes the action handler associated with the given action ID.
		 * <p>
		 * The application defined action takes precedence over predefined actions unless
		 * the <code>defaultAction</code> paramater is <code>true</code>.
		 * </p>
		 * <p>
		 * If the application defined action returns <code>false</code>, the text view predefined
		 * action is executed if present.
		 * </p>
		 *
		 * @param {String} actionID the action ID.
		 * @param {Boolean} [defaultAction] whether to always execute the predefined action only.
		 * @param {Object} [actionOptions] action specific options to be passed to the action handlers.
		 * @returns {Boolean} <code>true</code> if the action was executed.
		 *
		 * @see orion.editor.TextView#setAction
		 * @see orion.editor.TextView#getActions
		 */
		invokeAction: function (actionID, defaultAction, actionOptions) {
			if (!this._clientDiv) { return; }
			var action = this._actions[actionID];
			if (action) {
				if (action.actionDescription && action.actionDescription.id) {
					mMetrics.logEvent("editor", "action", action.actionDescription.id); //$NON-NLS-1$ //$NON-NLS-0$
				}
				if (!defaultAction && action.handler) {
					if (action.handler(actionOptions)) {
						return true;
					}
				}
				if (action.defaultHandler) {
					return typeof action.defaultHandler(actionOptions) === "boolean"; //$NON-NLS-0$
				}
			}
			return false;
		},
		/**
		* Returns if the view is destroyed.
		* @returns {Boolean} <code>true</code> if the view is destroyed.
		*/
		isDestroyed: function () {
			return !this._clientDiv;
		},
		/** 
		 * @class This is the event sent when the user right clicks or otherwise invokes the context menu of the view. 
		 * <p> 
		 * <b>See:</b><br/> 
		 * {@link orion.editor.TextView}<br/> 
		 * {@link orion.editor.TextView#event:onContextMenu} 
		 * </p> 
		 * 
		 * @name orion.editor.ContextMenuEvent 
		 * 
		 * @property {Number} x The pointer location on the x axis, relative to the document the user is editing. 
		 * @property {Number} y The pointer location on the y axis, relative to the document the user is editing. 
		 * @property {Number} screenX The pointer location on the x axis, relative to the screen. This is copied from the DOM contextmenu event.screenX property. 
		 * @property {Number} screenY The pointer location on the y axis, relative to the screen. This is copied from the DOM contextmenu event.screenY property. 
		 * @property {Boolean} defaultPrevented Determines whether the user agent context menu should be shown. It is shown by default.
		 * @property {Function} preventDefault If called prevents the user agent context menu from showing.
		 */ 
		/** 
		 * This event is sent when the user invokes the view context menu. 
		 * 
		 * @event 
		 * @param {orion.editor.ContextMenuEvent} contextMenuEvent the event 
		 */ 
		onContextMenu: function(contextMenuEvent) {
			return this.dispatchEvent(contextMenuEvent); 
		}, 
		onDragStart: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDrag: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDragEnd: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDragEnter: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDragOver: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDragLeave: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		onDrop: function(dragEvent) {
			return this.dispatchEvent(dragEvent);
		},
		/**
		 * @class This is the event sent when the text view is destroyed.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onDestroy}
		 * </p>
		 * @name orion.editor.DestroyEvent
		 */
		/**
		 * This event is sent when the text view has been destroyed.
		 *
		 * @event
		 * @param {orion.editor.DestroyEvent} destroyEvent the event
		 *
		 * @see orion.editor.TextView#destroy
		 */
		onDestroy: function(destroyEvent) {
			return this.dispatchEvent(destroyEvent);
		},
		/**
		 * @description This event is sent when the file is being saved
		 * @function
		 * @param {Object} savingEvent the event
		 * @since 8.0
		 */
		onSaving: function onSaving(savingEvent) {
		    return this.dispatchEvent(savingEvent);
		},
		/**
		 * @description This event is sent when the file has been saved
		 * @function
		 * @param {Object} inputChangedEvent the event
		 * @since 8.0
		 */
		onInputChanged: function onInputChanged(inputChangedEvent) {
		    return this.dispatchEvent(inputChangedEvent);
		},
		/**
		 * @class This object is used to define style information for the text view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onLineStyle}
		 * </p>		 
		 * @name orion.editor.Style
		 * 
		 * @property {String} styleClass A CSS class name.
		 * @property {Object} style An object with CSS properties.
		 * @property {String} tagName A DOM tag name.
		 * @property {Object} attributes An object with DOM attributes.
		 */
		/**
		 * @class This object is used to style range.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onLineStyle}
		 * </p>		 
		 * @name orion.editor.StyleRange
		 * 
		 * @property {Number} start The start character offset, relative to the document, where the style should be applied.
		 * @property {Number} end The end character offset (exclusive), relative to the document, where the style should be applied.
		 * @property {orion.editor.Style} style The style for the range.
		 */
		/**
		 * @class This is the event sent when the text view needs the style information for a line.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onLineStyle}
		 * </p>		 
		 * @name orion.editor.LineStyleEvent
		 * 
		 * @property {orion.editor.TextView} textView The text view.		 
		 * @property {Number} lineIndex The line index.
		 * @property {String} lineText The line text.
		 * @property {Number} lineStart The character offset, relative to document, of the first character in the line.
		 * @property {orion.editor.Style} style The style for the entire line (output argument).
		 * @property {orion.editor.StyleRange[]} ranges An array of style ranges for the line (output argument).		 
		 */
		/**
		 * This event is sent when the text view needs the style information for a line.
		 *
		 * @event
		 * @param {orion.editor.LineStyleEvent} lineStyleEvent the event
		 */
		onLineStyle: function(lineStyleEvent) {
			return this.dispatchEvent(lineStyleEvent);
		},
		/**
		 * @class This is the event sent for all keyboard events.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onKeyDown}<br/>
		 * {@link orion.editor.TextView#event:onKeyPress}<br/>
		 * {@link orion.editor.TextView#event:onKeyUp}<br/>
		 * </p>
		 * @name orion.editor.KeyEvent
		 * 
		 * @property {String} type The type of event.
		 * @property {DOMEvent} event The key DOM event.
		 * @property {Boolean} defaultPrevented Determines whether the user agent context menu should be shown. It is shown by default.
		 * @property {Function} preventDefault If called prevents the user agent context menu from showing.
		 */
		/**
		 * This event is sent for key down events.
		 *
		 * @event
		 * @param {orion.editor.KeyEvent} keyEvent the event
		 */
		onKeyDown: function(keyEvent) {
			return this.dispatchEvent(keyEvent);
		},
		/**
		 * This event is sent for key press events. Key press events are only sent
		 * for printable characters.
		 *
		 * @event
		 * @param {orion.editor.KeyEvent} keyEvent the event
		 */
		onKeyPress: function(keyEvent) {
			return this.dispatchEvent(keyEvent);
		},
		/**
		 * This event is sent for key up events.
		 *
		 * @event
		 * @param {orion.editor.KeyEvent} keyEvent the event
		 */
		onKeyUp: function(keyEvent) {
			return this.dispatchEvent(keyEvent);
		},
		/**
		 * @class This is the event sent when the text in the model has changed.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onModelChanged}<br/>
		 * {@link orion.editor.TextModel#onChanged}
		 * </p>
		 * @name orion.editor.ModelChangedEvent
		 * 
		 * @property {Number} start The character offset in the model where the change has occurred.
		 * @property {Number} removedCharCount The number of characters removed from the model.
		 * @property {Number} addedCharCount The number of characters added to the model.
		 * @property {Number} removedLineCount The number of lines removed from the model.
		 * @property {Number} addedLineCount The number of lines added to the model.
		 */
		/**
		 * This event is sent when the text in the model has changed.
		 *
		 * @event
		 * @param {orion.editor.ModelChangedEvent} modelChangedEvent the event
		 */
		onModelChanged: function(modelChangedEvent) {
			return this.dispatchEvent(modelChangedEvent);
		},
		/**
		 * @class This is the event sent when the text in the model is about to change.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onModelChanging}<br/>
		 * {@link orion.editor.TextModel#onChanging}
		 * </p>
		 * @name orion.editor.ModelChangingEvent
		 * 
		 * @property {String} text The text that is about to be inserted in the model.
		 * @property {Number} start The character offset in the model where the change will occur.
		 * @property {Number} removedCharCount The number of characters being removed from the model.
		 * @property {Number} addedCharCount The number of characters being added to the model.
		 * @property {Number} removedLineCount The number of lines being removed from the model.
		 * @property {Number} addedLineCount The number of lines being added to the model.
		 */
		/**
		 * This event is sent when the text in the model is about to change.
		 *
		 * @event
		 * @param {orion.editor.ModelChangingEvent} modelChangingEvent the event
		 */
		onModelChanging: function(modelChangingEvent) {
			return this.dispatchEvent(modelChangingEvent);
		},
		/**
		 * @class This is the event sent when the text is modified by the text view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onModify}
		 * </p>
		 * @name orion.editor.ModifyEvent
		 */
		/**
		 * This event is sent when the text view has changed text in the model.
		 * <p>
		 * If the text is changed directly through the model API, this event
		 * is not sent.
		 * </p>
		 *
		 * @event
		 * @param {orion.editor.ModifyEvent} modifyEvent the event
		 */
		onModify: function(modifyEvent) {
			return this.dispatchEvent(modifyEvent);
		},
		onMouseDown: function(mouseEvent) {
			return this.dispatchEvent(mouseEvent);
		},
		onMouseUp: function(mouseEvent) {
			return this.dispatchEvent(mouseEvent);
		},
		onMouseMove: function(mouseEvent) {
			return this.dispatchEvent(mouseEvent);
		},
		onMouseOver: function(mouseEvent) {
			return this.dispatchEvent(mouseEvent);
		},
		onMouseOut: function(mouseEvent) {
			return this.dispatchEvent(mouseEvent);
		},
		onTouchStart: function(touchEvent) {
			return this.dispatchEvent(touchEvent);
		},
		onTouchMove: function(touchEvent) {
			return this.dispatchEvent(touchEvent);
		},
		onTouchEnd: function(touchEvent) {
			return this.dispatchEvent(touchEvent);
		},
		onOptions: function(optionsEvent) {
			return this.dispatchEvent(optionsEvent);
		},
		/**
		 * @class This is the event sent when the selection changes in the text view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onSelection}
		 * </p>		 
		 * @name orion.editor.SelectionEvent
		 * 
		 * @property {orion.editor.Selection} oldValue The old selection.
		 * @property {orion.editor.Selection} newValue The new selection.
		 */
		/**
		 * This event is sent when the text view selection has changed.
		 *
		 * @event
		 * @param {orion.editor.SelectionEvent} selectionEvent the event
		 */
		onSelection: function(selectionEvent) {
			return this.dispatchEvent(selectionEvent);
		},
		/**
		 * @class This is the event sent when the text view scrolls.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onScroll}
		 * </p>		 
		 * @name orion.editor.ScrollEvent
		 * 
		 * @property {Object} oldValue The old scroll {x,y}.
		 * @property {Object} newValue The new scroll {x,y}.
		 */
		/**
		 * This event is sent when the text view scrolls vertically or horizontally.
		 *
		 * @event
		 * @param {orion.editor.ScrollEvent} scrollEvent the event
		 */
		onScroll: function(scrollEvent) {
			return this.dispatchEvent(scrollEvent);
		},
		/**
		 * @class This is the event sent when the text is about to be modified by the text view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onVerify}
		 * </p>
		 * @name orion.editor.VerifyEvent
		 * 
		 * @property {String} text The text being inserted.
		 * @property {Number} start The start offset of the text range to be replaced.
		 * @property {Number} end The end offset (exclusive) of the text range to be replaced.
		 */
		/**
		 * This event is sent when the text view is about to change text in the model.
		 * <p>
		 * If the text is changed directly through the model API, this event
		 * is not sent.
		 * </p>
		 * <p>
		 * Listeners are allowed to change these parameters. Setting text to null
		 * or undefined stops the change.
		 * </p>
		 *
		 * @event
		 * @param {orion.editor.VerifyEvent} verifyEvent the event
		 */
		onVerify: function(verifyEvent) {
			return this.dispatchEvent(verifyEvent);
		},
		/**
		 * @class This is the event sent when the text view is focused.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onFocus}<br/>
		 * </p>
		 * @name orion.editor.FocusEvent
		 */
		/**
		 * This event is sent when the text view is focused.
		 *
		 * @event
		 * @param {orion.editor.FocusEvent} focusEvent the event
		 */
		onFocus: function(focusEvent) {
			return this.dispatchEvent(focusEvent);
		},
		/**
		 * @class This is the event sent when the text view goes out of focus.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#event:onBlur}<br/>
		 * </p>
		 * @name orion.editor.BlurEvent
		 */
		/**
		 * This event is sent when the text view goes out of focus.
		 *
		 * @event
		 * @param {orion.editor.BlurEvent} blurEvent the event
		 */
		onBlur: function(blurEvent) {
			return this.dispatchEvent(blurEvent);
		},
		/**
		 * Redraws the entire view, including rulers.
		 *
		 * @see orion.editor.TextView#redrawLines
		 * @see orion.editor.TextView#redrawRange
		 * @see orion.editor.TextView#setRedraw
		 */
		redraw: function() {
			if (this._redrawCount > 0) { return; }
			var lineCount = this._model.getLineCount();
			this.redrawRulers(0, lineCount);
			this.redrawLines(0, lineCount); 
		},
		redrawRulers: function(startLine, endLine) {
			if (this._redrawCount > 0) { return; }
			var rulers = this.getRulers();
			for (var i = 0; i < rulers.length; i++) {
				this.redrawLines(startLine, endLine, rulers[i]);
			}
		},
		/**
		 * Redraws the text in the given line range.
		 * <p>
		 * The line at the end index is not redrawn.
		 * </p>
		 *
		 * @param {Number} [startLine=0] the start line
		 * @param {Number} [endLine=line count] the end line
		 *
		 * @see orion.editor.TextView#redraw
		 * @see orion.editor.TextView#redrawRange
		 * @see orion.editor.TextView#setRedraw
		 */
		redrawLines: function(startLine, endLine, ruler) {
			if (this._redrawCount > 0) { return; }
			if (startLine === undefined) { startLine = 0; }
			if (endLine === undefined) { endLine = this._model.getLineCount(); }
			if (startLine === endLine) { return; }
			var div = this._clientDiv;
			if (!div) { return; }
			if (ruler) {
				var divRuler = this._getRulerParent(ruler);
				div = divRuler.firstChild;
				while (div) {
					if (div._ruler === ruler) {
						break;
					}
					div = div.nextSibling;
				}
			}
			if (ruler) {
				div.rulerChanged = true;
			} else {
				if (this._lineHeight) {
					this._resetLineHeight(startLine, endLine);
				}
			}
			if (!ruler || ruler.getOverview() === "page") { //$NON-NLS-0$
				var child = div.firstChild;
				while (child) {
					var lineIndex = child.lineIndex;
					if (startLine <= lineIndex && lineIndex < endLine) {
						child.lineChanged = true;
					}
					child = child.nextSibling;
				}
			}
			if (!ruler) {
				if (!this._wrapMode) {
					if (startLine <= this._maxLineIndex && this._maxLineIndex < endLine) {
						this._checkMaxLineIndex = this._maxLineIndex;
						this._maxLineIndex = -1;
						this._maxLineWidth = 0;
					}
				}
			}
			this.dispatchEvent({type: "Redraw", startLine: startLine, endLine: endLine, ruler: ruler}); //$NON-NLS-0$
			this._queueUpdate();
		},
		/**
		 * Redraws the text in the given range.
		 * <p>
		 * The character at the end offset is not redrawn.
		 * </p>
		 *
		 * @param {Number} [start=0] the start offset of text range
		 * @param {Number} [end=char count] the end offset of text range
		 *
		 * @see orion.editor.TextView#redraw
		 * @see orion.editor.TextView#redrawLines
		 * @see orion.editor.TextView#setRedraw
		 */
		redrawRange: function(start, end) {
			if (this._redrawCount > 0) { return; }
			var model = this._model;
			if (start === undefined) { start = 0; }
			if (end === undefined) { end = model.getCharCount(); }
			var startLine = model.getLineAtOffset(start);
			var endLine = model.getLineAtOffset(Math.max(start, end - 1)) + 1;
			this.redrawLines(startLine, endLine);
		},	
		/**
		 * Removes a key mode from the text view.
		 *
		 * @param {orion.editor.KeyMode} mode the key mode.
		 */
		removeKeyMode: function (mode) {
			var keyModes = this._keyModes;
			for (var i=0; i<keyModes.length; i++) {
				if (keyModes[i] === mode) {
					keyModes.splice(i, 1);
					break;
				}
			}
			//TODO: API needed for this
			if (mode._modeRemoved) {
				mode._modeRemoved();
			}
		},
		/**
		 * Removes a ruler from the text view.
		 *
		 * @param {orion.editor.Ruler} ruler the ruler.
		 */
		removeRuler: function (ruler) {
			var rulers = this._rulers;
			for (var i=0; i<rulers.length; i++) {
				if (rulers[i] === ruler) {
					rulers.splice(i, 1);
					ruler.setView(null);
					this._destroyRuler(ruler);
					this._update();
					break;
				}
			}
		},
		resize: function() {
			if (!this._clientDiv) { return; }
			this._handleResize(null);
		},
		/**
		 * @class This object describes an action for the text view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView}<br/>
		 * {@link orion.editor.TextView#setAction}
		 * </p>		 
		 * @name orion.editor.ActionDescription
		 *
		 * @property {String} [name] the name to be used when showing the action as text.
		 */
		/**
		 * Associates an application defined handler to an action ID.
		 * <p>
		 * If the action ID is a predefined action, the given handler executes before
		 * the default action handler.  If the given handler returns <code>true</code>, the
		 * default action handler is not called.
		 * </p>
		 *
		 * @param {String} actionID the action ID.
		 * @param {Function} handler the action handler.
		 * @param {orion.editor.ActionDescription} [actionDescription=undefined] the action description.
		 *
		 * @see orion.editor.TextView#getActions
		 * @see orion.editor.TextView#invokeAction
		 */
		setAction: function(actionID, handler, actionDescription) {
			if (!actionID) { return; }
			var actions = this._actions;
			var action = actions[actionID];
			if (!action) { 
				action = actions[actionID] = {};
			}
			action.handler = handler;
			if (actionDescription !== undefined) {
				action.actionDescription = actionDescription;
			}
		},
		/**
		 * Associates a key binding with the given action ID. Any previous
		 * association with the specified key binding is overwriten. If the
		 * action ID is <code>null</code>, the association is removed.
		 * 
		 * @param {orion.KeyBinding} keyBinding the key binding
		 * @param {String} actionID the action ID
		 */
		setKeyBinding: function(keyBinding, actionID) {
			this._keyModes[0].setKeyBinding(keyBinding, actionID);
		},
		/**
		 * Sets the caret offset relative to the start of the document.
		 *
		 * @param {Number} caret the caret offset relative to the start of the document.
		 * @param {Boolean|Number|orion.editor.TextViewShowOptions} [show=true]
		 * 					if <code>true</code>, the view will scroll the minimum amount necessary to show the caret location. If
		 *					<code>show</code> is a <code>Number</code>, the view will scroll the minimum amount necessary to show the caret location plus a
		 *					percentage of the client area height. The parameter is clamped to the [0,1] range.  In either case, the view will only scroll
		 *					if the new caret location is not visible already.  The <code>show</code> parameter can also be a <code>orion.editor.TextViewShowOptions</code> object. See
		 * 					{@link orion.editor.TextViewShowOptions} for further information in how the options can be used to control the scrolling behavior.
		 * @param {Function} [callback] if callback is specified and <code>scrollAnimation</code> is not zero, view scrolling is animated and
		 *					the callback is called when the animation is done. Otherwise, callback is callback right away.
		 *
		 * @see orion.editor.TextView#getCaretOffset
		 * @see orion.editor.TextView#setSelection
		 * @see orion.editor.TextView#getSelection
		 */
		setCaretOffset: function(offset, show, callback) {
			var charCount = this._model.getCharCount();
			offset = Math.max(0, Math.min (offset, charCount));
			var selection = new Selection(offset, offset, false);
			this._setSelection (selection, show === undefined || show, true, callback);
		},
		/**
		 * Sets the horizontal pixel.
		 * <p>
		 * The horizontal pixel is the pixel position that is currently at
		 * the left edge of the view.  This position is relative to the
		 * beginning of the document.
		 * </p>
		 *
		 * @param {Number} pixel the horizontal pixel.
		 *
		 * @see orion.editor.TextView#getHorizontalPixel
		 * @see orion.editor.TextView#convert
		 */
		setHorizontalPixel: function(pixel) {
			if (!this._clientDiv) { return; }
			pixel = Math.max(0, pixel);
			this._scrollView(pixel - this._getScroll().x, 0);
		},
		/**
		 * Sets whether the view should update the DOM.
		 * <p>
		 * This can be used to improve the performance.
		 * </p><p>
		 * When the flag is set to <code>true</code>,
		 * the entire view is marked as needing to be redrawn. 
		 * Nested calls to this method are stacked.
		 * </p>
		 *
		 * @param {Boolean} redraw the new redraw state
		 * 
		 * @see orion.editor.TextView#redraw
		 */
		setRedraw: function(redraw) {
			if (redraw) {
				if (--this._redrawCount === 0) {
					this.redraw();
				}
			} else {
				this._redrawCount++;
			}
		},
		/**
		 * Sets the text model of the text view.
		 *
		 * @param {orion.editor.TextModel} model the text model of the view.
		 */
		setModel: function(model) {
			if (model === this._model) { return; }
			model = model || new mTextModel.TextModel();
			this._model.removeEventListener("preChanging", this._modelListener.onChanging); //$NON-NLS-0$
			this._model.removeEventListener("postChanged", this._modelListener.onChanged); //$NON-NLS-0$
			var oldLineCount = this._model.getLineCount();
			var oldCharCount = this._model.getCharCount();
			var newLineCount = model.getLineCount();
			var newCharCount = model.getCharCount();
			var newText = model.getText();
			var e = {
				type: "ModelChanging", //$NON-NLS-0$
				text: newText,
				start: 0,
				removedCharCount: oldCharCount,
				addedCharCount: newCharCount,
				removedLineCount: oldLineCount,
				addedLineCount: newLineCount
			};
			this.onModelChanging(e);
			this._model = model;
			e = {
				type: "ModelChanged", //$NON-NLS-0$
				start: 0,
				removedCharCount: oldCharCount,
				addedCharCount: newCharCount,
				removedLineCount: oldLineCount,
				addedLineCount: newLineCount
			};
			this.onModelChanged(e); 
			this._model.addEventListener("preChanging", this._modelListener.onChanging); //$NON-NLS-0$
			this._model.addEventListener("postChanged", this._modelListener.onChanged); //$NON-NLS-0$
			this._reset();
			this._update();
		},
		/**
		 * Sets the view options for the view.
		 *
		 * @param {orion.editor.TextViewOptions} options the view options.
		 * 
		 * @see orion.editor.TextView#getOptions
		 */
		setOptions: function (options) {
			var defaultOptions = this._defaultOptions();
			for (var option in options) {
				if (options.hasOwnProperty(option)) {
					var newValue = options[option], oldValue = this["_" + option]; //$NON-NLS-0$
					if (compare(oldValue, newValue)) { continue; }
					var update = defaultOptions[option] ? defaultOptions[option].update : null;
					if (update) {
						update.call(this, newValue);
						continue;
					}
					this["_" + option] = clone(newValue); //$NON-NLS-0$
				}
			}
			this.onOptions({type: "Options", options: options}); //$NON-NLS-0$
		},
		/**
		 * @class This object describes the selection show options.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.TextView#setSelection}
		 * {@link orion.editor.TextView#setCaretOffset}	 
		 * {@link orion.editor.TextView#showSelection}	 
		 * </p>		 
		 * @name orion.editor.TextViewShowOptions
		 *
		 * @property {String} viewAnchor the view anchor.  The view anchor can be one of these values:
		 * <p>
		 * <ul>
		 *   <li>"top" - align the selection to the top of the view client area.</li>
		 *   <li>"bottom" - align the selection to the bottom of the view client area.</li>
		 *   <li>"center" - align the selection to the center of the view client area.</li>
		 *   <li> by default - align the selection to the top or bottom of the client area depending on whether the caret is above or below the client area respectively. </li>
		 * </ul>
		 * </p>
		 * @property {Number} [viewAnchorOffset=0] an offset from the view anchor. The offset is a percentage of the client area height and it is clamped to [0-1] range.
		 * @property {String} [selectionAnchor=caret] the selection anchor. The seleciton anchor can be one of these values:
		 * <p>
		 * <ul>
		 *   <li>"top" - align the top of the selection to the view anchor.</li>
		 *   <li>"bottom" - align the bottom of the selection to the view anchor.</li>
		 *   <li>"center" - align the center of the selection to the view anchor.</li>
		 *   <li> by default - align the top or bottom of the selection to the view anchor depending on whether the caret is at the start or end of the selection. </li>
		 * </ul>
		 * </p>
		 * @property {String} [scrollPolicy] the scroll policy. The scroll policy can be one of these values:
		 * <p>
		 * <ul>
		 *   <li>"always" - always scroll vertically to the desired pixel offset even if the caret is already visible.</li>
		 *   <li> by default - only scroll if the caret is not visible. </li>
		 * </ul>
		 * </p>
		 */
		/**
		 * Sets the text view selection.
		 * <p>
		 * The selection is defined by a start and end character offset relative to the
		 * document. The character at end offset is not included in the selection.
		 * </p>
		 * <p>
		 * The caret is always placed at the end offset. The start offset can be
		 * greater than the end offset to place the caret at the beginning of the
		 * selection.
		 * </p>
		 * <p>
		 * Clamps out of range offsets.
		 * </p>
		 * 
		 * @param {Number} start the start offset of the selection
		 * @param {Number} end the end offset of the selection
		 * @param {Boolean|Number|orion.editor.TextViewShowOptions} [show=true]
		 * 					if <code>true</code>, the view will scroll the minimum amount necessary to show the caret location. If
		 *					<code>show</code> is a <code>Number</code>, the view will scroll the minimum amount necessary to show the caret location plus a
		 *					percentage of the client area height. The parameter is clamped to the [0,1] range.  In either case, the view will only scroll
		 *					if the new caret location is not visible already.  The <code>show</code> parameter can also be a <code>orion.editor.TextViewShowOptions</code> object. See
		 * 					{@link orion.editor.TextViewShowOptions} for further information in how the options can be used to control the scrolling behavior.
		 * @param {Function} [callback] if callback is specified and <code>scrollAnimation</code> is not zero, view scrolling is animated and
		 *					the callback is called when the animation is done. Otherwise, callback is callback right away.
		 *
		 * @see orion.editor.TextView#getSelection
		 */
		setSelection: function (start, end, show, callback) {
			var caret = start > end;
			if (caret) {
				var tmp = start;
				start = end;
				end = tmp;
			}
			var charCount = this._model.getCharCount();
			start = Math.max(0, Math.min (start, charCount));
			end = Math.max(0, Math.min (end, charCount));
			var selection = new Selection(start, end, caret);
			this._setSelection(selection, show === undefined || show, true, callback);
		},
		setSelections: function (ranges, show, callback) {
			var selections = this._rangesToSelections(ranges);
			this._setSelection(selections, show === undefined || show, true, callback);
		},
		/**
		 * Replaces the text in the given range with the given text.
		 * <p>
		 * The character at the end offset is not replaced.
		 * </p>
		 * <p>
		 * When both <code>start</code> and <code>end</code> parameters
		 * are not specified, the text view places the caret at the beginning
		 * of the document and scrolls to make it visible.
		 * </p>
		 *
		 * @param {String} text the new text.
		 * @param {Number} [start=0] the start offset of text range.
		 * @param {Number} [end=char count] the end offset of text range.
		 *
		 * @see orion.editor.TextView#getText
		 */
		setText: function (text, start, end) {
			var isSingle = typeof text === "string"; //$NON-NLS-0$
			var reset = start === undefined && end === undefined && isSingle;
			var edit;
			if (isSingle) {
				if (start === undefined) { start = 0; }
				if (end === undefined) { end = this._model.getCharCount(); }
				edit = {text: text, selection: [new Selection(start, end, false)]};
			} else {
				edit = text;
				edit.selection = this._rangesToSelections(edit.selection);
			}
			edit._code = true;
			if (reset) {
				this._variableLineHeight = false;
			}
			this._modifyContent(edit, !reset);
			if (reset) {
				/*
				* Bug in Firefox.  For some reason, the caret does not show after the
				* view is refreshed.  The fix is to toggle the contentEditable state and
				* force the clientDiv to loose and receive focus if it is focused.
				*/
				if (util.isFirefox < 13) {
					this._fixCaret();
				}
			}
		},
		/**
		 * Sets the top index.
		 * <p>
		 * The top index is the line that is currently at the top of the text view.  This
		 * line may be partially visible depending on the vertical scroll of the view.
		 * </p>
		 *
		 * @param {Number} topIndex the index of the top line.
		 * @param {Function} [callback] if callback is specified and <code>scrollAnimation</code> is not zero, view scrolling is animated and
		 *					the callback is called when the animation is done. Otherwise, callback is callback right away.
		 *
		 * @see orion.editor.TextView#getBottomIndex
		 * @see orion.editor.TextView#getTopIndex
		 */
		setTopIndex: function(topIndex, callback) {
			if (!this._clientDiv) { return; }
			this._scrollViewAnimated(0, this._getLinePixel(Math.max(0, topIndex)) - this._getScroll().y, callback);
		},
		/**
		 * Sets the top pixel.
		 * <p>
		 * The top pixel is the pixel position that is currently at
		 * the top edge of the view.  This position is relative to the
		 * beginning of the document.
		 * </p>
		 *
		 * @param {Number} pixel the top pixel.
		 * @param {Function} [callback] if callback is specified and <code>scrollAnimation</code> is not zero, view scrolling is animated and
		 *					the callback is called when the animation is done. Otherwise, callback is callback right away.
		 *
		 * @see orion.editor.TextView#getBottomPixel
		 * @see orion.editor.TextView#getTopPixel
		 * @see orion.editor.TextView#convert
		 */
		setTopPixel: function(pixel, callback) {
			if (!this._clientDiv) { return; }
			this._scrollViewAnimated(0, Math.max(0, pixel) - this._getScroll().y, callback);
		},
		/**
		 * Scrolls the selection into view if needed.
		 *
 		 * @param {Number|orion.editor.TextViewShowOptions} [show=0]
		 * 					If <code>show</code> is a <code>Number</code>, the view will scroll the minimum amount necessary to show the caret location plus a
		 *					percentage of the client area height. The parameter is clamped to the [0,1] range.  The view will only scroll
		 *					if the new caret location is not visible already.  The <code>show</code> parameter can also be a <code>orion.editor.TextViewShowOptions</code> object. See
		 * 					{@link orion.editor.TextViewShowOptions} for further information in how the options can be used to control the scrolling behavior.
		 * @param {Function} [callback] if callback is specified and <code>scrollAnimation</code> is not zero, view scrolling is animated and
		 *					the callback is called when the animation is done. Otherwise, callback is callback right away.
		 *
		 * @returns {Boolean} true if the view was scrolled.
		 *
		 * @see orion.editor.TextView#getSelection
		 * @see orion.editor.TextView#setSelection
		 * @see orion.editor.TextView#setCaretOffset
		 */
		showSelection: function(show, callback) {
			return this._showCaret(show ? false : true, callback, show);
		},
		update: function(styleChanged, sync) {
			if (!this._clientDiv) { return; }
			if (styleChanged || this._metrics.invalid) {
				this._updateStyle();
			}
			if (sync === undefined || sync) {
				this._update();
			} else {
				this._queueUpdate();
			}
		},
		
		/**************************************** Event handlers *********************************/
		_handleRootMouseDown: function (e) {
			this._cancelCheckSelection();
			if (this._ignoreEvent(e)) { return; }
			if (util.isFirefox < 13 && e.which === 1) {
				this._clientDiv.contentEditable = false;
				(this._overlayDiv || this._clientDiv).draggable = true;
				this._ignoreBlur = true;
			}
			
			/* Prevent clicks outside of the client div from taking focus away. */
			var topNode = this._overlayDiv || this._clientDiv;
			/* Use view div on IE 8 otherwise it is not possible to scroll. */
			if (util.isIE < 9) { topNode = this._viewDiv; }
			var temp = e.target ? e.target : e.srcElement;
			while (temp) {
				if (topNode === temp) {
					return;
				}
				if (temp.className && temp.className.indexOf("textViewFind") !== -1) { //$NON-NLS-0$
					return;
				}
				temp = temp.parentNode;
			}
			if (e.preventDefault) { e.preventDefault(); }
			if (e.stopPropagation){ e.stopPropagation(); }
			if (!this._isW3CEvents) {
				/*
				* In IE 8 is not possible to prevent the default handler from running
				* during mouse down event using usual API. The workaround is to give
				* focus back to the client div.
				*/ 
				var self = this;
				var window = this._getWindow();
				window.setTimeout(function() {
					self._clientDiv.focus();
				}, 0);
			}
		},
		_handleRootMouseUp: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (util.isFirefox < 13 && e.which === 1) {
				this._clientDiv.contentEditable = true;
				(this._overlayDiv || this._clientDiv).draggable = false;
			}
			if (util.isFirefox && e.which === 1) {
				
				/*
				* Bug in Firefox.  For some reason, Firefox stops showing the caret
				* in some cases. For example when the user cancels a drag operation 
				* by pressing ESC.  The fix is to detect that the drag operation was
				* cancelled,  toggle the contentEditable state and force the clientDiv
				* to loose and receive focus if it is focused.
				*/
				this._fixCaret();
				this._ignoreBlur = false;
			}
		},
		_handleBlur: function () {
			this._cancelCheckSelection();
			if (this._ignoreBlur) { return; }
			this._commitIME();
			this._hasFocus = false;
			/*
			* Bug in IE 8 and earlier. For some reason when text is deselected
			* the overflow selection at the end of some lines does not get redrawn.
			* The fix is to create a DOM element in the body to force a redraw.
			*/
			if (util.isIE < 9) {
				if (!this._getSelections()[0].isEmpty()) {
					var rootDiv = this._rootDiv;
					var child = util.createElement(rootDiv.ownerDocument, "div"); //$NON-NLS-0$
					rootDiv.appendChild(child);
					rootDiv.removeChild(child);
				}
			}
			if (this._cursorDiv) {
				this._cursorDiv.style.display = "none"; //$NON-NLS-0$
			}
			if (this._domSelection) {
				this._domSelection.forEach(function(domSelection) { domSelection.update(); });
				/* Clear browser selection if selection is within clientDiv */
				var temp;
				var window = this._getWindow();
				var document = this._parent.ownerDocument;
				if (window.getSelection) {
					var sel = window.getSelection();
					temp = sel.anchorNode;
					while (temp) {
						if (temp === this._clientDiv) {
							if (sel.rangeCount > 0) { sel.removeAllRanges(); }
							break;
						}
						temp = temp.parentNode;
					}
				} else if (document.selection) {
					this._ignoreSelect = false;
					temp = document.selection.createRange().parentElement();
					while (temp) {
						if (temp === this._clientDiv) {
							document.selection.empty();
							break;
						}
						temp = temp.parentNode;
					}
					this._ignoreSelect = true;
				}
			}
			if (!this._ignoreFocus) {
				this.onBlur({type: "Blur"}); //$NON-NLS-0$
			}
		},
		_handleCompositionStart: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._startIME();
			if (this._mutationObserver) {
				this._mutationObserver.disconnect();
				this._mutationObserver = null;
			}
		},
		_handleCompositionEnd: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._commitIME(e.data);
		},
		_handleContextMenu: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (util.isIE && this._lastMouseButton === 3) {
				// We need to update the DOM selection, because on
				// right-click the caret moves to the mouse location.
				// See bug 366312 and 376508.
				this._updateDOMSelection();
			}
			var preventDefault = false;
			if (this.isListening("ContextMenu")) { //$NON-NLS-0$
				var evt = this._createMouseEvent("ContextMenu", e); //$NON-NLS-0$
				evt.screenX = e.screenX;
				evt.screenY = e.screenY;
				this.onContextMenu(evt);
				preventDefault = evt.defaultPrevented;
			} else if (util.isMac && util.isFirefox && e.button === 0) {
				// hack to prevent CTRL+Space from showing the browser context menu
				preventDefault = true;
			}
			if (preventDefault) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			} else {
				this._contextMenuOpen = true;
				if (util.isFirefox) {
					this._checkSelectionChange = true;
					this._pollSelectionChange(true);
				}
			}
		},
		_handleCopy: function (e) {
			this._cancelCheckSelection();
			if (this._ignoreEvent(e)) { return; }
			if (this._ignoreCopy) { return; }
			if (this._doCopy(e)) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleCut: function (e) {
			this._cancelCheckSelection();
			if (this._ignoreEvent(e)) { return; }
			if (this._doCut(e)) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleDataModified: function(e) {
			if (this._ignoreEvent(e)) { return; }
			this._startIME();
		},
		_handleDblclick: function (e) {
			if (this._ignoreEvent(e)) { return; }
			var time = e.timeStamp ? e.timeStamp : new Date().getTime();
			this._lastMouseTime = time;
			if (this._clickCount !== 2) {
				this._clickCount = 2;
				this._handleMouse(e);
			}
		},
		_handleDragStart: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (util.isFirefox < 13) {
				var self = this;
				var window = this._getWindow();
				window.setTimeout(function() {
					self._clientDiv.contentEditable = true;
					self._clientDiv.draggable = false;
					self._ignoreBlur = false;
				}, 0);
			}
			if (this.isListening("DragStart") && this._dragOffset !== -1) { //$NON-NLS-0$
				this._isMouseDown = false;
				this.onDragStart(this._createMouseEvent("DragStart", e)); //$NON-NLS-0$
				this._dragOffset = -1;
			} else {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleDrag: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (this.isListening("Drag")) { //$NON-NLS-0$
				this.onDrag(this._createMouseEvent("Drag", e)); //$NON-NLS-0$
			}
		},
		_handleDragEnd: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._dropTarget = false;
			this._dragOffset = -1;
			if (this.isListening("DragEnd")) { //$NON-NLS-0$
				this.onDragEnd(this._createMouseEvent("DragEnd", e)); //$NON-NLS-0$
			}
			if (util.isFirefox < 13) {
				this._fixCaret();
				/*
				* Bug in Firefox.  For some reason, Firefox stops showing the caret when the 
				* selection is dropped onto itself. The fix is to detected the case and 
				* call fixCaret() a second time.
				*/
				if (e.dataTransfer.dropEffect === "none" && !e.dataTransfer.mozUserCancelled) { //$NON-NLS-0$
					this._fixCaret();
				}
			}
		},
		_handleDragEnter: function (e) {
			if (this._ignoreEvent(e)) { return; }
			var prevent = true;
			this._dropTarget = true;
			if (this.isListening("DragEnter")) { //$NON-NLS-0$
				prevent = false;
				this.onDragEnter(this._createMouseEvent("DragEnter", e)); //$NON-NLS-0$
			}
			/*
			* Webkit will not send drop events if this event is not prevented, as spec in HTML5.
			* Firefox and IE do not follow this spec for contentEditable. Note that preventing this 
			* event will result is loss of functionality (insertion mark, etc).
			*/
			if (util.isWebkit || prevent) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleDragOver: function (e) {
			if (this._ignoreEvent(e)) { return; }
			var prevent = true;
			if (this.isListening("DragOver")) { //$NON-NLS-0$
				prevent = false;
				this.onDragOver(this._createMouseEvent("DragOver", e)); //$NON-NLS-0$
			}
			/*
			* Webkit will not send drop events if this event is not prevented, as spec in HTML5.
			* Firefox and IE do not follow this spec for contentEditable. Note that preventing this 
			* event will result is loss of functionality (insertion mark, etc).
			*/
			if (util.isWebkit || prevent) {
				if (prevent) { e.dataTransfer.dropEffect = "none"; } //$NON-NLS-0$
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleDragLeave: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._dropTarget = false;
			if (this.isListening("DragLeave")) { //$NON-NLS-0$
				this.onDragLeave(this._createMouseEvent("DragLeave", e)); //$NON-NLS-0$
			}
		},
		_handleDrop: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._dropTarget = false;
			if (this.isListening("Drop")) { //$NON-NLS-0$
				this.onDrop(this._createMouseEvent("Drop", e)); //$NON-NLS-0$
			}
			/*
			* This event must be prevented otherwise the user agent will modify
			* the DOM. Note that preventing the event on some user agents (i.e. IE)
			* indicates that the operation is cancelled. This causes the dropEffect to 
			* be set to none  in the dragend event causing the implementor to not execute
			* the code responsible by the move effect.
			*/
			if (e.preventDefault) { e.preventDefault(); }
			return false;
		},
		_handleFocus: function () {
			this._hasFocus = true;
			if (util.isIOS && this._lastTouchOffset !== undefined) {
				this.setCaretOffset(this._lastTouchOffset, true);
				this._lastTouchOffset = undefined;
			} else {
				this._updateDOMSelection();
			}
			if (this._cursorDiv) {
				this._cursorDiv.style.display = "block"; //$NON-NLS-0$
			}
			if (this._domSelection) {
				this._domSelection.forEach(function(domSelection) { domSelection.update(); });
			}
			if (!this._ignoreFocus) {
				this.onFocus({type: "Focus"}); //$NON-NLS-0$
			}
		},
		_handleKeyDown: function (e) {
			this._cancelCheckSelection();
			if (this._ignoreEvent(e)) {	return;	}
			if (this.isListening("KeyDown")) { //$NON-NLS-0$
				var keyEvent = this._createKeyEvent("KeyDown", e); //$NON-NLS-0$
				this.onKeyDown(keyEvent); //$NON-NLS-0$
				if (keyEvent.defaultPrevented) {
					/*
					* Feature in Firefox. Keypress events still happen even if the keydown event
					* was prevented. The fix is to remember that keydown was prevented and prevent
					* the keypress ourselves.
					*/
					if (util.isFirefox) {
						this._keyDownPrevented = true;
					}
					e.preventDefault();
					return;
				}
			}
			var modifier = false;
			switch (e.keyCode) {
				case 16: /* Shift */
				case 17: /* Control */
				case 18: /* Alt */
				case 91: /* Command */
					modifier = true;
					break;
				default:
					this._setLinksVisible(false);
			}
			if (e.keyCode === 229) {
				if (this._readonly) {
					if (e.preventDefault) { e.preventDefault(); }
					return false;
				}
				var startIME = true;
				
				/*
				* Bug in Safari. Some Control+key combinations send key events
				* with keyCode equals to 229. This is unexpected and causes the
				* view to start an IME composition. The fix is to ignore these
				* events.
				*/
				if (util.isSafari && util.isMac) {
					if (e.ctrlKey) {
						startIME = false;
						e.keyCode = 0x81;
					}
				}
				if (startIME) {
					this._startIME();
				}
			} else {
				if (!modifier) {
					this._commitIME();
				}
			}
			/*
			* Feature in Firefox. When a key is held down the browser sends 
			* right number of keypress events but only one keydown. This is
			* unexpected and causes the view to only execute an action
			* just one time. The fix is to ignore the keydown event and 
			* execute the actions from the keypress handler.
			* Note: This only happens on the Mac and Linux (Firefox 3.6).
			*
			* Feature in Opera < 12.16.  Opera sends keypress events even for non-printable
			* keys.  The fix is to handle actions in keypress instead of keydown.
			*/
			if (((util.isMac || util.isLinux) && util.isFirefox < 4) || util.isOpera < 12.16) {
				this._keyDownEvent = e;
				return true;
			}
			
			if (this._doAction(e)) {
				if (e.preventDefault) {
					e.preventDefault(); 
					e.stopPropagation(); 
				} else {
					e.cancelBubble = true;
					e.returnValue = false;
					e.keyCode = 0;
				}
				return false;
			}
		},
		_handleKeyPress: function (e) {
			if (this._ignoreEvent(e)) { return; }
			/*
			* Feature in Firefox. Keypress events still happen even if the keydown event
			* was prevented. The fix is to remember that keydown was prevented and prevent
			* the keypress ourselves.
			*/
			if (this._keyDownPrevented) { 
				if (e.preventDefault) {
					e.preventDefault(); 
					e.stopPropagation(); 
				} 
				this._keyDownPrevented = undefined;
				return;
			}
			/*
			* Feature in Embedded WebKit.  Embedded WekKit on Mac runs in compatibility mode and
			* generates key press events for these Unicode values (Function keys).  This does not
			* happen in Safari or Chrome.  The fix is to ignore these key events.
			*/
			if (util.isMac && util.isWebkit) {
				if ((0xF700 <= e.keyCode && e.keyCode <= 0xF7FF) || e.keyCode === 13 || e.keyCode === 8) {
					if (e.preventDefault) { e.preventDefault(); }
					return false;
				}
			}
			if (((util.isMac || util.isLinux) && util.isFirefox < 4) || util.isOpera < 12.16) {
				if (this._doAction(this._keyDownEvent)) {
					if (e.preventDefault) { e.preventDefault(); }
					return false;
				}
			}
			var ctrlKey = util.isMac ? e.metaKey : e.ctrlKey;
			if (e.charCode !== undefined) {
				if (ctrlKey) {
					switch (e.charCode) {
						/*
						* In Firefox and Safari if ctrl+v, ctrl+c ctrl+x is canceled
						* the clipboard events are not sent. The fix to allow
						* the browser to handles these key events.
						*/
						case 99://c
						case 118://v
						case 120://x
							return true;
					}
				}
			}
			if (this.isListening("KeyPress")) { //$NON-NLS-0$
				var keyEvent = this._createKeyEvent("KeyPress", e); //$NON-NLS-0$
				this.onKeyPress(keyEvent); //$NON-NLS-0$
				if (keyEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
			}
			if (this._doAction(e)) {
				if (e.preventDefault) {
					e.preventDefault(); 
					e.stopPropagation(); 
				} else {
					e.cancelBubble = true;
					e.returnValue = false;
					e.keyCode = 0;
				}
				return false;
			}
			var ignore = false;
			if (util.isMac) {
				if (e.ctrlKey || e.metaKey) { ignore = true; }
			} else {
				if (util.isFirefox) {
					//Firefox clears the state mask when ALT GR generates input
					if (e.ctrlKey || e.altKey) { ignore = true; }
				} else {
					//IE and Chrome only send ALT GR when input is generated
					if (e.ctrlKey ^ e.altKey) { ignore = true; }
				}
			}
			if (!ignore) {
				var key = util.isOpera ? e.which : (e.charCode !== undefined ? e.charCode : e.keyCode);
				if (key > 31) {
					this._doContent(String.fromCharCode (key));
					if (e.preventDefault) { e.preventDefault(); }
					return false;
				}
			}
		},
		_handleDocKeyUp: function (e) {
			var ctrlKey = util.isMac ? e.metaKey : e.ctrlKey;
			if (!ctrlKey) {
				this._setLinksVisible(false);
			}
		},
		_handleKeyUp: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (this.isListening("KeyUp")) { //$NON-NLS-0$
				var keyEvent = this._createKeyEvent("KeyUp", e); //$NON-NLS-0$
				this.onKeyUp(keyEvent); //$NON-NLS-0$
				if (keyEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
			}
			this._handleDocKeyUp(e);
			// don't commit for space (it happens during JP composition)  
			if (e.keyCode === 13) {
				this._commitIME();
			}
		},
		_handleLinkClick: function (e) {
			var ctrlKey = util.isMac ? e.metaKey : e.ctrlKey;
			if (!ctrlKey) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleMouse: function (e) {
			var window = this._getWindow();
			var result = true;
			var target = window;
			if (util.isIE || (util.isFirefox && !this._overlayDiv)) { target = this._clientDiv; }
			if (this._overlayDiv) {
				if (this._hasFocus) {
					this._ignoreFocus = true;
				}
				var self = this;
				window.setTimeout(function () {
					self.focus();
					self._ignoreFocus = false;
				}, 0);
			}
			var extend = e.shiftKey;
			var block = e.altKey;
			var add = util.isMac ? e.metaKey : e.ctrlKey;
			this._blockSelection = this._doubleClickSelection = null;
			if (this._clickCount === 1) {
				var drag = (!util.isOpera || util.isOpera >= 12.16) && this._hasFocus && this.isListening("DragStart"); //$NON-NLS-0$
				result = this._setSelectionTo(e.clientX, e.clientY, true, extend, add, drag);
				if (result) { this._setGrab(target); }
			} else {
				/*
				* Feature in IE8 and older, the sequence of events in the IE8 event model
				* for a doule-click is:
				*
				*	down
				*	up
				*	up
				*	dblclick
				*
				* Given that the mouse down/up events are not balanced, it is not possible to
				* grab on mouse down and ungrab on mouse up.  The fix is to grab on the first
				* mouse down and ungrab on mouse move when the button 1 is not set.
				*/
				if (this._isW3CEvents) { this._setGrab(target); }
				
				this._setSelectionTo(e.clientX, e.clientY, true, extend, add, false);
				this._doubleClickSelection = Selection.editing(this._getSelections());
			}
			if (block) {
				this._blockSelection = Selection.editing(this._getSelections());
			}
			return result;
		},
		_handleMouseDown: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (this._linksVisible) {
				var target = e.target || e.srcElement;
				if (target.tagName !== "A") { //$NON-NLS-0$
					this._setLinksVisible(false);
				} else {
					return;
				}
			}
			this._commitIME();

			var button = e.which; // 1 - left, 2 - middle, 3 - right
			if (!button) { 
				// if IE 8 or older
				if (e.button === 4) { button = 2; }
				if (e.button === 2) { button = 3; }
				if (e.button === 1) { button = 1; }
			}

			// For middle click we always need getTime(). See _getClipboardText().
			var time = button !== 2 && e.timeStamp ? e.timeStamp : new Date().getTime();
			var timeDiff = time - this._lastMouseTime;
			var deltaX = Math.abs(this._lastMouseX - e.clientX);
			var deltaY = Math.abs(this._lastMouseY - e.clientY);
			var sameButton = this._lastMouseButton === button;
			this._lastMouseX = e.clientX;
			this._lastMouseY = e.clientY;
			this._lastMouseTime = time;
			this._lastMouseButton = button;

			if (button === 1) {
				this._isMouseDown = true;
				if (sameButton && timeDiff <= this._clickTime && deltaX <= this._clickDist && deltaY <= this._clickDist) {
					this._clickCount++;
				} else {
					this._clickCount = 1;
				}
			}
			if (this.isListening("MouseDown")) { //$NON-NLS-0$
				var mouseEvent = this._createMouseEvent("MouseDown", e); //$NON-NLS-0$
				this.onMouseDown(mouseEvent);
				if (mouseEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
			}
			if (button === 1) {
				if (this._handleMouse(e) && (util.isIE >= 9 || util.isOpera || util.isChrome || util.isSafari || (util.isFirefox && !this._overlayDiv))) {
					if (!this._hasFocus) {
						this.focus();
					}
					e.preventDefault();
				}
			}
			if (util.isFirefox && this._lastMouseButton === 3) {
				// We need to update the DOM selection, because on
				// right-click the caret moves to the mouse location.
				// See bug 366312 and 376508.
				this._updateDOMSelection();
			}
		},
		_handleMouseOver: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (this._animation) { return; }
			if (this.isListening("MouseOver")) { //$NON-NLS-0$
				this.onMouseOver(this._createMouseEvent("MouseOver", e)); //$NON-NLS-0$
			}
		},
		_handleMouseOut: function (e) {
			if (this._ignoreEvent(e)) { return; }
			if (this._animation) { return; }
			if (this.isListening("MouseOut")) { //$NON-NLS-0$
				this.onMouseOut(this._createMouseEvent("MouseOut", e)); //$NON-NLS-0$
			}
		},
		_handleMouseMove: function (e) {
			if (this._animation) { return; }
			var inClient = this._isClientDiv(e);
			if (this.isListening("MouseMove")) { //$NON-NLS-0$
				if (inClient || this._isMouseDown){
					var mouseEvent = this._createMouseEvent("MouseMove", e); //$NON-NLS-0$
					this.onMouseMove(mouseEvent);
					if (mouseEvent.defaultPrevented) {
						e.preventDefault();
						return;
					}
				}
			}
			if (this._dropTarget) {
				return;
			}
			/*
			* Bug in IE9. IE sends one mouse event when the user changes the text by
			* pasting or undo.  These operations usually happen with the Ctrl key
			* down which causes the view to enter link mode.  Link mode does not end
			* because there are no further events.  The fix is to only enter link
			* mode when the coordinates of the mouse move event have changed.
			*/
			var changed = this._linksVisible || this._lastMouseMoveX !== e.clientX || this._lastMouseMoveY !== e.clientY;
			this._lastMouseMoveX = e.clientX;
			this._lastMouseMoveY = e.clientY;
			this._setLinksVisible(changed && !this._isMouseDown && e.altKey && (util.isMac ? e.metaKey : e.ctrlKey));

			this._checkOverlayScroll();

			/*
			* Feature in IE8 and older, the sequence of events in the IE8 event model
			* for a doule-click is:
			*
			*	down
			*	up
			*	up
			*	dblclick
			*
			* Given that the mouse down/up events are not balanced, it is not possible to
			* grab on mouse down and ungrab on mouse up.  The fix is to grab on the first
			* mouse down and ungrab on mouse move when the button 1 is not set.
			*
			* In order to detect double-click and drag gestures, it is necessary to send
			* a mouse down event from mouse move when the button is still down and isMouseDown
			* flag is not set.
			*/
			if (!this._isW3CEvents) {
				if (e.button === 0) {
					this._setGrab(null);
					return true;
				}
				if (!this._isMouseDown && e.button === 1 && (this._clickCount & 1) !== 0 && inClient) {
					this._clickCount = 2;
					return this._handleMouse(e, this._clickCount);
				}
			}
			if (!this._isMouseDown || this._dragOffset !== -1) {
				return;
			}
			
			var x = e.clientX;
			var y = e.clientY;
			var viewPad = this._getViewPadding();
			var viewRect = this._viewDiv.getBoundingClientRect();
			var width = this._getClientWidth (), height = this._getClientHeight();
			var leftEdge = viewRect.left + viewPad.left;
			var topEdge = viewRect.top + viewPad.top;
			var rightEdge = viewRect.left + viewPad.left + width;
			var bottomEdge = viewRect.top + viewPad.top + height;
			if (y < topEdge) {
				this._doAutoScroll("up", x, y - topEdge); //$NON-NLS-0$
			} else if (y > bottomEdge) {
				this._doAutoScroll("down", x, y - bottomEdge); //$NON-NLS-0$
			} else if (x < leftEdge && !this._wrapMode) {
				this._doAutoScroll("left", x - leftEdge, y); //$NON-NLS-0$
			} else if (x > rightEdge && !this._wrapMode) {
				this._doAutoScroll("right", x - rightEdge, y); //$NON-NLS-0$
			} else {
				this._endAutoScroll();
				this._setSelectionTo(x, y, false, true);
			}
		},
		_isClientDiv: function(e) {
			var topNode = this._overlayDiv || this._clientDiv;
			var temp = e.target ? e.target : e.srcElement;
			while (temp) {
				if (topNode === temp) {
					return true;
				}
				temp = temp.parentNode;
			}
			return false;
		},
		_createKeyEvent: function(type, e) {
			return {
				type: type,
				event: e,
				preventDefault: function() {
					this.defaultPrevented = true;
				}
			};
		},
		_createMouseEvent: function(type, e) {
			var pt = this.convert({x: e.clientX, y: e.clientY}, "page", "document"); //$NON-NLS-1$ //$NON-NLS-0$
			return {
				type: type,
				event: e,
				clickCount: this._clickCount,
				x: pt.x,
				y: pt.y,
				preventDefault: function() {
					this.defaultPrevented = true;
				}
			};
		},
		_createTouchEvent: function(type, e) {
			var pt = e.touches.length ? this.convert({x: e.touches[0].clientX, y: e.touches[0].clientY}, "page", "document") : {}; //$NON-NLS-1$ //$NON-NLS-0$
			return {
				type: type,
				event: e,
				touchCount: e.touches.length,
				x: pt.x,
				y: pt.y,
				preventDefault: function() {
					this.defaultPrevented = true;
				}
			};
		},
		_handleMouseUp: function (e) {
			var left = e.which ? e.button === 0 : e.button === 1;
			if (this.isListening("MouseUp")) { //$NON-NLS-0$
				if (this._isClientDiv(e) || (left && this._isMouseDown)) {
					var mouseEvent = this._createMouseEvent("MouseUp", e); //$NON-NLS-0$
					this.onMouseUp(mouseEvent);
					if (mouseEvent.defaultPrevented) {
						e.preventDefault();
						this._isMouseDown = false;
						return;
					}
				}
			}
			if (this._linksVisible) {
				return;
			}
			if (left && this._isMouseDown) {
				var selections = this._getSelections();
				var selection = Selection.editing(selections);
				selections.forEach(function(sel) {
					sel._editing = false;
				});
				if (this._dragOffset !== -1) {
					selection.extend(this._dragOffset);
					selection.collapse();
					selections = selection;
					this._dragOffset = -1;
				}
				this._setSelection(selections, false);
				this._isMouseDown = false;
				this._endAutoScroll();
				
				/*
				* Feature in IE8 and older, the sequence of events in the IE8 event model
				* for a doule-click is:
				*
				*	down
				*	up
				*	up
				*	dblclick
				*
				* Given that the mouse down/up events are not balanced, it is not possible to
				* grab on mouse down and ungrab on mouse up.  The fix is to grab on the first
				* mouse down and ungrab on mouse move when the button 1 is not set.
				*/
				if (this._isW3CEvents) { this._setGrab(null); }
			}
			/*
			* Note that there cases when Firefox sets the DOM selection in mouse up.
			* This happens for example after a cancelled drag operation.
			*
			* Note that on Chrome and IE, the caret stops blicking if mouse up is
			* prevented.
			*/
			if (left && util.isFirefox) {
				this._updateDOMSelection();
				e.preventDefault();
			}
		},
		_handleMouseWheel: function (e) {
			if (this._noScroll) return;
			var lineHeight = this._getLineHeight();
			var pixelX = 0, pixelY = 0;
			// Note: On the Mac the correct behaviour is to scroll by pixel.
			if (util.isIE || util.isOpera) {
				pixelY = (-e.wheelDelta / 40) * lineHeight;
			} else if (util.isFirefox) {
				var limit = 256;
				if (e.type === "wheel") { //$NON-NLS-0$
					if (e.deltaMode) { // page or line
						pixelX = Math.max(-limit, Math.min(limit, e.deltaX)) * lineHeight;
						pixelY = Math.max(-limit, Math.min(limit, e.deltaY)) * lineHeight;
					} else {
						pixelX = e.deltaX;
						pixelY = e.deltaY;
					}
				} else {
					var pixel;
					if (util.isMac) {
						pixel = e.detail * 3;
					} else {
						pixel = Math.max(-limit, Math.min(limit, e.detail)) * lineHeight;
					}
					if (e.axis === e.HORIZONTAL_AXIS) {
						pixelX = pixel;
					} else {
						pixelY = pixel;
					}
				}
			} else {
				//Webkit
				if (util.isMac) {
					/*
					* In Safari, the wheel delta is a multiple of 120. In order to
					* convert delta to pixel values, it is necessary to divide delta
					* by 40.
					*
					* In Chrome and Safari 5, the wheel delta depends on the type of the
					* mouse. In general, it is the pixel value for Mac mice and track pads,
					* but it is a multiple of 120 for other mice. There is no presise
					* way to determine if it is pixel value or a multiple of 120.
					* 
					* Note that the current approach does not calculate the correct
					* pixel value for Mac mice when the delta is a multiple of 120.
					*
					* For values that are multiples of 120, the denominator varies on
					* the time between events.
					*/
					var denominatorX, denominatorY;
					var deltaTime = e.timeStamp - this._wheelTimeStamp;
					this._wheelTimeStamp = e.timeStamp;
					if (e.wheelDeltaX % 120 !== 0) { 
						denominatorX = 1; 
					} else {
						denominatorX = deltaTime < 40 ? 40/(40-deltaTime) : 40;
					}
					if (e.wheelDeltaY % 120 !== 0) { 
						denominatorY = 1; 
					} else {
						denominatorY = deltaTime < 40 ? 40/(40-deltaTime) : 40; 
					}
					pixelX = Math.ceil(-e.wheelDeltaX / denominatorX);
					if (-1 < pixelX && pixelX < 0) { pixelX = -1; }
					if (0 < pixelX && pixelX < 1) { pixelX = 1; }
					pixelY = Math.ceil(-e.wheelDeltaY / denominatorY);
					if (-1 < pixelY && pixelY < 0) { pixelY = -1; }
					if (0 < pixelY && pixelY < 1) { pixelY = 1; }
				} else {
					pixelX = -e.wheelDeltaX;
					var linesToScroll = 8;
					pixelY = (-e.wheelDeltaY / 120 * linesToScroll) * lineHeight;
				}
			}
			/* 
			* Feature in Safari. If the event target is removed from the DOM 
			* safari stops smooth scrolling. The fix is keep the element target
			* in the DOM and remove it on a later time. 
			*
			* Note: Using a timer is not a solution, because the timeout needs to
			* be at least as long as the gesture (which is too long).
			*/
			if (util.isSafari || (util.isChrome && util.isMac)) {
				var lineDiv = e.target;
				while (lineDiv && lineDiv.lineIndex === undefined) {
					lineDiv = lineDiv.parentNode;
				}
				this._mouseWheelLine = lineDiv;
			}
			var oldScroll = this._getScroll();
			this._scrollView(pixelX, pixelY);
			var newScroll = this._getScroll();
			if (oldScroll.x !== newScroll.x || oldScroll.y !== newScroll.y) {
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handlePaste: function (e) {
			this._cancelCheckSelection();
			if (this._ignoreEvent(e)) { return; }
			if (this._ignorePaste) { return; }
			if (this._doPaste(e)) {
				if (util.isIE) {
					/*
					 * Bug in IE,  
					 */
					var self = this;
					this._ignoreFocus = true;
					var window = this._getWindow();
					window.setTimeout(function() {
						self._updateDOMSelection();
						self._ignoreFocus = false;
					}, 0);
				}
				if (e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_handleResize: function () {
			var newWidth = this._rootDiv.clientWidth;
			var newHeight = this._rootDiv.clientHeight;
			if (this._rootWidth !== newWidth || this._rootHeight !== newHeight) {
				if (this._rootWidth !== newWidth && this._wrapMode) {
					this._resetLineHeight();
				}
				this._rootWidth = newWidth;
				this._rootHeight = newHeight;
				/*
				* Feature in IE7. For some reason, sometimes Internet Explorer 7 
				* returns incorrect values for element.getBoundingClientRect() when 
				* inside a resize handler. The fix is to queue the work.
				*/			
				var queue = util.isIE < 9;

				/*
				* The calculated metrics may be out of date when the zoom level changes.
				*/
				var metrics = this._calculateMetrics();
				if (!compare(metrics, this._metrics)) {
					if (this._variableLineHeight) {
						this._variableLineHeight = false;
						this._resetLineHeight();
					}
					this._metrics = metrics;
					queue = true;
				}

				if (queue) {
					this._queueUpdate();
				} else {
					this._update();
				}
				this.dispatchEvent({type: "Resize"}); //$NON-NLS-0$
			}
		},
		_handleRulerEvent: function (e) {
			var target = e.target ? e.target : e.srcElement;
			var lineIndex = target.lineIndex;
			var element = target;
			while (element && !element._ruler) {
				if (lineIndex === undefined && element.lineIndex !== undefined) {
					lineIndex = element.lineIndex;
				}
				element = element.parentNode;
			}
			var ruler = element ? element._ruler : null;
			if (lineIndex === undefined && ruler && ruler.getOverview() === "document") { //$NON-NLS-0$
				var clientHeight = this._getClientHeight ();
				var lineCount = this._model.getLineCount ();
				var viewPad = this._getViewPadding();
				var viewRect = this._viewDiv.getBoundingClientRect();
				var lineHeight = this._getLineHeight();
				var contentHeight = lineHeight * lineCount;
				var trackHeight = clientHeight + viewPad.top + viewPad.bottom - 2 * this._metrics.scrollWidth;
				var divHeight, arrowWidth;
				if (contentHeight < trackHeight) {
					divHeight = lineHeight;
					arrowWidth = viewPad.top;
				} else {
					divHeight = trackHeight / lineCount;
					arrowWidth = this._metrics.scrollWidth;
				}
				lineIndex = Math.floor(((e.clientY - viewRect.top) - arrowWidth) / divHeight);
				if (!(0 <= lineIndex && lineIndex < lineCount)) {
					lineIndex = undefined;
				}
			}
			if (ruler) {
				switch (e.type) {
					case "click": //$NON-NLS-0$
						if (ruler.onClick) { ruler.onClick(lineIndex, e); }
						break;
					case "dblclick": //$NON-NLS-0$
						if (ruler.onDblClick) { ruler.onDblClick(lineIndex, e); }
						break;
					case "mousemove": //$NON-NLS-0$
						if (ruler.onMouseMove) { ruler.onMouseMove(lineIndex, e); }
						break;
					case "mouseover": //$NON-NLS-0$
						if (ruler.onMouseOver) { ruler.onMouseOver(lineIndex, e); }
						break;
					case "mouseout": //$NON-NLS-0$
						if (ruler.onMouseOut) { 
							var tmp = e.relatedTarget;
							while (tmp && tmp !== this._rootDiv) {
								if (tmp === element) {
									return;
								}
								tmp = tmp.parentNode;
							}
							ruler.onMouseOut(lineIndex, e); 
						}
						break;
				}
			}
		},
		_handleScroll: function () {
			this._lastScrollTime = new Date().getTime();
			var scroll = this._getScroll(false);
			var oldX = this._hScroll;
			var oldY = this._vScroll;
			if (oldX !== scroll.x || oldY !== scroll.y) {
				this._hScroll = scroll.x;
				this._vScroll = scroll.y;
				this._commitIME();
				this._update(oldY === scroll.y);
				var e = {
					type: "Scroll", //$NON-NLS-0$
					oldValue: {x: oldX, y: oldY},
					newValue: scroll
				};
				this.onScroll(e);
			}
		},
		_handleSelectStart: function (e) {
			var menuOpen = this._contextMenuOpen;
			this._contextMenuOpen = false;
			if (menuOpen) {
				this._checkSelectionChange = true;
				return;
			}
			if (this._ignoreSelect) {
				if (e && e.preventDefault) { e.preventDefault(); }
				return false;
			}
		},
		_getModelOffset: function(node, offset) {
			if (!node) { return; }
			var lineNode;
			if (node.tagName === "DIV") { //$NON-NLS-0$
				lineNode = node;
			} else {
				lineNode = node.parentNode.parentNode;
			}
			if (!lineNode._line) {
				return 0;
			}
			return lineNode._line.getModelOffset (node, offset);
		},
		_updateSelectionFromDOM: function() {
			if (!(util.isIOS || util.isAndroid || this._checkSelectionChange)) {
				return false;
			}
			var window = this._getWindow();
			var selection = window.getSelection();
			var start = this._getModelOffset(selection.anchorNode, selection.anchorOffset);
			var end = this._getModelOffset(selection.focusNode, selection.focusOffset);
			var sel = this._getSelections()[0];
			if (start === undefined || end === undefined || (sel.start === start && sel.end === end)) {
				return false;
			}
			
			if (this._checkSelectionChange) {
				var firstLine = this._getLineNext();
				var lastLine = this._getLinePrevious();
				
				// Selection is unchanged and bigger than the visible buffer region
				if (selection.anchorNode === firstLine.firstChild.firstChild && selection.anchorOffset === 0 &&
					selection.focusNode === lastLine.firstChild.firstChild && selection.focusOffset === 0)
				{
					return false;
				}
				
				// Detect select all
				if (
				(selection.anchorNode === firstLine.firstChild.firstChild && selection.anchorOffset === 0 && selection.focusNode === lastLine.lastChild.firstChild)
				|| (selection.anchorNode === this._clientDiv && selection.focusNode === this._clientDiv)
				) {
					start = 0;
					end = this.getModel().getCharCount();
				}
			}
			
			this._setSelection(new Selection(start, end), false, false);
			this._checkSelectionChange = false;
			return true;
		},
		_cancelCheckSelection: function() {
			if (this._checkSelectionChange) {
				this._checkSelectionChange = false;
				this._cancelPollSelectionChange();
			}
		},
		_cancelPollSelectionChange: function() {
			if (this._selPollTimer) {
				var window = this._getWindow();
				window.clearTimeout(this._selPollTimer);
				this._selPollTimer = null; 
			}
		},
		_pollSelectionChange: function(retryPoll) {
			var that = this;
			var window = this._getWindow();
			this._cancelPollSelectionChange();
			this._selPollTimer = window.setTimeout(function() {
				that._selPollTimer = null; 
				if (!that._clientDiv) { return; }
				var changed = that._updateSelectionFromDOM();
				if (!changed && retryPoll) {
					that._pollSelectionChange(retryPoll);
				}
			}, 100);
		},
		_handleSelectionChange: function () {
			if (this._imeOffset !== -1) {
				return;
			}
			/*
			 * Feature in Android. The selection handles are hidden when the DOM changes. Sending
			 * selection events to the application while the user is moving the selection handles
			 * may hide the handles unexpectedly.  The fix is to delay updating the selection and
			 * sending the event to the application.
			 */
			if (util.isAndroid) {
				this._pollSelectionChange();
			} else {
				this._updateSelectionFromDOM();
			}
		},
		_handleTextInput: function (e) {
			if (this._ignoreEvent(e)) { return; }
			this._imeOffset = -1;
			var selection = this._getWindow().getSelection();
			if (
				selection.anchorNode !== this._anchorNode || selection.focusNode !== this._focusNode ||
				selection.anchorOffset !== this._anchorOffset || selection.focusOffset !== this._focusOffset
			) {
				var temp = selection.anchorNode;
				while (temp) {
					if (temp.lineIndex !== undefined) {
						break;
					}
					temp = temp.parentNode;
				}
				if (temp) {
					var model = this._model;
					var lineIndex = temp.lineIndex;
					var oldText = model.getLine(lineIndex), text = oldText;
					var offset = 0;
					var lineStart = model.getLineStart(lineIndex);
					if (selection.rangeCount > 0) {
						selection.getRangeAt(0).deleteContents();
						var node = temp.ownerDocument.createTextNode(e.data);
						selection.getRangeAt(0).insertNode(node);
						var nodeText = this._getDOMText(temp, node);
						text = nodeText.text;
						offset = nodeText.offset;
						node.parentNode.removeChild(node);
					}
					temp.lineRemoved = true;
					
					var start = 0;
					while (oldText.charCodeAt(start) === text.charCodeAt(start) && start < offset) {
						start++;
					}
		
					var end = oldText.length - 1, delta = text.length - oldText.length;
					while (oldText.charCodeAt(end) === text.charCodeAt(end + delta) && end + delta >= offset + e.data.length) {
						end--;
					}
					end++;
					
					var deltaText = text.substring(start, end + delta);
					start += lineStart;
					end += lineStart;
					
					var selections = this._getSelections();
					var deltaStart = selections[0].start - start;
					var deltaEnd = selections[0].end - end;
					selections[0].start = start;
					selections[0].end = end;
					for (var i=1; i<selections.length; i++) {
						selections[i].start -= deltaStart;
						selections[i].end -= deltaEnd;
					}
					this._ignoreQueueUpdate = util.isSafari;
					this._modifyContent({text: deltaText, selection: selections, _ignoreDOMSelection: true}, true);
					this._ignoreQueueUpdate = false;
				}
			} else {
				this._doContent(e.data);
			}
			e.preventDefault();
		},
		_handleTouchStart: function (e) {
			if (this.isListening("TouchStart")) { //$NON-NLS-0$
				var touchEvent = this._createTouchEvent("TouchStart", e); //$NON-NLS-0$
				this.onTouchStart(touchEvent);
				if (touchEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
				if (this._noScroll) {
					return;
				}
			}
			this._commitIME();
			var window = this._getWindow();
			if (this._touchScrollTimer) {
				this._vScrollDiv.style.display = "none"; //$NON-NLS-0$
				this._hScrollDiv.style.display = "none"; //$NON-NLS-0$
				window.clearInterval(this._touchScrollTimer);
				this._touchScrollTimer = null;
			}
			var touches = e.touches;
			if (touches.length === 1) {
				var touch = touches[0];
				var x = touch.clientX, y = touch.clientY;
				this._touchStartX = x;
				this._touchStartY = y;
				if (util.isAndroid) {
					/*
					* Bug in Android 4.  The clientX/Y coordinates of the touch events
					* include the page scrolling offsets.
					*/
				    if (y < (touch.pageY - window.pageYOffset) || x < (touch.pageX - window.pageXOffset) ) {
						x = touch.pageX - window.pageXOffset;
						y = touch.pageY - window.pageYOffset;
				    }
				}
				var pt = this.convert({x: x, y: y}, "page", "document"); //$NON-NLS-1$ //$NON-NLS-0$
				this._lastTouchOffset = this.getOffsetAtLocation(pt.x, pt.y);
				this._touchStartTime = e.timeStamp;
				this._touching = true;
			}
		},
		_handleTouchMove: function (e) {
			if (this.isListening("TouchMove")) { //$NON-NLS-0$
				var touchEvent = this._createTouchEvent("TouchMove", e); //$NON-NLS-0$
				this.onTouchMove(touchEvent);
				if (touchEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
				if (this._noScroll) {
					return;
				}
			}
			var touches = e.touches;
			if (touches.length === 1) {
				var touch = touches[0];
				this._touchCurrentX = touch.clientX;
				this._touchCurrentY = touch.clientY;
				var interval = 10;
				if (!this._touchScrollTimer && (e.timeStamp - this._touchStartTime) < (interval*20)) {
					this._vScrollDiv.style.display = "block"; //$NON-NLS-0$
					if (!this._wrapMode) {
						this._hScrollDiv.style.display = "block"; //$NON-NLS-0$
					}
					var self = this;
					var window = this._getWindow();
					this._touchScrollTimer = window.setInterval(function() {
						var deltaX = 0, deltaY = 0;
						if (self._touching) {
							deltaX = self._touchStartX - self._touchCurrentX;
							deltaY = self._touchStartY - self._touchCurrentY;
							self._touchSpeedX = deltaX / interval;
							self._touchSpeedY = deltaY / interval;
							self._touchStartX = self._touchCurrentX;
							self._touchStartY = self._touchCurrentY;
						} else {
							if (Math.abs(self._touchSpeedX) < 0.1 && Math.abs(self._touchSpeedY) < 0.1) {
								self._vScrollDiv.style.display = "none"; //$NON-NLS-0$
								self._hScrollDiv.style.display = "none"; //$NON-NLS-0$
								window.clearInterval(self._touchScrollTimer);
								self._touchScrollTimer = null;
								return;
							} else {
								deltaX = self._touchSpeedX * interval;
								deltaY = self._touchSpeedY * interval;
								self._touchSpeedX *= 0.95;
								self._touchSpeedY *= 0.95;
							}
						}
						self._scrollView(deltaX, deltaY);
					}, interval);
				}
				if (this._touchScrollTimer) {
					e.preventDefault();
				}
			}
		},
		_handleTouchEnd: function (e) {
			if (this.isListening("TouchEnd")) { //$NON-NLS-0$
				var touchEvent = this._createTouchEvent("TouchEnd", e); //$NON-NLS-0$
				this.onTouchEnd(touchEvent);
				if (touchEvent.defaultPrevented) {
					e.preventDefault();
					return;
				}
				if (this._noScroll) {
					return;
				}
			}
			var touches = e.touches;
			if (touches.length === 0) {
				this._touching = false;
			}
		},

		/************************************ Actions ******************************************/
		_doAction: function (e) {
			var mode, i;
			var keyModes = this._keyModes;
			for (i = keyModes.length - 1 ; i >= 0; i--) {
				mode = keyModes[i];
				if (typeof mode.match === "function") { //$NON-NLS-0$
					var actionID = mode.match(e);
					if (actionID !== undefined) {
						return this.invokeAction(actionID);
					}
				}
			}
			return false;
		},
		_doMove: function(args, selection) {
			var model = this._model;
			var caret = selection.getCaret();
			var lineIndex = model.getLineAtOffset(caret);
			if (!args.count) {
				args.count = 1;
			}
			while (args.count !== 0) {
				var lineStart = model.getLineStart(lineIndex);
				if (args.count < 0 && caret === lineStart) {
					if (lineIndex > 0) {
						if (args.unit === "character") { //$NON-NLS-0$
							args.count++;
						}
						lineIndex--;
						selection.extend(model.getLineEnd(lineIndex));
					} else {
						break;
					}
				} else if (args.count > 0 && caret === model.getLineEnd(lineIndex)) {
					if (lineIndex + 1 < model.getLineCount()) {
						if (args.unit === "character") { //$NON-NLS-0$
							args.count--;
						}
						lineIndex++;
						selection.extend(model.getLineStart(lineIndex));
					} else {
						break;
					}
				} else {
					var removeTab = false;
					if (args.expandTab && args.unit === "character" && (caret - lineStart) % this._tabSize === 0) { //$NON-NLS-0$
						var lineText = model.getText(lineStart, caret);
						removeTab = !/[^ ]/.test(lineText); // Only spaces between line start and caret.
					}
					if (removeTab) {
						selection.extend(caret - this._tabSize);
						args.count += args.count < 0 ? 1 : -1;
					} else {
						var line = this._getLine(lineIndex);
						selection.extend(line.getNextOffset(caret, args));
						line.destroy();
					}
				}
				caret = selection.getCaret();
			}
			return selection;
		},
		_doBackspace: function (args) {
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (selection.isEmpty()) {
					if (!args.count) {
						args.count = 1;
					}
					args.count *= -1;
					args.expandTab = self._expandTab;
					self._doMove(args, selection);
				}
			});
			this._modifyContent({text: "", selection: selections}, true);
			return true;
		},
		_doCase: function (args) {
			var self = this;
			var selections = this._getSelections();
			var changes = [];
			selections.forEach(function(selection) {
				self._doMove(args, selection);
				var text = self.getText(selection.start, selection.end);
				switch (args.type) {
					case "lower": text = text.toLowerCase(); break; //$NON-NLS-0$
					case "capitalize": text = text.replace(/(?:^|\s)\S/g, function(a) { return a.toUpperCase(); }); break; //$NON-NLS-0$
					case "reverse":  //$NON-NLS-0$
						var newText = "";
						for (var i=0; i<text.length; i++) {
							var s = text[i];
							var l = s.toLowerCase();
							if (l !== s) {
								s = l;
							} else {
								s = s.toUpperCase();
							}
							newText += s;
						} 
						text = newText;
						break;
					default: text = text.toUpperCase(); break;
				}
				changes.push(text);
			});
			return this._modifyContent({text: changes, selection: selections, _ignoreDOMSelection: true}, true);
		},
		_doContent: function (text) {
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (self._overwriteMode && selection.isEmpty()) {
					var model = self._model;
					var lineIndex = model.getLineAtOffset(selection.end);
					if (selection.end < model.getLineEnd(lineIndex)) {
						var line = self._getLine(lineIndex);
						selection.extend(line.getNextOffset(selection.getCaret(), {unit:"character", count:1})); //$NON-NLS-0$
						line.destroy();
					}
				}
			});
			return this._modifyContent({text: text, selection: selections, _ignoreDOMSelection: true}, true);
		},
		_doCopy: function (e) {
			var text = this.getSelectionText();
			if (text) {
				return this._setClipboardText(text, e);
			}
			return true;
		},
		_doCursorNext: function (args) {
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (!selection.isEmpty() && !args.select) {
					selection.start = selection.end;
				} else {
					self._doMove(args, selection);
				}
				if (!args.select) { selection.collapse(); }
			});
			this._setSelection(selections, true);
			return true;
		},
		_doCursorPrevious: function (args) {
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (!selection.isEmpty() && !args.select) {
					selection.end = selection.start;
				} else {
					if (!args.count) {
						args.count = 1;
					}
					args.count *= -1;
					self._doMove(args, selection);
				}
				if (!args.select) { selection.collapse(); }
			});
			this._setSelection(selections, true);
			return true;
		},
		_doCut: function (e) {
			var text = this.getSelectionText();
			if (text) {
				this._doContent("");
				return this._setClipboardText(text, e);
			}
			return true;
		},
		_doDelete: function (args) {
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (selection.isEmpty()) {
					self._doMove(args, selection);
				}
			});
			this._modifyContent({text: "", selection: selections}, true);
			return true;
		},
		_doEnd: function (args) {
			var model = this._model;
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (args.ctrl) {
					selection.extend(model.getCharCount());
				} else {
					var offset = selection.getCaret();
					var lineIndex = model.getLineAtOffset(offset);
					if (self._wrapMode) {
						var line = self._getLine(lineIndex);
						var visualIndex = line.getLineIndex(offset);
						if (visualIndex === line.getLineCount() - 1) {
							offset = model.getLineEnd(lineIndex);
						} else {
							offset = line.getLineStart(visualIndex + 1) - 1;
						}
						line.destroy();
					} else {
						if (args.count && args.count > 0) {
							lineIndex = Math.min (lineIndex  + args.count - 1, model.getLineCount() - 1);
						}
						offset = model.getLineEnd(lineIndex);
					}
					selection.extend(offset);
				}
				if (!args.select) { selection.collapse(); }
			});
			this._setSelection(selections, true, true, args.ctrl ? function() {} : null);
			return true;
		},
		_doEnter: function (args) {
			if (this._singleMode) return true;
			var model = this._model;
			var selections = this._getSelections();
			this._doContent(model.getLineDelimiter()); 
			if (args && args.noCursor) {
				selections.forEach(function(selection) {
					selection.end = selection.start;
				});
				this._setSelection(selections, true);
			}
			return true;
		},
		_doEscape: function () {
			var selections = this._getSelections();
			if (selections.length > 1) {
				this._setSelection(selections[0], true);
			}
			return true;
		},
		_doHome: function (args) {
			var model = this._model;
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (args.ctrl) {
					selection.extend(0);
				} else {
					var offset = selection.getCaret();
					var lineIndex = model.getLineAtOffset(offset);
					if (self._wrapMode) {
						var line = self._getLine(lineIndex);
						var visualIndex = line.getLineIndex(offset);
						offset = line.getLineStart(visualIndex);
						line.destroy();
					} else {
						offset = model.getLineStart(lineIndex);
					}
					selection.extend(offset); 
				}
				if (!args.select) { selection.collapse(); }
			});
			this._setSelection(selections, true, true, args.ctrl ? function() {} : null);
			return true;
		},
		_doLineDown: function (args) {
			var model = this._model;
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				var caret = selection.getCaret();
				var lineIndex = model.getLineAtOffset(caret), visualIndex;
				var line = self._getLine(lineIndex);
				var x = selection._columnX, y = 1, lastLine = false;
				if (x === -1 || args.wholeLine || (args.select && util.isIE)) {
					var offset = args.wholeLine ? model.getLineEnd(lineIndex + 1) : caret;
					x = selection._columnX = line.getBoundingClientRect(offset).left;
				}
				if ((visualIndex = line.getLineIndex(caret)) < line.getLineCount() - 1) {
					y = line.getClientRects(visualIndex + 1).top + 1;
				} else {
					var lastLineCount = model.getLineCount() - 1;
					lastLine = lineIndex === lastLineCount;
					if (args.count && args.count > 0) {
						lineIndex = Math.min (lineIndex + args.count, lastLineCount);
					} else {
						lineIndex++;
					}
				}
				var select = false;
				if (lastLine) {
					if (args.select || (util.isMac || util.isLinux)) {
						selection.extend(model.getCharCount());
						select = true;
					}
				} else {
					if (line.lineIndex !== lineIndex) {
						line.destroy();
						line = self._getLine(lineIndex);
					}
					selection.extend(line.getOffset(x, y));
					select = true;
				}
				if (select) {
					if (!args.select) { selection.collapse(); }
				}
				line.destroy();
			});
			self._setSelection(selections, true, true, null, 0, false, true);
			return true;
		},
		_doLineUp: function (args) {
			var model = this._model;
			var self = this;
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				var caret = selection.getCaret();
				var lineIndex = model.getLineAtOffset(caret), visualIndex;
				var line = self._getLine(lineIndex);
				var x = selection._columnX, firstLine = false, y;
				if (x === -1 || args.wholeLine || (args.select && util.isIE)) {
					var offset = args.wholeLine ? model.getLineStart(lineIndex - 1) : caret;
					x = selection._columnX = line.getBoundingClientRect(offset).left;
				}
				if ((visualIndex = line.getLineIndex(caret)) > 0) {
					y = line.getClientRects(visualIndex - 1).top + 1;
				} else {
					firstLine = lineIndex === 0;
					if (!firstLine) {
						if (args.count && args.count > 0) {
							lineIndex = Math.max (lineIndex - args.count, 0);
						} else {
							lineIndex--;
						}
						y = self._getLineHeight(lineIndex) - 1;
					}
				}
				var select = false;
				if (firstLine) {
					if (args.select || (util.isMac || util.isLinux)) {
						selection.extend(0);
						select = true;
					}
				} else {
					if (line.lineIndex !== lineIndex) {
						line.destroy();
						line = self._getLine(lineIndex);
					}
					selection.extend(line.getOffset(x, y));
					select = true;
				}
				if (select) {
					if (!args.select) { selection.collapse(); }
				}
				line.destroy();
			});
			self._setSelection(selections, true, true, null, 0, false, true);
			return true;
		},
		_doNoop: function () {
			return true;
		},
		_doPageDown: function (args) {
			var self = this;
			var model = this._model;
			var selections = this._getSelections();
			var lineCount = model.getLineCount();
			var scroll = this._getScroll();
			var clientHeight = this._getClientHeight();
			var lineHeight = this._getLineHeight();
			var lines = Math.floor(clientHeight / lineHeight);
			var x, line, pageScroll;
			selections.forEach(function(selection) {
				var caret = selection.getCaret();
				var caretLine = model.getLineAtOffset(caret);
				if (self._lineHeight) {
					x = selection._columnX;
					var caretRect = self._getBoundsAtOffset(caret);
					if (x === -1 || (args.select && util.isIE)) {
						x = selection._columnX = caretRect.left;
					}
					var lineIndex = self._getLineIndex(caretRect.top + clientHeight);
					line = self._getLine(lineIndex);
					var linePixel = self._getLinePixel(lineIndex);
					var y = caretRect.top + clientHeight - linePixel;
					caret = line.getOffset(x, y);
					var rect = line.getBoundingClientRect(caret);
					line.destroy();
					selection.extend(caret);
					if (!args.select) { selection.collapse(); }
					pageScroll = pageScroll !== undefined ? Math.min(pageScroll, rect.top + linePixel - caretRect.top) : rect.top + linePixel - caretRect.top;
				} else {
					if (caretLine < lineCount - 1) {
						var scrollLines = Math.min(lineCount - caretLine - 1, lines);
						scrollLines = Math.max(1, scrollLines);
						x = selection._columnX;
						if (x === -1 || (args.select && util.isIE)) {
							line = self._getLine(caretLine);
							x = selection._columnX = line.getBoundingClientRect(caret).left;
							line.destroy();
						}
						line = self._getLine(caretLine + scrollLines);
						selection.extend(line.getOffset(x, 0));
						line.destroy();
						if (!args.select) { selection.collapse(); }
						var verticalMaximum = lineCount * lineHeight;
						var scrollOffset = scroll.y + scrollLines * lineHeight;
						if (scrollOffset + clientHeight > verticalMaximum) {
							scrollOffset = verticalMaximum - clientHeight;
						}
						pageScroll = pageScroll !== undefined ? Math.min(pageScroll, scrollOffset - scroll.y) : scrollOffset - scroll.y;
					}
				}
			});
			this._setSelection(selections, true, true, function() {}, pageScroll, false, true);
			return true;
		},
		_doPageUp: function (args) {
			var self = this;
			var model = this._model;
			var selections = this._getSelections();
			var scroll = this._getScroll();
			var clientHeight = this._getClientHeight();
			var lineHeight = this._getLineHeight();
			var lines = Math.floor(clientHeight / lineHeight);
			var x, line, pageScroll;
			selections.forEach(function(selection) {
				var caret = selection.getCaret();
				var caretLine = model.getLineAtOffset(caret);
				if (self._lineHeight) {
					x = selection._columnX;
					var caretRect = self._getBoundsAtOffset(caret);
					if (x === -1 || (args.select && util.isIE)) {
						x = selection._columnX = caretRect.left;
					}
					var lineIndex = self._getLineIndex(caretRect.bottom - clientHeight);
					line = self._getLine(lineIndex);
					var linePixel = self._getLinePixel(lineIndex);
					var y = (caretRect.bottom - clientHeight) - linePixel;
					caret = line.getOffset(x, y);
					var rect = line.getBoundingClientRect(caret);
					line.destroy();
					selection.extend(caret);
					if (!args.select) { selection.collapse(); }
					pageScroll = pageScroll !== undefined ? Math.max(pageScroll, rect.top + linePixel - caretRect.top) : rect.top + linePixel - caretRect.top;
				} else {
					if (caretLine > 0) {
						var scrollLines = Math.max(1, Math.min(caretLine, lines));
						x = selection._columnX;
						if (x === -1 || (args.select && util.isIE)) {
							line = self._getLine(caretLine);
							x = selection._columnX = line.getBoundingClientRect(caret).left;
							line.destroy();
						}
						line = self._getLine(caretLine - scrollLines);
						selection.extend(line.getOffset(x, self._getLineHeight(caretLine - scrollLines) - 1));
						line.destroy();
						if (!args.select) { selection.collapse(); }
						var scrollOffset = Math.max(0, scroll.y - scrollLines * lineHeight);
						pageScroll = pageScroll !== undefined  ? Math.max(pageScroll, scrollOffset - scroll.y) : scrollOffset - scroll.y;
					}
				}
			});
			this._setSelection(selections, true, true, function() {}, pageScroll, false, true);
			return true;
		},
		_doPaste: function(e) {
			var self = this;
			var result = this._getClipboardText(e, function(text) {
				if (text.length) {
					if (util.isLinux && self._lastMouseButton === 2) {
						var timeDiff = new Date().getTime() - self._lastMouseTime;
						if (timeDiff <= self._clickTime) {
							self._setSelectionTo(self._lastMouseX, self._lastMouseY, true);
						}
					}
					var selections = self._getSelections();
					var delimiter = self._singleMode ? "" : self._model.getLineDelimiter();
					self._doContent(selections.length > 1 && selections.length === text.length ? text : text.join(delimiter));
				}
			});
			return result !== null;
		},
		_doScroll: function (args) {
			var type = args.type;
			var model = this._model;
			var lineCount = model.getLineCount();
			var clientHeight = this._getClientHeight();
			var lineHeight = this._getLineHeight();
			var verticalMaximum = this._lineHeight ? this._scrollHeight : lineCount * lineHeight;
			var verticalScrollOffset = this._getScroll().y;
			var pixel;
			switch (type) {
				case "textStart": pixel = 0; break; //$NON-NLS-0$
				case "textEnd": pixel = verticalMaximum - clientHeight; break; //$NON-NLS-0$
				case "pageDown": pixel = verticalScrollOffset + clientHeight; break; //$NON-NLS-0$
				case "pageUp": pixel = verticalScrollOffset - clientHeight; break; //$NON-NLS-0$
				case "lineDown": pixel = verticalScrollOffset + lineHeight; break; //$NON-NLS-0$
				case "lineUp": pixel = verticalScrollOffset - lineHeight; break; //$NON-NLS-0$
				case "centerLine": //$NON-NLS-0$
					var selection = this._getSelections()[0];
					var lineStart = model.getLineAtOffset(selection.start);
					var lineEnd = model.getLineAtOffset(selection.end);
					var selectionHeight = (lineEnd - lineStart + 1) * lineHeight;
					pixel = (lineStart * lineHeight) - (clientHeight / 2) + (selectionHeight / 2);
					break;
			}
			if (pixel !== undefined) {
				pixel = Math.min(Math.max(0, pixel), verticalMaximum - clientHeight);
				this._scrollViewAnimated(0, pixel - verticalScrollOffset, function() {});
			}
			return true;
		},
		_doSelectAll: function () {
			var model = this._model;
			this._setSelection(new Selection(0, model.getCharCount()), false);
			return true;
		},
		_doTab: function () {
			if (!this._tabMode || this._readonly) { return; }
			var text = "\t"; //$NON-NLS-0$
			var selections = this._getSelections();
			if (this._expandTab) {
				text = [];
				var model = this._model;
				var tabSize = this._tabSize;
				selections.forEach(function(selection) {
					var caret = selection.getCaret();
					var lineIndex = model.getLineAtOffset(caret);
					var lineStart = model.getLineStart(lineIndex);
					var spaces = tabSize - ((caret - lineStart) % tabSize);
					text.push((newArray(spaces + 1)).join(" ")); //$NON-NLS-0$
				});
			}
			return this._modifyContent({text: text, selection: selections, _ignoreDOMSelection: true}, true);
		},
		_doShiftTab: function () {
			if (!this._tabMode || this._readonly) { return; }
			return true;
		},
		_doOverwriteMode: function () {
			if (this._readonly) { return; }
			this.setOptions({overwriteMode: !this.getOptions("overwriteMode")}); //$NON-NLS-0$
			return true;
		},
		_doTabMode: function () {
			this._tabMode = !this._tabMode;
			return true;
		},
		_doWrapMode: function () {
			this.setOptions({wrapMode: !this.getOptions("wrapMode")}); //$NON-NLS-0$
			return true;
		},
		
		/************************************ Internals ******************************************/
		_autoScroll: function () {
			var model = this._model;
			var selections = this._getSelections();
			var selection = Selection.editing(selections, this._autoScrollDir === "down"); //$NON-NLS-0$
			var pt = this.convert({x: this._autoScrollX, y: this._autoScrollY}, "page", "document"); //$NON-NLS-1$ //$NON-NLS-0$
			var caret = selection.getCaret();
			var lineCount = model.getLineCount();
			var caretLine = model.getLineAtOffset(caret), lineIndex, line;
			if (this._autoScrollDir === "up" || this._autoScrollDir === "down") { //$NON-NLS-1$ //$NON-NLS-0$
				var scroll = this._autoScrollY / this._getLineHeight();
				scroll = scroll < 0 ? Math.floor(scroll) : Math.ceil(scroll);
				lineIndex = caretLine;
				lineIndex = Math.max(0, Math.min(lineCount - 1, lineIndex + scroll));
			} else if (this._autoScrollDir === "left" || this._autoScrollDir === "right") { //$NON-NLS-1$ //$NON-NLS-0$
				lineIndex = this._getLineIndex(pt.y);
				line = this._getLine(caretLine); 
				pt.x += line.getBoundingClientRect(caret, false).left;
				line.destroy();
			}
			if (this._blockSelection) {
				selections = this._getBlockSelections(selections, lineIndex, pt);
			} else if (lineIndex === 0 && (util.isMac || util.isLinux)) {
				selection.extend(0);
			} else if (lineIndex === lineCount - 1 && (util.isMac || util.isLinux)) {
				selection.extend(model.getCharCount());
			} else {
				line = this._getLine(lineIndex);
				selection.extend(line.getOffset(pt.x, pt.y - this._getLinePixel(lineIndex)));
				line.destroy();
			}
			this._setSelection(selections, true);
		},
		_autoScrollTimer: function () {
			this._autoScroll();
			var self = this;
			var window = this._getWindow();
			this._autoScrollTimerID = window.setTimeout(function () {self._autoScrollTimer();}, this._AUTO_SCROLL_RATE);
		},
		_calculateLineHeightTimer: function(calculate) {
			if (!this._lineHeight) { return; }
			if (this._calculateLHTimer) { return; }
			var lineCount = this._model.getLineCount(), i = 0;
			if (calculate) {
				var c = 0;
				var MAX_TIME = 100;
				var start = new Date().getTime(), firstLine = 0;
				while (i < lineCount) {
					if (!this._lineHeight[i]) {
						c++;
						if (!firstLine) { firstLine = i; }
						this._lineHeight[i] = this._calculateLineHeight(i);
					}
					i++;
					if ((new Date().getTime() - start) > MAX_TIME) {
						break;
					}
				}
				this.redrawRulers(0, lineCount);
				this._queueUpdate();
			}
			var window = this._getWindow();
			if (i !== lineCount) {
				var self = this;
				this._calculateLHTimer = window.setTimeout(function() {
					self._calculateLHTimer = null;
					self._calculateLineHeightTimer(true);
				}, 0);
				return;
			}
			if (this._calculateLHTimer) {
				window.clearTimeout(this._calculateLHTimer);
				this._calculateLHTimer = undefined;
			}
		},
		_calculateLineHeight: function(lineIndex) {
			var line = this._getLine(lineIndex);
			var rect = line.getBoundingClientRect();
			line.destroy();
			return Math.max(1, rect.bottom - rect.top);
		},
		_calculateMetrics: function() {
			var parent = this._clientDiv;
			var document = parent.ownerDocument;
			var c = " "; //$NON-NLS-0$
			var line = util.createElement(document, "div"); //$NON-NLS-0$
			line.style.lineHeight = "normal"; //$NON-NLS-0$
			var model = this._model;
			var lineText = model.getLine(0);
			var e = {type:"LineStyle", textView: this, 0: 0, lineText: lineText, lineStart: 0}; //$NON-NLS-0$
			this.onLineStyle(e);
			applyStyle(e.style, line);
			line.style.position = "fixed"; //$NON-NLS-0$
			line.style.left = "-1000px"; //$NON-NLS-0$
			var span1 = util.createElement(document, "span"); //$NON-NLS-0$
			span1.appendChild(document.createTextNode(c));
			line.appendChild(span1);
			var span2 = util.createElement(document, "span"); //$NON-NLS-0$
			span2.style.fontStyle = "italic"; //$NON-NLS-0$
			span2.appendChild(document.createTextNode(c));
			line.appendChild(span2);
			var span3 = util.createElement(document, "span"); //$NON-NLS-0$
			span3.style.fontWeight = "bold"; //$NON-NLS-0$
			span3.appendChild(document.createTextNode(c));
			line.appendChild(span3);
			var span4 = util.createElement(document, "span"); //$NON-NLS-0$
			span4.style.fontWeight = "bold"; //$NON-NLS-0$
			span4.style.fontStyle = "italic"; //$NON-NLS-0$
			span4.appendChild(document.createTextNode(c));
			line.appendChild(span4);
			parent.appendChild(line);
			var lineRect = line.getBoundingClientRect();
			var spanRect1 = span1.getBoundingClientRect();
			var spanRect2 = span2.getBoundingClientRect();
			var spanRect3 = span3.getBoundingClientRect();
			var spanRect4 = span4.getBoundingClientRect();
			var h1 = spanRect1.bottom - spanRect1.top;
			var h2 = spanRect2.bottom - spanRect2.top;
			var h3 = spanRect3.bottom - spanRect3.top;
			var h4 = spanRect4.bottom - spanRect4.top;
			var fontStyle = 0;
			var invalid = (lineRect.bottom - lineRect.top) <= 0;
			var lineHeight = Math.max(1, lineRect.bottom - lineRect.top);
			if (h2 > h1) {
				fontStyle = 1;
			}
			if (h3 > h2) {
				fontStyle = 2;
			}
			if (h4 > h3) {
				fontStyle = 3;
			}
			var style;
			if (fontStyle !== 0) {
				style = {style: {}};
				if ((fontStyle & 1) !== 0) {
					style.style.fontStyle = "italic"; //$NON-NLS-0$
				}
				if ((fontStyle & 2) !== 0) {
					style.style.fontWeight = "bold"; //$NON-NLS-0$
				}
			}
			var trim = getLineTrim(line);
			parent.removeChild(line);
			
			// calculate pad and scroll width
			var pad = getPadding(this._viewDiv);
			var div1 = util.createElement(document, "div"); //$NON-NLS-0$
			div1.style.position = "fixed"; //$NON-NLS-0$
			div1.style.left = "-1000px"; //$NON-NLS-0$
			div1.style.paddingLeft = pad.left + "px"; //$NON-NLS-0$
			div1.style.paddingTop = pad.top + "px"; //$NON-NLS-0$
			div1.style.paddingRight = pad.right + "px"; //$NON-NLS-0$
			div1.style.paddingBottom = pad.bottom + "px"; //$NON-NLS-0$
			div1.style.width = "100px"; //$NON-NLS-0$
			div1.style.height = "100px"; //$NON-NLS-0$
			var div2 = util.createElement(document, "div"); //$NON-NLS-0$
			div2.style.width = "100%"; //$NON-NLS-0$
			div2.style.height = "100%"; //$NON-NLS-0$
			div1.appendChild(div2);
			parent.appendChild(div1);
			var rect1 = div1.getBoundingClientRect();
			var rect2 = div2.getBoundingClientRect();
			var scrollWidth = 0;
			if (!this._singleMode && !this._noScroll) {
				div1.style.overflow = 'hidden'; //$NON-NLS-0$
				div2.style.height = "200px"; //$NON-NLS-0$
				var w1 = div1.clientWidth;
				div1.style.overflow = 'scroll'; //$NON-NLS-0$
				var w2 = div1.clientWidth;
				scrollWidth = w1 - w2;
			}
			parent.removeChild(div1);
			pad = {
				left: rect2.left - rect1.left,
				top: rect2.top - rect1.top,
				right: rect1.right - rect2.right,
				bottom: rect1.bottom - rect2.bottom
			};
			var wrapWidth = 0, marginWidth = 0, charWidth = 0;
			if (!invalid) {
				div1 = util.createElement(document, "div"); //$NON-NLS-0$
				div1.style.position = "fixed"; //$NON-NLS-0$
				div1.style.left = "-1000px"; //$NON-NLS-0$
				parent.appendChild(div1);
				div1.innerHTML = newArray(2).join("a"); //$NON-NLS-0$
				rect1 = div1.getBoundingClientRect();
				charWidth = Math.ceil(rect1.right - rect1.left);
				if (this._wrapOffset || this._marginOffset) {
					div1.innerHTML = newArray(this._wrapOffset + 1 + (util.isWebkit ? 0 : 1)).join(" "); //$NON-NLS-0$
					rect1 = div1.getBoundingClientRect();
					wrapWidth = Math.ceil(rect1.right - rect1.left);
					div1.innerHTML = newArray(this._marginOffset + 1).join(" "); //$NON-NLS-0$
					rect2 = div1.getBoundingClientRect();
					marginWidth = Math.ceil(rect2.right - rect2.left);
				}
				parent.removeChild(div1);
			}
			return {
				lineHeight: lineHeight,
				largestFontStyle: style,
				lineTrim: trim,
				viewPadding: pad,
				scrollWidth: scrollWidth,
				wrapWidth: wrapWidth,
				marginWidth: marginWidth,
				charWidth: charWidth,
				invalid: invalid
			};
		},
		_cancelAnimation: function() {
			if (this._animation) {
				this._animation.stop();
				this._animation = null;
			}
		},
		_clearSelection: function (direction) {
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (direction === "next") { //$NON-NLS-0$
					selection.start = selection.end;
				} else {
					selection.end = selection.start;
				}
			});
			this._setSelection(selections, true);
			return true;
		},
		_commitIME: function (insertText) {
			if (this._imeOffset === -1) { return; }
			var model = this._model;
			var lineIndex = model.getLineAtOffset(this._imeOffset);
			var lineStart = model.getLineStart(lineIndex);
			var line = this._getLineNode(lineIndex);
			if (!insertText) {
				// make the state of the IME match the state the view expects it be in
				// when the view commits the text and IME also need to be committed
				// this can be accomplished by changing the focus around
				this._scrollDiv.focus();
				this._clientDiv.focus();
				
				var newText = this._getDOMText(line).text;
				var oldText = model.getLine(lineIndex);
				var start = this._imeOffset - lineStart;
				var end = start + newText.length - oldText.length;
				if (start !== end) {
					insertText = newText.substring(start, end);
				}
			}
			if (insertText) {
				if (!this._doContent(insertText) && !util.isWebkit) {
					line.lineRemoved = true;
					this._queueUpdate();
				}
			}
			this._imeOffset = -1;
		},
		_createActions: function () {
			this.addKeyMode(new mKeyModes.DefaultKeyMode(this));
			//1 to 1, no duplicates
			var self = this;
			this._actions = {
				"noop": {defaultHandler: function() {return self._doNoop();}}, //$NON-NLS-0$

				"lineUp": {defaultHandler: function(data) {return self._doLineUp(merge(data,{select: false}));}, actionDescription: {name: messages.lineUp}}, //$NON-NLS-0$
				"lineDown": {defaultHandler: function(data) {return self._doLineDown(merge(data,{select: false}));}, actionDescription: {name: messages.lineDown}}, //$NON-NLS-0$
				"lineStart": {defaultHandler: function(data) {return self._doHome(merge(data,{select: false, ctrl:false}));}, actionDescription: {name: messages.lineStart}}, //$NON-NLS-0$
				"lineEnd": {defaultHandler: function(data) {return self._doEnd(merge(data,{select: false, ctrl:false}));}, actionDescription: {name: messages.lineEnd}}, //$NON-NLS-0$
				"charPrevious": {defaultHandler: function(data) {return self._doCursorPrevious(merge(data,{select: false, unit:"character"}));}, actionDescription: {name: messages.charPrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"charNext": {defaultHandler: function(data) {return self._doCursorNext(merge(data,{select: false, unit:"character"}));}, actionDescription: {name: messages.charNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"pageUp": {defaultHandler: function(data) {return self._doPageUp(merge(data,{select: false}));}, actionDescription: {name: messages.pageUp}}, //$NON-NLS-0$
				"pageDown": {defaultHandler: function(data) {return self._doPageDown(merge(data,{select: false}));}, actionDescription: {name: messages.pageDown}}, //$NON-NLS-0$
				"scrollPageUp": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "pageUp"}));}, actionDescription: {name: messages.scrollPageUp}}, //$NON-NLS-1$ //$NON-NLS-0$
				"scrollPageDown": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "pageDown"}));}, actionDescription: {name: messages.scrollPageDown}}, //$NON-NLS-1$ //$NON-NLS-0$
				"scrollLineUp": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "lineUp"}));}, actionDescription: {name: messages.scrollLineUp}}, //$NON-NLS-1$ //$NON-NLS-0$
				"scrollLineDown": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "lineDown"}));}, actionDescription: {name: messages.scrollLineDown}}, //$NON-NLS-1$ //$NON-NLS-0$
				"wordPrevious": {defaultHandler: function(data) {return self._doCursorPrevious(merge(data,{select: false, unit:"word"}));}, actionDescription: {name: messages.wordPrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"wordNext": {defaultHandler: function(data) {return self._doCursorNext(merge(data,{select: false, unit:"word"}));}, actionDescription: {name: messages.wordNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"textStart": {defaultHandler: function(data) {return self._doHome(merge(data,{select: false, ctrl:true}));}, actionDescription: {name: messages.textStart}}, //$NON-NLS-0$
				"textEnd": {defaultHandler: function(data) {return self._doEnd(merge(data,{select: false, ctrl:true}));}, actionDescription: {name: messages.textEnd}}, //$NON-NLS-0$
				"scrollTextStart": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "textStart"}));}, actionDescription: {name: messages.scrollTextStart}}, //$NON-NLS-1$ //$NON-NLS-0$
				"scrollTextEnd": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "textEnd"}));}, actionDescription: {name: messages.scrollTextEnd}}, //$NON-NLS-1$ //$NON-NLS-0$
				"centerLine": {defaultHandler: function(data) {return self._doScroll(merge(data,{type: "centerLine"}));}, actionDescription: {name: messages.centerLine}}, //$NON-NLS-1$ //$NON-NLS-0$
				
				"selectLineUp": {defaultHandler: function(data) {return self._doLineUp(merge(data,{select: true}));}, actionDescription: {name: messages.selectLineUp}}, //$NON-NLS-0$
				"selectLineDown": {defaultHandler: function(data) {return self._doLineDown(merge(data,{select: true}));}, actionDescription: {name: messages.selectLineDown}}, //$NON-NLS-0$
				"selectWholeLineUp": {defaultHandler: function(data) {return self._doLineUp(merge(data,{select: true, wholeLine: true}));}, actionDescription: {name: messages.selectWholeLineUp}}, //$NON-NLS-0$
				"selectWholeLineDown": {defaultHandler: function(data) {return self._doLineDown(merge(data,{select: true, wholeLine: true}));}, actionDescription: {name: messages.selectWholeLineDown}}, //$NON-NLS-0$
				"selectLineStart": {defaultHandler: function(data) {return self._doHome(merge(data,{select: true, ctrl:false}));}, actionDescription: {name: messages.selectLineStart}}, //$NON-NLS-0$
				"selectLineEnd": {defaultHandler: function(data) {return self._doEnd(merge(data,{select: true, ctrl:false}));}, actionDescription: {name: messages.selectLineEnd}}, //$NON-NLS-0$
				"selectCharPrevious": {defaultHandler: function(data) {return self._doCursorPrevious(merge(data,{select: true, unit:"character"}));}, actionDescription: {name: messages.selectCharPrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"selectCharNext": {defaultHandler: function(data) {return self._doCursorNext(merge(data,{select: true, unit:"character"}));}, actionDescription: {name: messages.selectCharNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"selectPageUp": {defaultHandler: function(data) {return self._doPageUp(merge(data,{select: true}));}, actionDescription: {name: messages.selectPageUp}}, //$NON-NLS-0$
				"selectPageDown": {defaultHandler: function(data) {return self._doPageDown(merge(data,{select: true}));}, actionDescription: {name: messages.selectPageDown}}, //$NON-NLS-0$
				"selectWordPrevious": {defaultHandler: function(data) {return self._doCursorPrevious(merge(data,{select: true, unit:"word"}));}, actionDescription: {name: messages.selectWordPrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"selectWordNext": {defaultHandler: function(data) {return self._doCursorNext(merge(data,{select: true, unit:"word"}));}, actionDescription: {name: messages.selectWordNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"selectTextStart": {defaultHandler: function(data) {return self._doHome(merge(data,{select: true, ctrl:true}));}, actionDescription: {name: messages.selectTextStart}}, //$NON-NLS-0$
				"selectTextEnd": {defaultHandler: function(data) {return self._doEnd(merge(data,{select: true, ctrl:true}));}, actionDescription: {name: messages.selectTextEnd}}, //$NON-NLS-0$

				"deletePrevious": {defaultHandler: function(data) {return self._doBackspace(merge(data,{unit:"character"}));}, actionDescription: {name: messages.deletePrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"deleteNext": {defaultHandler: function(data) {return self._doDelete(merge(data,{unit:"character"}));}, actionDescription: {name: messages.deleteNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"deleteWordPrevious": {defaultHandler: function(data) {return self._doBackspace(merge(data,{unit:"word"}));}, actionDescription: {name: messages.deleteWordPrevious}}, //$NON-NLS-1$ //$NON-NLS-0$
				"deleteWordNext": {defaultHandler: function(data) {return self._doDelete(merge(data,{unit:"word"}));}, actionDescription: {name: messages.deleteWordNext}}, //$NON-NLS-1$ //$NON-NLS-0$
				"deleteLineStart": {defaultHandler: function(data) {return self._doBackspace(merge(data,{unit: "line"}));}, actionDescription: {name: messages.deleteLineStart}}, //$NON-NLS-1$ //$NON-NLS-0$
				"deleteLineEnd": {defaultHandler: function(data) {return self._doDelete(merge(data,{unit: "line"}));}, actionDescription: {name: messages.deleteLineEnd}}, //$NON-NLS-1$ //$NON-NLS-0$
				"tab": {defaultHandler: function(data) {return self._doTab(merge(data,{}));}, actionDescription: {name: messages.tab}}, //$NON-NLS-0$
				"shiftTab": {defaultHandler: function(data) {return self._doShiftTab(merge(data,{}));}, actionDescription: {name: messages.shiftTab}}, //$NON-NLS-0$
				"enter": {defaultHandler: function(data) {return self._doEnter(merge(data,{}));}, actionDescription: {name: messages.enter}}, //$NON-NLS-0$
				"enterNoCursor": {defaultHandler: function(data) {return self._doEnter(merge(data,{noCursor:true}));}, actionDescription: {name: messages.enterNoCursor}}, //$NON-NLS-0$
				"escape": {defaultHandler: function(data) {return self._doEscape(merge(data,{}));}, actionDescription: {name: messages.escape}}, //$NON-NLS-0$
				"selectAll": {defaultHandler: function(data) {return self._doSelectAll(merge(data,{}));}, actionDescription: {name: messages.selectAll}}, //$NON-NLS-0$
				"copy": {defaultHandler: function(data) {return self._doCopy(merge(data,{}));}, actionDescription: {name: messages.copy}}, //$NON-NLS-0$
				"cut": {defaultHandler: function(data) {return self._doCut(merge(data,{}));}, actionDescription: {name: messages.cut}}, //$NON-NLS-0$
				"paste": {defaultHandler: function(data) {return self._doPaste(merge(data,{}));}, actionDescription: {name: messages.paste}}, //$NON-NLS-0$
				
				"uppercase": {defaultHandler: function(data) {return self._doCase(merge(data,{type: "upper"}));}, actionDescription: {name: messages.uppercase}}, //$NON-NLS-1$ //$NON-NLS-0$
				"lowercase": {defaultHandler: function(data) {return self._doCase(merge(data,{type: "lower"}));}, actionDescription: {name: messages.lowercase}}, //$NON-NLS-1$ //$NON-NLS-0$
				"capitalize": {defaultHandler: function(data) {return self._doCase(merge(data,{unit: "word", type: "capitalize"}));}, actionDescription: {name: messages.capitalize}}, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				"reversecase": {defaultHandler: function(data) {return self._doCase(merge(data,{type: "reverse"}));}, actionDescription: {name: messages.reversecase}}, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				
				"toggleOverwriteMode": {defaultHandler: function(data) {return self._doOverwriteMode(merge(data,{}));}, actionDescription: {name: messages.toggleOverwriteMode}}, //$NON-NLS-0$
				"toggleTabMode": {defaultHandler: function(data) {return self._doTabMode(merge(data,{}));}, actionDescription: {name: messages.toggleTabMode}}, //$NON-NLS-0$
				"toggleWrapMode": {defaultHandler: function(data) {return self._doWrapMode(merge(data,{}));}, actionDescription: {name: messages.toggleWrapMode}} //$NON-NLS-0$
			};
		},
		_createRulerParent: function(document, className) {
			var div = util.createElement(document, "div"); //$NON-NLS-0$
			div.className = className;
			div.tabIndex = -1;
			div.style.overflow = "hidden"; //$NON-NLS-0$
			div.style.MozUserSelect = "none"; //$NON-NLS-0$
			div.style.WebkitUserSelect = "none"; //$NON-NLS-0$
			div.style.position = "absolute"; //$NON-NLS-0$
			div.style.top = "0px"; //$NON-NLS-0$
			div.style.bottom = "0px"; //$NON-NLS-0$
			div.style.cursor = "default"; //$NON-NLS-0$
			div.style.display = "none"; //$NON-NLS-0$
			div.setAttribute("aria-hidden", "true"); //$NON-NLS-1$ //$NON-NLS-0$
			this._rootDiv.appendChild(div);
			return div;
		},
		_createRuler: function(ruler, index) {
			if (!this._clientDiv) { return; }
			var rulerParent = this._getRulerParent(ruler);
			if (!rulerParent) { return; }
			if (rulerParent !== this._marginDiv || this._marginOffset) {
				rulerParent.style.display = "block"; //$NON-NLS-0$
			}
			rulerParent.rulerWidth = undefined;
			var div = util.createElement(rulerParent.ownerDocument, "div"); //$NON-NLS-0$
			div._ruler = ruler;
			ruler.node = div;
			div.rulerChanged = true;
			div.style.position = "relative"; //$NON-NLS-0$
			div.style.cssFloat = "left"; //$NON-NLS-0$
			div.style.styleFloat = "left"; //$NON-NLS-0$
			div.style.outline = "none"; //$NON-NLS-0$
			if (index === undefined || index < 0 || index >= rulerParent.children.length) {
				rulerParent.appendChild(div);
			} else {
				var sibling = rulerParent.firstChild;
				while (sibling && index-- > 0) {
					sibling = sibling.nextSibling;
				}
				rulerParent.insertBefore(div, sibling);
			}
		},
		_createSelectionDiv: function() {
			var div = util.createElement(this._parent.ownerDocument, "div"); //$NON-NLS-0$
			div.className = "textviewSelection"; //$NON-NLS-0$
			div.style.position = "absolute"; //$NON-NLS-0$
			div.style.borderWidth = "0px"; //$NON-NLS-0$
			div.style.margin = "0px"; //$NON-NLS-0$
			div.style.padding = "0px"; //$NON-NLS-0$
			div.style.outline = "none"; //$NON-NLS-0$
			div.style.width = "0px"; //$NON-NLS-0$
			div.style.height = "0px"; //$NON-NLS-0$
			div.style.zIndex = "0"; //$NON-NLS-0$
			return div;
		},
		_createView: function() {
			if (this._clientDiv) { return; }
			var parent = this._parent;
			while (parent.hasChildNodes()) { parent.removeChild(parent.lastChild); }

			var document = parent.ownerDocument;
			var rootDiv = util.createElement(document, "div"); //$NON-NLS-0$
			this._rootDiv = rootDiv;
			rootDiv.tabIndex = -1;
			rootDiv.style.position = "relative"; //$NON-NLS-0$
			rootDiv.style.overflow = "hidden"; //$NON-NLS-0$
			rootDiv.style.width = "100%"; //$NON-NLS-0$
			rootDiv.style.height = "100%"; //$NON-NLS-0$
			rootDiv.style.overflow = "hidden"; //$NON-NLS-0$
			rootDiv.style.WebkitTextSizeAdjust = "100%"; //$NON-NLS-0$
			rootDiv.setAttribute("role", "application"); //$NON-NLS-1$ //$NON-NLS-0$
			parent.appendChild(rootDiv);
			
			var leftDiv = this._createRulerParent(document, "textviewLeftRuler"); //$NON-NLS-0$
			this._leftDiv = leftDiv;

			var viewDiv = util.createElement(document, "div"); //$NON-NLS-0$
			viewDiv.className = "textviewScroll"; //$NON-NLS-0$
			this._viewDiv = viewDiv;
			viewDiv.tabIndex = -1;
			viewDiv.style.position = "absolute"; //$NON-NLS-0$
			viewDiv.style.top = "0px"; //$NON-NLS-0$
			viewDiv.style.bottom = "0px"; //$NON-NLS-0$
			viewDiv.style.borderWidth = "0px"; //$NON-NLS-0$
			viewDiv.style.margin = "0px"; //$NON-NLS-0$
			viewDiv.style.outline = "none"; //$NON-NLS-0$
			viewDiv.style.background = "transparent"; //$NON-NLS-0$
			rootDiv.appendChild(viewDiv);
			
			var rightDiv = this._createRulerParent(document, "textviewRightRuler"); //$NON-NLS-0$
			this._rightDiv = rightDiv;
			rightDiv.style.right = "0px"; //$NON-NLS-0$

			var innerRightDiv = this._createRulerParent(document, "textviewInnerRightRuler"); //$NON-NLS-0$
			this._innerRightDiv = innerRightDiv;
			innerRightDiv.style.zIndex = "1"; //$NON-NLS-0$

			var scrollDiv = util.createElement(document, "div"); //$NON-NLS-0$
			this._scrollDiv = scrollDiv;
			scrollDiv.style.margin = "0px"; //$NON-NLS-0$
			scrollDiv.style.borderWidth = "0px"; //$NON-NLS-0$
			scrollDiv.style.padding = "0px"; //$NON-NLS-0$
			viewDiv.appendChild(scrollDiv);
			
			var marginDiv = this._marginDiv = this._createRulerParent(document, "textviewMarginRuler"); //$NON-NLS-0$
			marginDiv.style.zIndex = "4"; //$NON-NLS-0$
			
			if (!util.isIE && !util.isIOS) {
				var clipDiv = util.createElement(document, "div"); //$NON-NLS-0$
				this._clipDiv = clipDiv;
				clipDiv.style.position = "absolute"; //$NON-NLS-0$
				clipDiv.style.overflow = "hidden"; //$NON-NLS-0$
				clipDiv.style.margin = "0px"; //$NON-NLS-0$
				clipDiv.style.borderWidth = "0px"; //$NON-NLS-0$
				clipDiv.style.padding = "0px"; //$NON-NLS-0$
				clipDiv.style.background = "transparent"; //$NON-NLS-0$
				rootDiv.appendChild(clipDiv);
				
				var clipScrollDiv = util.createElement(document, "div"); //$NON-NLS-0$
				this._clipScrollDiv = clipScrollDiv;
				clipScrollDiv.style.position = "absolute"; //$NON-NLS-0$
				clipScrollDiv.style.height = "1px"; //$NON-NLS-0$
				clipScrollDiv.style.top = "-1000px"; //$NON-NLS-0$
				clipScrollDiv.style.background = "transparent"; //$NON-NLS-0$
				clipDiv.appendChild(clipScrollDiv);
			}

			var clientDiv = util.createElement(document, "div"); //$NON-NLS-0$
			clientDiv.className = "textviewContent"; //$NON-NLS-0$
			this._clientDiv = clientDiv;
			clientDiv.tabIndex = 0;
			clientDiv.style.position = "absolute"; //$NON-NLS-0$
			clientDiv.style.borderWidth = "0px"; //$NON-NLS-0$
			clientDiv.style.margin = "0px"; //$NON-NLS-0$
			clientDiv.style.padding = "0px"; //$NON-NLS-0$
			clientDiv.style.outline = "none"; //$NON-NLS-0$
			clientDiv.style.zIndex = "1"; //$NON-NLS-0$
			clientDiv.style.WebkitUserSelect = "text"; //$NON-NLS-0$
			clientDiv.setAttribute("spellcheck", "false"); //$NON-NLS-1$ //$NON-NLS-0$
			if (util.isIOS || util.isAndroid) {
				clientDiv.style.WebkitTapHighlightColor = "transparent"; //$NON-NLS-0$
			}
			(this._clipDiv || rootDiv).appendChild(clientDiv);
			
			this._setFullSelection(this._fullSelection, true);
			
			if (util.isIOS || util.isAndroid) {
				var vScrollDiv = util.createElement(document, "div"); //$NON-NLS-0$
				this._vScrollDiv = vScrollDiv;
				vScrollDiv.style.position = "absolute"; //$NON-NLS-0$
				vScrollDiv.style.borderWidth = "1px"; //$NON-NLS-0$
				vScrollDiv.style.borderColor = "white"; //$NON-NLS-0$
				vScrollDiv.style.borderStyle = "solid"; //$NON-NLS-0$
				vScrollDiv.style.borderRadius = "4px"; //$NON-NLS-0$
				vScrollDiv.style.backgroundColor = "black"; //$NON-NLS-0$
				vScrollDiv.style.opacity = "0.5"; //$NON-NLS-0$
				vScrollDiv.style.margin = "0px"; //$NON-NLS-0$
				vScrollDiv.style.padding = "0px"; //$NON-NLS-0$
				vScrollDiv.style.outline = "none"; //$NON-NLS-0$
				vScrollDiv.style.zIndex = "3"; //$NON-NLS-0$
				vScrollDiv.style.width = "8px"; //$NON-NLS-0$
				vScrollDiv.style.display = "none"; //$NON-NLS-0$
				rootDiv.appendChild(vScrollDiv);
				var hScrollDiv = util.createElement(document, "div"); //$NON-NLS-0$
				this._hScrollDiv = hScrollDiv;
				hScrollDiv.style.position = "absolute"; //$NON-NLS-0$
				hScrollDiv.style.borderWidth = "1px"; //$NON-NLS-0$
				hScrollDiv.style.borderColor = "white"; //$NON-NLS-0$
				hScrollDiv.style.borderStyle = "solid"; //$NON-NLS-0$
				hScrollDiv.style.borderRadius = "4px"; //$NON-NLS-0$
				hScrollDiv.style.backgroundColor = "black"; //$NON-NLS-0$
				hScrollDiv.style.opacity = "0.5"; //$NON-NLS-0$
				hScrollDiv.style.margin = "0px"; //$NON-NLS-0$
				hScrollDiv.style.padding = "0px"; //$NON-NLS-0$
				hScrollDiv.style.outline = "none"; //$NON-NLS-0$
				hScrollDiv.style.zIndex = "3"; //$NON-NLS-0$
				hScrollDiv.style.height = "8px"; //$NON-NLS-0$
				hScrollDiv.style.display = "none"; //$NON-NLS-0$
				rootDiv.appendChild(hScrollDiv);
			}

			if (util.isFirefox && !clientDiv.setCapture) {
				var overlayDiv = util.createElement(document, "div"); //$NON-NLS-0$
				this._overlayDiv = overlayDiv;
				overlayDiv.style.position = clientDiv.style.position;
				overlayDiv.style.borderWidth = clientDiv.style.borderWidth;
				overlayDiv.style.margin = clientDiv.style.margin;
				overlayDiv.style.padding = clientDiv.style.padding;
				overlayDiv.style.cursor = "text"; //$NON-NLS-0$
				overlayDiv.style.zIndex = "2"; //$NON-NLS-0$
				(this._clipDiv || rootDiv).appendChild(overlayDiv);
			}
			clientDiv.contentEditable = "true"; //$NON-NLS-0$
			clientDiv.setAttribute("role", "textbox"); //$NON-NLS-1$ //$NON-NLS-0$
			clientDiv.setAttribute("aria-multiline", "true"); //$NON-NLS-1$ //$NON-NLS-0$
			this._setWrapMode(this._wrapMode, true);
			this._setReadOnly(this._readonly);
			this._setThemeClass(this._themeClass, true);
			this._setTabSize(this._tabSize, true);
			this._setMarginOffset(this._marginOffset, true);
			this._hookEvents();
			var rulers = this._rulers;
			for (var i=0; i<rulers.length; i++) {
				this._createRuler(rulers[i]);
			}
			this._update();
			// Detect when the parent is attached to the DOM or display
			var self = this;
			function checkDOMReady() {
				if (!self._rootDiv) { return; }
				self.update(true);
				if (self._metrics.invalid) {
					self._getWindow().setTimeout(function() {
						checkDOMReady();
					}, 100);
				}
			}
			DOMReady(document, rootDiv, "textview", checkDOMReady); //$NON-NLS-0$
		},
		_defaultOptions: function() {
			return {
				parent: {value: undefined, update: null},
				model: {value: undefined, update: this.setModel},
				scrollAnimation: {value: 0, update: null},
				readonly: {value: false, update: this._setReadOnly},
				fullSelection: {value: true, update: this._setFullSelection},
				tabMode: { value: true, update: null },
				tabSize: {value: 8, update: this._setTabSize},
				expandTab: {value: false, update: null},
				singleMode: {value: false, update: this._setSingleMode},
				noScroll: {value: false, update: this._setNoScroll},
				overwriteMode: { value: false, update: this._setOverwriteMode },
				blockCursorVisible: { value: false, update: this._setBlockCursor},
				marginOffset: {value: 0, update: this._setMarginOffset},
				wrapOffset: {value: 0, update: this._setWrapOffset},
				wrapMode: {value: false, update: this._setWrapMode},
				wrappable: {value: false, update: null},
				undoStack: {value: null, update: this._setUndoStack},
				theme: {value: mTextTheme.TextTheme.getTheme(), update: this._setTheme},
				themeClass: {value: undefined, update: this._setThemeClass}
			};
		},
		_destroyRuler: function(ruler) {
			var rulerParent = this._getRulerParent(ruler);
			if (rulerParent) {
				var div = rulerParent.firstChild;
				while (div) {
					if (div._ruler === ruler) {
						div._ruler = undefined;
						rulerParent.removeChild(div);
						if (rulerParent.children.length === 0 && (rulerParent !== this._marginDiv || !this._marginOffset)) {
							rulerParent.style.display = "none"; //$NON-NLS-0$
						}
						rulerParent.rulerWidth = undefined;
						break;
					}
					div = div.nextSibling;
				}
			}
		},
		_destroyView: function() {
			var clientDiv = this._clientDiv;
			if (!clientDiv) { return; }
			this._setGrab(null);
			this._unhookEvents();

			/* Destroy timers */
			var window = this._getWindow();
			if (this._autoScrollTimerID) {
				window.clearTimeout(this._autoScrollTimerID);
				this._autoScrollTimerID = null;
			}
			if (this._updateTimer) {
				window.clearTimeout(this._updateTimer);
				this._updateTimer = null;
			}
			if (this._calculateLHTimer) {
				window.clearTimeout(this._calculateLHTimer);
				this._calculateLHTimer = null;
			}
			if (this._cursorTimer) {
				window.clearInterval(this._cursorTimer);
				this._cursorTimer = null;
			}
			
			var rootDiv = this._rootDiv;
			rootDiv.parentNode.removeChild(rootDiv);

			/* Destroy DOM */
			this._domSelection = null;
			this._clipboardDiv = null;
			this._rootDiv = null;
			this._scrollDiv = null;
			this._viewDiv = null;
			this._clipDiv = null;
			this._clipScrollDiv = null;
			this._clientDiv = null;
			this._overlayDiv = null;
			this._leftDiv = null;
			this._rightDiv = null;
			this._innerRightDiv = null;
			this._marginDiv = null;
			this._cursorDiv = null;
			this._vScrollDiv = null;
			this._hScrollDiv = null;
		},
		_doAutoScroll: function (direction, x, y) {
			this._autoScrollDir = direction;
			this._autoScrollX = x;
			this._autoScrollY = y;
			if (!this._autoScrollTimerID) {
				this._autoScrollTimer();
			}
		},
		_endAutoScroll: function () {
			if (this._autoScrollTimerID) {
				var window = this._getWindow();
				window.clearTimeout(this._autoScrollTimerID);
			}
			this._autoScrollDir = undefined;
			this._autoScrollTimerID = undefined;
		},
		_fixCaret: function() {
			var clientDiv = this._clientDiv;
			if (clientDiv) {
				var hasFocus = this._hasFocus;
				this._ignoreFocus = true;
				if (hasFocus) { clientDiv.blur(); }
				clientDiv.contentEditable = false;
				clientDiv.contentEditable = true;
				if (hasFocus) { clientDiv.focus(); }
				this._ignoreFocus = false;
			}
		},
		_getBaseText: function(start, end) {
			var model = this._model;
			/* This is the only case the view access the base model, alternatively the view could use a event to application to customize the text */
			if (model.getBaseModel) {
				start = model.mapOffset(start);
				end = model.mapOffset(end);
				model = model.getBaseModel();
			}
			return model.getText(start, end);
		},
		_getBottomIndex: function (fullyVisible) {
			var child = this._bottomChild;
			if (fullyVisible && this._getClientHeight() > this._getLineHeight()) {
				var rect = child.getBoundingClientRect();
				var clientRect = this._clientDiv.getBoundingClientRect();
				if (rect.bottom > clientRect.bottom) {
					child = this._getLinePrevious(child) || child;
				}
			}
			return child.lineIndex;
		},
		_getBlockSelections: function(selections, lineIndex, pt) {
			var model = this._model;
			selections = selections.filter(function(sel) { return !sel._editing; });
			var firstLine = model.getLineAtOffset(this._blockSelection.getAnchor()), lastLine;
			if (lineIndex > firstLine) {
				lastLine = lineIndex;
			} else {
				lastLine = firstLine;
				firstLine = lineIndex;
			}
			for (var l = firstLine; l <= lastLine; l++) {
				var line = this._getLine(l);
				var o1 = line.getOffset(pt.x, 1);
				var o2 = line.getOffset(this._blockSelection._docX, 1);
				line.destroy();
				if (o1 === o2 && o1 === model.getLineEnd(l)) continue;
				var caret = o1 < o2;
				var sel = new Selection(caret ? o1 : o2, caret ? o2 : o1, caret);
				sel._editing = true;
				selections.push(sel);
			}
			return selections;
		},
		_getBoundsAtOffset: function(offset) {
			var model = this._model;
			var line = this._getLine(model.getLineAtOffset(offset));
			var result = line.getBoundingClientRect(offset);
			var linePixel = this._getLinePixel(line.lineIndex);
			result.top += linePixel;
			result.bottom += linePixel;
			line.destroy();
			return result;
		},
		_getClientHeight: function() {
			var viewPad = this._getViewPadding();
			return Math.max(0, this._viewDiv.clientHeight - viewPad.top - viewPad.bottom);
		},
		_getInnerRightWidth: function() {
			var innerRightWidth = this._innerRightDiv.rulerWidth;
			if (innerRightWidth === undefined) {
				var innerRightRect = this._innerRightDiv.getBoundingClientRect();
				this._innerRightDiv.rulerWidth = innerRightWidth = innerRightRect.right - innerRightRect.left;
			}
			return innerRightWidth;
		},
		_getClientWidth: function() {
			var viewPad = this._getViewPadding();
			var innerRightWidth = this._getInnerRightWidth();
			return Math.max(0, this._viewDiv.clientWidth - viewPad.left - viewPad.right - innerRightWidth);
		},
		_getClipboardText: function (event, handler) {
			// IE
			var window = this._getWindow();
			var clipboardData = window.clipboardData;
			// WebKit and Firefox > 21
			if (!clipboardData && event) {
				clipboardData = event.clipboardData;
			}
			function convert(wholeText) {
				var clipboadText = [];
				convertDelimiter(wholeText, function(t) {clipboadText.push(t);}, null);
				if (handler) { handler(clipboadText); }
				return clipboadText;
			}
			if (clipboardData) {
				return convert(clipboardData.getData(util.isIE ? "Text" : "text/plain")); //$NON-NLS-1$"//$NON-NLS-0$
			}
			if (util.isFirefox) {
				this._ignoreFocus = true;
				var clipboardDiv = this._clipboardDiv;
				var document = this._rootDiv.ownerDocument;
				if (!clipboardDiv) {
					clipboardDiv = util.createElement(document, "div"); //$NON-NLS-0$
					this._clipboardDiv = clipboardDiv;
					clipboardDiv.style.position = "fixed"; //$NON-NLS-0$
					clipboardDiv.style.whiteSpace = "pre"; //$NON-NLS-0$
					clipboardDiv.style.left = "-1000px"; //$NON-NLS-0$
					this._rootDiv.appendChild(clipboardDiv);
				}
				clipboardDiv.innerHTML = "<pre contenteditable=''></pre>"; //$NON-NLS-0$
				clipboardDiv.firstChild.focus();
				var self = this;
				var _getText = function() {
					var noteText = self._getTextFromElement(clipboardDiv);
					clipboardDiv.innerHTML = "";
					return convert(noteText);
				};
				
				/* Try execCommand first. Works on firefox with clipboard permission. */
				var result = false;
				this._ignorePaste = true;

				/* Do not try execCommand if middle-click is used, because if we do, we get the clipboard text, not the primary selection text. */
				if (!util.isLinux || this._lastMouseButton !== 2) {
					try {
						result = document.execCommand("paste", false, null); //$NON-NLS-0$
					} catch (ex) {
						/* Firefox can throw even when execCommand() works, see bug 362835. */
						result = clipboardDiv.childNodes.length > 1 || clipboardDiv.firstChild && clipboardDiv.firstChild.childNodes.length > 0;
					}
				}
				this._ignorePaste = false;
				if (!result) {
					/* Try native paste in DOM, works for firefox during the paste event. */
					if (event) {
						window.setTimeout(function() {
							self.focus();
							_getText();
							self._ignoreFocus = false;
						}, 0);
						return null;
					} else {
						/* no event and no clipboard permission, paste can't be performed */
						this.focus();
						this._ignoreFocus = false;
						return "";
					}
				}
				this.focus();
				this._ignoreFocus = false;
				return _getText();
			}
			return "";
		},
		_getDOMText: function(child, offsetNode) {
			return child._line.getText(offsetNode);
		},
		_getTextFromElement: function(element) {
			var document = element.ownerDocument;
			var window = document.defaultView;
			if (!window.getSelection) {
				return element.innerText || element.textContent;
			}

			var newRange = document.createRange();
			newRange.selectNode(element);

			var selection = window.getSelection();
			var oldRanges = [], i;
			for (i = 0; i < selection.rangeCount; i++) {
				oldRanges.push(selection.getRangeAt(i));
			}

			this._ignoreSelect = true;
			selection.removeAllRanges();
			selection.addRange(newRange);

			var text = selection.toString();

			selection.removeAllRanges();
			for (i = 0; i < oldRanges.length; i++) {
				selection.addRange(oldRanges[i]);
			}

			this._ignoreSelect = false;
			return text;
		},
		_getViewPadding: function() {
			return this._metrics.viewPadding;
		},
		_getLine: function(lineIndex) {
			var child = this._getLineNode(lineIndex);
			if (child && !child.lineChanged && !child.lineRemoved) {
				return child._line;
			}
			return new TextLine(this, lineIndex);
		},
		_getLineHeight: function(lineIndex, calculate) {
			if (lineIndex !== undefined && this._lineHeight) {
				var lineHeight = this._lineHeight[lineIndex];
				if (lineHeight) { return lineHeight; }
				if (calculate || calculate === undefined) {
					var height = this._lineHeight[lineIndex] = this._calculateLineHeight(lineIndex);
					return height;
				}
			}
			return this._metrics.lineHeight;
		},
		_getLineNode: function (lineIndex) {
			var clientDiv = this._clientDiv;
			var child = clientDiv.firstChild;
			while (child) {
				if (lineIndex === child.lineIndex) {
					return child;
				}
				child = child.nextSibling;
			}
			return undefined;
		},
		_getLineNext: function (lineNode) {
			var node = lineNode ? lineNode.nextSibling : this._clientDiv.firstChild;
			while (node && (node.lineIndex === -1 || !node._line)) {
				node = node.nextSibling;
			}
			return node;
		},
		_getLinePrevious: function (lineNode) {
			var node = lineNode ? lineNode.previousSibling : this._clientDiv.lastChild;
			while (node && (node.lineIndex === -1 || !node._line)) {
				node = node.previousSibling;
			}
			return node;
		},
		_getLinePixel: function(lineIndex) {
			lineIndex = Math.min(Math.max(0, lineIndex), this._model.getLineCount());
			if (this._lineHeight) {
				var topIndex = this._getTopIndex();
				var pixel = -this._topIndexY + this._getScroll().y, i;
				if (lineIndex > topIndex) {
					for (i = topIndex; i < lineIndex; i++) {
						pixel += this._getLineHeight(i);
					}
				} else {
					for (i = topIndex - 1; i >= lineIndex; i--) {
						pixel -= this._getLineHeight(i);
					}
				}
				return pixel;
			}
			var lineHeight = this._getLineHeight();
			return lineHeight * lineIndex;
		},
		_getLineIndex: function(y) {
			var lineHeight, lineIndex = 0;
			var lineCount = this._model.getLineCount();
			if (this._lineHeight) {
				lineIndex = this._getTopIndex();
				var pixel = -this._topIndexY + this._getScroll().y;
				if (y !== pixel) {
					if (y < pixel) {
						while (y < pixel && lineIndex > 0) {
							y += this._getLineHeight(--lineIndex);
						}
					} else {
						lineHeight = this._getLineHeight(lineIndex);
						while (y - lineHeight >= pixel && lineIndex < lineCount - 1) {
							y -= lineHeight;
							lineHeight = this._getLineHeight(++lineIndex);
						}
					}
				}
			} else {
				lineHeight = this._getLineHeight();
				lineIndex = Math.floor(y / lineHeight);
			}
			return Math.max(0, Math.min(lineCount - 1, lineIndex));
		},
		_getRulerParent: function(ruler) {
			switch (ruler.getLocation()) {
				case "left": return this._leftDiv; //$NON-NLS-0$
				case "right": return this._rightDiv; //$NON-NLS-0$
				case "innerRight": return this._innerRightDiv; //$NON-NLS-0$
				case "margin": return this._marginDiv; //$NON-NLS-0$
			}
			return null;
		},
		_getScroll: function(cancelAnimation) {
			if (cancelAnimation === undefined || cancelAnimation) {
				this._cancelAnimation();
			}
			var viewDiv = this._viewDiv;
			return {x: viewDiv.scrollLeft, y: viewDiv.scrollTop};
		},
		_getSelection: function () {
			return (Array.isArray(this._selection) ? this._selection[0] : this._selection).clone();
		},
		_getSelections: function () {
			return (Array.isArray(this._selection) ? this._selection : [this._selection]).map(function(s) {
				return s.clone();
			});
		},
		_getTopIndex: function (fullyVisible) {
			var child = this._topChild;
			if (fullyVisible && this._getClientHeight() > this._getLineHeight()) {
				var rect = child.getBoundingClientRect();
				var viewPad = this._getViewPadding();
				var viewRect = this._viewDiv.getBoundingClientRect();
				if (rect.top < viewRect.top + viewPad.top) {
					child = this._getLineNext(child) || child;
				}
			}
			return child.lineIndex;
		},
		_hookEvents: function() {
			var self = this;
			this._modelListener = {
				/** @private */
				onChanging: function(modelChangingEvent) {
					self._onModelChanging(modelChangingEvent);
				},
				/** @private */
				onChanged: function(modelChangedEvent) {
					self._onModelChanged(modelChangedEvent);
				}
			};
			this._model.addEventListener("preChanging", this._modelListener.onChanging); //$NON-NLS-0$
			this._model.addEventListener("postChanged", this._modelListener.onChanged); //$NON-NLS-0$
			
			this._themeListener = {
				onChanged: function() {
					self._setThemeClass(self._themeClass);
				}
			};
			this._theme.addEventListener("ThemeChanged", this._themeListener.onChanged); //$NON-NLS-0$
			
			var handlers = this._handlers = [];
			var clientDiv = this._clientDiv, viewDiv = this._viewDiv, rootDiv = this._rootDiv;
			var topNode = this._overlayDiv || clientDiv;
			var document = clientDiv.ownerDocument;
			var window = this._getWindow();
			var grabNode = util.isIE ? document : window;
			handlers.push({target: window, type: "resize", handler: function(e) { return self._handleResize(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "blur", handler: function(e) { return self._handleBlur(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "focus", handler: function(e) { return self._handleFocus(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: viewDiv, type: "focus", handler: function() { clientDiv.focus(); }}); //$NON-NLS-0$
			handlers.push({target: viewDiv, type: "scroll", handler: function(e) { return self._handleScroll(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "textInput", handler: function(e) { return self._handleTextInput(e ? e : window.event); }}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "keydown", handler: function(e) { return self._handleKeyDown(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "keypress", handler: function(e) { return self._handleKeyPress(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "keyup", handler: function(e) { return self._handleKeyUp(e ? e : window.event);}}); //$NON-NLS-0$
			if (util.isIE) {
				handlers.push({target: document, type: "keyup", handler: function(e) { return self._handleDocKeyUp(e ? e : window.event);}}); //$NON-NLS-0$
			}
			handlers.push({target: clientDiv, type: "contextmenu", handler: function(e) { return self._handleContextMenu(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "copy", handler: function(e) { return self._handleCopy(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "cut", handler: function(e) { return self._handleCut(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: clientDiv, type: "paste", handler: function(e) { return self._handlePaste(e ? e : window.event);}}); //$NON-NLS-0$
			handlers.push({target: document, type: "selectionchange", handler: function(e) { return self._handleSelectionChange(e ? e : window.event); }}); //$NON-NLS-0$
			if (util.isIOS || util.isAndroid) {
				handlers.push({target: clientDiv, type: "touchstart", handler: function(e) { return self._handleTouchStart(e ? e : window.event); }}); //$NON-NLS-0$
				handlers.push({target: clientDiv, type: "touchmove", handler: function(e) { return self._handleTouchMove(e ? e : window.event); }}); //$NON-NLS-0$
				handlers.push({target: clientDiv, type: "touchend", handler: function(e) { return self._handleTouchEnd(e ? e : window.event); }}); //$NON-NLS-0$
			} else {
				handlers.push({target: clientDiv, type: "selectstart", handler: function(e) { return self._handleSelectStart(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: clientDiv, type: "mousedown", handler: function(e) { return self._handleMouseDown(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: clientDiv, type: "mouseover", handler: function(e) { return self._handleMouseOver(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: clientDiv, type: "mouseout", handler: function(e) { return self._handleMouseOut(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: grabNode, type: "mouseup", handler: function(e) { return self._handleMouseUp(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: grabNode, type: "mousemove", handler: function(e) { return self._handleMouseMove(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: rootDiv, type: "mousedown", handler: function(e) { return self._handleRootMouseDown(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: rootDiv, type: "mouseup", handler: function(e) { return self._handleRootMouseUp(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "dragstart", handler: function(e) { return self._handleDragStart(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "drag", handler: function(e) { return self._handleDrag(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "dragend", handler: function(e) { return self._handleDragEnd(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "dragenter", handler: function(e) { return self._handleDragEnter(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "dragover", handler: function(e) { return self._handleDragOver(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "dragleave", handler: function(e) { return self._handleDragLeave(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: topNode, type: "drop", handler: function(e) { return self._handleDrop(e ? e : window.event);}}); //$NON-NLS-0$
				handlers.push({target: this._clientDiv, type: util.isFirefox > 26 ? "wheel" : util.isFirefox ? "DOMMouseScroll" : "mousewheel", handler: function(e) { return self._handleMouseWheel(e ? e : window.event); }}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				if (this._clipDiv) {
					handlers.push({target: this._clipDiv, type: util.isFirefox > 26 ? "wheel" : util.isFirefox ? "DOMMouseScroll" : "mousewheel", handler: function(e) { return self._handleMouseWheel(e ? e : window.event); }}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				}
				if (util.isFirefox && (!util.isWindows || util.isFirefox >= 15)) {
					var MutationObserver = window.MutationObserver || window.MozMutationObserver;
					if (MutationObserver) {
						this._mutationObserver = new MutationObserver(function(mutations) { self._handleDataModified(mutations); });
						this._mutationObserver.observe(clientDiv, {subtree: true, characterData: true});
					} else {
						handlers.push({target: this._clientDiv, type: "DOMCharacterDataModified", handler: function (e) { return self._handleDataModified(e ? e : window.event); }}); //$NON-NLS-0$
					}
				}
				if ((util.isFirefox && (!util.isWindows || util.isFirefox >= 15)) || util.isIE) {
					handlers.push({target: this._clientDiv, type: "compositionstart", handler: function (e) { return self._handleCompositionStart(e ? e : window.event); }}); //$NON-NLS-0$
					handlers.push({target: this._clientDiv, type: "compositionend", handler: function (e) { return self._handleCompositionEnd(e ? e : window.event); }}); //$NON-NLS-0$
				}
				if (this._overlayDiv) {
					handlers.push({target: this._overlayDiv, type: "mousedown", handler: function(e) { return self._handleMouseDown(e ? e : window.event);}}); //$NON-NLS-0$
					handlers.push({target: this._overlayDiv, type: "mouseover", handler: function(e) { return self._handleMouseOver(e ? e : window.event);}}); //$NON-NLS-0$
					handlers.push({target: this._overlayDiv, type: "mouseout", handler: function(e) { return self._handleMouseOut(e ? e : window.event);}}); //$NON-NLS-0$
					handlers.push({target: this._overlayDiv, type: "contextmenu", handler: function(e) { return self._handleContextMenu(e ? e : window.event); }}); //$NON-NLS-0$
				}
				if (!this._isW3CEvents) {
					handlers.push({target: this._clientDiv, type: "dblclick", handler: function(e) { return self._handleDblclick(e ? e : window.event); }}); //$NON-NLS-0$
				}
			}

			this._hookRulerEvents(this._leftDiv, handlers);
			this._hookRulerEvents(this._rightDiv, handlers);
			this._hookRulerEvents(this._innerRightDiv, handlers);
			this._hookRulerEvents(this._marginDiv, handlers);
			
			for (var i=0; i<handlers.length; i++) {
				var h = handlers[i];
				addHandler(h.target, h.type, h.handler, h.capture);
			}
		},
		_hookRulerEvents: function(div, handlers) {
			if (!div) { return; }
			var self = this;
			var window = this._getWindow();
			if (util.isIE) {
				handlers.push({target: div, type: "selectstart", handler: function() {return false;}}); //$NON-NLS-0$
			}
			handlers.push({target: div, type: util.isFirefox > 26 ? "wheel" : util.isFirefox ? "DOMMouseScroll" : "mousewheel", handler: function(e) { return self._handleMouseWheel(e ? e : window.event); }}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			handlers.push({target: div, type: "click", handler: function(e) { self._handleRulerEvent(e ? e : window.event); }}); //$NON-NLS-0$
			handlers.push({target: div, type: "dblclick", handler: function(e) { self._handleRulerEvent(e ? e : window.event); }}); //$NON-NLS-0$
			handlers.push({target: div, type: "mousemove", handler: function(e) { self._handleRulerEvent(e ? e : window.event); }}); //$NON-NLS-0$
			handlers.push({target: div, type: "mouseover", handler: function(e) { self._handleRulerEvent(e ? e : window.event); }}); //$NON-NLS-0$
			handlers.push({target: div, type: "mouseout", handler: function(e) { self._handleRulerEvent(e ? e : window.event); }}); //$NON-NLS-0$
		},
		_getWindow: function() {
			return getWindow(this._parent.ownerDocument);
		},
		_ignoreEvent: function(e) {
			var node = e.target;
			while (node && node !== this._clientDiv) {
				if (node.ignore) { return true; }
				node = node.parentNode;
			}
			return false;
		},
		_init: function(options) {
			var parent = options.parent;
			if (typeof(parent) === "string") { //$NON-NLS-0$
				parent = (options.document || document).getElementById(parent);
			}
			if (!parent) { throw new Error("no parent"); } //$NON-NLS-0$
			options.parent = parent;
			options.model = options.model || new mTextModel.TextModel();
			var defaultOptions = this._defaultOptions();
			for (var option in defaultOptions) {
				if (defaultOptions.hasOwnProperty(option)) {
					var value;
					if (options[option] !== undefined) {
						value = options[option];
					} else {
						value = defaultOptions[option].value;
					}
					this["_" + option] = value; //$NON-NLS-0$
				}
			}
			this._keyModes = [];
			this._rulers = [];
			this._selection = [new Selection(0, 0, false)];
			this._linksVisible = false;
			this._redrawCount = 0;
			this._maxLineWidth = 0;
			this._maxLineIndex = -1;
			this._ignoreSelect = true;
			this._ignoreFocus = false;
			this._hasFocus = false;
			this._dragOffset = -1;
			this._isRangeRects = (!util.isIE || util.isIE >= 9) && typeof parent.ownerDocument.createRange().getBoundingClientRect === "function"; //$NON-NLS-0$
			this._isW3CEvents = parent.addEventListener;

			/* Auto scroll */
			this._autoScrollX = null;
			this._autoScrollY = null;
			this._autoScrollTimerID = null;
			this._AUTO_SCROLL_RATE = 50;
			this._grabControl = null;
			this._moseMoveClosure  = null;
			this._mouseUpClosure = null;
			
			/* Double click */
			this._lastMouseX = 0;
			this._lastMouseY = 0;
			this._lastMouseTime = 0;
			this._clickCount = 0;
			this._clickTime = 250;
			this._clickDist = 5;
			this._isMouseDown = false;
			this._doubleClickSelection = null;
			
			/* Scroll */
			this._hScroll = 0;
			this._vScroll = 0;

			/* IME */
			this._imeOffset = -1;
			
			/* Create elements */
			this._createActions();
			this._createView();
		},
		_checkOverlayScroll: function() {
			if (util.isMac && util.isWebkit) {
				if (!this._metrics.invalid && this._metrics.scrollWidth === 0) {
					var viewDiv = this._viewDiv;
					var overlay = this._isOverOverlayScroll();
					if (overlay.vertical || overlay.horizontal) {
						viewDiv.style.pointerEvents = ""; //$NON-NLS-0$
					} else {
						viewDiv.style.pointerEvents = "none"; //$NON-NLS-0$
					}
				}
			}	
		},
		_isOverOverlayScroll: function() {
			var scrollShowing = new Date().getTime() - this._lastScrollTime < 200;
			if (!scrollShowing) {
				return {};
			}
			var rect = this._viewDiv.getBoundingClientRect();
			var x = this._lastMouseMoveX;
			var y = this._lastMouseMoveY;
			var overlayScrollWidth = 15;
			return {
				vertical: rect.top <= y && y < rect.bottom && rect.right - overlayScrollWidth <= x && x < rect.right,
				horizontal: rect.bottom - overlayScrollWidth <= y && y < rect.bottom && rect.left <= x && x < rect.right
			};
		},
		_startUndo: function() {
			if (this._undoStack) {
				var self = this;
				this._compoundChange = this._undoStack.startCompoundChange({
					end: function() {
						self._compoundChange = null;
					}
				});
			}
		},
		_endUndo: function() {
			if (this._undoStack) {
				this._undoStack.endCompoundChange();
			}
		},
		_modifyContent: function(e, caretAtEnd) {
			if (this._readonly && !e._code) {
				return false;
			}
			e.type = "Verify"; //$NON-NLS-0$
			var oldStart = e.start = e.selection[0].start;
			var oldEnd = e.end = e.selection[0].end;
			this.onVerify(e);
			if (oldStart !== e.start) e.selection[0].start = e.start;
			if (oldEnd !== e.end) e.selection[0].end = e.end;

			if (e.text === null || e.text === undefined) { return false; }
			
			if (e.selection.length > 1) this.setRedraw(false);
			
			var undo = this._compoundChange;
			if (undo) {
				if (!Selection.compare(this._getSelections(), undo.owner.selection)) {
					this._endUndo();
					if (e.selection.length > 1) this._startUndo();
				}
			} else {
				if (e.selection.length > 1) this._startUndo();
			}
			
			var model = this._model;
			try {
				if (e._ignoreDOMSelection) { this._ignoreDOMSelection = true; }
				var offset = 0, i = 0;
				e.selection.forEach(function(selection) {
					selection.start += offset;
					selection.end += offset;
					var text = Array.isArray(e.text) ? e.text[i] : e.text;
					model.setText(text, selection.start, selection.end);
					offset += (selection.start - selection.end) + text.length;
					selection.setCaret(caretAtEnd ? selection.start + text.length : selection.start);
					i++;
				});
			} finally {
				if (e._ignoreDOMSelection) { this._ignoreDOMSelection = false; }
			}
			this._setSelection(e.selection, true);
			
			undo = this._compoundChange;
			if (undo) undo.owner.selection = e.selection;
			
			if (e.selection.length > 1) this.setRedraw(true);

			this.onModify({type: "Modify"}); //$NON-NLS-0$
			return true;
		},
		_onModelChanged: function(modelChangedEvent) {
			modelChangedEvent.type = "ModelChanged"; //$NON-NLS-0$
			this.onModelChanged(modelChangedEvent);
			modelChangedEvent.type = "Changed"; //$NON-NLS-0$
			var start = modelChangedEvent.start;
			var addedCharCount = modelChangedEvent.addedCharCount;
			var removedCharCount = modelChangedEvent.removedCharCount;
			var addedLineCount = modelChangedEvent.addedLineCount;
			var removedLineCount = modelChangedEvent.removedLineCount;
			
			var selections = this._getSelections();
			selections.forEach(function(selection) {
				if (selection.end > start) {
					if (selection.end > start && selection.start < start + removedCharCount) {
						// selection intersects replaced text. set caret behind text change
						selection.setCaret(start + addedCharCount);
					} else {
						// move selection to keep same text selected
						selection.start +=  addedCharCount - removedCharCount;
						selection.end +=  addedCharCount - removedCharCount;
					}
				}
			});
			this._setSelection(selections, false, false);
			
			var model = this._model;
			var startLine = model.getLineAtOffset(start);
			var child = this._getLineNext();
			while (child) {
				var lineIndex = child.lineIndex;
				if (startLine <= lineIndex && lineIndex <= startLine + removedLineCount) {
					if (startLine === lineIndex && !child.modelChangedEvent && !child.lineRemoved) {
						child.modelChangedEvent = modelChangedEvent;
						child.lineChanged = true;
					} else {
						child.lineRemoved = true;
						child.lineChanged = false;
						child.modelChangedEvent = null;
					}
				}
				if (lineIndex > startLine + removedLineCount) {
					child.lineIndex = lineIndex + addedLineCount - removedLineCount;
					child._line.lineIndex = child.lineIndex;
				}
				child = this._getLineNext(child);
			}
			if (this._lineHeight) {
				var args = [startLine, removedLineCount].concat(newArray(addedLineCount));
				Array.prototype.splice.apply(this._lineHeight, args);
			}
			if (!this._wrapMode) {
				if (startLine <= this._maxLineIndex && this._maxLineIndex <= startLine + removedLineCount) {
					this._checkMaxLineIndex = this._maxLineIndex;
					this._maxLineIndex = -1;
					this._maxLineWidth = 0;
				}
			}
			this._update();
		},
		_onModelChanging: function(modelChangingEvent) {
			modelChangingEvent.type = "ModelChanging"; //$NON-NLS-0$
			this.onModelChanging(modelChangingEvent);
			modelChangingEvent.type = "Changing"; //$NON-NLS-0$
		},
		_queueUpdate: function() {
			if (this._updateTimer || this._ignoreQueueUpdate) { return; }
			var self = this;
			var window = this._getWindow();
			this._updateTimer = window.setTimeout(function() { 
				self._updateTimer = null;
				self._update();
			}, 0);
		},
		_rangesToSelections: function(ranges) {
			var selections = [];
			var charCount = this._model.getCharCount();
			ranges.forEach(function(range) {
				var selection;
				if (range instanceof Selection) {
					selection = range.clone();
				} else {
					var start = range.start;
					var end = range.end;
					var caret = start > end;
					if (caret) {
						var tmp = start;
						start = end;
						end = tmp;
					}
					start = Math.max(0, Math.min (start, charCount));
					end = Math.max(0, Math.min (end, charCount));
					selection = new Selection(start, end, caret);
				}
				selections.push(selection);
			});
			return selections;
		},
		_resetLineHeight: function(startLine, endLine) {
			if (this._wrapMode || this._variableLineHeight) {
				if (startLine !== undefined && endLine !== undefined) {
					for (var i = startLine; i < endLine; i++) {
						this._lineHeight[i] = undefined;
					}
				} else {
					this._lineHeight = newArray(this._model.getLineCount());
				}
				this._calculateLineHeightTimer();
			} else {
				this._lineHeight = null;
			}
		},
		_resetLineWidth: function() {
			var clientDiv = this._clientDiv;
			if (clientDiv) {
				var child = clientDiv.firstChild;
				while (child) {
					child.lineWidth = undefined;
					child = child.nextSibling;
				}
			}
		},
		_reset: function() {
			this._maxLineIndex = -1;
			this._maxLineWidth = 0;
			this._topChild = null;
			this._bottomChild = null;
			this._topIndexY = 0;
			this._variableLineHeight = false;
			this._resetLineHeight();
			this._setSelection(new Selection(0, 0, false), false, false);
			if (this._viewDiv) {
				this._viewDiv.scrollLeft = 0;
				this._viewDiv.scrollTop = 0;
			}
			var clientDiv = this._clientDiv;
			if (clientDiv) {
				var child = clientDiv.firstChild;
				while (child) {
					child.lineRemoved = true;
					child = child.nextSibling;
				}
				/*
				* Bug in Firefox.  For some reason, the caret does not show after the
				* view is refreshed.  The fix is to toggle the contentEditable state and
				* force the clientDiv to loose and receive focus if it is focused.
				*/
				if (util.isFirefox < 13) {
					this._fixCaret ();
				}
			}
		},
		_scrollViewAnimated: function (pixelX, pixelY, callback) {
			var window = this._getWindow();
			if (callback && this._scrollAnimation) {
				var self = this;
				this._animation = new Animation({
					window: window,
					duration: this._scrollAnimation,
					curve: [pixelY, 0],
					onAnimate: function(x) {
						var deltaY = pixelY - Math.floor(x);
						self._scrollView (0, deltaY);
						pixelY -= deltaY;
					},
					onEnd: function() {
						self._animation = null;
						self._scrollView (pixelX, pixelY);
						if (callback) {
							window.setTimeout(callback, 0);
						}
					}
				});
				this._animation.play();
			} else {
				this._scrollView (pixelX, pixelY);
				if (callback) {
					window.setTimeout(callback, 0);
				}
			}
		}, 
		_scrollView: function (pixelX, pixelY) {
			/*
			* Always set _ensureCaretVisible to false so that the view does not scroll
			* to show the caret when scrollView is not called from showCaret().
			*/
			this._ensureCaretVisible = false;
			
			/*
			* Scrolling is done only by setting the scrollLeft and scrollTop fields in the
			* view div. This causes an update from the scroll event. In some browsers 
			* this event is asynchronous and forcing update page to run synchronously
			* leads to redraw problems. 
			* On Chrome 11, the view redrawing at times when holding PageDown/PageUp key.
			* On Firefox 4 for Linux, the view redraws the first page when holding 
			* PageDown/PageUp key, but it will not redraw again until the key is released.
			*/
			var viewDiv = this._viewDiv;
			if (pixelX) { viewDiv.scrollLeft += pixelX; }
			if (pixelY) { viewDiv.scrollTop += pixelY; }
		},
		_setClipboardText: function (text, event) {
			var clipboardText;
			// IE
			var window = this._getWindow();
			var clipboardData = window.clipboardData;
			// WebKit and Firefox > 21
			if (!clipboardData && event) {
				clipboardData = event.clipboardData;
			}
			if (clipboardData) {
				clipboardText = [];
				convertDelimiter(text, function(t) {clipboardText.push(t);}, function() {clipboardText.push(util.platformDelimiter);});
				/*
				* Note that setData() succeeds on Firefox 22 and greater, but the return value is not a boolean like IE and Chrome.
				*/
				var success = clipboardData.setData(util.isIE ? "Text" : "text/plain", clipboardText.join("")); //$NON-NLS-1$ //$NON-NLS-0$
				if (success || util.isFirefox > 21) {
					return true;
				}
			}
			var document = this._parent.ownerDocument;
			var child = util.createElement(document, "pre"); //$NON-NLS-0$
			child.style.position = "fixed"; //$NON-NLS-0$
			child.style.left = "-1000px"; //$NON-NLS-0$
			convertDelimiter(text, 
				function(t) {
					child.appendChild(document.createTextNode(t));
				}, 
				function() {
					child.appendChild(util.createElement(document, "br")); //$NON-NLS-0$
				}
			);
			child.appendChild(document.createTextNode(" ")); //$NON-NLS-0$
			this._clientDiv.appendChild(child);
			var range = document.createRange();
			range.setStart(child.firstChild, 0);
			range.setEndBefore(child.lastChild);
			var sel = window.getSelection();
			if (sel.rangeCount > 0) { sel.removeAllRanges(); }
			sel.addRange(range);
			var self = this;
			/** @ignore */
			var cleanup = function() {
				if (child && child.parentNode === self._clientDiv) {
					self._clientDiv.removeChild(child);
				}
				self._updateDOMSelection();
			};
			var result = false;
			/* 
			* Try execCommand first, it works on firefox with clipboard permission,
			* chrome 5, safari 4.
			*/
			this._ignoreCopy = true;
			try {
				result = document.execCommand("copy", false, null); //$NON-NLS-0$
			} catch (e) {}
			this._ignoreCopy = false;
			if (!result) {
				if (event) {
					window.setTimeout(cleanup, 0);
					return false;
				}
			}
			/* no event and no permission, copy can not be done */
			cleanup();
			return true;
		},
		_setGrab: function (target) {
			if (target === this._grabControl) { return; }
			if (target) {
				if (target.setCapture) { target.setCapture(); }
				this._grabControl = target;
			} else {
				if (this._grabControl.releaseCapture) { this._grabControl.releaseCapture(); }
				this._grabControl = null;
			}
		},
		_setLinksVisible: function(visible) {
			if (this._linksVisible === visible) { return; }
			this._linksVisible = visible;
			/*
			* Feature in IE.  The client div looses focus and does not regain it back
			* when the content editable flag is reset. The fix is to remember that it
			* had focus when the flag is cleared and give focus back to the div when
			* the flag is set.
			*/
			if (util.isIE && visible) {
				this._hadFocus = this._hasFocus;
			}
			var clientDiv = this._clientDiv;
			clientDiv.contentEditable = !visible;
			if (this._hadFocus && !visible) {
				clientDiv.focus();
			}
			if (this._overlayDiv) {
				this._overlayDiv.style.zIndex = visible ? "-1" : "1"; //$NON-NLS-1$ //$NON-NLS-0$
			}
			var line = this._getLineNext();
			while (line) {
				line._line.updateLinks();
				line = this._getLineNext(line);
			}
			this._updateDOMSelection();
		},
		_setSelection: function (selection, scroll, update, callback, pageScroll, add, preserveCursorX) {
			if (selection) {
				if (update === undefined) { update = true; }
				var oldSelection = this._getSelections(), newSelection;
				if (Array.isArray(selection)) {
					newSelection = selection;
				} else if (add) {
					newSelection = oldSelection.concat([selection]);
				} else {
					newSelection = [selection];
				}
				this._selection = Selection.merge(newSelection);
				
				if (!preserveCursorX) {
					newSelection.forEach(function(sel) {
						sel._columnX = -1;
					});
				}

				/* 
				* Always showCaret(), even when the selection is not changing, to ensure the
				* caret is visible. Note that some views do not scroll to show the caret during
				* keyboard navigation when the selection does not chanage. For example, line down
				* when the caret is already at the last line.
				*/
				if (scroll !== false) { /*update = !*/this._showCaret(false, callback, scroll, pageScroll); }
				
				/* 
				* Sometimes the browser changes the selection 
				* as result of method calls or "leaked" events. 
				* The fix is to set the visual selection even
				* when the logical selection is not changed.
				*/
				if (update) { this._updateDOMSelection(); }
				
				if (!Selection.compare(oldSelection, newSelection)) {
					var e = {
						type: "Selection", //$NON-NLS-0$
						oldValue: Selection.convert(oldSelection),
						newValue: Selection.convert(newSelection)
					};
					this.onSelection(e);
				}
			}
		},
		_setSelectionTo: function (x, y, down, extent, add, drag) {
			var model = this._model;
			var selections = this._getSelections();
			var pt = this.convert({x: x, y: y}, "page", "document"); //$NON-NLS-1$ //$NON-NLS-0$
			var lineIndex = this._getLineIndex(pt.y);
			var line = this._getLine(lineIndex);
			var offset = line.getOffset(pt.x, pt.y - this._getLinePixel(lineIndex));
			if (drag && !extent) {
				if (Selection.contains(selections, offset)) {
					this._dragOffset = offset;
					line.destroy();
					return false;
				}
			}
			if (this._blockSelection) {
				selections = this._getBlockSelections(selections, lineIndex, pt);
			} else {
				var selection;
				if (!down) {
					selection = Selection.editing(selections);
				} else if (extent) {
					selection = selections[selections.length - 1];
					selection._editing = true;
				} else {
					selection = new Selection(0, 0);
					selection._editing = true;
					if (add) {
						selections.push(selection);
					} else {
						selections = [selection];
					}
					selection._docX = pt.x;
				}
				if (this._clickCount === 1) {
					selection.extend(offset);
					if (!extent) { selection.collapse(); }
				} else {
					var word = (this._clickCount & 1) === 0;
					var start, end;
					if (word) {
						if (this._doubleClickSelection) {
							if (offset >= this._doubleClickSelection.start) {
								start = this._doubleClickSelection.start;
								end = line.getNextOffset(offset, {unit:"wordend", count:1}); //$NON-NLS-0$
							} else {
								start = line.getNextOffset(offset, {unit:"word", count:-1}); //$NON-NLS-0$
								end = this._doubleClickSelection.end;
							}
						} else {
							start = line.getNextOffset(offset, {unit:"word", count:-1}); //$NON-NLS-0$
							end = line.getNextOffset(start, {unit:"wordend", count:1}); //$NON-NLS-0$
						}
					} else {
						if (this._doubleClickSelection) {
							var doubleClickLine = model.getLineAtOffset(this._doubleClickSelection.start);
							if (lineIndex >= doubleClickLine) {
								start = model.getLineStart(doubleClickLine);
								end = model.getLineEnd(lineIndex);
							} else {
								start = model.getLineStart(lineIndex);
								end = model.getLineEnd(doubleClickLine);
							}
						} else {
							start = model.getLineStart(lineIndex);
							end = model.getLineEnd(lineIndex);
						}
					}
					selection.setCaret(start);
					selection.extend(end);
				}
			}
			this._setSelection(selections, true, true, null, false);
			line.destroy();
			return true;
		},
		_setFullSelection: function(fullSelection, init) {
			this._fullSelection = fullSelection;
			if (util.isWebkit) {
				this._fullSelection = fullSelection = true;
			}
			if (!this._domSelection) {
				this._domSelection = [];
				var window = this._getWindow();
				var self = this;
				this._cursorVisible = true;
				this._cursorTimer = window.setInterval(function() {
					self._cursorVisible = !self._cursorVisible;
					self._domSelection.forEach(function(domSelection) { domSelection.update(); });
				}, 500);
			}
			if (!init) {
				this._updateDOMSelection();
			}
		},
		_setBlockCursor: function (visible) {
			this._blockCursorVisible = visible;
			this._updateBlockCursorVisible();
		},
		_setOverwriteMode: function (overwrite) {
			this._overwriteMode = overwrite;
			this._updateBlockCursorVisible();
		},
		_updateBlockCursorVisible: function () {
			if (this._blockCursorVisible || this._overwriteMode) {
				if (!this._cursorDiv) {
					var viewDiv = this._viewDiv;
					var cursorDiv = util.createElement(viewDiv.ownerDocument, "div"); //$NON-NLS-0$
					cursorDiv.className = "textviewBlockCursor"; //$NON-NLS-0$
					this._cursorDiv = cursorDiv;
					cursorDiv.tabIndex = -1;
					cursorDiv.style.zIndex = "2"; //$NON-NLS-0$
					cursorDiv.style.color = "transparent"; //$NON-NLS-0$
					cursorDiv.style.position = "absolute"; //$NON-NLS-0$
					cursorDiv.style.pointerEvents = "none"; //$NON-NLS-0$
					cursorDiv.innerHTML = "&nbsp;"; //$NON-NLS-0$
					viewDiv.appendChild(cursorDiv);
					this._updateDOMSelection();
				}
			} else {
				if (this._cursorDiv) {
					this._cursorDiv.parentNode.removeChild(this._cursorDiv);
					this._cursorDiv = null;
				}
			}
		},
		_setMarginOffset: function(marginOffset, init) {
			this._marginOffset = marginOffset;
			this._marginDiv.style.display = marginOffset ? "block" : "none"; //$NON-NLS-1$ //$NON-NLS-0$
			if (!init) {
				this._metrics = this._calculateMetrics();
				this._queueUpdate();
			}
		},
		_setWrapOffset: function(wrapOffset, init) {
			this._wrapOffset = wrapOffset;
			if (!init) {
				this._metrics = this._calculateMetrics();
				this._queueUpdate();
			}
		},
		_setReadOnly: function (readOnly) {
			this._readonly = readOnly;
			this._clientDiv.setAttribute("aria-readonly", readOnly ? "true" : "false"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		},
		_setSingleMode: function (singleMode, init) {
			this._singleMode = singleMode;
			this._updateOverflow();
			this._updateStyle(init);
		},
		_setNoScroll: function (noScroll, init) {
			this._noScroll = noScroll;
			this._updateOverflow();
			this._updateStyle(init);
		},
		_setTabSize: function (tabSize, init) {
			this._tabSize = tabSize;
			this._customTabSize = undefined;
			var clientDiv = this._clientDiv;
			if (util.isOpera) {
				if (clientDiv) { clientDiv.style.OTabSize = this._tabSize+""; }
			} else if (util.isWebkit >= 537.1) {
				if (clientDiv) { clientDiv.style.tabSize = this._tabSize+""; }
			} else if (util.isFirefox >= 4) {
				if (clientDiv) {  clientDiv.style.MozTabSize = this._tabSize+""; }
			} else if (this._tabSize !== 8) {
				this._customTabSize = this._tabSize;
			}
			if (!init) {
				this.redrawLines();
				this._resetLineWidth();
			}
		},
		_setTheme: function(theme) {
			if (this._theme) {
				this._theme.removeEventListener("ThemeChanged", this._themeListener.onChanged); //$NON-NLS-0$
			}
			this._theme = theme;
			if (this._theme) {
				this._theme.addEventListener("ThemeChanged", this._themeListener.onChanged); //$NON-NLS-0$
			}
			this._setThemeClass(this._themeClass);
		},
		_setThemeClass: function (themeClass, init) {
			this._themeClass = themeClass;
			var viewContainerClass = "textview"; //$NON-NLS-0$
			var globalThemeClass = this._theme.getThemeClass();
			if (globalThemeClass) { viewContainerClass += " " + globalThemeClass; } //$NON-NLS-0$
			if (this._themeClass && globalThemeClass !== this._themeClass) { viewContainerClass += " " + this._themeClass; } //$NON-NLS-0$
			this._rootDiv.className = viewContainerClass;
			this._updateStyle(init);
		},
		_setUndoStack: function (undoStack) {
			this._undoStack = undoStack;
		},
		_setWrapMode: function (wrapMode, init) {
			this._wrapMode = wrapMode && this._wrappable;
			var clientDiv = this._clientDiv;
			if (this._wrapMode) {
				clientDiv.style.whiteSpace = "pre-wrap"; //$NON-NLS-0$
				clientDiv.style.wordWrap = "break-word"; //$NON-NLS-0$
			} else {
				clientDiv.style.whiteSpace = "pre"; //$NON-NLS-0$
				clientDiv.style.wordWrap = "normal"; //$NON-NLS-0$
			}
			this._updateOverflow();
			if (!init) {
				this.redraw();
				this._resetLineWidth();
			}
			this._resetLineHeight();
		},
		_showCaret: function (allSelection, callback, showOptions, pageScroll) {
			if (!this._clientDiv) { return; }
			if (this._redrawCount > 0) { return; }
			if (this._ignoreDOMSelection) { return; }
			var model = this._model;
			var selections = this._getSelections();
			var selection = Selection.editing(selections, this._autoScrollDir === "down"); //$NON-NLS-0$
			var scroll = this._getScroll();
			var caret = selection.getCaret();
			var start = selection.start;
			var end = selection.end;
			var startLine = model.getLineAtOffset(start);
			var endLine = model.getLineAtOffset(end);
			var endInclusive = Math.max(Math.max(start, model.getLineStart(endLine)), end - 1);
			var clientWidth = this._getClientWidth();
			var clientHeight = this._getClientHeight();
			var minScroll = clientWidth / 4;
			var bounds = this._getBoundsAtOffset(caret === start ? start : endInclusive);
			var left = bounds.left;
			var right = bounds.right;
			var top = bounds.top;
			var bottom = bounds.bottom;
			var selectionHeight = 0;
			var hasShowOptions = typeof showOptions === "object"; //$NON-NLS-0$
			if ((allSelection || hasShowOptions) && !selection.isEmpty()) {
				bounds = this._getBoundsAtOffset(caret === end ? start : endInclusive);
				selectionHeight = (bounds.bottom > bottom ? bounds.bottom : bottom) - (bounds.top < top ? bounds.top : top);
				if (allSelection) {
					if (bounds.top === top) {
						if (caret === start) {
							right = left + Math.min(bounds.right - left, clientWidth);
						} else {
							left = right - Math.min(right - bounds.left, clientWidth);
						}
					} else {
						if (caret === start) {
							bottom = top + Math.min(bounds.bottom - top, clientHeight);
						} else {
							top = bottom - Math.min(bottom - bounds.top, clientHeight);
						}
					}
				}
			}
			var pixelX = 0;
			if (left < scroll.x) {
				pixelX = Math.min(left - scroll.x, -minScroll);
			}
			if (right > scroll.x + clientWidth) {
				pixelX = Math.max(right - scroll.x - clientWidth, minScroll);
			}
			var pixelY = 0;
			if (top < scroll.y) {
				pixelY = top - scroll.y;
			} else if (bottom > scroll.y + clientHeight) {
				pixelY = bottom - scroll.y - clientHeight;
			}
			if (pageScroll) {
				if (pageScroll > 0) {
					if (pixelY > 0) {
						pixelY = Math.max(pixelY, pageScroll);
					}
				} else {
					if (pixelY < 0) {
						pixelY = Math.min(pixelY, pageScroll);
					}
				}
			}
			var alwaysScroll = hasShowOptions && showOptions.scrollPolicy === "always"; //$NON-NLS-0$
			if (pixelX !== 0 || pixelY !== 0 || alwaysScroll) {
				if (hasShowOptions) {
					var flag = pixelY > 0;
					if (pixelY === 0) {
						pixelY = top - scroll.y;
					}
					var viewAnchor = showOptions.viewAnchor;
					var selectionAnchor = showOptions.selectionAnchor;
					var viewAnchorOffset = Math.min(Math.max(0, showOptions.viewAnchorOffset || 0));
//					var selectionAnchorOffset = Math.min(Math.max(0, showOptions.selectionAnchorOffset || 0));
					if (viewAnchor === "top") { //$NON-NLS-0$
						pixelY += Math.floor(flag ? (1 - viewAnchorOffset) * clientHeight : -viewAnchorOffset * clientHeight);
					} else if (viewAnchor === "bottom") { //$NON-NLS-0$
						pixelY += Math.floor(flag ? viewAnchorOffset * clientHeight : -(1 - viewAnchorOffset) * clientHeight);
					} else if (viewAnchor === "center") { //$NON-NLS-0$
						pixelY += Math.floor(flag ? clientHeight / 2 + viewAnchorOffset * clientHeight : clientHeight / 2  - (1 - viewAnchorOffset) * clientHeight);
					} else { // caret is the default
						pixelY += Math.floor(flag ? viewAnchorOffset * clientHeight : -viewAnchorOffset * clientHeight);
					}
					if (startLine !== endLine) {
						if (selectionAnchor === "top" && caret !== start) { //$NON-NLS-0$
							pixelY += Math.floor(-selectionHeight);
						} else if (selectionAnchor === "bottom" && caret !== end) { //$NON-NLS-0$
							pixelY += Math.floor(selectionHeight);
						} else if (selectionAnchor === "center") { //$NON-NLS-0$
							pixelY += Math.floor(selectionHeight / 2);
						} else {
							// caret is the default
						}
					}
				} else if (pixelY !== 0 && typeof showOptions === "number") { //$NON-NLS-0$
					if (showOptions < 0) { showOptions = 0; }
					if (showOptions > 1) { showOptions = 1; }
					pixelY += Math.floor(pixelY > 0 ? showOptions * clientHeight : -showOptions * clientHeight);
				}
				this._scrollViewAnimated(pixelX, pixelY, callback);
				/*
				* When the view scrolls it is possible that one of the scrollbars can show over the caret.
				* Depending on the browser scrolling can be synchronous (Safari), in which case the change 
				* can be detected before showCaret() returns. When scrolling is asynchronous (most browsers), 
				* the detection is done during the next update page.
				*/
				if (clientHeight !== this._getClientHeight() || clientWidth !== this._getClientWidth()) {
					this._showCaret();
				} else {
					this._ensureCaretVisible = true;
				}
				return true;
			} else {
				if (callback) {
					callback();
				}
			}
			return false;
		},
		_startIME: function () {
			if (this._imeOffset !== -1) { return; }
			var selections = this._getSelections();
			this._modifyContent({text: "", selection: selections}, true);
			this._imeOffset = selections[0].start;
		},
		_unhookEvents: function() {
			this._model.removeEventListener("preChanging", this._modelListener.onChanging); //$NON-NLS-0$
			this._model.removeEventListener("postChanged", this._modelListener.onChanged); //$NON-NLS-0$
			this._theme.removeEventListener("ThemeChanged", this._themeListener.onChanged); //$NON-NLS-0$
			this._modelListener = null;
			for (var i=0; i<this._handlers.length; i++) {
				var h = this._handlers[i];
				removeHandler(h.target, h.type, h.handler);
			}
			this._handlers = null;
			if (this._mutationObserver) {
				this._mutationObserver.disconnect();
			}
		},
		_updateDOMSelection: function () {
			if (this._redrawCount > 0) { return; }
			if (this._ignoreDOMSelection) { return; }
			if (!this._clientDiv) { return; }
			var selection = this._getSelections();
			var domSelection = this._domSelection, i;
			if (domSelection.length < selection.length) {
				for (i=domSelection.length; i<selection.length; i++) {
					domSelection.push(new DOMSelection(this));
				}
			} else if (domSelection.length > selection.length) {
				domSelection.splice(selection.length).forEach(function(s) {
					s.destroy();
				});
			}
			for (i=0; i<domSelection.length; i++) {
				domSelection[i].setPrimary(i === 0);
				domSelection[i].setSelection(selection[i]);
			}
		},
		_update: function(hScrollOnly) {
			if (this._redrawCount > 0) { return; }
			if (this._updateTimer) {
				var window = this._getWindow();
				window.clearTimeout(this._updateTimer);
				this._updateTimer = null;
				hScrollOnly = false;
			}
			var clientDiv = this._clientDiv;
			var viewDiv = this._viewDiv;
			if (!clientDiv) { return; }
			if (this._metrics.invalid) {
				this._ignoreQueueUpdate = true;
				this._updateStyle();
				this._ignoreQueueUpdate = false;
			}
			var model = this._model;
			var scroll = this._getScroll(false);
			var viewPad = this._getViewPadding();
			var lineCount = model.getLineCount();
			var lineHeight = this._getLineHeight();
			var needUpdate = false;
			var hScroll = false, vScroll = false;
			var scrollbarWidth = this._metrics.scrollWidth;
			
			if (this._wrapMode) {
				clientDiv.style.width = (this._metrics.wrapWidth || this._getClientWidth()) + "px"; //$NON-NLS-0$
			}
			
			/*
			* topIndex - top line index of the view (maybe be particialy visible)
			* lineStart - top line minus one line (if any)
			* topIndexY - portion of the top line that is NOT visible.
			* top - topIndexY plus height of the line before top line (if any)
			*/
			var topIndex, lineStart, top, topIndexY,
				leftWidth, leftRect,
				clientWidth, clientHeight, scrollWidth, scrollHeight,
				totalHeight = 0, totalLineIndex = 0, tempLineHeight;
			if (this._lineHeight) {
				while (totalLineIndex < lineCount) {
					tempLineHeight = this._getLineHeight(totalLineIndex);
					if (totalHeight + tempLineHeight > scroll.y) {
						break;
					}
					totalHeight += tempLineHeight;
					totalLineIndex++;
				}
				topIndex = totalLineIndex;
				lineStart = Math.max(0, topIndex - 1);
				topIndexY = top = scroll.y - totalHeight;
				if (topIndex > 0) {
					top += this._getLineHeight(topIndex - 1);
				}
			} else {
				var firstLine = Math.max(0, scroll.y) / lineHeight;
				topIndex = Math.floor(firstLine);
				lineStart = Math.max(0, topIndex - 1);
				top = Math.round((firstLine - lineStart) * lineHeight);
				topIndexY = Math.round((firstLine - topIndex) * lineHeight);
				scrollHeight = lineCount * lineHeight;
			}
			this._topIndexY = topIndexY;
			var rootDiv = this._rootDiv;
			var rootWidth = rootDiv.clientWidth;
			var rootHeight = rootDiv.clientHeight;
			if (hScrollOnly) {
				leftWidth = 0;
				if (this._leftDiv) {
					leftRect = this._leftDiv.getBoundingClientRect();
					leftWidth = leftRect.right - leftRect.left;
				}
				clientWidth = this._getClientWidth();
				clientHeight = this._getClientHeight();
				scrollWidth = clientWidth;
				if (this._wrapMode) {
					if (this._metrics.wrapWidth) {
						scrollWidth = this._metrics.wrapWidth;
					}
				} else {
					scrollWidth = Math.max(this._maxLineWidth, scrollWidth);
				}
				while (totalLineIndex < lineCount) {
					tempLineHeight = this._getLineHeight(totalLineIndex, false);
					totalHeight += tempLineHeight;
					totalLineIndex++;
				}
				scrollHeight = totalHeight;
			} else {
				clientHeight = this._getClientHeight();

				var linesPerPage = Math.floor((clientHeight + topIndexY) / lineHeight);
				var bottomIndex = Math.min(topIndex + linesPerPage, lineCount - 1);
				var lineEnd = Math.min(bottomIndex + 1, lineCount - 1);
				
				var lineIndex, lineWidth;
				var child = clientDiv.firstChild;
				while (child) {
					lineIndex = child.lineIndex;
					var nextChild = child.nextSibling;
					if (!(lineStart <= lineIndex && lineIndex <= lineEnd) || child.lineRemoved || child.lineIndex === -1) {
						if (this._mouseWheelLine === child) {
							child.style.display = "none"; //$NON-NLS-0$
							child.lineIndex = -1;
						} else {
							clientDiv.removeChild(child);
						}
					}
					child = nextChild;
				}
	
				child = this._getLineNext();
				var document = viewDiv.ownerDocument;
				var frag = document.createDocumentFragment();
				for (lineIndex=lineStart; lineIndex<=lineEnd; lineIndex++) {
					if (!child || child.lineIndex > lineIndex) {
						new TextLine(this, lineIndex).create(frag, null);
					} else {
						if (frag.firstChild) {
							clientDiv.insertBefore(frag, child);
							frag = document.createDocumentFragment();
						}
						if (child && child.lineChanged) {
							child = new TextLine(this, lineIndex).create(frag, child);
							child.lineChanged = false;
						}
						child = this._getLineNext(child);
					}
				}
				if (frag.firstChild) { clientDiv.insertBefore(frag, child); }
	
				/*
				* Feature in WekKit. Webkit limits the width of the lines
				* computed below to the width of the client div.  This causes
				* the lines to be wrapped even though "pre" is set.  The fix
				* is to set the width of the client div to "0x7fffffffpx"
				* before computing the lines width.  Note that this value is
				* reset to the appropriate value further down.
				*/ 
				if (util.isWebkit && !this._wrapMode) {
					clientDiv.style.width = "0x7fffffffpx"; //$NON-NLS-0$
				}
	
				var rect;
				child = this._getLineNext();
				var bottomHeight = clientHeight + top;
				var foundBottomIndex = false;
				while (child) {
					lineWidth = child.lineWidth;
					if (lineWidth === undefined) {
						rect = child._line.getBoundingClientRect();
						lineWidth = child.lineWidth = Math.ceil(rect.right - rect.left);
						var lh = rect.bottom - rect.top;
						if (this._lineHeight) {
							this._lineHeight[child.lineIndex] = lh;
						} else if (lineHeight !== 0 && lh !== 0 && Math.ceil(lineHeight) !== Math.ceil(lh)) {
							this._variableLineHeight = true;
							this._lineHeight = [];
							this._lineHeight[child.lineIndex] = lh;
						}
					}
					if (this._lineHeight && !foundBottomIndex) {
						bottomHeight -= this._lineHeight[child.lineIndex];
						if (bottomHeight < 0) {
							bottomIndex = child.lineIndex;
							foundBottomIndex = true;
						}
					}
					if (!this._wrapMode) {
						if (lineWidth >= this._maxLineWidth) {
							this._maxLineWidth = lineWidth;
							this._maxLineIndex = child.lineIndex;
						}
						if (this._checkMaxLineIndex === child.lineIndex) { this._checkMaxLineIndex = -1; }
					}
					if (child.lineIndex === topIndex) { this._topChild = child; }
					if (child.lineIndex === bottomIndex) { this._bottomChild = child; }
					child = this._getLineNext(child);
				}
				if (this._checkMaxLineIndex !== -1) {
					lineIndex = this._checkMaxLineIndex;
					this._checkMaxLineIndex = -1;
					if (0 <= lineIndex && lineIndex < lineCount) {
						var line = new TextLine(this, lineIndex);
						rect = line.getBoundingClientRect();
						lineWidth = rect.right - rect.left;
						if (lineWidth >= this._maxLineWidth) {
							this._maxLineWidth = lineWidth;
							this._maxLineIndex = lineIndex;
						}
						line.destroy();
					}
				}
				
				while (totalLineIndex < lineCount) {
					tempLineHeight = this._getLineHeight(totalLineIndex, totalLineIndex <= bottomIndex);
					totalHeight += tempLineHeight;
					totalLineIndex++;
				}
				scrollHeight = totalHeight;
	
				// Update rulers
				this._updateRuler(this._leftDiv, topIndex, lineEnd, rootHeight);
				this._updateRuler(this._rightDiv, topIndex, lineEnd, rootHeight);
				this._updateRuler(this._innerRightDiv, topIndex, lineEnd, rootHeight);
				this._updateRuler(this._marginDiv, topIndex, lineEnd, rootHeight);
				
				leftWidth = 0;
				if (this._leftDiv) {
					leftRect = this._leftDiv.getBoundingClientRect();
					leftWidth = leftRect.right - leftRect.left;
				}
				var rightWidth = 0;
				if (this._rightDiv) {
					var rightRect = this._rightDiv.getBoundingClientRect();
					rightWidth = rightRect.right - rightRect.left;
				}
				viewDiv.style.left = leftWidth + "px"; //$NON-NLS-0$
				viewDiv.style.right = rightWidth + "px"; //$NON-NLS-0$

				/* Need to set the height first in order for the width to consider the vertical scrollbar */
				var scrollDiv = this._scrollDiv;
				scrollDiv.style.height = (scrollHeight + (util.isWebkit ? 0 : viewPad.bottom)) + "px"; //$NON-NLS-0$
				
				clientWidth = this._getClientWidth();
				if (!this._singleMode && !this._wrapMode && !this._noScroll) {
					var clientHeightNoScroll = clientHeight, clientHeightScroll = clientHeight;
					var oldHScroll = viewDiv.style.overflowX === "scroll"; //$NON-NLS-0$
					if (oldHScroll) {
						clientHeightNoScroll += scrollbarWidth;
					} else {
						clientHeightScroll -= scrollbarWidth;
					}
					var clientWidthNoScroll = clientWidth, clientWidthScroll = clientWidth;
					var oldVScroll = viewDiv.style.overflowY === "scroll"; //$NON-NLS-0$
					if (oldVScroll) {
						clientWidthNoScroll += scrollbarWidth;
					} else {
						clientWidthScroll -= scrollbarWidth;
					}
					clientHeight = clientHeightNoScroll;
					clientWidth = clientWidthNoScroll;
					if (scrollHeight > clientHeight) {
						vScroll = true;
						clientWidth = clientWidthScroll;
					}
					if (this._maxLineWidth > clientWidth) {
						hScroll = true;
						clientHeight = clientHeightScroll;
						if (scrollHeight > clientHeight) {
							vScroll = true;
							clientWidth = clientWidthScroll;
						}
					}
					if (oldHScroll !== hScroll) {
						viewDiv.style.overflowX = hScroll ? "scroll" : "hidden"; //$NON-NLS-1$ //$NON-NLS-0$
					}
					if (oldVScroll !== vScroll) {
						viewDiv.style.overflowY = vScroll ? "scroll" : "hidden"; //$NON-NLS-1$ //$NON-NLS-0$
					}
					needUpdate = oldHScroll !== hScroll || oldVScroll !== vScroll;
				}
				
				var width = clientWidth;
				if (this._wrapMode) {
					if (this._metrics.wrapWidth) {
						width = this._metrics.wrapWidth;
					}
				} else {
					width = Math.max(this._maxLineWidth + this._getInnerRightWidth(), width);
				}
				/*
				* Except by IE 8 and earlier, all other browsers are not allocating enough space for the right padding 
				* in the scrollbar. It is possible this a bug since all other paddings are considered.
				*/
				scrollWidth = width;
				if ((!util.isIE || util.isIE >= 9) && this._maxLineWidth > clientWidth) { width += viewPad.right + viewPad.left; }
				scrollDiv.style.width = width + "px"; //$NON-NLS-0$
				if (this._clipScrollDiv) {
					this._clipScrollDiv.style.width = width + "px"; //$NON-NLS-0$
				}
				/* Get the left scroll after setting the width of the scrollDiv as this can change the horizontal scroll offset. */
				scroll = this._getScroll(false);

				var innerRightDiv = this._innerRightDiv;
				if (innerRightDiv) {
					innerRightDiv.style.right = rightWidth + (viewDiv.style.overflowY === "scroll" ? this._metrics.scrollWidth : 0) + "px"; //$NON-NLS-1$ //$NON-NLS-0$
					innerRightDiv.style.bottom = (viewDiv.style.overflowX === "scroll" ? scrollbarWidth : 0) + "px"; //$NON-NLS-1$ //$NON-NLS-0$
				}
			}
			this._scrollHeight = scrollHeight;
			if (this._vScrollDiv) {
				var trackHeight = clientHeight - 8;
				var thumbHeight = Math.max(15, Math.ceil(Math.min(1, trackHeight / (scrollHeight + viewPad.top + viewPad.bottom)) * trackHeight));
				this._vScrollDiv.style.left = (leftWidth + clientWidth - 8) + "px"; //$NON-NLS-0$
				this._vScrollDiv.style.top = Math.floor(Math.max(0, (scroll.y * trackHeight / scrollHeight))) + "px"; //$NON-NLS-0$
				this._vScrollDiv.style.height = thumbHeight + "px"; //$NON-NLS-0$
			}
			if (!this._wrapMode && this._hScrollDiv) {
				var trackWidth = clientWidth - 8;
				var thumbWidth = Math.max(15, Math.ceil(Math.min(1, trackWidth / (this._maxLineWidth + viewPad.left + viewPad.right)) * trackWidth));
				this._hScrollDiv.style.left = leftWidth + Math.floor(Math.max(0, Math.floor(scroll.x * trackWidth / this._maxLineWidth))) + "px"; //$NON-NLS-0$
				this._hScrollDiv.style.top = (clientHeight - 9) + "px"; //$NON-NLS-0$
				this._hScrollDiv.style.width = thumbWidth + "px"; //$NON-NLS-0$
			}
			var left = scroll.x;	
			var clipDiv = this._clipDiv;
			var overlayDiv = this._overlayDiv;
			var marginDiv = this._marginDiv;
			var clipLeft, clipTop;
			if (marginDiv) {
				marginDiv.style.left = (-left + leftWidth + this._metrics.marginWidth + viewPad.left) + "px"; //$NON-NLS-0$
				marginDiv.style.bottom = (viewDiv.style.overflowX === "scroll" ? scrollbarWidth : 0) + "px"; //$NON-NLS-1$ //$NON-NLS-0$
			}
			if (clipDiv) {
				clipDiv.scrollLeft = left;
				clipDiv.scrollTop = 0;
				clipLeft = leftWidth + viewPad.left;
				clipTop = viewPad.top;
				var clipWidth = clientWidth;
				var clipHeight = clientHeight;
				var clientLeft = 0, clientTop = -top;
				if (scroll.x === 0) {
					clipLeft -= viewPad.left;
					clipWidth += viewPad.left;
					clientLeft = viewPad.left;
				} 
				if (scroll.x + clientWidth === scrollWidth) {
					clipWidth += viewPad.right;
				}
				if (scroll.y === 0) {
					clipTop -= viewPad.top;
					clipHeight += viewPad.top;
					clientTop += viewPad.top;
				}
				if (scroll.y + clientHeight === scrollHeight) { 
					clipHeight += viewPad.bottom; 
				}
				clipDiv.style.left = clipLeft + "px"; //$NON-NLS-0$
				clipDiv.style.top = clipTop + "px"; //$NON-NLS-0$
				clipDiv.style.right = (rootWidth - clipWidth - clipLeft) + "px"; //$NON-NLS-0$
				clipDiv.style.bottom = (rootHeight - clipHeight - clipTop) + "px"; //$NON-NLS-0$
				clientDiv.style.left = clientLeft + "px"; //$NON-NLS-0$
				clientDiv.style.top = clientTop + "px"; //$NON-NLS-0$
				clientDiv.style.width = scrollWidth + "px"; //$NON-NLS-0$
				clientDiv.style.height = (clientHeight + top) + "px"; //$NON-NLS-0$
				if (overlayDiv) {
					overlayDiv.style.left = clientDiv.style.left;
					overlayDiv.style.top = clientDiv.style.top;
					overlayDiv.style.width = clientDiv.style.width;
					overlayDiv.style.height = clientDiv.style.height;
				}
			} else {
				clipLeft = left;
				clipTop = top;
				var clipRight = left + clientWidth;
				var clipBottom = top + clientHeight;
				if (clipLeft === 0) { clipLeft -= viewPad.left; }
				if (clipTop === 0) { clipTop -= viewPad.top; }
				if (clipRight === scrollWidth) { clipRight += viewPad.right; }
				if (scroll.y + clientHeight === scrollHeight) { clipBottom += viewPad.bottom; }
				clientDiv.style.clip = "rect(" + clipTop + "px," + clipRight + "px," + clipBottom + "px," + clipLeft + "px)"; //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				clientDiv.style.left = (-left + leftWidth + viewPad.left) + "px"; //$NON-NLS-0$
				clientDiv.style.width = (this._wrapMode || util.isWebkit ? scrollWidth : clientWidth + left) + "px"; //$NON-NLS-0$
				if (!hScrollOnly) {
					clientDiv.style.top = (-top + viewPad.top) + "px"; //$NON-NLS-0$
					clientDiv.style.height = (clientHeight + top) + "px"; //$NON-NLS-0$
				}
				if (overlayDiv) {
					overlayDiv.style.clip = clientDiv.style.clip;
					overlayDiv.style.left = clientDiv.style.left;
					overlayDiv.style.width = clientDiv.style.width;
					if (!hScrollOnly) {
						overlayDiv.style.top = clientDiv.style.top;
						overlayDiv.style.height = clientDiv.style.height;
					}
				}
			}
			this._updateDOMSelection();

			if (needUpdate) {
				var ensureCaretVisible = this._ensureCaretVisible;
				this._ensureCaretVisible = false;
				if (ensureCaretVisible) {
					this._showCaret();
				}
				this._queueUpdate();
			}
		},
		_updateOverflow: function() {
			var viewDiv = this._viewDiv;
			if (this._noScroll) {
				viewDiv.style.overflow = "hidden"; //$NON-NLS-0$
			} else if (this._wrapMode) {
				viewDiv.style.overflowX = "hidden"; //$NON-NLS-0$
				viewDiv.style.overflowY = "scroll"; //$NON-NLS-0$
			} else {
				viewDiv.style.overflow = "hidden"; //$NON-NLS-0$
			}
		},
		_updateRuler: function (divRuler, topIndex, bottomIndex, rootHeight) {
			if (!divRuler) { return; }
			var document = this._parent.ownerDocument;
			var lineHeight = this._getLineHeight();
			var viewPad = this._getViewPadding();
			var div = divRuler.firstChild;
			while (div) {
				var ruler = div._ruler;
				var overview = ruler.getOverview();
				if (div.rulerChanged) {
					applyStyle(ruler.getRulerStyle(), div);
					divRuler.rulerWidth = undefined;
				}
				if (overview === "fixed") { //$NON-NLS-0$
					div.rulerChanged = false;
					div = div.nextSibling;
					continue;
				}
				var offset = lineHeight;
				if (overview === "page") { offset += this._topIndexY; } //$NON-NLS-0$
				div.style.top = -offset + "px"; //$NON-NLS-0$
				div.style.height = (rootHeight + offset) + "px"; //$NON-NLS-0$
				
				
				var widthDiv;
				var child = div.firstChild;
				if (child) {
					widthDiv = child;
					child = child.nextSibling;
				} else {
					widthDiv = util.createElement(document, "div"); //$NON-NLS-0$
					widthDiv.style.visibility = "hidden"; //$NON-NLS-0$
					div.appendChild(widthDiv);
				}
				var lineIndex, annotation;
				if (div.rulerChanged) {
					if (widthDiv) {
						lineIndex = -1;
						annotation = ruler.getWidestAnnotation();
						if (annotation) {
							applyStyle(annotation.style, widthDiv);
							if (annotation.html) {
								widthDiv.innerHTML = annotation.html;
							}
						}
						widthDiv.lineIndex = lineIndex;
						widthDiv.style.height = (lineHeight + viewPad.top) + "px"; //$NON-NLS-0$
					}
				}

				var lineDiv, frag, annotations;
				if (overview === "page") { //$NON-NLS-0$
					annotations = ruler.getAnnotations(topIndex, bottomIndex + 1);
					while (child) {
						lineIndex = child.lineIndex;
						var nextChild = child.nextSibling;
						if (!(topIndex <= lineIndex && lineIndex <= bottomIndex) || child.lineChanged) {
							div.removeChild(child);
						}
						child = nextChild;
					}
					child = div.firstChild.nextSibling;
					frag = document.createDocumentFragment();
					for (lineIndex=topIndex; lineIndex<=bottomIndex; lineIndex++) {
						if (!child || child.lineIndex > lineIndex) {
							lineDiv = util.createElement(document, "div"); //$NON-NLS-0$
							annotation = annotations[lineIndex];
							if (annotation) {
								applyStyle(annotation.style, lineDiv);
								if (annotation.html) {
									lineDiv.innerHTML = annotation.html;
								}
								lineDiv.annotation = annotation;
							}
							lineDiv.lineIndex = lineIndex;
							lineDiv.style.height = this._getLineHeight(lineIndex) + "px"; //$NON-NLS-0$
							frag.appendChild(lineDiv);
						} else {
							if (frag.firstChild) {
								div.insertBefore(frag, child);
								frag = document.createDocumentFragment();
							}
							if (child) {
								child = child.nextSibling;
							}
						}
					}
					if (frag.firstChild) { div.insertBefore(frag, child); }
				} else {
					var clientHeight = this._getClientHeight ();
					var lineCount = this._model.getLineCount ();
					var contentHeight = lineHeight * lineCount;
					var trackHeight = clientHeight + viewPad.top + viewPad.bottom - 2 * this._metrics.scrollWidth;
					var divHeight, arrowWidth;
					if (contentHeight < trackHeight) {
						divHeight = lineHeight;
						arrowWidth = viewPad.top;
					} else {
						divHeight = trackHeight / lineCount;
						arrowWidth = this._metrics.scrollWidth;
					}
					if (div.rulerChanged) {
						var count = div.childNodes.length;
						while (count > 1) {
							div.removeChild(div.lastChild);
							count--;
						}
						annotations = ruler.getAnnotations(0, lineCount);
						frag = document.createDocumentFragment();
						for (var prop in annotations) {
							lineIndex = prop >>> 0;
							if (lineIndex < 0) { continue; }
							lineDiv = util.createElement(document, "div"); //$NON-NLS-0$
							annotation = annotations[prop];
							applyStyle(annotation.style, lineDiv);
							lineDiv.style.position = "absolute"; //$NON-NLS-0$
							lineDiv.style.top = arrowWidth + lineHeight + Math.floor(lineIndex * divHeight) + "px"; //$NON-NLS-0$
							if (annotation.html) {
								lineDiv.innerHTML = annotation.html;
							}
							lineDiv.annotation = annotation;
							lineDiv.lineIndex = lineIndex;
							frag.appendChild(lineDiv);
						}
						div.appendChild(frag);
					} else if (div._oldTrackHeight !== trackHeight) {
						lineDiv = div.firstChild ? div.firstChild.nextSibling : null;
						while (lineDiv) {
							lineDiv.style.top = this._metrics.scrollWidth + lineHeight + Math.floor(lineDiv.lineIndex * divHeight) + "px"; //$NON-NLS-0$
							lineDiv = lineDiv.nextSibling;
						}
					}
					div._oldTrackHeight = trackHeight;
				}
				div.rulerChanged = false;
				div = div.nextSibling;
			}
		},
		_updateStyleSheet: function() {
			var styleText = "";
			if (util.isWebkit && this._metrics.scrollWidth > 0) {
				styleText += "\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"; //$NON-NLS-0$
			}
			if (styleText) {
				var document = this._clientDiv.ownerDocument;
				var node = document.getElementById("_textviewStyle"); //$NON-NLS-0$
				if (!node) {
					node = util.createElement(document, "style"); //$NON-NLS-0$
					node.id = "_textviewStyle"; //$NON-NLS-0$
					var head = document.getElementsByTagName("head")[0] || document.documentElement; //$NON-NLS-0$
					node.appendChild(document.createTextNode(styleText));
					head.insertBefore(node, head.firstChild);
				} else {
					node.removeChild(node.firstChild);
					node.appendChild(document.createTextNode(styleText));
				}
			}
		},
		_updateStyle: function (init) {
			if (!init && util.isIE) {
				this._rootDiv.style.lineHeight = "normal"; //$NON-NLS-0$
			}
			var metrics = this._metrics = this._calculateMetrics();
			if (this._variableLineHeight) {
				this._variableLineHeight = false;
				this._resetLineHeight();
			}
			if (util.isIE) {
				this._rootDiv.style.lineHeight = (metrics.lineHeight - (metrics.lineTrim.top + metrics.lineTrim.bottom)) + "px"; //$NON-NLS-0$
			} else {
				this._rootDiv.style.lineHeight = "normal"; //$NON-NLS-0$
			}
			this._updateStyleSheet();
			if (util.isMac && util.isWebkit) {
				var viewDiv = this._viewDiv;
				if (!metrics.invalid && metrics.scrollWidth === 0) {
					viewDiv.style.pointerEvents = "none"; //$NON-NLS-0$
					viewDiv.style.zIndex = "2"; //$NON-NLS-0$
				} else {
					viewDiv.style.pointerEvents = ""; //$NON-NLS-0$
					viewDiv.style.zIndex = ""; //$NON-NLS-0$
				}
			}
			if (!init) {
				this.redraw();
				this._resetLineWidth();
			}
		}
	};//end prototype
	mEventTarget.EventTarget.addMixin(TextView.prototype);
	
	return {TextView: TextView};
});


/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/projectionTextModel", ['orion/editor/textModel', 'orion/editor/eventTarget'], function(mTextModel, mEventTarget) { //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

	/**
	 * @class This object represents a projection range. A projection specifies a
	 * range of text and the replacement text. The range of text is relative to the
	 * base text model associated to a projection model.
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.ProjectionTextModel}<br/>
	 * {@link orion.editor.ProjectionTextModel#addProjection}<br/>
	 * </p>		 
	 * @name orion.editor.Projection
	 * 
	 * @property {Number} start The start offset of the projection range. 
	 * @property {Number} end The end offset of the projection range. This offset is exclusive.
	 * @property {String|orion.editor.TextModel} [text=""] The projection text to be inserted
	 */
	/**
	 * Constructs a new <code>ProjectionTextModel</code> based on the specified <code>TextModel</code>.
	 *
	 * @param {orion.editor.TextModel} baseModel The base text model.
	 *
	 * @name orion.editor.ProjectionTextModel
	 * @class The <code>ProjectionTextModel</code> represents a projection of its base text
	 * model. Projection ranges can be added to the projection text model to hide and/or insert
	 * ranges to the base text model.
	 * <p>
	 * The contents of the projection text model is modified when changes occur in the base model,
	 * projection model or by calls to {@link #addProjection} and {@link #removeProjection}.
	 * </p>
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.TextView}<br/>
	 * {@link orion.editor.TextModel}
	 * {@link orion.editor.TextView#setModel}
	 * </p>
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function ProjectionTextModel(baseModel) {
		this._model = baseModel;
		this._projections = [];
		var self = this;
		this._listener = {
			onChanged: function(e) {
				self._onChanged(e);
			},
			onChanging: function(e) {
				self._onChanging(e);
			}
		};
		baseModel.addEventListener("postChanged", this._listener.onChanged); //$NON-NLS-0$
		baseModel.addEventListener("preChanging", this._listener.onChanging); //$NON-NLS-0$
	}

	ProjectionTextModel.prototype = /** @lends orion.editor.ProjectionTextModel.prototype */ {
		/**
		 * Destroys this projection text model.
		 */
		destroy: function() {
			if (this._model) {
				this._model.removeEventListener("postChanged", this._listener.onChanged); //$NON-NLS-0$
				this._model.removeEventListener("preChanging", this._listener.onChanging); //$NON-NLS-0$
				this._model = null;
			}
		},
		/**
		 * Adds a projection range to the model.
		 * <p>
		 * The model must notify the listeners before and after the the text is
		 * changed by calling {@link #onChanging} and {@link #onChanged} respectively. 
		 * </p>
		 * @param {orion.editor.Projection} projection The projection range to be added.
		 * 
		 * @see orion.editor.ProjectionTextModel#removeProjection
		 */
		addProjection: function(projection) {
			if (!projection) {return;}
			//start and end can't overlap any exist projection
			var model = this._model, projections = this._projections;
			projection._lineIndex = model.getLineAtOffset(projection.start);
			projection._lineCount = model.getLineAtOffset(projection.end) - projection._lineIndex;
			var text = projection.text;
			if (!text) { text = ""; }
			if (typeof text === "string") { //$NON-NLS-0$
				projection._model = new mTextModel.TextModel(text, model.getLineDelimiter());
			} else {
				projection._model = text;
			}
			var eventStart = this.mapOffset(projection.start, true);
			var removedCharCount = projection.end - projection.start;
			var removedLineCount = projection._lineCount;
			var addedCharCount = projection._model.getCharCount();
			var addedLineCount = projection._model.getLineCount() - 1;
			var modelChangingEvent = {
				type: "Changing", //$NON-NLS-0$
				text: projection._model.getText(),
				start: eventStart,
				removedCharCount: removedCharCount,
				addedCharCount: addedCharCount,
				removedLineCount: removedLineCount,
				addedLineCount: addedLineCount
			};
			this.onChanging(modelChangingEvent);
			var index = this._binarySearch(projections, projection.start);
			projections.splice(index, 0, projection);
			var modelChangedEvent = {
				type: "Changed", //$NON-NLS-0$
				start: eventStart,
				removedCharCount: removedCharCount,
				addedCharCount: addedCharCount,
				removedLineCount: removedLineCount,
				addedLineCount: addedLineCount
			};
			this.onChanged(modelChangedEvent);
		},
		/**
		 * Returns all projection ranges of this model.
		 * 
		 * @return {orion.editor.Projection[]} The projection ranges.
		 * 
		 * @see orion.editor.ProjectionTextModel#addProjection
		 */
		getProjections: function() {
			return this._projections.slice(0);
		},
		/**
		 * Gets the base text model.
		 *
		 * @return {orion.editor.TextModel} The base text model.
		 */
		getBaseModel: function() {
			return this._model;
		},
		/**
		 * Maps offsets between the projection model and its base model.
		 *
		 * @param {Number} offset The offset to be mapped.
		 * @param {Boolean} [baseOffset=false] <code>true</code> if <code>offset</code> is in base model and
		 *	should be mapped to the projection model.
		 * @return {Number} The mapped offset
		 */
		mapOffset: function(offset, baseOffset) {
			var projections = this._projections, delta = 0, i, projection;
			if (baseOffset) {
				for (i = 0; i < projections.length; i++) {
					projection = projections[i];
					if (projection.start > offset) { break; }
					if (projection.end > offset) { return -1; }
					delta += projection._model.getCharCount() - (projection.end - projection.start);
				}
				return offset + delta;
			}
			for (i = 0; i < projections.length; i++) {
				projection = projections[i];
				if (projection.start > offset - delta) { break; }
				var charCount = projection._model.getCharCount();
				if (projection.start + charCount > offset - delta) {
					return -1;
				}
				delta += charCount - (projection.end - projection.start);
			}
			return offset - delta;
		},
		/**
		 * Removes a projection range from the model.
		 * <p>
		 * The model must notify the listeners before and after the the text is
		 * changed by calling {@link #onChanging} and {@link #onChanged} respectively. 
		 * </p>
		 * 
		 * @param {orion.editor.Projection} projection The projection range to be removed.
		 * 
		 * @see orion.editor.ProjectionTextModel#addProjection
		 */
		removeProjection: function(projection) {
			this._removeProjection(projection);
		},
		_removeProjection: function(projection, noEvents) {
			var i, delta = 0;
			for (i = 0; i < this._projections.length; i++) {
				var p = this._projections[i];
				if (p === projection) {
					projection = p;
					break;
				}
				delta += p._model.getCharCount() - (p.end - p.start);
			}
			if (i < this._projections.length) {
				var model = this._model;
				var eventStart = projection.start + delta;
				var addedCharCount = projection.end - projection.start;
				var addedLineCount = projection._lineCount;
				var removedCharCount = projection._model.getCharCount();
				var removedLineCount = projection._model.getLineCount() - 1;
				if (!noEvents) {
					var modelChangingEvent = {
						type: "Changing", //$NON-NLS-0$
						text: model.getText(projection.start, projection.end),
						start: eventStart,
						removedCharCount: removedCharCount,
						addedCharCount: addedCharCount,
						removedLineCount: removedLineCount,
						addedLineCount: addedLineCount
					};
					this.onChanging(modelChangingEvent);
				}
				this._projections.splice(i, 1);
				if (!noEvents) {
					var modelChangedEvent = {
						type: "Changed", //$NON-NLS-0$
						start: eventStart,
						removedCharCount: removedCharCount,
						addedCharCount: addedCharCount,
						removedLineCount: removedLineCount,
						addedLineCount: addedLineCount
					};
					this.onChanged(modelChangedEvent);
				}
			}
		},
		/** @ignore */
		_binarySearch: function (array, offset) {
			var high = array.length, low = -1, index;
			while (high - low > 1) {
				index = Math.floor((high + low) / 2);
				if (offset <= array[index].start) {
					high = index;
				} else {
					low = index;
				}
			}
			return high;
		},
		/**
		 * @see orion.editor.TextModel#getCharCount
		 */
		getCharCount: function() {
			var count = this._model.getCharCount(), projections = this._projections;
			for (var i = 0; i < projections.length; i++) {
				var projection = projections[i];
				count += projection._model.getCharCount() - (projection.end - projection.start);
			}
			return count;
		},
		/**
		 * @see orion.editor.TextModel#getLine
		 */
		getLine: function(lineIndex, includeDelimiter) {
			if (lineIndex < 0) { return null; }
			var model = this._model, projections = this._projections;
			var delta = 0, result = [], offset = 0, i, lineCount, projection;
			for (i = 0; i < projections.length; i++) {
				projection = projections[i];
				if (projection._lineIndex >= lineIndex - delta) { break; }
				lineCount = projection._model.getLineCount() - 1;
				if (projection._lineIndex + lineCount >= lineIndex - delta) {
					var projectionLineIndex = lineIndex - (projection._lineIndex + delta);
					if (projectionLineIndex < lineCount) {
						return projection._model.getLine(projectionLineIndex, includeDelimiter);
					} else {
						result.push(projection._model.getLine(lineCount));
					}
				}
				offset = projection.end;
				delta += lineCount - projection._lineCount;
			}
			offset = Math.max(offset, model.getLineStart(lineIndex - delta));
			for (; i < projections.length; i++) {
				projection = projections[i];
				if (projection._lineIndex > lineIndex - delta) { break; }
				result.push(model.getText(offset, projection.start));
				lineCount = projection._model.getLineCount() - 1;
				if (projection._lineIndex + lineCount > lineIndex - delta) {
					result.push(projection._model.getLine(0, includeDelimiter));
					return result.join("");
				}
				result.push(projection._model.getText());
				offset = projection.end;
				delta += lineCount - projection._lineCount;
			}
			var end = model.getLineEnd(lineIndex - delta, includeDelimiter);
			if (offset < end) {
				result.push(model.getText(offset, end));
			}
			return result.join("");
		},
		/**
		 * @see orion.editor.TextModel#getLineAtOffset
		 */
		getLineAtOffset: function(offset) {
			var model = this._model, projections = this._projections;
			var delta = 0, lineDelta = 0;
			for (var i = 0; i < projections.length; i++) {
				var projection = projections[i];
				if (projection.start > offset - delta) { break; }
				var charCount = projection._model.getCharCount();
				if (projection.start + charCount > offset - delta) {
					var projectionOffset = offset - (projection.start + delta);
					lineDelta += projection._model.getLineAtOffset(projectionOffset);
					delta += projectionOffset;
					break;
				}
				lineDelta += projection._model.getLineCount() - 1 - projection._lineCount;
				delta += charCount - (projection.end - projection.start);
			}
			return model.getLineAtOffset(offset - delta) + lineDelta;
		},
		/**
		 * @see orion.editor.TextModel#getLineCount
		 */
		getLineCount: function() {
			var model = this._model, projections = this._projections;
			var count = model.getLineCount();
			for (var i = 0; i < projections.length; i++) {
				var projection = projections[i];
				count += projection._model.getLineCount() - 1 - projection._lineCount;
			}
			return count;
		},
		/**
		 * @see orion.editor.TextModel#getLineDelimiter
		 */
		getLineDelimiter: function() {
			return this._model.getLineDelimiter();
		},
		/**
		 * @see orion.editor.TextModel#getLineEnd
		 */
		getLineEnd: function(lineIndex, includeDelimiter) {
			if (lineIndex < 0) { return -1; }
			var model = this._model, projections = this._projections;
			var delta = 0, offsetDelta = 0;
			for (var i = 0; i < projections.length; i++) {
				var projection = projections[i];
				if (projection._lineIndex > lineIndex - delta) { break; }
				var lineCount = projection._model.getLineCount() - 1;
				if (projection._lineIndex + lineCount > lineIndex - delta) {
					var projectionLineIndex = lineIndex - (projection._lineIndex + delta);
					return projection._model.getLineEnd (projectionLineIndex, includeDelimiter) + projection.start + offsetDelta;
				}
				offsetDelta += projection._model.getCharCount() - (projection.end - projection.start);
				delta += lineCount - projection._lineCount;
			}
			return model.getLineEnd(lineIndex - delta, includeDelimiter) + offsetDelta;
		},
		/**
		 * @see orion.editor.TextModel#getLineStart
		 */
		getLineStart: function(lineIndex) {
			if (lineIndex < 0) { return -1; }
			var model = this._model, projections = this._projections;
			var delta = 0, offsetDelta = 0;
			for (var i = 0; i < projections.length; i++) {
				var projection = projections[i];
				if (projection._lineIndex >= lineIndex - delta) { break; }
				var lineCount = projection._model.getLineCount() - 1;
				if (projection._lineIndex + lineCount >= lineIndex - delta) {
					var projectionLineIndex = lineIndex - (projection._lineIndex + delta);
					return projection._model.getLineStart (projectionLineIndex) + projection.start + offsetDelta;
				}
				offsetDelta += projection._model.getCharCount() - (projection.end - projection.start);
				delta += lineCount - projection._lineCount;
			}
			return model.getLineStart(lineIndex - delta) + offsetDelta;
		},
		/**
		 * @see orion.editor.TextModel#getText
		 */
		getText: function(start, end) {
			if (start === undefined) { start = 0; }
			var model = this._model, projections = this._projections;
			var delta = 0, result = [], i, projection, charCount;
			for (i = 0; i < projections.length; i++) {
				projection = projections[i];
				if (projection.start > start - delta) { break; }
				charCount = projection._model.getCharCount();
				if (projection.start + charCount > start - delta) {
					if (end !== undefined && projection.start + charCount > end - delta) {
						return projection._model.getText(start - (projection.start + delta), end - (projection.start + delta));
					} else {
						result.push(projection._model.getText(start - (projection.start + delta)));
						start = projection.end + delta + charCount - (projection.end - projection.start);
					}
				}
				delta += charCount - (projection.end - projection.start);
			}
			var offset = start - delta;
			if (end !== undefined) {
				for (; i < projections.length; i++) {
					projection = projections[i];
					if (projection.start > end - delta) { break; }
					result.push(model.getText(offset, projection.start));
					charCount = projection._model.getCharCount();
					if (projection.start + charCount > end - delta) {
						result.push(projection._model.getText(0, end - (projection.start + delta)));
						return result.join("");
					}
					result.push(projection._model.getText());
					offset = projection.end;
					delta += charCount - (projection.end - projection.start);
				}
				result.push(model.getText(offset, end - delta));
			} else {
				for (; i < projections.length; i++) {
					projection = projections[i];
					result.push(model.getText(offset, projection.start));
					result.push(projection._model.getText());
					offset = projection.end;
				}
				result.push(model.getText(offset));
			}
			return result.join("");
		},
		/** @ignore */
		_onChanged: function(modelChangedEvent) {
			var change = this._change;
			var start = change.baseStart, end = change.baseEnd, i;
			var projection, projections = this._projections;
			for (i = 0; i < projections.length; i++) {
				projection = projections[i];
				if (projection.end > start) { break; }
			}
			var rangeStart = i;
			for (i = 0; i < projections.length; i++) {
				projection = projections[i];
				if (projection.start >= end) { break; }
			}
			var rangeEnd = i;
			var model = this._model;
			var changeCount = change.baseText.length - (end - start);
			for (i = rangeEnd; i < projections.length; i++) {
				projection = projections[i];
				projection.start += changeCount;
				projection.end += changeCount;
				projection._lineIndex = model.getLineAtOffset(projection.start);
			}
			var removed = projections.splice(rangeStart, rangeEnd - rangeStart);
			for (i = 0; i < removed.length; i++) {
				if (removed[i].annotation) {
					removed[i].annotation._expand();
				}
			}
			var modelChangedEvent1 = {
				type: "Changed", //$NON-NLS-0$
				start: change.start,
				removedCharCount: change.removedCharCount,
				addedCharCount: change.addedCharCount,
				removedLineCount: change.removedLineCount,
				addedLineCount: change.addedLineCount
			};
			this.onChanged(modelChangedEvent1);
			this._change = undefined;
		},
		_onChanging: function(modelChangingEvent) {
			var hasChange = !!this._change;
			var change = this._change || {};
			var start = modelChangingEvent.start, end = start + modelChangingEvent.removedCharCount;
			change.baseStart = start;
			change.baseEnd = end;
			change.baseText = modelChangingEvent.text;
			change.addedLineCount = modelChangingEvent.addedLineCount;
			if (!hasChange) {
				this._change = change;
				change.text = modelChangingEvent.text;
				var projections = this._projections, delta, i, projection;
				function mapOffset(offset) {
					for (i = 0, delta = 0; i < projections.length; i++) {
						projection = projections[i];
						if (projection.start > offset) { break; }
						if (projection.end > offset) { return -1; }
						delta += projection._model.getCharCount() - (projection.end - projection.start);
					}
					return offset + delta;
				}
				change.start = mapOffset(start);
				if (change.start === -1) {
					change.text = this._model.getText(projection.start, start) + change.text;
					change.addedLineCount += this._model.getLineAtOffset(start) - this._model.getLineAtOffset(projection.start);
					change.start = projection.start + delta;
				}
				change.end = mapOffset(end);
				if (change.end === -1) {
					change.text += this._model.getText(end, projection.end);
					change.addedLineCount += this._model.getLineAtOffset(projection.end) - this._model.getLineAtOffset(end);
					change.end = projection.start + delta;
				}
			}
			change.addedCharCount = change.text.length;
			change.removedCharCount = change.end - change.start;
			change.removedLineCount = this.getLineAtOffset(change.end) - this.getLineAtOffset(change.start);
			var modelChangingEvent1 = {
				type: "Changing", //$NON-NLS-0$
				text: change.text,
				start: change.start,
				removedCharCount: change.removedCharCount,
				addedCharCount: change.addedCharCount,
				removedLineCount: change.removedLineCount,
				addedLineCount: change.addedLineCount
			};
			this.onChanging(modelChangingEvent1);
		},
		/**
		 * @see orion.editor.TextModel#onChanging
		 */
		onChanging: function(modelChangingEvent) {
			return this.dispatchEvent(modelChangingEvent);
		},
		/**
		 * @see orion.editor.TextModel#onChanged
		 */
		onChanged: function(modelChangedEvent) {
			return this.dispatchEvent(modelChangedEvent);
		},
		/**
		 * @see orion.editor.TextModel#setLineDelimiter
		 */
		setLineDelimiter: function(lineDelimiter) {
			this._model.setLineDelimiter(lineDelimiter);
		},
		/**
		 * @see orion.editor.TextModel#setText
		 */
		setText: function(text, start, end) {
			this._change = {
				text: text || "",
				start: start || 0,
				end: end === undefined ? this.getCharCount() : end
			};
			var projections = this._projections, delta, i, projection;
			function mapOffset(offset) {
				for (i = 0, delta = 0; i < projections.length; i++) {
					projection = projections[i];
					if (projection.start > offset - delta) { break; }
					var charCount = projection._model.getCharCount();
					if (projection.start + charCount > offset - delta) {
						return -1;
					}
					delta += charCount - (projection.end - projection.start);
				}
				return offset - delta;
			}
			var startProjection, endProjection;
			var mapStart = mapOffset(this._change.start);
			if (mapStart === -1) {
				startProjection = {
					projection: projection,
					start: this._change.start - (projection.start + delta)
				};
				mapStart = projection.end;
			}
			var mapEnd = mapOffset(this._change.end);
			if (mapEnd === -1) {
				endProjection = {
					projection: projection,
					end: this._change.end - (projection.start + delta)
				};
				mapEnd = projection.start;
			}
			if (startProjection && endProjection && startProjection.projection === endProjection.projection) {
				//TODO events - special case - change is completely inside of a projection
				projection._model.setText(this._change.text, startProjection.start, endProjection.end);
			} else {
				this._model.setText(this._change.text, mapStart, mapEnd);
				if (startProjection) {
					projection = startProjection.projection;
					projection._model.setText("", startProjection.start);
				}		
				if (endProjection) {
					projection = endProjection.projection;
					projection._model.setText("", 0, endProjection.end);
					projection.start = projection.end;
					projection._lineCount = 0;
				}
			}
			this._change = undefined;
		}
	};
	mEventTarget.EventTarget.addMixin(ProjectionTextModel.prototype);

	return {ProjectionTextModel: ProjectionTextModel};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/PageUtil',[],function(){
	function hash() {
		/* See https://bugzilla.mozilla.org/show_bug.cgi?id=483304 */
		var result = window.location.href.split("#")[1]; //$NON-NLS-0$
		result = result ? "#" + result : ""; //$NON-NLS-0$
		return result;
	}
	
	function matchResourceParameters(optURIText) {
		optURIText = optURIText || window.location.toString();
		var result = {resource:""};
		var hashIndex = optURIText.indexOf("#"); //$NON-NLS-0$
		if (hashIndex !== -1) {
			var text = optURIText.substring(hashIndex + 1);
			if (text.length !== 0) {
				var params = text.split(","); //$NON-NLS-0$
				result.resource = decodeURIComponent(params[0]);
				for (var i = 1; i < params.length; i++) {
					//We can not use params[i].split("=") here because a param's value may contain "=", which is not encoded.
					var pair = params[i];
					var parsed = /([^=]*)(=?)(.*)/.exec(pair);
					var name = decodeURIComponent(parsed[1] || ""); //$NON-NLS-0$
					var value = decodeURIComponent(parsed[3] || ""); //$NON-NLS-0$
					if(name !== "" && name !== "resource"){ //$NON-NLS-0$ //$NON-NLS-0$
						result[name] = value;
					}
				}
			}			
		}
		return result;
	}
	
	var httpOrHttps = new RegExp("^http[s]?","i");

	function validateURLScheme(url, optAllowedSchemes) {
		var absoluteURL = url;
		if (url.indexOf("://") === -1) { //$NON-NLS-0$
			var temp = document.createElement('a'); //$NON-NLS-0$
			temp.href = url;
	        absoluteURL = temp.href;
		}
		var match = false;
		if (optAllowedSchemes) {
			match = optAllowedSchemes.some(function(scheme){
				return new RegExp("^" + scheme + ":", "i").test(absoluteURL);
			});
		} else {
			match = httpOrHttps.test(absoluteURL);
		}
		if (match) {
			return url;
		} else {
			console.log("Illegal URL Scheme: '" + url + "'");
			return "";
		}
	}
	return {
		hash: hash,
		matchResourceParameters: matchResourceParameters,
		validateURLScheme: validateURLScheme	
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/objects',[], function() {
	function mixin(target/*, source..*/) {
		var hasOwnProperty = Object.prototype.hasOwnProperty;
		for (var j = 1, len = arguments.length; j < len; j++) {
			var source = arguments[j];
			for (var key in source) {
				if (hasOwnProperty.call(source, key)) {
					target[key] = source[key];
				}
			}
		}
		return target;
	}

	/**
	 * @name orion.objects
	 * @class Object-oriented helpers.
	 */
	return {
		/**
		 * Creates a shallow clone of the given <code>object</code>.
		 * @name orion.objects.clone
		 * @function
		 * @static
		 * @param {Object|Array} object The object to clone. Must be a "normal" Object or Array. Other built-ins,
		 * host objects, primitives, etc, will not work.
		 * @returns {Object|Array} A clone of <code>object</code>.
		 */
		clone: function(object) {
			if (Array.isArray(object)) {
				return Array.prototype.slice.call(object);
			}
			var clone = Object.create(Object.getPrototypeOf(object));
			mixin(clone, object);
			return clone;
		},
		/**
		 * Mixes all <code>source</code>'s own enumerable properties into <code>target</code>. Multiple source objects
		 * can be passed as varags.
		 * @name orion.objects.mixin
		 * @function
		 * @static
		 * @param {Object} target
		 * @param {Object} source
		 */
		mixin: mixin,
		/**
		 * Wraps an object into an Array if necessary.
		 * @name orion.objects.toArray
		 * @function
		 * @static
		 * @param {Object} obj An object.
		 * @returns {Array} Returns <code>obj</code> unchanged, if <code>obj</code> is an Array. Otherwise returns a 1-element Array
		 * whose sole element is <code>obj</code>.
		 */
		toArray: function(o) {
			return Array.isArray(o) ? o : [o];
		}
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/*global StopIteration*/
// URL Shim -- see http://url.spec.whatwg.org/ and http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html

(function() {
    try {
        var testURL;
        if (typeof window.URL === "function" && window.URL.length !== 0 &&
                (testURL = new window.URL("http://www.w3.org?q")).protocol === "http:" && testURL.query) {
            return;
        }
    } catch (e) {}

    //[1]scheme, [2]authority, [3]path, [4]query, [5]fragment
    var _URI_RE = /^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;
    //[ userinfo "@" ] host [ ":" port ]
    var _AUTHORITY_RE = /^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/;

    var _NO_WS_RE = /^\S*$/;
    var _SCHEME_RE = /^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/;
    var _PORT_RE = /^\d*$/;
    var _HOST_RE = /^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/;
    var _HOSTPORT_RE = /^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/;
    var _PATH_RE = /^([^?#\s]*)$/;
    var _QUERY_RE = /^([^\s]*)$/;
    var _FRAGMENT_RE = _NO_WS_RE;
    var _USERNAME_PASSWORD_RE = /([^:]*):?(.*)/;

    var STOP_ITERATION = typeof StopIteration !== "undefined" ? StopIteration : new Error("Stop Iteration");
    var DEFAULT_PORTS = {
        "ftp:": "21",
            "gopher:": "70",
            "http:": "80",
            "https:": "443",
            "ws:": "80",
            "wss:": "443"
    };

    function _checkString(txt) {
        if (typeof txt !== "string") {
            throw new TypeError();
        }
    }

    function _parseQuery(query) {
        return query ? query.split("&") : [];
    }

    function _stringifyQuery(pairs) {
        if (pairs.length === 0) {
            return "";
        }
        return pairs.join("&");
    }

    function _parsePair(pair) {
        var parsed = /([^=]*)(?:=?)(.*)/.exec(pair);
        var key = parsed[1] ? decodeURIComponent(parsed[1]) : "";
        var value = parsed[2] ? decodeURIComponent(parsed[2]) : "";
        return [key, value];
    }

    function _stringifyPair(entry) {
        var pair = encodeURIComponent(entry[0]);
        if (entry[1]) {
            pair += "=" + encodeURIComponent(entry[1]);
        }
        return pair;
    }

    function _createMapIterator(url, kind) {
        var query = "";
        var pairs = [];
        var index = 0;
        return {
            next: function() {
                if (query !== url.query) {
                    query = url.query;
                    pairs = _parseQuery(query);
                }
                if (index < pairs.length) {
                    var entry = _parsePair(pairs[index++]);
                    switch (kind) {
                        case "keys":
                            return entry[0];
                        case "values":
                            return entry[1];
                        case "keys+values":
                            return [entry[0], entry[1]];
                        default:
                            throw new TypeError();
                    }
                }
                throw STOP_ITERATION;
            }
        };
    }

    // See http://url.spec.whatwg.org/#interface-urlquery
    function URLQuery(url) {
        Object.defineProperty(this, "_url", {
            get: function() {
                return url._url;
            }
        });
    }

    Object.defineProperties(URLQuery.prototype, {
        get: {
            value: function(key) {
                _checkString(key);
                var result;
                var pairs = _parseQuery(this._url.query);
                pairs.some(function(pair) {
                    var entry = _parsePair(pair);
                    if (entry[0] === key) {
                        result = entry[1];
                        return true;
                    }
                });
                return result;
            },
            enumerable: true
        },
        set: {
            value: function(key, value) {
                _checkString(key);
                _checkString(value);
                var pairs = _parseQuery(this._url.query);
                var found = pairs.some(function(pair, i) {
                    var entry = _parsePair(pair);
                    if (entry[0] === key) {
                        entry[1] = value;
                        pairs[i] = _stringifyPair(entry);
                        return true;
                    }
                });
                if (!found) {
                    pairs.push(_stringifyPair([key, value]));
                }
                this._url.query = _stringifyQuery(pairs);
            },
            enumerable: true
        },
        has: {
            value: function(key) {
                _checkString(key);
                var pairs = _parseQuery(this._url.query);
                return pairs.some(function(pair) {
                    var entry = _parsePair(pair);
                    if (entry[0] === key) {
                        return true;
                    }
                });
            },
            enumerable: true
        },
            "delete": {
            value: function(key) {
                _checkString(key);
                var pairs = _parseQuery(this._url.query);
                var filtered = pairs.filter(function(pair) {
                    var entry = _parsePair(pair);
                    return entry[0] !== key;
                });
                if (filtered.length !== pairs.length) {
                    this._url.query = _stringifyQuery(filtered);
                    return true;
                }
                return false;
            },
            enumerable: true
        },
        clear: {
            value: function() {
                this._url.query = "";
            },
            enumerable: true
        },
        forEach: {
            value: function(callback, thisArg) {
                if (typeof callback !== "function") {
                    throw new TypeError();
                }
                var iterator = _createMapIterator(this._url, "keys+values");
                try {
                    while (true) {
                        var entry = iterator.next();
                        callback.call(thisArg, entry[1], entry[0], this);
                    }
                } catch (e) {
                    if (e !== STOP_ITERATION) {
                        throw e;
                    }
                }
            },
            enumerable: true
        },
        keys: {
            value: function() {
                return _createMapIterator(this._url, "keys");
            },
            enumerable: true
        },
        values: {
            value: function() {
                return _createMapIterator(this._url, "values");
            },
            enumerable: true
        },
        items: {
            value: function() {
                return _createMapIterator(this._url, "keys+values");
            }
        },
        size: {
            get: function() {
                return _parseQuery(this._url.query).length;
            },
            enumerable: true
        },
        getAll: {
            value: function(key) {
                _checkString(key);
                var result = [];
                var pairs = _parseQuery(this._url.query);
                pairs.forEach(function(pair) {
                    var entry = _parsePair(pair);
                    if (entry[0] === key) {
                        result.push(entry[1]);
                    }
                });
                return result;
            },
            enumerable: true
        },
        append: {
            value: function(key, value) {
                _checkString(key);
                _checkString(value);
                var pairs = _parseQuery(this._url.query);
                pairs.push(_stringifyPair([key, value]));
                this._url.query = _stringifyQuery(pairs);
            },
            enumerable: true
        }
    });

    function _makeAbsoluteURL(url, base) {
        if (!url.scheme && base) {
            url.scheme = base.scheme;
            if (!url.host && base.host) {
                url.userinfo = base.userinfo;
                url.host = base.host;
                url.port = base.port;
                url.pathRelative = true;
            }
        }
        if (url.pathRelative) {
            if (!url.path) {
                url.path = base.path;
            } else if (url.path[0] !== "/") {
                var basePath = /^(.*\/)[^\/]*$/.exec(base.path)[1] || "/";
                url.path = basePath + url.path;
            }
        }
    }

    function _normalizeScheme(scheme) {
        return scheme.toLowerCase();
    }

    function _normalizePort(port) {
        return port ? (/[1-9]\d*$/).exec(port)[0] : "";
    }

    function _normalizePath(path) {
        var result = [];
        path.split("/").forEach(function(segment) {
            if (segment === "..") {
                result.pop();
            } else if (segment !== ".") {
                result.push(segment);
            }
        });
        return result.join("/");
    }


    function _normalizeURL(url) {
        if (url.scheme) {
            url.scheme = _normalizeScheme(url.scheme);
        }
        if (url.port) {
            url.port = _normalizePort(url.port);
        }
        if (url.host && url.path) {
            url.path = _normalizePath(url.path);
        }
    }

    function _encodeWhitespace(text) {
        return text.replace(/\s/g, function(c) {
            return "%" + c.charCodeAt(0).toString(16);
        });
    }

    function _parseURL(input, base) {
        if (typeof input !== "string") {
            throw new TypeError();
        }

        input = _encodeWhitespace(input);

        var parsedURI = _URI_RE.exec(input);
        if (!parsedURI) {
            return null;
        }
        var url = {};
        url.scheme = parsedURI[1] || "";
        if (url.scheme && !_SCHEME_RE.test(url.scheme)) {
            return null;
        }
        var authority = parsedURI[2];
        if (authority) {
            var parsedAuthority = _AUTHORITY_RE.exec(authority);
            url.userinfo = parsedAuthority[1];
            url.host = parsedAuthority[2];
            url.port = parsedAuthority[3];
            if (url.port && !_PORT_RE.test(url.port)) {
                return null;
            }
        }
        url.path = parsedURI[3];
        url.query = parsedURI[4];
        url.fragment = parsedURI[5];

        _makeAbsoluteURL(url, base);
        _normalizeURL(url);
        return url;
    }

    function _serialize(url) {
        var result = (url.scheme ? url.scheme + ":" : "");
        if (url.host) {
            result += "//";
            if (url.userinfo) {
                result += url.userinfo + "@";
            }
            result += url.host;
            if (url.port) {
                result += ":" + url.port;
            }
        }
        result += url.path;
        if (url.query) {
            result += "?" + url.query;
        }
        if (url.fragment) {
            result += "#" + url.fragment;
        }
        return result;
    }

    // See http://url.spec.whatwg.org/#api
    function URL(input, base) {
        var baseURL;
        if (base) {
            base = base.href || base;
            baseURL = _parseURL(base);
            if (!baseURL || !baseURL.scheme) {
                throw new SyntaxError();
            }
            Object.defineProperty(this, "_baseURL", {
                value: baseURL
            });
        }

        var url = _parseURL(input, baseURL);
        if (!url) {
            throw new SyntaxError();
        }

        Object.defineProperty(this, "_input", {
            value: input,
            writable: true
        });

        Object.defineProperty(this, "_url", {
            value: url,
            writable: true
        });

        var query = new URLQuery(this);
        Object.defineProperty(this, "query", {
            get: function() {
                return this._url ? query : null;
            },
            enumerable: true
        });
    }

    Object.defineProperties(URL.prototype, {
        href: {
            get: function() {
                return this._url ? _serialize(this._url) : this._input;
            },
            set: function(value) {
                _checkString(value);
                this._input = value;
                this._url = _parseURL(this._input, this._baseURL);
            },
            enumerable: true
        },
        origin: {
            get: function() {
                return (this._url && this._url.host ? this.protocol + "//" + this.host : "");
            },
            enumerable: true
        },
        protocol: {
            get: function() {
                return this._url ? this._url.scheme + ":" : ":";
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var scheme = (value.slice(-1) === ":") ? value.substring(0, value.length - 1) : value;
                if (scheme === "" || _SCHEME_RE.test(scheme)) {
                    this._url.scheme = _normalizeScheme(scheme);
                }

            },
            enumerable: true
        },
        _userinfo: { // note: not part of spec so not enumerable
            get: function() {
                return this._url ? this._url.userinfo : "";
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                this._url.userinfo = value;
            }
        },
        username: {
            get: function() {
                if (!this._url) {
                    return "";
                }
                var parsed = _USERNAME_PASSWORD_RE.exec(this._userinfo);
                var username = decodeURIComponent(parsed[1] || "");
                return username;
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var parsed = _USERNAME_PASSWORD_RE.exec(this._userinfo);
                var userpass = [encodeURIComponent(value || "")];
                if (parsed[2]) {
                    userpass.push(parsed[2]);
                }
                this._userinfo = userpass.join(":");
            },
            enumerable: true
        },
        password: {
            get: function() {
                if (!this._url) {
                    return "";
                }
                var parsed = _USERNAME_PASSWORD_RE.exec(this._userinfo);
                var password = decodeURIComponent(parsed[2] || "");
                return password;
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var parsed = _USERNAME_PASSWORD_RE.exec(this._userinfo);
                var userpass = [parsed[1] || ""];
                if (value) {
                    userpass.push(encodeURIComponent(value));
                }
                this._userinfo = userpass.join(":");
            },
            enumerable: true
        },
        host: {
            get: function() {
                var result = "";
                if (this._url && this._url.host) {
                    result += this._url.host;
                    if (this._url.port) {
                        result += ":" + this._url.port;
                    }
                }
                return result;
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var result = _HOSTPORT_RE.exec(value);
                if (result) {
                    this._url.host = result[1];
                    this._url.port = _normalizePort(result[2]);
                }
            },
            enumerable: true
        },
        hostname: {
            get: function() {
                return this._url ? this._url.host : "";
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var result = _HOST_RE.exec(value);
                if (result) {
                    this._url.host = value;
                }
            },
            enumerable: true
        },
        port: {
            get: function() {
                var port = this._url ? this._url.port || "" : "";
                if (port && port === DEFAULT_PORTS[this.protocol]) {
                    port = "";
                }
                return port;
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var result = _PORT_RE.exec(value);
                if (result) {
                    this._url.port = _normalizePort(value);
                }
            },
            enumerable: true
        },
        pathname: {
            get: function() {
                return this._url ? this._url.path : "";
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                var result = _PATH_RE.exec(value);
                if (result) {
                    if (this._url.host && value && value[0] !== "/") {
                        value = "/" + value;
                    }
                    this._url.path = value ? _normalizePath(value) : "";
                }
            },
            enumerable: true
        },
        search: {
            get: function() {
                return (this._url && this._url.query ? "?" + this._url.query : "");
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                if (value && value[0] === "?") {
                    value = value.substring(1);
                }
                var result = _QUERY_RE.exec(value);
                if (result) {
                    this._url.query = value;
                }
            },
            enumerable: true
        },
        hash: {
            get: function() {
                return (this._url && this._url.fragment ? "#" + this._url.fragment : "");
            },
            set: function(value) {
                _checkString(value);
                if (!this._url) {
                    return;
                }
                if (value && value[0] === "#") {
                    value = value.substring(1);
                }
                var result = _FRAGMENT_RE.exec(value);
                if (result) {
                    this._url.fragment = value;
                }
            },
            enumerable: true
        }
    });

	var _URL = window.URL || window.webkitURL;
    if (_URL && _URL.createObjectURL) {
        Object.defineProperty(URL, "createObjectURL", {
            value: _URL.createObjectURL.bind(_URL),
            enumerable: false
        });

        Object.defineProperty(URL, "revokeObjectURL", {
            value: _URL.revokeObjectURL.bind(_URL),
            enumerable: false
        });
    }
    window.URL = URL;
}());

define("orion/URL-shim", function(){});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
/*global URL*/
define('orion/PageLinks',[
	"require",
	"orion/Deferred",
	"orion/PageUtil",
	"orion/URITemplate",
	"orion/i18nUtil",
	"orion/objects",
	"orion/URL-shim"
], function(require, Deferred, PageUtil, URITemplate, i18nUtil, objects) {

	/**
	 * Returns the value of the <code>{OrionHome}</code> variable.
	 * @memberOf orion.PageLinks
	 * @function
	 * @returns {String} The value of the <code>{OrionHome}</code> variable.
	 */
	function getOrionHome() {
		if(!require.toUrl){
			return new URL("/", window.location.href).href.slice(0, -1);
		} else {
			// The idea here is to find the path of `orion/*` modules from the loader, and go up one folder to
			// the servlet context path. Finally, return a complete URL, slicing off the trailing `/`.
			// RequireJS 2.1.15:
			var orionSrcURL = new URL(require.toUrl("orion/"), window.location.href); //$NON-NLS-0$
			return new URL("../", orionSrcURL).href.slice(0, -1); //$NON-NLS-0$
		}
	}

	/**
	 * Reads metadata from an <code>orion.page.xxxxx</code> service extension.
	 * @memberOf orion.PageLinks
	 * @function
	 * @param {orion.ServiceRegistry} serviceRegistry The service registry.
	 * @param {String} [serviceName="orion.page.link"] Service name to read extensions from.
	 * @return {orion.Promise} A promise that resolves to an {@link orion.PageLinks.PageLinksInfo} object.
	 */
	function getPageLinksInfo(serviceRegistry, serviceName) {
		return _readPageLinksMetadata(serviceRegistry, serviceName).then(function(metadata) {
			return new PageLinksInfo(metadata);
		});
	}

	function _getPropertiesMap(serviceRef) {
		var props = {};
		serviceRef.getPropertyKeys().forEach(function(key) {
			if (key !== "objectClass" && key !== "service.names" && key !== "service.id" && key !== "__plugin__") //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				props[key] = serviceRef.getProperty(key);
		});
		return props;
	}

	/**
	 * Loads translated name if possible.
	 * @returns {orion.Promise} The info, with info.textContent set
	 */
	function _loadTranslatedName(info) {
		return i18nUtil.getMessageBundle(info.nls).then(function(messages) {
			info.textContent = info.nameKey ? messages[info.nameKey] : info.name;
			return info;
		}, function(error) {
			// Bundle failed to load. Fallback to untranslated name
			info.textContent = info.nameKey || info.name;
			return info;
		});
	}

	function _readPageLinksMetadata(serviceRegistry, serviceName) {
		serviceName = serviceName || "orion.page.link"; //$NON-NLS-0$

		// Read page links.
		// https://wiki.eclipse.org/Orion/Documentation/Developer_Guide/Plugging_into_Orion_pages
		var navLinks= serviceRegistry.getServiceReferences(serviceName);
		var params = PageUtil.matchResourceParameters(window.location.href);
		// TODO: should not be necessary, see bug https://bugs.eclipse.org/bugs/show_bug.cgi?id=373450
		var orionHome = getOrionHome();
		var locationObject = {OrionHome: orionHome, Location: params.resource};
		var navLinkInfos = [];
		navLinks.forEach(function(navLink) {
			var info = _getPropertiesMap(navLink);
			if (!info.uriTemplate || (!info.nls && !info.name)) {
				return; // missing data, skip
			}

			var uriTemplate = new URITemplate(info.uriTemplate);
			var expandedHref = uriTemplate.expand(locationObject);
			expandedHref = PageUtil.validateURLScheme(expandedHref);
			info.href = expandedHref;

			if(info.nls){
				navLinkInfos.push(_loadTranslatedName(info));
			} else {
				info.textContent = info.name;
				navLinkInfos.push(new Deferred().resolve(info));
			}
		});
		return Deferred.all(navLinkInfos);
	}

	// Categories apply to all orion.page.link* serviceNames, so cache them.
	var _cachedCategories;
	/**
	 * Reads info about page link categories.
	 * @returns {orion.Promise} Resolving to {@link orion.PageLinks.CategoriesInfo}
	 */
	function getCategoriesInfo(serviceRegistry) {
		// Read categories.
		var categoryInfos;
		if (!_cachedCategories) {
			categoryInfos = [];
			var navLinkCategories = serviceRegistry.getServiceReferences("orion.page.link.category"); //$NON-NLS-0$
			navLinkCategories.forEach(function(serviceRef) {
				var info = _getPropertiesMap(serviceRef);
				if (!info.id || (!info.name && !info.nameKey)) {
					return;
				}
				info.service = serviceRegistry.getService(serviceRef);
				if (info.nls) {
					categoryInfos.push(_loadTranslatedName(info));
				} else {
					info.textContent = info.name;
					categoryInfos.push(new Deferred().resolve(info));
				}
			});
			return Deferred.all(categoryInfos).then(function(infos) {
				_cachedCategories = new CategoriesInfo(infos);
				return _cachedCategories;
			});
		}
		return new Deferred().resolve(_cachedCategories);
	}

	function CategoriesInfo(categoriesArray) {
		var categories = this.categories = Object.create(null); // Maps category id {String} to category {Object}

		categoriesArray.forEach(function(category) {
			categories[category.id] = category;
		});
	}
	objects.mixin(CategoriesInfo.prototype, /** @lends orion.CategoriesInfo.CategoriesInfo.prototype */ {
		/**
		 * Returns the category IDs.
		 * @returns {String[]} The category IDs.
		 */
		getCategoryIDs: function() {
			return Object.keys(this.categories);
		},
		/**
		 * Returns the data for a given category.
		 * @param {String} id The category ID.
		 * @returns {Object} The category data.
		 */
		getCategory: function(id) {
			return this.categories[id] || null;
		}
	});

	/**
	 * @name orion.PageLinks.PageLinksInfo
	 * @class
	 * @description Provides access to info about page links read from an extension point.
	 */
	function PageLinksInfo(allPageLinks) {
		this.allPageLinks = allPageLinks;
		this.allPageLinks.sort(_comparePageLinks);
	}
	objects.mixin(PageLinksInfo.prototype, /** @lends orion.PageLinks.PageLinksInfo.prototype */ {
		/**
		 * Builds DOM elements for links
		 * @returns {Element[]} The links.
		 */
		createLinkElements: function() {
			return this.allPageLinks.map(function(info) {
				return _createLink(info.href, "_self", info.textContent); //$NON-NLS-0$
			});
		},
		/**
		 * @returns {Object[]} The links.
		 */
		getAllLinks: function() {
			return this.allPageLinks;
		}
	});

	function _comparePageLinks(a, b) {
		var n1 = a.textContent && a.textContent.toLowerCase();
		var n2 = b.textContent && b.textContent.toLowerCase();
		if (n1 < n2) { return -1; }
		if (n1 > n2) { return 1; }
		return 0;
	}

	function _createLink(href, target, textContent) {
		var a = document.createElement("a");
		a.href = href;
		a.target = target;
		a.classList.add("targetSelector");
		a.textContent = textContent;
		return a;
	}

	/**
	 * @name orion.PageLinks
	 * @class Utilities for reading <code>orion.page.link</code> services.
	 * @description Utilities for reading <code>orion.page.link</code> services.
	 */
	return {
		getCategoriesInfo: getCategoriesInfo,
		getPageLinksInfo: getPageLinksInfo,
		getOrionHome: getOrionHome
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd, node*/
define("orion/editor/tooltip", [ //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/editor/textView', //$NON-NLS-0$
	'orion/editor/projectionTextModel', //$NON-NLS-0$
	'orion/Deferred', //$NON-NLS-0$
	'orion/editor/util', //$NON-NLS-0$
	'orion/PageLinks', //$NON-NLS-0$
	'orion/URITemplate', //$NON-NLS-0$
	'orion/webui/littlelib', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(messages, mTextView, mProjectionTextModel, Deferred, textUtil, PageLinks, URITemplate, lib, util) {

	/** @private */
	function Tooltip (view) {
		this._view = view;
		this._create(view.getOptions("parent").ownerDocument); //$NON-NLS-0$
	}
	Tooltip.getTooltip = function(view) {
		if (!view._tooltip) {
			 view._tooltip = new Tooltip(view);
		}
		return view._tooltip;
	};
	Tooltip.prototype = /** @lends orion.editor.Tooltip.prototype */ {
		_create: function(document) {
			if (this._tooltipDiv) { return; }
			var tooltipDiv = this._tooltipDiv = util.createElement(document, "div"); //$NON-NLS-0$
			tooltipDiv.tabIndex = 0;
			tooltipDiv.className = "textviewTooltip"; //$NON-NLS-0$
			tooltipDiv.setAttribute("aria-live", "assertive"); //$NON-NLS-1$ //$NON-NLS-0$
			tooltipDiv.setAttribute("aria-atomic", "true"); //$NON-NLS-1$ //$NON-NLS-0$
			this._tooltipDiv.style.visibility = "hidden"; //$NON-NLS-0$
			var tooltipContents = this._tooltipContents = util.createElement(document, "div"); //$NON-NLS-0$
			tooltipDiv.appendChild(tooltipContents);
			document.body.appendChild(tooltipDiv);
			var self = this;
			textUtil.addEventListener(tooltipDiv, "mouseover", function(event) { //$NON-NLS-0$
				self._inTooltip = true;
			}, false);
			textUtil.addEventListener(tooltipDiv, "mouseout", function(event) { //$NON-NLS-0$
				self._inTooltip = false;
			}, false);
			textUtil.addEventListener(tooltipDiv, "keydown", function(event) { //$NON-NLS-0$
				if (event.keyCode === 27) {
					self.hide();
				}
			}, false);
			this._view.addEventListener("Destroy", function() { //$NON-NLS-0$
				self.destroy();
			});
		},
		_getWindow: function() {
			var document = this._tooltipDiv.ownerDocument;
			return document.defaultView || document.parentWindow;
		},
		destroy: function() {
			if (!this._tooltipDiv) { return; }
			this.hide();
			var parent = this._tooltipDiv.parentNode;
			if (parent) { parent.removeChild(this._tooltipDiv); }
			var document = this._tooltipDiv.ownerDocument;
			textUtil.removeEventListener(document, "mousedown", this._mouseDownHandler, true); //$NON-NLS-0$
			this._tooltipDiv = null;
		},
		_hasFocus: function() {
			var tooltipDiv = this._tooltipDiv;
			if (!tooltipDiv) { return false; }
			var document = tooltipDiv.ownerDocument;
			return textUtil.contains(tooltipDiv, document.activeElement);
		},
		_setContentRange: function(start, end) {
			this._contentRangeStart = start;
			this._contentRangeEnd = end;
			var tv = this._view;
			var curLine = tv.getLineAtOffset(start);
			var endLine = tv.getLineAtOffset(end);
			
			// Adjust start / end to be on the current line if necessary
			if (curLine !== endLine) {
				start = tv.getLineStart(curLine);
				// 'getLineEnd' isn't API in textView but is in textModel...
				end = tv.getModel().getLineEnd(curLine);
			}
			
			var height = tv.getLineHeight(curLine);
			var startPos = tv.getLocationAtOffset(start);
			var endPos = tv.getLocationAtOffset(end);
			
			var viewRect = { x: startPos.x, y: startPos.y, 
								width: endPos.x - startPos.x, height: height};
								
			viewRect = this._view.convert(viewRect, "document", "page"); //$NON-NLS-0$ //$NON-NLS-1$
			this._anchorRect = {left: viewRect.x, top: viewRect.y, 
								width: viewRect.width, height: viewRect.height};
		},
		_isInRect: function(rect, x, y) {
			if (!rect){
				return false;
			}
			var xOK = x >= rect.left && x <= (rect.left + rect.width);
			var yOK = y >= rect.top && y <= (rect.top + rect.height);
			return xOK && yOK;
		},
		/**
		 * @name hide
		 * @description Hides the current hover popup
		 * @function
		 * @public
		 * @param {int} hideDelay Delay the hide by this many millisecs (defaults to the 'hideDelay' field
		 * of this tooltip)
		*/
		hide: function() {
			if (!this.isVisible()) { return; }
			
			if (this._hasFocus()) {
				this._view.focus();
			}
			if (this._contentsView) {
				this._contentsView.destroy();
				this._contentsView = null;
			}
			if (this._tooltipContents) {
				this._tooltipContents.innerHTML = "";
			}
			this._tooltipDiv.style.visibility = "hidden"; //$NON-NLS-0$
			this._tooltipDiv.style.left = "auto"; //$NON-NLS-0$
			this._tooltipDiv.style.right = "auto";		 //$NON-NLS-0$	
			this._tooltipDiv.style.top = "auto";	 //$NON-NLS-0$		
			this._tooltipDiv.style.bottom = "auto";		 //$NON-NLS-0$	
			
			this._target = undefined;
			this._anchor = undefined;
			this._anchorRect = undefined;
			this._hoverRect = undefined;
			this._preventTooltipClose = undefined;
		},
		/**
		 * @name isVisible
		 * @description Returns a boolean indicating whether the tooltip is currently visible
		 * @function
		 * @public
		 * @returns {boolean} 'true' iff the tooltip is currently visible
		*/
		isVisible: function() {
			return this._tooltipDiv && this._tooltipDiv.style.visibility === "visible"; //$NON-NLS-0$
		},
		/**
		 * @name OKToHover
		 * @description Returns whether a new hover can be opened in the editor.  New hovers
		 * may be prevented from opening because an existing hover has focus or is otherwise unready
		 * to be closed. Provide x,y coordinates to check if that location is within the bounding rectangle
		 * around the tooltip.
		 * @function
		 * @param x Location to check if within bounds, usually a cursor location
		 * @param y Location to check if within bounds, usually a cursor location
		 * @returns {Boolean} returns whether a new hover can be opened in the editor
		 */
		OKToHover: function(x, y) {
			if (!this.isVisible()){
				return true;
			}
			if (this._preventTooltipClose && this._preventTooltipClose()){
				return false;
			}
			if (this._hasFocus()){
				return false;
			}
			return !this._isInRect(this._anchorRect, x, y);
		},
		/**
		 * @name OKToHide
		 * @description Returns whether an existing hover should be hidden or if it should stay open.
		 * A hover may stay open if it has focus or the user's mouse x and y coordinates are within the bounding
		 * rectangle around the tooltip.
		 * @function
		 * @param x Location to check if within bounds, usually a cursor location
		 * @param y Location to check if within bounds, usually a cursor location
		 * @returns {Boolean} returns whether the existing hover should be closed
		 */
		OKToHide: function(x, y) {
			if (!this.isVisible()){
				return false;
			}
			if (this._preventTooltipClose && this._preventTooltipClose()){
				return false;
			}
			if (this._hasFocus()){
				return false;
			}
			return !this._isInRect(this._hoverRect, x, y);
		},
		/**
		 * @name show
		 * @description Show the tooltip using the current target
		 * @function
		 * @public
		 * @param {boolean} autoHide If 'true' then the tooltip will call 'hide' once the 'hideDelay'
		 * timer expires. if 'false' then the tooltip will remain visible until dismissed by the User.
		 *
		 * Note that if 'autoHide' is false then the tooltip will attempt to set the focus onto the
		 * resulting tooltip.
		*/
		show: function(target, giveFocus) {
			if (!target) { return; }
			
			// Do we need to process this one ?
			if (this._isInRect(this._hoverRect, target.clientX, target.clientY)) {
				if (target.clientY <= this._anchorRect.top 
					|| target.clientY >= (this._anchorRect.top + this._anchorRect.height)) {
					return;
				}
			}
			
			var info = target.getTooltipInfo();

			if (!info) { return; }
			
			if (this.isVisible()) {
				this.hide();
			}
			
			// Allow the info to define the anchorRect (for rulers)
			if (info.anchorRect) {
				this._anchor = info.anchor;
				this._anchorRect = info.anchorRect;
			}
			
			this._target = target;
			
			var tooltipDiv = this._tooltipDiv, tooltipContents = this._tooltipContents;
			tooltipDiv.style.left = tooltipDiv.style.right = tooltipDiv.style.width = tooltipDiv.style.height = 
				tooltipContents.style.width = tooltipContents.style.height = "auto"; //$NON-NLS-0$
			var tooltipDoc = tooltipDiv.ownerDocument;
			var documentElement = tooltipDoc.documentElement;
			
			var contents = info.contents;
			if (contents instanceof Array) {
				contents = this._getAnnotationContents(contents);			
			}
			
			var hoverInfo;
			if (this.hover && info.offset !== undefined && !contents) {
				var context; 
				if (info.context){
					context = info.context;
				} else {
					context = {offset: info.offset};
				}
				hoverInfo = this.hover.computeHoverInfo(context);
			}
			
			if (typeof contents === "string") { //$NON-NLS-0$
				tooltipContents.innerHTML = contents;
			} else if (this._isNode(contents)) {
				tooltipContents.appendChild(contents);
			} else if (contents instanceof mProjectionTextModel.ProjectionTextModel) {
				var view = this._view;
				var options = view.getOptions();
				options.wrapMode = false;
				options.parent = tooltipContents;
				var tooltipTheme = "tooltipTheme"; //$NON-NLS-0$
				var theme = options.themeClass;
				if (theme) {
					theme = theme.replace(tooltipTheme, "");
					if (theme) { theme = " " + theme; } //$NON-NLS-0$
					theme = tooltipTheme + theme;
				} else {
					theme = tooltipTheme;
				}
				options.themeClass = theme;
				var contentsView = this._contentsView = new mTextView.TextView(options);
				//TODO need to find a better way of sharing the styler for multiple views
				var listener = {
					onLineStyle: function(e) {
						view.onLineStyle(e);
					}
				};
				contentsView.addEventListener("LineStyle", listener.onLineStyle); //$NON-NLS-0$
				contentsView.setModel(contents);
				var size = contentsView.computeSize();
				tooltipContents.style.width = size.width + "px"; //$NON-NLS-0$
				tooltipContents.style.height = size.height + "px"; //$NON-NLS-0$
				contentsView.resize();
			} else if (!(hoverInfo && hoverInfo.length)) {
				return;
			}
			
			if (info.anchor === "right") { //$NON-NLS-0$
				var right = documentElement.clientWidth - info.x;
				tooltipDiv.style.right = right + "px"; //$NON-NLS-0$
				tooltipDiv.style.maxWidth = (documentElement.clientWidth - right - 10) + "px"; //$NON-NLS-0$
			} else {
				var left = parseInt(this._getNodeStyle(tooltipDiv, "padding-left", "0"), 10); //$NON-NLS-1$ //$NON-NLS-0$
				left += parseInt(this._getNodeStyle(tooltipDiv, "border-left-width", "0"), 10); //$NON-NLS-1$ //$NON-NLS-0$
				left = info.x - left;
				tooltipDiv.style.left = left + "px"; //$NON-NLS-0$
				tooltipDiv.style.maxWidth = (documentElement.clientWidth - left - 10) + "px"; //$NON-NLS-0$
			}
			
			if (info.width) {
				tooltipDiv.style.width = info.width + "px"; //$NON-NLS-0$
			}
			if (info.height) {
				tooltipDiv.style.height = info.height + "px"; //$NON-NLS-0$
				tooltipDiv.style.overflowY = "auto"; //$NON-NLS-0$
			}
			
			var top = parseInt(this._getNodeStyle(tooltipDiv, "padding-top", "0"), 10); //$NON-NLS-1$ //$NON-NLS-0$
			top += parseInt(this._getNodeStyle(tooltipDiv, "border-top-width", "0"), 10); //$NON-NLS-1$ //$NON-NLS-0$
			top = info.y - top;
			tooltipDiv.style.top = top + "px"; //$NON-NLS-0$
			tooltipDiv.style.maxHeight = (documentElement.clientHeight - top - 10) + "px"; //$NON-NLS-0$
			tooltipDiv.style.opacity = "1"; //$NON-NLS-0$
			
			if (info.preventTooltipClose){
				this._preventTooltipClose = info.preventTooltipClose;
			}
			
			var self = this;
			if (hoverInfo) {
				hoverInfo.forEach(function(info) {
					Deferred.when(info, function (data) {
						if (data) {
							if (self._renderContent(tooltipDoc, tooltipContents, data)) {
								self._showTooltip(giveFocus, tooltipDiv);
							}
						}
					}, function(error) {
						if (typeof console !== "undefined") { //$NON-NLS-0$
							console.log("Error computing hover tooltip"); //$NON-NLS-0$
							console.log(error && error.stack);
						}
					});
				});
			}
			
			// Delay the showing of a tootip with no 'static' contents
			if (contents) {
				this._showTooltip(giveFocus, tooltipDiv);
			}
		},
		_showTooltip: function(giveFocus, tooltipDiv) {
			if (this.isVisible()){
				return;
			}

			// HACK! Fake a contentBox if necessary
			if (!this._anchorRect) {
				// Use the whole line
				var curOffset = this._view.getOffsetAtLocation(this._target.x, this._target.y);
				if (curOffset >= 0) {
					var start = this._view.getNextOffset(curOffset, 
										{ unit: "word", count: -1}); //$NON-NLS-0$
					var end = this._view.getNextOffset(curOffset, 
										{ unit: "word", count: 0}); //$NON-NLS-0$
					this._setContentRange(start, end);
				} else {
					this._anchorRect = {
						left: this._target.clientX-8, top: this._target.clientY -8,
						width: 16, height: 16
					};
				}
			}
			var tipDiv = this._tooltipDiv;
			
			// Align the tooltip with the anchor rect
			var divBounds = lib.bounds(tipDiv);
			if (this._anchor === 'right') { //$NON-NLS-0$
				var rightEdge = this._anchorRect.left + this._anchorRect.width;
				tipDiv.style.left = (rightEdge - divBounds.width) + "px"; //$NON-NLS-0$
				tipDiv.style.top = (this._anchorRect.top + this._anchorRect.height + 5) + "px"; //$NON-NLS-0$
				this._hoverRect = {
					left: rightEdge - divBounds.width, top: this._anchorRect.top,
					width: divBounds.width,
					height: this._anchorRect.height + divBounds.height + 5
				};
			} else {
				tipDiv.style.left = this._anchorRect.left + "px"; //$NON-NLS-0$
				tipDiv.style.top = (this._anchorRect.top + this._anchorRect.height + 5) + "px"; //$NON-NLS-0$
				this._hoverRect = {
					left: this._anchorRect.left, top: this._anchorRect.top,
					width: divBounds.width,
					height: this._anchorRect.height + divBounds.height + 5
				};
			}

			this._tooltipDiv.style.visibility = "visible"; //$NON-NLS-0$

			if (giveFocus === true) {
				this._setInitialFocus(tooltipDiv);
			}
		},
		_setInitialFocus: function(tooltipDiv) {
			// Any buttons ?
			var button = lib.$("button", tooltipDiv); //$NON-NLS-0$
			if (button) {
				button.focus();
				return;
			}
			// Any links ?
			var link = lib.$("a", tooltipDiv); //$NON-NLS-0$
			if (link) {
				link.focus();
				var self = this;
				link.addEventListener("click", function() { //$NON-NLS-0$
					self.hide();
				});
				return;
			}
			// Give up and focus on the first tabbable
			var toFocus = lib.firstTabbable(tooltipDiv);
			if (toFocus) {
				toFocus.focus();
			}
		},
		_renderContent: function(tooltipDoc, tooltipContents, data) {
			if (typeof data.content === 'undefined' && typeof data.uriTemplate === 'undefined') { //$NON-NLS-0$ //$NON-NLS-1$
			    return false;
			}
			var sectionDiv = util.createElement(tooltipDoc, "div"); //$NON-NLS-0$;
			// render the title, if any
			if (data.title) {
				var titleDiv = util.createElement(tooltipDoc, "div"); //$NON-NLS-0$;
				titleDiv.innerHTML = this.hover.renderMarkDown ? this.hover.renderMarkDown(data.title) : data.title;
				sectionDiv.appendChild(titleDiv);
			}
			var contentDiv = util.createElement(tooltipDoc, "div"); //$NON-NLS-0$
			switch(data.type) { //$NON-NLS-0$
				case 'delegatedUI': { //$NON-NLS-0$
					// TODO The delegated UI data type is experimental and not part of the API
					if (data.uriTemplate) {
						var options = {};
						options.id = 'Delegated UI Tooltip'; //$NON-NLS-0$
						options.uriTemplate = data.uriTemplate;
//					    options.params = inputManager.getFileMetadata();
						options.width = data.width;
						options.height = data.height;
						
						// TODO Push status messages to page message service (see editorCommands.js)
//						options.status = handleStatus;
						var divResult = this._createDelegatedUI(options);
						sectionDiv.appendChild(divResult);
					}
					break;
				}
				case 'html': { //$NON-NLS-0$
					if (data.content){
						// TODO The html data type is experimental and not part of the API
						var iframe = document.createElement("iframe"); //$NON-NLS-0$
						iframe.id = 'HtmlHover'; //$NON-NLS-0$
						iframe.name = 'HTML Hover'; //$NON-NLS-0$
						iframe.type = "text/html"; //$NON-NLS-0$
						iframe.sandbox = "allow-scripts allow-same-origin allow-forms"; //$NON-NLS-0$
						iframe.style.border = "none"; //$NON-NLS-0$
						iframe.style.width = "auto"; //$NON-NLS-0$
						iframe.style.height = "auto"; //$NON-NLS-0$
						iframe.srcdoc = data.content;
						if (data.width) {
							iframe.style.width = data.width;
						}
						if (data.height) {
							iframe.style.height = data.height;
						}
						sectionDiv.appendChild(iframe);
					}
					break;
				}
				case 'markdown': { //$NON-NLS-0$
					if (this.hover.renderMarkDown) {
						contentDiv.innerHTML = this.hover.renderMarkDown(data.content);
					}
					break;
				}
				default: {
					contentDiv.appendChild(tooltipDoc.createTextNode(data.content));
				}
			}
			sectionDiv.appendChild(contentDiv);
			tooltipContents.appendChild(sectionDiv);
			return true;
		},
		_getAnnotationContents: function(annotations) {
			var annotation;
			var newAnnotations = [];
			for (var j = 0; j < annotations.length; j++) {
				annotation = annotations[j];
				if (annotation.title !== "" && !annotation.groupAnnotation) { 
					newAnnotations.push(annotation); 
				}
			}
			annotations = newAnnotations;
			if (annotations.length === 0) {
				return null;
			}
			var self = this;
			var html;
			var document = this._tooltipDiv.ownerDocument;
			var view = this._view;
			var model = view.getModel();
			var baseModel = model.getBaseModel ? model.getBaseModel() : model;
			function getText(start, end) {
				var textStart = baseModel.getLineStart(baseModel.getLineAtOffset(start));
				var textEnd = baseModel.getLineEnd(baseModel.getLineAtOffset(end), true);
				return baseModel.getText(textStart, textEnd);
			}
			function getAnnotationHTML(annotation) {
				var title = annotation.title;
				var result = util.createElement(document, "div"); //$NON-NLS-0$
				result.className = "tooltipRow"; //$NON-NLS-0$
				if (annotation.html) {
					var htmlHolder = util.createElement(document, "div"); //$NON-NLS-0$
					htmlHolder.className = "tooltipImage"; //$NON-NLS-0$
					htmlHolder.innerHTML = annotation.html;
					if (htmlHolder.lastChild) {
						textUtil.addEventListener(htmlHolder.lastChild, "click", function() { //$NON-NLS-0$
							var start = annotation.start, end = annotation.end;
							if (model.getBaseModel) {
								start = model.mapOffset(start, true);
								end = model.mapOffset(end, true);
							}
							view.setSelection(start, end, 1 / 3, function() { self.hide(); });
						}, false);
					}
					result.appendChild(htmlHolder); //$NON-NLS-0$
				}
				if (!title) {
					title = getText(annotation.start, annotation.end);
				}
				if (typeof title === "function") { //$NON-NLS-0$
					title = annotation.title();
				}
				if (typeof title === "string") { //$NON-NLS-0$
					var span = util.createElement(document, "span"); //$NON-NLS-0$
					span.className = "tooltipTitle"; //$NON-NLS-0$
					span.appendChild(document.createTextNode(title));
					title = span;
				}
				result.appendChild(title);
				
				// Handle quick fixes
				if (self.hover) {
					self.hover.renderQuickFixes(annotation, result);
					var buttons = lib.$$("button", result); //$NON-NLS-0$
					for (var k=0; k<buttons.length; k++) {
						buttons[k].addEventListener("click", function() { //$NON-NLS-0$
							self.hide(0);
						});
					}
				}
				
				// Set the anchor rect to the annotation if it's not already set
				if (!self._anchorRect) {
					self._setContentRange(annotation.start, annotation.end);
				}
				return result;
			}
			if (annotations.length === 1) {
				annotation = annotations[0];
				if (annotation.title !== undefined) {
					html = getAnnotationHTML(annotation);
					if (html.firstChild) {
						var className = html.firstChild.className;
						if (className) { className += " "; } //$NON-NLS-0$
						className += "single"; //$NON-NLS-0$
						html.firstChild.className = className;
					}
					return html;
				} else {
					var newModel = new mProjectionTextModel.ProjectionTextModel(baseModel);
					var lineStart = baseModel.getLineStart(baseModel.getLineAtOffset(annotation.start));
					var charCount = baseModel.getCharCount();
					if (annotation.end !== charCount) {
						newModel.addProjection({start: annotation.end, end: charCount});
					}
					if (lineStart > 0) {
						newModel.addProjection({start: 0, end: lineStart});
					}
					return newModel;
				}
			} else {
				var tooltipHTML = util.createElement(document, "div"); //$NON-NLS-0$
				var em = util.createElement(document, "em"); //$NON-NLS-0$
				em.appendChild(document.createTextNode(messages.multipleAnnotations));
				tooltipHTML.appendChild(em);
				for (var i = 0; i < annotations.length; i++) {
					annotation = annotations[i];
					html = getAnnotationHTML(annotation);
					if (html) {
						tooltipHTML.appendChild(html);
					}
				}
				return tooltipHTML;
			}
		},

		/**
		 * @name _createDelegatedUI
		 * @description Creates a delegated UI section in the tooltip that renders an iframe with content from a URI
		 * @function
		 * @private
		 * @param options
		 * @returns the div containing the iframe
		 */
		_createDelegatedUI: function _createDelegedUI(options) {
			var uriTemplate = new URITemplate(options.uriTemplate);
			var params = options.params || {};
			params.OrionHome = params.OrionHome || PageLinks.getOrionHome();
			var href = uriTemplate.expand(params);
			var delegatedParent = document.createElement("div"); //$NON-NLS-0$
			var iframe = document.createElement("iframe"); //$NON-NLS-0$
			iframe.id = options.id;
			iframe.name = options.id;
			iframe.type = "text/html"; //$NON-NLS-0$
			iframe.sandbox = "allow-scripts allow-same-origin allow-forms"; //$NON-NLS-0$
			iframe.frameborder = options.border !== undefined ? options.border : 0;
			iframe.src = href;
			iframe.style.border = "none"; //$NON-NLS-0$
			iframe.style.width = "auto"; //$NON-NLS-0$
			iframe.style.height = "auto"; //$NON-NLS-0$
//			iframe.className = "delegatedUI"; //$NON-NLS-0$
			if (options.width) {
				delegatedParent.style.width = options.width;
				iframe.style.width = options.width;
			}
			if (options.height) {
				delegatedParent.style.height = options.height;
				iframe.style.height = options.height;
			}
//			iframe.style.visibility = 'hidden'; //$NON-NLS-0$
//			if (options.parent !== null) {
//				(options.parent || window.document.body).appendChild(delegatedParent);
//			}
//			iframe.style.left = options.left || (window.innerWidth - parseInt(iframe.clientWidth, 10))/2 + "px"; //$NON-NLS-0$
//			iframe.style.top = options.top || (window.innerHeight - parseInt(iframe.clientHeight, 10))/2 + "px"; //$NON-NLS-0$
//			iframe.style.visibility = '';

			// Listen for notification from the iframe.  We expect either a "result" or a "cancelled" property.
//			window.addEventListener("message", function _messageHandler(event) { //$NON-NLS-0$
//				if (event.source !== iframe.contentWindow) {
//					return;
//				}
//				if (typeof event.data === "string") { //$NON-NLS-0$
//					var data = JSON.parse(event.data);
//					if (data.pageService === "orion.page.delegatedUI" && data.source === options.id) { //$NON-NLS-0$
//						if (data.cancelled) {
//							// console.log("Delegated UI Cancelled");
//							if (options.cancelled) {
//								options.cancelled();
//							}
//						} else if (data.result) {
//							if (options.done) {
//								options.done(data.result);
//							}
//						} else if (data.Status || data.status) {
//							if (options.status) {
//								options.status(data.Status || data.status);
//							}
//						}
//						window.removeEventListener("message", _messageHandler, false); //$NON-NLS-0$
//						if (delegatedParent.parentNode) {
//							delegatedParent.parentNode.removeChild(delegatedParent);
//						}
//					}
//				}
//			}, false);

			delegatedParent.appendChild(iframe);
			return delegatedParent;
		},
		
		_getNodeStyle: function(node, prop, defaultValue) {
			return textUtil.getNodeStyle(node, prop, defaultValue);
		},
		_isNode: function (obj) {
			return typeof Node === "object" ? obj instanceof Node : //$NON-NLS-0$
				obj && typeof obj === "object" && typeof obj.nodeType === "number" && typeof obj.nodeName === "string"; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		}
	};
	return {Tooltip: Tooltip};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/annotations", ['i18n!orion/editor/nls/messages', 'orion/editor/eventTarget'], function(messages, mEventTarget) { //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	
	/**
	 * @class This object represents a regitry of annotation types.
	 * @name orion.editor.AnnotationType
	 */
	function AnnotationType() {
	}
	
	/**
	 * @class This object represents a decoration attached to a range of text. Annotations are added to a
	 * <code>AnnotationModel</code> which is attached to a <code>TextModel</code>.
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.AnnotationModel}<br/>
	 * {@link orion.editor.Ruler}<br/>
	 * </p>
	 * @name orion.editor.Annotation
	 *
	 * @property {String} type The annotation type (for example, orion.annotation.error).
	 * @property {Number} start The start offset of the annotation in the text model.
	 * @property {Number} end The end offset of the annotation in the text model.
	 * @property {String} html The HTML displayed for the annotation.
	 * @property {String} title The text description for the annotation.
	 * @property {orion.editor.Style} style The style information for the annotation used in the annotations ruler and tooltips.
	 * @property {orion.editor.Style} overviewStyle The style information for the annotation used in the overview ruler.
	 * @property {orion.editor.Style} rangeStyle The style information for the annotation used in the text view to decorate a range of text.
	 * @property {orion.editor.Style} lineStyle The style information for the annotation used in the text view to decorate a line of text.
	 */
	/**
	 * Constructs a new folding annotation.
	 *
	 * @param {Number} start The start offset of the annotation in the text model.
	 * @param {Number} end The end offset of the annotation in the text model.
	 * @param {orion.editor.ProjectionTextModel} projectionModel The projection text model.
	 *
	 * @class This object represents a folding annotation.
	 * @name orion.editor.FoldingAnnotation
	 */
	function FoldingAnnotation (start, end, projectionModel) {
		this.start = start;
		this.end = end;
		this._projectionModel = projectionModel;
		this.html = this._expandedHTML;
		this.style = this._expandedStyle;
		this.expanded = true;
	}

	FoldingAnnotation.prototype = /** @lends orion.editor.FoldingAnnotation.prototype */ {
		_expandedHTML: "<div class='annotationHTML expanded'></div>", //$NON-NLS-0$
		_expandedStyle: {styleClass: "annotation expanded"}, //$NON-NLS-0$
		_collapsedHTML: "<div class='annotationHTML collapsed'></div>", //$NON-NLS-0$
		_collapsedStyle: {styleClass: "annotation collapsed"}, //$NON-NLS-0$
		_collapse: function() {
			if (!this.expanded) { return false; }
			this.expanded = false;
			this.html = this._collapsedHTML;
			this.style = this._collapsedStyle;
			if (this._annotationModel) {
				this._annotationModel.modifyAnnotation(this);
			}
			return true;
		},
		_expand: function() {
			if (this.expanded) { return false; }
			this.expanded = true;
			this.html = this._expandedHTML;
			this.style = this._expandedStyle;
			if (this._annotationModel) {
				this._annotationModel.modifyAnnotation(this);
			}
			return true;
		},
		_collapseImpl: function (checkOverlaping) {
			if (this._collapse()) {
				if (checkOverlaping) {
					this._forEachOverlaping(function(annotation) {
						if (!annotation.expanded) {
							annotation._expandImpl(false);
							annotation._recollapse = true;
						}
					});
				}
				var projectionModel = this._projectionModel;
				var baseModel = projectionModel.getBaseModel();
				this._projection = {
					annotation: this,
					start: baseModel.getLineStart(baseModel.getLineAtOffset(this.start) + 1),
					end: baseModel.getLineEnd(baseModel.getLineAtOffset(this.end), true)
				};
				projectionModel.addProjection(this._projection);
			}
		},
		_expandImpl: function(checkOverlaping) {
			if (this._expand()) {
				this._projectionModel._removeProjection(this._projection, !this._annotationModel);
				if (checkOverlaping) {
					this._forEachOverlaping(function(annotation) {
						if (annotation._recollapse) {
							annotation._collapseImpl(false);
							annotation._recollapse = false;
						}
					});
				}
			}
		},
		_forEachOverlaping: function(callback) {
			if (!this._annotationModel) { return; }
			var annotations = this._annotationModel.getAnnotations(this.start, this.end);
			while (annotations.hasNext()) {
				var annotation = annotations.next();
				if (annotation !== this && annotation.type === AnnotationType.ANNOTATION_FOLDING) {
					callback.call(this, annotation);
				}
			}
		},
		/**
		 * Collapses the annotation.
		 */
		collapse: function () {
			this._recollapse = false;
			this._collapseImpl(true);
		},
		/**
		 * Expands the annotation.
		 */
		expand: function () {
			this._recollapse = false;
			this._expandImpl(true);
		}
	};
	 
	/**
	 * Error annotation type.
	 */
	AnnotationType.ANNOTATION_ERROR = "orion.annotation.error"; //$NON-NLS-0$
	/**
	 * Warning annotation type.
	 */
	AnnotationType.ANNOTATION_WARNING = "orion.annotation.warning"; //$NON-NLS-0$
	/**
	 * Task annotation type.
	 */
	AnnotationType.ANNOTATION_TASK = "orion.annotation.task"; //$NON-NLS-0$
	/**
	 * Breakpoint annotation type.
	 */
	AnnotationType.ANNOTATION_BREAKPOINT = "orion.annotation.breakpoint"; //$NON-NLS-0$
	/**
	 * Bookmark annotation type.
	 */
	AnnotationType.ANNOTATION_BOOKMARK = "orion.annotation.bookmark"; //$NON-NLS-0$
	/**
	 * Folding annotation type.
	 */
	AnnotationType.ANNOTATION_FOLDING = "orion.annotation.folding"; //$NON-NLS-0$
	/**
	 * Curent bracket annotation type.
	 */
	AnnotationType.ANNOTATION_CURRENT_BRACKET = "orion.annotation.currentBracket"; //$NON-NLS-0$
	/**
	 * Matching bracket annotation type.
	 */
	AnnotationType.ANNOTATION_MATCHING_BRACKET = "orion.annotation.matchingBracket"; //$NON-NLS-0$
	/**
	 * Current line annotation type.
	 */
	AnnotationType.ANNOTATION_CURRENT_LINE = "orion.annotation.currentLine"; //$NON-NLS-0$
	/**
	 * Current search annotation type.
	 */
	AnnotationType.ANNOTATION_CURRENT_SEARCH = "orion.annotation.currentSearch"; //$NON-NLS-0$
	/**
	 * Matching search annotation type.
	 */
	AnnotationType.ANNOTATION_MATCHING_SEARCH = "orion.annotation.matchingSearch"; //$NON-NLS-0$
	/**
	 * Read Occurrence annotation type.
	 */
	AnnotationType.ANNOTATION_READ_OCCURRENCE = "orion.annotation.readOccurrence"; //$NON-NLS-0$
	/**
	 * Write Occurrence annotation type.
	 */
	AnnotationType.ANNOTATION_WRITE_OCCURRENCE = "orion.annotation.writeOccurrence"; //$NON-NLS-0$
	/**
	 * Selected linked group annotation type.
	 */
	AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP = "orion.annotation.selectedLinkedGroup"; //$NON-NLS-0$
	/**
	 * Current linked group annotation type.
	 */
	AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP = "orion.annotation.currentLinkedGroup"; //$NON-NLS-0$
	/**
	 * Linked group annotation type.
	 */
	AnnotationType.ANNOTATION_LINKED_GROUP = "orion.annotation.linkedGroup"; //$NON-NLS-0$
	/**
	* Blame annotation type.
	*/
	AnnotationType.ANNOTATION_BLAME = "orion.annotation.blame"; //$NON-NLS-0$
	/**
	* Current Blame annotation type.
	*/
	AnnotationType.ANNOTATION_CURRENT_BLAME = "orion.annotation.currentBlame"; //$NON-NLS-0$
	/**
	 * Diff Added annotation type.
	 */
	AnnotationType.ANNOTATION_DIFF_ADDED = "orion.annotation.diffAdded"; //$NON-NLS-0$
	/**
	 * Diff Deleted annotation type.
	 */
	AnnotationType.ANNOTATION_DIFF_DELETED = "orion.annotation.diffDeleted"; //$NON-NLS-0$
	/**
	 * Diff Modification annotation type.
	 */
	AnnotationType.ANNOTATION_DIFF_MODIFIED = "orion.annotation.diffModified"; //$NON-NLS-0$

	/** @private */
	var annotationTypes = {};

	/**
	 * Register an annotation type.
	 *
	 * @param {String} type The annotation type (for example, orion.annotation.error).
	 * @param {Object|Function} properties The common annotation properties of the registered
	 *		annotation type. All annotations create with this annotation type will expose these
	 *		properties.
	 */
	AnnotationType.registerType = function(type, properties) {
		var constructor = properties;
		if (typeof constructor !== "function") { //$NON-NLS-0$
			constructor = function(start, end, title) {
				this.start = start;
				this.end = end;
				if (title !== undefined) { this.title = title; }
			};
			constructor.prototype = properties;
		}
		constructor.prototype.type = type;
		annotationTypes[type] = constructor;
		return type;
	};

	/**
	 * Creates an annotation of a given type with the specified start end end offsets.
	 *
	 * @param {String} type The annotation type (for example, orion.annotation.error).
	 * @param {Number} start The start offset of the annotation in the text model.
	 * @param {Number} end The end offset of the annotation in the text model.
	 * @param {String} [title] The text description for the annotation if different then the type description.
	 * @return {orion.editor.Annotation} the new annotation
	 */
	AnnotationType.createAnnotation = function(type, start, end, title) {
		return new (this.getType(type))(start, end, title);
	};

	/**
	 * Gets the registered annotation type with specified type. The returned
	 * value is a constructor that can be used to create annotations of the
	 * speficied type.  The constructor takes the start and end offsets of
	 * the annotation.
	 *
	 * @param {String} type The annotation type (for example, orion.annotation.error).
	 * @return {Function} The annotation type constructor ( i.e function(start, end, title) ).
	 */
	AnnotationType.getType = function(type) {
		return annotationTypes[type];
	};

	/** @private */
	function registerType(type, lineStyling) {
		var index = type.lastIndexOf('.'); //$NON-NLS-0$
		var suffix = type.substring(index + 1);
		var properties = {
			title: messages[suffix],
			style: {styleClass: "annotation " + suffix}, //$NON-NLS-0$
			html: "<div class='annotationHTML " + suffix + "'></div>", //$NON-NLS-1$ //$NON-NLS-0$
			overviewStyle: {styleClass: "annotationOverview " + suffix} //$NON-NLS-0$
		};
		if (lineStyling) {
			properties.lineStyle = {styleClass: "annotationLine " + suffix}; //$NON-NLS-0$
		} else {
			properties.rangeStyle = {styleClass: "annotationRange " + suffix}; //$NON-NLS-0$
		}
		AnnotationType.registerType(type, properties);
	}
	registerType(AnnotationType.ANNOTATION_ERROR);
	registerType(AnnotationType.ANNOTATION_WARNING);
	registerType(AnnotationType.ANNOTATION_TASK);
	registerType(AnnotationType.ANNOTATION_BREAKPOINT);
	registerType(AnnotationType.ANNOTATION_BOOKMARK);
	registerType(AnnotationType.ANNOTATION_CURRENT_BRACKET);
	registerType(AnnotationType.ANNOTATION_MATCHING_BRACKET);
	registerType(AnnotationType.ANNOTATION_CURRENT_SEARCH);
	registerType(AnnotationType.ANNOTATION_MATCHING_SEARCH);
	registerType(AnnotationType.ANNOTATION_READ_OCCURRENCE);
	registerType(AnnotationType.ANNOTATION_WRITE_OCCURRENCE);
	registerType(AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP);
	registerType(AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);
	registerType(AnnotationType.ANNOTATION_LINKED_GROUP);
	registerType(AnnotationType.ANNOTATION_CURRENT_LINE, true);
	registerType(AnnotationType.ANNOTATION_BLAME, true);
	registerType(AnnotationType.ANNOTATION_CURRENT_BLAME, true);
	registerType(AnnotationType.ANNOTATION_DIFF_ADDED);
	registerType(AnnotationType.ANNOTATION_DIFF_DELETED);
	registerType(AnnotationType.ANNOTATION_DIFF_MODIFIED);

	AnnotationType.registerType(AnnotationType.ANNOTATION_FOLDING, FoldingAnnotation);

	/**
	 * Constructs a new AnnotationTypeList object.
	 *
	 * @class This represents an interface of prioritized annotation types.
	 * @name orion.editor.AnnotationTypeList
	 */
	function AnnotationTypeList () {
	}
	/**
	 * Adds in the annotation type interface into the specified object.
	 *
	 * @param {Object} object The object to add in the annotation type interface.
	 */
	AnnotationTypeList.addMixin = function(object) {
		var proto = AnnotationTypeList.prototype;
		for (var p in proto) {
			if (proto.hasOwnProperty(p)) {
				object[p] = proto[p];
			}
		}
	};
	AnnotationTypeList.prototype = /** @lends orion.editor.AnnotationTypeList.prototype */ {
		/**
		 * Adds an annotation type to the receiver.
		 * <p>
		 * Only annotations of the specified types will be shown by
		 * the receiver.
		 * </p>
		 * <p>
		 * If the priority is not specified, the annotation type will be added
		 * to the end of the receiver's list (lowest pririoty).
		 * </p>
		 *
		 * @param {Object} type the annotation type to be shown
		 * @param {Number} priority the priority for the annotation type
		 * 
		 * @see orion.editor.AnnotationTypeList#removeAnnotationType
		 * @see orion.editor.AnnotationTypeList#isAnnotationTypeVisible
		 * @see orion.editor.AnnotationTypeList#getAnnotationTypePriority
		 */
		addAnnotationType: function(type, priority) {
			if (!this._annotationTypes) { this._annotationTypes = []; }
			var index = priority - 1;
			if (priority == undefined || !(0 <= index && index < this._annotationTypes.length)) {
				this._annotationTypes.push(type);
			} else {
				this._annotationTypes.splice(index, 0, type);
			}
		},
		/**
		 * Gets the annotation type priority.  The priority is determined by the
		 * order the annotation type is added to the receiver.  Annotation types
		 * added first have higher priority.
		 * <p>
		 * Returns <code>0</code> if the annotation type is not added.
		 * </p>
		 *
		 * @param {Object} type the annotation type
		 *
		 * @see orion.editor.AnnotationTypeList#addAnnotationType
		 * @see orion.editor.AnnotationTypeList#removeAnnotationType
		 * @see orion.editor.AnnotationTypeList#isAnnotationTypeVisible
		 */
		getAnnotationTypePriority: function(type) {
			if (this._annotationTypes) {
				for (var i = 0; i < this._annotationTypes.length; i++) {
					if (this._annotationTypes[i] === type) {
						return i + 1;
					}
				}
			}
			return 0;
		},
		/**
		 * Returns an array of annotations in the specified annotation model for the given range of text sorted by type.
		 *
		 * @param {orion.editor.AnnotationModel} annotationModel the annotation model.
		 * @param {Number} start the start offset of the range.
		 * @param {Number} end the end offset of the range.
		 * @return {orion.editor.Annotation[]} an annotation array.
		 */
		getAnnotationsByType: function(annotationModel, start, end) {
			var iter = annotationModel.getAnnotations(start, end);
			var annotation, annotations = [];
			while (iter.hasNext()) {
				annotation = iter.next();
				var priority = this.getAnnotationTypePriority(annotation.type);
				if (priority === 0) { continue; }
				annotations.push(annotation);
			}
			var self = this;
			annotations.sort(function(a, b) {
				return self.getAnnotationTypePriority(a.type) - self.getAnnotationTypePriority(b.type);
			});
			return annotations;
		},
		/**
		 * Returns whether the receiver shows annotations of the specified type.
		 *
		 * @param {Object} type the annotation type
		 * @returns {Boolean} whether the specified annotation type is shown
		 *
		 * @see orion.editor.AnnotationTypeList#addAnnotationType
		 * @see orion.editor.AnnotationTypeList#removeAnnotationType
		 */
		isAnnotationTypeVisible: function(type) {
			return this.getAnnotationTypePriority(type) !== 0;
		},
		/**
		 * Removes an annotation type from the receiver.
		 *
		 * @param {Object} type the annotation type to be removed
		 *
		 * @see orion.editor.AnnotationTypeList#addAnnotationType
		 * @see orion.editor.AnnotationTypeList#isAnnotationTypeVisible
		 */
		removeAnnotationType: function(type) {
			if (!this._annotationTypes) { return; }
			for (var i = 0; i < this._annotationTypes.length; i++) {
				if (this._annotationTypes[i] === type) {
					this._annotationTypes.splice(i, 1);
					break;
				}
			}
		}
	};
	
	/** @private */
	function binarySearch(array, offset, inclusive, low, high) {
		var index;
		if (low === undefined) { low = -1; }
		if (high === undefined) { high = array.length; }
		while (high - low > 1) {
			index = Math.floor((high + low) / 2);
			if (offset <= array[index].start) {
				high = index;
			} else if (inclusive && offset < array[index].end) {
				high = index;
				break;
			} else {
				low = index;
			}
		}
		return high;
	}
	
	/**
	 * Constructs an annotation model.
	 * 
	 * @param {orion.editor.TextModel} textModel The text model.
	 * 
	 * @class This object manages annotations for a <code>TextModel</code>.
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.Annotation}<br/>
	 * {@link orion.editor.TextModel}<br/> 
	 * </p>	
	 * @name orion.editor.AnnotationModel
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function AnnotationModel(textModel) {
		this._annotations = [];
		var self = this;
		this._listener = {
			onChanged: function(modelChangedEvent) {
				self._onChanged(modelChangedEvent);
			}
		};
		this.setTextModel(textModel);
	}

	AnnotationModel.prototype = /** @lends orion.editor.AnnotationModel.prototype */ {
		/**
		 * Adds an annotation to the annotation model.
		 * <p>The annotation model listeners are notified of this change.</p>
		 *
		 * @param {orion.editor.Annotation} annotation the annotation to be added.
		 *
		 * @see orion.editor.AnnotationModel#removeAnnotation
		 */
		addAnnotation: function(annotation) {
			if (!annotation) { return; }
			var annotations = this._annotations;
			var index = binarySearch(annotations, annotation.start);
			annotations.splice(index, 0, annotation);
			annotation._annotationModel = this;
			var e = {
				type: "Changed", //$NON-NLS-0$
				added: [annotation],
				removed: [],
				changed: []
			};
			this.onChanged(e);
		},
		/**
		 * Returns the text model.
		 *
		 * @return {orion.editor.TextModel} The text model.
		 *
		 * @see orion.editor.AnnotationModel#setTextModel
		 */
		getTextModel: function() {
			return this._model;
		},
		/**
		 * @class This object represents an annotation iterator.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.AnnotationModel#getAnnotations}<br/>
		 * </p>
		 * @name orion.editor.AnnotationIterator
		 *
		 * @property {Function} hasNext Determines whether there are more annotations in the iterator.
		 * @property {Function} next Returns the next annotation in the iterator.
		 */
		/**
		 * Returns an iterator of annotations for the given range of text. If called with no parameters,
		 * returns all annotations in the model.
		 *
		 * @param {Number} start the start offset of the range.
		 * @param {Number} end the end offset of the range.
		 * @return {orion.editor.AnnotationIterator} an annotation iterartor.
		 */
		getAnnotations: function(start, end) {
			var annotations = this._annotations, current;
			var i = 0, skip;
			if (start === undefined && end === undefined) {
				skip = function() {
					return (i < annotations.length) ? annotations[i++] : null;
				};
			} else {
				//TODO binary search does not work for range intersection when there are overlaping ranges, need interval search tree for this
				skip = function() {
					while (i < annotations.length) {
						var a =  annotations[i++];
						if ((start === a.start) || (start > a.start ? start < a.end : a.start < end)) {
							return a;
						}
						if (a.start >= end) {
							break;
						}
					}
					return null;
				};
			}
			current = skip();
			return {
				next: function() {
					var result = current;
					if (result) { current = skip(); }
					return result;
				},
				hasNext: function() {
					return current !== null;
				}
			};
		},
		/**
		 * Notifies the annotation model that the given annotation has been modified.
		 * <p>The annotation model listeners are notified of this change.</p>
		 *
		 * @param {orion.editor.Annotation} annotation the modified annotation.
		 *
		 * @see orion.editor.AnnotationModel#addAnnotation
		 */
		modifyAnnotation: function(annotation) {
			if (!annotation) { return; }
			var index = this._getAnnotationIndex(annotation);
			if (index < 0) { return; }
			var e = {
				type: "Changed", //$NON-NLS-0$
				added: [],
				removed: [],
				changed: [annotation]
			};
			this.onChanged(e);
		},
		/**
		 * Notifies all listeners that the annotation model has changed.
		 *
		 * @param {orion.editor.Annotation[]} added The list of annotation being added to the model.
		 * @param {orion.editor.Annotation[]} changed The list of annotation modified in the model.
		 * @param {orion.editor.Annotation[]} removed The list of annotation being removed from the model.
		 * @param {ModelChangedEvent} textModelChangedEvent the text model changed event that trigger this change, can be null if the change was trigger by a method call (for example, {@link #addAnnotation}).
		 */
		onChanged: function(e) {
			return this.dispatchEvent(e);
		},
		/**
		 * Removes all annotations of the given <code>type</code>. All annotations
		 * are removed if the type is not specified.
		 * <p>The annotation model listeners are notified of this change.  Only one changed event is generated.</p>
		 *
		 * @param {Object} type the type of annotations to be removed.
		 *
		 * @see orion.editor.AnnotationModel#removeAnnotation
		 */
		removeAnnotations: function(type) {
			var annotations = this._annotations;
			var removed, i;
			if (type) {
				removed = [];
				for (i = annotations.length - 1; i >= 0; i--) {
					var annotation = annotations[i];
					if (annotation.type === type) {
						annotations.splice(i, 1);
						removed.splice(0, 0, annotation);
						annotation._annotationModel = null;
					}
				}
			} else {
				removed = annotations;
				annotations = [];
			}
			var e = {
				type: "Changed", //$NON-NLS-0$
				removed: removed,
				added: [],
				changed: []
			};
			this.onChanged(e);
		},
		/**
		 * Removes an annotation from the annotation model.
		 * <p>The annotation model listeners are notified of this change.</p>
		 *
		 * @param {orion.editor.Annotation} annotation the annotation to be removed.
		 *
		 * @see orion.editor.AnnotationModel#addAnnotation
		 */
		removeAnnotation: function(annotation) {
			if (!annotation) { return; }
			var index = this._getAnnotationIndex(annotation);
			if (index < 0) { return; }
			annotation._annotationModel = null;
			var e = {
				type: "Changed", //$NON-NLS-0$
				removed: this._annotations.splice(index, 1),
				added: [],
				changed: []
			};
			this.onChanged(e);
		},
		/**
		 * Removes and adds the specifed annotations to the annotation model.
		 * <p>The annotation model listeners are notified of this change.  Only one changed event is generated.</p>
		 *
		 * @param {orion.editor.Annotation} remove the annotations to be removed.
		 * @param {orion.editor.Annotation} add the annotations to be added.
		 *
		 * @see orion.editor.AnnotationModel#addAnnotation
		 * @see orion.editor.AnnotationModel#removeAnnotation
		 */
		replaceAnnotations: function(remove, add) {
			var annotations = this._annotations, i, index, annotation, removed = [];
			if (remove) {
				for (i = remove.length - 1; i >= 0; i--) {
					annotation = remove[i];
					index = this._getAnnotationIndex(annotation);
					if (index < 0) { continue; }
					annotation._annotationModel = null;
					annotations.splice(index, 1);
					removed.splice(0, 0, annotation);
				}
			}
			if (!add) { add = []; }
			for (i = 0; i < add.length; i++) {
				annotation = add[i];
				index = binarySearch(annotations, annotation.start);
				annotation._annotationModel = this;
				annotations.splice(index, 0, annotation);
			}
			var e = {
				type: "Changed", //$NON-NLS-0$
				removed: removed,
				added: add,
				changed: []
			};
			
			this.onChanged(e);
		},
		/**
		 * Sets the text model of the annotation model.  The annotation
		 * model listens for changes in the text model to update and remove
		 * annotations that are affected by the change.
		 *
		 * @param {orion.editor.TextModel} textModel the text model.
		 *
		 * @see orion.editor.AnnotationModel#getTextModel
		 */
		setTextModel: function(textModel) {
			if (this._model) {
				this._model.removeEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
			}
			this._model = textModel;
			if (this._model) {
				this._model.addEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
			}
		},
		/** @ignore */
		_getAnnotationIndex: function(annotation) {
			var annotations = this._annotations;
			var index = binarySearch(annotations, annotation.start);
			while (index < annotations.length && annotations[index].start === annotation.start) {
				if (annotations[index] === annotation) {
					return index;
				}
				index++;
			}
			return -1;
		},
		/** @ignore */
		_onChanged: function(modelChangedEvent) {
			var start = modelChangedEvent.start;
			var addedCharCount = modelChangedEvent.addedCharCount;
			var removedCharCount = modelChangedEvent.removedCharCount;
			var annotations = this._annotations, end = start + removedCharCount;
			//TODO binary search does not work for range intersection when there are overlaping ranges, need interval search tree for this
			var startIndex = 0;
			if (!(0 <= startIndex && startIndex < annotations.length)) { return; }
			var e = {
				type: "Changed", //$NON-NLS-0$
				added: [],
				removed: [],
				changed: [],
				textModelChangedEvent: modelChangedEvent
			};
			var changeCount = addedCharCount - removedCharCount, i;
			for (i = startIndex; i < annotations.length; i++) {
				var annotation = annotations[i];
				if (annotation.start >= end) {
					annotation._oldStart = annotation.start;
					annotation._oldEnd = annotation.end;
					annotation.start += changeCount;
					annotation.end += changeCount;
					e.changed.push(annotation);
				} else if (annotation.end <= start) {
					//nothing
				} else if (annotation.start < start && end < annotation.end) {
					annotation._oldStart = annotation.start;
					annotation._oldEnd = annotation.end;
					annotation.end += changeCount;
					e.changed.push(annotation);
				} else {
					annotations.splice(i, 1);
					e.removed.push(annotation);
					annotation._annotationModel = null;
					if (annotation.expand) {
						annotation.expand();
					}
					i--;
				}
			}
			if (e.added.length > 0 || e.removed.length > 0 || e.changed.length > 0) {
				this.onChanged(e);
			}
		}
	};
	mEventTarget.EventTarget.addMixin(AnnotationModel.prototype);

	/**
	 * Constructs a new styler for annotations.
	 *
	 * @param {orion.editor.TextView} view The styler view.
	 * @param {orion.editor.AnnotationModel} view The styler annotation model.
	 *
	 * @class This object represents a styler for annotation attached to a text view.
	 * @name orion.editor.AnnotationStyler
	 * @borrows orion.editor.AnnotationTypeList#addAnnotationType as #addAnnotationType
	 * @borrows orion.editor.AnnotationTypeList#getAnnotationTypePriority as #getAnnotationTypePriority
	 * @borrows orion.editor.AnnotationTypeList#getAnnotationsByType as #getAnnotationsByType
	 * @borrows orion.editor.AnnotationTypeList#isAnnotationTypeVisible as #isAnnotationTypeVisible
	 * @borrows orion.editor.AnnotationTypeList#removeAnnotationType as #removeAnnotationType
	 */
	function AnnotationStyler (view, annotationModel) {
		this._view = view;
		this._annotationModel = annotationModel;
		var self = this;
		this._listener = {
			onDestroy: function(e) {
				self._onDestroy(e);
			},
			onLineStyle: function(e) {
				self._onLineStyle(e);
			},
			onChanged: function(e) {
				self._onAnnotationModelChanged(e);
			}
		};
		view.addEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
		view.addEventListener("postLineStyle", this._listener.onLineStyle); //$NON-NLS-0$
		annotationModel.addEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
	}
	AnnotationStyler.prototype = /** @lends orion.editor.AnnotationStyler.prototype */ {
		/**
		 * Destroys the styler.
		 * <p>
		 * Removes all listeners added by this styler.
		 * </p>
		 */
		destroy: function() {
			var view = this._view;
			if (view) {
				view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
				view.removeEventListener("LineStyle", this._listener.onLineStyle); //$NON-NLS-0$
				this.view = null;
			}
			var annotationModel = this._annotationModel;
			if (annotationModel) {
				annotationModel.removeEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
				annotationModel = null;
			}
		},
		_mergeStyle: function(result, style) {
			if (style) {
				if (!result) { result = {}; }
				if (result.styleClass && style.styleClass && result.styleClass !== style.styleClass) {
					result.styleClass += " " + style.styleClass; //$NON-NLS-0$
				} else {
					result.styleClass = style.styleClass;
				}
				var prop;
				if (style.tagName) {
					if (!result.tagName) {
						result.tagName = style.tagName;
					}
				}
				if (style.style) {
					if (!result.style) { result.style  = {}; }
					for (prop in style.style) {
						if (!result.style[prop]) {
							result.style[prop] = style.style[prop];
						}
					}
				}
				if (style.attributes) {
					if (!result.attributes) { result.attributes  = {}; }
					for (prop in style.attributes) {
						if (!result.attributes[prop]) {
							result.attributes[prop] = style.attributes[prop];
						}
					}
				}
			}
			return result;
		},
		_mergeStyleRanges: function(ranges, styleRange) {
			if (!ranges) {
				ranges = [];
			}
			var mergedStyle, i = binarySearch(ranges, styleRange.start, true);
			for (; i<ranges.length && styleRange; i++) {
				var range = ranges[i];
				if (styleRange.end <= range.start) { break; }
				if (styleRange.start >= range.end) { continue; }
				mergedStyle = this._mergeStyle({}, range.style);
				mergedStyle = this._mergeStyle(mergedStyle, styleRange.style);
				var args = [];
				args.push(i, 1);
				if (styleRange.start < range.start) {
					args.push({start: styleRange.start, end: range.start, style: styleRange.style});
				}
				if (styleRange.start > range.start) {
					args.push({start: range.start, end: styleRange.start, style: range.style});
				}
				args.push({start: Math.max(range.start, styleRange.start), end: Math.min(range.end, styleRange.end), style: mergedStyle});
				if (styleRange.end < range.end) {
					args.push({start: styleRange.end, end: range.end, style: range.style});
				}
				if (styleRange.end > range.end) {
					styleRange = {start: range.end, end: styleRange.end, style: styleRange.style};
				} else {
					styleRange = null;
				}
				Array.prototype.splice.apply(ranges, args);
			}
			if (styleRange) {
				mergedStyle = this._mergeStyle({}, styleRange.style);
				ranges.splice(i, 0, {start: styleRange.start, end: styleRange.end, style: mergedStyle});
			}
			return ranges;
		},
		_onAnnotationModelChanged: function(e) {
			var view = this._view;
			if (!view) { return; }
			var self = this;
			var model = view.getModel();
			function redrawRange(start, end) {
				if (model.getBaseModel) {
					start = model.mapOffset(start, true);
					end = model.mapOffset(end, true);
				}
				if (start !== -1 && end !== -1) {
					view.redrawRange(start, end);
				}
			}
			function redraw(changes, changed) {
				for (var i = 0; i < changes.length; i++) {
					if (!self.isAnnotationTypeVisible(changes[i].type)) { continue; }
					var change = changes[i];
					redrawRange(change.start, change.end);
					if (changed && change._oldStart !== undefined && change._oldEnd) {
						redrawRange(change._oldStart, change._oldEnd);
					}
				}
			}
			redraw(e.added);
			redraw(e.removed);
			redraw(e.changed, true);
		},
		_onDestroy: function(e) {
			this.destroy();
		},
		_onLineStyle: function (e) {
			var annotationModel = this._annotationModel;
			var viewModel = e.textView.getModel();
			var baseModel = annotationModel.getTextModel();
			var start = e.lineStart;
			var end = e.lineStart + e.lineText.length;
			if (baseModel !== viewModel) {
				start = viewModel.mapOffset(start);
				end = viewModel.mapOffset(end);
			}
			var annotations = annotationModel.getAnnotations(start, end);
			while (annotations.hasNext()) {
				var annotation = annotations.next();
				if (!this.isAnnotationTypeVisible(annotation.type)) { continue; }
				if (annotation.rangeStyle) {
					var annotationStart = annotation.start;
					var annotationEnd = annotation.end;
					if (baseModel !== viewModel) {
						annotationStart = viewModel.mapOffset(annotationStart, true);
						annotationEnd = viewModel.mapOffset(annotationEnd, true);
					}
					e.ranges = this._mergeStyleRanges(e.ranges, {start: annotationStart, end: annotationEnd, style: annotation.rangeStyle});
				}
				if (annotation.lineStyle) {
					e.style = this._mergeStyle({}, e.style);
					e.style = this._mergeStyle(e.style, annotation.lineStyle);
				}
			}
		}
	};
	AnnotationTypeList.addMixin(AnnotationStyler.prototype);

	return {
		FoldingAnnotation: FoldingAnnotation,
		AnnotationType: AnnotationType,
		AnnotationTypeList: AnnotationTypeList,
		AnnotationModel: AnnotationModel,
		AnnotationStyler: AnnotationStyler
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/editor", [ //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/editor/eventTarget', //$NON-NLS-0$
	'orion/editor/tooltip', //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/objects', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(messages, mEventTarget, mTooltip, mAnnotations, objects, util) {
	
	var AT = mAnnotations.AnnotationType;

	var HIGHLIGHT_ERROR_ANNOTATION = "orion.annotation.highlightError"; //$NON-NLS-0$

	/**
	 * @name orion.editor.BaseEditor
	 * @class This is the base interface for text and visual editors based on a text buffer.
	 *
	 * @description Creates a new Base Editor with the given options.
	 * @param {Object} options Creation options for this editor.
	 * @param {Object} options.domNode
	 * @param {Object} options.statusReporter
	 *
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function BaseEditor(options) {
		options = options || {};
		this._domNode = options.domNode;
		this._model = options.model;
		this._undoStack = options.undoStack;
		this._statusReporter = options.statusReporter;
		this._title = null;
		var self = this;
		this._listener = {
			onChanged: function(e) {
				self.onChanged(e);
			}
		};
		if (this._model) {
			this._model.addEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
		}
		this.checkDirty();
	}
	BaseEditor.prototype = /** @lends orion.editor.BaseEditor.prototype */ {
		/**
		 * Destroys the editor. Uninstall the editor view.
		 */
		destroy: function() {
			this.uninstall();
			this._statusReporter = this._domNode = null;
			if (this._model) {
				this._model.removeEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
			}
		},

		/** @private */
		checkDirty : function() {
			this.setDirty(this._undoStack && !this._undoStack.isClean());
		},
		/**
		 * Focus the the editor view. The default implementation does nothing.
		 */
		focus: function() {
		},
		/**
		 * Returns the text model of the editor.
		 *
		 * @returns {orion.editor.TextModel} the text model of the view.
		 */
		getModel: function() {
			return this._model;
		},
		/**
		 * Returns the text for the given range.
		 * <p>
		 * The text does not include the character at the end offset.
		 * </p>
		 *
		 * @param {Number} [start=0] the start offset of text range.
		 * @param {Number} [end=char count] the end offset of text range.
		 *
		 * @see orion.editor.TextView#setText
		 */
		getText: function(start, end) {
			return this.getModel().getText(start, end);
		},
		/**
		 * Returns the editor title.
		 *
		 * @returns {String} the editor title.
		 */
		getTitle: function() {
			return this._title;
		},
		/**
		 * Returns the editor undo stack.
		 *
		 * @returns {orion.editor.UndoStack} the editor undo stack.
		 */
		getUndoStack: function() {
			return this._undoStack;
		},
		/**
		 * Creates the DOM hierarchy of the editor and add it to the document.
		 */
		install: function() {
			this.installed = true;
		},
		/**
		 * Returns <code>true</code> if the editor is dirty; <code>false</code> otherwise.
		 * @returns {Boolean} whether the editor is dirty
		 */
		isDirty: function() {
			return this._dirty;
		},
		/**
		 * Marks the current state of the editor as clean. Meaning there are no unsaved modifications.
		 */
		markClean: function() {
			this.getUndoStack().markClean();
			this.setDirty(false);
		},
		/**
		 * Called when the dirty state of the editor changes.
		 * @param {Event} dirtyChangedEvent
		 */
		onDirtyChanged: function(dirtyChangedEvent) {
			return this.dispatchEvent(dirtyChangedEvent);
		},
		/**
		 * Called when the editor's contents have been changed or saved.
		 * @param {Event} inputChangedEvent
		 */
		onInputChanged: function (inputChangedEvent) {
			return this.dispatchEvent(inputChangedEvent);
		},
		/**
		 * Called when the editor's text model has been changed.
		 * @param {Event} inputChangedEvent
		 */
		onChanged: function (modelChangedEvent) {
			this.checkDirty();
		},
		/**
		 * Report the message to the user.
		 *
		 * @param {String} message the message to show
		 * @param {String} [type] the message type. Either normal or "progress" or "error";
		 * @param {Boolean} [isAccessible] If <code>true</code>, a screen reader will read this message.
		 * Otherwise defaults to the domNode default.
		 */
		reportStatus: function(message, type, isAccessible) {
			if (this._statusReporter) {
				this._statusReporter(message, type, isAccessible);
			}
		},
		/**
		 * Resizes the editor view. The default implementation does nothing.
		 */
		resize: function() {
		},
		/**
		 * Sets whether the editor is dirty.
		 *
		 * @param {Boolean} dirty
		 */
		setDirty: function(dirty) {
			if (this._dirty === dirty) { return; }
			this._dirty = dirty;
			this.onDirtyChanged({type: "DirtyChanged"}); //$NON-NLS-0$
		},
		/**
		 * @private
		 */
		_setModelText: function(contents) {
			if (this._model) {
				this._model.setText(contents);
			}
		},
		/**
		 * Sets the editor's contents.
		 *
		 * @param {String} title the editor title
		 * @param {String} message an error message
		 * @param {String} contents the editor contents
		 * @param {Boolean} contentsSaved whether the editor contents was saved.
		 */
		setInput: function(title, message, contents, contentsSaved) {
			this._title = title;
			if (!contentsSaved) {
				if (message) {
					this.reportStatus(message, "error"); //$NON-NLS-0$
				} else {
					if (contents !== null && contents !== undefined && typeof contents === "string") { //$NON-NLS-0$
						this._setModelText(contents);
					}
				}
				if (this._undoStack) {
					this._undoStack.reset();
				}
			}
			this.checkDirty();
			this.onInputChanged({
				type: "InputChanged", //$NON-NLS-0$
				title: title,
				message: message,
				contents: contents,
				contentsSaved: contentsSaved
			});
		},
		/**
		 * Replaces the text in the given range with the given text.
		 * <p>
		 * The character at the end offset is not replaced.
		 * </p>
		 *
		 * @param {String} text the new text.
		 * @param {Number} [start=0] the start offset of text range.
		 * @param {Number} [end=char count] the end offset of text range.
		 */
		setText: function(text, start, end) {
			this.getModel().setText(text, start, end);
		},
		/**
		 * Removes the DOM hierarchy of the editor from the document.
		 */
		uninstall: function() {
			this.installed = false;
		}
	};
	mEventTarget.EventTarget.addMixin(BaseEditor.prototype);

	/**
	 * @name orion.editor.Editor
	 * @augments orion.editor.BaseEditor
	 * @class An <code>Editor</code> is a user interface for editing text that provides additional features over the basic {@link orion.editor.TextView}.
	 * Some of <code>Editor</code>'s features include:
	 * <ul>
	 * <li>Additional actions and key bindings for editing text</li>
	 * <li>Content assist</li>
	 * <li>Find and Incremental Find</li>
	 * <li>Rulers for displaying line numbers and annotations</li>
	 * <li>Status reporting</li>
	 * </ul>
	 *
	 * @description Creates a new Editor with the given options.
	 * @param {Object} options Options controlling the features of this Editor.
	 * @param {Object} options.annotationFactory
	 * @param {Object} options.contentAssistFactory
	 * @param {Object} options.domNode
	 * @param {Object} options.keyBindingFactory
	 * @param {Object} options.lineNumberRulerFactory
	 * @param {Object} options.zoomRulerFactory
	 * @param {Object} options.foldingRulerFactory
	 * @param {Object} options.statusReporter
	 * @param {Object} options.textViewFactory
	 * @param {Object} options.undoStackFactory
	 * @param {Object} options.textDNDFactory
	 * @param {Object} options.hoverFactory
	 */
	function Editor(options) {
		options = options || {};
		BaseEditor.call(this, options);
		this._textViewFactory = options.textViewFactory;
		this._undoStackFactory = options.undoStackFactory;
		this._textDNDFactory = options.textDNDFactory;
		this._annotationFactory = options.annotationFactory;
		this._zoomRulerFactory = options.zoomRulerFactory;
		this._foldingRulerFactory = options.foldingRulerFactory;
		this._lineNumberRulerFactory = options.lineNumberRulerFactory;
		this._contentAssistFactory = options.contentAssistFactory;
		this._keyBindingFactory = options.keyBindingFactory;
		this._hoverFactory = options.hoverFactory;
		this._annotationStyler = null;
		this._annotationModel = null;
		this._annotationRuler = null;
		this._lineNumberRuler = null;
		this._overviewRuler = null;
		this._zoomRuler = null;
		this._foldingRuler = null;
		this._contentAssist = null;
	}
	Editor.prototype = new BaseEditor();
	objects.mixin(Editor.prototype, /** @lends orion.editor.Editor.prototype */ {
		/**
		 * Destroys the editor.
		 */
		destroy: function() {
			BaseEditor.prototype.destroy.call(this);
			this._textViewFactory = this._undoStackFactory = this._textDNDFactory = 
			this._annotationFactory = this._foldingRulerFactory = this._lineNumberRulerFactory = 
			this._contentAssistFactory = this._keyBindingFactory = this._hoverFactory = this._zoomRulerFactory = null;
		},
		/**
		 * Returns the annotation model of the editor.
		 *
		 * @returns {orion.editor.AnnotationModel}
		 */
		getAnnotationModel: function() {
			return this._annotationModel;
		},
		/**
		 * Returns the annotation ruler of the editor.
		 *
		 * @returns {orion.editor.AnnotationRuler}
		 */
		getAnnotationRuler: function() {
			return this._annotationRuler;
		},
		/**
		 * Returns the annotation styler of the editor.
		 *
		 * @returns {orion.editor.AnnotationStyler}
		 */
		getAnnotationStyler: function() {
			return this._annotationStyler;
		},
		/**
		 * Returns the content assist of the editor.
		 *
		 * @returns {orion.editor.LineNumberRuler}
		 */
		getContentAssist: function() {
			return this._contentAssist;
		},
		/**
		 * Returns the folding ruler of the editor.
		 *
		 * @returns {orion.editor.FoldingRuler}
		 */
		getFoldingRuler: function() {
			return this._foldingRuler;
		},
		/**
		 * Returns the line number ruler of the editor.
		 *
		 * @returns {orion.editor.LineNumberRuler}
		 */
		getLineNumberRuler: function() {
			return this._lineNumberRuler;
		},
		/**
		 * Returns the Tooltip instance for this editor
		 *
		 * @returns {orion.editor.Tooltip}
		*/
		getTooltip: function() {
			return mTooltip.Tooltip.getTooltip(this._textView);
		},
		/**
		 * Returns the zoom ruler of the editor.
		 *
		 * @returns {orion.editor.LineNumberRuler}
		 */
		getZoomRuler: function() {
			return this._zoomRuler;
		},
		/**
		 * Returns the base text model of this editor.
		 *
		 * @returns {orion.editor.TextModel}
		 */
		getModel: function() {
			if (!this._textView) {
				return null;
			}
			var model = this._textView.getModel();
			if (model.getBaseModel) {
				model = model.getBaseModel();
			}
			return model;
		},
		/**
		 * Returns the overview ruler of the editor.
		 *
		 * @returns {orion.editor.OverviewRuler}
		 */
		getOverviewRuler: function() {
			return this._overviewRuler;
		},
		/**
		 * Returns the underlying <code>TextView</code> used by this editor.
		 * @returns {orion.editor.TextView} the editor text view.
		 */
		getTextView: function() {
			return this._textView;
		},
		/**
		 * Returns the editor's key modes.
		 *
		 * @returns {Array} the editor key modes.
		 */
		getKeyModes: function() {
			return this._textView.getKeyModes();
		},
		/**
		 * Returns the editor source code actions.
		 *
		 * @returns {orion.editor.sourceCodeActions}
		 */
		getSourceCodeActions: function() {
			return this._sourceCodeActions;
		},
		/**
		 * Returns the editor linked mode.
		 *
		 * @returns {orion.editor.LinkedMode}
		 */
		getLinkedMode: function() {
			return this._linkedMode;
		},
		/**
		 * Returns the editor text actions.
		 *
		 * @returns {orion.editor.textActions}
		 */
		getTextActions: function() {
			return this._textActions;
		},
		/**
		 * Gives focus to the text view.
		 */
		focus: function() {
			if (this._textView) {
				this._textView.focus();
			}
		},
		/**
		 * Resizes the text view.
		 */
		resize: function() {
			if (this._textView) {
				this._textView.resize();
			}
		},
		/**
		 * Sets whether the annotation ruler is visible.
		 *
		 * @param {Boolean} visible <code>true</code> to show ruler, <code>false</code> otherwise
		 */
		setAnnotationRulerVisible: function(visible, force) {
			if (this._annotationRulerVisible === visible && !force) { return; }
			this._annotationRulerVisible = visible;
			if (!this._annotationRuler) { return; }
			var textView = this._textView;
			if (visible) {
				textView.addRuler(this._annotationRuler, 0);
			} else {
				textView.removeRuler(this._annotationRuler);
			}
		},
		/**
		 * Sets whether the folding ruler is visible.
		 *
		 * @param {Boolean} visible <code>true</code> to show ruler, <code>false</code> otherwise
		 */
		setFoldingRulerVisible: function(visible, force) {
			if (this._foldingRulerVisible === visible && !force) { return; }
			this._foldingRulerVisible = visible;
			if (!this._foldingRuler) { return; }
			var textView = this._textView;
			if (!textView.getModel().getBaseModel) { return; }
			if (visible) {
				textView.addRuler(this._foldingRuler);
			} else {
				textView.removeRuler(this._foldingRuler);
			}
		},
		/**
		 * Sets whether the line numbering ruler is visible.
		 *
		 * @param {Boolean} visible <code>true</code> to show ruler, <code>false</code> otherwise
		 */
		setLineNumberRulerVisible: function(visible, force) {
			if (this._lineNumberRulerVisible === visible && !force) { return; }
			this._lineNumberRulerVisible = visible;
			if (!this._lineNumberRuler) { return; }
			var textView = this._textView;
			if (visible) {
				textView.addRuler(this._lineNumberRuler, !this._annotationRulerVisible ? 0 : 1);
			} else {
				textView.removeRuler(this._lineNumberRuler);
			}
		},
		/**
		 * Sets whether the overview ruler is visible.
		 *
		 * @param {Boolean} visible <code>true</code> to show ruler, <code>false</code> otherwise
		 */
		setOverviewRulerVisible: function(visible, force) {
			if (this._overviewRulerVisible === visible && !force) { return; }
			this._overviewRulerVisible = visible;
			if (!this._overviewRuler) { return; }
			var textView = this._textView;
			if (visible) {
				textView.addRuler(this._overviewRuler);
			} else {
				textView.removeRuler(this._overviewRuler);
			}
		},
		/**
		 * Sets whether the zoom ruler is visible.
		 *
		 * @param {Boolean} visible <code>true</code> to show ruler, <code>false</code> otherwise
		 */
		setZoomRulerVisible: function(visible, force) {
			if (this._zoomRulerVisible === visible && !force) { return; }
			this._zoomRulerVisible = visible;
			if (!this._zoomRuler) { return; }
			var textView = this._textView;
			if (visible) {
				textView.addRuler(this._zoomRuler);
			} else {
				textView.removeRuler(this._zoomRuler);
			}
		},

		mapOffset: function(offset, parent) {
			var textView = this._textView;
			var model = textView.getModel();
			if (model.getBaseModel) {
				offset = model.mapOffset(offset, parent);
			}
			return offset;
		},
		/**
		 * @name getLineAtOffset
		 * @description Returns the line number corresponding to the given offset in the source
		 * @function
		 * @public
		 * @memberof orion.editor.Editor
		 * @param {Number} offset The offset into the source
		 * @returns {Number} The line number corresponding to the given offset or <code>-1</code> if out of range
		 * @since 5.0
		 */
		getLineAtOffset: function(offset) {
			return this.getModel().getLineAtOffset(this.mapOffset(offset));
		},
		/**
		 * @name getLineStart
		 * @description Compute the editor start offset of the given line number
		 * @function
		 * @public
		 * @memberof orion.editor.TextView
		 * @param {Number} line The line number in the editor
		 * @returns {Number} Returns the start offset of the given line number in the editor.
		 * @since 5.0
		 */
		getLineStart: function(line) {
			return this.getModel().getLineStart(line);
		},
		getCaretOffset: function() {
			return this.mapOffset(this._textView.getCaretOffset());
		},
		
		getSelection: function() {
			var textView = this._textView;
			var selection = textView.getSelection();
			var model = textView.getModel();
			if (model.getBaseModel) {
				selection.start = model.mapOffset(selection.start);
				selection.end = model.mapOffset(selection.end);
			}
			return selection;
		},

		getSelections: function() {
			var textView = this._textView;
			var model = textView.getModel();
			var selections = textView.getSelections();
			selections.forEach(function(selection) {
				if (model.getBaseModel) {
					selection.start = model.mapOffset(selection.start);
					selection.end = model.mapOffset(selection.end);
				}
			});
			return selections;
		},

		_expandOffset: function(offset) {
			var model = this._textView.getModel();
			var annotationModel = this._annotationModel;
			if (!annotationModel || !model.getBaseModel) { return; }
			var annotations = annotationModel.getAnnotations(offset, offset + 1);
			while (annotations.hasNext()) {
				var annotation = annotations.next();
				if (annotation.type === AT.ANNOTATION_FOLDING) {
					if (annotation.expand) {
						annotation.expand();
					}
				}
			}
		},

		setCaretOffset: function(caretOffset, show, callback) {
			var textView = this._textView;
			var model = textView.getModel();
			if (model.getBaseModel) {
				this._expandOffset(caretOffset);
				caretOffset = model.mapOffset(caretOffset, true);
			}
			textView.setCaretOffset(caretOffset, show, callback);
		},

		/**
		 * @private
		 */
		setText: function(text, start, end) {
			var textView = this._textView;
			var model = textView.getModel();
			if (model.getBaseModel) {
				if (start !== undefined) {
					this._expandOffset(start);
					start = model.mapOffset(start, true);
				}
				if (end !== undefined) {
					this._expandOffset(end);
					end = model.mapOffset(end, true);
				}
			}
			textView.setText(text, start, end);
		},

		setSelection: function(start, end, show, callback) {
			var textView = this._textView;
			var model = textView.getModel();
			if (model.getBaseModel) {
				this._expandOffset(start);
				this._expandOffset(end);
				start = model.mapOffset(start, true);
				end = model.mapOffset(end, true);
			}
			textView.setSelection(start, end, show, callback);
		},
		setSelections: function(ranges, show, callback) {
			var self = this;
			var textView = this._textView;
			var model = textView.getModel();
			ranges.forEach(function(range) {
				var start = range.start;
				var end = range.end;
				if (model.getBaseModel) {
					self._expandOffset(start);
					self._expandOffset(end);
					start = model.mapOffset(start, true);
					end = model.mapOffset(end, true);
				}
				range.start = start;
				range.end = end;
			});
			textView.setSelections(ranges, show, callback);
		},

		/**
		 * @param {Number} start
		 * @param {Number} [end]
		 * @param {function} [callback] if callback is specified, scrolling to show the selection is animated and callback is called when the animation is done.
		 * @param {Boolean} [focus=true] whether the text view should be focused when the selection is done.
		 * @private
		 * @deprecated use #setSelection instead
		 */
		moveSelection: function(start, end, callback, focus) {
			end = end || start;
			var textView = this._textView;
			this.setSelection(start, end, 1 / 3, function() {
				if (focus === undefined || focus) {
					textView.focus();
				}
				if (callback) {
					callback();
				}
			});
		},

		/** @private */
		_getTooltipInfo: function(x, y) {
			var textView = this._textView;
			var annotationModel = this.getAnnotationModel();
			if (!annotationModel) { return null; }
			var annotationStyler = this._annotationStyler;
			if (!annotationStyler) { return null; }
			var offset = textView.getOffsetAtLocation(x, y);
			if (offset === -1) { return null; }
			offset = this.mapOffset(offset);
			var annotations = annotationStyler.getAnnotationsByType(annotationModel, offset, offset + 1);
			var rangeAnnotations = [];
			for (var i = 0; i < annotations.length; i++) {
				if (annotations[i].rangeStyle) {
					rangeAnnotations.push(annotations[i]);
				}
			}
			var pt = textView.convert({x: x, y: y}, "document", "page"); //$NON-NLS-1$ //$NON-NLS-0$
			var info = {
				contents: rangeAnnotations,
				offset: offset,
				anchor: "left", //$NON-NLS-0$
				x: pt.x + 10,
				y: pt.y + 20
			};
			return info;
		},

		/** @private */
		_highlightCurrentLine: function(newSelections, oldSelections) {
			var annotationModel = this._annotationModel;
			if (!annotationModel) { return; }
			var textView = this._textView;
			if (textView.getOptions("singleMode")) { return; } //$NON-NLS-0$
			oldSelections = Array.isArray(oldSelections) ? oldSelections : [oldSelections];
			newSelections = Array.isArray(newSelections) ? newSelections : [newSelections];
			var model = textView.getModel();
			function getHighlightLines(selections) {
				var lines = {};
				if (selections && selections.some(function(selection) {
					if (selection && selection.isEmpty()) {
						lines[model.getLineAtOffset(selection.start).toString()] = true;
					} else {
						return true;
					}
					return false;
				})) return {};
				return lines;
			}
			var oldLines = getHighlightLines(oldSelections);
			var newLines = getHighlightLines(newSelections);
			function compare(o, n) {
				for (var p1 in o) {
					if (!n[p1]) {
						return true;
					}
				}
				return false;
			}
			if (!(compare(oldLines, newLines) || compare(newLines, oldLines))) return;
			var remove = this._currentLineAnnotations;
			var add = [];
			for (var p in newLines) {
				var lineIndex = p >> 0;
				var start = model.getLineStart(lineIndex);
				var end = model.getLineEnd(lineIndex);
				if (model.getBaseModel) {
					start = model.mapOffset(start);
					end = model.mapOffset(end);
				}
				var type = AT.ANNOTATION_CURRENT_LINE;
				var annotation = AT.createAnnotation(type, start, end);
				add.push(annotation);
			}
			this._currentLineAnnotations = add;
			annotationModel.replaceAnnotations(remove, add);
		},

		/**
		 * Creates the underlying TextView and installs the editor's features.
		 */
		installTextView: function() {
			this.install();
		},

		install : function() {
			if (this._textView) { return; }

			// Create textView and install optional features
			this._textView = this._textViewFactory();
			if (this._undoStackFactory) {
				this._undoStack = this._undoStackFactory.createUndoStack(this);
				this._textView.setOptions({undoStack: this._undoStack});
				this.checkDirty();
			}
			if (this._textDNDFactory) {
				this._textDND = this._textDNDFactory.createTextDND(this, this._undoStack);
			}
			if (this._contentAssistFactory) {
				var contentAssistMode = this._contentAssistFactory.createContentAssistMode(this);
				this._contentAssist = contentAssistMode.getContentAssist();
			}
			if (this._hoverFactory) {
				this._hover = this._hoverFactory.createHover(this);
				var tooltip = mTooltip.Tooltip.getTooltip(this._textView);
				tooltip.hover = this._hover;
			}
			
			var editor = this, textView = this._textView;

			var self = this;
			this._listener = {
				onModelChanged: function(e) {
					self.checkDirty();
				},
				onMouseOver: function(e) {
					self._listener.onMouseMove(e);
				},
				onMouseMove: function(e) {
					if (!tooltip) { return; }
					
					self._listener.lastMouseX = e.event.clientX;
					self._listener.lastMouseY = e.event.clientY;
					if (tooltip.OKToHide(e.event.clientX, e.event.clientY))	{
						tooltip.hide();
					}		
					if (self._hoverTimeout) {
						window.clearTimeout(self._hoverTimeout);
						self._hoverTimeout = null;
					}
					self._hoverTimeout = window.setTimeout(function() {
						self._hoverTimeout = null;
						if (!tooltip.OKToHover(self._listener.lastMouseX)) { return; }
						tooltip.show({
							clientX: self._listener.lastMouseX,
							clientY: self._listener.lastMouseY,
							x: e.x,							
							y: e.y,							
							getTooltipInfo: function() {
								return self._getTooltipInfo(this.x, this.y);
							}
						});
					}, 100);
				},
				onMouseOut: function(e) {
//					var tooltip = mTooltip.Tooltip.getTooltip(textView);
//					if (!tooltip) { return; }
//					if (self._listener.lastMouseX === e.event.clientX && self._listener.lastMouseY === e.event.clientY) {
//						return;
//					}
//					self._listener.lastMouseX = e.event.clientX;
//					self._listener.lastMouseY = e.event.clientY;
//					tooltip.hide();
				},
				onScroll: function(e) {
					var tooltip = mTooltip.Tooltip.getTooltip(textView);
					if (!tooltip) { return; }
					tooltip.hide();
				},
				onSelection: function(e) {
					self._updateCursorStatus();
					self._highlightCurrentLine(e.newValue, e.oldValue);
				}
			};
			textView.addEventListener("ModelChanged", this._listener.onModelChanged); //$NON-NLS-0$
			textView.addEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
			textView.addEventListener("MouseOver", this._listener.onMouseOver); //$NON-NLS-0$
			textView.addEventListener("MouseOut", this._listener.onMouseOut); //$NON-NLS-0$
			textView.addEventListener("MouseMove", this._listener.onMouseMove); //$NON-NLS-0$
			textView.addEventListener("Scroll", this._listener.onScroll); //$NON-NLS-0$

			// Set up keybindings
			if (this._keyBindingFactory) {
				var keyBindings;
				if (typeof this._keyBindingFactory === "function") { //$NON-NLS-0$
					keyBindings = this._keyBindingFactory(this, this.getKeyModes(), this._undoStack, this._contentAssist);
				} else {
					keyBindings = this._keyBindingFactory.createKeyBindings(editor, this._undoStack, this._contentAssist);
				}
				if (keyBindings) {
					this._textActions = keyBindings.textActions;
					this._linkedMode = keyBindings.linkedMode;
					this._sourceCodeActions = keyBindings.sourceCodeActions;
				}
			}

			var addRemoveBookmark = function(lineIndex, e) {
				if (lineIndex === undefined) { return; }
				if (lineIndex === -1) { return; }
				var view = this.getView();
				var viewModel = view.getModel();
				var annotationModel = this.getAnnotationModel();
				var lineStart = editor.mapOffset(viewModel.getLineStart(lineIndex));
				var lineEnd = editor.mapOffset(viewModel.getLineEnd(lineIndex));
				var annotations = annotationModel.getAnnotations(lineStart, lineEnd);
				var bookmark = null;
				while (annotations.hasNext()) {
					var annotation = annotations.next();
					if (annotation.type === AT.ANNOTATION_BOOKMARK) {
						bookmark = annotation;
						break;
					}
				}
				if (bookmark) {
					annotationModel.removeAnnotation(bookmark);
				} else {
					bookmark = AT.createAnnotation(AT.ANNOTATION_BOOKMARK, lineStart, lineEnd, editor.getText(lineStart, lineEnd));
					annotationModel.addAnnotation(bookmark);
				}
			};

			// Create rulers, annotation model and styler
			if (this._annotationFactory) {
				var textModel = textView.getModel();
				if (textModel.getBaseModel) { textModel = textModel.getBaseModel(); }
				this._annotationModel = this._annotationFactory.createAnnotationModel(textModel);
				if (this._annotationModel) {
					var styler = this._annotationStyler = this._annotationFactory.createAnnotationStyler(textView, this._annotationModel);
					if (styler) {
						styler.addAnnotationType(AT.ANNOTATION_CURRENT_SEARCH);
						styler.addAnnotationType(AT.ANNOTATION_MATCHING_SEARCH);
						styler.addAnnotationType(AT.ANNOTATION_ERROR);
						styler.addAnnotationType(AT.ANNOTATION_WARNING);
						styler.addAnnotationType(AT.ANNOTATION_MATCHING_BRACKET);
						styler.addAnnotationType(AT.ANNOTATION_CURRENT_BRACKET);
						styler.addAnnotationType(AT.ANNOTATION_CURRENT_LINE);
						styler.addAnnotationType(AT.ANNOTATION_READ_OCCURRENCE);
						styler.addAnnotationType(AT.ANNOTATION_WRITE_OCCURRENCE);
						styler.addAnnotationType(AT.ANNOTATION_SELECTED_LINKED_GROUP);
						styler.addAnnotationType(AT.ANNOTATION_CURRENT_LINKED_GROUP);
						styler.addAnnotationType(AT.ANNOTATION_LINKED_GROUP);
						styler.addAnnotationType(HIGHLIGHT_ERROR_ANNOTATION);
					}
				}

				var rulers = this._annotationFactory.createAnnotationRulers(this._annotationModel);
				var ruler = this._annotationRuler = rulers.annotationRuler;
				if (ruler) {
					ruler.onDblClick = addRemoveBookmark;
					ruler.setMultiAnnotationOverlay({html: "<div class='annotationHTML overlay'></div>"}); //$NON-NLS-0$
					ruler.addAnnotationType(AT.ANNOTATION_ERROR);
					ruler.addAnnotationType(AT.ANNOTATION_WARNING);
					ruler.addAnnotationType(AT.ANNOTATION_TASK);
					ruler.addAnnotationType(AT.ANNOTATION_BOOKMARK);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_ADDED);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_DELETED);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_MODIFIED);
				}
				this.setAnnotationRulerVisible(this._annotationRulerVisible || this._annotationRulerVisible === undefined, true);

				// Overview Ruler Annotation Type
				ruler = this._overviewRuler = rulers.overviewRuler;
				if (ruler) {
					ruler.addAnnotationType(AT.ANNOTATION_CURRENT_SEARCH);
					ruler.addAnnotationType(AT.ANNOTATION_MATCHING_SEARCH);
					ruler.addAnnotationType(AT.ANNOTATION_READ_OCCURRENCE);
					ruler.addAnnotationType(AT.ANNOTATION_WRITE_OCCURRENCE);
					ruler.addAnnotationType(AT.ANNOTATION_CURRENT_BLAME);
					ruler.addAnnotationType(AT.ANNOTATION_ERROR);
					ruler.addAnnotationType(AT.ANNOTATION_WARNING);
					ruler.addAnnotationType(AT.ANNOTATION_TASK);
					ruler.addAnnotationType(AT.ANNOTATION_BOOKMARK);
					ruler.addAnnotationType(AT.ANNOTATION_MATCHING_BRACKET);
					ruler.addAnnotationType(AT.ANNOTATION_CURRENT_BRACKET);
					ruler.addAnnotationType(AT.ANNOTATION_CURRENT_LINE);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_ADDED);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_DELETED);
					ruler.addAnnotationType(AT.ANNOTATION_DIFF_MODIFIED);

				}
				this.setOverviewRulerVisible(this._overviewRulerVisible || this._overviewRulerVisible === undefined, true);
			}

			if (this._zoomRulerFactory) {
				this._zoomRuler = this._zoomRulerFactory.createZoomRuler(this._annotationModel);
				this.setZoomRulerVisible(this._zoomRulerVisible || this._zoomRulerVisible === undefined, true);
			}

			if (this._lineNumberRulerFactory) {
				this._lineNumberRuler = this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel);
				this._lineNumberRuler.addAnnotationType(AT.ANNOTATION_CURRENT_BLAME);
				this._lineNumberRuler.addAnnotationType(AT.ANNOTATION_BLAME);
		        this._lineNumberRuler.addAnnotationType(AT.ANNOTATION_DIFF_ADDED);
		        this._lineNumberRuler.addAnnotationType(AT.ANNOTATION_DIFF_MODIFIED);
		        this._lineNumberRuler.addAnnotationType(AT.ANNOTATION_DIFF_DELETED);
				this._lineNumberRuler.onDblClick = addRemoveBookmark;
				this.setLineNumberRulerVisible(this._lineNumberRulerVisible || this._lineNumberRulerVisible === undefined, true);
			}

			if (this._foldingRulerFactory) {
				this._foldingRuler = this._foldingRulerFactory.createFoldingRuler(this._annotationModel);
				this._foldingRuler.addAnnotationType(AT.ANNOTATION_FOLDING);
				this.setFoldingRulerVisible(this._foldingRulerVisible || this._foldingRulerVisible === undefined, true);
			}

			var textViewInstalledEvent = {
				type: "TextViewInstalled", //$NON-NLS-0$
				textView: textView
			};
			this.dispatchEvent(textViewInstalledEvent);
			BaseEditor.prototype.install.call(this);
		},

		/**
		 * Destroys the underlying TextView.
		 */
		uninstallTextView: function() {
			this.uninstall();
		},

		uninstall: function() {
			var textView = this._textView;
			if (!textView) { return; }

			textView.destroy();

			if (this._annotationModel) {
				this._annotationModel.setTextModel(null);
			}
			this._textView = this._undoStack = this._textDND = this._contentAssist =
				this._listener = this._annotationModel = this._annotationStyler =
				this._annotationRuler = this._overviewRuler = this._zoomRuler = this._lineNumberRuler =
				this._foldingRuler = this._currentLineAnnotations = this._title = null;
			this._dirty = false;
			this._foldingRulerVisible = this._overviewRulerVisible = this._zoomRulerVisible =
				this._lineNumberRulerVisible = this._annotationRulerVisible = undefined;

			var textViewUninstalledEvent = {
				type: "TextViewUninstalled", //$NON-NLS-0$
				textView: textView
			};
			this.dispatchEvent(textViewUninstalledEvent);
			BaseEditor.prototype.uninstall.call(this);
		},

		_updateCursorStatus: function() {
			// If we are in a mode and it owns status reporting, we bail out from reporting the cursor position.
			var keyModes = this.getKeyModes();
			for (var i=0; i<keyModes.length; i++) {
				var mode = keyModes[i];
				if (mode.isActive() && mode.isStatusActive && mode.isStatusActive()) {
					return;
				}
			}
			var status;
			var model = this.getModel();
			var selections = this.getSelections();
			if (selections.length > 1) {
				status = util.formatMessage(messages.multiSelections, selections.length);
			} else {
				var caretOffset = selections[0].getCaret();
				var lineIndex = model.getLineAtOffset(caretOffset);
				var lineStart = model.getLineStart(lineIndex);
				var offsetInLine = caretOffset - lineStart;
				status = util.formatMessage(messages.lineColumn, lineIndex + 1, offsetInLine + 1);
			}
			this.reportStatus(status);
		},

		showAnnotations: function(annotations, types, createAnnotation, getType) {
			var annotationModel = this._annotationModel;
			if (!annotationModel) {
				return;
			}
			var remove = [], add = [];
			var model = annotationModel.getTextModel();
			var iter = annotationModel.getAnnotations(), annotation;
			while (iter.hasNext()) {
				annotation = iter.next();
				if (types.indexOf(annotation.type) !== -1) {
					if (annotation.creatorID === this) {
						remove.push(annotation);
					}
				}
			}
			if (annotations) {
				for (var i = 0; i < annotations.length; i++) {
					annotation = annotations[i];
					if (!annotation) { continue; }
					if (createAnnotation) {
						annotation = createAnnotation(annotation);
					} else {
						var start, end;
						if (annotation.lineStart && annotation.lineEnd){
							start = model.getLineStart(annotation.lineStart);
							// If the closing line number of the modified range is on the last line,
							// get the line ending offset of the previous line
							end = model.getLineCount() === annotation.lineEnd
										? model.getLineEnd(annotation.lineEnd - 1)
										: model.getLineStart(annotation.lineEnd);
						}
						else if (typeof annotation.line === "number") { //$NON-NLS-0$
							// line/column
							var lineIndex = annotation.line - 1;
							var lineStart = model.getLineStart(lineIndex);
							start = lineStart + annotation.start - 1;
							end = lineStart + annotation.end - 1;
						} else {
							// document offsets
							start = annotation.start;
							end = annotation.end;
						}
						var type = getType(annotation);
						if (!type) { continue; }
						annotation = AT.createAnnotation(type, start, end, annotation.description);
					}
					annotation.id = annotations[i].id; //allow consumers to tag the annotation with their own identifier
					annotation.creatorID = this;
					add.push(annotation);

				}
			}
			annotationModel.replaceAnnotations(remove, add);
		},

		showProblems: function(problems) {
			this.showAnnotations(problems, [
				AT.ANNOTATION_ERROR,
				AT.ANNOTATION_WARNING,
				AT.ANNOTATION_TASK
			], null, function(annotation) {
				switch (annotation.severity) {
					case "error": return AT.ANNOTATION_ERROR; //$NON-NLS-0$
					case "warning": return AT.ANNOTATION_WARNING; //$NON-NLS-0$
					case "task": return AT.ANNOTATION_TASK; //$NON-NLS-0$
				}
				return null;
			});
		},

		showOccurrences: function(occurrences) {
			this.showAnnotations(occurrences, [
				AT.ANNOTATION_READ_OCCURRENCE,
				AT.ANNOTATION_WRITE_OCCURRENCE
			], null, function(annotation) {
				return annotation.readAccess ? AT.ANNOTATION_READ_OCCURRENCE : AT.ANNOTATION_WRITE_OCCURRENCE;
			});
		},

		showBlame : function(blameMarkers) {
			var blameRGB = this._blameRGB;
			var document = this.getTextView().getOptions("parent").ownerDocument; //$NON-NLS-0$
			if (!blameRGB) {
				var div = util.createElement(document, "div"); //$NON-NLS-0$
				div.className = "annotation blame"; //$NON-NLS-0$
				document.body.appendChild(div);
				var window = document.defaultView || document.parentWindow;
				var blameStyle = window.getComputedStyle(div);
				var color = blameStyle.getPropertyValue("background-color"); //$NON-NLS-0$
				div.parentNode.removeChild(div);
				var i1 = color.indexOf("("); //$NON-NLS-0$
				var i2 = color.indexOf(")"); //$NON-NLS-0$
				color = color.substring(i1 + 1, i2);
				this._blameRGB = blameRGB = color.split(",").slice(0,3); //$NON-NLS-0$
			}
			var createGroup = function() {
				var annotation = mAnnotations.AnnotationType.createAnnotation(this.groupType, this.start, this.end, this.title);
				annotation.style = objects.mixin({}, annotation.style);
				annotation.style.style = objects.mixin({}, annotation.style.style);
				annotation.style.style.backgroundColor = "";
				this.groupAnnotation = annotation;
				annotation.blame = this.blame;
				annotation.html = this.html;
				annotation.creatorID = this.creatorID;
				return annotation;
			};
			var title = function() {
				var div = util.createElement(document, "div"); //$NON-NLS-0$
				div.className = "tooltipTitle"; //$NON-NLS-0$
				var index = this.blame.Message.indexOf("\n"); //$NON-NLS-0$
				if (index === -1) { index = this.blame.Message.length; }
				var commitLink = util.createElement(document, "a"); //$NON-NLS-0$
				commitLink.href = this.blame.CommitLink;
				commitLink.appendChild(document.createTextNode(this.blame.Message.substring(0, index)));
				div.appendChild(commitLink);
				div.appendChild(util.createElement(document, "br")); //$NON-NLS-0$
				div.appendChild(document.createTextNode(util.formatMessage(messages.committerOnTime, this.blame.AuthorName, this.blame.Time)));
				return div;
			};
			var model = this.getModel();
			this.showAnnotations(blameMarkers, [
				AT.ANNOTATION_BLAME,
				AT.ANNOTATION_CURRENT_BLAME
			], function (blameMarker) {
				var start = model.getLineStart(blameMarker.Start - 1);
				var end = model.getLineEnd(blameMarker.End - 1, true);
				var annotation = mAnnotations.AnnotationType.createAnnotation(AT.ANNOTATION_BLAME, start, end, title);
				var blameColor = blameRGB.slice(0);
				blameColor.push(blameMarker.Shade);
				annotation.style = objects.mixin({}, annotation.style);
				annotation.style.style = objects.mixin({}, annotation.style.style);
				annotation.style.style.backgroundColor = "rgba(" + blameColor.join() + ")"; //$NON-NLS-0$ //$NON-NLS-1$
				annotation.groupId = blameMarker.Name;
				annotation.groupType = AT.ANNOTATION_CURRENT_BLAME;
				annotation.createGroupAnnotation = createGroup;
				annotation.html = '<img class="annotationHTML blame" src="' + blameMarker.AuthorImage + '"/>'; //$NON-NLS-0$ //$NON-NLS-1$
				annotation.blame = blameMarker;
				return annotation;
			});
		},

		/**
		 * Display git diff annotation on the editor's annotation ruler and overview ruler.
		 *
		 * @param diffs [] with types "added", "modified", "deleted"
		 * 		Each property in diffs contains an array of objects { lineStart, lineEnd } that
		 * 		provides the starting and ending line index for the specified property.
		 */
		showDiffAnnotations: function(diffs) {
			this.showAnnotations(diffs, [
				AT.ANNOTATION_DIFF_ADDED,
				AT.ANNOTATION_DIFF_MODIFIED,
				AT.ANNOTATION_DIFF_DELETED
			], null, function(annotation) {
				if(annotation.type === "added")//$NON-NLS-0$
					return AT.ANNOTATION_DIFF_ADDED;
				else if (annotation.type === "modified")//$NON-NLS-0$
					return AT.ANNOTATION_DIFF_MODIFIED;
				return AT.ANNOTATION_DIFF_DELETED; // assume deleted if not added or modified
			});
		},

		/**
		 * Reveals and selects a portion of text.
		 * @param {Number} start
		 * @param {Number} end
		 * @param {Number} line
		 * @param {Number} offset
		 * @param {Number} length
		 */
		showSelection: function(start, end, line, offset, length) {
			// We use typeof because we need to distinguish the number 0 from an undefined or null parameter
			if (typeof(start) === "number") { //$NON-NLS-0$
				if (typeof(end) !== "number") { //$NON-NLS-0$
					end = start;
				}
				this.moveSelection(start, end);
			} else if (typeof(line) === "number") { //$NON-NLS-0$
				var model = this.getModel();
				var pos = model.getLineStart(line-1);
				if (typeof(offset) === "number") { //$NON-NLS-0$
					pos = pos + offset;
				}
				if (typeof(length) !== "number") { //$NON-NLS-0$
					length = 0;
				}
				this.moveSelection(pos, pos+length);
			}
		},

		/**
		 * @private
		 */
		_setModelText: function(contents) {
			if (this._textView) {
				this._textView.setText(contents);
				this._textView.getModel().setLineDelimiter("auto"); //$NON-NLS-0$
				this._highlightCurrentLine(this._textView.getSelections());
			}
		},

		/**
		 * Sets the editor's contents.
		 *
		 * @param {String} title
		 * @param {String} message
		 * @param {String} contents
		 * @param {Boolean} contentsSaved
		 * @param {Boolean} noFocus
		 */
		setInput: function(title, message, contents, contentsSaved, noFocus) {
			BaseEditor.prototype.setInput.call(this, title, message, contents, contentsSaved);
			if (this._textView && !contentsSaved && !noFocus) {
				this._textView.focus();
			}
		},
		/**
		 * Reveals a line in the editor, and optionally selects a portion of the line.
		 * @param {Number} line - document base line index
		 * @param {Number|String} column
		 * @param {Number} [end]
		 */
		onGotoLine: function(line, column, end, callback) {
			if (this._textView) {
				var model = this.getModel();
				line = Math.max(0, Math.min(line, model.getLineCount() - 1));
				var lineStart = model.getLineStart(line);
				var start = 0;
				if (end === undefined) {
					end = 0;
				}
				if (typeof column === "string") { //$NON-NLS-0$
					var index = model.getLine(line).indexOf(column);
					if (index !== -1) {
						start = index;
						end = start + column.length;
					}
				} else {
					start = column;
					var lineLength = model.getLineEnd(line) - lineStart;
					start = Math.min(start, lineLength);
					end = Math.min(end, lineLength);
				}
				this.moveSelection(lineStart + start, lineStart + end, callback);
			}
		}
	});

	return {
		BaseEditor: BaseEditor,
		Editor: Editor
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/find", [ //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/keyBinding', //$NON-NLS-0$
	'orion/editor/keyModes', //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/regex', //$NON-NLS-0$
	'orion/objects', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(messages, mKeyBinding, mKeyModes, mAnnotations, mRegex, objects, util) {

	var exports = {};
	
	function IncrementalFind(editor) {
		var textView = editor.getTextView();
		mKeyModes.KeyMode.call(this, textView);
		this.editor = editor;
		this._active = false;
		this._success = true;
		this._ignoreSelection = false;
		this._prefix = "";
		
		textView.setAction("incrementalFindCancel", function() { //$NON-NLS-0$
			this.setActive(false);
			return true;
		}.bind(this));
		textView.setAction("incrementalFindBackspace", function() { //$NON-NLS-0$
			return this._backspace();
		}.bind(this));
		
		var self = this;
		this._listener = {
			onVerify: function(e){
				var editor = self.editor;
				var model = editor.getModel();
				var start = editor.mapOffset(e.start), end = editor.mapOffset(e.end);
				var txt = model.getText(start, end);
				var prefix = self._prefix;
				// TODO: mRegex is pulled in just for this one call so we can get case-insensitive search
				// is it really necessary
				var match = prefix.match(new RegExp("^" + mRegex.escape(txt), "i")); //$NON-NLS-1$ //$NON-NLS-0$
				if (match && match.length > 0) {
					prefix = self._prefix += e.text;
					self._success = true;
					self._status();
					self.find(self._forward, true);
					e.text = null;
				}
			},
			onSelection: function() {
				if (!self._ignoreSelection) {
					self.setActive(false);
				}
			}
		};
	}
	IncrementalFind.prototype = new mKeyModes.KeyMode();
	objects.mixin(IncrementalFind.prototype, {
		createKeyBindings: function() {
			var KeyBinding = mKeyBinding.KeyBinding;
			var bindings = [];
			bindings.push({actionID: "incrementalFindBackspace", keyBinding: new KeyBinding(8)}); //$NON-NLS-0$
			bindings.push({actionID: "incrementalFindCancel", keyBinding: new KeyBinding(13)}); //$NON-NLS-0$
			bindings.push({actionID: "incrementalFindCancel", keyBinding: new KeyBinding(27)}); //$NON-NLS-0$
			bindings.push({actionID: "incrementalFindReverse", keyBinding: new KeyBinding(38)}); //$NON-NLS-0$
			bindings.push({actionID: "incrementalFind", keyBinding: new KeyBinding(40)}); //$NON-NLS-0$
			bindings.push({actionID: "incrementalFindReverse", keyBinding: new KeyBinding('k', true, true)}); //$NON-NLS-1$ //$NON-NLS-0$
			bindings.push({actionID: "incrementalFind", keyBinding: new KeyBinding('k', true)}); //$NON-NLS-1$ //$NON-NLS-0$
			return bindings;
		},
		find: function(forward, incremental) {
			this._forward = forward;
			if (!this.isActive()) {
				this.setActive(true);
				return false;
			}
			var prefix = this._prefix;
			if (prefix.length === 0) {
				return false;
			}
			var editor = this.editor;
			var model = editor.getModel();
			var start;
			if (forward) {
				if (this._success) {
					start = incremental ? this._start : editor.getCaretOffset() + 1;
				} else {
					start = 0;
				}
			} else {
				if (this._success) {
					start = incremental ? this._start : editor.getCaretOffset();
				} else {
					start = model.getCharCount() - 1;
				}
			}
			var result = editor.getModel().find({
				string: prefix,
				start: start,
				reverse: !forward,
				caseInsensitive: prefix.toLowerCase() === prefix}).next();
			if (result) {
				if (!incremental) {
					this._start = start;
				}
				this._success = true;
				this._ignoreSelection = true;
				editor.moveSelection(forward ? result.start : result.end, forward ? result.end : result.start);
				this._ignoreSelection = false;
			} else {
				this._success = false;
			}
			this._status();
			return true;
		},
		isActive: function() {
			return this._active;
		},
		isStatusActive: function() {
			return this.isActive();
		},
		setActive: function(active) {
			if (this._active === active) {
				return;
			}
			this._active = active;
			this._prefix = "";
			this._success = true;
			var editor = this.editor;
			var textView = editor.getTextView();
			this._start = this.editor.getCaretOffset();
			this.editor.setCaretOffset(this._start);
			if (this._active) {
				textView.addEventListener("Verify", this._listener.onVerify); //$NON-NLS-0$
				textView.addEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
				textView.addKeyMode(this);
			} else {
				textView.removeEventListener("Verify", this._listener.onVerify); //$NON-NLS-0$
				textView.removeEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
				textView.removeKeyMode(this);
			}
			this._status();
		},
		_backspace: function() {
			var prefix = this._prefix;
			prefix = this._prefix = prefix.substring(0, prefix.length-1);
			if (prefix.length === 0) {
				this._success = true;
				this._ignoreSelection = true;
				this.editor.setCaretOffset(this.editor.getSelection().start);
				this._ignoreSelection = false;
				this._status();
				return true;
			}
			return this.find(this._forward, true);
		},
		_status: function() {
			if (!this.isActive()) {
				this.editor.reportStatus("");
				return;
			}
			var msg;
			if (this._forward) {
				msg = this._success ? messages.incrementalFindStr : messages.incrementalFindStrNotFound;
			} else {
				msg = this._success ? messages.incrementalFindReverseStr : messages.incrementalFindReverseStrNotFound;
			}
			msg = util.formatMessage(msg, this._prefix);
			this.editor.reportStatus(msg, this._success ? "" : "error"); //$NON-NLS-0$
		}
	});
	exports.IncrementalFind = IncrementalFind;
	
	
	function Find(editor, undoStack, options) {
		if (!editor) { return; }	
		this._editor = editor;
		this._undoStack = undoStack;
		this._showAll = true;
		this._visible = false;
		this._caseInsensitive = true;
		this._wrap = true;
		this._wholeWord = false;
		this._incremental = true;
		this._regex = false;
		this._findAfterReplace = true;
		this._hideAfterFind = false;
		this._reverse = false;
		this._start = undefined;
		this._end = undefined;
		this._timer = undefined;
		this._lastString = "";
		var that = this;
		this._listeners = {
			onEditorFocus: function(e) {
				that._removeCurrentAnnotation(e);
			}
		};
		this.setOptions(options);
	}
	Find.prototype = {
		find: function (forward, tempOptions, incremental) {
			this.setOptions({
				reverse : !forward
			});
			var string = this.getFindString();
			var count;
			if (tempOptions) {
				string = tempOptions.findString || string;
				count =  tempOptions.count;
			}
			var savedOptions = this.getOptions();
			this.setOptions(tempOptions);
			var startOffset = incremental ? this._startOffset : this.getStartOffset();
			var result = this._doFind(string, startOffset, count);
			if (result) {
				if (!incremental) {
					this._startOffset = result.start;
				}
			}
			this.setOptions(savedOptions);
			if (this._hideAfterFind) {
				this.hide();
			}
			return result;
		},
		getStartOffset: function() {
			if (this._start !== undefined) {
				return this._start;
			}
			if (this._reverse) {
				return this._editor.getSelection().start - 1;
			}
			return this._editor.getCaretOffset();
		},
		getFindString: function() {
			var selection = this._editor.getSelection();
			var searchString = this._editor.getText(selection.start, selection.end);
			if (this._regex) {
				searchString = mRegex.escape(searchString);
			}
			return searchString || this._lastString;
		},
		getOptions: function() {
			return {
				showAll: this._showAll, 
				caseInsensitive: this._caseInsensitive, 
				wrap: this._wrap, 
				wholeWord: this._wholeWord, 
				incremental: this._incremental,
				regex: this._regex,
				findAfterReplace: this._findAfterReplace,
				hideAfterFind: this._hideAfterFind,
				reverse: this._reverse,
				findCallback: this._findCallback,
				start: this._start,
				end: this._end
			};
		},
		getReplaceString: function() {
			return "";
		},
		hide: function() {
			this._visible = false;
			if (this._savedOptions) {
				this.setOptions(this._savedOptions.pop());
				if (this._savedOptions.length === 0) {
					this._savedOptions = null;
				}
			}
			this._removeAllAnnotations();
			var textView = this._editor.getTextView();
			if (textView) {
				textView.removeEventListener("Focus", this._listeners.onEditorFocus); //$NON-NLS-0$
				textView.focus();
			}
		},
		_processReplaceString: function(str) {
			var newStr = str;
			if (this._regex) {
				newStr = "";
				var escape = false;
				var delimiter = this._editor.getModel().getLineDelimiter();
				for (var i=0; i<str.length; i++) {
					var c = str.substring(i, i + 1);
					if (escape) {
						switch (c) {
							case "R": newStr += delimiter; break;
							case "r": newStr += "\r"; break;
							case "n": newStr += "\n"; break;
							case "t": newStr += "\t"; break;
							case "\\": newStr += "\\"; break;
							default: newStr += "\\" + c;
						}
						escape = false;
					} else if (c === "\\") {
						escape = true;
					} else {
						newStr += c;
					}
				}
				if (escape) {
					newStr += "\\";
				}
			}
			return newStr;
		},
		isVisible: function() {
			return this._visible;
		},
		replace: function() {
			var string = this.getFindString();
			if (string) {
				var editor = this._editor;
				var replaceString = this._processReplaceString(this.getReplaceString());
				var selection = editor.getSelection();
				var start = selection.start;
				var result = editor.getModel().find({
					string: string,
					start: start,
					reverse: false,
					wrap: this._wrap,
					regex: this._regex,
					wholeWord: this._wholeWord,
					caseInsensitive: this._caseInsensitive
				}).next();
				if (result) {
					this.startUndo();
					this._doReplace(result.start, result.end, string, replaceString);
					this.endUndo();
				}
			}
			if (this._findAfterReplace && string){
				this._doFind(string, this.getStartOffset());
			}
		},
		replaceAll : function() {
			var string = this.getFindString();
			if (string) {
				this._replacingAll = true;
				var editor = this._editor;
				var textView = editor.getTextView();
				editor.reportStatus(messages.replacingAll);
				var replaceString = this._processReplaceString(this.getReplaceString());
				var self = this;
				window.setTimeout(function() {
					var startPos = 0;
					var count = 0;
					while (true) {
						//For replace all, we need to ignore the wrap search from the user option
						//Otherwise the loop will be dead, see https://bugs.eclipse.org/bugs/show_bug.cgi?id=411813
						var result = self._doFind(string, startPos, null, true);
						if (!result) {
							break;
						}
						count++;
						if (count === 1) {
							textView.setRedraw(false);
							self.startUndo();
						}
						self._doReplace(result.start, result.end, string, replaceString);
						startPos = self.getStartOffset();
					}
					if (count > 0) {
						self.endUndo();
						textView.setRedraw(true);
					}
					if (startPos > 0) {
						editor.reportStatus(util.formatMessage(messages.replacedMatches, count));
					} else {
						editor.reportStatus(messages.nothingReplaced, "error"); //$NON-NLS-0$ 
					}
					self._replacingAll = false;
				}, 100);				
			}
		},
		/**
		 * @property {String} string the search string to be found.
		 * @property {Boolean} [regex=false] whether or not the search string is a regular expression.
		 * @property {Boolean} [wrap=false] whether or not to wrap search.
		 * @property {Boolean} [wholeWord=false] whether or not to search only whole words.
		 * @property {Boolean} [caseInsensitive=false] whether or not search is case insensitive.
		 * @property {Boolean} [reverse=false] whether or not to search backwards.
		 * @property {Number} [start=0] The start offset to start searching
		 * @property {Number} [end=charCount] The end offset of the search. Used to search in a given range.	
		 */
		setOptions : function(options) {
			if (options) {
				if ((options.showAll === true || options.showAll === false) && this._showAll !== options.showAll) {
					this._showAll = options.showAll;
					if (this.isVisible()) {
						if (this._showAll) {
							this._markAllOccurrences();
						} else {
							var annotationModel = this._editor.getAnnotationModel();
							if (annotationModel) {
								annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_MATCHING_SEARCH);
							}
						}
					}
				}
				if (options.caseInsensitive === true || options.caseInsensitive === false) {
					this._caseInsensitive = options.caseInsensitive;
				}
				if (options.wrap === true || options.wrap === false) {
					this._wrap = options.wrap;
				}
				if (options.wholeWord === true || options.wholeWord === false) {
					this._wholeWord = options.wholeWord;
				}
				if (options.incremental === true || options.incremental === false) {
					this._incremental = options.incremental;
				}
				if (options.regex === true || options.regex === false) {
					this._regex = options.regex;
				}
				if (options.findAfterReplace === true || options.findAfterReplace === false) {
					this._findAfterReplace = options.findAfterReplace;
				}
				if (options.hideAfterFind === true || options.hideAfterFind === false) {
					this._hideAfterFind = options.hideAfterFind;
				}
				if (options.reverse === true || options.reverse === false) {
					this._reverse = options.reverse;
				}
				if (options.hasOwnProperty("findCallback")) { //$NON-NLS-0$
					this._findCallback = options.findCallback;
				}
				if (options.hasOwnProperty("start")) { //$NON-NLS-0$	
					this._start = options.start;
				}
				if (options.hasOwnProperty("end")) { //$NON-NLS-0$
					this._end = options.end;
				}
			}
		},
		show: function(tempOptions) {
			this._visible = true;
			if (tempOptions) {
				if (!this._savedOptions) {
					this._savedOptions = [];
				}	
				this._savedOptions.push(this.getOptions());
				this.setOptions(tempOptions);
			}
			this._startOffset = this._editor.getSelection().start;
			this._editor.getTextView().addEventListener("Focus", this._listeners.onEditorFocus); //$NON-NLS-0$
			var self = this;
			window.setTimeout(function() {
				if (self._incremental) {
					self.find(true, null, true);
				}
			}, 0);
		},
		startUndo: function() {
			if (this._undoStack) {
				this._undoStack.startCompoundChange();
			}
		}, 
		endUndo: function() {
			if (this._undoStack) {
				this._undoStack.endCompoundChange();
			}
		},
		_find: function(string, startOffset, noWrap) {
			return this._editor.getModel().find({
				string: string,
				start: startOffset,
				end: this._end,
				reverse: this._reverse,
				wrap: (noWrap ? false: this._wrap),
				regex: this._regex,
				wholeWord: this._wholeWord,
				caseInsensitive: this._caseInsensitive
			});
		},
		_doFind: function(string, startOffset, count, noWrap) {
			count = count || 1;
			var editor = this._editor;
			if (!string) {
				this._removeAllAnnotations();
				return null;
			}
			this._lastString = string;
			var result, iterator;
			if (this._regex) {
				try {
					iterator = this._find(string, startOffset, noWrap);
				} catch (ex) {
					editor.reportStatus(ex.message, "error"); //$NON-NLS-0$
					return;
				}
			} else {
				iterator = this._find(string, startOffset, noWrap);
			}
			for (var i=0; i<count && iterator.hasNext(); i++) {
				result = iterator.next();
			}
			if (!this._replacingAll) {
				if (result) {
					this._editor.reportStatus("");
				} else {
					this._editor.reportStatus(messages.notFound, "error"); //$NON-NLS-0$
				}
				if (this.isVisible()) {
					var type = mAnnotations.AnnotationType.ANNOTATION_CURRENT_SEARCH;
					var annotationModel = editor.getAnnotationModel();
					if (annotationModel) {
						annotationModel.removeAnnotations(type);
						if (result) {
							annotationModel.addAnnotation(mAnnotations.AnnotationType.createAnnotation(type, result.start, result.end));
						}
					}
					if (this._showAll) {
						if (this._timer) {
							window.clearTimeout(this._timer);
						}
						var that = this;
						this._timer = window.setTimeout(function(){
							that._markAllOccurrences();
							that._timer = null;
						}, 500);
					}
				}
				if (this._findCallback) {
					this._findCallback(result);
				}
				else if (result) {
					editor.moveSelection(result.start, result.end, null, false);
				}
			}
			return result;
		},
		_doReplace: function(start, end, searchStr, newStr) {
			var editor = this._editor;
			if (this._regex) {
				newStr = editor.getText(start, end).replace(new RegExp(searchStr, this._caseInsensitive ? "i" : ""), newStr); //$NON-NLS-0$
			}
			editor.setText(newStr, start, end);
			editor.setSelection(start, start + newStr.length, true);
		},
		_markAllOccurrences: function() {
			var annotationModel = this._editor.getAnnotationModel();
			if (!annotationModel) {
				return;
			}
			var type = mAnnotations.AnnotationType.ANNOTATION_MATCHING_SEARCH;
			var iter = annotationModel.getAnnotations();
			var remove = [], add;
			while (iter.hasNext()) {
				var annotation = iter.next();
				if (annotation.type === type) {
					remove.push(annotation);
				}
			}
			if (this.isVisible()) {
				var string = this.getFindString();
				iter = this._editor.getModel().find({
					string: string,
					regex: this._regex,
					wholeWord: this._wholeWord,
					caseInsensitive: this._caseInsensitive
				});
				add = [];
				while (iter.hasNext()) {
					var range = iter.next();
					add.push(mAnnotations.AnnotationType.createAnnotation(type, range.start, range.end));
				}
			}
			annotationModel.replaceAnnotations(remove, add);
		},
		_removeAllAnnotations: function() {
			var annotationModel = this._editor.getAnnotationModel();
			if (annotationModel) {
				annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_CURRENT_SEARCH);
				annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_MATCHING_SEARCH);
			}
		},
		_removeCurrentAnnotation: function(evt){
			var annotationModel = this._editor.getAnnotationModel();
			if (annotationModel) {
				annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_CURRENT_SEARCH);
			}
		}
	};
	exports.Find = Find;
	
	return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: 
 *	IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/editor/findUI',[
	'i18n!orion/editor/nls/messages',
	'orion/editor/find',
	'orion/objects',
	'orion/editor/util',
	'orion/util', 
], function(messages, mFind, objects, textUtil, util) {
	
	function FindUI(editor, undoStack, options) {
		mFind.Find.call(this, editor, undoStack, options);
	}
	
	FindUI.prototype = new mFind.Find();
	
	objects.mixin(FindUI.prototype, {
		getFindString: function() {
			var input = this._findInput;
			if (!input) {
				return mFind.Find.prototype.getFindString.call(this);
			}
			return input.value;
		},
		getReplaceString: function() {
			var input = this._replaceInput;
			if (!input) {
				return mFind.Find.prototype.getReplaceString(this);
			}
			return input.value;
		},
		hide: function() {
			var visible = this.isVisible();
			mFind.Find.prototype.hide.call(this);
			if (visible) {
				this._rootDiv.className = "textViewFind"; //$NON-NLS-0$
			}
		},
		show: function(options) {
			mFind.Find.prototype.show.call(this, options);
			var findString = options.findString;
			var replaceString = options.replaceString;
			var input = this._findInput;
			if (!input) {
				this._create();
				input = this._findInput;
			}
			if (findString) {
				input.value = findString;
			}
			if (replaceString) {
				var replaceInput = this._replaceInput;
				replaceInput.value = replaceString;
			}
			var that = this;
			window.setTimeout(function() {
				that._rootDiv.className = "textViewFind show"; //$NON-NLS-0$
				input.select();
				input.focus();
			}, 0);
		},
		_create: function() {
			var that = this;
			var view = this._editor.getTextView();
			var parent = view.getOptions("parent"); //$NON-NLS-0$
			var document = parent.ownerDocument; //$NON-NLS-0$
			var root = util.createElement(document, 'div'); //$NON-NLS-0$
			root.className = "textViewFind"; //$NON-NLS-0$
			textUtil.addEventListener(root, "keydown", function(e) { that._handleKeyDown(e); }); //$NON-NLS-0$
			this._rootDiv = root;
			this._createContents(document, root);
			view._rootDiv.insertBefore(root, view._rootDiv.firstChild);
		},
		_createContents: function(document, parent) {
			var that = this;
			var fintInput = util.createElement(document, 'input'); //$NON-NLS-0$
			fintInput.className = "textViewFindInput"; //$NON-NLS-0$
			this._findInput = fintInput;
			fintInput.type = "text"; //$NON-NLS-0$
			fintInput.placeholder = messages.findWith;
			textUtil.addEventListener(fintInput, "input", function(evt) { //$NON-NLS-0$
				return that._handleInput(evt);
			});
			parent.appendChild(fintInput);

			var group = util.createElement(document, 'span'); //$NON-NLS-0$
			that._createButton(document, group, messages.next, function() { that.find(true); });
			that._createButton(document, group, messages.previous, function() { that.find(false); });
			parent.appendChild(group);
			
			var readonly = that._editor.getTextView().getOptions("readonly"); //$NON-NLS-0$
			if (!readonly) {
				// create replace text
				var replaceInput = util.createElement(document, 'input'); //$NON-NLS-0$
				replaceInput.className = "textViewReplaceInput"; //$NON-NLS-0$
				this._replaceInput = replaceInput;
				replaceInput.type = "text"; //$NON-NLS-0$
				replaceInput.placeholder = messages.replaceWith;
				parent.appendChild(replaceInput);
				group = util.createElement(document, 'span'); //$NON-NLS-0$
				that._createButton(document, group, messages.replace, function() { that.replace(); });
				that._createButton(document, group, messages.replaceAll, function() { that.replaceAll(); });
				parent.appendChild(group);
			}

			group = util.createElement(document, 'span'); //$NON-NLS-0$
			that._createButton(document, group, messages.regex, function(evt) { that._toggle("regex", evt.target); }, this._regex, messages.regexTooltip); //$NON-NLS-0$
			that._createButton(document, group, messages.caseInsensitive, function(evt) { that._toggle("caseInsensitive", evt.target); }, this._caseInsensitive, messages.caseInsensitiveTooltip); //$NON-NLS-0$
			that._createButton(document, group, messages.wholeWord, function(evt) { that._toggle("wholeWord", evt.target); }, this._wholeWord, messages.wholeWordTooltip); //$NON-NLS-0$
			parent.appendChild(group);

			var close = that._createButton(document, parent, "", function() { that.hide(); }); //$NON-NLS-0$
			close.className = "textViewFindCloseButton"; //$NON-NLS-0$
			close.title = messages.closeTooltip;
		},
		_createButton: function(document, parent, text, callback, checked, tooltip) {
			var button  = document.createElement("button"); //$NON-NLS-0$
			this._checked(checked, button);
			if (tooltip) button.title = tooltip;
			textUtil.addEventListener(button, "click", function(evt) { callback.call(this, evt); }, false); //$NON-NLS-0$
			if (text) {
				button.appendChild(document.createTextNode(text)); //$NON-NLS-0$
			}
			parent.appendChild(button);
			return button;
		},
		_toggle: function(prop, button) {
			var options = {};
			options[prop] = !this["_" + prop]; //$NON-NLS-0$
			this.setOptions(options);
			this._checked(options[prop], button);
		},
		_checked: function(checked, button) {
			button.className = "textViewFindButton"; //$NON-NLS-0$
			if (checked) {
				button.className += " checked"; //$NON-NLS-0$
			}
		},
		_handleInput: function() {
			if (this._incremental) {
				this.find(true, null, true);
			}
			return true;
		},
		_handleKeyDown: function(evt) {
			var handled;
			var ctrlKeyOnly = (util.isMac ? evt.metaKey : evt.ctrlKey) && !evt.altKey && !evt.shiftKey;
			if (ctrlKeyOnly && evt.keyCode === 70/*"f"*/ ) {
				handled = true;
			}
			//We can't use ctrlKeyOnly on "k" because ctrl+shift+k means find previous match when the find bar gets focus
			if (((util.isMac ? evt.metaKey : evt.ctrlKey) && !evt.altKey && evt.keyCode === 75/*"k"*/) || evt.keyCode === 13/*enter*/){
				if (evt.keyCode === 13) {
					this.find(this._reverse ? evt.shiftKey : !evt.shiftKey);
				} else {
					this.find(!evt.shiftKey);
				}
				handled = true;
			}
			if (ctrlKeyOnly &&  evt.keyCode === 82 /*"r"*/){
				this.replace();
				handled = true;
			}
			if (evt.keyCode === 27/*ESC*/){
				this.hide();
				handled = true;
			}
			if (handled) {
				if (evt.stopPropagation) { 
					evt.stopPropagation(); 
				}
				if (evt.preventDefault) { 
					evt.preventDefault(); 
				}
				evt.cancelBubble = true;
				return false;
			}
			return true;
		}
	});

	return {FindUI: FindUI};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/actions", [ //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/keyBinding', //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/editor/tooltip', //$NON-NLS-0$
	'orion/editor/find', //$NON-NLS-0$
	'orion/editor/findUI', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(messages, mKeyBinding, mAnnotations, mTooltip, mFind, mFindUI, util) {

	var AT = mAnnotations.AnnotationType;

	var exports = {};
	
	function forEachSelection(actions, compound, callback, noUndo) {
		var offset = 0;
		var editor = actions.editor;
		var selections = editor.getSelections();
		if (!noUndo && (compound || selections.length > 1)) actions.startUndo();
		function setText(text, start, end) {
			editor.setText(text, start, end);
			offset += (start - end) + text.length;
		}
		selections.forEach(function(selection) {
			selection.start += offset;
			selection.end += offset;
			callback(selection, setText);
		});
		editor.setSelections(selections);
		if (!noUndo && (compound || selections.length > 1)) actions.endUndo();
	}

	/**
	 * TextActions connects common text editing keybindings onto an editor.
	 */
	function TextActions(editor, undoStack, find) {
		this.editor = editor;
		this.undoStack = undoStack;
		this._incrementalFind = new mFind.IncrementalFind(editor);
		this._find = find ? find : new mFindUI.FindUI(editor, undoStack);
		this._lastEditLocation = null;
		this.init();
	}

	TextActions.prototype = {
		init: function() {
			var textView = this.editor.getTextView();

			this._lastEditListener = {
				onModelChanged: function(e) {
					if (this.editor.isDirty()) {
						this._lastEditLocation = e.start + e.addedCharCount;
					}
				}.bind(this)
			};
			textView.addEventListener("ModelChanged", this._lastEditListener.onModelChanged); //$NON-NLS-0$

			textView.setAction("undo", function(data) { //$NON-NLS-0$
				if (this.undoStack) {
					var count = 1;
					if (data && data.count) {
						count = data.count;
					}
					while (count > 0) {
						this.undoStack.undo();
						--count;
					}
					return true;
				}
				return false;
			}.bind(this), {name: messages.undo});

			textView.setAction("redo", function(data) { //$NON-NLS-0$
				if (this.undoStack) {
					var count = 1;
					if (data && data.count) {
						count = data.count;
					}
					while (count > 0) {
						this.undoStack.redo();
						--count;
					}
					return true;
				}
				return false;
			}.bind(this), {name: messages.redo});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("f", true), "find"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("find", function() { //$NON-NLS-0$
				if (this._find) {
					var selection = this.editor.getSelection();
					this._find.show({findString:this.editor.getText(selection.start, selection.end)});
					return true;
				}
				return false;
			}.bind(this), {name: messages.find});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("k", true), "findNext"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("findNext", function(options) { //$NON-NLS-0$
				if (this._find){
					this._find.find(true, options);
					return true;
				}
				return false;
			}.bind(this), {name: messages.findNext});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("k", true, true), "findPrevious"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("findPrevious", function(options) { //$NON-NLS-0$
				if (this._find){
					this._find.find(false, options);
					return true;
				}
				return false;
			}.bind(this), {name: messages.findPrevious});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("j", true), "incrementalFind"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("incrementalFind", function() { //$NON-NLS-0$
				if (this._incrementalFind) {
					this._incrementalFind.find(true);
				}
				return true;
			}.bind(this), {name: messages.incrementalFind});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("j", true, true), "incrementalFindReverse"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("incrementalFindReverse", function() { //$NON-NLS-0$
				if (this._incrementalFind) {
					this._incrementalFind.find(false);
				}
				return true;
			}.bind(this), {name: messages.incrementalFindReverse});

			textView.setAction("tab", function() { //$NON-NLS-0$
				return this.indentLines();
			}.bind(this));

			textView.setAction("shiftTab", function() { //$NON-NLS-0$
				return this.unindentLines();
			}.bind(this), {name: messages.unindentLines});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(38, false, false, true), "moveLinesUp"); //$NON-NLS-0$
			textView.setAction("moveLinesUp", function() { //$NON-NLS-0$
				return this.moveLinesUp();
			}.bind(this), {name: messages.moveLinesUp});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(40, false, false, true), "moveLinesDown"); //$NON-NLS-0$
			textView.setAction("moveLinesDown", function() { //$NON-NLS-0$
				return this.moveLinesDown();
			}.bind(this), {name: messages.moveLinesDown});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(38, true, false, true), "copyLinesUp"); //$NON-NLS-0$
			textView.setAction("copyLinesUp", function() { //$NON-NLS-0$
				return this.copyLinesUp();
			}.bind(this), {name: messages.copyLinesUp});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(40, true, false, true), "copyLinesDown"); //$NON-NLS-0$
			textView.setAction("copyLinesDown", function() { //$NON-NLS-0$
				return this.copyLinesDown();
			}.bind(this), {name: messages.copyLinesDown});

			textView.setKeyBinding(new mKeyBinding.KeyBinding('d', true, false, false), "deleteLines"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("deleteLines", function(data) { //$NON-NLS-0$
				return this.deleteLines(data);
			}.bind(this), {name: messages.deleteLines});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("l", !util.isMac, false, false, util.isMac), "gotoLine"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("gotoLine", function() { //$NON-NLS-0$
				return this.gotoLine();
			}.bind(this), {name: messages.gotoLine});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(190, true), "nextAnnotation"); //$NON-NLS-0$
			textView.setAction("nextAnnotation", function() { //$NON-NLS-0$
				return this.nextAnnotation(true);
			}.bind(this), {name: messages.nextAnnotation});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(188, true), "previousAnnotation"); //$NON-NLS-0$
			textView.setAction("previousAnnotation", function() { //$NON-NLS-0$
				return this.nextAnnotation(false);
			}.bind(this), {name: messages.prevAnnotation});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("e", true, false, true, false), "expand"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("expand", function() { //$NON-NLS-0$
				return this.expandAnnotation(true);
			}.bind(this), {name: messages.expand});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("c", true, false, true, false), "collapse"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("collapse", function() { //$NON-NLS-0$
				return this.expandAnnotation(false);
			}.bind(this), {name: messages.collapse});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("e", true, true, true, false), "expandAll"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("expandAll", function() { //$NON-NLS-0$
				return this.expandAnnotations(true);
			}.bind(this), {name: messages.expandAll});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("c", true, true, true, false), "collapseAll"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("collapseAll", function() { //$NON-NLS-0$
				return this.expandAnnotations(false);
			}.bind(this), {name: messages.collapseAll});

			textView.setKeyBinding(new mKeyBinding.KeyBinding("q", !util.isMac, false, false, util.isMac), "lastEdit"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("lastEdit", function() { //$NON-NLS-0$
				return this.gotoLastEdit();
			}.bind(this), {name: messages.lastEdit});
		},
		copyLinesDown: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				var lineStart = model.getLineStart(firstLine);
				var lineEnd = model.getLineEnd(lastLine, true);
				var lineCount = model.getLineCount();
				var delimiter = "";
				var text = model.getText(lineStart, lineEnd);
				if (lastLine === lineCount-1) {
					text = (delimiter = model.getLineDelimiter()) + text;
				}
				var insertOffset = lineEnd;
				setText(text, insertOffset, insertOffset);
				selection.start = insertOffset + delimiter.length;
				selection.end = insertOffset + text.length;
			});
			return true;
		},
		copyLinesUp: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				var lineStart = model.getLineStart(firstLine);
				var lineEnd = model.getLineEnd(lastLine, true);
				var lineCount = model.getLineCount();
				var delimiter = "";
				var text = model.getText(lineStart, lineEnd);
				if (lastLine === lineCount-1) {
					text += (delimiter = model.getLineDelimiter());
				}
				var insertOffset = lineStart;
				setText(text, insertOffset, insertOffset);
				selection.start = insertOffset;
				selection.end = insertOffset + text.length - delimiter.length;
			});
			return true;
		},
		deleteLines: function(data) {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var count = 1;
			if (data && data.count) {
				count = data.count;
			}
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lineStart = model.getLineStart(firstLine);
				var lastLine;
				if (selection.start !== selection.end || count === 1) {
					lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				} else {
					lastLine = Math.min(firstLine + count - 1, model.getLineCount() - 1);
				}	
				var lineEnd = model.getLineEnd(lastLine, true);
				setText("", lineStart, lineEnd);
				selection.start = selection.end = lineStart;
			});
			return true;
		},
		expandAnnotation: function(expand) {
			var editor = this.editor;
			var annotationModel = editor.getAnnotationModel();
			if(!annotationModel) { return true; }
			var model = editor.getModel();
			var currentOffset = editor.getCaretOffset();
			var lineIndex = model.getLineAtOffset(currentOffset);
			var start = model.getLineStart(lineIndex);
			var end = model.getLineEnd(lineIndex, true);
			if (model.getBaseModel) {
				start = model.mapOffset(start);
				end = model.mapOffset(end);
				model = model.getBaseModel();
			}
			var annotation, iter = annotationModel.getAnnotations(start, end);
			while (!annotation && iter.hasNext()) {
				var a = iter.next();
				if (a.type !== mAnnotations.AnnotationType.ANNOTATION_FOLDING) { continue; }
				annotation = a;
			}
			if (annotation) {
				if (expand !== annotation.expanded) {
					if (expand) {
						annotation.expand();
					} else {
						editor.setCaretOffset(annotation.start);
						annotation.collapse();
					}
				}
			}
			return true;
		},
		expandAnnotations: function(expand) {
			var editor = this.editor;
			var textView = editor.getTextView();
			var annotationModel = editor.getAnnotationModel();
			if(!annotationModel) { return true; }
			var annotation, iter = annotationModel.getAnnotations();
			textView.setRedraw(false);
			while (iter.hasNext()) {
				annotation = iter.next();
				if (annotation.type !== mAnnotations.AnnotationType.ANNOTATION_FOLDING) { continue; }
				if (expand !== annotation.expanded) {
					if (expand) {
						annotation.expand();
					} else {
						annotation.collapse();
					}
				}
			}
			textView.setRedraw(true);
			return true;
		},
		indentLines: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			if(!textView.getOptions("tabMode")) { return; } //$NON-NLS-0$
			var model = editor.getModel();
			var offset = 0;
			var selections = editor.getSelections();
			if (selections.length > 1) this.startUndo();
			if (selections.some(function(selection) {
				selection.start += offset;
				selection.end += offset;
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				if (firstLine !== lastLine || selections.length > 1) {
					var lines = [];
					lines.push("");
					for (var i = firstLine; i <= lastLine; i++) {
						lines.push(model.getLine(i, true));
					}
					var lineStart = model.getLineStart(firstLine);
					var lineEnd = model.getLineEnd(lastLine, true);
					var options = textView.getOptions("tabSize", "expandTab"); //$NON-NLS-1$ //$NON-NLS-0$
					var tab = options.expandTab ? new Array(options.tabSize + 1).join(" ") : "\t"; //$NON-NLS-1$ //$NON-NLS-0$
					var text = lines.join(tab);
					editor.setText(text, lineStart, lineEnd);
					var start = lineStart === selection.start ? selection.start : selection.start + tab.length;
					var end = selection.end + ((lastLine - firstLine + 1) * tab.length);
					offset += (lineStart - lineEnd) + text.length;
					selection.start = start;
					selection.end = end;
				} else {
					return true;
				}
				return false;
			})) return false;
			editor.setSelections(selections);
			if (selections.length > 1) this.endUndo();
			return true;
		},
		gotoLastEdit: function() {
			if (typeof this._lastEditLocation === "number")  { //$NON-NLS-0$
				this.editor.showSelection(this._lastEditLocation);
			}
			return true;
		},
		gotoLine: function() {
			var editor = this.editor;
			var model = editor.getModel();
			var line = model.getLineAtOffset(editor.getCaretOffset());
			line = prompt(messages.gotoLinePrompty, line + 1);
			if (line) {
				line = parseInt(line, 10);
				editor.onGotoLine(line - 1, 0);
			}
			return true;
		},
		moveLinesDown: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, true, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				var lineCount = model.getLineCount();
				if (lastLine !== lineCount-1) {
					var lineStart = model.getLineStart(firstLine);
					var lineEnd = model.getLineEnd(lastLine, true);
					var insertOffset = model.getLineEnd(lastLine+1, true) - (lineEnd - lineStart);
					var text, delimiterLength = 0;
					if (lastLine !== lineCount-2) {
						text = model.getText(lineStart, lineEnd);
					} else {
						// Move delimiter following selection to front of the text
						var lineEndNoDelimiter = model.getLineEnd(lastLine);
						text = model.getText(lineEndNoDelimiter, lineEnd) + model.getText(lineStart, lineEndNoDelimiter);
						delimiterLength += lineEnd - lineEndNoDelimiter;
					}
					setText("", lineStart, lineEnd);
					setText(text, insertOffset, insertOffset);
					selection.start = insertOffset + delimiterLength;
					selection.end = insertOffset + delimiterLength + text.length;
				}
			});
			return true;
		},
		moveLinesUp: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, true, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				if (firstLine !== 0) {
					var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
					var lineCount = model.getLineCount();
					var insertOffset = model.getLineStart(firstLine - 1);
					var lineStart = model.getLineStart(firstLine);
					var lineEnd = model.getLineEnd(lastLine, true);
					var text = model.getText(lineStart, lineEnd);
					var delimiterLength = 0;
					if (lastLine === lineCount-1) {
						// Move delimiter preceding selection to end of text
						var delimiterStart = model.getLineEnd(firstLine - 1);
						var delimiterEnd = model.getLineEnd(firstLine - 1, true);
						text += model.getText(delimiterStart, delimiterEnd);
						lineStart = delimiterStart;
						delimiterLength = delimiterEnd - delimiterStart;
					}
					setText("", lineStart, lineEnd);
					setText(text, insertOffset, insertOffset);
					selection.start = insertOffset;
					selection.end = insertOffset + text.length - delimiterLength;
				}
			});
			return true;
		},
		nextAnnotation: function (forward) {
			var editor = this.editor;
			var annotationModel = editor.getAnnotationModel();
			if (!annotationModel) { return true; }
			var list = editor.getOverviewRuler() || editor.getAnnotationStyler();
			if (!list) { return true; }
			function ignore(annotation) {
				return !!annotation.lineStyle ||
					annotation.type === AT.ANNOTATION_MATCHING_BRACKET ||
					annotation.type === AT.ANNOTATION_CURRENT_BRACKET ||
					!list.isAnnotationTypeVisible(annotation.type);
			}
			var model = editor.getModel();
			var currentOffset = editor.getCaretOffset();
			var annotations = annotationModel.getAnnotations(forward ? currentOffset : 0, forward ? model.getCharCount() : currentOffset);
			var foundAnnotation = null;
			while (annotations.hasNext()) {
				var annotation = annotations.next();
				if (forward) {
					if (annotation.start <= currentOffset) { continue; }
				} else {
					if (annotation.start >= currentOffset) { continue; }
				}
				if (ignore(annotation)) {
					continue;
				}
				foundAnnotation = annotation;
				if (forward) {
					break;
				}
			}
			if (foundAnnotation) {
				var foundAnnotations = [foundAnnotation];
				annotations = annotationModel.getAnnotations(foundAnnotation.start, foundAnnotation.start);
				while (annotations.hasNext()) {
					annotation = annotations.next();
					if (annotation !== foundAnnotation && !ignore(annotation)) {
						foundAnnotations.push(annotation);
					}
				}
				var view = editor.getTextView();
				var nextLine = model.getLineAtOffset(foundAnnotation.start);
				var tooltip = mTooltip.Tooltip.getTooltip(view);
				if (!tooltip) {
					editor.moveSelection(foundAnnotation.start);
					return true;
				}
				editor.moveSelection(foundAnnotation.start, foundAnnotation.start, function() {
					tooltip.setTarget({
						getTooltipInfo: function() {
							var tooltipCoords = view.convert({
								x: view.getLocationAtOffset(foundAnnotation.start).x,
								y: view.getLocationAtOffset(model.getLineStart(nextLine)).y
							}, "document", "page"); //$NON-NLS-1$ //$NON-NLS-0$
							return {
								contents: foundAnnotations,
								x: tooltipCoords.x,
								y: tooltipCoords.y + Math.floor(view.getLineHeight(nextLine) * 1.33)
							};
						}
					}, 0);
				});
			}
			return true;
		},
		unindentLines: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			if(!textView.getOptions("tabMode")) { return; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				var tabSize = textView.getOptions("tabSize"); //$NON-NLS-0$
				var spaceTab = new Array(tabSize + 1).join(" "); //$NON-NLS-0$
				var lines = [], removeCount = 0, firstRemoveCount = 0;
				for (var i = firstLine; i <= lastLine; i++) {
					var line = model.getLine(i, true);
					if (model.getLineStart(i) !== model.getLineEnd(i)) {
						if (line.indexOf("\t") === 0) { //$NON-NLS-0$
							line = line.substring(1);
							removeCount++;
						} else if (line.indexOf(spaceTab) === 0) {
							line = line.substring(tabSize);
							removeCount += tabSize;
						} else {
							return true;
						}
					}
					if (i === firstLine) {
						firstRemoveCount = removeCount;
					}
					lines.push(line);
				}
				var lineStart = model.getLineStart(firstLine);
				var lineEnd = model.getLineEnd(lastLine, true);
				var lastLineStart = model.getLineStart(lastLine);
				var text = lines.join("");
				setText(text, lineStart, lineEnd);
				var start = lineStart === selection.start ? selection.start : selection.start - firstRemoveCount;
				var end = Math.max(start, selection.end - removeCount + (selection.end === lastLineStart+1 && selection.start !== selection.end ? 1 : 0));
				selection.start = start;
				selection.end = end;
			});
			return true;
		},
		startUndo: function() {
			if (this.undoStack) {
				this.undoStack.startCompoundChange();
			}
		},
		endUndo: function() {
			if (this.undoStack) {
				this.undoStack.endCompoundChange();
			}
		}
	};
	exports.TextActions = TextActions;

	/**
	 * @param {orion.editor.Editor} editor
	 * @param {orion.editor.UndoStack} undoStack
	 * @param {orion.editor.ContentAssist} [contentAssist]
	 * @param {orion.editor.LinkedMode} [linkedMode]
	 */
	function SourceCodeActions(editor, undoStack, contentAssist, linkedMode) {
		this.editor = editor;
		this.undoStack = undoStack;
		this.contentAssist = contentAssist;
		this.linkedMode = linkedMode;
		if (this.contentAssist) {
			this.contentAssist.addEventListener("ProposalApplied", this.contentAssistProposalApplied.bind(this)); //$NON-NLS-0$
		}
		this.init();
	}
	SourceCodeActions.prototype = {
		init: function() {
			var textView = this.editor.getTextView();

			textView.setAction("lineStart", function() { //$NON-NLS-0$
				return this.lineStart();
			}.bind(this));

			textView.setAction("enter", function() { //$NON-NLS-0$
				return this.autoIndent();
			}.bind(this));

			textView.setKeyBinding(new mKeyBinding.KeyBinding("t", true, false, true), "trimTrailingWhitespaces"); //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("trimTrailingWhitespaces", function() { //$NON-NLS-0$
				return this.trimTrailingWhitespaces();
			}.bind(this), {name: messages.trimTrailingWhitespaces});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(191, true), "toggleLineComment"); //$NON-NLS-0$
			textView.setAction("toggleLineComment", function() { //$NON-NLS-0$
				return this.toggleLineComment();
			}.bind(this), {name: messages.toggleLineComment});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(191, true, !util.isMac, false, util.isMac), "addBlockComment"); //$NON-NLS-0$
			textView.setAction("addBlockComment", function() { //$NON-NLS-0$
				return this.addBlockComment();
			}.bind(this), {name: messages.addBlockComment});

			textView.setKeyBinding(new mKeyBinding.KeyBinding(220, true, !util.isMac, false, util.isMac), "removeBlockComment"); //$NON-NLS-0$
			textView.setAction("removeBlockComment", function() { //$NON-NLS-0$
				return this.removeBlockComment();
			}.bind(this), {name: messages.removeBlockComment});

			// Autocomplete square brackets []
			textView.setKeyBinding(new mKeyBinding.KeyBinding("[", false, false, false, false, "keypress"), "autoPairSquareBracket"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairSquareBracket", function() { //$NON-NLS-0$
				return this.autoPairBrackets("[", "]"); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			textView.setKeyBinding(new mKeyBinding.KeyBinding(']', false, false, false, false, "keypress"), "skipClosingSquareBracket"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("skipClosingSquareBracket", function() { //$NON-NLS-0$
				return this.skipClosingBracket(']'); //$NON-NLS-0$
			}.bind(this));

			// Autocomplete angle brackets <>
			textView.setKeyBinding(new mKeyBinding.KeyBinding("<", false, false, false, false, "keypress"), "autoPairAngleBracket"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairAngleBracket", function() { //$NON-NLS-0$
				return this.autoPairBrackets("<", ">"); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			textView.setKeyBinding(new mKeyBinding.KeyBinding('>', false, false, false, false, "keypress"), "skipClosingAngleBracket"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("skipClosingAngleBracket", function() { //$NON-NLS-0$
				return this.skipClosingBracket('>'); //$NON-NLS-0$
			}.bind(this));

			// Autocomplete parentheses ()
			textView.setKeyBinding(new mKeyBinding.KeyBinding("(", false, false, false, false, "keypress"), "autoPairParentheses"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairParentheses", function() { //$NON-NLS-0$
				return this.autoPairBrackets("(", ")"); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			textView.setKeyBinding(new mKeyBinding.KeyBinding(')', false, false, false, false, "keypress"), "skipClosingParenthesis"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("skipClosingParenthesis", function() { //$NON-NLS-0$
				return this.skipClosingBracket(")"); //$NON-NLS-0$
			}.bind(this));

			// Autocomplete braces {}
			textView.setKeyBinding(new mKeyBinding.KeyBinding("{", false, false, false, false, "keypress"), "autoPairBraces"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairBraces", function() { //$NON-NLS-0$
				return this.autoPairBrackets("{", "}"); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			textView.setKeyBinding(new mKeyBinding.KeyBinding('}', false, false, false, false, "keypress"), "skipClosingBrace"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("skipClosingBrace", function() { //$NON-NLS-0$
				return this.skipClosingBracket("}"); //$NON-NLS-0$
			}.bind(this));

			// Autocomplete single quotations
			textView.setKeyBinding(new mKeyBinding.KeyBinding("'", false, false, false, false, "keypress"), "autoPairSingleQuotation"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairSingleQuotation", function() { //$NON-NLS-0$
				return this.autoPairQuotations("'"); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			// Autocomplete double quotations
			textView.setKeyBinding(new mKeyBinding.KeyBinding('"', false, false, false, false, "keypress"), "autoPairDblQuotation"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			textView.setAction("autoPairDblQuotation", function() { //$NON-NLS-0$
				return this.autoPairQuotations('"'); //$NON-NLS-1$ //$NON-NLS-0$
			}.bind(this));

			textView.setAction("deletePrevious", function() { //$NON-NLS-0$
				return this.deletePrevious();
			}.bind(this));
		},
		autoIndent: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			if (textView.getOptions("singleMode")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			var options = textView.getOptions("tabSize", "expandTab"); //$NON-NLS-1$ //$NON-NLS-0$
			var tab = options.expandTab ? new Array(options.tabSize + 1).join(" ") : "\t"; //$NON-NLS-1$ //$NON-NLS-0$
			var lineDelimiter = model.getLineDelimiter();
			var matchCommentStart = /^[\s]*\/\*[\*]*[\s]*$/;
			var matchCommentDelimiter = /^[\s]*\*/;
			var matchCommentEnd = /\*\/[\s]*$/;
			var self = this;
			function indent(selection, setText) {
				if (selection.start === selection.end) {
					var lineIndex = model.getLineAtOffset(selection.start);
					var lineText = model.getLine(lineIndex, false);
					var lineStart = model.getLineStart(lineIndex);
					var index = 0;
					var lineOffset = selection.start - lineStart;
					var c;
					while (index < lineOffset && ((c = lineText.charCodeAt(index)) === 32 || c === 9)) { index++; }
					var prefix = lineText.substring(0, index);
					var lineTextBeforeCaret = lineText.substring(0, lineOffset);
					var lineTextAfterCaret = lineText.substring(lineOffset);
					var text;
					// If the character before the caret is an opening brace, smart indent the next line.
					var prevCharIdx;
					if (self.smartIndentation && lineText.charCodeAt(prevCharIdx = lineTextBeforeCaret.trimRight().length - 1) === 123) {
						// Remove any extra whitespace
						var whitespaceBeforeCaret = lineOffset - prevCharIdx - 1;
						var whitespaceAfterCaret = lineTextAfterCaret.length - lineTextAfterCaret.trimLeft().length;
	
						text = lineText.charCodeAt(lineOffset + whitespaceAfterCaret) === 125 ?
							   lineDelimiter + prefix + tab + lineDelimiter + prefix :
							   lineDelimiter + prefix + tab;
	
						setText(text, selection.start - whitespaceBeforeCaret, selection.end + whitespaceAfterCaret);
						selection.start = selection.end = selection.start + lineDelimiter.length + prefix.length + tab.length - whitespaceBeforeCaret;
						return true;
					// Proceed with autocompleting multi-line comment if the text before the caret matches
					// the start or comment delimiter (*) of a multi-line comment
					} else if (self.autoCompleteComments && !matchCommentEnd.test(lineTextBeforeCaret) &&
								(matchCommentStart.test(lineTextBeforeCaret) || matchCommentDelimiter.test(lineTextBeforeCaret))) {
						var caretOffset;
	
						/**
						 * Matches the start of a multi-line comment. Autocomplete the multi-line block comment,
						 * moving any text after the caret into the block comment and setting the caret to be
						 * after the comment delimiter.
						 */
						var match = matchCommentStart.exec(lineTextBeforeCaret);
						if (match) {
							text = lineDelimiter + prefix + " * "; //$NON-NLS-0$
							// Text added into the comment block are trimmed of all preceding and trailing whitespaces.
							// If the text after the caret contains the ending of a block comment, exclude the ending.
							if (matchCommentEnd.test(lineTextAfterCaret)) {
								text += lineTextAfterCaret.substring(0, lineTextAfterCaret.length - 2).trim();
							} else {
								text += lineTextAfterCaret.trim();
							}
							// Add the closing to the multi-line block comment if the next line is not a
							// comment delimiter.
							if ((model.getLineCount() === lineIndex + 1) ||
								!matchCommentDelimiter.test(model.getLine(lineIndex + 1))) {
								text += lineDelimiter + prefix + " */"; //$NON-NLS-0$
							}
							setText(text, selection.start, selection.end + lineTextAfterCaret.length);
							selection.start = selection.end = selection.start + lineDelimiter.length + prefix.length + 3;
							return true;
						}
	
						/**
						 * Matches a comment delimiter (*) as the start of the line, and traverses up the lines to confirm if
						 * it is a multi-line comment by matching the start of a block comment. If so, continue the
						 * multi-line comment in the next line. Any text that follows after the caret is moved to the newly
						 * added comment delimiter.
						 */
						match = matchCommentDelimiter.exec(lineTextBeforeCaret);
						if (match) {
							for (var i = lineIndex - 1; i >= 0; i--) {
								var prevLine = model.getLine(i, false);
								if (matchCommentStart.test(prevLine)) {
									/**
									 * If the text after the caret matches the end of a comment block or the character in front of the
									 * caret is a forward slash, continue the block comment with the caret and text after the caret on
									 * the next line directly in front of the star (*).
									 */
									if (matchCommentEnd.test(lineTextAfterCaret) || lineText.charCodeAt(lineOffset) === 47) {
										text = lineDelimiter + prefix + "*" + lineTextAfterCaret; //$NON-NLS-0$
										caretOffset = selection.start + lineDelimiter.length + prefix.length + 1;
									} else {
										text = lineDelimiter + prefix + "* " + lineTextAfterCaret; //$NON-NLS-0$
										caretOffset = selection.start + lineDelimiter.length + prefix.length + 2;
									}
									setText(text, selection.start, selection.end + lineTextAfterCaret.length);
									selection.start = selection.end = caretOffset;
									return true;
								} else if (!matchCommentDelimiter.test(prevLine)) {
									return false;
								}
							}
						}
						return false;
					} else if (matchCommentEnd.test(lineTextBeforeCaret) && prefix.charCodeAt(prefix.length - 1) === 32) {
						// Matches the end of a block comment. Fix the indentation for the following line.
						text = lineDelimiter + prefix.substring(0, prefix.length - 1);
						setText(text, selection.start, selection.end);
						selection.start = selection.end = selection.start + text.length;
						return true;
					} else if (index > 0) {
						//TODO still wrong when typing inside folding
						index = lineOffset;
						while (index < lineText.length && ((c = lineText.charCodeAt(index++)) === 32 || c === 9)) { selection.end++; }
						text = model.getLineDelimiter() + prefix;
						setText(text, selection.start, selection.end);
						selection.start = selection.end = selection.start + text.length;
						return true;
					}
				}
				return false;
			}
			forEachSelection(this, true, function(selection, setText) {
				if (!indent(selection, setText)) {
					setText(lineDelimiter, selection.start, selection.end);
					selection.start = selection.end = selection.start + lineDelimiter.length;
				}
			});
			return true;
		},
		addBlockComment: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			var open = "/*", close = "*/", commentTags = new RegExp("/\\*" + "|" + "\\*/", "g"); //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			var self = this;
			forEachSelection(this, false, function(selection, setText) {
				var result = self._findEnclosingComment(model, selection.start, selection.end);
				if (result.commentStart !== undefined && result.commentEnd !== undefined) {
					return; // Already in a comment
				}
	
				var text = model.getText(selection.start, selection.end);
				if (text.length === 0) { return; }
	
				var oldLength = text.length;
				text = text.replace(commentTags, "");
				var newLength = text.length;
				text = open + text + close;
	
				setText(text, selection.start, selection.end);
				selection.start += open.length;
				selection.end +=  open.length + (newLength-oldLength);
			});
			return true;
		},
		/**
		 * Called on an opening bracket keypress.
		 * Automatically inserts the specified opening and closing brackets around the caret or selected text.
		 */
		autoPairBrackets: function(openBracket, closeBracket) {
			if (openBracket === "[" && !this.autoPairSquareBrackets) { //$NON-NLS-0$
				return false;
			} else if (openBracket === "{" && !this.autoPairBraces) { //$NON-NLS-0$
				return false;
			} else if (openBracket === "(" && !this.autoPairParentheses) { //$NON-NLS-0$
				return false;
			} else if (openBracket === "<" && !this.autoPairAngleBrackets) { //$NON-NLS-0$
				return false;
			}

			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var isClosingBracket = new RegExp("^$|[)}\\]>]"); //$NON-NLS-0$ // matches any empty string and closing bracket
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var nextChar = (selection.start === model.getCharCount()) ? "" : model.getText(selection.start, selection.start + 1).trim(); //$NON-NLS-0$
				var text;
				if (selection.start === selection.end && isClosingBracket.test(nextChar)) {
					// No selection and subsequent character is not a closing bracket - wrap the caret with the opening and closing brackets,
					// and maintain the caret position inbetween the brackets
					text = openBracket + closeBracket;
					setText(text, selection.start, selection.start);
					selection.start = selection.end = selection.start + 1;
				} else if (selection.start !== selection.end) {
					// Wrap the selected text with the specified opening and closing brackets and keep selection on text
					text = openBracket + model.getText(selection.start, selection.end) + closeBracket;
					setText(text, selection.start, selection.end);
					selection.start += 1;
					selection.end += 1;
				} else {
					setText(openBracket, selection.start, selection.end);
					selection.start = selection.end = selection.start + openBracket.length;
				}
			});
			return true;
		},
		/**
		 * Called on a quotation mark keypress.
		 * Automatically inserts a pair of the specified quotation around the caret the caret or selected text.
		 */
		autoPairQuotations: function(quotation) {
			if (!this.autoPairQuotation) { return false; }
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var isQuotation = new RegExp("^\"$|^'$"); //$NON-NLS-0$
			var isAlpha = new RegExp("\\w"); //$NON-NLS-0$
			var isClosingBracket = new RegExp("^$|[)}\\]>]"); //$NON-NLS-0$ // matches any empty string and closing bracket
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				var prevChar = (selection.start === 0) ? "" : model.getText(selection.start - 1, selection.start).trim(); //$NON-NLS-0$
				var nextChar = (selection.start === model.getCharCount()) ? "" : model.getText(selection.start, selection.start + 1).trim(); //$NON-NLS-0$
				function insertQuotation() {
					setText(quotation, selection.start, selection.end);
					selection.start = selection.end = selection.start + quotation.length;
				}
				// Wrap the selected text with the specified opening and closing quotation marks and keep selection on text
				if (selection.start !== selection.end) {
					var text = model.getText(selection.start, selection.end);
					if (isQuotation.test(text)) {
						insertQuotation();
					} else {
						setText(quotation + text + quotation, selection.start, selection.end);
						selection.start += 1;
						selection.end += 1;
					}
				} else if (nextChar === quotation) {
					// Skip over the next character if it matches the specified quotation mark
					selection.start = selection.end = selection.start + 1;
				} else if (prevChar === quotation || isQuotation.test(nextChar) || isAlpha.test(prevChar) || !isClosingBracket.test(nextChar)) {
					insertQuotation();
				} else {
					// No selection - wrap the caret with the opening and closing quotation marks, and maintain the caret position inbetween the quotations
					setText(quotation + quotation, selection.start, selection.end);
					selection.start = selection.end = selection.start + quotation.length;
				}
			});
			return true;
		},
		/**
		 * Called when a content assist proposal has been applied. Inserts the proposal into the
		 * document. Activates Linked Mode if applicable for the selected proposal.
		 * @param {orion.editor.ContentAssist#ProposalAppliedEvent} event
		 */
		contentAssistProposalApplied: function(event) {
			/*
			 * The event.proposal is an object with this shape:
			 * {   proposal: "[proposal string]", // Actual text of the proposal
			 *     description: "diplay string", // Optional
			 *     positions: [{
			 *         offset: 10, // Offset of start position of parameter i
			 *         length: 3  // Length of parameter string for parameter i
			 *     }], // One object for each parameter; can be null
			 *     escapePosition: 19, // Optional; offset that caret will be placed at after exiting Linked Mode.
			 *     style: 'emphasis', // Optional: either emphasis, noemphasis, hr to provide custom styling for the proposal
			 *     unselectable: false // Optional: if set to true, then this proposal cannnot be selected through the keyboard
			 * }
			 * Offsets are relative to the text buffer.
			 */
			var proposal = event.data.proposal;

			// If escapePosition is not provided, positioned the cursor at the end of the inserted text 
			function escapePosition() {
				if (typeof proposal.escapePosition === "number") { //$NON-NLS-0$
					return proposal.escapePosition;
				}
				return event.data.start + proposal.proposal.length;
			}

			//if the proposal specifies linked positions, build the model and enter linked mode
			if (proposal.positions && proposal.positions.length > 0 && this.linkedMode) {
				var positionGroups = [];
				for (var i = 0; i < proposal.positions.length; ++i) {
					positionGroups[i] = {
						positions: [{
							offset: proposal.positions[i].offset,
							length: proposal.positions[i].length
						}]
					};
				}
				this.linkedMode.enterLinkedMode({
					groups: positionGroups,
					escapePosition: escapePosition()
				});
			} else if (proposal.groups && proposal.groups.length > 0 && this.linkedMode) {
				this.linkedMode.enterLinkedMode({
					groups: proposal.groups,
					escapePosition: escapePosition()
				});
			} else if (typeof proposal.escapePosition === "number") { //$NON-NLS-0$
				//we don't want linked mode, but there is an escape position, so just set cursor position
				var textView = this.editor.getTextView();
				textView.setCaretOffset(proposal.escapePosition);
			}
			return true;
		},
		// On backspace keypress, checks if there are a pair of brackets or quotation marks to be deleted
		deletePrevious: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			forEachSelection(this, false, function(selection, setText) {
				if (selection.start !== selection.end) { return; }
			
				var prevChar = (selection.start === 0) ? "" : model.getText(selection.start - 1, selection.start); //$NON-NLS-0$
				var nextChar = (selection.start === model.getCharCount()) ? "" : model.getText(selection.start, selection.start + 1); //$NON-NLS-0$
	
				if ((prevChar === "(" && nextChar === ")") || //$NON-NLS-1$ //$NON-NLS-0$
					(prevChar === "[" && nextChar === "]") || //$NON-NLS-1$ //$NON-NLS-0$
					(prevChar === "{" && nextChar === "}") || //$NON-NLS-1$ //$NON-NLS-0$
					(prevChar === "<" && nextChar === ">") || //$NON-NLS-1$ //$NON-NLS-0$
					(prevChar === '"' && nextChar === '"') || //$NON-NLS-1$ //$NON-NLS-0$
					(prevChar === "'" && nextChar === "'")) { //$NON-NLS-1$ //$NON-NLS-0$
					setText("", selection.start, selection.start + 1); //$NON-NLS-0$
				}
			}, true);
			return false;
		},
		_findEnclosingComment: function(model, start, end) {
			var open = "/*", close = "*/"; //$NON-NLS-1$ //$NON-NLS-0$
			var firstLine = model.getLineAtOffset(start);
			var lastLine = model.getLineAtOffset(end);
			var i, line, extent, openPos, closePos;
			var commentStart, commentEnd;
			for (i=firstLine; i >= 0; i--) {
				line = model.getLine(i);
				extent = (i === firstLine) ? start - model.getLineStart(firstLine) : line.length;
				openPos = line.lastIndexOf(open, extent);
				closePos = line.lastIndexOf(close, extent);
				if (closePos > openPos) {
					break; // not inside a comment
				} else if (openPos !== -1) {
					commentStart = model.getLineStart(i) + openPos;
					break;
				}
			}
			for (i=lastLine; i < model.getLineCount(); i++) {
				line = model.getLine(i);
				extent = (i === lastLine) ? end - model.getLineStart(lastLine) : 0;
				openPos = line.indexOf(open, extent);
				closePos = line.indexOf(close, extent);
				if (openPos !== -1 && openPos < closePos) {
					break;
				} else if (closePos !== -1) {
					commentEnd = model.getLineStart(i) + closePos;
					break;
				}
			}
			return {commentStart: commentStart, commentEnd: commentEnd};
		},
		lineStart: function() {
			var editor = this.editor;
			var model = editor.getModel();
			forEachSelection(this, false, function(selection/*, setText*/) {
				var caretOffset = selection.getCaret();
				var lineIndex = model.getLineAtOffset(caretOffset);
				var lineOffset = model.getLineStart(lineIndex);
				var lineText = model.getLine(lineIndex);
				var offset;
				for (offset=0; offset<lineText.length; offset++) {
					var c = lineText.charCodeAt(offset);
					if (!(c === 32 || c === 9)) {
						break;
					}
				}
				offset += lineOffset;
				if (caretOffset !== offset) {
					selection.setCaret(offset);
				} else {
					selection.setCaret(lineOffset);
				}
			});
			return true;
		},
		removeBlockComment: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			var open = "/*", close = "*/"; //$NON-NLS-1$ //$NON-NLS-0$
			var self  = this;
			forEachSelection(this, false, function(selection, setText) {

				// Try to shrink selection to a comment block
				var selectedText = model.getText(selection.start, selection.end);
				var newStart, newEnd;
				var i;
				for(i=0; i < selectedText.length; i++) {
					if (selectedText.substring(i, i + open.length) === open) {
						newStart = selection.start + i;
						break;
					}
				}
				for (; i < selectedText.length; i++) {
					if (selectedText.substring(i, i + close.length) === close) {
						newEnd = selection.start + i;
						break;
					}
				}
	
				var text;
				if (newStart !== undefined && newEnd !== undefined) {
					text = model.getText(newStart + open.length, newEnd);
					setText(text, newStart, newEnd + close.length);
					selection.start = newStart;
					selection.end = newEnd;
				} else {
					// Otherwise find enclosing comment block
					var result = self._findEnclosingComment(model, selection.start, selection.end);
					if (!(result.commentStart === undefined || result.commentEnd === undefined)) {
						text = model.getText(result.commentStart + open.length, result.commentEnd);
						setText(text, result.commentStart, result.commentEnd + close.length);
						selection.start = selection.start - open.length;
						selection.end = selection.end - close.length;
					}
				}
			});
			return true;
		},
		toggleLineComment: function() {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var comment = this.lineComment || "//"; //$NON-NLS-0$
			var model = editor.getModel();
			textView.setRedraw(false);
			forEachSelection(this, true, function(selection, setText) {
				var firstLine = model.getLineAtOffset(selection.start);
				var lastLine = model.getLineAtOffset(selection.end > selection.start ? selection.end - 1 : selection.end);
				var uncomment = true, lineIndices = [], index;
				for (var i = firstLine; i <= lastLine; i++) {
					var lineText = model.getLine(i, true);
					index = lineText.indexOf(comment);
					lineIndices.push(index);
					if (!uncomment || index === -1) {
						uncomment = false;
					} else {
						if (index !== 0) {
							var j;
							for (j=0; j<index; j++) {
								var c = lineText.charCodeAt(j);
								if (!(c === 32 || c === 9)) {
									break;
								}
							}
							uncomment = j === index;
						}
					}
				}
				var selStart, selEnd, l = comment.length, k;
				var lineStart = model.getLineStart(firstLine);
				if (uncomment) {
					for (k = lineIndices.length - 1; k >= 0; k--) {
						index = lineIndices[k] + model.getLineStart(firstLine + k);
						setText("", index, index + l);
					}
					var lastLineStart = model.getLineStart(lastLine);
					selStart = lineStart === selection.start ? selection.start : selection.start - l;
					selEnd = selection.end - (l * (lastLine - firstLine + 1)) + (selection.end === lastLineStart+1 ? l : 0);
				} else {
					for (k = lineIndices.length - 1; k >= 0; k--) {
						index = model.getLineStart(firstLine + k);
						setText(comment, index, index);
					}
					selStart = lineStart === selection.start ? selection.start : selection.start + l;
					selEnd = selection.end + (l * (lastLine - firstLine + 1));
				}
				selection.start = selStart;
				selection.end = selEnd;
			});
			textView.setRedraw(true);
			return true;
		},
		trimTrailingWhitespaces: function() {
			var editor = this.editor;
			var model = editor.getModel();
			var selections = editor.getSelections();
			editor.getTextView().setRedraw(false);
			this.startUndo();
			var matchTrailingWhiteSpace = /(\s+$)/;
			var lineCount = model.getLineCount();
			for (var i = 0; i < lineCount; i++) {
				var lineText = model.getLine(i);
				var match = matchTrailingWhiteSpace.exec(lineText);
				if (match) {
					var lineStartOffset = model.getLineStart(i);
					var matchLength = match[0].length;
					var start = lineStartOffset + match.index;
					model.setText("", start, start + matchLength);
					/**
					 * Move the caret to its original position prior to the save. If the caret
					 * was in the trailing whitespaces, move the caret to the end of the line.
					 */
					selections.forEach(function(selection) {
						if (selection.start > start) {
							selection.start = Math.max(start, selection.start - matchLength);
						}
						if (selection.start !== selection.end && selection.end > start) {
							selection.end = Math.max(start, selection.end - matchLength);
						}
					});
				}
			}
			this.endUndo();
			editor.setSelections(selections, false);
			editor.getTextView().setRedraw(true);
		},
		startUndo: function() {
			if (this.undoStack) {
				this.undoStack.startCompoundChange();
			}
		},
		skipClosingBracket: function(closingChar) {
			var editor = this.editor;
			var textView = editor.getTextView();
			if (textView.getOptions("readonly")) { return false; } //$NON-NLS-0$
			var model = editor.getModel();
			var selections = editor.getSelections();
			if (selections.length === 1 && selections[0].start === selections[0].end) {
				var nextChar = selections[0].start === model.getCharCount() ? "" : model.getText(selections[0].start, selections[0].start + 1); //$NON-NLS-0$
				if (nextChar === closingChar) {
					selections[0].start = selections[0].end = selections[0].start + 1;
					editor.setSelections(selections);
					return true;
				}
			}
			return false;
		},
		endUndo: function() {
			if (this.undoStack) {
				this.undoStack.endCompoundChange();
			}
		},
		setAutoPairParentheses: function(enabled) {
			this.autoPairParentheses = enabled;
		},
		setAutoPairBraces: function(enabled) {
			this.autoPairBraces = enabled;
		},
		setAutoPairSquareBrackets: function(enabled) {
			this.autoPairSquareBrackets = enabled;
		},
		setAutoPairAngleBrackets: function(enabled) {
			this.autoPairAngleBrackets = enabled;
		},
		setAutoPairQuotations: function(enabled) {
			this.autoPairQuotation = enabled;
		},
		setAutoCompleteComments: function(enabled) {
			this.autoCompleteComments = enabled;
		},
		setLineComment: function(lineComment) {
			this.lineComment = lineComment;
		},
		setSmartIndentation: function(enabled) {
			this.smartIndentation = enabled;
		}
	};
	exports.SourceCodeActions = SourceCodeActions;

	if (!String.prototype.trimLeft) {
		String.prototype.trimLeft = function(){
			return this.replace(/^\s+/g, '');
		};
	}
	if (!String.prototype.trimRight) {
		String.prototype.trimRight = function(){
			return this.replace(/\s+$/g, '');
		};
	}

	return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/undoStack", [], function() { //$NON-NLS-0$

	/** 
	 * Constructs a new Change object.
	 * 
	 * @class 
	 * @name orion.editor.Change
	 * @private
	 */
	function Change(model, offset, text, previousText, type) {
		this.model = model;
		this.offset = offset;
		this.text = text;
		this.previousText = previousText;
		this.type = type;
	}
	Change.prototype = {
		/** @ignore */
		getRedoChanges: function() {
			return [{start: this.offset, end: this.offset + this.previousText.length, text: this.text}];
		},
		/** @ignore */
		getUndoChanges: function() {
			return [{start: this.offset, end: this.offset + this.text.length, text: this.previousText}];
		},
		/** @ignore */
		undo: function (view, select) {
			this._doUndoRedo(this.offset, this.previousText, this.text, view, select);
			return true;
		},
		/** @ignore */
		redo: function (view, select) {
			this._doUndoRedo(this.offset, this.text, this.previousText, view, select);
			return true;
		},
		merge: function(start, text, previousText, type, end) {
			if (type === this.type) {
				if (type === 1 && start === this.offset + this.text.length) {
					this.text += text;
					return true;
				} else if (type === -1 && end === this.offset) {
					this.offset = start;
					this.previousText = previousText + this.previousText;
					return true;
				} else if (type === -1 && start === this.offset) {
					this.previousText = this.previousText + previousText;
					return true;
				}
			}
			return false;
		},
		_doUndoRedo: function(offset, text, previousText, view, select) {
			this.model.setText(text, offset, offset + previousText.length);
			if (select && view) {
				var model = view.getModel();
				if (model !== this.model) {
					offset = model.mapOffset(offset, true);
				}
				view.setSelection(offset, offset + text.length);
			}
		}
	};

	/** 
	 * Constructs a new CompoundChange object.
	 * 
	 * @param owner the owner of the compound change
	 *
	 * @class 
	 * @name orion.editor.CompoundChange
	 * @private
	 */
	function CompoundChange (owner) {
		this.owner = owner;
		this.changes = [];
	}
	CompoundChange.prototype = {
		/** @ignore */
		getRedoChanges: function() {
			var changes = [];
			for (var i=0; i<this.changes.length; i++) {
				changes = changes.concat(this.changes[i].getRedoChanges());
			}
			return changes;
		},
		/** @ignore */
		getUndoChanges: function() {
			var changes = [];
			for (var i=this.changes.length - 1; i >= 0; i--) {
				changes = changes.concat(this.changes[i].getUndoChanges());
			}
			return changes;
		},
		/** @ignore */
		add: function (change) {
			this.changes.push(change);
		},
		/** @ignore */
		end: function (view) {
			if (view) {
				this.endSelection = view.getSelections();
			}
			var owner = this.owner;
			if (owner && owner.end) {
				owner.end();
			}
		},
		/** @ignore */
		undo: function (view, select) {
			if (this.changes.length > 1 && view) {
				view.setRedraw(false);
			}
			for (var i=this.changes.length - 1; i >= 0; i--) {
				this.changes[i].undo(view, false);
			}
			if (select && view) {
				view.setSelections(this.startSelection);
			}
			if (this.changes.length > 1 && view) {
				view.setRedraw(true);
			}
			var owner = this.owner;
			if (owner && owner.undo) {
				owner.undo();
			}
			return this.changes.length > 0;
		},
		/** @ignore */
		redo: function (view, select) {
			if (this.changes.length > 1 && view) {
				view.setRedraw(false);
			}
			for (var i = 0; i < this.changes.length; i++) {
				this.changes[i].redo(view, false);
			}
			if (select && view) {
				view.setSelections(this.endSelection);
			}
			if (this.changes.length > 1, view) {
				view.setRedraw(true);
			}
			var owner = this.owner;
			if (owner && owner.redo) {
				owner.redo();
			}
			return this.changes.length > 0;
		},
		merge: function(start, text, previousText, type, end) {
			var length = this.changes.length;
			if (length > 0) {
				return this.changes[length - 1].merge(start, text, previousText, type, end);
			}
			return false;
		},
		/** @ignore */
		start: function (view) {
			if (view) {
				this.startSelection = view.getSelections();
			}
			var owner = this.owner;
			if (owner && owner.start) {
				owner.start();
			}
		}
	};

	/**
	 * Constructs a new UndoStack on a text view.
	 *
	 * @param {orion.editor.TextView} view the text view for the undo stack.
	 * @param {Number} [size=100] the size for the undo stack.
	 *
	 * @name orion.editor.UndoStack
	 * @class The UndoStack is used to record the history of a text model associated to an view. Every
	 * change to the model is added to stack, allowing the application to undo and redo these changes.
	 *
	 * <p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.TextView}<br/>
	 * </p>
	 */
	function UndoStack (view, size) {
		this.size = size !== undefined ? size : 100;
		this.reset();
		var self = this;
		this._listener = {
			onChanging: function(e) {
				self._onChanging(e);
			},
			onDestroy: function(e) {
				self._onDestroy(e);
			}
		};
		if (view.getModel) {
			var model = view.getModel();
			if (model.getBaseModel) {
				model = model.getBaseModel();
			}
			this.model = model;
			this.setView(view);
		} else {
			this.shared = true;
			this.model = view;
		}
		this.model.addEventListener("Changing", this._listener.onChanging); //$NON-NLS-0$
	}
	UndoStack.prototype = /** @lends orion.editor.UndoStack.prototype */ {
		/**
		 * Destroy the undo stack.
		 */
		destroy: function() {
			this._onDestroy();
		},
		/**
		 * Adds a change to the stack.
		 * 
		 * @param change the change to add.
		 */
		add: function (change) {
			if (this.compoundChange) {
				this.compoundChange.add(change);
			} else {
				var length = this.stack.length;
				this.stack.splice(this.index, length-this.index, change);
				this.index++;
				if (this.stack.length > this.size) {
					this.stack.shift();
					this.index--;
				}
			}
		},
		/** 
		 * Marks the current state of the stack as clean.
		 *
		 * <p>
		 * This function is typically called when the content of view associated with the stack is saved.
		 * </p>
		 *
		 * @see orion.editor.UndoStack#isClean
		 */
		markClean: function() {
			this._commitUndo();
			this.cleanChange = this.stack[this.index - 1];
			if (this.cleanChange) {
				this.cleanChange.type = 2;
			}
		},
		/**
		 * Returns true if current state of stack is the same
		 * as the state when markClean() was called.
		 *
		 * <p>
		 * For example, the application calls markClean(), then calls undo() four times and redo() four times.
		 * At this point isClean() returns true.  
		 * </p>
		 * <p>
		 * This function is typically called to determine if the content of the view associated with the stack
		 * has changed since the last time it was saved.
		 * </p>
		 *
		 * @return {Boolean} returns if the state is the same as the state when markClean() was called.
		 *
		 * @see orion.editor.UndoStack#markClean
		 */
		isClean: function() {
			return this.cleanChange === this.stack[this.index - 1];
		},
		/**
		 * Returns true if there is at least one change to undo.
		 *
		 * @return {Boolean} returns true if there is at least one change to undo.
		 *
		 * @see orion.editor.UndoStack#canRedo
		 * @see orion.editor.UndoStack#undo
		 */
		canUndo: function() {
			return this.index > 0;
		},
		/**
		 * Returns true if there is at least one change to redo.
		 *
		 * @return {Boolean} returns true if there is at least one change to redo.
		 *
		 * @see orion.editor.UndoStack#canUndo
		 * @see orion.editor.UndoStack#redo
		 */
		canRedo: function() {
			return (this.stack.length - this.index) > 0;
		},
		/**
		 * Finishes a compound change.
		 *
		 * @see orion.editor.UndoStack#startCompoundChange
		 */
		endCompoundChange: function() {
			if (this.compoundChange) {
				this.compoundChange.end(this.view);
			}
			this.compoundChange = undefined;
		},
		/**
		 * Returns the sizes of the stack.
		 *
		 * @return {object} a object where object.undo is the number of changes that can be un-done, 
		 *  and object.redo is the number of changes that can be re-done.
		 *
		 * @see orion.editor.UndoStack#canUndo
		 * @see orion.editor.UndoStack#canRedo
		 */
		getSize: function() {
			return {
				undo: this.index,
				redo: this.stack.length - this.index
			};
		},
		/**
		 * @class This object represents a text change.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.UndoStack}<br/>
		 * {@link orion.editor.UndoStack#getUndoChanges}<br/>
		 * {@link orion.editor.UndoStack#getRedoChanges}<br/>
		 * </p>
		 * @name orion.editor.TextChange
		 * 
		 * @property {Number} start The start offset in the model of the range to be replaced.
		 * @property {Number} end The end offset in the model of the range to be replaced
		 * @property {String} text the text to be inserted
		 */
		/**
		 * Returns the redo changes.
		 *
		 * @return {orion.editor.TextChange[]} an array of TextChanges that are returned in the order
		 * that they occurred (most recent change last).
		 *
		 * @see orion.editor.UndoStack#getUndoChanges
		 */
		getRedoChanges: function() {
			this._commitUndo();
			var changes = [];
			for (var i=this.index; i<this.stack.length; i++) {
				changes = changes.concat(this.stack[i].getRedoChanges());
			}
			return changes;
		},
		/**
		 * Returns the undo changes.
		 *
		 * @return {orion.editor.TextChange[]} an array of TextChanges that are returned in the reverse order
		 * that they occurred (most recent change first).
		 *
		 * @see orion.editor.UndoStack#getRedoChanges
		 */
		getUndoChanges: function() {
			this._commitUndo();
			var changes = [];
			for (var i=this.index; i >= 0; i--) {
				changes = changes.concat(this.stack[i].getUndoChanges());
			}
			return changes;
		},
		/**
		 * Undo the last change in the stack.
		 *
		 * @return {Boolean} returns true if a change was un-done.
		 *
		 * @see orion.editor.UndoStack#redo
		 * @see orion.editor.UndoStack#canUndo
		 */
		undo: function() {
			this._commitUndo();
			var change, result = false;
			this._ignoreUndo = true;
			do {
				if (this.index <= 0) {
					break;
				}
				change = this.stack[--this.index];
			} while (!(result = change.undo(this.view, true)));
			this._ignoreUndo = false;
			return result;
		},
		/**
		 * Redo the last change in the stack.
		 *
		 * @return {Boolean} returns true if a change was re-done.
		 *
		 * @see orion.editor.UndoStack#undo
		 * @see orion.editor.UndoStack#canRedo
		 */
		redo: function() {
			this._commitUndo();
			var change, result = false;
			this._ignoreUndo = true;
			do {
				if (this.index >= this.stack.length) {
					break;
				}
				change = this.stack[this.index++];
			} while (!(result = change.redo(this.view, true)));
			this._ignoreUndo = false;
			return result;
		},
		/**
		 * Reset the stack to its original state. All changes in the stack are thrown away.
		 */
		reset: function() {
			this.index = 0;
			this.cleanChange = undefined;
			this.stack = [];
			this._ignoreUndo = false;
			this._compoundChange = undefined;
		},
		setView: function(view) {
			if (this.view === view) { return; }
			if (this.view) {
				view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
			}
			this.view = view;
			if (this.view) {
				view.addEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
			}
		},
		/**
		 * Starts a compound change. 
		 * <p>
		 * All changes added to stack from the time startCompoundChange() is called
		 * to the time that endCompoundChange() is called are compound on one change that can be un-done or re-done
		 * with one single call to undo() or redo().
		 * </p>
		 *
		 * @param owner the owner of the compound change which is called for start, end, undo and redo.
		 *		 
		 * @return the compound change
		 *
		 * @see orion.editor.UndoStack#endCompoundChange
		 */
		startCompoundChange: function(owner) {
			this._commitUndo();
			var change = new CompoundChange(owner);
			this.add(change);
			this.compoundChange = change;
			this.compoundChange.start(this.view);
			return this.compoundChange;
		},
		_commitUndo: function () {
			this.endCompoundChange();
		},
		_onDestroy: function(evt) {
			if (!evt /* undo stack destroyed */ || !this.shared) {
				this.model.removeEventListener("Changing", this._listener.onChanging); //$NON-NLS-0$
			}
			if (this.view) {
				this.view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
				this.view = null;
			}
		},
		_onChanging: function(e) {
			if (this._ignoreUndo) {
				return;
			}
			var text = e.text;
			var start = e.start;
			var addedCharCount = e.addedCharCount;
			var removedCharCount = e.removedCharCount;
			var end = start + removedCharCount;
			var type = 0;
			if (addedCharCount === 0 && removedCharCount === 1) {
				type = -1;
			} else if (addedCharCount === 1 && removedCharCount === 0) {
				type = 1;
			}
			var length = this.stack.length;
			var previousText = this.model.getText(start, end);
			if (length > 0 && this.index === length) {
				var change = this.stack[length - 1];
				if (change.merge(start, text, previousText, type, end)) {
					return;
				}
			}
			this.add(new Change(this.model, start, text, previousText, type));
		}
	};
	
	return {
		UndoStack: UndoStack
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/rulers", [
	'i18n!orion/editor/nls/messages',
	'orion/editor/textView',
	'orion/editor/annotations',
	'orion/editor/tooltip', 
	'orion/objects',
	'orion/webui/littlelib', //$NON-NLS-0$
	'orion/editor/util',
	'orion/util'
], function(messages, mTextView, mAnnotations, mTooltip, objects, lib, textUtil, util) {

	function BaseRuler (rulerLocation, rulerOverview, rulerStyle) {
		this._location = rulerLocation || "left"; //$NON-NLS-0$
		this._overview = rulerOverview || "page"; //$NON-NLS-0$
		this._rulerStyle = rulerStyle;
		this._view = null;
	}
	BaseRuler.prototype = /** @lends orion.editor.BaseRuler.prototype */ {
		/**
		 * Returns the ruler location.
		 *
		 * @returns {String} the ruler location, which is either "left" or "right" or "margin".
		 *
		 * @see orion.editor.Ruler#getOverview
		 */
		getLocation: function() {
			return this._location;
		},
		/**
		 * Returns the ruler overview type.
		 *
		 * @returns {String} the overview type, which is either "page" or "document" or "fixed".
		 *
		 * @see orion.editor.Ruler#getLocation
		 */
		getOverview: function() {
			return this._overview;
		},
		/**
		 * Returns the style information for the ruler.
		 *
		 * @returns {orion.editor.Style} the style information.
		 */
		getRulerStyle: function() {
			return this._rulerStyle;
		},
		/**
		 * Returns the text view.
		 *
		 * @returns {orion.editor.TextView} the text view.
		 *
		 * @see orion.editor.Ruler#setView
		 */
		getView: function() {
			return this._view;
		},
		/**
		 * Sets the view for the ruler.
		 * <p>
		 * This method is called by the text view when the ruler
		 * is added to the view.
		 * </p>
		 *
		 * @param {orion.editor.TextView} view the text view.
		 */
		setView: function (view) {
			if (this._onTextModelChanged && this._view) {
				this._view.removeEventListener("ModelChanged", this._listener.onTextModelChanged); //$NON-NLS-0$
			}
			this._view = view;
			if (this._onTextModelChanged && this._view) {
				this._view.addEventListener("ModelChanged", this._listener.onTextModelChanged); //$NON-NLS-0$
			}
		},
	};

	/**
	 * Constructs a new ruler. 
	 * <p>
	 * The default implementation does not implement all the methods in the interface
	 * and is useful only for objects implementing rulers.
	 * <p/>
	 * 
	 * @param {orion.editor.AnnotationModel} annotationModel the annotation model for the ruler.
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {String} [rulerOverview="page"] the overview for the ruler.
	 * @param {orion.editor.Style} [rulerStyle] the style for the ruler. 
	 * 
	 * @class This interface represents a ruler for the text view.
	 * <p>
	 * A Ruler is a graphical element that is placed either on the left or on the right side of 
	 * the view. It can be used to provide the view with per line decoration such as line numbering,
	 * bookmarks, breakpoints, folding disclosures, etc. 
	 * </p><p>
	 * There are two types of rulers: page and document. A page ruler only shows the content for the lines that are
	 * visible, while a document ruler always shows the whole content.
	 * </p>
	 * <b>See:</b><br/>
	 * {@link orion.editor.LineNumberRuler}<br/>
	 * {@link orion.editor.AnnotationRuler}<br/>
	 * {@link orion.editor.OverviewRuler}<br/> 
	 * {@link orion.editor.TextView}<br/>
	 * {@link orion.editor.TextView#addRuler}
	 * </p>		 
	 * @name orion.editor.Ruler
	 * @borrows orion.editor.AnnotationTypeList#addAnnotationType as #addAnnotationType
	 * @borrows orion.editor.AnnotationTypeList#getAnnotationTypePriority as #getAnnotationTypePriority
	 * @borrows orion.editor.AnnotationTypeList#getAnnotationsByType as #getAnnotationsByType
	 * @borrows orion.editor.AnnotationTypeList#isAnnotationTypeVisible as #isAnnotationTypeVisible
	 * @borrows orion.editor.AnnotationTypeList#removeAnnotationType as #removeAnnotationType
	 */
	function Ruler (annotationModel, rulerLocation, rulerOverview, rulerStyle) {
		BaseRuler.call(this, rulerLocation, rulerOverview, rulerStyle);
		var self = this;
		this._listener = {
			onTextModelChanged: function(e) {
				self._onTextModelChanged(e);
			},
			onAnnotationModelChanged: function(e) {
				self._onAnnotationModelChanged(e);
			}
		};
		this.setAnnotationModel(annotationModel);
	}
	Ruler.prototype = objects.mixin(new BaseRuler(), /** @lends orion.editor.Ruler.prototype */ {
		/**
		 * Returns the annotations for a given line range merging multiple
		 * annotations when necessary.
		 * <p>
		 * This method is called by the text view when the ruler is redrawn.
		 * </p>
		 *
		 * @param {Number} startLine the start line index
		 * @param {Number} endLine the end line index
		 * @return {orion.editor.Annotation[]} the annotations for the line range. The array might be sparse.
		 */
		getAnnotations: function(startLine, endLine) {
			var annotationModel = this._annotationModel;
			if (!annotationModel) { return []; }
			var model = this._view.getModel();
			var start = model.getLineStart(startLine);
			var end = model.getLineEnd(endLine - 1);
			var baseModel = model;
			if (model.getBaseModel) {
				baseModel = model.getBaseModel();
				start = model.mapOffset(start);
				end = model.mapOffset(end);
			}
			var result = [];
			var annotations = this.getAnnotationsByType(annotationModel, start, end);
			for (var i = 0; i < annotations.length; i++) {
				var annotation = annotations[i];
				var annotationLineStart = baseModel.getLineAtOffset(annotation.start);
				var annotationLineEnd = baseModel.getLineAtOffset(Math.max(annotation.start, annotation.end - 1));
				for (var lineIndex = annotationLineStart; lineIndex<=annotationLineEnd; lineIndex++) {
					var visualLineIndex = lineIndex;
					if (model !== baseModel) {
						var ls = baseModel.getLineStart(lineIndex);
						ls = model.mapOffset(ls, true);
						if (ls === -1) { continue; }
						visualLineIndex = model.getLineAtOffset(ls);
					}
					if (!(startLine <= visualLineIndex && visualLineIndex < endLine)) { continue; }
					var rulerAnnotation = this._mergeAnnotation(result[visualLineIndex], annotation, lineIndex - annotationLineStart, annotationLineEnd - annotationLineStart + 1);
					if (rulerAnnotation) {
						result[visualLineIndex] = rulerAnnotation;
					}
				}
			}
			if (!this._multiAnnotation && this._multiAnnotationOverlay) {
				for (var k in result) {
					if (result[k]._multiple) {
						result[k].html = result[k].html + this._multiAnnotationOverlay.html;
					}
				}
			}
			return result;
		},
		/**
		 * Returns the annotation model.
		 *
		 * @returns {orion.editor.AnnotationModel} the ruler annotation model.
		 *
		 * @see orion.editor.Ruler#setAnnotationModel
		 */
		getAnnotationModel: function() {
			return this._annotationModel;
		},
		/**
		 * Returns the widest annotation which determines the width of the ruler.
		 * <p>
		 * If the ruler does not have a fixed width it should provide the widest
		 * annotation to avoid the ruler from changing size as the view scrolls.
		 * </p>
		 * <p>
		 * This method is called by the text view when the ruler is redrawn.
		 * </p>
		 *
		 * @returns {orion.editor.Annotation} the widest annotation.
		 *
		 * @see orion.editor.Ruler#getAnnotations
		 */
		getWidestAnnotation: function() {
			return null;
		},
		/**
		 * Sets the annotation model for the ruler.
		 *
		 * @param {orion.editor.AnnotationModel} annotationModel the annotation model.
		 *
		 * @see orion.editor.Ruler#getAnnotationModel
		 */
		setAnnotationModel: function (annotationModel) {
			if (this._annotationModel) {
				this._annotationModel.removEventListener("Changed", this._listener.onAnnotationModelChanged); //$NON-NLS-0$
			}
			this._annotationModel = annotationModel;
			if (this._annotationModel) {
				this._annotationModel.addEventListener("Changed", this._listener.onAnnotationModelChanged); //$NON-NLS-0$
			}
		},
		/**
		 * Sets the annotation that is displayed when a given line contains multiple
		 * annotations.  This annotation is used when there are different types of
		 * annotations in a given line.
		 *
		 * @param {orion.editor.Annotation} annotation the annotation for lines with multiple annotations.
		 * 
		 * @see orion.editor.Ruler#setMultiAnnotationOverlay
		 */
		setMultiAnnotation: function(annotation) {
			this._multiAnnotation = annotation;
		},
		/**
		 * Sets the annotation that overlays a line with multiple annotations.  This annotation is displayed on
		 * top of the computed annotation for a given line when there are multiple annotations of the same type
		 * in the line. It is also used when the multiple annotation is not set.
		 *
		 * @param {orion.editor.Annotation} annotation the annotation overlay for lines with multiple annotations.
		 * 
		 * @see orion.editor.Ruler#setMultiAnnotation
		 */
		setMultiAnnotationOverlay: function(annotation) {
			this._multiAnnotationOverlay = annotation;
		},
		/**
		 * This event is sent when the user clicks a line annotation.
		 *
		 * @event
		 * @param {Number} lineIndex the line index of the annotation under the pointer.
		 * @param {DOMEvent} e the click event.
		 */
		onClick: function(lineIndex, e) {
			if (lineIndex === undefined) { return; }
			var view = this._view;
			var model = view.getModel();
			var baseModel = model;
			var start = model.getLineStart(lineIndex), lineStart = start;
			var end = start;
			var annotationModel = this._annotationModel;
			if (annotationModel) {
				var selection = view.getSelection();
				end = model.getLineEnd(lineIndex, true);
				if (start <= selection.start && selection.start < end) {
					start = selection.start;
				}
				if (model.getBaseModel) {
					start = model.mapOffset(start);
					end = model.mapOffset(end);
					baseModel = model.getBaseModel();
				}
				var annotation, iter = annotationModel.getAnnotations(start, end);
				var clickedAnnotation = null;
				while (!annotation && iter.hasNext()) {
					var a = iter.next();
					if (!this.isAnnotationTypeVisible(a.type)) { continue; }
					clickedAnnotation = a;
					if (a.start <= start) { continue; }
					annotation = a; 
				}
				if (clickedAnnotation && clickedAnnotation.groupId !== undefined) {
					if (this._currentClickGroup === clickedAnnotation.groupId) {
						this._currentClickGroup = null;
					} else {
						this._currentClickGroup = clickedAnnotation.groupId;
					}
					this._setCurrentGroup(lineIndex);
				} 
				if (annotation && baseModel.getLineAtOffset(annotation.start) === baseModel.getLineAtOffset(start)) {
					start = annotation.start;
					end = annotation.end;
				} else {
					end = start = lineStart;
				}
				
				if (model.getBaseModel) {
					start = model.mapOffset(start, true);
					end = model.mapOffset(end, true);
				}
			}
			var tooltip = mTooltip.Tooltip.getTooltip(this._view);
			if (tooltip) {
				tooltip.hide();
			}
			this._view.setSelection(end, start, 1/3, function(){});
		},
		/**
		 * This event is sent when the user double clicks a line annotation.
		 *
		 * @event
		 * @param {Number} lineIndex the line index of the annotation under the pointer.
		 * @param {DOMEvent} e the double click event.
		 */
		onDblClick: function(lineIndex, e) {
		},
		/**
		 * This event is sent when the user moves the mouse over a line annotation.
		 *
		 * @event
		 * @param {Number} lineIndex the line index of the annotation under the pointer.
		 * @param {DOMEvent} e the mouse move event.
		 */
		onMouseMove: function(lineIndex, e) {
			var tooltip = mTooltip.Tooltip.getTooltip(this._view);
			if (!tooltip) { return; }
			if (tooltip.isVisible() && this._tooltipLineIndex === lineIndex) { return; }
			this._tooltipLineIndex = lineIndex;

			if (tooltip.OKToHide(e.clientX, e.clientY))	{
				tooltip.hide();
			}		

			if (this._hoverTimeout) {
				window.clearTimeout(this._hoverTimeout);
				this._hoverTimeout = null;
			}
			
			this._curElement = e.target ? e.target : e.srcElement;
			
			var self = this;
			self._hoverTimeout = window.setTimeout(function() {
				self._hoverTimeout = null;
				if (!tooltip.OKToHover(e.clientX, e.clientY)) { return; }
				tooltip.show({
					clientX: e.clientX,
					clientY: e.clientY,
					getTooltipInfo: function() {
						return self._getTooltipInfo(self._tooltipLineIndex, this.clientY);
					}
				});
			}, 100);
		},
		/**
		 * This event is sent when the mouse pointer enters a line annotation.
		 *
		 * @event
		 * @param {Number} lineIndex the line index of the annotation under the pointer.
		 * @param {DOMEvent} e the mouse over event.
		 */
		onMouseOver: function(lineIndex, e) {
			this.onMouseMove(lineIndex, e);
			if (!this._currentClickGroup) {
				this._setCurrentGroup(lineIndex);
			}
		},
		/**
		 * This event is sent when the mouse pointer exits a line annotation.
		 *
		 * @event
		 * @param {Number} lineIndex the line index of the annotation under the pointer.
		 * @param {DOMEvent} e the mouse out event.
		 */
		onMouseOut: function(lineIndex, e) {
			if (!this._currentClickGroup) {
				this._setCurrentGroup(-1);
			}
		},
		/** @ignore */
		_getTooltipInfo: function(lineIndex, y) {
			if (lineIndex === undefined) { return; }
			var view = this._view;
			var model = view.getModel();
			var annotationModel = this._annotationModel;
			var annotations = [];
			if (annotationModel) {
				var start = model.getLineStart(lineIndex);
				var end = model.getLineEnd(lineIndex);
				if (model.getBaseModel) {
					start = model.mapOffset(start);
					end = model.mapOffset(end);
				}
				annotations = this.getAnnotationsByType(annotationModel, start, end);
			}
			var contents = this._getTooltipContents(lineIndex, annotations);
			
			// TODO: shouldn't this check the length, it'll never be null
			if (!contents) { return null; }
			var anchorRect = lib.bounds(this._curElement); //.parentNode);
			if (typeof contents === 'string') {
				// Hack for line numbers
				anchorRect.top = y;
				anchorRect.height = 1;
			}
			var info = {
				contents: contents,
				anchor: this.getLocation(),
				anchorRect: anchorRect
			};
			
			
			var rect = view.getClientArea();
			if (this.getOverview() === "document") { //$NON-NLS-0$
				rect.y = view.convert({y: y}, "view", "document").y; //$NON-NLS-1$ //$NON-NLS-0$
			} else {
				rect.y = view.getLocationAtOffset(model.getLineStart(lineIndex)).y;
			}
			view.convert(rect, "document", "page"); //$NON-NLS-1$ //$NON-NLS-0$
			info.x = rect.x;
			info.y = rect.y;
			if (info.anchor === "right") { //$NON-NLS-0$
				info.x += rect.width;
			}
			return info;
		},
		/** @ignore */
		_getTooltipContents: function(lineIndex, annotations) {
			return annotations;
		},
		/** @ignore */
		_onAnnotationModelChanged: function(e) {
			var view = this._view;
			if (!view) { return; }
			var model = view.getModel(), self = this;
			var lineCount = model.getLineCount();
			if (e.textModelChangedEvent) {
				var start = e.textModelChangedEvent.start;
				if (model.getBaseModel) { start = model.mapOffset(start, true); }
				var startLine = model.getLineAtOffset(start);
				view.redrawLines(startLine, lineCount, self);
				return;
			}
			function redraw(changes) {
				for (var i = 0; i < changes.length; i++) {
					if (!self.isAnnotationTypeVisible(changes[i].type)) { continue; }
					var start = changes[i].start;
					var end = changes[i].end;
					if (model.getBaseModel) {
						start = model.mapOffset(start, true);
						end = model.mapOffset(end, true);
					}
					if (start !== -1 && end !== -1) {
						view.redrawLines(model.getLineAtOffset(start), model.getLineAtOffset(Math.max(start, end - 1)) + 1, self);
					}
				}
			}
			redraw(e.added);
			redraw(e.removed);
			redraw(e.changed);
		},
		/** @ignore */
		_mergeAnnotation: function(result, annotation, annotationLineIndex, annotationLineCount) {
			if (!result) { result = {}; }
			if (annotationLineIndex === 0) {
				if (result.html && annotation.html) {
					if (annotation.html !== result.html) {
						if (!result._multiple && this._multiAnnotation) {
							result.html = this._multiAnnotation.html;
						}
					} 
					result._multiple = true;
				} else {
					result.html = annotation.html;
				}
			}
			result.style = this._mergeStyle(result.style, annotation.style);
			return result;
		},
		/** @ignore */
		_mergeStyle: function(result, style) {
			if (style) {
				if (!result) { result = {}; }
				if (result.styleClass && style.styleClass && result.styleClass !== style.styleClass) {
					result.styleClass += " " + style.styleClass; //$NON-NLS-0$
				} else {
					result.styleClass = style.styleClass;
				}
				var prop;
				if (style.style) {
					if (!result.style) { result.style  = {}; }
					for (prop in style.style) {
						if (result.style[prop] === undefined) {
							result.style[prop] = style.style[prop];
						}
					}
				}
				if (style.attributes) {
					if (!result.attributes) { result.attributes  = {}; }
					for (prop in style.attributes) {
						if (result.attributes[prop] === undefined) {
							result.attributes[prop] = style.attributes[prop];
						}
					}
				}
			}
			return result;
		},
		_setCurrentGroup: function(lineIndex) {
			var annotationModel = this._annotationModel;
			var groupAnnotation = null;
			var model = annotationModel.getTextModel();
			var annotation;
			var annotations;
			var currentGroupAnnotation = this._currentGroupAnnotation;
			if (lineIndex !== -1) {
				var start = model.getLineStart(lineIndex);
				var end = model.getLineEnd(lineIndex);
				if (model.getBaseModel) {
					start = model.mapOffset(start);
					end = model.mapOffset(end);
				}
				annotations = annotationModel.getAnnotations(start, end);
				while(annotations.hasNext()){
					annotation = annotations.next();
					if (!this.isAnnotationTypeVisible(annotation.type)) { continue; }
					if (annotation.start <= start && annotation.end >= end){
						if (annotation.groupId !== undefined) {
							groupAnnotation = annotation;
							break;
						}
					}
				}
				if (currentGroupAnnotation && groupAnnotation) {
					if (currentGroupAnnotation.groupId === groupAnnotation.groupId) {
						return;
					}
				}
			}
			this._currentGroupAnnotation = null;
			if (currentGroupAnnotation) {
				annotationModel.removeAnnotations(currentGroupAnnotation.groupType);
			}
			if (!groupAnnotation) { return; }
			
			if (lineIndex === -1) { return; }
			this._currentGroupAnnotation = groupAnnotation;
			annotations = annotationModel.getAnnotations();
			var add = [];
			while (annotations.hasNext()) {
				annotation = annotations.next();
				delete annotation.groupAnnotation;
				if (annotation.groupId === groupAnnotation.groupId) {
					annotation = annotation.createGroupAnnotation();
					add.push(annotation);
				}
			}
			annotationModel.replaceAnnotations(null, add);
		}
	});
	mAnnotations.AnnotationTypeList.addMixin(Ruler.prototype);

	/**
	 * Constructs a new line numbering ruler. 
	 *
	 * @param {orion.editor.AnnotationModel} annotationModel the annotation model for the ruler.
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {orion.editor.Style} [rulerStyle=undefined] the style for the ruler.
	 * @param {orion.editor.Style} [oddStyle={style: {backgroundColor: "white"}] the style for lines with odd line index.
	 * @param {orion.editor.Style} [evenStyle={backgroundColor: "white"}] the style for lines with even line index.
	 *
	 * @augments orion.editor.Ruler
	 * @class This objects implements a line numbering ruler.
	 *
	 * <p><b>See:</b><br/>
	 * {@link orion.editor.Ruler}
	 * </p>
	 * @name orion.editor.LineNumberRuler
	 */
	function LineNumberRuler (annotationModel, rulerLocation, rulerStyle, oddStyle, evenStyle) {
		Ruler.call(this, annotationModel, rulerLocation, "page", rulerStyle); //$NON-NLS-0$
		this._oddStyle = oddStyle || {style: {backgroundColor: "white"}}; //$NON-NLS-0$
		this._evenStyle = evenStyle || {style: {backgroundColor: "white"}}; //$NON-NLS-0$
		this._numOfDigits = 0;
		this._firstLine = 1;
	}
	LineNumberRuler.prototype = new Ruler(); 
	/** @ignore */
	LineNumberRuler.prototype.getAnnotations = function(startLine, endLine) {
		var result = Ruler.prototype.getAnnotations.call(this, startLine, endLine);
		var model = this._view.getModel();
		for (var lineIndex = startLine; lineIndex < endLine; lineIndex++) {
			var style = (lineIndex - this._firstLine) & 1 ? this._oddStyle : this._evenStyle;
			var mapLine = lineIndex;
			if (model.getBaseModel) {
				var lineStart = model.getLineStart(mapLine);
				mapLine = model.getBaseModel().getLineAtOffset(model.mapOffset(lineStart));
			}
			if (!result[lineIndex]) { result[lineIndex] = {}; }
			result[lineIndex].html = (this._firstLine + mapLine) + "";
			if (!result[lineIndex].style) { result[lineIndex].style = style; }
		}
		return result;
	};
	/** @ignore */
	LineNumberRuler.prototype.getWidestAnnotation = function() {
		var lineCount = this._view.getModel().getLineCount();
		return this.getAnnotations(lineCount - 1, lineCount)[lineCount - 1];
	};
	/**
	 * Sets the line index displayed for the first line. The default value is
	 * <code>1</code>.
	 *
	 * @param {Number} [lineIndex=1] the first line index displayed
	 */
	LineNumberRuler.prototype.setFirstLine = function(lineIndex) {
		this._firstLine = lineIndex !== undefined ? lineIndex : 1;
	};
	/** @ignore */
	LineNumberRuler.prototype._onTextModelChanged = function(e) {
		var start = e.start;
		var model = this._view.getModel();
		var lineCount = model.getBaseModel ? model.getBaseModel().getLineCount() : model.getLineCount();
		var numOfDigits = ((this._firstLine + lineCount - 1)+"").length;
		if (this._numOfDigits !== numOfDigits) {
			this._numOfDigits = numOfDigits;
			var startLine = model.getLineAtOffset(start);
			this._view.redrawLines(startLine,  model.getLineCount(), this);
		}
	};
	
	/** 
	 * @class This is class represents an annotation for the AnnotationRuler. 
	 * <p> 
	 * <b>See:</b><br/> 
	 * {@link orion.editor.AnnotationRuler}
	 * </p> 
	 * 
	 * @name orion.editor.Annotation 
	 * 
	 * @property {String} [html=""] The html content for the annotation, typically contains an image.
	 * @property {orion.editor.Style} [style] the style for the annotation.
	 * @property {orion.editor.Style} [overviewStyle] the style for the annotation in the overview ruler.
	 */ 
	/**
	 * Constructs a new annotation ruler. 
	 *
	 * @param {orion.editor.AnnotationModel} annotationModel the annotation model for the ruler.
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {orion.editor.Style} [rulerStyle=undefined] the style for the ruler.
	 * @param {orion.editor.Annotation} [defaultAnnotation] the default annotation.
	 *
	 * @augments orion.editor.Ruler
	 * @class This objects implements an annotation ruler.
	 *
	 * <p><b>See:</b><br/>
	 * {@link orion.editor.Ruler}<br/>
	 * {@link orion.editor.Annotation}
	 * </p>
	 * @name orion.editor.AnnotationRuler
	 */
	function AnnotationRuler (annotationModel, rulerLocation, rulerStyle) {
		Ruler.call(this, annotationModel, rulerLocation, "page", rulerStyle); //$NON-NLS-0$
	}
	AnnotationRuler.prototype = new Ruler();
	
	/**
	 * Constructs a new overview ruler. 
	 * <p>
	 * The overview ruler is used in conjunction with a AnnotationRuler, for each annotation in the 
	 * AnnotationRuler this ruler displays a mark in the overview. Clicking on the mark causes the 
	 * view to scroll to the annotated line.
	 * </p>
	 *
	 * @param {orion.editor.AnnotationModel} annotationModel the annotation model for the ruler.
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {orion.editor.Style} [rulerStyle=undefined] the style for the ruler.
	 *
	 * @augments orion.editor.Ruler
	 * @class This objects implements an overview ruler.
	 *
	 * <p><b>See:</b><br/>
	 * {@link orion.editor.AnnotationRuler} <br/>
	 * {@link orion.editor.Ruler} 
	 * </p>
	 * @name orion.editor.OverviewRuler
	 */
	function OverviewRuler (annotationModel, rulerLocation, rulerStyle) {
		Ruler.call(this, annotationModel, rulerLocation, "document", rulerStyle); //$NON-NLS-0$
	}
	OverviewRuler.prototype = new Ruler();
	
	/** @ignore */
	OverviewRuler.prototype.getRulerStyle = function() {
		var result = {style: {lineHeight: "1px", fontSize: "1px"}}; //$NON-NLS-1$ //$NON-NLS-0$
		result = this._mergeStyle(result, this._rulerStyle);
		return result;
	};
	/** @ignore */
	OverviewRuler.prototype._getTooltipContents = function(lineIndex, annotations) {
		if (annotations.length === 0) {
			var model = this._view.getModel();
			var mapLine = lineIndex;
			if (model.getBaseModel) {
				var lineStart = model.getLineStart(mapLine);
				mapLine = model.getBaseModel().getLineAtOffset(model.mapOffset(lineStart));
			}
			return util.formatMessage(messages.line, mapLine + 1);
		}
		return Ruler.prototype._getTooltipContents.call(this, lineIndex, annotations);
	};
	/** @ignore */
	OverviewRuler.prototype._mergeAnnotation = function(previousAnnotation, annotation, annotationLineIndex, annotationLineCount) {
		if (annotationLineIndex !== 0) { return undefined; }
		var result = previousAnnotation;
		if (!result) {
			//TODO annotationLineCount does not work when there are folded lines
			var height = 3 * annotationLineCount;
			result = {html: "&nbsp;", style: { style: {height: height + "px"}}}; //$NON-NLS-1$ //$NON-NLS-0$
			result.style = this._mergeStyle(result.style, annotation.overviewStyle);
		}
		return result;
	};

	/**
	 * Constructs a new folding ruler. 
	 *
	 * @param {orion.editor.AnnotationModel} annotationModel the annotation model for the ruler.
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {orion.editor.Style} [rulerStyle=undefined] the style for the ruler.
	 *
	 * @augments orion.editor.Ruler
	 * @class This objects implements an overview ruler.
	 *
	 * <p><b>See:</b><br/>
	 * {@link orion.editor.AnnotationRuler} <br/>
	 * {@link orion.editor.Ruler} 
	 * </p>
	 * @name orion.editor.OverviewRuler
	 */
	function FoldingRuler (annotationModel, rulerLocation, rulerStyle) {
		AnnotationRuler.call(this, annotationModel, rulerLocation, rulerStyle);
	}
	FoldingRuler.prototype = new AnnotationRuler();
	
	/** @ignore */
	FoldingRuler.prototype.onClick =  function(lineIndex, e) {
		if (lineIndex === undefined) { return; }
		var annotationModel = this._annotationModel;
		if (!annotationModel) { return; }
		var view = this._view;
		var model = view.getModel();
		var start = model.getLineStart(lineIndex);
		var end = model.getLineEnd(lineIndex, true);
		if (model.getBaseModel) {
			start = model.mapOffset(start);
			end = model.mapOffset(end);
			model = model.getBaseModel();
		}
		var annotation, iter = annotationModel.getAnnotations(start, end);
		while (!annotation && iter.hasNext()) {
			var a = iter.next();
			if (!this.isAnnotationTypeVisible(a.type)) { continue; }
			if (model.getLineAtOffset(a.start) !== model.getLineAtOffset(start)) { continue; }
			annotation = a;
		}
		if (annotation) {
			var tooltip = mTooltip.Tooltip.getTooltip(this._view);
			if (tooltip) {
				tooltip.hide();
			}
			if (annotation.expanded) {
				annotation.collapse();
			} else {
				annotation.expand();
			}
		}
	};
	/** @ignore */
	FoldingRuler.prototype._getTooltipContents = function(lineIndex, annotations) {
		if (annotations.length > 0) {
			var view = this._view;
			var model = view.getModel();
			var start = model.getLineStart(lineIndex);
			if (model.getBaseModel) {
				start = model.mapOffset(start);
				model = model.getBaseModel();
			}
			var mapLineIndex = model.getLineAtOffset(start);
			for (var i = 0; i < annotations.length; i++) {
				var a = annotations[i];
				if (!this.isAnnotationTypeVisible(a.type)) { continue; }
				if (model.getLineAtOffset(a.start) !== mapLineIndex) { continue; }
				if (annotations[i].expanded) {
					break;
				}
				return AnnotationRuler.prototype._getTooltipContents.call(this, lineIndex, [a]);
			}
		}
		return null;
	};
	/** @ignore */
	FoldingRuler.prototype._onAnnotationModelChanged = function(e) {
		if (e.textModelChangedEvent) {
			AnnotationRuler.prototype._onAnnotationModelChanged.call(this, e);
			return;
		}
		var view = this._view;
		if (!view) { return; }
		var model = view.getModel(), self = this, i;
		var lineCount = model.getLineCount(), lineIndex = lineCount;
		function redraw(changes) {
			for (i = 0; i < changes.length; i++) {
				if (!self.isAnnotationTypeVisible(changes[i].type)) { continue; }
				var start = changes[i].start;
				if (model.getBaseModel) {
					start = model.mapOffset(start, true);
				}
				if (start !== -1) {
					lineIndex = Math.min(lineIndex, model.getLineAtOffset(start));
				}
			}
		}
		redraw(e.added);
		redraw(e.removed);
		redraw(e.changed);
		var rulers = view.getRulers();
		for (i = 0; i < rulers.length; i++) {
			view.redrawLines(lineIndex, lineCount, rulers[i]);
		}
	};
	

	/**
	 * Constructs a new zoom ruler. 
	 *
	 * @param {String} [rulerLocation="left"] the location for the ruler.
	 * @param {orion.editor.Style} [rulerStyle=undefined] the style for the ruler.
	 *
	 * @augments orion.editor.Ruler
	 * @class This objects implements an overview ruler.
	 *
	 * <p><b>See:</b><br/>
	 * {@link orion.editor.AnnotationRuler} <br/>
	 * {@link orion.editor.Ruler} 
	 * </p>
	 * @name orion.editor.OverviewRuler
	 */
	var ZoomRuler = function(rulerLocation, rulerStyle) {
		BaseRuler.call(this, rulerLocation, "fixed", rulerStyle); //$NON-NLS-0$
	};
	
	ZoomRuler.prototype = objects.mixin(new BaseRuler(), {
		setView: function (view) {
			this._destroy();
			BaseRuler.prototype.setView.call(this, view);
			this._create();
		},
		_create: function() {
			var textView = this.getView();
			if (!textView) return;
			function getOptions(options) {
				var rulerTheme = "textviewZoom"; //$NON-NLS-0$
				var theme = options.themeClass;
				if (theme) {
					theme = theme.replace(rulerTheme, "");
					if (theme) { theme = " " + theme; } //$NON-NLS-0$
					theme = rulerTheme + theme;
				} else {
					theme = rulerTheme;
				}
				options.themeClass = theme;
				options.noScroll = true;
				options.readonly = true;
				return options;
			}
			var options = getOptions(textView.getOptions());
			options.parent = this.node;
			var zoomView = this._zoomView = new mTextView.TextView(options);
			zoomView._clientDiv.contentEditable = false;
			zoomView.setModel(textView.getModel());
			var document = textView.getOptions("parent").ownerDocument; //$NON-NLS-0$
			var windowDiv = this._windowDiv = util.createElement(document, "div"); //$NON-NLS-0$
			windowDiv.className ="rulerZoomWindow"; //$NON-NLS-0$
			this.node.appendChild(windowDiv);
			var border = parseInt(textUtil.getNodeStyle(windowDiv, "border-top-width", 0)) + //$NON-NLS-0$
					parseInt(textUtil.getNodeStyle(windowDiv, "border-bottom-width", 0)); //$NON-NLS-0$
			var that = this;
			function updateWindow(scroll, p) {
				var top = scroll.y * p.zoomFactor;
				var height = p.clientHeight * p.zoomFactor;
				that.top = top;
				that.bottom = top + height;
				top = zoomView.convert({y: top}, "document", "page").y; //$NON-NLS-1$ //$NON-NLS-0$
				top = top - that.node.getBoundingClientRect().top;
				windowDiv.style.top = top + "px"; //$NON-NLS-0$
				windowDiv.style.height = (height - border) + "px"; //$NON-NLS-0$
			}
			function getProps() {
				var padding = textView._metrics.viewPadding;
				var zoomPadding = textView._metrics.viewPadding;
				var lineHeight = textView.getLineHeight();
				var zoomLineHeight = zoomView.getLineHeight();
				var lineCount = textView.getModel().getLineCount();
				var documentHeight = textView._lineHeight ? textView._scrollHeight : lineCount * lineHeight;
				var zoomDocumentHeight = zoomView._lineHeight ? zoomView._scrollHeight : lineCount * zoomLineHeight;
				var zoomFactor = zoomDocumentHeight / documentHeight;
				var clientHeight = textView.getClientArea().height + padding.top + padding.bottom;
				var zoomClientHeight = zoomView.getClientArea().height + zoomPadding.top + zoomPadding.bottom;
				var windowHeight = clientHeight * zoomFactor;
				var scrollWidth = textView._metrics.scrollWidth;
				return {
					zoomFactor: zoomFactor,
					documentHeight: documentHeight,
					zoomDocumentHeight: zoomDocumentHeight,
					clientHeight: clientHeight,
					zoomClientHeight: zoomClientHeight,
					scrollWidth: scrollWidth,
					windowHeight: windowHeight,
					padding: padding
				};
			}
			function toZoom(scroll, p) {
				return scroll.y * (p.zoomFactor + (p.windowHeight - p.clientHeight - p.scrollWidth) / p.documentHeight);
			}
			function updateScroll(scroll) {
				scroll = scroll || {y: textView.getTopPixel()};
				var p = getProps();
				var y = toZoom(scroll, p);
				zoomView.setTopPixel(y);
				updateWindow(scroll, p);
			}
			function updateWidth(options) {
				var width;
				if (options.wrapMode && !options.wrapOffset && textView._metrics.charWidth) {
					var div1 = util.createElement(document, "div"); //$NON-NLS-0$
					div1.style.position = "fixed"; //$NON-NLS-0$
					div1.style.left = "-1000px"; //$NON-NLS-0$
					zoomView._clientDiv.appendChild(div1);
					div1.innerHTML = new Array(Math.ceil(textView.getClientArea().width / textView._metrics.charWidth) + 1).join("a"); //$NON-NLS-0$
					var rect1 = div1.getBoundingClientRect();
					width = Math.min(150, Math.ceil(rect1.right - rect1.left)) + "px"; //$NON-NLS-0$
				} else {
					width = "";
				}
				var oldWidth = that.node.style.width;
				that.node.style.width = width;
				return oldWidth !== width;
			}
			textView.addEventListener("Scroll", this._scrollListener = function(event) { //$NON-NLS-0$
				updateScroll(event.newValue);
			});
			textView.addEventListener("Resize", this._resizeListener = function() { //$NON-NLS-0$
				updateWidth(zoomView.getOptions());
				updateScroll();
			});
			textView.addEventListener("Redraw", this._redrawListener = function(event) { //$NON-NLS-0$
				if (!event.ruler) {
					zoomView.redrawLines(event.startLine, event.endLine);
				}
			});
			textView.addEventListener("Options", this._optionsListener = function(event) { //$NON-NLS-0$
				var options = getOptions(event.options);
				zoomView.setOptions(options);
				updateWidth(zoomView.getOptions());
			});
			zoomView.addEventListener("LineStyle", this._lineListener = function(e) { //$NON-NLS-0$
				textView.onLineStyle(e);
			});
			function down(event, clientY, touch) {
				if (touch || (that.top <= event.y && event.y <= that.bottom)) {
					that.mouseDown = true;
					that.delta = clientY - windowDiv.getBoundingClientRect().top + that.node.getBoundingClientRect().top;
				} else {
					var offset = zoomView.getOffsetAtLocation(event.x, event.y);
					textView.setSelection(offset, offset, 0.5, function() {});
				}
			}
			function up() {
				that.mouseDown = false;
			}
			function move(clientY) {
				if (that.mouseDown) {
					var p = getProps();
					var thumbPos = Math.min(p.zoomClientHeight - p.windowHeight, Math.max(0, clientY - that.delta));
					textView.setTopPixel(thumbPos * (p.documentHeight - p.clientHeight) / Math.min(p.zoomDocumentHeight, p.zoomClientHeight - p.windowHeight));
				}
			}
			function stop(event) {
				event.preventDefault();
			}
			if (util.isIOS || util.isAndroid) {
				windowDiv.addEventListener("touchstart", function(event) { //$NON-NLS-0$
					var touches = event.touches;
					if (touches.length === 1) {
						down(event, event.touches[0].clientY, true);
						event.preventDefault();
					}
				});
				windowDiv.addEventListener("touchend", function(event) { //$NON-NLS-0$
					var touches = event.touches;
					if (touches.length === 0) {
						up(event);
					}
				});
				windowDiv.addEventListener("touchmove", function(event) { //$NON-NLS-0$
					var touches = event.touches;
					if (touches.length === 1) {
						move(event.touches[0].clientY);
					}
				});
				zoomView.addEventListener("TouchStart", function(event) { //$NON-NLS-0$
					if (event.touchCount === 1) {
						down(event, event.event.touches[0].clientY);
						stop(event);
					}
				});
//				windowDiv.style.pointerEvents = "none"; //$NON-NLS-0$
//				zoomView.addEventListener("TouchEnd", function(event) { //$NON-NLS-0$
//					if (event.touchCount === 0) {
//						up(event);
//					}
//				});
//				zoomView.addEventListener("TouchMove", function(event) { //$NON-NLS-0$
//					if (event.touchCount === 1) {
//						move(event.event.touches[0].clientY);
//					}
//				});
			} else {
				windowDiv.style.pointerEvents = "none"; //$NON-NLS-0$
				zoomView.addEventListener("MouseDown", function(event) { //$NON-NLS-0$
					var e = event.event;
					if (e.which ? e.button === 0 : e.button === 1) {
						down(event, e.clientY);
					}
					stop(event);
				});
				zoomView.addEventListener("MouseUp", function(event) { //$NON-NLS-0$
					up(event);
					stop(event);
				});
				zoomView.addEventListener("MouseMove", function(event) { //$NON-NLS-0$
					move(event.event.clientY);
					stop(event);
				});
			}
			(document.defaultView || document.parentWindow).setTimeout(function() {
				updateScroll();
			}, 0);
		},
		_destroy: function() {
			var textView = this.getView();
			if (textView) {
				textView.removeEventListener("Scroll", this._scrollListener); //$NON-NLS-0$
				this._scrollListener = null;
				textView.removeEventListener("Resize", this._resizeListener); //$NON-NLS-0$
				this._resizeListener = null;
				textView.removeEventListener("Redraw", this._redrawListener); //$NON-NLS-0$
				this._redrawListener = null;
				textView.removeEventListener("Options", this._optionsListener); //$NON-NLS-0$
				this._optionsListener = null;
			}
			var zoomView = this._zoomView;
			if (zoomView) {
				zoomView.removeEventListener("LineStyle", this._lineListener); //$NON-NLS-0$
				zoomView.setModel(null);
				zoomView.destroy();
				this._zoomView = null;
			}
		}
	});
	
	return {
		BaseRuler: BaseRuler,
		Ruler: Ruler,
		AnnotationRuler: AnnotationRuler,
		LineNumberRuler: LineNumberRuler,
		OverviewRuler: OverviewRuler,
		FoldingRuler: FoldingRuler,
		ZoomRuler: ZoomRuler,
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: 
 *		Felipe Heidrich (IBM Corporation) - initial API and implementation
 *		Silenio Quarti (IBM Corporation) - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/
define("orion/editor/textDND", ['orion/util'], function(util) { //$NON-NLS-1$ //$NON-NLS-0$

	function TextDND(view, undoStack) {
		this._view = view;
		this._undoStack = undoStack;
		this._dragSelection = null;
		this._dropOffset = -1;
		this._dropText = null;
		var self = this;
		this._listener = {
			onDragStart: function (evt) {
				self._onDragStart(evt);
			},
			onDragEnd: function (evt) {
				self._onDragEnd(evt);
			},
			onDragEnter: function (evt) {
				self._onDragEnter(evt);
			},
			onDragOver: function (evt) {
				self._onDragOver(evt);
			},
			onDrop: function (evt) {
				self._onDrop(evt);
			},
			onDestroy: function (evt) {
				self._onDestroy(evt);
			}
		};
		view.addEventListener("DragStart", this._listener.onDragStart); //$NON-NLS-0$
		view.addEventListener("DragEnd", this._listener.onDragEnd); //$NON-NLS-0$
		view.addEventListener("DragEnter", this._listener.onDragEnter); //$NON-NLS-0$
		view.addEventListener("DragOver", this._listener.onDragOver); //$NON-NLS-0$
		view.addEventListener("Drop", this._listener.onDrop); //$NON-NLS-0$
		view.addEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
	}
	TextDND.prototype = {
		destroy: function() {
			var view = this._view;
			if (!view) { return; }
			view.removeEventListener("DragStart", this._listener.onDragStart); //$NON-NLS-0$
			view.removeEventListener("DragEnd", this._listener.onDragEnd); //$NON-NLS-0$
			view.removeEventListener("DragEnter", this._listener.onDragEnter); //$NON-NLS-0$
			view.removeEventListener("DragOver", this._listener.onDragOver); //$NON-NLS-0$
			view.removeEventListener("Drop", this._listener.onDrop); //$NON-NLS-0$
			view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
			this._view = null;
		},
		_onDestroy: function(e) {
			this.destroy();
		},
		_onDragStart: function(e) {
			var view = this._view;
			var text = view.getSelectionText();
			if (text) {
				this._dragSelection = view.getSelections();
				e.event.dataTransfer.effectAllowed = "copyMove"; //$NON-NLS-0$
				e.event.dataTransfer.setData("Text", text); //$NON-NLS-0$
			}
		},
		_onDragEnd: function(e) {
			if (this._dragSelection) {
				var view = this._view;
				var dropEffect = e.event.dataTransfer.dropEffect;
				if (!util.isFirefox) {
					if (dropEffect !== "none" || this._dropText) { //$NON-NLS-0$
						dropEffect = e.event.dataTransfer.dropEffect = this._dropEffect;
					}
				}
				if (this._undoStack) { this._undoStack.startCompoundChange(); }
				var move = dropEffect === "move"; //$NON-NLS-0$
				if (move) {
					view.setText({text: "", selection: this._dragSelection});
				}
				if (this._dropText) {
					var text = this._dropText;
					var offset = this._dropOffset;
					if (move) {
						this._dragSelection.forEach(function(selection) {
							if (offset >= selection.end) {
								offset -= selection.end - selection.start;
							} else if (offset >= selection.start) {
								offset = selection.start;
							}
						});
					}
					view.setText(text, offset, offset);
					view.setSelection(offset, offset + text.length);
					this._dropText = null;
					this._dropOffset = -1;
				}
				if (this._undoStack) { this._undoStack.endCompoundChange(); }
				this._dragSelection = null;
			}
		},
		_onDragEnter: function(e) {
			this._onDragOver(e);
		},
		_onDragOver: function(e) {
			var types = e.event.dataTransfer.types;
			var allowed = !this._view.getOptions("readonly"); //$NON-NLS-0$
			if (allowed) {
				if (types) {
					allowed = types.contains ? 
						types.contains("text/plain") || types.contains("Text") : //$NON-NLS-1$ //$NON-NLS-0$
						types.indexOf("text/plain") !== -1 || types.indexOf("Text") !== -1; //$NON-NLS-1$ //$NON-NLS-0$
					}
			}
			if (!allowed) {
				e.event.dataTransfer.dropEffect = "none"; //$NON-NLS-0$
			} else {
				if (!util.isFirefox) {
					var copy = util.isMac ? e.event.altKey : e.event.ctrlKey;
					this._dropEffect = e.event.dataTransfer.dropEffect = copy ? "copy" : "move"; //$NON-NLS-1$ //$NON-NLS-0$
				}
			}
		},
		_onDrop: function(e) {
			var view = this._view;
			var text = e.event.dataTransfer.getData("Text"); //$NON-NLS-0$
			if (text) {
				if (!util.isFirefox) {
					e.event.dataTransfer.dropEffect = this._dropEffect; //$NON-NLS-1$ //$NON-NLS-0$
				}
				var offset = view.getOffsetAtLocation(e.x, e.y);
				if (this._dragSelection) {
					this._dropOffset = offset;
					this._dropText = text;
				} else {
					view.setText(text, offset, offset);
					view.setSelection(offset, offset + text.length);
				}
			}
		}
	};

	return {TextDND: TextDND};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/templates", [], function() { //$NON-NLS-0$

	/** 
	 * Removes prefix from string.
	 * @param {String} prefix
	 * @param {String} string
	 */
	function chop(prefix, string) {
		return string.substring(prefix.length);
	}
	
	var tabVar = "${tab}"; //$NON-NLS-0$
	var delimiterVar = "${delimiter}"; //$NON-NLS-0$
	var cursorVar = "${cursor}"; //$NON-NLS-0$
	
	function Template (prefix, description, template, name) {
		this.prefix = prefix;
		this.description = description;
		this.template = template;
		this.name = name;
		this._parse();
	}
	Template.prototype = /** @lends orion.editor.Template.prototype */ {
		getProposal: function(prefix, offset, context) {
			//any returned positions need to be offset based on current cursor position and length of prefix
			var startOffset = offset-prefix.length;
			var groups = {};
			var escapePosition;
			var delimiter = context.delimiter !== undefined ? context.delimiter : "\n"; //$NON-NLS-0$
			if (context.indentation) {
				delimiter += context.indentation;
			}
			var tab = context.tab !== undefined ? context.tab : "\t"; //$NON-NLS-0$
			var delta = 0;
			var variables = this.variables;
			var segments = this.segments, proposal = [];
			for (var i = 0; i < segments.length; i++) {
				var segment = segments[i];
				var variable = variables[segment];
				if (variable !== undefined) {
					switch (segment) {
						case tabVar:
							segment = tab;
							break;
						case delimiterVar:
							segment = delimiter;
							break;
						case cursorVar:
							segment = "";
							escapePosition = delta;
							break;
						default:
							var g = groups[segment];
							if (!g) {
								g = groups[segment] = {data: variable.data, positions: []};
							}
							segment = variable.substitution;
							if (g.data && g.data.values) { segment = g.data.values[0]; }
							g.positions.push({
								offset: startOffset + delta,
								length: segment.length
							});
					}
				}
				proposal.push(segment);
				delta += segment.length;
			}
			var newGroups = [];
			for (var p in groups) {
				if (groups.hasOwnProperty(p)) {
					newGroups.push(groups[p]);
				}
			}
			proposal = proposal.join("");
			if (escapePosition === undefined) {
				escapePosition = proposal.length;
			}
			return {
				proposal: proposal,
				name: this.name,
				description: this.description,
				groups: newGroups,
				escapePosition: startOffset + escapePosition,
				style: 'noemphasis'
			};
		},
		match: function(prefix) {
			return this.prefix.indexOf(prefix) === 0;
		},
		_parse: function() {
			var template = this.template;
			var segments = [], variables = {}, segment, start = 0;
			template = template.replace(/\n/g, delimiterVar);
			template = template.replace(/\t/g, tabVar);
			template.replace(/\$\{((?:[^\\}]+|\\.))*\}/g, function(group, text1, index) {
				var text = group.substring(2,group.length-1);
				var variable = group, substitution = text, data = null;
				var colon = substitution.indexOf(":"); //$NON-NLS-0$
				if (colon !== -1) {
					substitution = substitution.substring(0, colon);
					variable = "${"+ substitution + "}"; //$NON-NLS-1$ //$NON-NLS-0$
					data = JSON.parse(text.substring(colon + 1).replace("\\}", "}").trim()); //$NON-NLS-1$ //$NON-NLS-0$
				}
				var v = variables[variable];
				if (!v) { v = variables[variable] = {}; }
				v.substitution = substitution;
				if (data) {
					v.data = data;
				}
				segment = template.substring(start, index);
				if (segment) { segments.push(segment); }
				segments.push(variable);
				start = index + group.length;
				return substitution;
			});
			segment = template.substring(start, template.length);
			if (segment) { segments.push(segment); }
			this.segments = segments;
			this.variables = variables;
		}
	};
	
	function TemplateContentAssist (keywords, templates) {
		this._keywords = keywords || [];
		this._templates = [];
		this.addTemplates(templates || []);
	}
	TemplateContentAssist.prototype = /** @lends orion.editor.TemplateContentAssist.prototype */ {
		addTemplates: function(json) {
			var templates = this.getTemplates();
			for (var j = 0; j < json.length; j++) {
				templates.push(new Template(json[j].prefix, json[j].description, json[j].template, json[j].name));
			}
		},
		/**
		 * Called by the content assist engine to initialize this provider before any <tt>computeProposals()</tt> calls.
		 * This implementation does nothing; subclasses may override.
		 */
		initialize: function() {
		},
		computeProposals: function(buffer, offset, context) {
			var prefix = this.getPrefix(buffer, offset, context);
			var proposals = [];
			if (this.isValid(prefix, buffer, offset, context)) {
				proposals = proposals.concat(this.getTemplateProposals(prefix, offset, context));
				proposals = proposals.concat(this.getKeywordProposals(prefix));
			}
			return proposals;
		},
		getKeywords: function() {
			return this._keywords;
		},
		getKeywordProposals: function(prefix) {
			var proposals = [];
			var keywords = this.getKeywords();
			if (keywords) {
				for (var i = 0; i < keywords.length; i++) {
					if (keywords[i].indexOf(prefix) === 0) {
						proposals.push({proposal: chop(prefix, keywords[i]), 
							description: keywords[i], 
							style: 'noemphasis_keyword'//$NON-NLS-0$
						});
					}
				}
				
				if (0 < proposals.length) {
					proposals.splice(0, 0,{
						proposal: '',
						description: 'Keywords', //$NON-NLS-0$
						style: 'noemphasis_title_keywords', //$NON-NLS-0$
						unselectable: true
					});	
				}
			}
			return proposals;
		},
		getPrefix: function(buffer, offset, context) {
			return context.prefix;
		},
		getTemplates: function() {
			return this._templates;
		},
		getTemplateProposals: function(prefix, offset, context) {
			var proposals = [];
			var templates = this.getTemplates();
			for (var t = 0; t < templates.length; t++) {
				var template = templates[t];
				if (template.match(prefix)) {
					var proposal = template.getProposal(prefix, offset, context);
					this.removePrefix(prefix, proposal);
					proposals.push(proposal);
				}
			}
			
			if (0 < proposals.length) {
				//sort the proposals by name
				proposals.sort(function(p1, p2) {
					if (p1.name < p2.name) return -1;
					if (p1.name > p2.name) return 1;
					return 0;
				});
				// if any templates were added to the list of 
				// proposals, add a title as the first element
				proposals.splice(0, 0, {
					proposal: '',
					description: 'Templates', //$NON-NLS-0$
					style: 'noemphasis_title', //$NON-NLS-0$
					unselectable: true
				});
			}
			
			return proposals;
		},
		removePrefix: function(prefix, proposal) {
			var overwrite = proposal.overwrite = proposal.proposal.substring(0, prefix.length) !== prefix;
			if (!overwrite) {
				proposal.proposal = chop(prefix, proposal.proposal);
			}
		},
		isValid: function(prefix, buffer, offset, context) {
			return true;
		}
	};
	
	return {
		Template: Template,
		TemplateContentAssist: TemplateContentAssist
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/linkedMode", [ //$NON-NLS-0$
	'i18n!orion/editor/nls/messages', //$NON-NLS-0$
	'orion/keyBinding', //$NON-NLS-0$
	'orion/editor/keyModes', //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/editor/templates', //$NON-NLS-0$
	'orion/objects', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(messages, mKeyBinding, mKeyModes, mAnnotations, mTemplates, objects) {

	var exports = {};

	function LinkedMode(editor, undoStack, contentAssist) {
		var textView = editor.getTextView();
		mKeyModes.KeyMode.call(this, textView);
		this.editor = editor;
		this.undoStack = undoStack;
		this.contentAssist = contentAssist;
		
		this.linkedModeModel = null;
		
		textView.setAction("linkedModeEnter", function() { //$NON-NLS-0$
			this.exitLinkedMode(true);
			return true;
		}.bind(this));
		textView.setAction("linkedModeCancel", function() { //$NON-NLS-0$
			this.exitLinkedMode(false);
			return true;
		}.bind(this));
		textView.setAction("linkedModeNextGroup", function() { //$NON-NLS-0$
			var model = this.linkedModeModel;
			this.selectLinkedGroup((model.selectedGroupIndex + 1) % model.groups.length);
			return true;
		}.bind(this));
		textView.setAction("linkedModePreviousGroup", function() { //$NON-NLS-0$
			var model = this.linkedModeModel;
			this.selectLinkedGroup(model.selectedGroupIndex > 0 ? model.selectedGroupIndex-1 : model.groups.length-1);
			return true;
		}.bind(this));
		
		/**
		 * Listener called when Linked Mode is active. Updates position's offsets and length
		 * on user change. Also escapes the Linked Mode if the text buffer was modified outside of the Linked Mode positions.
		 */
		this.linkedModeListener = {
		
			onActivating: function(event) {
				if (this._groupContentAssistProvider) {
					this.contentAssist.setProviders([this._groupContentAssistProvider]);
					this.contentAssist.setProgress(null);
				}
			}.bind(this),
			
			onModelChanged: function(event) {
				if (this.ignoreVerify) { return; }

				// Get the position being modified
				var start = this.editor.mapOffset(event.start);
				var model = this.linkedModeModel, positionChanged, changed;
				while (model) {
					positionChanged = this._getPositionChanged(model, start, start + event.removedCharCount);
					changed = positionChanged.position;
					if (changed === undefined || changed.model !== model) {
						// The change has been done outside of the positions, exit the Linked Mode
						this.exitLinkedMode(false);
						model = this.linkedModeModel;
					} else {
						break;
					}
				}
				if (!model) { return; }

				// Update position offsets for this change. Group changes are done in #onVerify
				var deltaCount = 0;
				var changeCount = event.addedCharCount - event.removedCharCount;
				var sortedPositions = positionChanged.positions, position, pos;
				for (var i = 0; i < sortedPositions.length; ++i) {
					pos = sortedPositions[i];
					position = pos.position;
					var inside = position.offset <= start && start <= position.offset + position.length;
					if (inside && !pos.ansestor) {
						position.offset += deltaCount;
						position.length += changeCount;
						deltaCount += changeCount;
					} else {
						position.offset += deltaCount;
						if (pos.ansestor && inside) {
							position.length += changeCount;
						}
					}
					if (pos.escape) {
						pos.model.escapePosition = position.offset;
					}
				}
				this._updateAnnotations(sortedPositions);
			}.bind(this),

			onVerify: function(event) {
				if (this.ignoreVerify) { return; }

				// Get the position being modified
				var editor = this.editor;
				var start = editor.mapOffset(event.start);
				var end = this.editor.mapOffset(event.end);
				var model = this.linkedModeModel, positionChanged, changed;
				while (model) {
					positionChanged = this._getPositionChanged(model, start, end);
					changed = positionChanged.position;
					if (changed === undefined || changed.model !== model) {
						// The change has been done outside of the positions, exit the Linked Mode
						this.exitLinkedMode(false);
						model = this.linkedModeModel;
					} else {
						break;
					}
				}
				if (!model) { return; }
				
				// Make sure changes in a same group are compound
				var undo = this._compoundChange;
				if (undo) {
					if (!(undo.owner.model === model && undo.owner.group === changed.group)) {
						this.endUndo();
						this.startUndo();
					}
				} else {
					this.startUndo();
				}

				model.selectedGroupIndex = changed.group;
				
				// Update position offsets taking into account all positions in the same changing group
				var deltaCount = 0;
				var changeCount = event.text.length - (end - start);
				var sortedPositions = positionChanged.positions, position, pos;
				var deltaStart = start - changed.position.offset, deltaEnd = end - changed.position.offset;
				for (var i = 0; i < sortedPositions.length; ++i) {
					pos = sortedPositions[i];
					position = pos.position;
					pos.oldOffset = position.offset;
					if (pos.model === model && pos.group === changed.group) {
						position.offset += deltaCount;
						position.length += changeCount;
						deltaCount += changeCount;
					} else {
						position.offset += deltaCount;
						if (pos.ansestor) {
							position.length += changed.count * changeCount;
						}
					}
					if (pos.escape) {
						pos.model.escapePosition = position.offset;
					}
				}
				
				// Cancel this modification and apply same modification to all positions in changing group
				this.ignoreVerify = true;
				for (i = sortedPositions.length - 1; i >= 0; i--) {
					pos = sortedPositions[i];
					if (pos.model === model && pos.group === changed.group) {
						editor.setText(event.text, pos.oldOffset + deltaStart , pos.oldOffset + deltaEnd);
					}
				}
				this.ignoreVerify = false;
				event.text = null;
				this._updateAnnotations(sortedPositions);
			}.bind(this)
		};
	}
	LinkedMode.prototype = new mKeyModes.KeyMode();
	objects.mixin(LinkedMode.prototype, {
		createKeyBindings: function() {
			var KeyBinding = mKeyBinding.KeyBinding;
			var bindings = [];
			bindings.push({actionID: "linkedModeEnter", keyBinding: new KeyBinding(13)}); //$NON-NLS-0$
			bindings.push({actionID: "linkedModeCancel", keyBinding: new KeyBinding(27)}); //$NON-NLS-0$
			bindings.push({actionID: "linkedModeNextGroup", keyBinding: new KeyBinding(9)}); //$NON-NLS-0$
			bindings.push({actionID: "linkedModePreviousGroup", keyBinding: new KeyBinding(9, false, true)}); //$NON-NLS-0$
			return bindings;
		},
		/**
		 * Starts Linked Mode, selects the first position and registers the listeners.
		 * @param {Object} linkedModeModel An object describing the model to be used by linked mode.
		 * Contains one or more position groups. If a position in a group is edited, the other positions in
		 * the same group are edited the same way. The model structure is as follows:
		 * <pre>{
		 *		groups: [{
		 *			data: {},
		 *			positions: [{
		 *				offset: 10, // Relative to the text buffer
		 *				length: 3
		 *			}]
		 *		}],
		 *		escapePosition: 19, // Relative to the text buffer
		 * }</pre>
		 *
		 * Each group in the model has an optional <code>data</code> property which can be
		 * used to provide additional content assist for the group.  The <code>type</code> in
		 * data determines what kind of content assist is provided. These are the support
		 * structures for the <code>data</code> property.
		 * <pre>{
		 *		type: "link"
		 *		values: ["proposal0", "proposal1", ...]
		 * }</pre>
		 *
		 * The "link" data struture provides static content assist proposals stored in the
		 * <code>values</code> property.
		 *
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.editor.Template}<br/>
		 * {@link orion.editor.TemplateContentAssist}<br/>
		 * </p>
		 */
		enterLinkedMode: function(linkedModeModel) {
			if (!this.linkedModeModel) {
				var textView = this.editor.getTextView();
				textView.addKeyMode(this);
				textView.addEventListener("Verify", this.linkedModeListener.onVerify); //$NON-NLS-0$
				textView.addEventListener("ModelChanged", this.linkedModeListener.onModelChanged); //$NON-NLS-0$
				var contentAssist = this.contentAssist;
				contentAssist.addEventListener("Activating", this.linkedModeListener.onActivating); //$NON-NLS-0$
				this.editor.reportStatus(messages.linkedModeEntered, null, true);
			}
			this._sortedPositions = null;
			if (this.linkedModeModel) {
				linkedModeModel.previousModel = this.linkedModeModel;
				linkedModeModel.parentGroup = this.linkedModeModel.selectedGroupIndex;
				this.linkedModeModel.nextModel = linkedModeModel;
			}
			this.linkedModeModel = linkedModeModel;
			this.selectLinkedGroup(0);
		},
		/** 
		 * Exits Linked Mode. Optionally places the caret at linkedMode escapePosition. 
		 * @param {Boolean} [escapePosition=false] if true, place the caret at the  escape position.
		 */
		exitLinkedMode: function(escapePosition) {
			if (!this.isActive()) {
				return;
			}
			if (this._compoundChange) {
				this.endUndo();
				this._compoundChange = null;
			}
			this._sortedPositions = null;
			var model = this.linkedModeModel;
			this.linkedModeModel = model.previousModel;
			model.parentGroup = model.previousModel = undefined;
			if (this.linkedModeModel) {
				this.linkedModeModel.nextModel = undefined;
			}
			if (!this.linkedModeModel) {
				var editor = this.editor;
				var textView = editor.getTextView();
				textView.removeKeyMode(this);
				textView.removeEventListener("Verify", this.linkedModeListener.onVerify); //$NON-NLS-0$
				textView.removeEventListener("ModelChanged", this.linkedModeListener.onModelChanged); //$NON-NLS-0$
				var contentAssist = this.contentAssist;
				contentAssist.removeEventListener("Activating", this.linkedModeListener.onActivating); //$NON-NLS-0$
				contentAssist.offset = undefined;
				this.editor.reportStatus(messages.linkedModeExited, null, true);
				if (escapePosition && typeof model.escapePosition === "number") { //$NON-NLS-0$
					editor.setCaretOffset(model.escapePosition, false);
				}
			}
			this.selectLinkedGroup(0);
		},
		startUndo: function() {
			if (this.undoStack) {
				var self = this;
				var model = this.linkedModeModel;
				this._compoundChange = this.undoStack.startCompoundChange({
					model: model,
					group: model.selectedGroupIndex,
					end: function() {
						self._compoundChange = null;
					}
				});
			}
		}, 
		endUndo: function() {
			if (this.undoStack) {
				this.undoStack.endCompoundChange();
			}
		},
		isActive: function() {
			return !!this.linkedModeModel;
		},
		isStatusActive: function() {
			return !!this.linkedModeModel;
		},
		selectLinkedGroup: function(index) {
			var model = this.linkedModeModel;
			if (model) {
				model.selectedGroupIndex = index;
				var group = model.groups[index];
				var position = group.positions[0];
				var editor = this.editor;
				editor.setSelection(position.offset, position.offset + position.length);
				var contentAssist = this.contentAssist;
				if (contentAssist) {
					contentAssist.offset = undefined;
					if (group.data && group.data.type === "link" && group.data.values) { //$NON-NLS-0$
						var provider = this._groupContentAssistProvider = new mTemplates.TemplateContentAssist(group.data.values);
						provider.getPrefix = function() {
							var selection = editor.getSelection();
							if (selection.start === selection.end) {
								var caretOffset = editor.getCaretOffset();
								if (position.offset <= caretOffset && caretOffset <= position.offset + position.length) {
									return editor.getText(position.offset, caretOffset);
								}
							}
							return "";
						};
						contentAssist.offset = position.offset;
						contentAssist.deactivate();
						contentAssist.activate();
					} else if (this._groupContentAssistProvider) {
						this._groupContentAssistProvider = null;
						contentAssist.deactivate();
					}
				}
			}
			this._updateAnnotations();
		},
		_getModelPositions: function(all, model, delta) {
			var groups = model.groups;
			for (var i = 0; i < groups.length; i++) {
				var positions = groups[i].positions;
				for (var j = 0; j < positions.length; j++) {
					var position = positions[j];
					if (delta) {
						position = {offset: position.offset + delta, length: position.length};
					}
					var pos = {
						index: j,
						group: i,
						count: positions.length,
						model: model,
						position: position
					};
					all.push(pos);
					if (model.nextModel && model.nextModel.parentGroup === i) {
						pos.ansestor = true;
						this._getModelPositions(all, model.nextModel, (delta || 0) + positions[j].offset - positions[0].offset);
					}
				}
			}
		},
		_getSortedPositions: function(model) {
			var all = this._sortedPositions;
			if (!all) {
				all = [];
				// Get the root linked model
				while (model.previousModel) {
					model = model.previousModel;
				}
				// Get all positions under model expanding group positions of stacked linked modes
				this._getModelPositions(all, model);
				// Add escape position for all models
				while (model) {
					if (typeof model.escapePosition === "number") { //$NON-NLS-0$
						all.push({
							escape: true,
							model: model,
							position: {offset: model.escapePosition, length: 0}
						});
					}
					model = model.nextModel;
				}
				all.sort(function(a, b) {
					return a.position.offset - b.position.offset;
				});
				this._sortedPositions = all;
			}
			return all;
		},
		_getPositionChanged: function(model, start, end) {
			var changed;
			var sortedPositions = this._getSortedPositions(model);
			for (var i = sortedPositions.length - 1; i >= 0; i--) {
				var position = sortedPositions[i].position;
				if (position.offset <= start && end <= position.offset + position.length) {
					changed = sortedPositions[i];
					break;
				}
			}
			return {position: changed, positions: sortedPositions};
		},
		_updateAnnotations: function(positions) {
			var annotationModel = this.editor.getAnnotationModel();
			if (!annotationModel) { return; }
			var remove = [], add = [];
			var annotations = annotationModel.getAnnotations(), annotation;
			while (annotations.hasNext()) {
				annotation = annotations.next();
				switch (annotation.type) {
					case mAnnotations.AnnotationType.ANNOTATION_LINKED_GROUP:
					case mAnnotations.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:
					case mAnnotations.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:
						remove.push(annotation);
				}
			}
			var model = this.linkedModeModel;
			if (model) {
				positions = positions || this._getSortedPositions(model);
				for (var i = 0; i < positions.length; i++) {
					var position = positions[i];
					if (position.model !== model) { continue; }
					if (position.escape) { continue; }
					var type = mAnnotations.AnnotationType.ANNOTATION_LINKED_GROUP;
					if (position.group === model.selectedGroupIndex) {
						if (position.index === 0) {
							type = mAnnotations.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP;
						} else {
							type = mAnnotations.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP;
						}
					}
					position = position.position;
					annotation = mAnnotations.AnnotationType.createAnnotation(type, position.offset, position.offset + position.length, "");
					add.push(annotation);
				}
			}
			annotationModel.replaceAnnotations(remove, add);
		}
	});
	exports.LinkedMode = LinkedMode;

	return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/factories", [ //$NON-NLS-0$
	'orion/editor/actions', //$NON-NLS-0$
	'orion/editor/undoStack', //$NON-NLS-0$
	'orion/editor/rulers', //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/editor/textDND', //$NON-NLS-0$
	'orion/editor/linkedMode', //$NON-NLS-0$
	'orion/util' //$NON-NLS-0$
], function(mActions, mUndoStack, mRulers, mAnnotations, mTextDND, mLinkedMode, util) {

	var exports = {};
	
	function KeyBindingsFactory() {
	}
	KeyBindingsFactory.prototype = {
		createKeyBindings: function(editor, undoStack, contentAssist, searcher) {
			// Create keybindings for generic editing, no dependency on the service model
			var textActions = new mActions.TextActions(editor, undoStack , searcher);
			// Linked Mode
			var linkedMode = new mLinkedMode.LinkedMode(editor, undoStack, contentAssist);
			// create keybindings for source editing
			// TODO this should probably be something that happens more dynamically, when the editor changes input
			var sourceCodeActions = new mActions.SourceCodeActions(editor, undoStack, contentAssist, linkedMode);
			return {
				textActions: textActions,
				linkedMode: linkedMode,
				sourceCodeActions: sourceCodeActions
			};
		}
	};
	exports.KeyBindingsFactory = KeyBindingsFactory;
	
	function UndoFactory() {
	}
	UndoFactory.prototype = {
		createUndoStack: function(editor) {
			var textView = editor.getTextView();
			return new mUndoStack.UndoStack(textView, 200);
		}
	};
	exports.UndoFactory = UndoFactory;

	function LineNumberRulerFactory() {
	}
	LineNumberRulerFactory.prototype = {
		createLineNumberRuler: function(annotationModel) {
			return new mRulers.LineNumberRuler(annotationModel, "left", {styleClass: "ruler lines"}, {styleClass: "rulerLines odd"}, {styleClass: "rulerLines even"}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		}
	};
	exports.LineNumberRulerFactory = LineNumberRulerFactory;
	
	function FoldingRulerFactory() {
	}
	FoldingRulerFactory.prototype = {
		createFoldingRuler: function(annotationModel) {
			return new mRulers.FoldingRuler(annotationModel, "left", {styleClass: "ruler folding"}); //$NON-NLS-1$ //$NON-NLS-0$
		}
	};
	exports.FoldingRulerFactory = FoldingRulerFactory;
	
	function ZoomRulerFactory() {
	}
	ZoomRulerFactory.prototype = {
		createZoomRuler: function(annotationModel) {
			return new mRulers.ZoomRuler(util.isIOS || util.isAndroid ? "right" : "innerRight", {styleClass: "ruler zoom"}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		}
	};
	exports.ZoomRulerFactory = ZoomRulerFactory;
	
	function AnnotationFactory() {
	}
	AnnotationFactory.prototype = {
		createAnnotationModel: function(model) {
			return new mAnnotations.AnnotationModel(model);
		},
		createAnnotationStyler: function(annotationModel, view) {
			return new mAnnotations.AnnotationStyler(annotationModel, view);
		},
		createAnnotationRulers: function(annotationModel) {
			var annotationRuler = new mRulers.AnnotationRuler(annotationModel, "left", {styleClass: "ruler annotations"}); //$NON-NLS-1$ //$NON-NLS-0$
			var overviewRuler = new mRulers.OverviewRuler(annotationModel, "right", {styleClass: "ruler overview"}); //$NON-NLS-1$ //$NON-NLS-0$
			return {annotationRuler: annotationRuler, overviewRuler: overviewRuler};
		}
	};
	exports.AnnotationFactory = AnnotationFactory;
	
	function TextDNDFactory() {
	}
	TextDNDFactory.prototype = {
		createTextDND: function(editor, undoStack) {
			return new mTextDND.TextDND(editor.getTextView(), undoStack);
		}
	};
	exports.TextDNDFactory = TextDNDFactory;
	
	return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/editorFeatures", [ //$NON-NLS-0$
	'orion/editor/factories', //$NON-NLS-0$
	'orion/editor/actions', //$NON-NLS-0$
	'orion/editor/linkedMode', //$NON-NLS-0$
	'orion/objects' //$NON-NLS-0$
], function(mFactories, mActions, mLinkedMode, objects) {
	return objects.mixin({}, mFactories, mActions, mLinkedMode);
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/splitter',[
	'orion/EventTarget',
	'orion/util',
	'orion/metrics',
	'orion/webui/littlelib'
], function(EventTarget, util, metrics, lib) {

	var ORIENTATION_HORIZONTAL = 1;
	var ORIENTATION_VERTICAL = 2;

	/**
	 * @name orion.webui.Splitter
	 * @class A splitter manages the layout of two panels, a side panel and a main panel.
	 * @description Constructs a new Splitter with the given options.  A splitter manages the layout
	 * of two panels, a side panel and a main panel.  An optional toggle button can open or close the
	 * side panel.
	 *
	 * <p>The relative proportions of the side and main panels are determined by the initial style of
	 * the splitter bar in the document. The panels will pin themselves to the splitter by default.
	 * Once the user moves the splitter, the positions are remembered. If the splitter is *not* proportional
	 * but *is* vertical then its position is stored separately from its horizontal position.</p>
	 * 
	 * <p>The splitter defines the CSS to position the nodes it's splitting based on which of the nodes
	 * 'collapses' when it's 'closed'. If the left (leading) node collapses then everything is defined relative
	 * to the left; if the trailing node collapses (closeReversely=true) then everything is relative to the right.
	 * In either case the CSS is defined so that the non-collapsing node gets the extra space if the browser grows.
	 *
	 * <p>By default, a splitter is open. The client can create a closed splitter by setting a 
	 * <code>data-initial-state</code> attribute with value <code>"closed"</code> on the 
	 * splitter's <code>node</code> element. Note that the user can drag a splitter 'closed' or 'open'
	 * and the correct state is maintained (i.e. if it were open and we dragged it all the way to its closed
	 * position then hitting the thumb would open it and vice versa.</p>
	 *
	 * @param {Object} options The options object which must specify the split dom node
	 * @param {Element} options.node The node for the splitter presentation.  Required.
	 * @param {Element} options.sidePanel The node for the side (toggling) panel.  Required.
	 * @param {Element} options.mainPanel The node for the main panel.  Required.
	 * @param {Boolean} [options.toggle=false] Specifies that the side node should be able to toggle.
	 * @param {Boolean} [options.vertical=false] Specifies that the nodes are stacked vertically rather than horizontal.
	 * @param {Boolean} [options.closeReversely=false] Specifies that the splitter moves to right when nodes are stacked horizontally, or to bottom when nodes are stacked vertically.
	 * @param {Boolean} [options.proportional=false] Specifies that the splitter is proportional so that growing the browser allocates space to both nodes.
	 *
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function Splitter(options) {
		EventTarget.attach(this);
		this._init(options);
	}
	Splitter.prototype = /** @lends orion.webui.Splitter.prototype */ {

		_init: function(options) {
			this.$splitter = lib.node(options.node);
			if (!this.$splitter) { throw "no dom node for splitter found"; } //$NON-NLS-0$
			this.$leading = lib.node(options.sidePanel);
			if (!this.$leading) { throw "no dom node for side panel found"; } //$NON-NLS-0$
			this.$trailing = lib.node(options.mainPanel);
			if (!this.$trailing) { throw "no dom node for main panel found"; } //$NON-NLS-0$

			this._tracking = false;
			this._animationDelay = 501;  // longer than CSS transitions in layout.css
			this._collapseTrailing = options.closeReversely || false;
			this._proportional = options.proportional || false;

			this._prefix = "/orion/splitter/" + (this.$splitter.id || document.body.id || "");  //$NON-NLS-0$
			
			if (options.toggle) {
				this._thumb = document.createElement("div"); //$NON-NLS-0$
				this.$splitter.appendChild(this._thumb);
				this._thumb.classList.add("splitThumb"); //$NON-NLS-0$
				if (this._vertical) {
					this._thumb.classList.add(this._collapseTrailing ? "splitVerticalThumbDownLayout" : "splitVerticalThumbUpLayout"); //$NON-NLS-1$ //$NON-NLS-0$
				} else {
					this._thumb.classList.add(this._collapseTrailing ? "splitThumbRightLayout" : "splitThumbLeftLayout"); //$NON-NLS-1$ //$NON-NLS-0$
				}
			}

			this.$splitter.classList.add("split"); //$NON-NLS-0$
			
			// Initialize for the current orientation / collapse direction
			var orientationStr = localStorage.getItem(this._prefix+"/orientation"); //$NON-NLS-0$
			if (orientationStr) {
				var orientation = orientationStr === "vertical" ? ORIENTATION_VERTICAL : ORIENTATION_HORIZONTAL; //$NON-NLS-0$
			} else {
				orientation = options.vertical ? ORIENTATION_VERTICAL : ORIENTATION_HORIZONTAL;
			}

			this.setOrientation(orientation);
			
			if (util.isIOS || util.isAndroid) {
				this.$splitter.addEventListener("touchstart", this._touchStart.bind(this), false); //$NON-NLS-0$
				if (this._thumb) {
					this._thumb.addEventListener("touchstart", this._touchStart.bind(this), false); //$NON-NLS-0$
				}
				this.$splitter.addEventListener("touchmove", this._touchMove.bind(this), false); //$NON-NLS-0$
				this.$splitter.addEventListener("touchend", this._touchEnd.bind(this), false); //$NON-NLS-0$
			} else {
				this.$splitter.addEventListener("mousedown", this._mouseDown.bind(this), false); //$NON-NLS-0$
				window.addEventListener("mouseup", this._mouseUp.bind(this), false); //$NON-NLS-0$
			}
			window.addEventListener("resize", this._resize.bind(this), false);  //$NON-NLS-0$
		},
		isClosed: function() {
			return this._closed;
		},
		getOrientation: function() {
			return this._vertical ? ORIENTATION_VERTICAL : ORIENTATION_HORIZONTAL;
		},		
		setOrientation: function(value) {
			var vertical = value === ORIENTATION_VERTICAL;
			if (vertical === this._vertical) {
				return;
			}

			this._vertical = vertical;

			// Store the orientation
			var orientationStr = this._vertical ? "vertical" : "horizontal"; //$NON-NLS-1$ //$NON-NLS-0$
			localStorage.setItem(this._prefix+"/orientation", orientationStr); //$NON-NLS-0$

			// Set up the CSS styling
			this.$splitter.style.position = "absolute"; //$NON-NLS-0$
			this.$trailing.style.position = "absolute"; //$NON-NLS-0$
			this.$leading.style.position = "absolute"; //$NON-NLS-0$

			// We need a different storage area for the vertical value in non-proportional layouts
			this._offsetStorageLabel = "/offset"; //$NON-NLS-0$
			if (this._vertical && !this._proportional) {
				this._offsetStorageLabel = "/offsetY"; //$NON-NLS-0$
			}
			
			if (this._vertical) {
				this.$splitter.classList.remove("splitLayout"); //$NON-NLS-0$
				this.$splitter.classList.add("splitVerticalLayout"); //$NON-NLS-0$
				
				// Set up for vertical calculations
				this._topLeft = "top"; //$NON-NLS-0$
				this._bottomRight = "bottom"; //$NON-NLS-0$
				this._widthHeight = "height"; //$NON-NLS-0$
			} else {
				this.$splitter.classList.remove("splitVerticalLayout"); //$NON-NLS-0$
				this.$splitter.classList.add("splitLayout"); //$NON-NLS-0$

				// Set up for vertical calculations
				this._topLeft = "left"; //$NON-NLS-0$
				this._bottomRight = "right"; //$NON-NLS-0$
				this._widthHeight = "width"; //$NON-NLS-0$
			}

			// Grab the initial position *before* hacking on the layout
			this._initializeFromStoredSettings();
			
			// Set up the style constants we need
			this._setStyleConstants();
			
			// 'Constants' (i.e. things we don't set to adjust for the offset)
			if (!this._collapseTrailing) {
				this.$splitter.style[this._bottomRight] = "auto"; //$NON-NLS-0$
				
				this.$leading.style[this._topLeft] = "0px"; //$NON-NLS-0$
				this.$leading.style[this._bottomRight] = "auto"; //$NON-NLS-0$

				this.$trailing.style[this._widthHeight] = "auto"; //$NON-NLS-0$
				this.$trailing.style[this._bottomRight] = "0px"; //$NON-NLS-0$
			} else {
				this.$splitter.style[this._topLeft] = "auto"; //$NON-NLS-0$
				
				this.$leading.style[this._topLeft] = "0px"; //$NON-NLS-0$
				this.$leading.style[this._widthHeight] = "auto"; //$NON-NLS-0$
				
				this.$trailing.style[this._topLeft] = "auto"; //$NON-NLS-0$
				this.$trailing.style[this._bottomRight] = "0px"; //$NON-NLS-0$
			}

			if (this._thumb) {
				var classList = this._thumb.classList;
				if (this._vertical) {
					classList.remove(this._collapseTrailing ? "splitThumbRightLayout" : "splitThumbLeftLayout"); //$NON-NLS-1$ //$NON-NLS-0$
					classList.add(this._collapseTrailing ? "splitVerticalThumbDownLayout" : "splitVerticalThumbUpLayout"); //$NON-NLS-1$ //$NON-NLS-0$
				} else {
					classList.remove(this._collapseTrailing ? "splitVerticalThumbDownLayout" : "splitVerticalThumbUpLayout"); //$NON-NLS-1$ //$NON-NLS-0$
					classList.add(this._collapseTrailing ? "splitThumbRightLayout" : "splitThumbLeftLayout"); //$NON-NLS-1$ //$NON-NLS-0$
				}
			}

			if (this._closed) {
				this._closed = false;        // _thumbDown will toggle it, so turn it off and then call _thumbDown.
				this._thumbDown(true, true); // do not animate. do not persist the initial state
			} else {
				this._adjustToOffset();
			}
			
			this._resize();
			
			// Finally, ensure that everything is visible
			this.$splitter.style.visibility = "visible"; //$NON-NLS-0$
			this.$trailing.style.display = "block"; //$NON-NLS-0$
			this.$leading.style.display = "block"; //$NON-NLS-0$
		},

		_setStyleConstants: function() {
			if (this._vertical) {
				this.$splitter.style.left = ""; //$NON-NLS-0$
				this.$splitter.style.right = ""; //$NON-NLS-0$
				
				// We own the width / height of both panes
				this.$leading.style.left = "auto"; //$NON-NLS-0$
				this.$leading.style.right = "auto"; //$NON-NLS-0$
				this.$leading.style.width = "100%"; //$NON-NLS-0$
				this.$trailing.style.left = "auto"; //$NON-NLS-0$
				this.$trailing.style.right = "auto"; //$NON-NLS-0$
				this.$trailing.style.width = "100%"; //$NON-NLS-0$
			} else {
				this.$splitter.style.top = ""; //$NON-NLS-0$
				this.$splitter.style.bottom = ""; //$NON-NLS-0$
				
				// We own the width / height of both panes
				this.$leading.style.top = "auto"; //$NON-NLS-0$
				this.$leading.style.bottom = "auto"; //$NON-NLS-0$
				this.$leading.style.height = "100%"; //$NON-NLS-0$
				this.$trailing.style.top = "auto"; //$NON-NLS-0$
				this.$trailing.style.bottom = "auto"; //$NON-NLS-0$
				this.$trailing.style.height = "100%"; //$NON-NLS-0$
			}
		},
		
		/**
		 * Toggle the open/closed state of the side panel.
		 */
		toggleSidePanel: function() {
			this._thumbDown();
		},

		/**
		 * Close the side panel.  This function has no effect if the side panel is already closed.
		 */
		openSidePanel: function() {
			if (!this._closed) {
				this._thumbDown();
			}
		},
		/**
		 * Adds an event listener for resizing the main and side panels.
		 * @param {Function} listener The function called when a resize occurs.  The DOM node that has
		 * been resized is passed as an argument.
		 *
		 * @deprecated use addEventListener instead
		 */
		addResizeListener: function(listener) {
			this.addEventListener("resize", function(event) { //$NON-NLS-0$
				listener(event.node);
			});
		},

		/*
		 * We use local storage vs. prefs because we don't presume the user wants the same window positioning across browsers and devices.
		 */
		_initializeFromStoredSettings: function() {
			var closedState = localStorage.getItem(this._prefix+"/toggleState"); //$NON-NLS-0$
			if (typeof closedState === "string") { //$NON-NLS-0$
				this._closed = closedState === "closed"; //$NON-NLS-0$
			} else {
				this._closed = this._closeByDefault;
			}
			
			// Set the initial value for the splitter's width/height
			this._adjustSplitterSize();

			var pos = localStorage.getItem(this._prefix+this._offsetStorageLabel);
			if (pos) {
				this._offset = parseInt(pos, 10);
				if (this._proportional) {
					this._offset = Math.max(0, Math.min(100 - this._splitterSize, this._offset));
				}
			} else {
				// Use the current splitter location
				var rect = lib.bounds(this.$splitter);
				this._offset = this._adjustOffset(rect[this._topLeft]);
			}
		},

		_adjustSplitterSize: function() {
			// Size in pixels
			var rect = lib.bounds(this.$splitter);
			this._splitterSize = rect[this._widthHeight];
			
			// Make proportional if necessary
			if (this._proportional) {
				var pRect = lib.bounds(this.$splitter.parentNode);
				this._splitterSize = this._splitterSize / (pRect[this._widthHeight] / 100);
			}			
		},
		
		/*
		 * Takes a value that represents the desired left / top position for the
		 * splitter and adjusts based on which side collapses. It then turns the value into
		 * a ratio if the splitter is proportional.
		 */
		_adjustOffset: function(newOffset) {
			var parentRect = lib.bounds(this.$splitter.parentNode);
			if (this._collapseTrailing) {
				var adjustment = newOffset + this._splitterSize;
				newOffset = parentRect[this._widthHeight] - (adjustment - parentRect[this._topLeft]);
			} else {
				newOffset = newOffset - parentRect[this._topLeft];
			}
			
			if (this._proportional) {
				newOffset = newOffset / (parentRect[this._widthHeight] / 100);
			}
			
			return newOffset;
		},

		_adjustToOffset: function() {
			if (this._offset < 0) {
				this._offset = 0;
			}
			
			var suffix = this._proportional ? "%" : "px"; //$NON-NLS-1$ //$NON-NLS-0$
			
			if (!this._collapseTrailing) {
				this.$splitter.style[this._topLeft] = this._offset + suffix;
				this.$leading.style[this._widthHeight] = this._offset + suffix;
				this.$trailing.style[this._topLeft] = (this._offset + this._splitterSize) + suffix;
			} else {
				this.$splitter.style[this._bottomRight] = this._offset + suffix;
				this.$leading.style[this._bottomRight] = (this._offset + this._splitterSize) + suffix;
				this.$trailing.style[this._widthHeight] = this._offset + suffix;
			}
		},

		_resize: function() {
			if (this._proportional) {
				this._adjustSplitterSize();
				this._adjustToOffset();
			}
			
			this._notifyResizeListeners(this.$trailing);
			this._notifyResizeListeners(this.$leading);
		},

		_notifyResizeListeners: function(node) {
			this.dispatchEvent({type: "resize", node: node}); //$NON-NLS-0$
		},

		_notifyToggleListeners: function() {
			this.dispatchEvent({type: "toggle", closed: this._closed}); //$NON-NLS-0$
		},

		_thumbDown: function(noAnimation, noUpdateStorage) {
			if (!noAnimation) {
				this._addAnimation();
			}

			if (this._closed) {
				var pos = localStorage.getItem(this._prefix+this._offsetStorageLabel);
				this._offset = pos ? parseInt(pos, 10) : 350;
				this._closed = false;
			} else {
				localStorage.setItem(this._prefix+this._offsetStorageLabel, this._offset);
				this._offset = 0;
				this._closed = true;
			}

			this._adjustToOffset();

			if (!noAnimation) {
				this._removeAnimation();
			}
			if (!noUpdateStorage) {
				localStorage.setItem(this._prefix+"/toggleState", this._closed ? "closed" : null);  //$NON-NLS-1$  //$NON-NLS-0$
				metrics.logEvent("preferenceChange", "splitterClosed", this._prefix, this._closed ? 0 : 1);
			}
		},

		_removeAnimation: function() {
			// in a timeout to ensure the animations are complete.
			var self = this;
			window.setTimeout(function() {
				self.$leading.classList.remove("generalAnimation"); //$NON-NLS-0$
				self.$trailing.classList.remove("generalAnimation"); //$NON-NLS-0$
				self.$splitter.classList.remove("generalAnimation"); //$NON-NLS-0$
				
				self._resize();
			}, this._animationDelay);
		},

		_addAnimation: function() {
			this.$leading.classList.add("generalAnimation"); //$NON-NLS-0$
			this.$trailing.classList.add("generalAnimation"); //$NON-NLS-0$
			this.$splitter.classList.add("generalAnimation"); //$NON-NLS-0$
		},
		
		_down: function() {
			this.$splitter.classList.add("splitTracking"); //$NON-NLS-0$
			this.$trailing.classList.add("panelTracking"); //$NON-NLS-0$
			this.$leading.classList.add("panelTracking"); //$NON-NLS-0$
		},
		
		_move: function(clientX, clientY) {
			var pos = this._vertical ? clientY : clientX;
			
			// Try to center the cursor on the new splitter pos
			var rect = lib.bounds(this.$splitter);
			var offset = rect[this._widthHeight] / 2;
			if (this._collapseTrailing) {
				this._offset = this._adjustOffset(pos + offset);
			} else {
				this._offset = this._adjustOffset(pos - offset);
			}
			
			this._adjustToOffset();	
		},
		
		_up: function() {
			this.$splitter.classList.remove("splitTracking"); //$NON-NLS-0$
			this.$trailing.classList.remove("panelTracking"); //$NON-NLS-0$
			this.$leading.classList.remove("panelTracking"); //$NON-NLS-0$

			var curState = this._closed;
			
			// if the user dragged the splitter closed or open capture this
			if (this._offset > 0) {
				// Store the current position
				localStorage.setItem(this._prefix+this._offsetStorageLabel, this._offset);
				this._closed = false;
			} else {
				this._closed = true;
			}
			
			// Update the state if necessary
			if (curState !== this._closed) {
				localStorage.setItem(this._prefix+"/toggleState", this._closed ? "closed" : null);  //$NON-NLS-1$  //$NON-NLS-0$
				metrics.logEvent("preferenceChange", "splitterClosed", this._prefix, this._closed ? 0 : 1);
			}
		},

		_mouseDown: function(event) {
			if (event.target === this._thumb) {
				lib.stop(event);
				return this._thumbDown();
			}
			if (this._tracking) {
				return;
			}
			this._down(event);
			this._tracking = this._mouseMove.bind(this);
			window.addEventListener("mousemove", this._tracking); //$NON-NLS-0$
			lib.setFramesEnabled(false);
			lib.stop(event);
		},

		_mouseMove: function(event) {
			if (this._tracking) {
				this._move(event.clientX, event.clientY);
			}
		},

		_mouseUp: function(event) {
			if (this._tracking) {
				lib.setFramesEnabled(true);
				window.removeEventListener("mousemove", this._tracking); //$NON-NLS-0$
				this._tracking = null;
				this._up();
				lib.stop(event);
				
				this._resize();
			}
		},
		
		_touchStart: function(event) {
			var touches = event.touches;
			if (touches.length === 1) {
				lib.stop(event);
				if (event.target === this._thumb) {
					return this._thumbDown();
				}
				this._down(event);
				this._touching = true;
			}
		},
		
		_touchMove: function(event) {
			if (this._touching) {
				var touches = event.touches;
				if (touches.length === 1) {
					var touch = touches[0];
					this._move(touch.clientX, touch.clientY);
				}
			}
		},
		
		_touchEnd: function(event) {
			var touches = event.touches;
			if (touches.length === 0) {
				this._touching = false;
				this._up();
			}
		}
	};
	Splitter.prototype.constructor = Splitter;
	//return the module exports
	return {
		Splitter: Splitter,
		ORIENTATION_HORIZONTAL: ORIENTATION_HORIZONTAL,
		ORIENTATION_VERTICAL: ORIENTATION_VERTICAL
	};
});

define('text!orion/compare/sideBySideTemplate.html',[],function () { return '<div id="topWidget_id" style="height:100%;width:100%;position:relative">\r\n\t<div class="leftPanelLayout ">\r\n\t\t<div class="titleActionContainer">\r\n\t\t\t<div class="compareActionContainer" id="left_action_id"></div>\r\n\t\t\t<div class="titleContainer" id="left_title_id"></div>\r\n\t\t</div>\r\n\t\t<div class="compareEditorParent" id="left_editor_id"></div>\r\n\t\t<div class="statusContainer" id="left_status_id"></div>\r\n\t</div>\r\n\t<div class="split compareSplitLayout"></div>\r\n\t<div class="rightPanelLayout">\r\n\t\t<div class="titleActionContainer">\r\n\t\t\t<div class="compareActionContainer" id="right_action_id"></div>\r\n\t\t\t<div class="titleContainer" id="right_title_id"></div>\r\n\t\t</div>\r\n\t\t<div class="compareEditorParent"  id="right_editor_wrapper_id">\r\n\t\t\t<div class="canvasContainer">\r\n\t\t\t\t<canvas id="diff_canvas_id" class="compareCanvas" width="46" height="3000"></canvas>\r\n\t\t\t</div>\r\n\t\t\t<div class="compareEditorParentWithCanvas" id="right_editor_id"></div>\r\n\t\t</div>\r\n\t\t<div class="statusContainer" id="right_status_id"></div>\r\n\t</div>\r\n</div>';});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/compareUIFactory',['orion/webui/littlelib', 'orion/webui/splitter', 'text!orion/compare/sideBySideTemplate.html'], 
function(lib, mSplitter, SideBySideTemplate) {

var orion = orion || {};
orion.TwoWayCompareUIFactory = (function() {
	function TwoWayCompareUIFactory(option){
		this._parentDivID = option.parentDivID;
		this._commandSpanId = option.commandSpanId;
		this._showTitle = option.showTitle;
		this._leftTitle = option.leftTitle;
		this._rightTitle = option.rightTitle;
		this._showLineStatus = option.showLineStatus;
	}	
	TwoWayCompareUIFactory.prototype = {
		_init: function(){
			//Have to add prefix to the local dome node ids inside the widget, to support multiple widgets by the same template. 
			var prefix = this._parentDivID + "_"; //$NON-NLS-0$
			
			this._topWidgetDiv = lib.node("topWidget_id"); //$NON-NLS-0$
			this._topWidgetDiv.id = prefix + "topWidget_id"; //$NON-NLS-0$
			
			this._leftEditorParentDiv = lib.node("left_editor_id"); //$NON-NLS-0$
			this._leftEditorParentDiv.id = prefix + "left_editor_id"; //$NON-NLS-0$
			this._rightEditorParentDiv = lib.node("right_editor_id"); //$NON-NLS-0$
			this._rightEditorParentDiv.id = prefix + "right_editor_id"; //$NON-NLS-0$
			this._rightEditorWrapperDiv = lib.node("right_editor_wrapper_id"); //$NON-NLS-0$
			this._rightEditorWrapperDiv.id = prefix + "right_editor_wrapper_id"; //$NON-NLS-0$
			
			this._leftActionDiv = lib.node("left_action_id"); //$NON-NLS-0$
			this._leftActionDiv.id = prefix + "left_action_id"; //$NON-NLS-0$
			this._rightActionDiv = lib.node("right_action_id"); //$NON-NLS-0$
			this._rightActionDiv.id = prefix + "right_action_id"; //$NON-NLS-0$
			
			this._leftTitleDiv = lib.node("left_title_id"); //$NON-NLS-0$
			this._leftTitleDiv.id = prefix + "left_title_id"; //$NON-NLS-0$
			this._rightTitleDiv = lib.node("right_title_id"); //$NON-NLS-0$
			this._rightTitleDiv.id = prefix + "right_title_id"; //$NON-NLS-0$
			
			this._leftStatusDiv = lib.node("left_status_id"); //$NON-NLS-0$
			this._leftStatusDiv.id = prefix + "left_status_id"; //$NON-NLS-0$
			this._rightStatusDiv = lib.node("right_status_id"); //$NON-NLS-0$
			this._rightStatusDiv.id = prefix + "right_status_id"; //$NON-NLS-0$

			this._diffCanvasDiv = lib.node("diff_canvas_id"); //$NON-NLS-0$
			this._diffCanvasDiv.id = prefix + "diff_canvas_id"; //$NON-NLS-0$
			
			this._splitterId = prefix+"orion_splitter"; //$NON-NLS-0$
			
			if(!this._showTitle){
				this.disableTitle();
			}
			if(!this._showLineStatus){
				this.disableLineStatus();
			}
		},
		
		_createSplitter: function(){
			var splitNode = lib.$(".split", this._topWidgetDiv); //$NON-NLS-0$
			splitNode.id = this._splitterId;
			var leftPane = lib.$(".leftPanelLayout", this._topWidgetDiv); //$NON-NLS-0$
			var rightPane = lib.$(".rightPanelLayout", this._topWidgetDiv); //$NON-NLS-0$
			if (splitNode && leftPane && rightPane) {
				this._splitter = new mSplitter.Splitter({node: splitNode, sidePanel: leftPane, mainPanel: rightPane, proportional: true});
			}
		},
				
		buildUI:function(){
			lib.node(this._parentDivID).innerHTML = SideBySideTemplate;//appendChild(topNode);
			this._init();
			this._createSplitter();
		},
		
		destroy: function(){
		},
		
		getSplitter: function(){
			return this._splitter;
		},
		
		isLeftPane: function(node){
			var leftPane = lib.$(".leftPanelLayout", this._topWidgetDiv); //$NON-NLS-0$
			return leftPane === node;
		},
		
		getEditorParentDiv: function(left){
			return (left ? this._leftEditorParentDiv : this._rightEditorParentDiv);
		},
		
		getTitleDiv: function(left){
			return (left ? this._leftTitleDiv : this._rightTitleDiv);
		},
		
		getActionDivId: function(left){
			return (left ? this._leftActionDiv.id : this._rightActionDiv.id);
		},
		
		getStatusDiv: function(left){
			return (left ? this._leftStatusDiv : this._rightStatusDiv);
		},
		
		getCommandSpanId: function(){
			return this._commandSpanId;
		},
		
		getDiffCanvasDiv: function(){
			return this._diffCanvasDiv;
		},
		
		disableTitle: function() {
			this._leftEditorParentDiv.style.top = "0px"; //$NON-NLS-0$
			this._rightEditorWrapperDiv.style.top = "0px"; //$NON-NLS-0$
			this._leftTitleDiv.style.height = "0px"; //$NON-NLS-0$
			this._rightTitleDiv.style.height = "0px"; //$NON-NLS-0$
		},

		disableLineStatus: function() {
			this._leftEditorParentDiv.style.marginBottom = "0px"; //$NON-NLS-0$
			this._rightEditorWrapperDiv.style.marginBottom = "0px"; //$NON-NLS-0$
			this._leftStatusDiv.style.height = "0px"; //$NON-NLS-0$
			this._rightStatusDiv.style.height = "0px"; //$NON-NLS-0$
		}
	};
	return TwoWayCompareUIFactory;
}());

return orion;
});

/* See jsdiff-license.txt for terms of usage */

/*
 * Text diff implementation.
 * 
 * This library supports the following APIS:
 * JsDiff.diffChars: Character by character diff
 * JsDiff.diffWords: Word (as defined by \b regex) diff which ignores whitespace
 * JsDiff.diffLines: Line based diff
 * 
 * JsDiff.diffCss: Diff targeted at CSS content
 * 
 * These methods are based on the implementation proposed in
 * "An O(ND) Difference Algorithm and its Variations" (Myers, 1986).
 * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.4.6927
 */
var JsDiff = (function() {
  function clonePath(path) {
    return { newPos: path.newPos, components: path.components.slice(0) };
  }
  function removeEmpty(array) {
    var ret = [];
    for (var i = 0; i < array.length; i++) {
      if (array[i]) {
        ret.push(array[i]);
      }
    }
    return ret;
  }
  function escapeHTML(s) {
    var n = s;
    n = n.replace(/&/g, "&amp;");
    n = n.replace(/</g, "&lt;");
    n = n.replace(/>/g, "&gt;");
    n = n.replace(/"/g, "&quot;");

    return n;
  }


  var fbDiff = function(ignoreWhitespace) {
    this.ignoreWhitespace = ignoreWhitespace;
  };
  fbDiff.prototype = {
      diff: function(oldString, newString, ignoreWhitespace) {
     	this.ignoreWhitespace = ignoreWhitespace;
       // Handle the identity case (this is due to unrolling editLength == 0
        if (newString === oldString) {
          return [{ value: newString }];
        }
        if (!newString) {
          return [{ value: oldString, removed: true }];
        }
        if (!oldString) {
          return [{ value: newString, added: true }];
        }

        newString = this.tokenize(newString);
        oldString = this.tokenize(oldString);

        var newLen = newString.length, oldLen = oldString.length;
        var maxEditLength = newLen + oldLen;
        var bestPath = [{ newPos: -1, components: [] }];

        // Seed editLength = 0
        var oldPos = this.extractCommon(bestPath[0], newString, oldString, 0);
        if (bestPath[0].newPos+1 >= newLen && oldPos+1 >= oldLen) {
          return bestPath[0].components;
        }

        for (var editLength = 1; editLength <= maxEditLength; editLength++) {
          for (var diagonalPath = -1*editLength; diagonalPath <= editLength; diagonalPath+=2) {
            var basePath;
            var addPath = bestPath[diagonalPath-1],
                removePath = bestPath[diagonalPath+1];
            oldPos = (removePath ? removePath.newPos : 0) - diagonalPath;
            if (addPath) {
              // No one else is going to attempt to use this value, clear it
              bestPath[diagonalPath-1] = undefined;
            }

            var canAdd = addPath && addPath.newPos+1 < newLen;
            var canRemove = removePath && 0 <= oldPos && oldPos < oldLen;
            if (!canAdd && !canRemove) {
              bestPath[diagonalPath] = undefined;
              continue;
            }

            // Select the diagonal that we want to branch from. We select the prior
            // path whose position in the new string is the farthest from the origin
            // and does not pass the bounds of the diff graph
            if (!canAdd || (canRemove && addPath.newPos < removePath.newPos)) {
              basePath = clonePath(removePath);
              this.pushComponent(basePath.components, oldString[oldPos], "", undefined, true);
            } else {
              basePath = clonePath(addPath);
              basePath.newPos++;
              this.pushComponent(basePath.components, newString[basePath.newPos], "", true, undefined);
            }

            var oldPos = this.extractCommon(basePath, newString, oldString, diagonalPath);

            if (basePath.newPos+1 >= newLen && oldPos+1 >= oldLen) {
              return basePath.components;
            } else {
              bestPath[diagonalPath] = basePath;
            }
          }
        }
      },

      pushComponent: function(components, value, helperValue, added, removed) {
        var last = components[components.length-1];
        if (last && last.added === added && last.removed === removed) {
          // We need to clone here as the component clone operation is just
          // as shallow array clone
          components[components.length-1] =
            {value: this.join(last.value, value), helperValue: this.join(last.helperValue, helperValue), added: added, removed: removed };
        } else {
          components.push({value: value, helperValue: helperValue, added: added, removed: removed });
        }
      },
      extractCommon: function(basePath, newString, oldString, diagonalPath) {
        var newLen = newString.length,
            oldLen = oldString.length,
            newPos = basePath.newPos,
            oldPos = newPos - diagonalPath;
        while (newPos+1 < newLen && oldPos+1 < oldLen && this.equals(newString[newPos+1], oldString[oldPos+1])) {
          newPos++;
          oldPos++;
          
          this.pushComponent(basePath.components, newString[newPos], oldString[oldPos], undefined, undefined);
        }
        basePath.newPos = newPos;
        return oldPos;
      },

      equals: function(left, right) {
        var reWhitespace = /\S/;
        if (this.ignoreWhitespace && !reWhitespace.test(left) && !reWhitespace.test(right)) {
          return true;
        } else {
          return this._equals(left, right);
        }
      },
      join: function(left, right) {
        return left + right;
      },
      tokenize: function(value) {
        return value;
      }
  };
  
  var CharDiff = new fbDiff();
  CharDiff._equals = function(left, right) {
    return left === right;
  };
  
  var WordDiff = new fbDiff(false);
  WordDiff.tokenize = function(value) {
    return removeEmpty(value.split(/(\s+|\b)/));
  };
  WordDiff._equals = function(left, right) {
    return left === right;
  };
  
  var CssDiff = new fbDiff(true);
  CssDiff.tokenize = function(value) {
    return removeEmpty(value.split(/([{}:;,]|\s+)/));
  };
  CssDiff._equals = function(left, right) {
    return left === right;
  };
  
  var LineDiff = new fbDiff();
  LineDiff.tokenize = function(value) {
    var result = value.split(/^/m);
    if(result && result.length > 0 && !result[result.length - 1]) {
    	result.pop();
    }
    return result;
  };
  LineDiff._equals = function(left, right) {
  	if(this.ignoreWhitespace) {
	  	var newLeft = left.replace(/^\s+|\s+$|\s+(?=\s)/g, "");
	 	var newRight = right.replace(/^\s+|\s+$|\s+(?=\s)/g, "");
    	return newLeft === newRight;
    }
    return left === right;
  };
  
  return {
    diffChars: function(oldStr, newStr, ignoreWhitespace) { return CharDiff.diff(oldStr, newStr, ignoreWhitespace); },
    diffWords: function(oldStr, newStr, ignoreWhitespace) { return WordDiff.diff(oldStr, newStr, ignoreWhitespace); },
    diffLines: function(oldStr, newStr, ignoreWhitespace) { return LineDiff.diff(oldStr, newStr, ignoreWhitespace); },

    diffCss: function(oldStr, newStr) { return CssDiff.diff(oldStr, newStr); },

    createPatch: function(fileName, oldStr, newStr, oldHeader, newHeader) {
      var ret = [];
      
      ret.push("Index: " + fileName);
      ret.push("===================================================================");
      ret.push("--- " + fileName + "\t" + oldHeader);
      ret.push("+++ " + fileName + "\t" + newHeader);
      
      var diff = LineDiff.diff(oldStr, newStr);
      diff.push({value: "", lines: []});   // Append an empty value to make cleanup easier
      
      var oldRangeStart = 0, newRangeStart = 0, curRange = [],
          oldLine = 1, newLine = 1;
      for (var i = 0; i < diff.length; i++) {
        var current = diff[i],
            lines = current.lines || current.value.replace(/\n$/, "").split("\n");
        current.lines = lines;
        
        if (current.added || current.removed) {
          if (!oldRangeStart) {
            var prev = diff[i-1];
            oldRangeStart = oldLine;
            newRangeStart = newLine;
            
            if (prev) {
              curRange.push.apply(curRange, prev.lines.slice(-4).map(function(entry) { return " " + entry; }));
              oldRangeStart -= 4;
              newRangeStart -= 4;
            }
          }
          curRange.push.apply(curRange, lines.map(function(entry) { return (current.added?"+":"-") + entry; }));
          if (current.added) {
            newLine += lines.length;
          } else {
            oldLine += lines.length;
          }
        } else {
          if (oldRangeStart) {
            if (lines.length <= 8 && i < diff.length-1) {
              // Overlapping 
              curRange.push.apply(curRange, lines.map(function(entry) { return " " + entry; }));
            } else {
              // end the range and output
              var contextSize = Math.min(lines.length, 4);
              ret.push(
                  "@@ -" + oldRangeStart + "," + (oldLine-oldRangeStart+contextSize)
                  + " +" + newRangeStart + "," + (newLine-newRangeStart+contextSize)
                  + " @@");
              ret.push.apply(ret, curRange);
              ret.push.apply(ret, lines.slice(0, contextSize).map(function(entry) { return " " + entry; }));

              oldRangeStart = 0;  newRangeStart = 0; curRange = [];
            }
          }
          oldLine += lines.length;
          newLine += lines.length;
        }
      }
      if (diff.length > 1 && !/\n$/.test(diff[diff.length-2].value)) {
        ret.push("\\ No newline at end of file\n");
      }
      
      return ret.join("\n");
    },

    convertChangesToXML: function(changes){
      var ret = [];
      for ( var i = 0; i < changes.length; i++) {
        var change = changes[i];
        if (change.added) {
          ret.push("<ins>");
        } else if (change.removed) {
          ret.push("<del>");
        }

        ret.push(escapeHTML(change.value));

        if (change.added) {
          ret.push("</ins>");
        } else if (change.removed) {
          ret.push("</del>");
        }
      }
      return ret.join("");
    }
  };
})();


if (typeof module !== "undefined") {
    module.exports = JsDiff;
}
//define an AMD module if module loader is available
if (typeof define === 'function' && define.amd) {
	define('jsdiff/diff',[],function() {
		return JsDiff;
	});
}
;
/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/jsdiffAdapter',['jsdiff/diff'], function(mJsDiff) {

var orion = orion || {};


orion.JSDiffAdapter = (function() {
	/**
	 * JSDiffAdapter is an adapter to convert jsdiff diff blocks into a list of mappers that is used in the Orion compare widget.
	 * 
	 * @name orion.JSDiffAdapter
	 * 
	 */
	function JSDiffAdapter(ignoreWhitespace) {
		this._ignoreWhitespace = ignoreWhitespace;
	}
	
	JSDiffAdapter.prototype = {
		//https://bugs.eclipse.org/bugs/show_bug.cgi?id=401905
		_specialLine: function(lineDelim, current, lastLineEnding) {
			return (current.value === lineDelim && lastLineEnding !== lineDelim);
		},
		
		/**
		 * @class This object describes a mapper item representing a diff block, which is an array of 3 numbers.
		 * @name orion.diff.mapperItem
		 *
		 * @property {number} mapperItem[0] the number of lines in the new version of the string.
		 * @property {number} mapperItem[1] the number of lines in the old version of the string.
		 * @property {number} mapperItem[2] the number that indicates the state of the diff block:
		 *     <ul>
		 *       <li> 0  - the diff block represents same lines on both side. mapperItem[0] and mapperItem[1] should be identical to represent the number of the same lines</li>
		 *       <li> -1 - the diff block represents that the new version has deleted lines. mapperItem[0] should be 0 and mapperItem[1] should represent the line number that was deleted</li>
		 *       <li> >0 - the diff block represents that the new version has added linies and the old version has deleted lines, if any. mapperItem[0] should be greater than 0 and mapperItem[1] should represent the line number that was deleted</li>
		 *     </ul>
		 */
		/**
		 * @class This object describes the result of the adapt call.
		 * @name orion.diff.jsdiff.result
		 *
		 * @property {array of orion.diff.mapperItem} mapper the array of diff blocks.
		 * E.G.
		 * [0, 1, -1],
		 * [2, 2, 0],
		 * [2, 0, 1],
		 * [4, 4, 0],
		 * @property {array of String} changContents the array of strings that represents all the added lines in the new version of the compare string.
		 */
		/**
		 * Returns the mapper object representing diff between two versions of a string.
		 *
		 * @param {String} oldStr the old version of the string
		 * @param {String} newStr the new version of the string
		 * @param {String} lineDelim optional the line delimeter of the string
		 * @returns {orion.diff.jsdiff.result} the result
		 */
		adapt: function(oldStr, newStr, lineDelim){
			if(!lineDelim){
				lineDelim = "\n"; //$NON-NLS-0$
			}
			var splitOld = oldStr.split(lineDelim); //$NON-NLS-0$
			var splitNew = newStr.split(lineDelim); //$NON-NLS-0$
			var newLineAtEndOld = (splitOld[splitOld.length-1] === "");
			var newLineAtEndNew = (splitNew[splitNew.length-1] === "");
			
			var diff = mJsDiff.diffLines(oldStr, newStr, this._ignoreWhitespace);
			var map = [];
			var changContents = [];
			var linesAdded = 0;
			var linesRemoved = 0;
			var changeIndex = -1;
			var oFileLineCounter = 0;
			var previousDelim = true;
			//https://bugs.eclipse.org/bugs/show_bug.cgi?id=401905
			//We have to reserve last line's ending 
			var lastLineEnding = lineDelim;
		    for (var i = 0; i < diff.length; i++){ 
				var current = diff[i];
		        //var lines = current.lines || current.value.replace(/\n$/, "").split("\n");
		        var lines = current.lines || current.value.split(lineDelim); //$NON-NLS-0$
		        var currentLineNumber = lines.length;
		        var startNumber = 0;
		        if(lines.length > 1 && lines[lines.length-1] === ""){
					currentLineNumber--;
		        }
		        if (currentLineNumber > 1 && !previousDelim) {
		            if (lines[0] === "") {
		                currentLineNumber--;
		                startNumber++;
		            }
		        }		        
		        current.lines = lines;
		        if (!current.added && !current.removed) {
		            if(!this._specialLine(lineDelim, current, lastLineEnding)){
			            if (linesAdded || linesRemoved) {
			                map.push([linesAdded, linesRemoved, changeIndex]);
			                linesAdded = 0;
			                linesRemoved = 0;
			                changeIndex = -1;
			                oFileLineCounter += linesRemoved;
			            }
						map.push([currentLineNumber, currentLineNumber, 0]);
						oFileLineCounter += currentLineNumber;
		            }
		        } else if (current.added) {
		            if (changeIndex === -1) {
		                changeIndex = changContents.length + 1;
		            }
		            linesAdded += currentLineNumber;
		            for (var j = startNumber; j < (currentLineNumber + startNumber); j++) {
		                changContents.push(current.lines[j]);
		            }
		        } else {
		            linesRemoved += currentLineNumber;
		        }		        
		        previousDelim = false;
		        if(lines.length > 1 && lines[lines.length-1] === ""){
			        previousDelim = true;
		        }
		        //we want to reserverve the line ending to check next line
		        if(current.value) {
					lastLineEnding = current.value[current.value.length - 1];
		        } else {
					lastLineEnding = lineDelim;
		        }
		    }
		    
		    
		    
			if (linesAdded || linesRemoved) {
			    map.push([linesAdded, linesRemoved, changeIndex]);
			    oFileLineCounter += linesRemoved;
			}
			
			if (oFileLineCounter < splitOld.length && splitOld.length > 1) {
			    var lastMapItem = map[map.length - 1];
			    if (lastMapItem[2] === 0) {
			        lastMapItem[0] += 1;
			        lastMapItem[1] += 1;
			    } else if (lastMapItem[2] === -1) {
			        map.push([1, 1, 0]);
			    } else if (newLineAtEndOld === newLineAtEndNew) {
			        map.push([1, 1, 0]);
			    } else {
			        if (newLineAtEndNew) {lastMapItem[0] += 1;}
			        if (newLineAtEndOld) {lastMapItem[1] += 1;}
			    }
			}
			return {mapper:map, changContents: {array:changContents , index:0}};
		},
		
		adaptCharDiff : function(oldStr, newStr, word) {
			var diff = word ? mJsDiff.diffWords(oldStr, newStr, this._ignoreWhitespace) : mJsDiff.diffChars(oldStr, newStr, this._ignoreWhitespace);
			var map = [];
			var oldStart = 0;
			var newStart = 0;
			var charsAdded = 0;
			var charsRemoved = 0;
			for ( var i = 0; i < diff.length; i++) {
				var current = diff[i];
				if (!current.added && !current.removed) {
					if (charsAdded > 0 || charsRemoved > 0) {
						map.push([ newStart,
								   newStart + charsAdded,
								   oldStart,
								   oldStart + charsRemoved ]);
						newStart += charsAdded;
						oldStart += charsRemoved;
						charsAdded = 0;
						charsRemoved = 0;
					}
					newStart += current.value.length;
					if(current.helperValue) {
						oldStart += current.helperValue.length;
					} else {
						oldStart += current.value.length;
					}
				} else if (current.added) {
					charsAdded += current.value.length;
				} else {
					charsRemoved += current.value.length;
				}
			}
			if (charsAdded > 0 || charsRemoved > 0) {
				map.push([ newStart, newStart + charsAdded,
						oldStart, oldStart + charsRemoved ]);
			}
			return map;
		}
	};
	return JSDiffAdapter;
}());

return orion;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/diffTreeNavigator',['orion/treeModelIterator', 'orion/compare/compareUtils', 'orion/editor/annotations', 'orion/compare/jsdiffAdapter'], function(mTreeModelIterator, mCompareUtils, mAnnotations, mJSDiffAdapter){

var exports = {};

var DiffAnnoTypes = {};

exports.DiffTreeNavigator = (function() {
	/**
	 * Creates a new diff tree model.
	 * A diff tree model represents a tree structure of diffs. 
	 * The top level children represents all the diff blocks based on lines, where each diff block contains a list of word level diffs.
	 *
	 * @name orion.DiffTreeNavigator.DiffTreeNavigator
	 * @class A tree model based iterator component.
	 * @param {list} firstLevelChildren The first level children of the tree root, each item has children and parent property recursively.
	 * @param {Object} options The options object which provides iterate patterns and all call back functions when iteration happens.
	 */
	function DiffTreeNavigator(charOrWordDiff, oldEditor, newEditor, oldDiffBlockFeeder, newDiffBlockFeeder, curveRuler) {
		this._root = {type: "root", children: []}; //$NON-NLS-0$
		this._initialized = false;
		this.initAll(charOrWordDiff, oldEditor, newEditor, oldDiffBlockFeeder, newDiffBlockFeeder, curveRuler);
	}
	
	/**
	 * Annotation type for the block diff 
	 */
	DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK = "orion.annotation.diff.addedBlock"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current block diff
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK = "orion.annotation.diff.currentAddedBlock"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the block diff 
	 */
	DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK = "orion.annotation.diff.deletedBlock"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current block diff
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK = "orion.annotation.diff.currentDeletedBlock"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the block diff, top only 
	 */
	DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY = "orion.annotation.diff.blockTop"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current block diff, top only 
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY = "orion.annotation.diff.currentBlockTop"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the block diff, conflicting 
	 */
	DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT = "orion.annotation.diff.blockConflict"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current block diff, conflicting 
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT = "orion.annotation.diff.currentBlockConflict"; //$NON-NLS-0$
	
	/**
	 * Annotation type for an added word 
	 */
	DiffAnnoTypes.ANNO_DIFF_ADDED_WORD = "orion.annotation.diff.addedWord"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current added word 
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_WORD = "orion.annotation.diff.currentAddedWord"; //$NON-NLS-0$
	
	/**
	 * Annotation type for a deleted word 
	 */
	DiffAnnoTypes.ANNO_DIFF_DELETED_WORD = "orion.annotation.diff.deletedWord"; //$NON-NLS-0$
	
	/**
	 * Annotation type for the current deleted word 
	 */
	DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_WORD = "orion.annotation.diff.currentDeletedWord"; //$NON-NLS-0$
	
	/**
	 * Annotation type for an empty word annotation, putting on the left side of character, e.g (start: 123, end: 123)
	 */
	DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT = "orion.annotation.diff.emptyDeletedWordLeft"; //$NON-NLS-0$

	/**
	 * Annotation type for an empty word annotation, putting on the right side of character, e.g (start: 123, end: 123)
	 */
	DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT = "orion.annotation.diff.emptyDeletedWordRight"; //$NON-NLS-0$
	
	/**
	 * Annotation type for an empty word annotation, putting on the left side of character, e.g (start: 123, end: 123)
	 */
	DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT = "orion.annotation.diff.emptyAddedWordLeft"; //$NON-NLS-0$

	/**
	 * Annotation type for an empty word annotation, putting on the right side of character, e.g (start: 123, end: 123)
	 */
	DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT = "orion.annotation.diff.emptyAddedWordRight"; //$NON-NLS-0$

	/*** registration of all the diff block annotation types ***/
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine addedBlockDiff"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine currentAddedBlockDiff"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine deletedBlockDiff"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine currentDeletedBlockDiff"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine blockDiffTopOnly"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine currentBlockDiffTopOnly"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine blockDiffConflict"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT, {
		title: "",
		html: "",
		lineStyle: {styleClass: "annotationLine currentBlockDiffConflict"} //$NON-NLS-0$
	});
	
	/*** registration of all the diff word annotation types ***/
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_ADDED_WORD, {
		title: "word added", //$NON-NLS-0$
		html: "",
		rangeStyle: {styleClass: "annotationRange addedWordDiff"} //$NON-NLS-0$
	});
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_WORD, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange currentAddedWordDiff"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_DELETED_WORD, {
		title: "word deleted", //$NON-NLS-0$
		html: "",
		rangeStyle: {styleClass: "annotationRange deletedWordDiff"} //$NON-NLS-0$
	});
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_WORD, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange currentDeletedWordDiff"} //$NON-NLS-0$
	});
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange emptyDeletedWordDiffLeft"} //$NON-NLS-0$
	});
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange emptyDeletedWordDiffRight"} //$NON-NLS-0$
	});
	
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange emptyAddedWordDiffLeft"} //$NON-NLS-0$
	});
	mAnnotations.AnnotationType.registerType(DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT, {
		title: "",
		html: "",
		rangeStyle: {styleClass: "annotationRange emptyAddedWordDiffRight"} //$NON-NLS-0$
	});
	
	var MAX_CHAR_DIFF_CHARS_PER_BLOCK = 5000;
	
	DiffTreeNavigator.prototype = /** @lends orion.DiffTreeNavigator.DiffTreeNavigator.prototype */ {
		
		initAll: function(charOrWordDiff, oldEditor, newEditor, oldDiffBlockFeeder, newDiffBlockFeeder, overviewRuler, curveRuler){
			if(!charOrWordDiff){
				this._charOrWordDiff = "word"; //$NON-NLS-0$
			} else {
				this._charOrWordDiff = charOrWordDiff;
			}
			if(oldEditor){
				this._initialized = true;
			}
			this.editorWrapper = [{editor: oldEditor, diffFeeder: oldDiffBlockFeeder},
			                      {editor: newEditor, diffFeeder: newDiffBlockFeeder}];
			this._curveRuler = curveRuler;
			this._overviewRuler = overviewRuler;
			if(this._overviewRuler){
				this._overviewRuler.setDiffNavigator(this);
			}
		},
			
		initMapper: function(mapper){
			if(mapper){
				for(var i = 0; i < this.editorWrapper.length; i++){
					this.editorWrapper[i].diffFeeder.init(this.editorWrapper[i].editor.getTextView().getModel(), mapper);
				}
			}
		},
		
		destroy: function(){
			this.initAll(this._charOrWordDiff);
		},
		
		renderAnnotations: function(ignoreWhitespace){
			var i;
			for(i = 0; i < this.editorWrapper.length; i++){
				this.editorWrapper[i].annoTypes = [];
				this.editorWrapper[i].diffFeeder.getBlockAnnoTypes(this.editorWrapper[i].annoTypes);
				this.editorWrapper[i].diffFeeder.getWordAnnoTypes(this.editorWrapper[i].annoTypes);
				for(var j = 0; j < this.editorWrapper[i].annoTypes.length; j++){
					if(this.editorWrapper[i].annoTypes[j].current){
						this.editorWrapper[i].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[i].annoTypes[j].current);
					}
					if(this.editorWrapper[i].annoTypes[j].normal){
						this.editorWrapper[i].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[i].annoTypes[j].normal);
					}
				}
			}
			
			this._root.children = [];
			var oldDiffBlocks = this.editorWrapper[0].diffFeeder.getDiffBlocks();
			if(!oldDiffBlocks || oldDiffBlocks.length === 0){
				this.replaceAllAnnotations(true, 0, "block", false, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 1, "block", false, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 0, "word", false, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 1, "word", false, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 0, "block", true, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 1, "block", true, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 0, "word", true, []); //$NON-NLS-0$
				this.replaceAllAnnotations(true, 1, "word", true, []); //$NON-NLS-0$
				return;
			}
			var adapter = new mJSDiffAdapter.JSDiffAdapter(ignoreWhitespace);
			for(i = 0; i < oldDiffBlocks.length; i++){
				var diffBlockModel = this.generatePairBlockAnnotations(this._root, i);
				this._root.children.push(diffBlockModel);
				var children = this.generatePairWordAnnotations(diffBlockModel, i, adapter);
				if(children){
					diffBlockModel.children = children;
				}
			}
			this.replaceAllAnnotations(false, 0, "block", true); //$NON-NLS-0$
			this.replaceAllAnnotations(false, 1, "block", true); //$NON-NLS-0$
			this.replaceAllAnnotations(false, 0, "word", true); //$NON-NLS-0$
			this.replaceAllAnnotations(false, 1, "word", true); //$NON-NLS-0$
			this.iterator = new mTreeModelIterator.TreeModelIterator(this._root.children);
		},
		
		replaceAllAnnotations: function(removeExisting, wrapperIndex, wordOrBlock, normal, replacingList){
			if(!this.editorWrapper[wrapperIndex].annoTypes){
				return;
			}
			for(var i = 0; i < this.editorWrapper[wrapperIndex].annoTypes.length; i++){
				if(this.editorWrapper[wrapperIndex].annoTypes[i].type === wordOrBlock){
					this.replaceDiffAnnotations(this.editorWrapper[wrapperIndex].editor, replacingList ? replacingList : this.editorWrapper[wrapperIndex].annoTypes[i].list, 
												normal ? this.editorWrapper[wrapperIndex].annoTypes[i].normal : this.editorWrapper[wrapperIndex].annoTypes[i].current, removeExisting);
				}
			}
		},
		
		getMapper: function(){
			return this.editorWrapper[0].diffFeeder.getMapper();
		},
		
		getFeeder: function(left){
			return left ? this.editorWrapper[1].diffFeeder : this.editorWrapper[0].diffFeeder;
		},
		
		iterateOnBlock: function(forward, roundTrip){
			if(!this.iterator){
				return;
			}
			this.iterator.iterateOnTop(forward, roundTrip);
			this.updateCurrentAnnotation(true);
		},
			
		iterateOnChange: function(forward){
			if(!this.iterator){
				return null;
			}
			var retVal = this.iterator.iterate(forward);
			if(retVal) {
				var cursor = this.iterator.cursor();
				if(cursor.type === "block" && cursor.children && cursor.children.length > 0){ //$NON-NLS-0$
					this.iterator.iterate(forward);
				}
				this.updateCurrentAnnotation(true);
			}
			return retVal;
		},
		
		/**
		 * Goes to the change at the specified changeIndex in the current file.
		 * 
		 * @param[in] changeIndex The index of the desired change in the current file.
		 */
		gotoChangeUsingIndex: function(changeIndex) {
			var count = 0;
			var blockIndex = 0;
			
			if (0 <= changeIndex) {
				// iterate through blocks looking for the one that contains 
				// the change with the specified changeIndex
				while (blockIndex < this._root.children.length) {
					var numChangesInCurrentBlock = this._root.children[blockIndex].children.length;
					if (((count + numChangesInCurrentBlock) - 1) < changeIndex) {
						count += numChangesInCurrentBlock; //keep going
					} else {
						// found block, go to change in block
						var changeIndexInBlock = changeIndex - count;
						return this.gotoBlock(blockIndex, changeIndexInBlock);
					}
					blockIndex++;
				}
			}
		},
		
		gotoBlock: function(blockIndex, changeIndex){
			if(!this.iterator){
				return;
			}
			if(blockIndex < 0 || blockIndex >= this._root.children.length || this._root.children.length === 0){
				blockIndex = 0;
			}
			if(changeIndex !== undefined && changeIndex >= 0 && this._root.children[blockIndex].children && changeIndex < this._root.children[blockIndex].children.length){
				this.iterator.setCursor(this._root.children[blockIndex].children[changeIndex]);
			} else {
				this.iterator.setCursor(this._root.children[blockIndex]);
			}
			this.updateCurrentAnnotation(false);
			this._positionDiffBlock();
		},
		
		_hitDiffAnnotation: function(wrapperIndex, caretPosition, textView){
			if(textView !== this.editorWrapper[wrapperIndex].editor.getTextView()){
				return;
			}
			for(var i = 0; i < this._root.children.length; i++){
				var block = this._root.children[i];
				var blockAnno  = wrapperIndex===0 ? block.oldA : block.newA;
				if(caretPosition >= blockAnno.start && caretPosition <= blockAnno.end){
					var currentHit = block;
					if(block.children && block.children.length > 0){
						for(var j = 0; j < block.children.length; j++){
							var word = block.children[j];
							var wordAnno  = wrapperIndex===0 ? word.oldA : word.newA;
							if(caretPosition >= wordAnno.start && caretPosition <= wordAnno.end){
								currentHit = word;
								break;
							}
						}
					}
					return currentHit;
				}
			}
			return null;
		},
		
		gotoChange: function(caretPosition, textView){
			for(var i = 0; i < this.editorWrapper.length; i++){
				var hit = this._hitDiffAnnotation(i, caretPosition, textView);
				if(hit){
					this.iterator.setCursor(hit);
					this.updateCurrentAnnotation(false, textView);
					return true;
				}
			}
			return false;
		},
		
		getCurrentBlockIndex: function(){
			if(!this.iterator){
				return -1;
			}
			var cursor = this.iterator.cursor();
			if(!cursor) {
				return -1;
			}
			if(cursor.type === "block"){ //$NON-NLS-0$
				return cursor.index;
			} else {
				return cursor.parent.index;
			}
		},
		
		getCurrentPosition: function(){
			if(!this.iterator){
				return {};
			}
			var cursor = this.iterator.cursor();
			if(!cursor){
				return {};
			}
			if(cursor.type === "block"){ //$NON-NLS-0$
				return {block: cursor.index+1};
			} else {
				return {block: cursor.parent.index+1, change: cursor.index+1};
			}
		},
		
		getCurrentMapperIndex: function(){
			var blockIndex = this.getCurrentBlockIndex();
			if(blockIndex < 0){
				blockIndex = 0;
			}
			var diffBlocks = this.getFeeder().getDiffBlocks();
			if(!diffBlocks || diffBlocks.length === 0){
				return -1;
			}
			if(blockIndex > (diffBlocks.length - 1) ){
				blockIndex = 0;
			}
			return diffBlocks[blockIndex][1];
		},
		
		replaceDiffAnnotations: function(editor, overallAnnotations, type, removeExisting){
			if(!overallAnnotations || !type){
				return;
			}
			var annotationModel = editor.getAnnotationModel();
			if(!annotationModel){
				return;
			}
			var iter = annotationModel.getAnnotations();
			var remove = [];
			while (removeExisting && iter.hasNext()) {
				var annotation = iter.next();
				if (annotation.type === type) {
					remove.push(annotation);
				}
			}
			annotationModel.replaceAnnotations(remove, overallAnnotations);
		},
		
		updateCurrentAnnotation: function(moveSelection, textView){
			this.replaceAllAnnotations(true, 0, "block", false, []); //$NON-NLS-0$
			this.replaceAllAnnotations(true, 1, "block", false, []); //$NON-NLS-0$
			this.replaceAllAnnotations(true, 0, "word", false, []); //$NON-NLS-0$
			this.replaceAllAnnotations(true, 1, "word", false, []); //$NON-NLS-0$
			if(!this.iterator){
				return;
			}
			var cursor = this.iterator.cursor();
			if(!cursor){
				return;
			}
			var annoType0, annoType1;
			var annoPosOld = {start: cursor.oldA.start, end: cursor.oldA.end};
			var annoPosNew = {start: cursor.newA.start, end: cursor.newA.end};
			if(cursor.type === "word"){ //$NON-NLS-0$
				annoType0 = this.editorWrapper[0].diffFeeder.getCurrentWordAnnoType(annoPosOld, this.editorWrapper[0].editor.getTextView().getModel());
				annoType1 = this.editorWrapper[1].diffFeeder.getCurrentWordAnnoType(annoPosNew, this.editorWrapper[1].editor.getTextView().getModel());
			} else {
				annoType0 = this.editorWrapper[0].diffFeeder.getCurrentBlockAnnoType(cursor.index);
				annoType1 = this.editorWrapper[1].diffFeeder.getCurrentBlockAnnoType(cursor.index);
			}
			if(annoType0){
				this.replaceDiffAnnotations(this.editorWrapper[0].editor, [new (mAnnotations.AnnotationType.getType(annoType0.current))(annoPosOld.start, annoPosOld.end)], annoType0, true);
			}
			if(annoType1){
				this.replaceDiffAnnotations(this.editorWrapper[1].editor, [new (mAnnotations.AnnotationType.getType(annoType1.current))(annoPosNew.start, annoPosNew.end)], annoType1, true);
			}
			if(moveSelection){
				this.autoSelecting = true;
				this.editorWrapper[0].editor.setSelection(cursor.oldA.start, cursor.oldA.end, true);
				this.editorWrapper[1].editor.setSelection(cursor.newA.start, cursor.newA.end, true);
				this.autoSelecting = false;
			} else if(textView) {
				this.autoSelecting = true;
				if(textView !== this.editorWrapper[0].editor.getTextView()){
					this.editorWrapper[0].editor.setSelection(cursor.oldA.start, cursor.oldA.end, true);
				}
				if(textView !== this.editorWrapper[1].editor.getTextView()){
					this.editorWrapper[1].editor.setSelection(cursor.newA.start, cursor.newA.end, true);
				}
				this.autoSelecting = false;
			}
		},
			
		generatePairBlockAnnotations: function(parentObj, diffBlockIndex){
			var oldBlockAnno = this.generateBlockDiffAnnotations(0, diffBlockIndex);
			var newBlockAnno = this.generateBlockDiffAnnotations(1, diffBlockIndex);
			return {parent: parentObj, index: diffBlockIndex, type: "block", oldA: oldBlockAnno, newA: newBlockAnno}; //$NON-NLS-0$
		},
		
		generatePairWordAnnotations: function(parentObj, diffBlockIndex, jsDiffAdapter){
			var textOld = this.editorWrapper[0].diffFeeder.getTextOnBlock(diffBlockIndex);
			var textNew = this.editorWrapper[1].diffFeeder.getTextOnBlock(diffBlockIndex);
			var charDiffMap = null;
			var startOld = 0;
			var startNew = 0;
			//If either side of the diff block has more than 5000 charactors, the char level diff on the js diff side becomes slow. It will accumulate the latency of comapre widget.
			//Given that a diff block with moret than 5000 charactors has very less meaning of indicating all the char level diff, we are disabling the char diff.
			//Only diff blocks with less than 5000 charactors on both side will get char level diff.
			//See https://bugs.eclipse.org/bugs/show_bug.cgi?id=399500.
			if(textOld && textNew && textOld.text && textNew.text && textOld.text.length <= MAX_CHAR_DIFF_CHARS_PER_BLOCK && textNew.text.length <= MAX_CHAR_DIFF_CHARS_PER_BLOCK){
				charDiffMap = jsDiffAdapter.adaptCharDiff(textOld.text, textNew.text, this._charOrWordDiff === "word"); //$NON-NLS-0$
				startNew = textNew.start;
				startOld = textOld.start;
			} else {
				return null;
			}
			var oldAnnotations = [];
			var newAnnotations = [];
			this.generateWordDiffAnnotations(0, oldAnnotations, startOld, charDiffMap, 2, 3);
			this.generateWordDiffAnnotations(1, newAnnotations, startNew, charDiffMap, 0, 1);
			var pairAnnotations = [];
			for(var i = 0; i < oldAnnotations.length; i++){
				pairAnnotations.push({parent: parentObj, index: i, type: "word", oldA: oldAnnotations[i], newA: newAnnotations[i]}); //$NON-NLS-0$
			} 
			return pairAnnotations;
		},
		
		getAnnoModelList: function(wrapperIndex, wordOrBlock, annoType){
			for(var i = 0; i < this.editorWrapper[wrapperIndex].annoTypes.length; i++){
				if(this.editorWrapper[wrapperIndex].annoTypes[i].type === wordOrBlock &&
				   this.editorWrapper[wrapperIndex].annoTypes[i].normal === annoType){
					return this.editorWrapper[wrapperIndex].annoTypes[i].list;
				}
			}
			return null;
		},
		
		generateBlockDiffAnnotations: function(wrapperIndex, diffBlockIndex){
			var type = this.editorWrapper[wrapperIndex].diffFeeder.getCurrentBlockAnnoType(diffBlockIndex);
			var annoList = this.getAnnoModelList(wrapperIndex, "block", type.normal); //$NON-NLS-0$
			var range = this.editorWrapper[wrapperIndex].diffFeeder.getCharRange(diffBlockIndex);
			var annotation = mAnnotations.AnnotationType.createAnnotation(type.normal, range.start, range.end);
			if(annoList){
				annoList.push(annotation);
			}
			return annotation;
		},
		
		generateWordDiffAnnotations: function(wrapperIndex, diffBlockAnnotaionArray, startIndex, charDiffMap, startColumn, endColumn){
			if(charDiffMap){
				var type = this.editorWrapper[wrapperIndex].diffFeeder.getCurrentWordAnnoType({start: -1, end: -1});
				var annoList = this.getAnnoModelList(wrapperIndex, "word", type.normal); //$NON-NLS-0$
				for(var i = 0; i < charDiffMap.length; i++){
					var start = charDiffMap[i][startColumn] + startIndex;
					var end = charDiffMap[i][endColumn] + startIndex;
					var annotation = mAnnotations.AnnotationType.createAnnotation(type.normal, start, end);
					annoList.push(annotation);
					diffBlockAnnotaionArray.push(annotation);
				}
			}
		},
		
		/* Navigation APIs */
		_updateOverviewRuler: function(){
			if(this._overviewRuler){
				var drawLine = this.editorWrapper[0].editor.getTextView().getTopIndex() ;
				this.editorWrapper[0].editor.getTextView().redrawLines(drawLine , drawLine+  1 , this._overviewRuler);
			}
		},
		
		_updateCurveRuler: function(){
			if(this._curveRuler){
				this._curveRuler.render();
			}
		},
		
		_setTextViewPosition: function (textView , lineIndex){
			var lineHeight = textView.getLineHeight();
			var clientArea = textView.getClientArea();
			var lines = Math.floor(clientArea.height / lineHeight/3);
			textView.setTopIndex((lineIndex - lines) > 0 ? lineIndex - lines : 0);
		},

		_positionDiffBlock: function(){
			var blockIndex = this.getCurrentBlockIndex();
			if(blockIndex < 0){
				blockIndex = 0;
			}
			var diffBlocks = this.getFeeder().getDiffBlocks();
			if(diffBlocks.length === 0) {
				return;
			}
			this._setTextViewPosition(this.editorWrapper[0].editor.getTextView() , diffBlocks[blockIndex][0]);
			if(this.editorWrapper[0].editor !== this.editorWrapper[1].editor){
				var lineIndexL = mCompareUtils.lookUpLineIndex(this.getMapper(), 0, diffBlocks[blockIndex][1]);
				this._setTextViewPosition(this.editorWrapper[1].editor.getTextView() , lineIndexL);
			}
			this._updateOverviewRuler();
			this._updateCurveRuler();
		},
		
		matchPositionFromOverview: function(lineIndex){
			if(!this._initialized){
				return;
			}
			var diffblockIndex;
			if(lineIndex < 0){
				diffblockIndex = 0;
			} else {
				diffblockIndex = mCompareUtils.getAnnotationIndex(this.getFeeder().getDiffBlocks(), lineIndex);
			}
			this.gotoBlock(diffblockIndex);
		},
		
		gotoDiff: function(caretPosition, textView){
			if(this.gotoChange(caretPosition, textView)){
				this._updateOverviewRuler();
				this._updateCurveRuler();
			}
		},

		nextDiff: function(){
			this.iterateOnBlock(true, true);
			this._positionDiffBlock();
		},
		
		prevDiff: function(){
			this.iterateOnBlock(false, true);
			this._positionDiffBlock();
		},
		
		nextChange: function(){
			var ret = this.iterateOnChange(true);
			this._positionDiffBlock();
			return ret;
		},
		
		prevChange: function(){
			this.iterateOnChange(false);
			this._positionDiffBlock();
		}
	};
	return DiffTreeNavigator;
}());

exports.DiffBlockFeeder = (function() {
	/**
	 * Creates a new generic diff block feeder
	 * Each item in the feeder is represented by a pair of number [lineIndexOfTheTextModel, correspondingMapperIndex]. 
	 *
	 * @name orion.DiffTreeNavigator.TwoWayDiffBlockFeeder
	 * @class A feeder to feed all the diff blocks based on the line index and mapper index.
	 * @param {orion.editor.TextModel} The text model of the whole text.
	 * @param {array} The mapper generated from the unified diff.
	 * @param {integer} The column index where the line index can be calculated.
	 */
	function DiffBlockFeeder() {
	}
	
	DiffBlockFeeder.prototype = /** @lends orion.DiffTreeNavigator.TwoWayDiffBlockFeeder.prototype */ {
		
		_isAddedSide: function(){
			return this._mapperColumnIndex === 0;
		},
				
		getWordAnnoTypes: function(result){
			if(this._isAddedSide()){
				result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_WORD, normal: DiffAnnoTypes.ANNO_DIFF_ADDED_WORD, list: []}); //$NON-NLS-0$
			} else {
				result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_WORD, normal: DiffAnnoTypes.ANNO_DIFF_DELETED_WORD, list: []}); //$NON-NLS-0$
			}
			result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT}); //$NON-NLS-0$
			result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}); //$NON-NLS-0$
			result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT}); //$NON-NLS-0$
			result.push({type: "word", current: DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT}); //$NON-NLS-0$
		},
 
		getCurrentWordAnnoType: function(annoPosition, textModel){
			if(annoPosition.start === annoPosition.end && textModel){
				if(this._isAddedSide()){
					return {current: this._repositionEmptyWord(annoPosition, textModel), normal: DiffAnnoTypes.ANNO_DIFF_ADDED_WORD};
				} else {
					return {current: this._repositionEmptyWord(annoPosition, textModel), normal: DiffAnnoTypes.ANNO_DIFF_DELETED_WORD};
				}
			} else {
				if(this._isAddedSide()){
					return {current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_WORD, normal: DiffAnnoTypes.ANNO_DIFF_ADDED_WORD};
				} else {
					return {current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_WORD, normal: DiffAnnoTypes.ANNO_DIFF_DELETED_WORD};
				}
			}
		},
		
		_repositionEmptyWord: function(annoPosition, textModel){
			var lineIndex = textModel.getLineAtOffset(annoPosition.start);
			var lineStart = textModel.getLineStart(lineIndex);
			var lineEnd = textModel.getLineEnd(lineIndex);
			if(lineStart !== lineEnd){
				if(annoPosition.start === lineEnd){
					annoPosition.start--;
					return this._isAddedSide() ? DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT : DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT;
				}
				annoPosition.end++;
				return this._isAddedSide() ? DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT : DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT;
			} else if (lineIndex > 0){
				lineIndex--;
				lineStart = textModel.getLineStart(lineIndex);
				lineEnd = textModel.getLineEnd(lineIndex);
				if(lineStart !== lineEnd){
					annoPosition.start = lineEnd -1;
					annoPosition.end = lineEnd;
					return this._isAddedSide() ? DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT : DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT;
				}
			}
			return this._isAddedSide() ? DiffAnnoTypes.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT : DiffAnnoTypes.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT;
		},
		
		getMapper: function(){
			return this._mapper;
		},
		
		getDiffBlocks: function(){
			return this._diffBlocks;
		},
		
		getDiffBlockH: function(diffBlockIndex){
			if(!this._diffBlocks || this._diffBlocks.length === 0){
				return -1;
			}
			var mapperIndex = this._diffBlocks[diffBlockIndex][1];
			return (mapperIndex === -1) ? 0 :this._mapper[mapperIndex][this._mapperColumnIndex];
		},
		
		getOverviewLineCount: function(){
			return this._textModel.getLineCount();
		},
		
		getLineNumber: function(lineIndex){
			return lineIndex;
		},
		
		getCharRange: function(blockIndex){
			if(!this._diffBlocks || this._diffBlocks.length === 0){
				return null;
			}
			var mapperIndex = this._diffBlocks[blockIndex][1];
			var startLine = this._diffBlocks[blockIndex][0];
			var endLine = startLine + this._mapper[mapperIndex][this._mapperColumnIndex] -1;
			var startIndex = this._textModel.getLineStart(startLine);
			if(endLine < startLine){
				return {start: startIndex, end: startIndex};
			}
			var endIndex = this._textModel.getLineEnd(endLine, true);
			return {start: startIndex, end: endIndex};
		},
		
		getTextOnBlock: function(blockIndex){
			if(!this._diffBlocks || this._diffBlocks.length === 0){
				return null;
			}
			var mapperIndex = this._diffBlocks[blockIndex][1];
			if(this._mapper[mapperIndex][0] === 0 || this._mapper[mapperIndex][1] === 0 || this._mapper[mapperIndex][2] === 0){
				//return null;
			}
			var charRange = this.getCharRange(blockIndex);
			return {start: charRange.start, text: this._textModel.getText(charRange.start, charRange.end)};
		},

		isMapperEmpty: function(){
			return this._mapper.length === 0;
		}
	};
	return DiffBlockFeeder;
}());

exports.TwoWayDiffBlockFeeder = (function() {
	/**
	 * Creates a new diff block feeder of one side of the two way compare widget.
	 * Each item in the feeder is represented by a pair of number [lineIndexOfTheTextModel, correspondingMapperIndex]. 
	 *
	 * @name orion.DiffTreeNavigator.TwoWayDiffBlockFeeder
	 * @class A feeder to feed all the diff blocks based on the line index and mapper index.
	 * @param {orion.editor.TextModel} The text model of the whole text.
	 * @param {array} The mapper generated from the unified diff.
	 * @param {integer} The column index where the line index can be calculated.
	 * @param {Boolean} reverseAnnotation Normally the left hand side fo the compare is annotated as geen and the right hand side uses red.
	 *        If this flag is true, we use green annotations on the right and red on the left.
	 */
	function TwoWayDiffBlockFeeder(model, mapper, mapperColumnIndex, reverseAnnotation) {
	    this._mapperColumnIndex = mapperColumnIndex;
	    this._reverseAnnotation = reverseAnnotation;
	    this.init(model, mapper);
	}
	TwoWayDiffBlockFeeder.prototype = new exports.DiffBlockFeeder(); 
	TwoWayDiffBlockFeeder.prototype._isAddedSide = function(){
		return (this._reverseAnnotation ? this._mapperColumnIndex !== 0 : this._mapperColumnIndex === 0);
	};
	TwoWayDiffBlockFeeder.prototype.init = function(model, mapper){
	    this._textModel = model;
		this._diffBlocks = undefined;
		if(mapper){
			this._mapper = mapper;
			this._diffBlocks = [];
			var curLineindex = 0;//zero based
			for (var i = 0 ; i < this._mapper.length ; i++){
				if((this._mapper[i][2] !== 0)){
					this._diffBlocks.push([curLineindex , i]);
				}
				curLineindex += this._mapper[i][this._mapperColumnIndex];
			}
		}
	};
	TwoWayDiffBlockFeeder.prototype.getBlockAnnoTypes = function(result){
		if(this._isAddedSide()){
			result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK, list: []}); //$NON-NLS-0$
		} else {
			result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK, list: []}); //$NON-NLS-0$
		}
		result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY, list: []}); //$NON-NLS-0$
		result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT, list: []}); //$NON-NLS-0$
	};
	TwoWayDiffBlockFeeder.prototype.getCurrentBlockAnnoType = function(diffBlockIndex){
		if(!this._diffBlocks || this._diffBlocks.length === 0 || this._diffBlocks.length <= diffBlockIndex){
			return null;
		}
		var mapperIndex = this._diffBlocks[diffBlockIndex][1];
		if(this._mapper[mapperIndex][this._mapperColumnIndex] === 0){
			return {normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY};
		} else if(mCompareUtils.isMapperConflict(this.getMapper(), mapperIndex)){
			return {normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT};
		} else if(this._isAddedSide()){
			return {type: "block", normal: DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK, list: []}; //$NON-NLS-0$
		} 
		return {type: "block", normal: DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK, list: []}; //$NON-NLS-0$
	};
	return TwoWayDiffBlockFeeder;
}());

exports.inlineDiffBlockFeeder = (function() {
	/**
	 * Creates a new diff block feeder of one side of the two way compare widget.
	 * Each item in the feeder is represented by a pair of number [lineIndexOfTheTextModel, correspondingMapperIndex]. 
	 *
	 * @name orion.DiffTreeNavigator.inlineDiffBlockFeeder
	 * @class A feeder to feed all the diff blocks based on the line index and mapper index.
	 * @param {orion.editor.TextModel} The text model of the whole text.
	 * @param {array} The mapper generated from the unified diff.
	 * @param {integer} The column index where the line index can be calculated.
	 */
	function inlineDiffBlockFeeder(mapper, mapperColumnIndex) {
	    this._mapperColumnIndex = mapperColumnIndex;
	    this.init(mapper);
	}
	inlineDiffBlockFeeder.prototype = new exports.DiffBlockFeeder(); 
	inlineDiffBlockFeeder.prototype.setModel = function(model){
	    this._textModel = model;
	};
	inlineDiffBlockFeeder.prototype.init = function( mapper){
		this._diffBlocks = undefined;
		if(mapper){
			this._mapper = mapper;
			this._diffBlocks = [];
			this._gapBlocks = [];
			var curLineindex = 0;//zero based
			var curGapLineindex = 0;//zero based
			for (var i = 0 ; i < this._mapper.length ; i++){
				if((this._mapper[i][2] !== 0)){
					if(this._isAddedSide()){//adding block
						var startLineIndex = curLineindex + this._mapper[i][1];
						this._diffBlocks.push([startLineIndex , i]);
						this._gapBlocks.push([startLineIndex , startLineIndex + this._mapper[i][0], curGapLineindex]);
					} else {
						this._diffBlocks.push([curLineindex, i]);
						this._gapBlocks.push([curLineindex, curLineindex + this._mapper[i][1], curGapLineindex]);
					}
					curLineindex += this._mapper[i][0] +  this._mapper[i][1];
				} else {
					this._gapBlocks.push([curLineindex, curLineindex + this._mapper[i][this._mapperColumnIndex], curGapLineindex]);
					curLineindex += this._mapper[i][this._mapperColumnIndex];
				}
				curGapLineindex += this._mapper[i][this._mapperColumnIndex];
			}
		}
	};
	inlineDiffBlockFeeder.prototype.getBlockAnnoTypes = function(result){
		if(this._isAddedSide()){
			result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK, list: []}); //$NON-NLS-0$
		} else {
			result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK, list: []}); //$NON-NLS-0$
		}
		//We do not want to show the empty line annotation i ninline compare
		//result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY, list: []});
		result.push({type: "block", normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT, list: []}); //$NON-NLS-0$
	};
	inlineDiffBlockFeeder.prototype.getCurrentBlockAnnoType = function(diffBlockIndex){
		if(!this._diffBlocks || this._diffBlocks.length === 0){
			return null;
		}
		var mapperIndex = this._diffBlocks[diffBlockIndex][1];
		if(this._mapper[mapperIndex][this._mapperColumnIndex] === 0){
			//We do not want to show the empty line annotation i ninline compare
			//return {normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_TOPONLY, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_TOPONLY};
			return({current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_WORD, normal: DiffAnnoTypes.ANNO_DIFF_ADDED_WORD});
		} else if(mCompareUtils.isMapperConflict(this.getMapper(), mapperIndex)){
			return {normal: DiffAnnoTypes.ANNO_DIFF_BLOCK_CONFLICT, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_BLOCK_CONFLICT};
		} else if(this._isAddedSide()){
			return {type: "block", normal: DiffAnnoTypes.ANNO_DIFF_ADDED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_ADDED_BLOCK, list: []}; //$NON-NLS-0$
		} 
		return {type: "block", normal: DiffAnnoTypes.ANNO_DIFF_DELETED_BLOCK, current: DiffAnnoTypes.ANNO_DIFF_CURRENT_DELETED_BLOCK, list: []}; //$NON-NLS-0$
	};
	inlineDiffBlockFeeder.prototype.getDiffBlockH = function(diffBlockIndex){
		if(!this._diffBlocks || this._diffBlocks.length === 0){
			return -1;
		}
		var mapperIndex = this._diffBlocks[diffBlockIndex][1];
		return this._mapper[mapperIndex][0] + this._mapper[mapperIndex][1];
	};
	inlineDiffBlockFeeder.prototype.getLineNumber = function(lineIndex){
		for(var i = 0; i < this._gapBlocks.length; i++){
			if(this._gapBlocks[i][0] !== this._gapBlocks[i][1]){
				if(lineIndex >= this._gapBlocks[i][0] && lineIndex < this._gapBlocks[i][1]){
					var delta = lineIndex - this._gapBlocks[i][0];
					return delta + this._gapBlocks[i][2];
				}
			}
		}
		return -1;
	};
	return inlineDiffBlockFeeder;
}());

return exports;
});

    /*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/compare/compareView',['i18n!orion/compare/nls/messages',
		'orion/Deferred',
		'orion/EventTarget',
		'orion/webui/littlelib',
		'orion/compare/diffParser',
		'orion/compare/compareRulers',
        'orion/editor/editor',
        'orion/editor/editorFeatures',
        'orion/keyBinding',
        'orion/editor/textView',
        'orion/compare/compareUIFactory',
        'orion/compare/compareUtils',
        'orion/compare/jsdiffAdapter',
        'orion/compare/diffTreeNavigator'],
function(messages, Deferred, mEventTarget, lib, mDiffParser, mCompareRulers, mEditor, mEditorFeatures, mKeyBinding, mTextView,
		 mCompareUIFactory, mCompareUtils, mJSDiffAdapter, mDiffTreeNavigator,  mTextMateStyler, mHtmlGrammar, mTextStyler) {
var exports = {};
/**
 * @class An abstract comapre view class that holds all the common functions for both "side by side" and "unified" view.
 * <p>
 * <b>See:</b><br/>
 * {@link orion.compare.TwoWayCompareView}<br/>
 * {@link orion.compare.InlineCompareView}
 * </p>		 
 * @name orion.compare.CompareView
 */
exports.CompareView = (function() {
	function CompareView () {
		mEventTarget.attach(this);
		this._diffParser = new mDiffParser.DiffParser();
	}
	CompareView.prototype = {
		/** @private */
		_clearOptions: function(){
			this.options = {};
			this.options.blockNumber = 1;
			this.options.changeNumber = 0;
		},
		/** @private */
		_disableAnnoBookMark: function(editors){
			editors.forEach(function(editor) {
				var ruler = editor.getAnnotationRuler();
				if(ruler) {
					ruler.onDblClick = function(/*lineIndex, e*/) {};
				}
			});
		},
		/** @private */
		_getLineDelim: function(input , diff){	
			var delim = "\n"; //$NON-NLS-0$
			return delim;
		},
		/** @private */
		_generateMapper: function(forceGenerate, input, output, diff , detectConflicts ,doNotBuildNewFile){
			var delim = this._getLineDelim(input , diff);
			this._diffParser.setLineDelim(delim);
			if(this.options.mapper && this.options.toggler && !forceGenerate){
				return {delim:delim , mapper:this.options.mapper, output: this.options.newFile.Content, diffArray:this.options.diffArray};
			}
			if(!diff && typeof output === "string" && typeof input === "string"){ //$NON-NLS-1$ //$NON-NLS-0$
				var adapter = new mJSDiffAdapter.JSDiffAdapter(this.isWhitespaceIgnored());
				var maps = adapter.adapt(input, output, delim);
				if(this.options.toggler){
					this.options.mapper = maps.mapper;
					this.options.newFile.Content = output;
					this.options.diffArray = maps.changContents;
				}
				return {delim:delim , mapper:maps.mapper, output: output, diffArray:maps.changContents};
			} else {
				var result = this._diffParser.parse(input, diff, detectConflicts ,true/*doNotBuildNewFile*/);
				var diffArray = this._diffParser.getDiffArray();
				if(this.options.toggler){
					this.options.mapper = result.mapper;
					this.options.newFile.Content = output/*result.outPutFile*/;
					this.options.diffArray = diffArray;
				}
				return {delim:delim , mapper:result.mapper, output: output/*result.outPutFile*/, diffArray:diffArray};
			}
		},
		/** @private */
		_loadImageFile: function(imageURL, parentDiv, createSeparator){
			var image = document.createElement("img"); //$NON-NLS-0$
			image.src = imageURL;
			var deferred = new Deferred();
			image.onload = function(){
				parentDiv.appendChild(image);
				if(createSeparator) {
					var hr = document.createElement("hr"); //$NON-NLS-0$
					parentDiv.appendChild(hr);
				}
				deferred.resolve(image.height);
			};
			image.onerror = function(){
				deferred.resolve(0);
			};
			return deferred;
		},
		/** @private */
		_initSyntaxHighlighter: function(targetArray){
			this._syntaxHighlighters = null;
			if(this.options.highlighters && this.options.highlighters.length > 0){
				if(targetArray.length < 1 || targetArray.length > 2){
					return;
				}
				this._syntaxHighlighters = [{highlighter: this.options.highlighters[0], target: targetArray[0]}];
				if(targetArray.length === 2 && this.options.highlighters.length === 2){
					this._syntaxHighlighters.push({highlighter: this.options.highlighters[1], target: targetArray[1]});
				}
			}
		},
		/** @private */
		_highlightSyntax: function(){
			if(this._syntaxHighlighters){//If syntax highlighter is used, we need to render all the diff annotations after syntax highlighting is done
		        var promises = [];
				this._syntaxHighlighters.forEach(function(wrapper) {
					promises.push(wrapper.highlighter.highlight(wrapper.target.fileName, wrapper.target.contentType, wrapper.target.editor));
				}.bind(this));
				Deferred.all(promises, function(error) { return {_error: error}; }).then(function(promises){
					this._diffNavigator.renderAnnotations(this.isWhitespaceIgnored());
					this._diffNavigator.gotoBlock(this.options.blockNumber-1, this.options.changeNumber-1);
					this.dispatchEvent({type: "contentLoaded"});
					if(this.options.toggler) {
						this.options.toggler.dispatchEvent({type: "contentLoaded"});
					}
				}.bind(this));
			} else {//render all the diff annotations directly
				window.setTimeout(function () {
					this._diffNavigator.renderAnnotations(this.isWhitespaceIgnored());
					this._diffNavigator.gotoBlock(this.options.blockNumber-1, this.options.changeNumber-1);
					this.dispatchEvent({type: "contentLoaded"});
					if(this.options.toggler) {
						this.options.toggler.dispatchEvent({type: "contentLoaded"});
					}
				}.bind(this), 50);
			}
		},
		
		isWhitespaceIgnored: function() {
			return this.getWidget().options.ignoreWhitespace;
		},
		
		ignoreWhitespace: function(ignore) {
			var options = this.getWidget().options;
			options.ignoreWhitespace = ignore;
			if(options.diffProvider && options.diffContent) {
				var ignoreWS = ignore ? "true" : "false";
				options.diffProvider._diffProvider.getDiffContent(options.resource, {ignoreWS: ignoreWS}).then(function(jsonData) {
					if (options.hasConflicts) {
						options.diffContent = jsonData.split("diff --git")[1]; //$NON-NLS-0$
					} else {
						options.diffContent = jsonData;
					}
					this.getWidget().refresh(true, true);
				}.bind(this), function(){});
			} else {
				this.getWidget().refresh(true, true);
			}
		},
		
		/**
		 * @class This object describes options of a file. Two instances of this object construct the core parameters of a compare view. 
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.compare.CompareView}<br/>
		 * {@link orion.compare.CompareViewOptions}
		 * </p>		 
		 * @name orion.compare.FileOptions
		 *
		 * @property {String} Content the text contents of the file unit. Requied.
		 * @property {Boolean} [readonly=true] whether or not the file is in readonly mode. Optional.
		 * @property {String} Name the file name. Optional but required if the compare view has to show file title.
		 * @property {orion.core.ContentType} Type the type of the file. Optional but required if the compare view has to highlight the syntax.
		 */
		/**
		 * @class This object describes the options for a compare view.
		 * <p>
		 * <b>See:</b><br/>
		 * {@link orion.compare.FileOptions}<br/>
		 * {@link orion.compare.CompareView}<br/>
		 * {@link orion.compare.CompareView#setOptions}
		 * {@link orion.compare.CompareView#getOptions}	 
		 * </p>		 
		 * @name orion.compare.CompareViewOptions
		 *
		 * @property {String} parentDivID Required. the parent element id for the compare view. Required. The parentDivID is required to prefix the ids of sub components in case of side by side view.
		 * @property {orion.compare.FileOptions} [oldFile] Required. the options of the file that is original. Required. In the two way compare case, this file is dispalyed on the left hand side.
		 * @property {orion.compare.FileOptions} [newFile] Required. the options of the file that is compared against the original. Required. In the two way compare case, this file is dispalyed on the right hand side.
		 * @property {String} [diffContent] Optional. the unified diff against the original/old file. If this option is defined, the newFile option is ignored or becomes optional.
		 * @property {Boolean} [showTitle=false] Optional. whether or not to show the two file names on each side of the compare view.
		 * @property {Boolean} [showLineStatus=false] Optional. whether or not to show the current line and column number fo the caret on each side of the view. Not avaible for inline/unified compare view.
		 * @property {orion.compare.CompareCommandFactory} [commandProvider] Optional. If defined it will render all the commands that the compare view requires.
		 * @property {Array} [highlighters] Optional. An array of two instances of {@link orion.compare.CompareSyntaxHighlighter}. If defined the highlighters are used to highlight the syntax of both side of the comapre view, respectively.
		 */
		setOptions: function(options, clearExisting){
			if(clearExisting){
				this._clearOptions();
			}
			if(!this.options) {
				this.options = {};
			}
			if(options) {
				Object.keys(options).forEach(function(option) {
					this.options[option] = options[option];
				}.bind(this));
			}
			//TODO : improve this the twoway comapre API
			if(options.newFileOnRight){
				var optNewFile = this.options.newFile;
				this.options.newFile = this.options.oldFile;
				this.options.oldFile = optNewFile;
			}
		},
		getOptions: function() {
			return this.options;
		},
		/**
		 * Returns the 1-based {blockNumber, changeNumber} current diff location. 
		 * <p>
		 * If 0 is returned on the chnageNumber, it means the whole diff block is highlighted.
		 * </p>
		 * @returns {Object} the 1-based {blockNumber, changeNumber} current diff location.
		 */
		getCurrentDiffPos: function(){	
			return this._diffNavigator.getCurrentPosition();
		},
		/**
		 * Initialize the diff navigation to the starting position. 
		 * <p>
		 * Calling this function resets the "current diff block" to the first diff block in the compare view. 
		 * If there are multiple changes in the diff block, the first change will be highlighted in a darker color. Otherwise the whole diff block will be highlighted in a darker color.
		 * </p>
		 */
		initDiffNav: function(){
			this._diffNavigator.gotoBlock(0, 0);
		},
		/**
		 * Navigate from the current "diff block" to the next one. Also sets the next one as the current diff block after the function call.
		 * <p>
		 * This function will circulate the "diff block" level of navigation, which means if the current block is the last one then it will go to the first one after the function call.
		 * It also highlights the whole diff block in a darker color.
		 * </p>
		 */
		nextDiff: function(){	
			this._diffNavigator.nextDiff();
		},
		/**
		 * Navigate from the current "diff block" to the previous one. Also sets the previous one as the current diff block after the function call.
		 * <p>
		 * This function will circulate the "diff block" level of navigation, which means if the current block is the first one then it will go to the last one after the function call.
		 * It also highlights the whole diff block in a darker color.
		 * </p>
		 */
		prevDiff: function(){	
			this._diffNavigator.prevDiff();
		},
		/**
		 * Navigate from the current "diff change" to the next "diff change". Also sets the next one as the current diff change after the function call.
		 * <p>
		 * Continously calling this function will walk forward all the word level changes in all the diff blocks. 
		 * If it hits the last change in a diff block, it will go to the next diff block at the first change.
		 * If it hits the last change in the last diff block, it will do nothing.
		 * It also highlights the current diff change in a darker color.
		 * </p>
		 */
		nextChange: function(){	
			return this._diffNavigator.nextChange();
		},
		/**
		 * Navigate from the current "diff change" to the previous "diff change". Also sets the previous one as the current diff change after the function call.
		 * <p>
		 * Continously calling this function will walk backward all the word level changes in all the diff blocks. 
		 * If it hits the first change in a diff block, it will go to the previous diff block at the last change.
		 * If it hits the first change in the first diff block, it will do nothing.
		 * It also highlights the current diff change in a darker color.
		 * </p>
		 */
		prevChange: function(){	
			this._diffNavigator.prevChange();
		},
		/**
		 * A helper function to allow the consumer of compareView to get the widget instance easily.
		 */
		getWidget: function() {
			return this;
		},
		/**
		 * A helper function to start the UI after a subclass instance is constructed.
		 */
		startup: function(){
			this.initEditors();
			this.refresh(true);
		},
		/**
		 * An abstract function that should be overridden by a subclass.
		 * <p>
		 * The subclass implementation, inline or twoWay, should create the text editor instances with an initial string or just leave it empty.
		 * </p>
		 * @param {String} initString the initial string that will dispaly when the editors are created. Optional.
		 */
		initEditors: function(initString){
		},
		/**
		 * An abstract function that should be overridden by a subclass.
		 * <p>
		 * The subclass implementation, inline or twoWay, should destroy the text editor instances.
		 * </p>
		 * @param {String} initString the initial string that will dispaly when the editors are created. Optional.
		 */
		initImageMode: function(){
		}
	};
	return CompareView;
}());

/**
 * Constructs a side by side compare view.
 * 
 * @param {orion.compare.CompareViewOptions} options the compare view options.
 * 
 * @class A TwoWayCompareView is a side by side view of two files with diff annotations and navigations.
 * @name orion.compare.TwoWayCompareView
 */
exports.TwoWayCompareView = (function() {
	function TwoWayCompareView(options) {
		exports.CompareView.call(this, options);

		this.setOptions(options, true);
		//Init the diff navigator that controls the navigation on both block and word level.
		this._diffNavigator = new mDiffTreeNavigator.DiffTreeNavigator("word"); //$NON-NLS-0$
		this.type = "twoWay"; //$NON-NLS-0$
		
		//Build the compare view UI by the UI factory
		this._uiFactory = this.options.uiFactory;
		if(!this._uiFactory){
			this._uiFactory = new mCompareUIFactory.TwoWayCompareUIFactory({
				parentDivID: this.options.parentDivId,
				showTitle: (this.options.showTitle ? this.options.showTitle : false),
				showLineStatus: (this.options.showLineStatus ? this.options.showLineStatus : false)
			});
			this._uiFactory.buildUI();
		}
		
		this._viewLoadedCounter = 0;
		if(this.options.commandProvider){
			this.options.commandProvider.initCommands(this);
		}
		this._curveRuler = new mCompareRulers.CompareCurveRuler(this._uiFactory.getDiffCanvasDiv());
	}
	TwoWayCompareView.prototype = Object.create(exports.CompareView.prototype);
	
	TwoWayCompareView.prototype.initEditors = function(initString){
		if(this.options.preCreate) {
			this.options.preCreate();
		}
		this._editors = [];//this._editors[0] represents the right side editor. this._editors[1] represents the left side editor
		//Create editor on the right side
		this._editors.push(this._createEditor(initString, this._uiFactory.getEditorParentDiv(false), this._uiFactory.getStatusDiv(false), this.options.oldFile));
		//Create editor on the left side
		this._editors.push(this._createEditor(initString, this._uiFactory.getEditorParentDiv(true), this._uiFactory.getStatusDiv(true), this.options.newFile, true));
		//Create the overview ruler
		this._overviewRuler  = new mCompareRulers.CompareOverviewRuler("right", {styleClass: "ruler overview"} , null, //$NON-NLS-1$ //$NON-NLS-0$
                function(lineIndex, ruler){this._diffNavigator.matchPositionFromOverview(lineIndex);}.bind(this));
		//If either editor is dirty, popup the warning message.
		if(this.options.postCreate) {
			this.options.postCreate();
		}
		window.onbeforeunload = function() {
			if(this.isDirty()) {
				return messages["There are unsaved changes."];
			}
		}.bind(this);
	};
	
	TwoWayCompareView.prototype.disableAnnoBookMark = function(){
		this._disableAnnoBookMark(this._editors);
	};
	
	TwoWayCompareView.prototype.initImageMode = function(){
		if(this._editors){
			this._editors.forEach(function(editor) {
				editor.destroy();
			});
			this._editors = null;
		}
		this._uiFactory.getEditorParentDiv(true).classList.add("compareEditorParentImageMode"); //$NON-NLS-0$
		this._uiFactory.getEditorParentDiv().classList.add("compareEditorParentImageMode"); //$NON-NLS-0$
		this._uiFactory.disableTitle();
		this._uiFactory.disableLineStatus();
		this._imageMode = true;
	};
	
	TwoWayCompareView.prototype.getImageMode = function(){
		return this._imageMode;
	};
	
	TwoWayCompareView.prototype.getEditors = function(){
		return this._editors;
	};
	
	TwoWayCompareView.prototype.gotoDiff = function(lineNumber, offsetInTheLine, updateLeft){
		var textView = updateLeft ? this._editors[1].getTextView() : this._editors[0].getTextView();
		var offset = textView.getModel().getLineStart(lineNumber) + offsetInTheLine;
		this._diffNavigator.gotoDiff(offset, textView);
	};

	TwoWayCompareView.prototype.copyToLeft = function(){	
		this._curveRuler.copyTo(true);
	};
	
	TwoWayCompareView.prototype.copyToRight = function(){	
		this._curveRuler.copyTo(false);
	};
	
	TwoWayCompareView.prototype.resizeEditors = function(){	
		this._editors.forEach(function(editor) {
			editor.getTextView().resize();
		});
	};
	
	TwoWayCompareView.prototype.getSplitter = function(){	
		return this._uiFactory.getSplitter();
	};
	
	TwoWayCompareView.prototype._createEditor = function(initString, parentDiv, statusDiv, fileOptions, isLeft){
		//Create text view factory
		var readonly = (typeof fileOptions.readonly === "undefined") ? true : fileOptions.readonly; //$NON-NLS-0$
		var textViewFactory = function() {
			var view = new mTextView.TextView({
				parent: parentDiv,
				readonly: readonly,
				tabSize: 4
			});
			this._viewLoadedCounter++;
			if(this._viewLoadedCounter === 2){				
				this._diffNavigator.matchPositionFromOverview(-1);
			}
			if(this.onLoad){
				this.onLoad();
			}
			//We need to add the resize listener here to hadle the vertical splitter moves
			var splitter = this.getSplitter();
			if(splitter){
				splitter.addResizeListener(function(node){
					if(node){
						var doResize = false;
						if (this._uiFactory.isLeftPane(node) ) {
							doResize = isLeft;
						} else {
							doResize = !isLeft;
						}
						if(doResize){
							view.resize();
						}
					}
				}.bind(this));
			}
			return view;
		}.bind(this);
		
		var keyBindingFactory = fileOptions.keyBindingFactory;
		//Create keybindings factory
		if(!keyBindingFactory) {
			keyBindingFactory = new mEditorFeatures.KeyBindingsFactory();
		}

		//Create the status reporter if needed
		var statusReporter = null;
		if(statusDiv) {
			var dirtyIndicator = "";
			var status = "";
			statusReporter = function(message, isError) {
				if(!statusDiv) {
					return;
				}
				if (isError) {
					status =  messages["ERROR: "] + message;
				} else {
					status = message;
				}
				statusDiv.textContent = dirtyIndicator +  status;
			};
		}
		
		//Create the editor
		var editor = new mEditor.Editor({
			textViewFactory: textViewFactory,
			undoStackFactory: new mEditorFeatures.UndoFactory(),
			annotationFactory: new mEditorFeatures.AnnotationFactory(),
			keyBindingFactory: keyBindingFactory, 
			statusReporter: statusReporter,
			domNode: parentDiv
		});
				
		editor.installTextView();
		editor.setInput(null, null, fileOptions.Content ? fileOptions.Content : initString);
		editor.setOverviewRulerVisible(false);
			
		var textView = editor.getTextView();
		
		//Navigate to the proper diff block or diff word if editor's selection or caret hits a diff
		textView.addEventListener("Selection", function(evt){ //$NON-NLS-0$
			var selections = Array.isArray(evt.newValue) ? evt.newValue : [evt.newValue];
			if(selections.length > 1 || !selections[0].isEmpty()){
				return;
			}
			if(this._diffNavigator.autoSelecting || !this._diffNavigator.editorWrapper[0].diffFeeder){
				return;
			}
			this._diffNavigator.gotoDiff(selections[0].getCaret(), textView);
		}.bind(this)); 
		
		//If left editor's contents changes, we refesh the curver renderer to match new diff
		textView.getModel().addEventListener("Changed", function(e){ //$NON-NLS-0$
			if(!this._curveRuler.onChanged(e, !isLeft)) {
				this.options.mapper = null;
			}
		}.bind(this));
		if(isLeft){
			//If left editor scrolls, we scroll right editor to the appropriate position to match the diffs
			textView.addEventListener("Scroll", function(scrollEvent){ //$NON-NLS-0$
				if(this._curveRuler){
					this._curveRuler.matchPositionFrom(true);
					this._curveRuler.render();
				}
				if(this.onScroll){
					this.onScroll();
				}
			}.bind(this)); 
		} else {
			//If right editor scrolls, we only re-render the curve
			textView.addEventListener("Scroll", function(scrollEvent){ //$NON-NLS-0$
				if(this._curveRuler){
					this._curveRuler.render();
				}
			}.bind(this)); 
		}
		return editor;
	};

	TwoWayCompareView.prototype.isDirty = function(){
		if(this._editors){
			return this._editors.some(function(editor) {
				return editor.isDirty();
			});
		}
		return false;
	};
	
	TwoWayCompareView.prototype._destroy = function(){
		if(this._editors){
			this._diffNavigator.destroy();
			this._editors.forEach(function(editor) {
				editor.destroy();
			});
			this._uiFactory.destroy();
		}
	};
	
	TwoWayCompareView.prototype.destroy = function(){
		this._destroyed = true;
		this._destroy();		
	};

	TwoWayCompareView.prototype.addRulers = function(){
		if(this._editors && !this._hasRuler){
			var lRuler = new mCompareRulers.LineNumberCompareRuler(this._diffNavigator, 0, "left", {styleClass: "ruler lines"}, {styleClass: "rulerLines odd"}, {styleClass: "rulerLines even"}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			var rRuler = new mCompareRulers.LineNumberCompareRuler(this._diffNavigator, 0, "left", {styleClass: "ruler lines"}, {styleClass: "rulerLines odd"}, {styleClass: "rulerLines even"}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			this._editors[1].getTextView().addRuler(lRuler);
			this._editors[0].getTextView().addRuler(rRuler);
			this._editors[0].getTextView().addRuler(this._overviewRuler);
			this._hasRuler = true;
		}
	};
	
	TwoWayCompareView.prototype.refresh = function(refreshEditors, generateMapper, refreshingEditorIndex){	
		if(this._destroyed) {
			return;
		}
		if(this._imageMode){
			if(this.options.commandProvider){
				this.options.commandProvider.renderCommands(this);
			}
			var that = this;
			return this._loadImageFile(this.options.newFile.URL, this._uiFactory.getEditorParentDiv(true)).then(function(height){
				return that._loadImageFile(that.options.oldFile.URL, that._uiFactory.getEditorParentDiv()).then(function(height1){
					return new Deferred().resolve(height > height1 ? height : height1);
				});
			});
		}
		var result = this._generateMapper(generateMapper, this.options.oldFile.Content, this.options.newFile.Content, this.options.diffContent, this.options.hasConflicts, !this.options.toggler);
		var input = this.options.oldFile.Content;
		var output = this.options.newFile.Content;
		if(typeof output !== "string"){ //$NON-NLS-0$
			output = result.output;
		}
		
		var rFeeder = new mDiffTreeNavigator.TwoWayDiffBlockFeeder(this._editors[0].getTextView().getModel(), result.mapper, 1, this.options.newFileOnRight);
		var lFeeder = new mDiffTreeNavigator.TwoWayDiffBlockFeeder(this._editors[1].getTextView().getModel(), result.mapper, 0, this.options.newFileOnRight);
		this._diffNavigator.initAll(this.options.charDiff ? "char" : "word", this._editors[0], this._editors[1], rFeeder, lFeeder, this._overviewRuler, this._curveRuler); //$NON-NLS-1$ //$NON-NLS-0$
		this._curveRuler.init(result.mapper ,this._editors[1], this._editors[0], this._diffNavigator);
		if(refreshEditors) {
			if(typeof refreshingEditorIndex === "number") {
				if(refreshingEditorIndex === 1) {
					this._editors[1].setInput(this.options.newFile.Name, null, output);
				} else {
					this._editors[0].setInput(this.options.oldFile.Name, null, input);
				}
			} else {
				this._editors[1].setInput(this.options.newFile.Name, null, output);
				this._editors[0].setInput(this.options.oldFile.Name, null, input);
			}
		}
		this._initSyntaxHighlighter([{fileName: this.options.newFile.Name, contentType: this.options.newFile.Type, editor: this._editors[1]},
									 {fileName: this.options.oldFile.Name, contentType: this.options.oldFile.Type, editor: this._editors[0]}]);
		this._highlightSyntax();
		if(this.options.commandProvider){
			this.options.commandProvider.renderCommands(this);
		}
		this.addRulers();
		
		if(this._viewLoadedCounter === 2){
			this._diffNavigator.gotoBlock(this.options.blockNumber-1, this.options.changeNumber-1);
		}
		this.refreshTitle(0);
		this.refreshTitle(1);
		var leftViewHeight = this._editors[1].getTextView().getModel().getLineCount() * this._editors[1].getTextView().getLineHeight() + 5;
		var rightViewHeight = this._editors[0].getTextView().getModel().getLineCount() * this._editors[0].getTextView().getLineHeight() +5;
		return leftViewHeight > rightViewHeight ? leftViewHeight : rightViewHeight;
	};
	
	TwoWayCompareView.prototype.refreshTitle = function(editorIndex, dirty){	
		if(editorIndex === 1){
			var newFileTitleNode = this._uiFactory.getTitleDiv(true);
			if(newFileTitleNode){
				lib.empty(newFileTitleNode);
				newFileTitleNode.appendChild(document.createTextNode(dirty || this._editors[editorIndex].isDirty() ? this.options.newFile.Name + "*" : this.options.newFile.Name)); //$NON-NLS-0$
			}
		} else {
			var oldFileTitleNode = this._uiFactory.getTitleDiv(false);
			if(oldFileTitleNode){
				lib.empty(oldFileTitleNode);
				oldFileTitleNode.appendChild(document.createTextNode(dirty || this._editors[editorIndex].isDirty() ? this.options.oldFile.Name + "*" : this.options.oldFile.Name)); //$NON-NLS-0$
			}
		}
	};
	/**
	 * Scrolls to the specified line and selects
	 * the characters between start and end.
	 * @param[in] lineNumber The 0 based line number to reveal.
	 * @param[in] optional start The index at which the selection should start.
	 * @param[in] optional end The index at which the selection should end.
	 * @param[in] optional callback The callback function after the line is moved.
	 */
	TwoWayCompareView.prototype.gotoLine = function(lineNumber/*zero based*/, start, end, callback){
		if(typeof start !== "number") {
			start = 0;
		}
		var gotoLineCallback = function() {
			callback(lineNumber);
		}.bind(this);
		this._editors[1].onGotoLine(lineNumber, start, end, gotoLineCallback);
	};
	TwoWayCompareView.prototype.getMainEditor = function(){
		if(this._editors) {
			return this._editors[1];
		}
		return null;
	};
	/**
	 * Convert the 0-based line number from logical to physical or vice versa. 
	 * @param[int] lineNumber The 0 based line number to convert.
	 * @param[boolean] reverse If false or not defined, convert from logical number to phsical number. Otherwie convert from physical to logical.
	 * 				   Physical number is the line number in the text editor, merged if any. Logical number is what shows in the ruler.
	 * @returns {int} the converted number, 0-based. -1 means that the phical number can not be converted to a logical number, which means an empty number in the ruler.
	 */
	TwoWayCompareView.prototype.getLineNumber = function(lineNumber){
		return lineNumber;
	};
	return TwoWayCompareView;
}());

/**
 * Constructs a unifiled compare view.
 * 
 * @param {orion.compare.CompareViewOptions} options the compare view options.
 * 
 * @class A InlineCompareView is a unified view of two files with diff annotations and navigations. It displayed the old file + diff in one editor.
 * @name orion.compare.TwoWayCompareView
 */
exports.InlineCompareView = (function() {
	function InlineCompareView(options) {
		exports.CompareView.call(this, options);
		this.setOptions(options, true);
		this._diffNavigator = new mDiffTreeNavigator.DiffTreeNavigator("word"); //$NON-NLS-0$
		this.type = "inline"; //$NON-NLS-0$
		if(this.options.commandProvider){
			this.options.commandProvider.initCommands(this);
		}
		this._editorDiv = this.options.parentDivId;
	}
	InlineCompareView.prototype = Object.create(exports.CompareView.prototype);
	
	InlineCompareView.prototype.addRulers = function(){
		if(this._textView && !this._hasRuler){
			this._textView.addRuler(this._rulerOrigin);
			this._textView.addRuler(this._rulerNew);
			this._textView.addRuler(this._overviewRuler);
			this._hasRuler = true;
		}
	};
	
	InlineCompareView.prototype.removeRulers = function(){
		if(this._textView && this._hasRuler){
			this._textView.removeRuler(this._rulerOrigin);
			this._textView.removeRuler(this._rulerNew);
			this._textView.removeRuler(this._overviewRuler);
			this._hasRuler = false;
		}
	};

	InlineCompareView.prototype.destroyEditor = function(){
		if(this._textView){
			this._diffNavigator.destroy();
			this._textView.setText("");
			this.removeRulers();
		}
	};

	InlineCompareView.prototype.isDirty = function(){
		return false;
	};

	InlineCompareView.prototype.destroy = function(){
		this._destroyed = true;
		if(this._textView){
			this._diffNavigator.destroy();
			this._textView.destroy();
		}
	};

	InlineCompareView.prototype.initEditors = function(initString){
		if(this.options.preCreate) {
			this.options.preCreate();
		}
		var parentDiv = lib.node(this._editorDiv);
		var textViewFactory = function(){
			var textView = new mTextView.TextView({
				parent: parentDiv,
				readonly: true,
				tabSize: 4
			});
			return textView;
		}.bind(this);
		this._editor = new mEditor.Editor({
			textViewFactory: textViewFactory,
			undoStackFactory: new mEditorFeatures.UndoFactory(),
			annotationFactory: new mEditorFeatures.AnnotationFactory(),
			domNode: parentDiv
		});
				
		this._editor.installTextView();
		this._editor.setInput(null, null, initString);
		this._editor.setOverviewRulerVisible(false);
		this._editor.setAnnotationRulerVisible(true);
			
		this._textView = this._editor.getTextView();
			
		this._rulerOrigin = new mCompareRulers.LineNumberCompareRuler(this._diffNavigator, 1,"left", {styleClass: "ruler lines inlineRulerLeft"}, {styleClass: "rulerLines odd"}, {styleClass: "rulerLines even"}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		this._rulerNew = new mCompareRulers.LineNumberCompareRuler(this._diffNavigator, 0,"left", {styleClass: "ruler lines"}, {styleClass: "rulerLines odd"}, {styleClass: "rulerLines even"}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		this._overviewRuler  = new mCompareRulers.CompareOverviewRuler("right", {styleClass: "ruler overview"} , null, //$NON-NLS-1$ //$NON-NLS-0$
                function(lineIndex, ruler){this._diffNavigator.matchPositionFromOverview(lineIndex);}.bind(this));
		
		this._textView.addEventListener("Selection", function(evt){ //$NON-NLS-0$
			var selections = Array.isArray(evt.newValue) ? evt.newValue : [evt.newValue];
			if(selections.length > 1 || !selections[0].isEmpty()){
				return;
			}
			if(this._diffNavigator.autoSelecting || !this._diffNavigator.editorWrapper[0].diffFeeder){
				return;
			}
			this._diffNavigator.gotoDiff(selections[0].getCaret(), this._textView);
		}.bind(this)); 
	};

	InlineCompareView.prototype.disableAnnoBookMark = function(){
		this._disableAnnoBookMark([this._editor]);
	};
	
	InlineCompareView.prototype.initImageMode = function(){
		if(this._editor) {
			this._editor.destroy();
			this._editor = null;
		}
		lib.node(this._editorDiv).classList.add("compareEditorParentImageMode"); //$NON-NLS-0$
		this._imageMode = true;
	};
	
	InlineCompareView.prototype.getImageMode = function(){
		return this._imageMode;
	};
	
	InlineCompareView.prototype._initDiffPosition = function(textView){
		var model = textView.getModel();
		if(model && model.getAnnotations){
			var annotations = model.getAnnotations();
			if(annotations.length > 0) {
				var lineIndex = annotations[0][0];
				var lineHeight = textView.getLineHeight();
				var clientArea = textView.getClientArea();
				var lines = Math.floor(clientArea.height / lineHeight/3);
				textView.setTopIndex((lineIndex - lines) > 0 ? lineIndex - lines : 0);
			}
		}
	};
	
	InlineCompareView.prototype.refresh = function(refreshEditors, generateMapper){
		if(this._destroyed) {
			return;
		}
		if(this._imageMode){
			if(this.options.commandProvider){
				this.options.commandProvider.renderCommands(this);
			}
			var that = this;
			return this._loadImageFile(this.options.newFile.URL, lib.node(this._editorDiv), true).then(function(height){
				return that._loadImageFile(that.options.oldFile.URL, lib.node(that._editorDiv)).then(function(height1){
					return new Deferred().resolve(height +  height1 + 20);
				});
			});
		}
		var result = this._generateMapper(generateMapper, this.options.oldFile.Content, this.options.newFile.Content, this.options.diffContent, this.options.hasConflicts, !this.options.toggler);
		this._mapper = result.mapper;
		this._textView.getModel().setText(this.options.oldFile.Content);
		//Merge the text with diff 
		var rFeeder = new mDiffTreeNavigator.inlineDiffBlockFeeder(result.mapper, 1);
		var lFeeder = new mDiffTreeNavigator.inlineDiffBlockFeeder(result.mapper, 0);
		mCompareUtils.mergeDiffBlocks(this._textView.getModel(), lFeeder.getDiffBlocks(), result.mapper, result.diffArray.array, result.diffArray.index, this._diffParser._lineDelimiter);
		rFeeder.setModel(this._textView.getModel());
		lFeeder.setModel(this._textView.getModel());
		this._diffNavigator.initAll(this.options.charDiff ? "char" : "word", this._editor, this._editor, rFeeder, lFeeder, this._overviewRuler); //$NON-NLS-1$ //$NON-NLS-0$
		
		this._initSyntaxHighlighter([{fileName: this.options.oldFile.Name, contentType: this.options.oldFile.Type, editor: this._editor}]);
		this._highlightSyntax();
		if(this.options.commandProvider){
			this.options.commandProvider.renderCommands(this);
		}
		this.removeRulers();
		this.addRulers();
		var drawLine = this._textView.getTopIndex() ;
		this._textView.redrawLines(drawLine , drawLine+  1 , this._overviewRuler);
		this._textView.redrawLines(drawLine , drawLine+  1 , this._rulerOrigin);
		this._textView.redrawLines(drawLine , drawLine+  1 , this._rulerNew);
		this._diffNavigator.gotoBlock(this.options.blockNumber-1, this.options.changeNumber-1);
		return this._textView.getLineHeight() * this._textView.getModel().getLineCount() + 5;
	};
	
	InlineCompareView.prototype.setConflicting =  function(conflicting){	
		this._conflcit = conflicting;
	};
	
	InlineCompareView.prototype.gotoDiff = function(changeNumber){
		this._diffNavigator.gotoChangeUsingIndex(changeNumber);
	};
	
	/**
	 * Scrolls to the specified line and selects
	 * the characters between start and end.
	 * @param[in] lineNumber The 0 based line number to reveal.
	 * @param[in] optional start The index at which the selection should start.
	 * @param[in] optional end The index at which the selection should end.
	 * @param[in] optional callback The callback function after the line is moved.
	 */
	InlineCompareView.prototype.gotoLine = function(lineNumber/*zero based*/, start, end, callback){
		if(typeof start !== "number") {
			start = 0;
		}
		var mergedNumber = mCompareUtils.convertMergedLineNumber(this._mapper, lineNumber);
		var gotoLineCallback = function() {
			callback(mergedNumber);
		}.bind(this);
		this._editor.onGotoLine(mergedNumber, start, end, gotoLineCallback);
	};
	InlineCompareView.prototype.getMainEditor = function(){
		if(this._editor) {
			return this._editor;
		}
		return null;
	};
	/**
	 * Convert the 0-based line number from logical to physical or vice versa. 
	 * @param[int] lineNumber The 0 based line number to convert.
	 * @param[boolean] reverse If false or not defined, convert from logical number to phsical number. Otherwie convert from physical to logical.
	 * 				   Physical number is the line number in the text editor, merged if any. Logical number is what shows in the ruler.
	 * @returns {int} the converted number, 0-based. -1 means that the phical number can not be converted to a logical number, which means an empty number in the ruler.
	 */
	InlineCompareView.prototype.getLineNumber = function(lineNumber, reverse){
		if(reverse) {
			var diffFeeder = this._diffNavigator.getFeeder(true);
			if(diffFeeder) {
				return diffFeeder.getLineNumber(lineNumber);
			}
			return lineNumber;
		} else {
			var mergedNumber = mCompareUtils.convertMergedLineNumber(this._mapper, lineNumber);
			return mergedNumber;
		}
	};
	
	return InlineCompareView;
}());

/**
 * Constructs a toggleable compare view.
 * 
 * @param {String} [startWith="twoWay"] the default view of the toggleable compare view. Can be either "twoWay" or "inline".
 * @param {orion.compare.CompareViewOptions} options the compare view options.
 * 
 * @class A toggleableCompareView is an interchangeable comapre view helper that helps user to switch between the "side by side" and "unified" by only button click. The commandProvider property has to be provided in the option in order to render the toggle command.
 * @name orion.compare.toggleableCompareView
 */
exports.toggleableCompareView = (function() {
	function toggleableCompareView(startWith, options) {
		mEventTarget.attach(this);
		if(options){
			options.toggler = this;
		}
		if(startWith === "inline"){ //$NON-NLS-0$
			this._widget = new exports.InlineCompareView(options);
		} else {
			this._widget = new exports.TwoWayCompareView(options);
		}
	}
	toggleableCompareView.prototype = {
		startup: function(){
			this._widget.startup();
		},
		
		initImageMode: function(){
			this._imageMode = true;
			this._widget.initImageMode();
		},
	
		_toggle: function(options) {
			this._widget.destroy();
			lib.empty(lib.node(options.parentDivId));
			if(this._widget.type === "inline"){ //$NON-NLS-0$
				this._widget = new exports.TwoWayCompareView(options);
			} else {
				this._widget = new exports.InlineCompareView(options);
			}
			if(this._imageMode){
				this._widget.initImageMode();
			} else {
				this._widget.initEditors();
			}
			this._widget.refresh(true);
			if(options.onInputChanged && this._widget.type === "twoWay") {
				options.onInputChanged();
			}
		},
		
		toggle: function(){
			var options = this._widget.options;
			if(!this._imageMode){
				var diffPos = this._widget.getCurrentDiffPos();
				options.blockNumber = diffPos.block;
				options.changeNumber = diffPos.change;
			}
			this._toggle(options);
		},
		
		isDirty: function() {
			return this._widget.isDirty();
		},
		
		destroy: function(){
			return this._widget.destroy();
		},
		
		getWidget: function() {
			return this._widget;
		}
	};
	return toggleableCompareView;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/lib/syntax", [], function() { //$NON-NLS-0$
	return {
		id: "orion.lib", //$NON-NLS-0$
		grammars: [{
			id: "orion.lib", //$NON-NLS-0$
			repository: {
				brace_open: {
					match: "{", //$NON-NLS-0$
					name: "punctuation.section.block.begin" //$NON-NLS-0$
				},
				brace_close: {
					match: "}", //$NON-NLS-0$
					name: "punctuation.section.block.end" //$NON-NLS-0$
				},
				bracket_open: {
					match: "\\[", //$NON-NLS-0$
					name: "punctuation.section.bracket.begin" //$NON-NLS-0$
				},
				bracket_close: {
					match: "\\]", //$NON-NLS-0$
					name: "punctuation.section.bracket.end" //$NON-NLS-0$
				},
				parenthesis_open: {
					match: "\\(", //$NON-NLS-0$
					name: "punctuation.section.parens.begin" //$NON-NLS-0$
				},
				parenthesis_close: {
					match: "\\)", //$NON-NLS-0$
					name: "punctuation.section.parens.end" //$NON-NLS-0$
				},
				doc_block: {
					begin: {match: "/\\*\\*", literal: "/**"}, //$NON-NLS-1$ //$NON-NLS-0$
					end: {match: "\\*/", literal: "*/"}, //$NON-NLS-1$ //$NON-NLS-0$
					name: "comment.block.documentation", //$NON-NLS-0$
					patterns: [
						{
							match: "@(?:(?!\\*/)\\S)*", //$NON-NLS-0$
							name: "meta.documentation.annotation" //$NON-NLS-0$
						}, {
							match: "\\<\\S*\\>", //$NON-NLS-0$
							name: "meta.documentation.tag" //$NON-NLS-0$
						}, {
							match: "(\\b)(TODO)(\\b)(((?!\\*/).)*)", //$NON-NLS-0$
							name: "meta.annotation.task.todo", //$NON-NLS-0$
							captures: {
								2: {name: "keyword.other.documentation.task"}, //$NON-NLS-0$
								4: {name: "comment.block"} //$NON-NLS-0$
							}
						}
					]
				},
				number_decimal: {
					match: "\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b", //$NON-NLS-0$
					name: "constant.numeric.number" //$NON-NLS-0$
				},
				number_hex: {
					match: "\\b0[xX][0-9A-Fa-f]+\\b", //$NON-NLS-0$
					name: "constant.numeric.hex" //$NON-NLS-0$
				},
				string_doubleQuote: {
					match: '"(?:\\\\.|[^"])*"?', //$NON-NLS-0$
					name: "string.quoted.double" //$NON-NLS-0$
				},
				string_singleQuote: {
					match: "'(?:\\\\.|[^'])*'?", //$NON-NLS-0$
					name: "string.quoted.single" //$NON-NLS-0$
				},
				todo_comment_singleLine: {
					match: "(\\b)(TODO)(\\b)(.*)", //$NON-NLS-0$
					name: "meta.annotation.task.todo", //$NON-NLS-0$
					captures: {
						2: {name: "keyword.other.documentation.task"}, //$NON-NLS-0$
						4: {name: "comment.line"} //$NON-NLS-0$
					}
				}
			}
		}, {
			id: "orion.c-like", //$NON-NLS-0$
			repository: {
				comment_singleLine: {
					match: {match: "//.*", literal: "//"}, //$NON-NLS-1$ //$NON-NLS-0$
					name: "comment.line.double-slash", //$NON-NLS-0$
					patterns: [
						{
							include: "orion.lib#todo_comment_singleLine" //$NON-NLS-0$
						}
					]
				},
				comment_block: {
					begin: {match: "/\\*", literal: "/*"}, //$NON-NLS-1$ //$NON-NLS-0$
					end: {match: "\\*/", literal: "*/"}, //$NON-NLS-1$ //$NON-NLS-0$ 
					name: "comment.block", //$NON-NLS-0$
					patterns: [
						{
							match: "(\\b)(TODO)(\\b)(((?!\\*/).)*)", //$NON-NLS-0$
							name: "meta.annotation.task.todo", //$NON-NLS-0$
							captures: {
								2: {name: "keyword.other.documentation.task"}, //$NON-NLS-0$
								4: {name: "comment.block"} //$NON-NLS-0$
							}
						}
					]
				}
			}
		}],
		keywords: []
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define("orion/editor/stylers/application_javascript/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"class", "const", //$NON-NLS-1$ //$NON-NLS-0$
		"debugger", "delete", //$NON-NLS-1$ //$NON-NLS-0$
		"enum", "export", "extends", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"function", //$NON-NLS-0$
		"implements", "import", "in", "instanceof", "interface", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"let", //$NON-NLS-0$
		"new", //$NON-NLS-0$
		"package", "private", "protected", "public", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"static", "super", //$NON-NLS-1$ //$NON-NLS-0$
		"typeof", //$NON-NLS-0$
		"var", "void", //$NON-NLS-1$ //$NON-NLS-0$
		"with" //$NON-NLS-0$
	];
	var controlKeywords = [
		"break", //$NON-NLS-0$
		"case", "catch", "continue", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"default", "do", //$NON-NLS-1$ //$NON-NLS-0$
		"else", //$NON-NLS-0$
		"finally", "for", //$NON-NLS-1$ //$NON-NLS-0$
		"if", //$NON-NLS-0$
		"return", //$NON-NLS-0$
		"switch", //$NON-NLS-0$
		"throw", "try", //$NON-NLS-1$ //$NON-NLS-0$
		"while", //$NON-NLS-0$
		"yield" //$NON-NLS-0$
	];
	var constants = [
		"false", "null", "true", "undefined" //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.js", //$NON-NLS-0$
		contentTypes: ["application/javascript"], //$NON-NLS-0$
		patterns: [
			{
				begin: "'(?:\\\\.|[^\\\\'])*\\\\$", //$NON-NLS-0$
				end: "^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))", //$NON-NLS-0$
				name: "string.quoted.single.js" //$NON-NLS-0$
			}, {
				begin: '"(?:\\\\.|[^\\\\"])*\\\\$', //$NON-NLS-0$
				end: '^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))', //$NON-NLS-0$
				name: "string.quoted.double.js" //$NON-NLS-0$
			},
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
			{
				match: "/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})", //$NON-NLS-0$
				name: "string.regexp.js" //$NON-NLS-0$
			},
			{include: "orion.lib#doc_block"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
			{include: "#jsFunctionDef"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.operator.js" //$NON-NLS-0$
			},
			{
				match: "\\b(?:" + controlKeywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.js" //$NON-NLS-0$
			},
			{
				match: "\\b(?:" + constants.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "constant.language.js" //$NON-NLS-0$
			},
			{
				match: "\\bthis\\b", //$NON-NLS-0$
				name: "variable.language.js" //$NON-NLS-0$
			}
		],
		repository: {
			jsFunctionDef: {
				/*
				 * http://stackoverflow.com/questions/2008279/validate-a-javascript-function-name/2008444#2008444
				 * was referenced in the composition of the "begin" pattern below.
				 */
				begin: "(function)(\\s+[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(", //$NON-NLS-0$
				end: "\\)", //$NON-NLS-0$
				captures: {
					1: {name: "keyword.operator.js"}, //$NON-NLS-0$
					2: {name: "entity.name.function.js"} //$NON-NLS-0$
				},
				patterns: [
					{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
					{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
					{
						match: "[^\\s,]+", //$NON-NLS-0$
						name: "variable.parameter.js" //$NON-NLS-0$
					}
				]
			}
		}
	});

	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords.concat(controlKeywords)
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-java-source/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"abstract", //$NON-NLS-0$
		"boolean", "byte", //$NON-NLS-1$ //$NON-NLS-0$
		"char", "class", //$NON-NLS-1$ //$NON-NLS-0$
		"double", //$NON-NLS-0$
		"extends", //$NON-NLS-0$
		"final", "float", //$NON-NLS-1$ //$NON-NLS-0$
		"implements", "import", "instanceof", "int", "interface", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"long", //$NON-NLS-0$
		"native", "new", //$NON-NLS-1$ //$NON-NLS-0$
		"package", "private", "protected", "public", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"short", "static", "synchronized", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"throws", "transient", //$NON-NLS-1$ //$NON-NLS-0$
		"void", "volatile" //$NON-NLS-1$ //$NON-NLS-0$
	];
	var controlKeywords = [
		"break", //$NON-NLS-0$
		"case", "catch", "continue", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"default", "do", //$NON-NLS-1$ //$NON-NLS-0$
		"else", //$NON-NLS-0$
		"finally", "for", //$NON-NLS-1$ //$NON-NLS-0$
		"if", //$NON-NLS-0$
		"return", //$NON-NLS-0$
		"switch", //$NON-NLS-0$
		"throw", "try", //$NON-NLS-1$ //$NON-NLS-0$
		"while" //$NON-NLS-0$
	];
	var constants = [
		"false", "null", "true" //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.java", //$NON-NLS-0$
		contentTypes: ["text/x-java-source"], //$NON-NLS-0$
		patterns: [
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
			{include: "orion.lib#doc_block"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.operator.java" //$NON-NLS-0$
			},
			{
				match: "\\b(?:" + controlKeywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.java" //$NON-NLS-0$
			},
			{
				match: "\\b(?:" + constants.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "constant.language.java" //$NON-NLS-0$
			},
			{
				match: "\\b(?:this|super)\\b", //$NON-NLS-0$
				name: "variable.language.java" //$NON-NLS-0$
			}
		]
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords.concat(controlKeywords)
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_css/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"alignment-adjust", "alignment-baseline", "animation-delay", "animation-direction", "animation-duration", "animation-iteration-count", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"animation-name", "animation-play-state", "animation-timing-function", "animation", "appearance", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"azimuth", "backface-visibility", "background-attachment", "background-clip", "background-color", "background-image", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"background-origin", "background-position", "background-repeat", "background-size", "background", "baseline-shift", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"binding", "bleed", "bookmark-label", "bookmark-level", "bookmark-state", "bookmark-target", "border-bottom-color", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-bottom-left-radius", "border-bottom-right-radius", "border-bottom-style", "border-bottom-width", "border-bottom", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-collapse", "border-color", "border-image-outset", "border-image-repeat", "border-image-slice", "border-image-source", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-image-width", "border-image", "border-left-color", "border-left-style", "border-left-width", "border-left", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-radius", "border-right-color", "border-right-style", "border-right-width", "border-right", "border-spacing", "border-style", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-top-color", "border-top-left-radius", "border-top-right-radius", "border-top-style", "border-top-width", "border-top", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"border-width", "border", "bottom", "box-align", "box-decoration-break", "box-direction", "box-flex-group", "box-flex", "box-lines", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"box-ordinal-group", "box-orient", "box-pack", "box-shadow", "box-sizing", "break-after", "break-before", "break-inside", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"caption-side", "clear", "clip", "color-profile", "color", "column-count", "column-fill", "column-gap", "column-rule-color", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"column-rule-style", "column-rule-width", "column-rule", "column-span", "column-width", "columns", "content", "counter-increment", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"counter-reset", "crop", "cue-after", "cue-before", "cue", "cursor", "direction", "display", "dominant-baseline", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"drop-initial-after-adjust", "drop-initial-after-align", "drop-initial-before-adjust", "drop-initial-before-align", "drop-initial-size", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"drop-initial-value", "elevation", "empty-cells", "fit-position", "fit", "flex-align", "flex-flow", "flex-inline-pack", "flex-order", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"flex-pack", "float-offset", "float", "font-family", "font-size", "font-size-adjust", "font-stretch", "font-style", "font-variant", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"font-weight", "font", "grid-columns", "grid-rows", "hanging-punctuation", "height", "hyphenate-after", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"hyphenate-before", "hyphenate-character", "hyphenate-lines", "hyphenate-resource", "hyphens", "icon", "image-orientation", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"image-rendering", "image-resolution", "inline-box-align", "left", "letter-spacing", "line-height", "line-stacking-ruby", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"line-stacking-shift", "line-stacking-strategy", "line-stacking", "list-style-image", "list-style-position", "list-style-type", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"list-style", "margin-bottom", "margin-left", "margin-right", "margin-top", "margin", "mark-after", "mark-before", "mark", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"marker-offset", "marks", "marquee-direction", "marquee-loop", "marquee-play-count", "marquee-speed", "marquee-style", "max-height", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"max-width", "min-height", "min-width", "move-to", "nav-down", "nav-index", "nav-left", "nav-right", "nav-up", "opacity", "orphans", //$NON-NLS-10$ //$NON-NLS-9$ //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"outline-color", "outline-offset", "outline-style", "outline-width", "outline", "overflow-style", "overflow-x", "overflow-y", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"overflow", "padding-bottom", "padding-left", "padding-right", "padding-top", "padding", "page-break-after", "page-break-before", "page-break-inside", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"page-policy", "page", "pause-after", "pause-before", "pause", "perspective-origin", "perspective", "phonemes", "pitch-range", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"pitch", "play-during", "position", "presentation-level", "punctuation-trim", "quotes", "rendering-intent", "resize", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"rest-after", "rest-before", "rest", "richness", "right", "rotation-point", "rotation", "ruby-align", "ruby-overhang", "ruby-position", //$NON-NLS-9$ //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"ruby-span", "size", "speak-header", "speak-numeral", "speak-punctuation", "speak", "speech-rate", "stress", "string-set", "table-layout", //$NON-NLS-9$ //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"target-name", "target-new", "target-position", "target", "text-align-last", "text-align", "text-decoration", "text-emphasis", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"text-height", "text-indent", "text-justify", "text-outline", "text-shadow", "text-transform", "text-wrap", "top", "transform-origin", //$NON-NLS-8$ //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"transform-style", "transform", "transition-delay", "transition-duration", "transition-property", "transition-timing-function", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"transition", "unicode-bidi", "vertical-align", "visibility", "voice-balance", "voice-duration", "voice-family", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"voice-pitch-range", "voice-pitch", "voice-rate", "voice-stress", "voice-volume", "volume", "white-space-collapse", "white-space", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"widows", "width", "word-break", "word-spacing", "word-wrap", "z-index" //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.css", //$NON-NLS-0$
		contentTypes: ["text/css"], //$NON-NLS-0$
		patterns: [
			{
				begin: "'(?:\\\\.|[^\\\\'])*\\\\$", //$NON-NLS-0$
				end: "^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))", //$NON-NLS-0$
				name: "string.quoted.single.css" //$NON-NLS-0$
			}, {
				begin: '"(?:\\\\.|[^\\\\"])*\\\\$', //$NON-NLS-0$
				end: '^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))', //$NON-NLS-0$
				name: "string.quoted.double.css" //$NON-NLS-0$
			},
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "#number_hex"}, //$NON-NLS-0$
			{
				match: "(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b", //$NON-NLS-0$
				name: "constant.numeric.value.css" //$NON-NLS-0$
			},
			{			
				match: "(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "support.type.propertyName.css" //$NON-NLS-0$
			}
		],
		repository: {
			number_hex: {
				match: "#[0-9A-Fa-f]+\\b", //$NON-NLS-0$
				name: "constant.numeric.hex.css" //$NON-NLS-0$
			}
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 *               Alex Lakatos - fix for bug#369781
 ******************************************************************************/

/*eslint-env browser, amd*/

define("examples/editor/textStyler", [ //$NON-NLS-0$
	'orion/editor/annotations', //$NON-NLS-0$
	'orion/editor/stylers/application_javascript/syntax', //$NON-NLS-0$
	'orion/editor/stylers/text_x-java-source/syntax', //$NON-NLS-0$
	'orion/editor/stylers/text_css/syntax' //$NON-NLS-0$
], function(mAnnotations, mJS, mJava, mCSS) {

	var JS_KEYWORDS = mJS.keywords;

	var JAVA_KEYWORDS = mJava.keywords;

	var CSS_KEYWORDS = mCSS.keywords;

	// Scanner constants
	var UNKOWN = 1;
	var KEYWORD = 2;
	var NUMBER = 3;
	var STRING = 4;
	var MULTILINE_STRING = 5;
	var SINGLELINE_COMMENT = 6;
	var MULTILINE_COMMENT = 7;
	var DOC_COMMENT = 8;
	var WHITE = 9;
	var WHITE_TAB = 10;
	var WHITE_SPACE = 11;
	var HTML_MARKUP = 12;
	var DOC_TAG = 13;
	var TASK_TAG = 14;

	var BRACKETS = "{}()[]<>"; //$NON-NLS-0$

	// Styles
	var singleCommentStyle = {styleClass: "comment"}; //$NON-NLS-0$
	var multiCommentStyle = {styleClass: "comment"}; //$NON-NLS-0$
	var docCommentStyle = {styleClass: "comment block documentation"}; //$NON-NLS-0$
	var htmlMarkupStyle = {styleClass: "meta documentation tag"}; //$NON-NLS-0$
	var tasktagStyle = {styleClass: "keyword other documentation task"}; //$NON-NLS-0$
	var doctagStyle = {styleClass: "meta documentation annotation"}; //$NON-NLS-0$
	var stringStyle = {styleClass: "string"}; //$NON-NLS-0$
	var numberStyle = {styleClass: "constant numeric"}; //$NON-NLS-0$
	var keywordStyle = {styleClass: "keyword"}; //$NON-NLS-0$
	var spaceStyle = {styleClass: "punctuation separator space", unmergeable: true}; //$NON-NLS-0$
	var tabStyle = {styleClass: "punctuation separator tab", unmergeable: true}; //$NON-NLS-0$
	var caretLineStyle = {styleClass: "meta annotation currentLine"}; //$NON-NLS-0$

	function Scanner (keywords, whitespacesVisible) {
		this.keywords = keywords;
		this.whitespacesVisible = whitespacesVisible;
		this.setText("");
	}

	Scanner.prototype = {
		getOffset: function() {
			return this.offset;
		},
		getStartOffset: function() {
			return this.startOffset;
		},
		getData: function() {
			return this.text.substring(this.startOffset, this.offset);
		},
		getDataLength: function() {
			return this.offset - this.startOffset;
		},
		_default: function(c) {
			switch (c) {
				case 32: // SPACE
				case 9: // TAB
					if (this.whitespacesVisible) {
						return c === 32 ? WHITE_SPACE : WHITE_TAB;
					}
					do {
						c = this._read();
					} while(c === 32 || c === 9);
					this._unread(c);
					return WHITE;
				case 123: // {
				case 125: // }
				case 40: // (
				case 41: // )
				case 91: // [
				case 93: // ]
				case 60: // <
				case 62: // >
					// BRACKETS
					return c;
				default:
					var isCSS = this.isCSS;
					var off = this.offset - 1;
					if (!isCSS && 48 <= c && c <= 57) {
						var floating = false, exponential = false, hex = false, firstC = c;
						do {
							c = this._read();
							if (c === 46 /* dot */ && !floating) {
								floating = true;
							} else if (c === 101 /* e */ && !exponential) {
								floating = exponential = true;
								c = this._read();
								if (c !== 45 /* MINUS */) {
									this._unread(c);
								}
							} else if (c === 120 /* x */ && firstC === 48 && (this.offset - off === 2)) {
								floating = exponential = hex = true;
							} else if (!(48 <= c && c <= 57 || (hex && ((65 <= c && c <= 70) || (97 <= c && c <= 102))))) { //NUMBER DIGIT or HEX
								break;
							}
						} while(true);
						this._unread(c);
						return NUMBER;
					}
					if ((97 <= c && c <= 122) || (65 <= c && c <= 90) || c === 95 || (45 /* DASH */ === c && isCSS)) { //LETTER OR UNDERSCORE OR NUMBER
						do {
							c = this._read();
						} while((97 <= c && c <= 122) || (65 <= c && c <= 90) || c === 95 || (48 <= c && c <= 57) || (45 /* DASH */ === c && isCSS));  //LETTER OR UNDERSCORE OR NUMBER
						this._unread(c);
						var keywords = this.keywords;
						if (keywords.length > 0) {
							var word = this.text.substring(off, this.offset);
							//TODO slow
							for (var i=0; i<keywords.length; i++) {
								if (this.keywords[i] === word) { return KEYWORD; }
							}
						}
					}
					return UNKOWN;
			}
		},
		_read: function() {
			if (this.offset < this.text.length) {
				return this.text.charCodeAt(this.offset++);
			}
			return -1;
		},
		_unread: function(c) {
			if (c !== -1) { this.offset--; }
		},
		nextToken: function() {
			this.startOffset = this.offset;
			while (true) {
				var c = this._read(), result;
				switch (c) {
					case -1: return null;
					case 47:	// SLASH -> comment
						c = this._read();
						if (!this.isCSS) {
							if (c === 47) { // SLASH -> single line
								while (true) {
									c = this._read();
									if ((c === -1) || (c === 10) || (c === 13)) {
										this._unread(c);
										return SINGLELINE_COMMENT;
									}
								}
							}
						}
						if (c === 42) { // STAR -> multi line
							c = this._read();
							var token = MULTILINE_COMMENT;
							if (c === 42) {
								token = DOC_COMMENT;
							}
							while (true) {
								while (c === 42) {
									c = this._read();
									if (c === 47) {
										return token;
									}
								}
								if (c === -1) {
									this._unread(c);
									return token;
								}
								c = this._read();
							}
						}
						this._unread(c);
						return UNKOWN;
					case 39:	// SINGLE QUOTE -> char const
						result = STRING;
						while(true) {
							c = this._read();
							switch (c) {
								case 39:
									return result;
								case 13:
								case 10:
								case -1:
									this._unread(c);
									return result;
								case 92: // BACKSLASH
									c = this._read();
									switch (c) {
										case 10: result = MULTILINE_STRING; break;
										case 13:
											result = MULTILINE_STRING;
											c = this._read();
											if (c !== 10) {
												this._unread(c);
											}
											break;
									}
									break;
							}
						}
						break;
					case 34:	// DOUBLE QUOTE -> string
						result = STRING;
						while(true) {
							c = this._read();
							switch (c) {
								case 34: // DOUBLE QUOTE
									return result;
								case 13:
								case 10:
								case -1:
									this._unread(c);
									return result;
								case 92: // BACKSLASH
									c = this._read();
									switch (c) {
										case 10: result = MULTILINE_STRING; break;
										case 13:
											result = MULTILINE_STRING;
											c = this._read();
											if (c !== 10) {
												this._unread(c);
											}
											break;
									}
									break;
							}
						}
						break;
					default:
						return this._default(c);
				}
			}
		},
		setText: function(text) {
			this.text = text;
			this.offset = 0;
			this.startOffset = 0;
		}
	};

	function WhitespaceScanner () {
		Scanner.call(this, null, true);
	}
	WhitespaceScanner.prototype = new Scanner(null);
	WhitespaceScanner.prototype.nextToken = function() {
		this.startOffset = this.offset;
		while (true) {
			var c = this._read();
			switch (c) {
				case -1: return null;
				case 32: // SPACE
					return WHITE_SPACE;
				case 9: // TAB
					return WHITE_TAB;
				default:
					do {
						c = this._read();
					} while(!(c === 32 || c === 9 || c === -1));
					this._unread(c);
					return UNKOWN;
			}
		}
	};

	function CommentScanner (whitespacesVisible) {
		Scanner.call(this, null, whitespacesVisible);
	}
	CommentScanner.prototype = new Scanner(null);
	CommentScanner.prototype.setType = function(type) {
		this._type = type;
	};
	CommentScanner.prototype.nextToken = function() {
		this.startOffset = this.offset;
		while (true) {
			var c = this._read();
			switch (c) {
				case -1: return null;
				case 32: // SPACE
				case 9: // TAB
					if (this.whitespacesVisible) {
						return c === 32 ? WHITE_SPACE : WHITE_TAB;
					}
					do {
						c = this._read();
					} while(c === 32 || c === 9);
					this._unread(c);
					return WHITE;
				case 60: // <
					if (this._type === DOC_COMMENT) {
						do {
							c = this._read();
						} while(!(c === 62 || c === -1)); // >
						if (c === 62) {
							return HTML_MARKUP;
						}
					}
					return UNKOWN;
				case 64: // @
					if (this._type === DOC_COMMENT) {
						do {
							c = this._read();
						} while((97 <= c && c <= 122) || (65 <= c && c <= 90) || c === 95 || (48 <= c && c <= 57));  //LETTER OR UNDERSCORE OR NUMBER
						this._unread(c);
						return DOC_TAG;
					}
					return UNKOWN;
				case 84: // T
					if ((c = this._read()) === 79) { // O
						if ((c = this._read()) === 68) { // D
							if ((c = this._read()) === 79) { // O
								c = this._read();
								if (!((97 <= c && c <= 122) || (65 <= c && c <= 90) || c === 95 || (48 <= c && c <= 57))) {
									this._unread(c);
									return TASK_TAG;
								}
								this._unread(c);
							} else {
								this._unread(c);
							}
						} else {
							this._unread(c);
						}
					} else {
						this._unread(c);
					}
					//FALL THROUGH
				default:
					do {
						c = this._read();
					} while(!(c === 32 || c === 9 || c === -1 || c === 60 || c === 64 || c === 84));
					this._unread(c);
					return UNKOWN;
			}
		}
	};

	function FirstScanner () {
		Scanner.call(this, null, false);
	}
	FirstScanner.prototype = new Scanner(null);
	FirstScanner.prototype._default = function(c) {
		while(true) {
			c = this._read();
			switch (c) {
				case 47: // SLASH
				case 34: // DOUBLE QUOTE
				case 39: // SINGLE QUOTE
				case -1:
					this._unread(c);
					return UNKOWN;
			}
		}
	};

	function TextStyler (view, lang, annotationModel) {
		this.commentStart = "/*"; //$NON-NLS-0$
		this.commentEnd = "*/"; //$NON-NLS-0$
		var keywords = [];
		switch (lang) {
			case "java": keywords = JAVA_KEYWORDS; break; //$NON-NLS-0$
			case "js": keywords = JS_KEYWORDS; break; //$NON-NLS-0$
			case "css": keywords = CSS_KEYWORDS; break; //$NON-NLS-0$
		}
		this.whitespacesVisible = false;
		this.detectHyperlinks = true;
		this.highlightCaretLine = false;
		this.foldingEnabled = true;
		this.detectTasks = true;
		this._scanner = new Scanner(keywords, this.whitespacesVisible);
		this._firstScanner = new FirstScanner();
		this._commentScanner = new CommentScanner(this.whitespacesVisible);
		this._whitespaceScanner = new WhitespaceScanner();
		//TODO these scanners are not the best/correct way to parse CSS
		if (lang === "css") { //$NON-NLS-0$
			this._scanner.isCSS = true;
			this._firstScanner.isCSS = true;
		}
		this.view = view;
		this.annotationModel = annotationModel;
		this._bracketAnnotations = undefined;

		var self = this;
		this._listener = {
			onChanged: function(e) {
				self._onModelChanged(e);
			},
			onDestroy: function(e) {
				self._onDestroy(e);
			},
			onLineStyle: function(e) {
				self._onLineStyle(e);
			},
			onMouseDown: function(e) {
				self._onMouseDown(e);
			},
			onSelection: function(e) {
				self._onSelection(e);
			}
		};
		var model = view.getModel();
		if (model.getBaseModel) {
			model = model.getBaseModel();
		}
		model.addEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
		view.addEventListener("MouseDown", this._listener.onMouseDown); //$NON-NLS-0$
		view.addEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
		view.addEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
		view.addEventListener("LineStyle", this._listener.onLineStyle); //$NON-NLS-0$
		this._computeComments ();
		this._computeFolding();
		view.redrawLines();
	}

	TextStyler.prototype = {
		destroy: function() {
			var view = this.view;
			if (view) {
				var model = view.getModel();
				if (model.getBaseModel) {
					model = model.getBaseModel();
				}
				model.removeEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
				view.removeEventListener("MouseDown", this._listener.onMouseDown); //$NON-NLS-0$
				view.removeEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
				view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
				view.removeEventListener("LineStyle", this._listener.onLineStyle); //$NON-NLS-0$
				this.view = null;
			}
		},
		setHighlightCaretLine: function(highlight) {
			this.highlightCaretLine = highlight;
		},
		setWhitespacesVisible: function(visible, redraw) {
			if (this.whitespacesVisible === visible) { return; }
			this.whitespacesVisible = visible;
			this._scanner.whitespacesVisible = visible;
			this._commentScanner.whitespacesVisible = visible;
			if (redraw) {
				this.view.redraw();
			}
		},
		setDetectHyperlinks: function(enabled) {
			this.detectHyperlinks = enabled;
		},
		setFoldingEnabled: function(enabled) {
			this.foldingEnabled = enabled;
		},
		setDetectTasks: function(enabled) {
			this.detectTasks = enabled;
		},
		_binarySearch: function (array, offset, inclusive, low, high) {
			var index;
			if (low === undefined) { low = -1; }
			if (high === undefined) { high = array.length; }
			while (high - low > 1) {
				index = Math.floor((high + low) / 2);
				if (offset <= array[index].start) {
					high = index;
				} else if (inclusive && offset < array[index].end) {
					high = index;
					break;
				} else {
					low = index;
				}
			}
			return high;
		},
		_computeComments: function() {
			var model = this.view.getModel();
			if (model.getBaseModel) { model = model.getBaseModel(); }
			this.comments = this._findComments(model.getText());
		},
		_computeFolding: function() {
			if (!this.foldingEnabled) { return; }
			var view = this.view;
			var viewModel = view.getModel();
			if (!viewModel.getBaseModel) { return; }
			var annotationModel = this.annotationModel;
			if (!annotationModel) { return; }
			annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_FOLDING);
			var add = [];
			var baseModel = viewModel.getBaseModel();
			var comments = this.comments;
			for (var i=0; i<comments.length; i++) {
				var comment = comments[i];
				var annotation = this._createFoldingAnnotation(viewModel, baseModel, comment.start, comment.end);
				if (annotation) {
					add.push(annotation);
				}
			}
			annotationModel.replaceAnnotations(null, add);
		},
		_createFoldingAnnotation: function(viewModel, baseModel, start, end) {
			var startLine = baseModel.getLineAtOffset(start);
			var endLine = baseModel.getLineAtOffset(end);
			if (startLine === endLine) {
				return null;
			}
			return new (mAnnotations.AnnotationType.getType(mAnnotations.AnnotationType.ANNOTATION_FOLDING))(start, end, viewModel);
		},
		_computeTasks: function(type, commentStart, commentEnd) {
			if (!this.detectTasks) { return; }
			var annotationModel = this.annotationModel;
			if (!annotationModel) { return; }
			var view = this.view;
			var viewModel = view.getModel(), baseModel = viewModel;
			if (viewModel.getBaseModel) { baseModel = viewModel.getBaseModel(); }
			var annotations = annotationModel.getAnnotations(commentStart, commentEnd);
			var remove = [];
			var annotationType = mAnnotations.AnnotationType.ANNOTATION_TASK;
			while (annotations.hasNext()) {
				var annotation = annotations.next();
				if (annotation.type === annotationType) {
					remove.push(annotation);
				}
			}
			var add = [];
			var scanner = this._commentScanner;
			scanner.setText(baseModel.getText(commentStart, commentEnd));
			var token;
			while ((token = scanner.nextToken())) {
				var tokenStart = scanner.getStartOffset() + commentStart;
				if (token === TASK_TAG) {
					var end = baseModel.getLineEnd(baseModel.getLineAtOffset(tokenStart));
					if (type !== SINGLELINE_COMMENT) {
						end = Math.min(end, commentEnd - this.commentEnd.length);
					}
					add.push(mAnnotations.AnnotationType.createAnnotation(annotationType, tokenStart, end, baseModel.getText(tokenStart, end)));
				}
			}
			annotationModel.replaceAnnotations(remove, add);
		},
		_getLineStyle: function(lineIndex) {
			if (this.highlightCaretLine) {
				var view = this.view;
				var model = view.getModel();
				var selections = view.getSelections();
				var hasCaret = false;
				if (!selections.some(function(selection) {
					if (selection.start === selection.end) {
						hasCaret = hasCaret || model.getLineAtOffset(selection.start) === lineIndex;
						return false;
					}
					return true;
				}) && hasCaret) return caretLineStyle;
			}
			return null;
		},
		_getStyles: function(model, text, start) {
			if (model.getBaseModel) {
				start = model.mapOffset(start);
			}
			var end = start + text.length;

			var styles = [];

			// for any sub range that is not a comment, parse code generating tokens (keywords, numbers, brackets, line comments, etc)
			var offset = start, comments = this.comments;
			var startIndex = this._binarySearch(comments, start, true);
			for (var i = startIndex; i < comments.length; i++) {
				if (comments[i].start >= end) { break; }
				var commentStart = comments[i].start;
				var commentEnd = comments[i].end;
				if (offset < commentStart) {
					this._parse(text.substring(offset - start, commentStart - start), offset, styles);
				}
				var type = comments[i].type, style;
				switch (type) {
					case DOC_COMMENT: style = docCommentStyle; break;
					case MULTILINE_COMMENT: style = multiCommentStyle; break;
					case MULTILINE_STRING: style = stringStyle; break;
				}
				var s = Math.max(offset, commentStart);
				var e = Math.min(end, commentEnd);
				if ((type === DOC_COMMENT || type === MULTILINE_COMMENT) && (this.whitespacesVisible || this.detectHyperlinks)) {
					this._parseComment(text.substring(s - start, e - start), s, styles, style, type);
				} else if (type === MULTILINE_STRING && this.whitespacesVisible) {
					this._parseString(text.substring(s - start, e - start), s, styles, stringStyle);
				} else {
					styles.push({start: s, end: e, style: style});
				}
				offset = commentEnd;
			}
			if (offset < end) {
				this._parse(text.substring(offset - start, end - start), offset, styles);
			}
			if (model.getBaseModel) {
				for (var j = 0; j < styles.length; j++) {
					var length = styles[j].end - styles[j].start;
					styles[j].start = model.mapOffset(styles[j].start, true);
					styles[j].end = styles[j].start + length;
				}
			}
			return styles;
		},
		_parse: function(text, offset, styles) {
			var scanner = this._scanner;
			scanner.setText(text);
			var token;
			while ((token = scanner.nextToken())) {
				var tokenStart = scanner.getStartOffset() + offset;
				var style = null;
				switch (token) {
					case KEYWORD: style = keywordStyle; break;
					case NUMBER: style = numberStyle; break;
					case MULTILINE_STRING:
					case STRING:
						if (this.whitespacesVisible) {
							this._parseString(scanner.getData(), tokenStart, styles, stringStyle);
							continue;
						} else {
							style = stringStyle;
						}
						break;
					case DOC_COMMENT:
						this._parseComment(scanner.getData(), tokenStart, styles, docCommentStyle, token);
						continue;
					case SINGLELINE_COMMENT:
						this._parseComment(scanner.getData(), tokenStart, styles, singleCommentStyle, token);
						continue;
					case MULTILINE_COMMENT:
						this._parseComment(scanner.getData(), tokenStart, styles, multiCommentStyle, token);
						continue;
					case WHITE_TAB:
						if (this.whitespacesVisible) {
							style = tabStyle;
						}
						break;
					case WHITE_SPACE:
						if (this.whitespacesVisible) {
							style = spaceStyle;
						}
						break;
				}
				styles.push({start: tokenStart, end: scanner.getOffset() + offset, style: style});
			}
		},
		_parseComment: function(text, offset, styles, s, type) {
			var scanner = this._commentScanner;
			scanner.setText(text);
			scanner.setType(type);
			var token;
			while ((token = scanner.nextToken())) {
				var tokenStart = scanner.getStartOffset() + offset;
				var style = s;
				switch (token) {
					case WHITE_TAB:
						if (this.whitespacesVisible) {
							style = tabStyle;
						}
						break;
					case WHITE_SPACE:
						if (this.whitespacesVisible) {
							style = spaceStyle;
						}
						break;
					case HTML_MARKUP:
						style = htmlMarkupStyle;
						break;
					case DOC_TAG:
						style = doctagStyle;
						break;
					case TASK_TAG:
						style = tasktagStyle;
						break;
					default:
						if (this.detectHyperlinks) {
							style = this._detectHyperlinks(scanner.getData(), tokenStart, styles, style);
						}
				}
				if (style) {
					styles.push({start: tokenStart, end: scanner.getOffset() + offset, style: style});
				}
			}
		},
		_parseString: function(text, offset, styles, s) {
			var scanner = this._whitespaceScanner;
			scanner.setText(text);
			var token;
			while ((token = scanner.nextToken())) {
				var tokenStart = scanner.getStartOffset() + offset;
				var style = s;
				switch (token) {
					case WHITE_TAB:
						if (this.whitespacesVisible) {
							style = tabStyle;
						}
						break;
					case WHITE_SPACE:
						if (this.whitespacesVisible) {
							style = spaceStyle;
						}
						break;
				}
				if (style) {
					styles.push({start: tokenStart, end: scanner.getOffset() + offset, style: style});
				}
			}
		},
		_detectHyperlinks: function(text, offset, styles, s) {
			var href = null, index, linkStyle;
			if ((index = text.indexOf("://")) > 0) { //$NON-NLS-0$
				href = text;
				var start = index;
				while (start > 0) {
					var c = href.charCodeAt(start - 1);
					if (!((97 <= c && c <= 122) || (65 <= c && c <= 90) || 0x2d === c || (48 <= c && c <= 57))) { //LETTER OR DASH OR NUMBER
						break;
					}
					start--;
				}
				if (start > 0) {
					var brackets = "\"\"''(){}[]<>"; //$NON-NLS-0$
					index = brackets.indexOf(href.substring(start - 1, start));
					if (index !== -1 && (index & 1) === 0 && (index = href.lastIndexOf(brackets.substring(index + 1, index + 2))) !== -1) {
						var end = index;
						linkStyle = this._clone(s);
						linkStyle.tagName = "a"; //$NON-NLS-0$
						linkStyle.attributes = {href: href.substring(start, end)};
						styles.push({start: offset, end: offset + start, style: s});
						styles.push({start: offset + start, end: offset + end, style: linkStyle});
						styles.push({start: offset + end, end: offset + text.length, style: s});
						return null;
					}
				}
			} else if (text.toLowerCase().indexOf("bug#") === 0) { //$NON-NLS-0$
				href = "https://bugs.eclipse.org/bugs/show_bug.cgi?id=" + parseInt(text.substring(4), 10); //$NON-NLS-0$
			}
			if (href) {
				linkStyle = this._clone(s);
				linkStyle.tagName = "a"; //$NON-NLS-0$
				linkStyle.attributes = {href: href};
				return linkStyle;
			}
			return s;
		},
		_clone: function(obj) {
			if (!obj) { return obj; }
			var newObj = {};
			for (var p in obj) {
				if (obj.hasOwnProperty(p)) {
					var value = obj[p];
					newObj[p] = value;
				}
			}
			return newObj;
		},
		_findComments: function(text, offset) {
			offset = offset || 0;
			var scanner = this._firstScanner, token;
			scanner.setText(text);
			var result = [];
			while ((token = scanner.nextToken())) {
				if (token === MULTILINE_COMMENT || token === DOC_COMMENT || token === MULTILINE_STRING) {
					result.push({
						start: scanner.getStartOffset() + offset,
						end: scanner.getOffset() + offset,
						type: token
					});
				}
				if (token === SINGLELINE_COMMENT || token === MULTILINE_COMMENT || token === DOC_COMMENT) {
					//TODO can we avoid this work if edition does not overlap comment?
					this._computeTasks(token, scanner.getStartOffset() + offset, scanner.getOffset() + offset);
				}
			}
			return result;
		},
		_findMatchingBracket: function(model, offset) {
			var brackets = BRACKETS;
			var bracket = model.getText(offset, offset + 1);
			var bracketIndex = brackets.indexOf(bracket, 0);
			if (bracketIndex === -1) { return -1; }
			var closingBracket;
			if (bracketIndex & 1) {
				closingBracket = brackets.substring(bracketIndex - 1, bracketIndex);
			} else {
				closingBracket = brackets.substring(bracketIndex + 1, bracketIndex + 2);
			}
			var lineIndex = model.getLineAtOffset(offset);
			var lineText = model.getLine(lineIndex);
			var lineStart = model.getLineStart(lineIndex);
			var lineEnd = model.getLineEnd(lineIndex);
			brackets = this._findBrackets(bracket, closingBracket, lineText, lineStart, lineStart, lineEnd);
			for (var i=0; i<brackets.length; i++) {
				var sign = brackets[i] >= 0 ? 1 : -1;
				if (brackets[i] * sign - 1 === offset) {
					var level = 1;
					if (bracketIndex & 1) {
						i--;
						for (; i>=0; i--) {
							sign = brackets[i] >= 0 ? 1 : -1;
							level += sign;
							if (level === 0) {
								return brackets[i] * sign - 1;
							}
						}
						lineIndex -= 1;
						while (lineIndex >= 0) {
							lineText = model.getLine(lineIndex);
							lineStart = model.getLineStart(lineIndex);
							lineEnd = model.getLineEnd(lineIndex);
							brackets = this._findBrackets(bracket, closingBracket, lineText, lineStart, lineStart, lineEnd);
							for (var j=brackets.length - 1; j>=0; j--) {
								sign = brackets[j] >= 0 ? 1 : -1;
								level += sign;
								if (level === 0) {
									return brackets[j] * sign - 1;
								}
							}
							lineIndex--;
						}
					} else {
						i++;
						for (; i<brackets.length; i++) {
							sign = brackets[i] >= 0 ? 1 : -1;
							level += sign;
							if (level === 0) {
								return brackets[i] * sign - 1;
							}
						}
						lineIndex += 1;
						var lineCount = model.getLineCount ();
						while (lineIndex < lineCount) {
							lineText = model.getLine(lineIndex);
							lineStart = model.getLineStart(lineIndex);
							lineEnd = model.getLineEnd(lineIndex);
							brackets = this._findBrackets(bracket, closingBracket, lineText, lineStart, lineStart, lineEnd);
							for (var k=0; k<brackets.length; k++) {
								sign = brackets[k] >= 0 ? 1 : -1;
								level += sign;
								if (level === 0) {
									return brackets[k] * sign - 1;
								}
							}
							lineIndex++;
						}
					}
					break;
				}
			}
			return -1;
		},
		_findBrackets: function(bracket, closingBracket, text, textOffset, start, end) {
			var result = [];
			var bracketToken = bracket.charCodeAt(0);
			var closingBracketToken = closingBracket.charCodeAt(0);
			// for any sub range that is not a comment, parse code generating tokens (keywords, numbers, brackets, line comments, etc)
			var offset = start, scanner = this._scanner, token, comments = this.comments;
			var startIndex = this._binarySearch(comments, start, true);
			for (var i = startIndex; i < comments.length; i++) {
				if (comments[i].start >= end) { break; }
				var commentStart = comments[i].start;
				var commentEnd = comments[i].end;
				if (offset < commentStart) {
					scanner.setText(text.substring(offset - start, commentStart - start));
					while ((token = scanner.nextToken())) {
						if (token === bracketToken) {
							result.push(scanner.getStartOffset() + offset - start + textOffset + 1);
						} else if (token === closingBracketToken) {
							result.push(-(scanner.getStartOffset() + offset - start + textOffset + 1));
						}
					}
				}
				offset = commentEnd;
			}
			if (offset < end) {
				scanner.setText(text.substring(offset - start, end - start));
				while ((token = scanner.nextToken())) {
					if (token === bracketToken) {
						result.push(scanner.getStartOffset() + offset - start + textOffset + 1);
					} else if (token === closingBracketToken) {
						result.push(-(scanner.getStartOffset() + offset - start + textOffset + 1));
					}
				}
			}
			return result;
		},
		_onDestroy: function(e) {
			this.destroy();
		},
		_onLineStyle: function (e) {
			if (e.textView === this.view) {
				e.style = this._getLineStyle(e.lineIndex);
			}
			e.ranges = this._getStyles(e.textView.getModel(), e.lineText, e.lineStart);
		},
		_onSelection: function(e) {
			var oldSelections = Array.isArray(e.oldValue) ? e.oldValue : [e.oldValue];
			var newSelections = Array.isArray(e.newValue) ? e.newValue : [e.newValue];
			var view = this.view;
			var model = view.getModel();
			var lineIndex;
			if (this.highlightCaretLine) {
				function getHighlightLines(selections) {
					var lines = {};
					if (selections.some(function(selection) {
						if (selection.isEmpty()) {
							lines[model.getLineAtOffset(selection.start).toString()] = true;
						} else {
							return true;
						}
						return false;
					})) return {};
					return lines;
				}
				var oldLines = getHighlightLines(oldSelections);
				var newLines = getHighlightLines(newSelections);
				function redraw(o, n) {
					for (var p in o) {
						if (!n[p]) {
							lineIndex = p >> 0;
							view.redrawLines(lineIndex, lineIndex + 1);
						}
					}
				}
				redraw(oldLines, newLines);
				redraw(newLines, oldLines);
			}
			if (!this.annotationModel) { return; }
			var remove = this._bracketAnnotations, add, caret;
			if (newSelections.length === 1 && newSelections[0].isEmpty() && (caret = newSelections[0].getCaret()) > 0) {
				var mapCaret = caret - 1;
				if (model.getBaseModel) {
					mapCaret = model.mapOffset(mapCaret);
					model = model.getBaseModel();
				}
				var bracket = this._findMatchingBracket(model, mapCaret);
				if (bracket !== -1) {
					add = [
						mAnnotations.AnnotationType.createAnnotation(mAnnotations.AnnotationType.ANNOTATION_MATCHING_BRACKET, bracket, bracket + 1),
						mAnnotations.AnnotationType.createAnnotation(mAnnotations.AnnotationType.ANNOTATION_CURRENT_BRACKET, mapCaret, mapCaret + 1)
					];
				}
			}
			this._bracketAnnotations = add;
			this.annotationModel.replaceAnnotations(remove, add);
		},
		_onMouseDown: function(e) {
			if (e.clickCount !== 2) { return; }
			var view = this.view;
			var model = view.getModel();
			var offset = view.getOffsetAtLocation(e.x, e.y);
			if (offset > 0) {
				var mapOffset = offset - 1;
				var baseModel = model;
				if (model.getBaseModel) {
					mapOffset = model.mapOffset(mapOffset);
					baseModel = model.getBaseModel();
				}
				var bracket = this._findMatchingBracket(baseModel, mapOffset);
				if (bracket !== -1) {
					e.preventDefault();
					var mapBracket = bracket;
					if (model.getBaseModel) {
						mapBracket = model.mapOffset(mapBracket, true);
					}
					if (offset > mapBracket) {
						offset--;
						mapBracket++;
					}
					view.setSelection(mapBracket, offset);
				}
			}
		},
		_onModelChanged: function(e) {
			var start = e.start;
			var removedCharCount = e.removedCharCount;
			var addedCharCount = e.addedCharCount;
			var changeCount = addedCharCount - removedCharCount;
			var view = this.view;
			var viewModel = view.getModel();
			var baseModel = viewModel.getBaseModel ? viewModel.getBaseModel() : viewModel;
			var end = start + removedCharCount;
			var charCount = baseModel.getCharCount();
			var commentCount = this.comments.length;
			var lineStart = baseModel.getLineStart(baseModel.getLineAtOffset(start));
			var commentStart = this._binarySearch(this.comments, lineStart, true);
			var commentEnd = this._binarySearch(this.comments, end, false, commentStart - 1, commentCount);

			var ts;
			if (commentStart < commentCount && this.comments[commentStart].start <= lineStart && lineStart < this.comments[commentStart].end) {
				ts = this.comments[commentStart].start;
				if (ts > start) { ts += changeCount; }
			} else {
				if (commentStart === commentCount && commentCount > 0 && charCount - changeCount === this.comments[commentCount - 1].end) {
					ts = this.comments[commentCount - 1].start;
				} else {
					ts = lineStart;
				}
			}
			var te;
			if (commentEnd < commentCount) {
				te = this.comments[commentEnd].end;
				if (te > start) { te += changeCount; }
				commentEnd += 1;
			} else {
				commentEnd = commentCount;
				te = charCount;//TODO could it be smaller?
			}
			var text = baseModel.getText(ts, te), comment;
			var newComments = this._findComments(text, ts), i;
			for (i = commentStart; i < this.comments.length; i++) {
				comment = this.comments[i];
				if (comment.start > start) { comment.start += changeCount; }
				if (comment.start > start) { comment.end += changeCount; }
			}
			var redraw = (commentEnd - commentStart) !== newComments.length;
			if (!redraw) {
				for (i=0; i<newComments.length; i++) {
					comment = this.comments[commentStart + i];
					var newComment = newComments[i];
					if (comment.start !== newComment.start || comment.end !== newComment.end || comment.type !== newComment.type) {
						redraw = true;
						break;
					}
				}
			}
			var args = [commentStart, commentEnd - commentStart].concat(newComments);
			Array.prototype.splice.apply(this.comments, args);
			if (redraw) {
				var redrawStart = ts;
				var redrawEnd = te;
				if (viewModel !== baseModel) {
					redrawStart = viewModel.mapOffset(redrawStart, true);
					redrawEnd = viewModel.mapOffset(redrawEnd, true);
				}
				view.redrawRange(redrawStart, redrawEnd);
			}

			if (this.foldingEnabled && baseModel !== viewModel && this.annotationModel) {
				var annotationModel = this.annotationModel;
				var iter = annotationModel.getAnnotations(ts, te);
				var remove = [], all = [];
				var annotation;
				while (iter.hasNext()) {
					annotation = iter.next();
					if (annotation.type === mAnnotations.AnnotationType.ANNOTATION_FOLDING) {
						all.push(annotation);
						for (i = 0; i < newComments.length; i++) {
							if (annotation.start === newComments[i].start && annotation.end === newComments[i].end) {
								break;
							}
						}
						if (i === newComments.length) {
							remove.push(annotation);
							annotation.expand();
						} else {
							var annotationStart = annotation.start;
							var annotationEnd = annotation.end;
							if (annotationStart > start) {
								annotationStart -= changeCount;
							}
							if (annotationEnd > start) {
								annotationEnd -= changeCount;
							}
							if (annotationStart <= start && start < annotationEnd && annotationStart <= end && end < annotationEnd) {
								var startLine = baseModel.getLineAtOffset(annotation.start);
								var endLine = baseModel.getLineAtOffset(annotation.end);
								if (startLine !== endLine) {
									if (!annotation.expanded) {
										annotation.expand();
									}
								} else {
									annotationModel.removeAnnotation(annotation);
								}
							}
						}
					}
				}
				var add = [];
				for (i = 0; i < newComments.length; i++) {
					comment = newComments[i];
					for (var j = 0; j < all.length; j++) {
						if (all[j].start === comment.start && all[j].end === comment.end) {
							break;
						}
					}
					if (j === all.length) {
						annotation = this._createFoldingAnnotation(viewModel, baseModel, comment.start, comment.end);
						if (annotation) {
							add.push(annotation);
						}
					}
				}
				annotationModel.replaceAnnotations(remove, add);
			}
		}
	};

	return {TextStyler: TextStyler};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 *               Alex Lakatos - fix for bug#369781
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/textStyler", ['orion/editor/annotations', 'orion/editor/eventTarget', 'orion/metrics'], //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	function(mAnnotations, mEventTarget, mMetrics) {

	/*
	 * Throughout textStyler "block" refers to a potentially multi-line token.
	 * Typical examples are multi-line comments and multi-line strings.
	 */

	var binarySearch = function(array, offset, inclusive, low, high) {
		var index;
		if (low === undefined) { low = -1; }
		if (high === undefined) { high = array.length; }
		while (high - low > 1) {
			index = Math.floor((high + low) / 2);
			if (offset <= array[index].start) {
				high = index;
			} else if (inclusive && offset < array[index].end) {
				high = index;
				break;
			} else {
				low = index;
			}
		}
		return high;
	};
	
	function copy(object) {
		return JSON.parse(JSON.stringify(object));
	}

	var createPatternBasedAdapter = function(grammars, rootId, contentType) {
		return new PatternBasedAdapter(grammars, rootId, contentType);
	};

	function PatternBasedAdapter(grammars, rootId, contentType) {
		this._patternManager = new PatternManager(grammars, rootId);
		this._contentType = contentType;
	}
	PatternBasedAdapter.prototype = {
		blockSpansBeyondEnd: function(block) {
			return block.pattern.regexEnd === this._eolRegex;
		},
		computeBlocks: function(model, text, block, offset, startIndex, endIndex, maxBlockCount) {
			if (!text) {
				return [];
			}

			var results = [];
			var matches = [];
			startIndex = startIndex || 0;
			endIndex = endIndex || Infinity;
			maxBlockCount = maxBlockCount || Infinity;
			block.blockPatterns.forEach(function(current) {
				var result = this._findMatch(current.regexBegin || current.regex, text, startIndex);
				if (result) {
					matches.push({result: result, pattern: current});
				}
			}.bind(this));
			if (!matches.length) {
				return results;
			}
			matches.sort(function(a,b) {
				if (a.result.index < b.result.index) {
					return -1;
				}
				if (a.result.index > b.result.index) {
					return 1;
				}
				return a.pattern.pattern.index < b.pattern.pattern.index ? -1 : 1;
			});

			var index = 0;
			while (matches.length > 0) {
				var current = matches[0];
				matches.splice(0,1);

				if (endIndex < current.result.index) {
					break;
				}

				if (current.result.index < index) {
					/* processing of another match has moved index beyond this match */
					this._updateMatch(current, text, matches, index, endIndex);
					continue;
				}

				var start = offset + current.result.index;
				var contentStart = current.result.index;
				var resultEnd = null;

				var endRegex = current.pattern.regexEnd;
				if (!endRegex) {
					resultEnd = this.createBlock(
						{
							start: start,
							end: start + current.result[0].length,
							contentStart: start,
							contentEnd: start + current.result[0].length
						},
						block.styler,
						model,
						block,
						current.pattern);
				} else {
					contentStart += current.result[0].length;
					var testPattern = current.pattern;
					/*
					 * If the end regex contains a capture reference (eg.- "\1") then substitute
					 * the resolved capture values from the begin match.
					 */
					var resolvedEndRegex = this._substituteCaptureValues(endRegex, current.result);
					if (resolvedEndRegex !== endRegex) {
						/*
						 * A substitution was made, so make a copy of the test pattern and set its
						 * end regex to the resolved one.  This will cause end-match detection to be
						 * performed with this concrete end regex value, but the original pattern
						 * definition containing the capture reference will not be affected.
						 */
						testPattern = {
							pattern: testPattern.pattern,
							regexBegin: testPattern.regexBegin,
							regexEnd: resolvedEndRegex
						};
						endRegex = resolvedEndRegex;
					}

					var lastIndex = contentStart;
					while (!resultEnd) {
						var result = this._findMatch(endRegex, text, lastIndex);
						if (!result) {
							this._eolRegex.lastIndex = 0;
							result = this._eolRegex.exec(text);
							testPattern = {
								pattern: testPattern.pattern,
								regexBegin: testPattern.regexBegin,
								regexEnd: this._eolRegex
							};
						}
						var testBlock = this.createBlock(
							{
								start: start,
								end: offset + result.index + result[0].length,
								contentStart: offset + contentStart,
								contentEnd: offset + result.index
							},
							block.styler,
							model,
							block,
							testPattern);
						var subBlocks = testBlock.getBlocks();
						if (!subBlocks.length || subBlocks[subBlocks.length - 1].end <= (result.index + offset)) {
							resultEnd = testBlock;
						}
						lastIndex = result.index + result[0].length;
					}
				}
				results.push(resultEnd);
				if (results.length === maxBlockCount || endIndex <= resultEnd.end) {
					break;
				}
				index = resultEnd.end - offset;
				this._updateMatch(current, text, matches, index, endIndex);
			}
			return results;
		},
		computeStyle: function(block, model, offset) {
			if (!block.pattern) {
				return null;
			}

			var fullBlock = {
				start: block.start,
				end: block.end,
				style: block.pattern.pattern.name
			};
			if (block.contentStart <= offset && offset < block.contentEnd) {
				if (block.pattern.pattern.contentName) {
					return {
						start: block.contentStart,
						end: block.contentEnd,
						style: block.pattern.pattern.contentName
					};
				}
				return fullBlock;
			}

			var regex, captures, testString, index;
			if (offset < block.contentStart) {
				captures = block.pattern.pattern.beginCaptures || block.pattern.pattern.captures;
				if (!captures) {
					return fullBlock;
				}
				regex = block.pattern.regexBegin;
				testString = model.getText(block.start, block.contentStart);
				index = block.start;
			} else {
				captures = block.pattern.pattern.endCaptures || block.pattern.pattern.captures;
				if (!captures) {
					return fullBlock;
				}
				regex = block.pattern.regexEnd;
				testString = model.getText(block.contentEnd, block.end);
				index = block.contentEnd;
			}

			regex.lastIndex = 0;
			var result = regex.exec(testString);
			if (result) {
				var styles = [];
				this._getCaptureStyles(result, captures, index, styles);
				var style = styles[binarySearch(styles, offset, true)];
				if (style && style.start <= offset && offset < style.end) {
					return style;
				}
			}
			return fullBlock;
		},
		createBlock: function(bounds, styler, model, parent, data) {
			/* for pattern-based matching data is a pattern */
			return new Block(
				bounds,
				data ? data.pattern.name : null,
				data ? data.pattern.id : null,
				styler,
				model,
				parent,
				function(newBlock) {
					newBlock.pattern = data;
					newBlock.linePatterns = [];
					newBlock.blockPatterns = [];
					newBlock.enclosurePatterns = {};
					this._initPatterns(this._patternManager, newBlock);
				}.bind(this));
		},
		getBlockContentStyleName: function(block) {
			return block.pattern.pattern.contentName || block.pattern.pattern.name;
		},
		getBlockEndStyle: function(block, text, endIndex, _styles) {
			/* pattern-defined blocks specify an end style by either a capture or name */
			var result;
			if (block.pattern.regexEnd) {
				result = this._findMatch(block.pattern.regexEnd, text, 0);
				if (result) {
					/* the end match is still valid */
					var captures = block.pattern.pattern.endCaptures || block.pattern.pattern.captures;
					if (captures) {
						this._getCaptureStyles(result, captures, endIndex - result[0].length, _styles);
					} else if (block.pattern.pattern.name) {
						_styles.push({start: endIndex - result[0].length, end: endIndex, style: block.pattern.pattern.name});
					}
				}
			}
			return result ? result[0] : null;
		},
		getBlockStartStyle: function(block, text, index, _styles) {
			/* pattern-defined blocks specify a start style by either a capture or name */
			var result;
			if (block.pattern.regexBegin) {
				result = this._findMatch(block.pattern.regexBegin, text, 0);
				if (result) {
					/* the begin match is still valid */
					var captures = block.pattern.pattern.beginCaptures || block.pattern.pattern.captures;
					if (captures) {
						this._getCaptureStyles(result, captures, index, _styles);
					} else {
						_styles.push({start: index, end: index + result[0].length, style: block.pattern.pattern.name});
					}
				}
			}
			return result ? result[0] : null;
		},
		getBracketMatch: function(block, text) {
			var match;
			var keys = Object.keys(block.enclosurePatterns);
			for (var i = 0; i < keys.length; i++) {
				var current = block.enclosurePatterns[keys[i]];
				var result = this._findMatch(current.regex, text, 0);
				if (result && result.index === 0) {
					match = current;
					break;
				}
			}
			if (!match) { return null; }

			var closingName;
			var atStart = false;
			if (match.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN) !== -1) {
				atStart = true;
				closingName = match.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN, this._PUNCTUATION_SECTION_END);
			} else {
				closingName = match.pattern.name.replace(this._PUNCTUATION_SECTION_END, this._PUNCTUATION_SECTION_BEGIN);
			}
			var closingBracket = block.enclosurePatterns[closingName];
			if (!closingBracket) { return null; }

			return {
				beginName: match.pattern.name,
				endName: closingName,
				atStart: atStart
			};
		},
		getContentType: function() {
			return this._contentType;
		},
		parse: function(text, offset, block, _styles, ignoreCaptures) {
			if (!text) {
				return;
			}
			var patterns = block.linePatterns;
			if (!patterns) {
				return;
			}

			var matches = [];
			patterns.forEach(function(current) {
				var regex = current.regex || current.regexBegin;
				regex.oldLastIndex = regex.lastIndex;
				var result = this._findMatch(regex, text, 0);
				if (result) {
					matches.push({result: result, pattern: current});
				}
			}.bind(this));
			matches.sort(function(a,b) {
				if (a.result.index < b.result.index) {
					return -1;
				}
				if (a.result.index > b.result.index) {
					return 1;
				}
				return a.pattern.pattern.index < b.pattern.pattern.index ? -1 : 1;
			});

			var index = 0;
			while (matches.length > 0) {
				var current = matches[0];
				matches.splice(0,1);

				if (current.result.index < index) {
					/* processing of another match has moved index beyond this match */
					this._updateMatch(current, text, matches, index);
					continue;
				}

				/* apply the style */
				var start = current.result.index;
				var end, result;
				var substyles = [];
				if (current.pattern.regex) {	/* line pattern defined by a "match" */
					result = current.result;
					end = start + result[0].length;
					var tokenStyle = {start: offset + start, end: offset + end, style: current.pattern.pattern.name};
					if (!ignoreCaptures) {
						if (current.pattern.pattern.captures) {
							this._getCaptureStyles(result, current.pattern.pattern.captures, offset + start, substyles);
						}
						substyles.sort(function(a,b) {
							if (a.start < b.start) {
								return -1;
							}
							if (a.start > b.start) {
								return 1;
							}
							return 0;
						});
						for (var j = 0; j < substyles.length - 1; j++) {
							if (substyles[j + 1].start < substyles[j].end) {
								var newStyle = {start: substyles[j + 1].end, end: substyles[j].end, style: substyles[j].style};
								substyles[j].end = substyles[j + 1].start;
								substyles.splice(j + 2, 0, newStyle);
							}
						}
					}
					this._mergeStyles(tokenStyle, substyles, _styles);
				} else {	/* pattern defined by a "begin/end" pair */
					/*
					 * If the end match contains a capture reference (eg.- "\1") then update
					 * its regex with the resolved capture values from the begin match.
					 */
					var endRegex = current.pattern.regexEnd;
					endRegex = this._substituteCaptureValues(endRegex, current.result);

					result = this._findMatch(endRegex, text, current.result.index + current.result[0].length);
					if (!result) {
						this._eolRegex.lastIndex = 0;
						result = this._eolRegex.exec(text);
					}
					end = result.index + result[0].length;
					_styles.push({start: offset + start, end: offset + end, style: current.pattern.pattern.name});
				}
				index = result.index + result[0].length;
				this._updateMatch(current, text, matches, index);
			}
			patterns.forEach(function(current) {
				var regex = current.regex || current.regexBegin;
				regex.lastIndex = regex.oldLastIndex;
			});
		},
		setStyler: function(/*styler*/) {
		},
		verifyBlock: function(baseModel, text, ancestorBlock, changeCount) {
			var result = null;
			var matches = [];
			var parentBlock = ancestorBlock.parent;
			parentBlock.blockPatterns.forEach(function(current) {
				var match = this._findMatch(current.regexBegin || current.regex, text, 0);
				if (match) {
					matches.push({result: match, pattern: current});
				}
			}.bind(this));
			matches.sort(function(a,b) {
				/* ensure that matches at index 0 make it to the front, other matches do not matter */
				if (!a.result.index && b.result.index) {
					return -1;
				}
				if (a.result.index && !b.result.index) {
					return 1;
				}
				if (!a.result.index && !b.result.index) {
					return a.pattern.pattern.index < b.pattern.pattern.index ? -1 : 1;
				}
				return 0;
			});
			if (!matches.length || matches[0].result.index !== 0 || matches[0].pattern.pattern.id !== ancestorBlock.pattern.pattern.id) {
				result = false;
			} else {
				/* the block start appears to be unchanged, now verify that the block end is unchanged */
				var match = matches[0];
				var endRegex = match.pattern.regexEnd;
				if (!endRegex) {
					/* single-match block, just verify its length */
					result = ancestorBlock.start + match.result[0].length === ancestorBlock.end + changeCount;
				} else {
					/* begin/end-match block */

					 /*
					  * Determine whether an earlier match of the block's end pattern has been introduced.
					  * Verifying that this has NOT happened (the most typical case) can be quickly done by
					  * verifying that the first occurrence of its end pattern is still at its former location.
					  * However if a match is found prior to this then the blocks preceding it must be computed
					  * to verify that it is a valid end match (ie.- it is not contained within another block).
				 	  */

					/*
					 * If the end regex contains a capture reference (eg.- "\1") then substitute
					 * the resolved capture values from the begin match.
					 */
					endRegex = this._substituteCaptureValues(endRegex, match.result);

					var searchStartIndex = match.result[0].length;
					var currentMatch = this._findMatch(endRegex, text, searchStartIndex);
					while (result === null && currentMatch && ancestorBlock.start + currentMatch.index !== ancestorBlock.contentEnd + changeCount) {
						/*
						 * A match was found preceeding the former end match, so now compute
						 * blocks to determine whether it is in fact a valid new end match.
						 */
						var blocks = this.computeBlocks(baseModel, text, ancestorBlock, ancestorBlock.start, searchStartIndex, currentMatch.index + 1, null);
						if (!blocks.length || blocks[blocks.length - 1].end <= ancestorBlock.start + currentMatch.index) {
							/* the match is valid, so the attempt to use ancestorBlock as-is fails */
							result = false;
						} else {
							/* the match is not valid, so search for the next potential end match */
							if (!blocks.length) {
								currentMatch = null;
							} else {
								searchStartIndex = blocks[blocks.length - 1].end - ancestorBlock.start;
								currentMatch = this._findMatch(endRegex, text, searchStartIndex);
							}
						}
					}
					if (!currentMatch) {
						this._eolRegex.lastIndex = 0;
						currentMatch = this._eolRegex.exec(text);
						result = ancestorBlock.start + currentMatch.index === ancestorBlock.end + changeCount;
					}
				}
			}
			return result !== null ? result : true;
		},

		/** @private */

		_findMatch: function(regex, text, startIndex, testBeforeMatch) {
			/*
			 * testBeforeMatch provides a potential optimization for callers that do not strongly expect to find
			 * a match.  If this argument is defined then test() is initially called on the regex, which executes
			 * significantly faster than exec().  If a match is found then the regex's lastIndex is reverted to
			 * its pre-test() value, and exec() is then invoked on it in order to get the match details.
			 */

			var index = startIndex;
			var initialLastIndex = regex.lastIndex;
			this._linebreakRegex.lastIndex = startIndex;

			var currentLine = this._linebreakRegex.exec(text);
			/*
			 * Processing of the first line is treated specially, as it may not start at the beginning of a logical line, but
			 * regex's may be dependent on matching '^'.  To resolve this, compute the full line corresponding to the start
			 * of the text, even if it begins prior to startIndex, and adjust the regex's lastIndex accordingly to begin searching
			 * for matches at the correct location.
			 */
			var lineString, indexAdjustment;
			regex.lastIndex = 0;
			if (currentLine) {
				var lineStart = currentLine.index;
				while (0 <= --lineStart) {
					var char = text.charAt(lineStart);
					if (char === this._NEWLINE || char === this._CR) {
						break;
					}
				}
				lineString = text.substring(lineStart + 1, currentLine.index + currentLine[1].length);
				regex.lastIndex = indexAdjustment = currentLine.index - lineStart - 1;
			}
			while (currentLine && currentLine.index < text.length) {
				var result;
				if (testBeforeMatch) {
					var revertIndex = regex.lastIndex;
					if (regex.test(lineString)) {
						regex.lastIndex = revertIndex;
						result = regex.exec(lineString);
					}
				} else {
					result = regex.exec(lineString);
				}
				if (result) {
					result.index += index;
					result.index -= indexAdjustment;
					regex.lastIndex = initialLastIndex;
					return result;
				}
				indexAdjustment = 0;
				index += currentLine[0].length;
				currentLine = this._linebreakRegex.exec(text);
				if (currentLine) {
					lineString = currentLine[1];
					regex.lastIndex = 0;
				}
			}
			regex.lastIndex = initialLastIndex;
			return null;
		},
		_getCaptureStyles: function(result, captures, offset, _styles) {
			if (captures[0]) {
				/* capture index 0 is the full result */
				_styles.push({start: offset, end: offset + result[0].length, style: captures[0].name});
				return;
			}

			var stringIndex = 0;
			for (var i = 1; i < result.length; i++) {
				if (result[i]) {
					var capture = captures[i];
					if (capture) {
						var styleStart = offset + stringIndex;
						_styles.push({start: styleStart, end: styleStart + result[i].length, style: capture.name});
					}
					stringIndex += result[i].length;
				}
			}
		},
		_initPatterns: function(patternManager, block) {
			if (block.pattern && block.pattern.pattern.linePatterns) {
				block.linePatterns = block.pattern.pattern.linePatterns;
				block.blockPatterns = block.pattern.pattern.blockPatterns;
				block.enclosurePatterns = block.pattern.pattern.enclosurePatterns;
				return;
			}
			var patterns = patternManager.getPatterns(block.pattern ? block.pattern.pattern : null);
			var initRegex = function(match) {
				var matchString = typeof(match) === "string" ? match : match.match;
				var result = this._ignoreCaseRegex.exec(matchString);
				var flags = this._FLAGS;
				if (result) {
					matchString = matchString.substring(result[0].length);
					flags += "i";
				}
				return new RegExp(matchString, flags);
			}.bind(this);
			var lastBlock = -1;
			var index = 0;
			patterns.forEach(function(current) {
				var pattern;
				if (current.match && !current.begin && !current.end) {
					pattern = {regex: initRegex(current.match), pattern: current};
					block.linePatterns.push(pattern);
					if (current.name && current.name.indexOf("punctuation.section") === 0 && (current.name.indexOf(this._PUNCTUATION_SECTION_BEGIN) !== -1 || current.name.indexOf(this._PUNCTUATION_SECTION_END) !== -1)) { //$NON-NLS-0$
						block.enclosurePatterns[current.name] = pattern;
					}
				} else if (!current.match && current.begin && current.end) {
					lastBlock = index;
					pattern = {regexBegin: initRegex(current.begin), regexEnd: initRegex(current.end), pattern: current};
					block.linePatterns.push(pattern);
				}
				index++;
			}.bind(this));
			block.blockPatterns = block.linePatterns.slice(0, lastBlock + 1);
			if (block.pattern) {
				block.pattern.pattern.enclosurePatterns = block.enclosurePatterns;
				block.pattern.pattern.linePatterns = block.linePatterns;
				block.pattern.pattern.blockPatterns = block.blockPatterns;
			}
		},
		_mergeStyles: function(fullStyle, substyles, resultStyles) {
			var i = fullStyle.start;
			substyles.forEach(function(current) {
				if (i <= current.start) {
					resultStyles.push({start: i, end: current.start, style: fullStyle.style});
				}
				resultStyles.push(current);
				i = current.end;
			});
			if (i < fullStyle.end) {
				resultStyles.push({start: i, end: fullStyle.end, style: fullStyle.style});
			}
		},
		_substituteCaptureValues: function(regex, resolvedResult) {
			var regexString = regex.toString();
			this._captureReferenceRegex.lastIndex = 0;
			if (!this._captureReferenceRegex.test(regexString)) {
				/* nothing to do */
				return regex;
			}

			this._captureReferenceRegex.lastIndex = 0;
			var result = this._captureReferenceRegex.exec(regexString);
			while (result) {
				regexString = regexString.replace(result[0], resolvedResult[result[1]] || "");
				this._captureReferenceRegex.lastIndex = 0;
				result = this._captureReferenceRegex.exec(regexString);
			}
			/* return an updated regex, remove the leading '/' and trailing /FLAGS */
			return new RegExp(regexString.substring(1, regexString.length - 1 - this._FLAGS.length), this._FLAGS);
		},
		_updateMatch: function(match, text, matches, minimumIndex, endIndex) {
			var regEx = match.pattern.regex ? match.pattern.regex : match.pattern.regexBegin;
			endIndex = endIndex || Infinity;
			var result = this._findMatch(regEx, text, minimumIndex, true);
			if (result && result.index < endIndex) {
				match.result = result;
				for (var i = 0; i < matches.length; i++) {
					if (result.index < matches[i].result.index || (result.index === matches[i].result.index && match.pattern.pattern.index < matches[i].pattern.pattern.index)) {
						matches.splice(i, 0, match);
						return;
					}
				}
				matches.push(match);
			}
		},
		_captureReferenceRegex: /\\(\d)/g,
		_eolRegex: /$/,
		_ignoreCaseRegex: /^\(\?i\)\s*/,
		_linebreakRegex: /(.*)(?:[\r\n]|$)/g,
		_CR: "\r", //$NON-NLS-0$
		_FLAGS: "g", //$NON-NLS-0$
		_NEWLINE: "\n", //$NON-NLS-0$
		_PUNCTUATION_SECTION_BEGIN: ".begin", //$NON-NLS-0$
		_PUNCTUATION_SECTION_END: ".end" //$NON-NLS-0$
	};

	function PatternManager(grammars, rootId) {
		this._unnamedCounter = 0;
		this._patterns = [];
		this._rootId = rootId;
		grammars.forEach(function(grammar) {
			this._addRepositoryPatterns(grammar.repository || {}, grammar.id);
			this._addPatterns(grammar.patterns || [], grammar.id);
		}.bind(this));
	}
	PatternManager.prototype = {
		getPatterns: function(pattern) {
			var parentId;
			if (!pattern) {
				parentId = this._rootId + "#" + this._NO_ID;
			} else {
				if (typeof(pattern) === "string") { //$NON-NLS-0$
					parentId = pattern;
				} else {
					parentId = pattern.qualifiedId;
				}
				parentId += "#";
			}
			/* indexes on patterns are used to break ties when multiple patterns match the same start text */
			var indexCounter = [0];
			var resultObject = {};
			var regEx = new RegExp("^" + parentId + "[^#]+$"); //$NON-NLS-0$
			this._patterns.forEach(function(current) {
				if (regEx.test(current.qualifiedId)) {
					if (current.include) {
						this._processInclude(current, indexCounter, resultObject);
					} else {
						var newPattern = copy(current);
						newPattern.index = indexCounter[0]++;
						resultObject[current.id] = newPattern;
					}
				}
			}.bind(this));

			var result = [];
			var keys = Object.keys(resultObject);
			keys.forEach(function(current) {
				result.push(resultObject[current]);
			});
			return result;
		},

		/** @private */

		_addPattern: function(pattern, patternId, parentId) {
			pattern.parentId = parentId;
			pattern.id = patternId;
			pattern.qualifiedId = pattern.parentId + "#" + pattern.id;
			this._patterns.push(pattern);
			if (pattern.patterns && !pattern.include) {
				this._addPatterns(pattern.patterns, pattern.qualifiedId);
			}
		},
		_addPatterns: function(patterns, parentId) {
			patterns.forEach(function(pattern) {
				this._addPattern(pattern, this._NO_ID + this._unnamedCounter++, parentId);
			}.bind(this));
		},
		_addRepositoryPatterns: function(repository, parentId) {
			var keys = Object.keys(repository);
			keys.forEach(function(key) {
				this._addPattern(repository[key], key, parentId);
			}.bind(this));
		},
		_processInclude: function(pattern, indexCounter, resultObject) {
			var searchExp;
			var index = pattern.include.indexOf("#");
			if (index === 0) {
				/* inclusion of pattern from same grammar */
				searchExp = new RegExp("^" + pattern.qualifiedId.substring(0, pattern.qualifiedId.indexOf("#")) + pattern.include + "$");
			} else if (index === -1) {
				/* inclusion of whole grammar */
				searchExp = new RegExp("^" + pattern.include + "#" + this._NO_ID + "[^#]+$");
			} else {
				/* inclusion of specific pattern from another grammar */
				searchExp = new RegExp("^" + pattern.include + "$");
			}
			this._patterns.forEach(function(current) {
				if (searchExp.test(current.qualifiedId)) {
					if (current.include) {
						this._processInclude(current, indexCounter, resultObject);
					} else if (!resultObject[current.id]) {
						var newPattern = copy(current);
						newPattern.index = indexCounter[0]++;
						resultObject[current.id] = newPattern;
					}
				}
			}.bind(this));
		},
		_NO_ID: "NoID"	//$NON-NLS-0$
	};

	function Block(bounds, name, typeId, styler, model, parent, initFn) {
		this.start = bounds.start;
		this.end = bounds.end;
		this.contentStart = bounds.contentStart;
		this.contentEnd = bounds.contentEnd;
		this.name = name;
		this.typeId = typeId;
		this.styler = styler;
		this.parent = parent;
		if (initFn) {
			initFn(this);
		}
		this._subBlocks = styler.computeBlocks(model, model.getText(this.contentStart, this.end), this, this.contentStart, null, null, null);
	}
	Block.prototype = {
		adjustBounds: function(index, value) {
			if (index < this.start) {
				this.start += value;
			}
			if (index < this.contentStart) {
				this.contentStart += value;
			}
			if (index <= this.end) {
				this.end += value;
			}
			if (index <= this.contentEnd) {
				this.contentEnd += value;
			}
			this._subBlocks.forEach(function(current) {
				if (index <= current.end) {
					current.adjustBounds(index, value);
				}
			});
		},
		getBlocks: function() {
			return this._subBlocks;
		},
		getBlockAtIndex: function(index) {
			return binarySearch(this.getBlocks(), index, true);
		},
		isRenderingWhitespace: function() {
			return this.styler._isRenderingWhitespace();
		}
	};

	function TextStylerAccessor(styler) {
		this._styler = styler;
	}
	TextStylerAccessor.prototype = {
		getStyles: function(offset) {
			return this._styler.getStyles(offset);
		}
	};

	function TextStyler(view, annotationModel, stylerAdapter) {		
		this._whitespacesVisible = false;
		this._highlightCaretLine = false;
		this._foldingEnabled = true;
		this._detectTasks = true;
		this._annotationProviders = [];
		this._view = view;
		this._annotationModel = annotationModel;
		this._stylerAdapter = stylerAdapter;
		this._stylerAdapter.setStyler(this);
		this._accessor = new TextStylerAccessor(this);
		this._bracketAnnotations;

		var self = this;
		this._listener = {
			onChanged: function(e) {
				self._onModelChanged(e);
			},
			onDestroy: function(e) {
				self._onDestroy(e);
			},
			onLineStyle: function(e) {
				self._onLineStyle(e);
			},
			onMouseDown: function(e) {
				self._onMouseDown(e);
			},
			onSelection: function(e) {
				self._onSelection(e);
			}
		};
		var model = view.getModel();
		if (model.getBaseModel) {
			model = model.getBaseModel();
		}
		model.addEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
		view.addEventListener("MouseDown", this._listener.onMouseDown); //$NON-NLS-0$
		view.addEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
		view.addEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
		view.addEventListener("LineStyle", this._listener.onLineStyle); //$NON-NLS-0$

		var charCount = model.getCharCount();
		var rootBounds = {start: 0, contentStart: 0, end: charCount, contentEnd: charCount};
		if (charCount >= 50000) {
			var startTime = new Date().getTime();
		}
		this._rootBlock = this._stylerAdapter.createBlock(rootBounds, this, model, null);
		if (startTime) {
			var interval = new Date().getTime() - startTime;
			if (interval > 10) {
				mMetrics.logTiming(
					"editor", //$NON-NLS-0$
					"styler compute blocks (ms/50000 chars)", //$NON-NLS-0$
					interval * 50000 / charCount,
					stylerAdapter.getContentType());
			}
		}
		if (annotationModel) {
			var add = [];
			annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_FOLDING);
			this._computeFolding(this._rootBlock.getBlocks(), view.getModel(), add);
			if (this._detectTasks) {
				annotationModel.removeAnnotations(mAnnotations.AnnotationType.ANNOTATION_TASK);
				this._computeTasks(this._rootBlock, model, add);
			}
			annotationModel.replaceAnnotations([], add);
		}
		view.redrawLines();
	}
	TextStyler.prototype = {
		addAnnotationProvider: function(value) {
			if (typeof value === "function") { //$NON-NLS-0$
				this._annotationProviders.push(value);
			}
		},
		computeBlocks: function(model, text, block, offset, startIndex, endIndex, maxBlockCount) {
			return this._stylerAdapter.computeBlocks(model, text, block, offset, startIndex, endIndex, maxBlockCount);
		},
		destroy: function() {
			if (this._view) {
				var model = this._view.getModel();
				if (model.getBaseModel) {
					model = model.getBaseModel();
				}
				model.removeEventListener("Changed", this._listener.onChanged); //$NON-NLS-0$
				this._view.removeEventListener("MouseDown", this._listener.onMouseDown); //$NON-NLS-0$
				this._view.removeEventListener("Selection", this._listener.onSelection); //$NON-NLS-0$
				this._view.removeEventListener("Destroy", this._listener.onDestroy); //$NON-NLS-0$
				this._view.removeEventListener("LineStyle", this._listener.onLineStyle); //$NON-NLS-0$
				this._view = null;
			}
		},
		getAnnotationModel: function() {
			return this._annotationModel;
		},
		getBlockAtIndex: function(index) {
			return this._findBlock(this._rootBlock, index);
		},
		getRootBlock: function() {
			return this._rootBlock;
		},
		getStyleAccessor: function() {
			return this._accessor;
		},
		getStyles: function(offset) {
			var result = [];
			var model = this._view.getModel();
			if (model.getBaseModel) {
				model = model.getBaseModel();
			}
			var block = this._findBlock(this._rootBlock, offset);
			var lineIndex = model.getLineAtOffset(offset);
			var lineText = model.getLine(lineIndex);
			var styles = [];
			this._stylerAdapter.parse(lineText, model.getLineStart(lineIndex), block, styles);
			var style = styles[binarySearch(styles, offset, true)];
			if (style && style.start <= offset && offset < style.end) {
				result.push(style);
			}
			while (block) {
				style = this._stylerAdapter.computeStyle(block, model, offset);
				if (style) {
					result.splice(0, 0, style);
				}
				block = block.parent;
			}
			return result;
		},
		getTextModel: function() {
			var model = this._view.getModel();
			if (model.getBaseModel) {
				model = model.getBaseModel();
			}
			return model;
		},
		removeAnnotationProvider: function(value) {
			if (typeof value !== "function") { //$NON-NLS-0$
				return;
			}
			var index = this._annotationProviders.indexOf(value);
			if (index !== -1) {
				this._annotationProviders.splice(index, 1);
			}
		},
		setDetectHyperlinks: function() {
		},
		setDetectTasks: function(enabled) {
			this._detectTasks = enabled;
		},
		setFoldingEnabled: function(enabled) {
			this._foldingEnabled = enabled;
		},
		setHighlightCaretLine: function(highlight) {
			this._highlightCaretLine = highlight;
		},
		setWhitespacesVisible: function(visible, redraw) {
			if (this._whitespacesVisible === visible) { return; }
			this._whitespacesVisible = visible;
			if (redraw) {
				this._view.redraw();
			}
		},

		/** @private */

		_computeFolding: function(blocks, viewModel, _add) {
			if (!viewModel.getBaseModel) { return; }
			var baseModel = viewModel.getBaseModel();
			blocks.forEach(function(block) {
				var annotation = this._createFoldingAnnotation(viewModel, baseModel, block.start, block.end);
				if (annotation) {
					_add.push(annotation);
				}
				this._computeFolding(block.getBlocks(), viewModel, _add);
			}.bind(this));
		},
		_computeTasks: function(block, baseModel, annotations, start, end) {
			start = start || block.start;
			end = end || block.end;
			if (block.start <= end && start <= block.end) {
				if (!this._annotationModel) { return; }

				var annotationType = mAnnotations.AnnotationType.ANNOTATION_TASK;
				if (block.name && block.name.indexOf("comment") === 0) {
					var substyles = [];
					this._stylerAdapter.parse(baseModel.getText(block.contentStart, block.end), block.contentStart, block, substyles, true);
					for (var i = 0; i < substyles.length; i++) {
						if (substyles[i].style === "meta.annotation.task.todo" && start <= substyles[i].start && substyles[i].end <= end) {
							annotations.push(mAnnotations.AnnotationType.createAnnotation(annotationType, substyles[i].start, substyles[i].end, baseModel.getText(substyles[i].start, substyles[i].end)));
						}
					}
				}

				block.getBlocks().forEach(function(current) {
					this._computeTasks(current, baseModel, annotations, start, end);
				}.bind(this));
			}
		},
		_createFoldingAnnotation: function(viewModel, baseModel, start, end) {
			var startLine = baseModel.getLineAtOffset(start);
			var endLine = baseModel.getLineAtOffset(end);
			if (startLine === endLine) {
				return null;
			}
			if (startLine + 1 === endLine && baseModel.getLineStart(endLine) === baseModel.getLineEnd(endLine)) {
				return null;
			}
			return new (mAnnotations.AnnotationType.getType(mAnnotations.AnnotationType.ANNOTATION_FOLDING))(start, end, viewModel);
		},
		_findBlock: function(parentBlock, offset) {
			var blocks = parentBlock.getBlocks();
			if (!blocks.length) {
				return parentBlock;
			}

			var index = binarySearch(blocks, offset, true);
			if (index < blocks.length && blocks[index].start <= offset && offset < blocks[index].end) {
				return this._findBlock(blocks[index], offset);
			}
			return parentBlock;
		},
		_findBrackets: function(bracketMatch, block, text, start, end) {
			var result = [], styles = [];
			var offset = start, blocks = block.getBlocks();
			var startIndex = binarySearch(blocks, start, true);
			for (var i = startIndex; i < blocks.length; i++) {
				if (blocks[i].start >= end) { break; }
				var blockStart = blocks[i].start;
				var blockEnd = blocks[i].end;
				if (offset < blockStart) {
					this._stylerAdapter.parse(text.substring(offset - start, blockStart - start), offset, block, styles);
					styles.forEach(function(current) {
						if (current.style) {
							if (current.style.indexOf(bracketMatch.beginName) === 0) {
								result.push(current.start + 1);
							} else if (current.style.indexOf(bracketMatch.endName) === 0) {
								result.push(-(current.start + 1));
							}
						}
					});
					styles = [];
				}
				offset = blockEnd;
			}
			if (offset < end) {
				this._stylerAdapter.parse(text.substring(offset - start, end - start), offset, block, styles);
				styles.forEach(function(current) {
					if (current.style) {
						if (current.style.indexOf(bracketMatch.beginName) === 0) {
							result.push(current.start + 1);
						} else if (current.style.indexOf(bracketMatch.endName) === 0) {
							result.push(-(current.start + 1));
						}
					}
				});
			}
			return result;
		},
		_findMatchingBracket: function(model, block, offset) {
			var lineIndex = model.getLineAtOffset(offset);
			var lineEnd = model.getLineEnd(lineIndex);
			var text = model.getText(offset, lineEnd);

			var bracketMatch = this._stylerAdapter.getBracketMatch(block, text);
			if (!bracketMatch) { return -1; }

			var lineText = model.getLine(lineIndex);
			var lineStart = model.getLineStart(lineIndex);
			var brackets = this._findBrackets(bracketMatch, block, lineText, lineStart, lineEnd);
			for (var i = 0; i < brackets.length; i++) {
				var sign = brackets[i] >= 0 ? 1 : -1;
				if (brackets[i] * sign - 1 === offset) {
					var level = 1;
					if (!bracketMatch.atStart) {
						i--;
						for (; i>=0; i--) {
							sign = brackets[i] >= 0 ? 1 : -1;
							level += sign;
							if (level === 0) {
								return brackets[i] * sign - 1;
							}
						}
						lineIndex -= 1;
						while (lineIndex >= 0) {
							lineText = model.getLine(lineIndex);
							lineStart = model.getLineStart(lineIndex);
							lineEnd = model.getLineEnd(lineIndex);
							brackets = this._findBrackets(bracketMatch, block, lineText, lineStart, lineEnd);
							for (var j = brackets.length - 1; j >= 0; j--) {
								sign = brackets[j] >= 0 ? 1 : -1;
								level += sign;
								if (level === 0) {
									return brackets[j] * sign - 1;
								}
							}
							lineIndex--;
						}
					} else {
						i++;
						for (; i<brackets.length; i++) {
							sign = brackets[i] >= 0 ? 1 : -1;
							level += sign;
							if (level === 0) {
								return brackets[i] * sign - 1;
							}
						}
						lineIndex += 1;
						var lineCount = model.getLineCount();
						while (lineIndex < lineCount) {
							lineText = model.getLine(lineIndex);
							lineStart = model.getLineStart(lineIndex);
							lineEnd = model.getLineEnd(lineIndex);
							brackets = this._findBrackets(bracketMatch, block, lineText, lineStart, lineEnd);
							for (var k=0; k<brackets.length; k++) {
								sign = brackets[k] >= 0 ? 1 : -1;
								level += sign;
								if (level === 0) {
									return brackets[k] * sign - 1;
								}
							}
							lineIndex++;
						}
					}
					break;
				}
			}
			return -1;
		},
		_getLineStyle: function(lineIndex) {
			if (this._highlightCaretLine) {
				var view = this._view;
				var model = view.getModel();
				var selections = view.getSelections();
				var hasCaret = false;
				if (!selections.some(function(selection) {
					if (selection.start === selection.end) {
						hasCaret = hasCaret || model.getLineAtOffset(selection.start) === lineIndex;
						return false;
					}
					return true;
				}) && hasCaret) return this._caretLineStyle;
			}
			return null;
		},
		_getStyles: function(block, model, text, start) {
			if (model.getBaseModel) {
				start = model.mapOffset(start);
			}
			var end = start + text.length;

			var styles = [];
			var offset = start, blocks = block.getBlocks();
			var startIndex = binarySearch(blocks, start, true);
			for (var i = startIndex; i < blocks.length; i++) {
				if (blocks[i].start >= end) { break; }
				var blockStart = blocks[i].start;
				var blockEnd = blocks[i].end;
				if (offset < blockStart) {
					/* content on that line that preceeds the start of the block */
					this._stylerAdapter.parse(text.substring(offset - start, blockStart - start), offset, block, styles);
				}
				var s = Math.max(offset, blockStart);
				if (s === blockStart) {
					/* currently in the block's "start" segment */
					var startString = this._stylerAdapter.getBlockStartStyle(blocks[i], text.substring(s - start), s, styles);
					if (startString) {
						s += startString.length;
					}
				}

				/*
				 * Compute the block end now in order to determine the end-bound of the contained content, but do not add
				 * its styles to the styles array until content styles have been computed, so that ordering is preserved.
				 */
				var e = Math.min(end, blockEnd);
				var endStyles = [];
				if (e === blockEnd) {
					/* currently in the block's "end" segment */
					var testString = text.substring(e - offset - (blocks[i].end - blocks[i].contentEnd));
					var endString = this._stylerAdapter.getBlockEndStyle(blocks[i], testString, e, endStyles);
					if (endString) {
						e -= endString.length;
					}
				}

				var blockSubstyles = this._getStyles(blocks[i], model, text.substring(s - start, e - start), s);
				var blockStyleName = this._stylerAdapter.getBlockContentStyleName(blocks[i]);
				if (blockStyleName) {
					/*
					 * If a name was specified for the current block then apply its style throughout its
					 * content wherever a style is not provided by a sub-element.
					 */
					var index = s;
					blockSubstyles.forEach(function(current) {
						if (current.start - index) {
							styles.push({start: index, end: current.start, style: blockStyleName});
						}
						if (current.mergeable) {
							current.style += "," + blockStyleName;
						}
						styles.push(current);
						index = current.end;
					});
					if (e - index) {
						styles.push({start: index, end: e, style: blockStyleName});
					}
				} else {
					styles = styles.concat(blockSubstyles);
				}
				styles = styles.concat(endStyles);
				offset = blockEnd;
			}
			if (offset < end) {
				/* content on that line that follows the end of the block */
				this._stylerAdapter.parse(text.substring(offset - start, end - start), offset, block, styles);
			}
			if (model.getBaseModel) {
				for (var j = 0; j < styles.length; j++) {
					var length = styles[j].end - styles[j].start;
					styles[j].start = model.mapOffset(styles[j].start, true);
					styles[j].end = styles[j].start + length;
				}
			}
			return styles;
		},
		_isRenderingWhitespace: function() {
			return this._whitespacesVisible;
		},
		_onDestroy: function() {
			this.destroy();
		},
		_onLineStyle: function(e) {
			if (e.textView === this._view) {
				e.style = this._getLineStyle(e.lineIndex);
			}
			e.ranges = this._getStyles(this._rootBlock, e.textView.getModel(), e.lineText, e.lineStart);
			e.ranges.forEach(function(current) {
				if (current.style) {
					current.style = {styleClass: current.style.replace(/\./g, " ")};
				}
			});
			if (this._isRenderingWhitespace()) {
				this._spliceStyles(this._spacePattern, e.ranges, e.lineText, e.lineStart);
				this._spliceStyles(this._tabPattern, e.ranges, e.lineText, e.lineStart);
			}
		},
		_onModelChanged: function(e) {
			var start = e.start;
			var removedCharCount = e.removedCharCount;
			var addedCharCount = e.addedCharCount;
			var changeCount = addedCharCount - removedCharCount;
			var viewModel = this._view.getModel();
			var baseModel = viewModel.getBaseModel ? viewModel.getBaseModel() : viewModel;
			var end = start + removedCharCount;
			var charCount = baseModel.getCharCount();

			/* compute the nearest ancestor block to the start and end indices */
			var lineStart = baseModel.getLineStart(baseModel.getLineAtOffset(start));
			var ancestorBlock = this._findBlock(this._rootBlock, start);

			var blockExtended, blocks, parentBlock, redraw, text, te, ts;
			do {
				parentBlock = ancestorBlock.parent;

				/*
				 * Determine whether ancestorBlock contains the full range of
				 * text whose styling may be affected by this model change.
				 */
				if (!blockExtended && parentBlock) {
					/* verify that ancestorBlock's start and end bounds are not affected by this change */
					if (changeCount < 0 && ancestorBlock.end - start <= -changeCount) {
						/* the end bound has definitely been affected, no verifyBlock() required, move up to the parent */
						ancestorBlock = parentBlock;
						continue;
					}
					text = baseModel.getText(ancestorBlock.start, Math.min(charCount, ancestorBlock.end + changeCount + 1));
					if (!this._stylerAdapter.verifyBlock(baseModel, text, ancestorBlock, changeCount)) {
						ancestorBlock = parentBlock;
						continue;
					}
				}

				/*
				 * The change has not directly changed ancestorBlock's start/end strings, now verify that its end
				 * bound is still valid (ie.- ensure that a new block is not extending beyond the end bound).
				 */

				blocks = ancestorBlock.getBlocks();
				var blockCount = blocks.length;
				var blockStart = binarySearch(blocks, lineStart, true);
				var blockEnd = binarySearch(blocks, end, false, blockStart - 1, blockCount);

				/*
				 * If the change immediately follows the preceding block then test whether
				 * the block should be extended.
				 */
				blockExtended = false;
				if (blockStart && blocks.length && blocks[blockStart - 1].end === start) {
					text = baseModel.getText(blocks[blockStart - 1].start, Math.min(charCount, start + 1));
					var tempBlocks = this.computeBlocks(baseModel, text, ancestorBlock, blocks[blockStart - 1].start, null, null, null);
					if (tempBlocks.length && tempBlocks[0].end !== blocks[blockStart - 1].end) {
						/* the change has affected the preceding block's end, so include this block */
						blockStart--;
						blockExtended = true;
					}
				}

				if (blockStart < blockCount && blocks[blockStart].start <= lineStart && (lineStart < blocks[blockStart].end || blockExtended)) {
					ts = blocks[blockStart].start;
					if (ts > start) { ts += changeCount; }
				} else if (blockStart === blockCount && blockCount > 0 && ancestorBlock.end - changeCount === blocks[blockCount - 1].end) {
					ts = blocks[--blockStart].start;
					if (ts > start) { ts += changeCount; }
				} else {
					ts = Math.max(lineStart, ancestorBlock.contentStart);
				}

				if (blockEnd < blockCount) {
					te = blocks[blockEnd].end;
				} else {
					te = ancestorBlock.contentEnd;
				}
				if (start <= te) { te += changeCount; }
				te = Math.min(te, charCount - 1);
				text = baseModel.getText(ts, te + 1);
				var newBlocks = this.computeBlocks(baseModel, text, ancestorBlock, ts, null, null, null);

				if (blockEnd < blockCount) {
					/* ensure that blockEnd's end is preserved */
					if (newBlocks.length && newBlocks[newBlocks.length - 1].end === te && newBlocks[newBlocks.length - 1].typeId === blocks[blockEnd].typeId) {
						break;
					}

					/*
					 * ancestorBlock's end match is no longer valid because it is being spanned by a block from
					 * within.  Attempt to find a subsequent sibling block with the same type, as its end match
					 * will serve as the end match for this spanning block as well.
					 */
					if (newBlocks.length && this._stylerAdapter.blockSpansBeyondEnd(newBlocks[newBlocks.length - 1])) {
						blockEnd++;
						var subBlocks = newBlocks[newBlocks.length - 1].getBlocks();
						var spanningTypeId = (subBlocks.length ? subBlocks[subBlocks.length - 1] : newBlocks[newBlocks.length - 1]).typeId;
						while (blockEnd < blockCount) {
							if (blocks[blockEnd].typeId === spanningTypeId) {
								/* found a potential end block, must verify it */
								var tempTe = blocks[blockEnd].end + changeCount;
								tempTe = Math.min(tempTe, charCount - 1);
								text = baseModel.getText(ts, tempTe + 1);
								var tempNewBlocks = this.computeBlocks(baseModel, text, ancestorBlock, ts, null, null, null);
								if (tempNewBlocks.length && tempNewBlocks[tempNewBlocks.length - 1].end === tempTe) {
									/* verified, can now stop looking */
									te = tempTe;
									newBlocks = tempNewBlocks;
									break;
								}
							}
							blockEnd++;
						}
						if (blockEnd < blockCount) {
							break;
						}
					}
				} else {
					/* ensure that ancestorBlock's end is preserved */
					if (!newBlocks.length || newBlocks[newBlocks.length - 1].end <= ancestorBlock.contentEnd + changeCount) {
						break;
					}
				}

				/*
				 * The end block's end bound is spanned by a block from within, so move up to the ancestor
				 * block, or extend end to the end of the content if already at the root-level block.
				 */

				if (!parentBlock) {
					te = charCount;
					blockEnd = blockCount;
					text = baseModel.getText(ts, te);
					newBlocks = this.computeBlocks(baseModel, text, ancestorBlock, ts, null, null, null);
					break;
				}

				ancestorBlock = parentBlock;
				redraw = true; /* blocks may not appear to be changed in the context of the parent block */
			} while (true);

			this._rootBlock.adjustBounds(start, changeCount);
			blockEnd = Math.min(blockEnd + 1, blockCount);

			var block;
			if (!redraw) {
				redraw = (blockEnd - blockStart) !== newBlocks.length;
			}
			if (!redraw) {
				for (var i = 0; i < newBlocks.length; i++) {
					block = blocks[blockStart + i];
					var newBlock = newBlocks[i];
					if (block.start !== newBlock.start || block.end !== newBlock.end || block.typeId !== newBlock.typeId) {
						redraw = true;
						break;
					}
				}
			}

			if (!blocks.length && !newBlocks.length) {
				this.dispatchEvent({
					type: "BlocksChanged", //$NON-NLS-0$
					oldBlocks: [ancestorBlock],
					newBlocks: [ancestorBlock]
				});
			} else {
				this.dispatchEvent({
					type: "BlocksChanged", //$NON-NLS-0$
					oldBlocks: blocks.slice(blockStart, blockEnd),
					newBlocks: newBlocks
				});
			}

			var args = [blockStart, blockEnd - blockStart].concat(newBlocks);
			Array.prototype.splice.apply(blocks, args);
			if (redraw) {
				var redrawStart = ts;
				var redrawEnd = te;
				if (viewModel !== baseModel) {
					redrawStart = viewModel.mapOffset(redrawStart, true);
					redrawEnd = viewModel.mapOffset(redrawEnd, true);
				}
				this._view.redrawRange(redrawStart, redrawEnd);
			}

			if (this._annotationModel) {
				var remove = [], add = [];
				var allFolding = [];
				var iter = this._annotationModel.getAnnotations(ts, te);
				var doFolding = this._foldingEnabled && baseModel !== viewModel;
				var parent = ancestorBlock.parent || ancestorBlock;
				while (iter.hasNext()) {
					var annotation = iter.next();
					if (doFolding && annotation.type === mAnnotations.AnnotationType.ANNOTATION_FOLDING) {
						allFolding.push(annotation);
						block = this._findBlock(parent, annotation.start);
						if (!(block && annotation.start === block.start && annotation.end === block.end)) {
							remove.push(annotation);
							annotation.expand();
						} else {
							var annotationStart = annotation.start;
							var annotationEnd = annotation.end;
							if (annotationStart > start) {
								annotationStart -= changeCount;
							}
							if (annotationEnd > start) {
								annotationEnd -= changeCount;
							}
							if (annotationStart <= start && start < annotationEnd && annotationStart <= end && end < annotationEnd) {
								var startLine = baseModel.getLineAtOffset(annotation.start);
								var endLine = baseModel.getLineAtOffset(annotation.end);
								if (startLine !== endLine) {
									if (!annotation.expanded) {
										annotation.expand();
									}
								} else {
									remove.push(annotation);
								}
							}
						}
					} else if (annotation.type === mAnnotations.AnnotationType.ANNOTATION_TASK) {
						if (ancestorBlock.start <= annotation.start && annotation.end <= ancestorBlock.end) {
							remove.push(annotation);
						}
					}
				}
				if (doFolding) {
					parent.getBlocks().forEach(function(block) {
						this._updateFolding(block, baseModel, viewModel, allFolding, add, ts, te);
					}.bind(this));
				}
				if (this._detectTasks) {
					this._computeTasks(ancestorBlock, baseModel, add, ts, te);
				}
				this._annotationProviders.forEach(function(current) {
					var providerRemove = [];
					var providerAdd = [];
					current(this._annotationModel, baseModel, ancestorBlock, ts, te, providerRemove, providerAdd);
					remove = remove.concat(providerRemove);
					add = add.concat(providerAdd);
				}.bind(this));
				this._annotationModel.replaceAnnotations(remove, add);
			}
		},
		_onMouseDown: function(e) {
			if (e.clickCount !== 2) { return; }
			var model = this._view.getModel();
			var offset = this._view.getOffsetAtLocation(e.x, e.y);
			if (offset > 0) {
				var mapOffset = offset - 1;
				var baseModel = model;
				if (model.getBaseModel) {
					mapOffset = model.mapOffset(mapOffset);
					baseModel = model.getBaseModel();
				}
				var block = this._findBlock(this._rootBlock, mapOffset);
				var bracket = this._findMatchingBracket(baseModel, block, mapOffset);
				if (bracket !== -1) {
					e.preventDefault();
					var mapBracket = bracket;
					if (model.getBaseModel) {
						mapBracket = model.mapOffset(mapBracket, true);
					}
					if (offset > mapBracket) {
						offset--;
						mapBracket++;
					}
					this._view.setSelection(mapBracket, offset);
				}
			}
		},
		_onSelection: function(e) {
			var oldSelections = Array.isArray(e.oldValue) ? e.oldValue : [e.oldValue];
			var newSelections = Array.isArray(e.newValue) ? e.newValue : [e.newValue];
			var view = this._view;
			var model = view.getModel();
			var lineIndex;
			if (this._highlightCaretLine) {
				function getHighlightLines(selections) {
					var lines = {};
					if (selections.some(function(selection) {
						if (selection.isEmpty()) {
							lines[model.getLineAtOffset(selection.start).toString()] = true;
						} else {
							return true;
						}
						return false;
					})) return {};
					return lines;
				}
				var oldLines = getHighlightLines(oldSelections);
				var newLines = getHighlightLines(newSelections);
				function redraw(o, n) {
					for (var p in o) {
						if (!n[p]) {
							lineIndex = p >> 0;
							view.redrawLines(lineIndex, lineIndex + 1);
						}
					}
				}
				redraw(oldLines, newLines);
				redraw(newLines, oldLines);
			}
			if (!this._annotationModel) { return; }

			var remove = this._bracketAnnotations, add, caret;
			if (newSelections.length === 1 && newSelections[0].isEmpty() && (caret = newSelections[0].getCaret()) > 0) {
				var mapCaret = caret - 1;
				if (model.getBaseModel) {
					mapCaret = model.mapOffset(mapCaret);
					model = model.getBaseModel();
				}
				var block = this._findBlock(this._rootBlock, mapCaret);
				var bracket = this._findMatchingBracket(model, block, mapCaret);
				if (bracket !== -1) {
					add = [
						mAnnotations.AnnotationType.createAnnotation(mAnnotations.AnnotationType.ANNOTATION_MATCHING_BRACKET, bracket, bracket + 1),
						mAnnotations.AnnotationType.createAnnotation(mAnnotations.AnnotationType.ANNOTATION_CURRENT_BRACKET, mapCaret, mapCaret + 1)
					];
				}
			}
			this._bracketAnnotations = add;
			this._annotationModel.replaceAnnotations(remove, add);
		},
		_spliceStyles: function(whitespacePattern, ranges, text, offset) {
			var regex = whitespacePattern.regex;
			regex.lastIndex = 0;
			var rangeIndex = 0;
			var result = regex.exec(text);
			while (result) {
				var charIndex = offset + result.index;
				while (rangeIndex < ranges.length) {
					if (charIndex < ranges[rangeIndex].end) {
						break;
					}
					rangeIndex++;
				}
				var newStyle = {
					start: charIndex,
					end: charIndex + 1,
					style: whitespacePattern.style
				};
				if (rangeIndex < ranges.length && ranges[rangeIndex].start <= charIndex) {
					var endStyle = {start: charIndex + 1, end: ranges[rangeIndex].end, style: ranges[rangeIndex].style};
					ranges[rangeIndex].end = charIndex;
					ranges.splice(rangeIndex + 1, 0, endStyle);
					ranges.splice(rangeIndex + 1, 0, newStyle);
					rangeIndex += 2;
				} else {
					ranges.splice(rangeIndex, 0, newStyle);
					rangeIndex++;
				}
				result = regex.exec(text);
			}
		},
		_updateFolding: function(block, baseModel, viewModel, allFolding, _add, start, end) {
			start = start || block.start;
			end = end || block.end;
			if (!block.doNotFold && block.start <= end && start <= block.end) {
				var index = binarySearch(allFolding, block.start, true);
				if (!(index < allFolding.length && allFolding[index].start === block.start && allFolding[index].end === block.end)) {
					var annotation = this._createFoldingAnnotation(viewModel, baseModel, block.start, block.end);
					if (annotation) {
						_add.push(annotation);
					}
				}
				block.getBlocks().forEach(function(current) {
					this._updateFolding(current, baseModel, viewModel, allFolding, _add, start, end);
				}.bind(this));
			}
		},
		_caretLineStyle: {styleClass: "meta annotation currentLine"}, //$NON-NLS-0$
		_spacePattern: {regex: /[ ]/g, style: {styleClass: "punctuation separator space", unmergeable: true}}, //$NON-NLS-0$
		_tabPattern: {regex: /\t/g, style: {styleClass: "punctuation separator tab", unmergeable: true}} //$NON-NLS-0$
	};

	mEventTarget.EventTarget.addMixin(TextStyler.prototype);

	return {
		TextStyler: TextStyler,
		Block: Block,
		createPatternBasedAdapter: createPatternBasedAdapter
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation 
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/textMateStyler", ['orion/regex' ], function(mRegex) {

var RegexUtil = {
	// Rules to detect some unsupported Oniguruma features
	unsupported: [
		{regex: /\(\?[ims\-]:/, func: function(match) { return "option on/off for subexp"; }},
		{regex: /\(\?<([=!])/, func: function(match) { return (match[1] === "=") ? "lookbehind" : "negative lookbehind"; }},
		{regex: /\(\?>/, func: function(match) { return "atomic group"; }}
	],
	
	/**
	 * @param {String} str String giving a regular expression pattern from a TextMate grammar.
	 * @param {String} [flags] [ismg]+
	 * @returns {RegExp}
	 */
	toRegExp: function(str) {
		function fail(feature, match) {
			throw new Error("Unsupported regex feature \"" + feature + "\": \"" + match[0] + "\" at index: "
					+ match.index + " in " + match.input);
		}
		// Turns an extended regex pattern into a normal one
		function normalize(/**String*/ str) {
			var result = "";
			var insideCharacterClass = false;
			var len = str.length;
			for (var i=0; i < len; ) {
				var chr = str.charAt(i);
				if (!insideCharacterClass && chr === "#") {
					// skip to eol
					while (i < len && chr !== "\r" && chr !== "\n") {
						chr = str.charAt(++i);
					}
				} else if (!insideCharacterClass && /\s/.test(chr)) {
					// skip whitespace
					while (i < len && /\s/.test(chr)) { 
						chr = str.charAt(++i);
					}
				} else if (chr === "\\") {
					result += chr;
					if (!/\s/.test(str.charAt(i+1))) {
						result += str.charAt(i+1);
						i += 1;
					}
					i += 1;
				} else if (chr === "[") {
					insideCharacterClass = true;
					result += chr;
					i += 1;
				} else if (chr === "]") {
					insideCharacterClass = false;
					result += chr;
					i += 1;
				} else {
					result += chr;
					i += 1;
				}
			}
			return result;
		}
		
		var flags = "";
		var i;
		
		// Handle global "x" flag (whitespace/comments)
		str = RegexUtil.processGlobalFlag("x", str, function(subexp) {
				return normalize(subexp);
			});
		
		// Handle global "i" flag (case-insensitive)
		str = RegexUtil.processGlobalFlag("i", str, function(subexp) {
				flags += "i";
				return subexp;
			});
		
		// Check for remaining unsupported syntax
		for (i=0; i < this.unsupported.length; i++) {
			var match;
			if ((match = this.unsupported[i].regex.exec(str))) {
				fail(this.unsupported[i].func(match), match);
			}
		}
		
		return new RegExp(str, flags);
	},
	
	/**
	 * Checks if flag applies to entire pattern. If so, obtains replacement string by calling processor
	 * on the unwrapped pattern. Handles 2 possible syntaxes: (?f)pat and (?f:pat)
	 * @param {String} flag
	 * @param {String} str
	 * @param {Function} processor
	 */
	processGlobalFlag: function(flag, str, processor) {
		function getMatchingCloseParen(/*String*/pat, /*Number*/start) {
			var depth = 0,
			    len = pat.length,
			    flagStop = -1;
			for (var i=start; i < len && flagStop === -1; i++) {
				switch (pat.charAt(i)) {
					case "\\":
						i++; // escape: skip next char
						break;
					case "(":
						depth++;
						break;
					case ")":
						depth--;
						if (depth === 0) {
							flagStop = i;
						}
						break;
				}
			}
			return flagStop;
		}
		var flag1 = "(?" + flag + ")",
		    flag2 = "(?" + flag + ":";
		if (str.substring(0, flag1.length) === flag1) {
			return processor(str.substring(flag1.length));
		} else if (str.substring(0, flag2.length) === flag2) {
			var flagStop = getMatchingCloseParen(str, 0);
			if (flagStop < str.length-1) {
				throw new Error("Only a " + flag2 + ") group that encloses the entire regex is supported in: " + str);
			}
			return processor(str.substring(flag2.length, flagStop));
		}
		return str;
	},
	
	hasBackReference: function(/**RegExp*/ regex) {
		return (/\\\d+/).test(regex.source);
	},
	
	/** @returns {RegExp} A regex made by substituting any backreferences in <code>regex</code> for the value of the property
	 * in <code>sub</code> with the same name as the backreferenced group number. */
	getSubstitutedRegex: function(/**RegExp*/ regex, /**Object*/ sub, /**Boolean*/ escape) {
		escape = (typeof escape === "undefined") ? true : false;
		var exploded = regex.source.split(/(\\\d+)/g);
		var array = [];
		for (var i=0; i < exploded.length; i++) {
			var term = exploded[i];
			var backrefMatch = /\\(\d+)/.exec(term);
			if (backrefMatch) {
				var text = sub[backrefMatch[1]] || "";
				array.push(escape ? mRegex.escape(text) : text);
			} else {
				array.push(term);
			}
		}
		return new RegExp(array.join(""));
	},
	
	/**
	 * Builds a version of <code>regex</code> with every non-capturing term converted into a capturing group. This is a workaround
	 * for JavaScript's lack of API to get the index at which a matched group begins in the input string.<p>
	 * Using the "groupified" regex, we can sum the lengths of matches from <i>consuming groups</i> 1..n-1 to obtain the 
	 * starting index of group n. (A consuming group is a capturing group that is not inside a lookahead assertion).</p>
	 * Example: groupify(/(a+)x+(b+)/) === /(a+)(x+)(b+)/<br />
	 * Example: groupify(/(?:x+(a+))b+/) === /(?:(x+)(a+))(b+)/
	 * @param {RegExp} regex The regex to groupify.
	 * @param {Object} [backRefOld2NewMap] Optional. If provided, the backreference numbers in regex will be updated using the 
	 * properties of this object rather than the new group numbers of regex itself.
	 * <ul><li>[0] {RegExp} The groupified version of the input regex.</li>
	 * <li>[1] {Object} A map containing old-group to new-group info. Each property is a capturing group number of <code>regex</code>
	 * and its value is the corresponding capturing group number of [0].</li>
	 * <li>[2] {Object} A map indicating which capturing groups of [0] are also consuming groups. If a group number is found
	 * as a property in this object, then it's a consuming group.</li></ul>
	 */
	groupify: function(regex, backRefOld2NewMap) {
		var NON_CAPTURING = 1,
		    CAPTURING = 2,
		    LOOKAHEAD = 3,
		    NEW_CAPTURING = 4;
		var src = regex.source,
		    len = src.length;
		var groups = [],
		    lookaheadDepth = 0,
		    newGroups = [],
		    oldGroupNumber = 1,
		    newGroupNumber = 1;
		var result = [],
		    old2New = {},
		    consuming = {};
		for (var i=0; i < len; i++) {
			var curGroup = groups[groups.length-1];
			var chr = src.charAt(i);
			switch (chr) {
				case "(":
					// If we're in new capturing group, close it since ( signals end-of-term
					if (curGroup === NEW_CAPTURING) {
						groups.pop();
						result.push(")");
						newGroups[newGroups.length-1].end = i;
					}
					var peek2 = (i + 2 < len) ? (src.charAt(i+1) + "" + src.charAt(i+2)) : null;
					if (peek2 === "?:" || peek2 === "?=" || peek2 === "?!") {
						// Found non-capturing group or lookahead assertion. Note that we preserve non-capturing groups
						// as such, but any term inside them will become a new capturing group (unless it happens to
						// also be inside a lookahead).
						var groupType;
						if (peek2 === "?:") {
							groupType = NON_CAPTURING;
						} else {
							groupType = LOOKAHEAD;
							lookaheadDepth++;
						}
						groups.push(groupType);
						newGroups.push({ start: i, end: -1, type: groupType /*non capturing*/ });
						result.push(chr);
						result.push(peek2);
						i += peek2.length;
					} else {
						groups.push(CAPTURING);
						newGroups.push({ start: i, end: -1, type: CAPTURING, oldNum: oldGroupNumber, num: newGroupNumber });
						result.push(chr);
						if (lookaheadDepth === 0) {
							consuming[newGroupNumber] = null;
						}
						old2New[oldGroupNumber] = newGroupNumber;
						oldGroupNumber++;
						newGroupNumber++;
					}
					break;
				case ")":
					var group = groups.pop();
					if (group === LOOKAHEAD) { lookaheadDepth--; }
					newGroups[newGroups.length-1].end = i;
					result.push(chr);
					break;
				case "*":
				case "+":
				case "?":
				case "}":
					// Unary operator. If it's being applied to a capturing group, we need to add a new capturing group
					// enclosing the pair
					var op = chr;
					var prev = src.charAt(i-1),
					    prevIndex = i-1;
					if (chr === "}") {
						for (var j=i-1; src.charAt(j) !== "{" && j >= 0; j--) {}
						prev = src.charAt(j-1);
						prevIndex = j-1;
						op = src.substring(j, i+1);
					}
					var lastGroup = newGroups[newGroups.length-1];
					if (prev === ")" && (lastGroup.type === CAPTURING || lastGroup.type === NEW_CAPTURING)) {
						// Shove in the new group's (, increment num/start in from [lastGroup.start .. end]
						result.splice(lastGroup.start, 0, "(");
						result.push(op);
						result.push(")");
						var newGroup = { start: lastGroup.start, end: result.length-1, type: NEW_CAPTURING, num: lastGroup.num };
						for (var k=0; k < newGroups.length; k++) {
							group = newGroups[k];
							if (group.type === CAPTURING || group.type === NEW_CAPTURING) {
								if (group.start >= lastGroup.start && group.end <= prevIndex) {
									group.start += 1;
									group.end += 1;
									group.num = group.num + 1;
									if (group.type === CAPTURING) {
										old2New[group.oldNum] = group.num;
									}
								}
							}
						}
						newGroups.push(newGroup);
						newGroupNumber++;
						break;
					} else {
						// Fallthrough to default
					}
				default:
					if (chr !== "|" && curGroup !== CAPTURING && curGroup !== NEW_CAPTURING) {
						// Not in a capturing group, so make a new one to hold this term.
						// Perf improvement: don't create the new group if we're inside a lookahead, since we don't 
						// care about them (nothing inside a lookahead actually consumes input so we don't need it)
						if (lookaheadDepth === 0) {
							groups.push(NEW_CAPTURING);
							newGroups.push({ start: i, end: -1, type: NEW_CAPTURING, num: newGroupNumber });
							result.push("(");
							consuming[newGroupNumber] = null;
							newGroupNumber++;
						}
					}
					result.push(chr);
					if (chr === "\\") {
						var peek = src.charAt(i+1);
						// Eat next so following iteration doesn't think it's a real special character
						result.push(peek);
						i += 1;
					}
					break;
			}
		}
		while (groups.length) {	
			// Close any remaining new capturing groups
			groups.pop();
			result.push(")");
		}
		var newRegex = new RegExp(result.join(""));
		
		// Update backreferences so they refer to the new group numbers. Use backRefOld2NewMap if provided
		var subst = {};
		backRefOld2NewMap = backRefOld2NewMap || old2New;
		for (var prop in backRefOld2NewMap) {
			if (backRefOld2NewMap.hasOwnProperty(prop)) {
				subst[prop] = "\\" + backRefOld2NewMap[prop];
			}
		}
		newRegex = this.getSubstitutedRegex(newRegex, subst, false);
		
		return [newRegex, old2New, consuming];
	},
	
	/** @returns {Boolean} True if the captures object assigns scope to a matching group other than "0". */
	complexCaptures: function(capturesObj) {
		if (!capturesObj) { return false; }
		for (var prop in capturesObj) {
			if (capturesObj.hasOwnProperty(prop)) {
				if (prop !== "0") {
					return true;
				}
			}
		}
		return false;
	}
};

	/**
	 * @private
	 * @param obj {Object} A JSON-ish object.
	 * @returns {Object} Deep copy of <code>obj</code>. Does not work on properties that are functions or RegExp instances.
	 */
	function clone(obj) {
		var c;
		if (obj instanceof Array) {
			c = new Array(obj.length);
			for (var i=0; i < obj.length; i++) {
				c[i] = clone(obj[i]);
			}
		} else {
			c = {};
			for (var prop in obj) {
				if (Object.prototype.hasOwnProperty.call(obj, prop)) {
					var value = obj[prop];
					if (typeof value === "object" && value !== null) {
						c[prop] = clone(value);
					} else {
						c[prop] = value;
					}
				}
			}
		}
		return c;
	}

	/**
	 * @name orion.editor.TextMateStyler
	 * @class A styler that knows how to apply a subset of the TextMate grammar format to style a line.
	 *
	 * <h4>Styling from a grammar:</h4>
	 * <p>Each scope name given in the grammar is converted to an array of CSS class names. For example 
	 * a region of text with scope <code>keyword.control.php</code> will be assigned the CSS classes<br />
	 * <code>keyword, keyword-control, keyword-control-php</code></p>
	 *
	 * <p>A CSS file can give rules matching any of these class names to provide generic or more specific styling.
	 * For example,</p>
	 * <p><code>.keyword { font-color: blue; }</code></p>
	 * <p>colors all keywords blue, while</p>
	 * <p><code>.keyword-control-php { font-weight: bold; }</code></p>
	 * <p>bolds only PHP control keywords.</p>
	 *
	 * <p>This is useful when using grammars that adhere to TextMate's
	 * <a href="http://manual.macromates.com/en/language_grammars.html#naming_conventions">scope name conventions</a>,
	 * as a single CSS rule can provide consistent styling to similar constructs across different languages.</p>
	 * 
	 * <h4>Top-level grammar constructs:</h4>
	 * <ul><li><code>patterns, repository</code> (with limitations, see "Other Features") are supported.</li>
	 * <li><code>scopeName, firstLineMatch, foldingStartMarker, foldingStopMarker</code> are <b>not</b> supported.</li>
	 * <li><code>fileTypes</code> is <b>not</b> supported. When using the Orion service registry, the "orion.edit.highlighter"
	 * service serves a similar purpose.</li>
	 * </ul>
	 *
	 * <h4>Regular expression constructs:</h4>
	 * <ul>
	 * <li><code>match</code> patterns are supported.</li>
	 * <li><code>begin .. end</code> patterns are supported.</li>
	 * <li>The "extended" regex forms <code>(?x)</code> and <code>(?x:...)</code> are supported, but <b>only</b> when they 
	 * apply to the entire regex pattern.</li>
	 * <li>Matching is done using native JavaScript <code>RegExp</code>s. As a result, many features of the Oniguruma regex
	 * engine used by TextMate are <b>not</b> supported.
	 * Unsupported features include:
	 *   <ul><li>Named captures</li>
	 *   <li>Setting flags inside subgroups (eg. <code>(?i:a)b</code>)</li>
	 *   <li>Lookbehind and negative lookbehind</li>
	 *   <li>Subexpression call</li>
	 *   <li>etc.</li>
	 *   </ul>
	 * </li>
	 * </ul>
	 * 
	 * <h4>Scope-assignment constructs:</h4>
	 * <ul>
	 * <li><code>captures, beginCaptures, endCaptures</code> are supported.</li>
	 * <li><code>name</code> and <code>contentName</code> are supported.</li>
	 * </ul>
	 * 
	 * <h4>Other features:</h4>
	 * <ul>
	 * <li><code>applyEndPatternLast</code> is supported.</li>
	 * <li><code>include</code> is supported, but only when it references a rule in the current grammar's <code>repository</code>.
	 * Including <code>$self</code>, <code>$base</code>, or <code>rule.from.another.grammar</code> is <b>not</b> supported.</li>
	 * </ul>
	 * 
	 * @description Creates a new TextMateStyler.
	 * @extends orion.editor.AbstractStyler
	 * @param {orion.editor.TextView} textView The <code>TextView</code> to provide styling for.
	 * @param {Object} grammar The TextMate grammar to use for styling the <code>TextView</code>, as a JavaScript object. You can
	 * produce this object by running a PList-to-JavaScript conversion tool on a TextMate <code>.tmLanguage</code> file.
	 * @param {Object[]} [externalGrammars] Additional grammar objects that will be used to resolve named rule references.
	 */
	function TextMateStyler(textView, grammar, externalGrammars) {
		this.initialize(textView);
		// Copy grammar object(s) since we will mutate them
		this.grammar = clone(grammar);
		this.externalGrammars = externalGrammars ? clone(externalGrammars) : [];
		
		this._styles = {}; /* key: {String} scopeName, value: {String[]} cssClassNames */
		this._tree = null;
		this._allGrammars = {}; /* key: {String} scopeName of grammar, value: {Object} grammar */
		this.preprocess(this.grammar);
	}
	TextMateStyler.prototype = /** @lends orion.editor.TextMateStyler.prototype */ {
		initialize: function(textView) {
			this.textView = textView;
			this.textView.stylerOptions = this;
			var self = this;
			
			this._listener = {
				onModelChanged: function(e) {
					self.onModelChanged(e);
				},
				onDestroy: function(e) {
					self.onDestroy(e);
				},
				onLineStyle: function(e) {
					self.onLineStyle(e);
				},
				onStorage: function(e){
					self.onStorage(e);
				}
			};
			textView.addEventListener("ModelChanged", this._listener.onModelChanged);
			textView.addEventListener("Destroy", this._listener.onDestroy);
			textView.addEventListener("LineStyle", this._listener.onLineStyle);
			textView.redrawLines();
		},
		onDestroy: function(/**eclipse.DestroyEvent*/ e) {
			this.destroy();
		},
		destroy: function() {
			if (this.textView) {
				this.textView.removeEventListener("ModelChanged", this._listener.onModelChanged);
				this.textView.removeEventListener("Destroy", this._listener.onDestroy);
				this.textView.removeEventListener("LineStyle", this._listener.onLineStyle);
				this.textView = null;
			}
			this.grammar = null;
			this._styles = null;
			this._tree = null;
			this._listener = null;
		},
		/** @private */
		preprocess: function(grammar) {
			var stack = [grammar];
			for (; stack.length !== 0; ) {
				var rule = stack.pop();
				if (rule._resolvedRule && rule._typedRule) {
					continue;
				}
//					console.debug("Process " + (rule.include || rule.name));
				
				// Look up include'd rule, create typed *Rule instance
				rule._resolvedRule = this._resolve(rule);
				rule._typedRule = this._createTypedRule(rule);
				
				// Convert the scope names to styles and cache them for later
				this.addStyles(rule.name);
				this.addStyles(rule.contentName);
				this.addStylesForCaptures(rule.captures);
				this.addStylesForCaptures(rule.beginCaptures);
				this.addStylesForCaptures(rule.endCaptures);
				
				if (rule._resolvedRule !== rule) {
					// Add include target
					stack.push(rule._resolvedRule);
				}
				if (rule.patterns) {
					// Add subrules
					for (var i=0; i < rule.patterns.length; i++) {
						stack.push(rule.patterns[i]);
					}
				}
			}
		},
		
		/**
		 * Adds eclipse.Style objects for scope to our _styles cache.
		 * @private
		 * @param {String} scope A scope name, like "constant.character.php".
		 */
		addStyles: function(scope) {
			if (scope && !this._styles[scope]) {
				this._styles[scope] = [];
				var scopeArray = scope.split(".");
				for (var i = 0; i < scopeArray.length; i++) {
					this._styles[scope].push(scopeArray.slice(0, i + 1).join("-"));
				}
			}
		},
		/** @private */
		addStylesForCaptures: function(/**Object*/ captures) {
			for (var prop in captures) {
				if (captures.hasOwnProperty(prop)) {
					var scope = captures[prop].name;
					this.addStyles(scope);
				}
			}
		},
		/**
		 * A rule that contains subrules ("patterns" in TextMate parlance) but has no "begin" or "end".
		 * Also handles top level of grammar.
		 * @private
		 */
		ContainerRule: (function() {
			function ContainerRule(/**Object*/ rule) {
				this.rule = rule;
				this.subrules = rule.patterns;
			}
			ContainerRule.prototype.valueOf = function() { return "aa"; };
			return ContainerRule;
		}()),
		/**
		 * A rule that is delimited by "begin" and "end" matches, which may be separated by any number of
		 * lines. This type of rule may contain subrules, which apply only inside the begin .. end region.
		 * @private
		 */
		BeginEndRule: (function() {
			function BeginEndRule(/**Object*/ rule) {
				this.rule = rule;
				// TODO: the TextMate blog claims that "end" is optional.
				this.beginRegex = RegexUtil.toRegExp(rule.begin);
				this.endRegex = RegexUtil.toRegExp(rule.end);
				this.subrules = rule.patterns || [];
				
				this.endRegexHasBackRef = RegexUtil.hasBackReference(this.endRegex);
				
				// Deal with non-0 captures
				var complexCaptures = RegexUtil.complexCaptures(rule.captures);
				var complexBeginEnd = RegexUtil.complexCaptures(rule.beginCaptures) || RegexUtil.complexCaptures(rule.endCaptures);
				this.isComplex = complexCaptures || complexBeginEnd;
				if (this.isComplex) {
					var bg = RegexUtil.groupify(this.beginRegex);
					this.beginRegex = bg[0];
					this.beginOld2New = bg[1];
					this.beginConsuming = bg[2];
					
					var eg = RegexUtil.groupify(this.endRegex, this.beginOld2New /*Update end's backrefs to begin's new group #s*/);
					this.endRegex = eg[0];
					this.endOld2New = eg[1];
					this.endConsuming = eg[2];
				}
			}
			BeginEndRule.prototype.valueOf = function() { return this.beginRegex; };
			return BeginEndRule;
		}()),
		/**
		 * A rule with a "match" pattern.
		 * @private
		 */
		MatchRule: (function() {
			function MatchRule(/**Object*/ rule) {
				this.rule = rule;
				this.matchRegex = RegexUtil.toRegExp(rule.match);
				this.isComplex = RegexUtil.complexCaptures(rule.captures);
				if (this.isComplex) {
					var mg = RegexUtil.groupify(this.matchRegex);
					this.matchRegex = mg[0];
					this.matchOld2New = mg[1];
					this.matchConsuming = mg[2];
				}
			}
			MatchRule.prototype.valueOf = function() { return this.matchRegex; };
			return MatchRule;
		}()),
		/**
		 * @param {Object} rule A rule from the grammar.
		 * @returns {MatchRule|BeginEndRule|ContainerRule}
		 * @private
		 */
		_createTypedRule: function(rule) {
			if (rule.match) {
				return new this.MatchRule(rule);
			} else if (rule.begin) {
				return new this.BeginEndRule(rule);
			} else {
				return new this.ContainerRule(rule);
			}
		},
		/**
		 * Resolves a rule from the grammar (which may be an include) into the real rule that it points to.
		 * @private
		 */
		_resolve: function(rule) {
			var resolved = rule;
			if (rule.include) {
				if (rule.begin || rule.end || rule.match) {
					throw new Error("Unexpected regex pattern in \"include\" rule " + rule.include);
				}
				var name = rule.include;
				if (name.charAt(0) === "#") {
					resolved = this.grammar.repository && this.grammar.repository[name.substring(1)];
					if (!resolved) { throw new Error("Couldn't find included rule " + name + " in grammar repository"); }
				} else if (name === "$self") {
					resolved = this.grammar;
				} else if (name === "$base") {
					// $base is only relevant when including rules from foreign grammars
					throw new Error("Include \"$base\" is not supported"); 
				} else {
					resolved = this._allGrammars[name];
					if (!resolved) {
						for (var i=0; i < this.externalGrammars.length; i++) {
							var grammar = this.externalGrammars[i];
							if (grammar.scopeName === name) {
								this.preprocess(grammar);
								this._allGrammars[name] = grammar;
								resolved = grammar;
								break;
							}
						}
					}
				}
			}
			return resolved;
		},

		/** @private */
		ContainerNode: (function() {
			function ContainerNode(parent, rule) {
				this.parent = parent;
				this.rule = rule;
				this.children = [];
				
				this.start = null;
				this.end = null;
			}
			ContainerNode.prototype.addChild = function(child) {
				this.children.push(child);
			};
			ContainerNode.prototype.valueOf = function() {
				var r = this.rule;
				return "ContainerNode { " + (r.include || "") + " " + (r.name || "") + (r.comment || "") + "}";
			};
			return ContainerNode;
		}()),
		/** @private */
		BeginEndNode: (function() {
			function BeginEndNode(parent, rule, beginMatch) {
				this.parent = parent;
				this.rule = rule;
				this.children = [];
				
				this.setStart(beginMatch);
				this.end = null; // will be set eventually during parsing (may be EOF)
				this.endMatch = null; // may remain null if we never match our "end" pattern
				
				// Build a new regex if the "end" regex has backrefs since they refer to matched groups of beginMatch
				if (rule.endRegexHasBackRef) {
					this.endRegexSubstituted = RegexUtil.getSubstitutedRegex(rule.endRegex, beginMatch);
				} else {
					this.endRegexSubstituted = null;
				}
			}
			BeginEndNode.prototype.addChild = function(child) {
				this.children.push(child);
			};
			/** @return {Number} This node's index in its parent's "children" list */
			BeginEndNode.prototype.getIndexInParent = function(node) {
				return this.parent ? this.parent.children.indexOf(this) : -1;
			};
			/** @param {RegExp.match} beginMatch */
			BeginEndNode.prototype.setStart = function(beginMatch) {
				this.start = beginMatch.index;
				this.beginMatch = beginMatch;
			};
			/** @param {RegExp.match|Number} endMatchOrLastChar */
			BeginEndNode.prototype.setEnd = function(endMatchOrLastChar) {
				if (endMatchOrLastChar && typeof(endMatchOrLastChar) === "object") {
					var endMatch = endMatchOrLastChar;
					this.endMatch = endMatch;
					this.end = endMatch.index + endMatch[0].length;
				} else {
					var lastChar = endMatchOrLastChar;
					this.endMatch = null;
					this.end = lastChar;
				}
			};
			BeginEndNode.prototype.shiftStart = function(amount) {
				this.start += amount;
				this.beginMatch.index += amount;
			};
			BeginEndNode.prototype.shiftEnd = function(amount) {
				this.end += amount;
				if (this.endMatch) { this.endMatch.index += amount; }
			};
			BeginEndNode.prototype.valueOf = function() {
				return "{" + this.rule.beginRegex + " range=" + this.start + ".." + this.end + "}";
			};
			return BeginEndNode;
		}()),
		/** Pushes rules onto stack such that rules[startFrom] is on top
		 * @private
		 */
		push: function(/**Array*/ stack, /**Array*/ rules) {
			if (!rules) { return; }
			for (var i = rules.length; i > 0; ) {
				stack.push(rules[--i]);
			}
		},
		/** Executes <code>regex</code> on <code>text</code>, and returns the match object with its index 
		 * offset by the given amount.
		 * @returns {RegExp.match}
		 * @private
		 */
		exec: function(/**RegExp*/ regex, /**String*/ text, /**Number*/ offset) {
			var match = regex.exec(text);
			if (match) { match.index += offset; }
			regex.lastIndex = 0; // Just in case
			return match;
		},
		/** @returns {Number} The position immediately following the match.
		 * @private
		 */
		afterMatch: function(/**RegExp.match*/ match) {
			return match.index + match[0].length;
		},
		/**
		 * @returns {RegExp.match} If node is a BeginEndNode and its rule's "end" pattern matches the text.
		 * @private
		 */
		getEndMatch: function(/**Node*/ node, /**String*/ text, /**Number*/ offset) {
			if (node instanceof this.BeginEndNode) {
				var rule = node.rule;
				var endRegex = node.endRegexSubstituted || rule.endRegex;
				if (!endRegex) { return null; }
				return this.exec(endRegex, text, offset);
			}
			return null;
		},
		/** Called once when file is first loaded to build the parse tree. Tree is updated incrementally thereafter 
		 * as buffer is modified.
		 * @private
		 */
		initialParse: function() {
			var last = this.textView.getModel().getCharCount();
			// First time; make parse tree for whole buffer
			var root = new this.ContainerNode(null, this.grammar._typedRule);
			this._tree = root;
			this.parse(this._tree, false, 0);
		},
		onModelChanged: function(/**eclipse.ModelChangedEvent*/ e) {
			var addedCharCount = e.addedCharCount,
			    addedLineCount = e.addedLineCount,
			    removedCharCount = e.removedCharCount,
			    removedLineCount = e.removedLineCount,
			    start = e.start;
			if (!this._tree) {
				this.initialParse();
			} else {
				var model = this.textView.getModel();
				var charCount = model.getCharCount();
				
				// For rs, we must rewind to the line preceding the line 'start' is on. We can't rely on start's
				// line since it may've been changed in a way that would cause a new beginMatch at its lineStart.
				var rs = model.getLineEnd(model.getLineAtOffset(start) - 1); // may be < 0
				var fd = this.getFirstDamaged(rs, rs);
				rs = rs === -1 ? 0 : rs;
				var stoppedAt;
				if (fd) {
					// [rs, re] is the region we need to verify. If we find the structure of the tree
					// has changed in that area, then we may need to reparse the rest of the file.
					stoppedAt = this.parse(fd, true, rs, start, addedCharCount, removedCharCount);
				} else {
					// FIXME: fd == null ?
					stoppedAt = charCount;
				}
				this.textView.redrawRange(rs, stoppedAt);
			}
		},
		/** @returns {BeginEndNode|ContainerNode} The result of taking the first (smallest "start" value) 
		 * node overlapping [start,end] and drilling down to get its deepest damaged descendant (if any).
		 * @private
		 */
		getFirstDamaged: function(start, end) {
			// If start === 0 we actually have to start from the root because there is no position
			// we can rely on. (First index is damaged)
			if (start < 0) {
				return this._tree;
			}
			
			var nodes = [this._tree];
			var result = null;
			while (nodes.length) {
				var n = nodes.pop();
				if (!n.parent /*n is root*/ || this.isDamaged(n, start, end)) {
					// n is damaged by the edit, so go into its children
					// Note: If a node is damaged, then some of its descendents MAY be damaged
					// If a node is undamaged, then ALL of its descendents are undamaged
					if (n instanceof this.BeginEndNode) {
						result = n;
					}
					// Examine children[0] last
					for (var i=0; i < n.children.length; i++) {
						nodes.push(n.children[i]);
					}
				}
			}
			return result || this._tree;
		},
		/** @returns true If <code>n</code> overlaps the interval [start,end].
		 * @private
		 */
		isDamaged: function(/**BeginEndNode*/ n, start, end) {
			// Note strict > since [2,5] doesn't overlap [5,7]
			return (n.start <= end && n.end > start);
		},
		/**
		 * Builds tree from some of the buffer content
		 *
		 * TODO cleanup params
		 * @param {BeginEndNode|ContainerNode} origNode The deepest node that overlaps [rs,rs], or the root.
		 * @param {Boolean} repairing 
		 * @param {Number} rs See _onModelChanged()
		 * @param {Number} [editStart] Only used for repairing === true
		 * @param {Number} [addedCharCount] Only used for repairing === true
		 * @param {Number} [removedCharCount] Only used for repairing === true
		 * @returns {Number} The end position that redrawRange should be called for.
		 * @private
		 */
		parse: function(origNode, repairing, rs, editStart, addedCharCount, removedCharCount) {
			var model = this.textView.getModel();
			var lastLineStart = model.getLineStart(model.getLineCount() - 1);
			var eof = model.getCharCount();
			var initialExpected = this.getInitialExpected(origNode, rs);
			
			// re is best-case stopping point; if we detect change to tree, we must continue past it
			var re = -1;
			if (repairing) {
				origNode.repaired = true;
				origNode.endNeedsUpdate = true;
				var lastChild = origNode.children[origNode.children.length-1];
				var delta = addedCharCount - removedCharCount;
				var lastChildLineEnd = lastChild ? model.getLineEnd(model.getLineAtOffset(lastChild.end + delta)) : -1;
				var editLineEnd = model.getLineEnd(model.getLineAtOffset(editStart + removedCharCount));
				re = Math.max(lastChildLineEnd, editLineEnd);
			}
			re = (re === -1) ? eof : re;
			
			var expected = initialExpected;
			var node = origNode;
			var matchedChildOrEnd = false;
			var pos = rs;
			var redrawEnd = -1;
			while (node && (!repairing || (pos < re))) {
				var matchInfo = this.getNextMatch(model, node, pos);
				if (!matchInfo) {
					// Go to next line, if any
					pos = (pos >= lastLineStart) ? eof : model.getLineStart(model.getLineAtOffset(pos) + 1);
				}
				var match = matchInfo && matchInfo.match,
				    rule = matchInfo && matchInfo.rule,
				    isSub = matchInfo && matchInfo.isSub,
				    isEnd = matchInfo && matchInfo.isEnd;
				if (isSub) {
					pos = this.afterMatch(match);
					if (rule instanceof this.BeginEndRule) {
						matchedChildOrEnd = true;
						// Matched a child. Did we expect that?
						if (repairing && rule === expected.rule && node === expected.parent) {
							// Yes: matched expected child
							var foundChild = expected;
							foundChild.setStart(match);
							// Note: the 'end' position for this node will either be matched, or fixed up by us post-loop
							foundChild.repaired = true;
							foundChild.endNeedsUpdate = true;
							node = foundChild; // descend
							expected = this.getNextExpected(expected, "begin");
						} else {
							if (repairing) {
								// No: matched unexpected child.
								this.prune(node, expected);
								repairing = false;
							}
							
							// Add the new child (will replace 'expected' in node's children list)
							var subNode = new this.BeginEndNode(node, rule, match);
							node.addChild(subNode);
							node = subNode; // descend
						}
					} else {
						// Matched a MatchRule; no changes to tree required
					}
				} else if (isEnd || pos === eof) {
					if (node instanceof this.BeginEndNode) {
						if (match) {
							matchedChildOrEnd = true;
							redrawEnd = Math.max(redrawEnd, node.end); // if end moved up, must still redraw to its old value
							node.setEnd(match);
							pos = this.afterMatch(match);
							// Matched node's end. Did we expect that?
							if (repairing && node === expected && node.parent === expected.parent) {
								// Yes: found the expected end of node
								node.repaired = true;
								delete node.endNeedsUpdate;
								expected = this.getNextExpected(expected, "end");
							} else {
								if (repairing) {
									// No: found an unexpected end
									this.prune(node, expected);
									repairing = false;
								}
							}
						} else {
							// Force-ending a BeginEndNode that runs until eof
							node.setEnd(eof);
							delete node.endNeedsUpdate;
						}
					}
					node = node.parent; // ascend
				}
				
				if (repairing && pos >= re && !matchedChildOrEnd) {
					// Reached re without matching any begin/end => initialExpected itself was removed => repair fail
					this.prune(origNode, initialExpected);
					repairing = false;
				}
			} // end loop
			// TODO: do this for every node we end?
			this.removeUnrepairedChildren(origNode, repairing, rs);
			
			//console.debug("parsed " + (pos - rs) + " of " + model.getCharCount + "buf");
			this.cleanup(repairing, origNode, rs, re, eof, addedCharCount, removedCharCount);
			if (repairing) {
				return Math.max(redrawEnd, pos);
			} else {
				return pos; // where we stopped reparsing
			}
		},
		/** Helper for parse() in the repair case. To be called when ending a node, as any children that
		 * lie in [rs,node.end] and were not repaired must've been deleted.
		 * @private
		 */
		removeUnrepairedChildren: function(node, repairing, start) {
			if (repairing) {
				var children = node.children;
				var removeFrom = -1;
				for (var i=0; i < children.length; i++) {
					var child = children[i];
					if (!child.repaired && this.isDamaged(child, start, Number.MAX_VALUE /*end doesn't matter*/)) {
						removeFrom = i;
						break;
					}
				}
				if (removeFrom !== -1) {
					node.children.length = removeFrom;
				}
			}
		},
		/** Helper for parse() in the repair case
		 * @private
		 */
		cleanup: function(repairing, origNode, rs, re, eof, addedCharCount, removedCharCount) {
			var i, node, maybeRepairedNodes;
			if (repairing) {
				// The repair succeeded, so update stale begin/end indices by simple translation.
				var delta = addedCharCount - removedCharCount;
				// A repaired node's end can't exceed re, but it may exceed re-delta+1.
				// TODO: find a way to guarantee disjoint intervals for repaired vs unrepaired, then stop using flag
				var maybeUnrepairedNodes = this.getIntersecting(re-delta+1, eof);
				maybeRepairedNodes = this.getIntersecting(rs, re);
				// Handle unrepaired nodes. They are those intersecting [re-delta+1, eof] that don't have the flag
				for (i=0; i < maybeUnrepairedNodes.length; i++) {
					node = maybeUnrepairedNodes[i];
					if (!node.repaired && node instanceof this.BeginEndNode) {
						node.shiftEnd(delta);
						node.shiftStart(delta);
					}
				}
				// Translate 'end' index of repaired node whose 'end' was not matched in loop (>= re)
				for (i=0; i < maybeRepairedNodes.length; i++) {
					node = maybeRepairedNodes[i];
					if (node.repaired && node.endNeedsUpdate) {
						node.shiftEnd(delta);
					}
					delete node.endNeedsUpdate;
					delete node.repaired;
				}
			} else {
				// Clean up after ourself
				maybeRepairedNodes = this.getIntersecting(rs, re);
				for (i=0; i < maybeRepairedNodes.length; i++) {
					delete maybeRepairedNodes[i].repaired;
				}
			}
		},
		/**
		 * @param model {orion.editor.TextModel}
		 * @param {Node} node
		 * @param {Number} pos
		 * @param {Boolean} [matchRulesOnly] Optional, if true only "match" subrules will be considered.
		 * @returns {Object} A match info object with properties:
		 * {Boolean} isEnd
		 * {Boolean} isSub
		 * {RegExp.match} match
		 * {(Match|BeginEnd)Rule} rule
		 * @private
		 */
		getNextMatch: function(model, node, pos, matchRulesOnly) {
			var lineIndex = model.getLineAtOffset(pos);
			var lineEnd = model.getLineEnd(lineIndex);
			var line = model.getText(pos, lineEnd);

			var stack = [],
			    expandedContainers = [],
			    subMatches = [],
			    subrules = [];
			this.push(stack, node.rule.subrules);
			while (stack.length) {
				var next = stack.length ? stack.pop() : null;
				var subrule = next && next._resolvedRule._typedRule;
				if (subrule instanceof this.ContainerRule && expandedContainers.indexOf(subrule) === -1) {
					// Expand ContainerRule by pushing its subrules on
					expandedContainers.push(subrule);
					this.push(stack, subrule.subrules);
					continue;
				}
				if (subrule && matchRulesOnly && !(subrule.matchRegex)) {
					continue;
				}
				var subMatch = subrule && this.exec(subrule.matchRegex || subrule.beginRegex, line, pos);
				if (subMatch) {
					subMatches.push(subMatch);
					subrules.push(subrule);
				}
			}

			var bestSub = Number.MAX_VALUE,
			    bestSubIndex = -1;
			for (var i=0; i < subMatches.length; i++) {
				var match = subMatches[i];
				if (match.index < bestSub) {
					bestSub = match.index;
					bestSubIndex = i;
				}
			}
			
			if (!matchRulesOnly) {
				// See if the "end" pattern of the active begin/end node matches.
				// TODO: The active begin/end node may not be the same as the node that holds the subrules
				var activeBENode = node;
				var endMatch = this.getEndMatch(node, line, pos);
				if (endMatch) {
					var doEndLast = activeBENode.rule.applyEndPatternLast;
					var endWins = bestSubIndex === -1 || (endMatch.index < bestSub) || (!doEndLast && endMatch.index === bestSub);
					if (endWins) {
						return {isEnd: true, rule: activeBENode.rule, match: endMatch};
					}
				}
			}
			return bestSubIndex === -1 ? null : {isSub: true, rule: subrules[bestSubIndex], match: subMatches[bestSubIndex]};
		},
		/**
		 * Gets the node corresponding to the first match we expect to see in the repair.
		 * @param {BeginEndNode|ContainerNode} node The node returned via getFirstDamaged(rs,rs) -- may be the root.
		 * @param {Number} rs See _onModelChanged()
		 * Note that because rs is a line end (or 0, a line start), it will intersect a beginMatch or 
		 * endMatch either at their 0th character, or not at all. (begin/endMatches can't cross lines).
		 * This is the only time we rely on the start/end values from the pre-change tree. After this 
		 * we only look at node ordering, never use the old indices.
		 * @returns {Node}
		 * @private
		 */
		getInitialExpected: function(node, rs) {
			// TODO: Kind of weird.. maybe ContainerNodes should have start & end set, like BeginEndNodes
			var i, child;
			if (node === this._tree) {
				// get whichever of our children comes after rs
				for (i=0; i < node.children.length; i++) {
					child = node.children[i]; // BeginEndNode
					if (child.start >= rs) {
						return child;
					}
				}
			} else if (node instanceof this.BeginEndNode) {
				if (node.endMatch) {
					// Which comes next after rs: our nodeEnd or one of our children?
					var nodeEnd = node.endMatch.index;
					for (i=0; i < node.children.length; i++) {
						child = node.children[i]; // BeginEndNode
						if (child.start >= rs) {
							break;
						}
					}
					if (child && child.start < nodeEnd) {
						return child; // Expect child as the next match
					}
				} else {
					// No endMatch => node goes until eof => it end should be the next match
				}
			}
			return node; // We expect node to end, so it should be the next match
		},
		/**
		 * Helper for repair() to tell us what kind of event we expect next.
		 * @param {Node} expected Last value returned by this method.
		 * @param {String} event "begin" if the last value of expected was matched as "begin",
		 *  or "end" if it was matched as an end.
		 * @returns {Node} The next expected node to match, or null.
		 * @private
		 */
		getNextExpected: function(/**Node*/ expected, event) {
			var node = expected;
			if (event === "begin") {
				var child = node.children[0];
				if (child) {
					return child;
				} else {
					return node;
				}
			} else if (event === "end") {
				var parent = node.parent;
				if (parent) {
					var nextSibling = parent.children[parent.children.indexOf(node) + 1];
					if (nextSibling) {
						return nextSibling;
					} else {
						return parent;
					}
				}
			}
			return null;
		},
		/** Helper for parse() when repairing. Prunes out the unmatched nodes from the tree so we can continue parsing.
		 * @private
		 */
		prune: function(/**BeginEndNode|ContainerNode*/ node, /**Node*/ expected) {
			var expectedAChild = expected.parent === node;
			if (expectedAChild) {
				// Expected child wasn't matched; prune it and all siblings after it
				node.children.length = expected.getIndexInParent();
			} else if (node instanceof this.BeginEndNode) {
				// Expected node to end but it didn't; set its end unknown and we'll match it eventually
				node.endMatch = null;
				node.end = null;
			}
			// Reparsing from node, so prune the successors outside of node's subtree
			if (node.parent) {
				node.parent.children.length = node.getIndexInParent() + 1;
			}
		},
		onLineStyle: function(/**eclipse.LineStyleEvent*/ e) {
			function byStart(r1, r2) {
				return r1.start - r2.start;
			}
			
			if (!this._tree) {
				// In some cases it seems onLineStyle is called before onModelChanged, so we need to parse here
				this.initialParse();
			}
			var lineStart = e.lineStart,
			    model = this.textView.getModel(),
			    lineEnd = model.getLineEnd(e.lineIndex);
			
			var rs = model.getLineEnd(model.getLineAtOffset(lineStart) - 1); // may be < 0
			var node = this.getFirstDamaged(rs, rs);
			
			var scopes = this.getLineScope(model, node, lineStart, lineEnd);
			e.ranges = this.toStyleRanges(scopes);
			// Editor requires StyleRanges must be in ascending order by 'start', or else some will be ignored
			e.ranges.sort(byStart);
		},
		/** Runs parse algorithm on [start, end] in the context of node, assigning scope as we find matches.
		 * @private
		 */
		getLineScope: function(model, node, start, end) {
			var pos = start;
			var expected = this.getInitialExpected(node, start);
			var scopes = [],
			    gaps = [];
			while (node && (pos < end)) {
				var matchInfo = this.getNextMatch(model, node, pos);
				if (!matchInfo) { 
					break; // line is over
				}
				var match = matchInfo && matchInfo.match,
				    rule = matchInfo && matchInfo.rule,
				    isSub = matchInfo && matchInfo.isSub,
				    isEnd = matchInfo && matchInfo.isEnd;
				if (match.index !== pos) {
					// gap [pos..match.index]
					gaps.push({ start: pos, end: match.index, node: node});
				}
				if (isSub) {
					pos = this.afterMatch(match);
					if (rule instanceof this.BeginEndRule) {
						// Matched a "begin", assign its scope and descend into it
						this.addBeginScope(scopes, match, rule);
						node = expected; // descend
						expected = this.getNextExpected(expected, "begin");
					} else {
						// Matched a child MatchRule;
						this.addMatchScope(scopes, match, rule);
					}
				} else if (isEnd) {
					pos = this.afterMatch(match);
					// Matched and "end", assign its end scope and go up
					this.addEndScope(scopes, match, rule);
					expected = this.getNextExpected(expected, "end");
					node = node.parent; // ascend
				}
			}
			if (pos < end) {
				gaps.push({ start: pos, end: end, node: node });
			}
			var inherited = this.getInheritedLineScope(gaps, start, end);
			return scopes.concat(inherited);
		},
		/** @private */
		getInheritedLineScope: function(gaps, start, end) {
			var scopes = [];
			for (var i=0; i < gaps.length; i++) {
				var gap = gaps[i];
				var node = gap.node;
				while (node) {
					// if node defines a contentName or name, apply it
					var rule = node.rule.rule;
					var name = rule.name,
					    contentName = rule.contentName;
					// TODO: if both are given, we don't resolve the conflict. contentName always wins
					var scope = contentName || name;
					if (scope) {
						this.addScopeRange(scopes, gap.start, gap.end, scope);
						break;
					}
					node = node.parent;
				}
			}
			return scopes;
		},
		/** @private */
		addBeginScope: function(scopes, match, typedRule) {
			var rule = typedRule.rule;
			this.addCapturesScope(scopes, match, (rule.beginCaptures || rule.captures), typedRule.isComplex, typedRule.beginOld2New, typedRule.beginConsuming);
		},
		/** @private */
		addEndScope: function(scopes, match, typedRule) {
			var rule = typedRule.rule;
			this.addCapturesScope(scopes, match, (rule.endCaptures || rule.captures), typedRule.isComplex, typedRule.endOld2New, typedRule.endConsuming);
		},
		/** @private */
		addMatchScope: function(scopes, match, typedRule) {
			var rule = typedRule.rule,
			    name = rule.name,
			    captures = rule.captures;
			if (captures) {	
				// captures takes priority over name
				this.addCapturesScope(scopes, match, captures, typedRule.isComplex, typedRule.matchOld2New, typedRule.matchConsuming);
			} else {
				this.addScope(scopes, match, name);
			}
		},
		/** @private */
		addScope: function(scopes, match, name) {
			if (!name) { return; }
			scopes.push({start: match.index, end: this.afterMatch(match), scope: name });
		},
		/** @private */
		addScopeRange: function(scopes, start, end, name) {
			if (!name) { return; }
			scopes.push({start: start, end: end, scope: name });
		},
		/** @private */
		addCapturesScope: function(/**Array*/scopes, /*RegExp.match*/ match, /**Object*/captures, /**Boolean*/isComplex, /**Object*/old2New, /**Object*/consuming) {
			if (!captures) { return; }
			if (!isComplex) {
				this.addScope(scopes, match, captures[0] && captures[0].name);
			} else {
				// apply scopes captures[1..n] to matching groups [1]..[n] of match
				
				// Sum up the lengths of preceding consuming groups to get the start offset for each matched group.
				var newGroupStarts = {1: 0};
				var sum = 0;
				for (var num = 1; match[num] !== undefined; num++) {
					if (consuming[num] !== undefined) {
						sum += match[num].length;
					}
					if (match[num+1] !== undefined) {
						newGroupStarts[num + 1] = sum;
					}
				}
				// Map the group numbers referred to in captures object to the new group numbers, and get the actual matched range.
				var start = match.index;
				for (var oldGroupNum = 1; captures[oldGroupNum]; oldGroupNum++) {
					var scope = captures[oldGroupNum].name;
					var newGroupNum = old2New[oldGroupNum];
					var groupStart = start + newGroupStarts[newGroupNum];
					// Not every capturing group defined in regex need match every time the regex is run.
					// eg. (a)|b matches "b" but group 1 is undefined
					if (typeof match[newGroupNum] !== "undefined") {
						var groupEnd = groupStart + match[newGroupNum].length;
						this.addScopeRange(scopes, groupStart, groupEnd, scope);
					}
				}
			}
		},
		/** @returns {Node[]} In depth-first order
		 * @private
		 */
		getIntersecting: function(start, end) {
			var result = [];
			var nodes = this._tree ? [this._tree] : [];
			while (nodes.length) {
				var n = nodes.pop();
				var visitChildren = false;
				if (n instanceof this.ContainerNode) {
					visitChildren = true;
				} else if (this.isDamaged(n, start, end)) {
					visitChildren = true;
					result.push(n);
				}
				if (visitChildren) {
					var len = n.children.length;
//					for (var i=len-1; i >= 0; i--) {
//						nodes.push(n.children[i]);
//					}
					for (var i=0; i < len; i++) {
						nodes.push(n.children[i]);
					}
				}
			}
			return result.reverse();
		},
		/**
		 * Applies the grammar to obtain the {@link eclipse.StyleRange[]} for the given line.
		 * @returns {eclipse.StyleRange[]}
		 * @private
		 */
		toStyleRanges: function(/**ScopeRange[]*/ scopeRanges) {
			var styleRanges = [];
			for (var i=0; i < scopeRanges.length; i++) {
				var scopeRange = scopeRanges[i];
				var classNames = this._styles[scopeRange.scope];
				if (!classNames) { throw new Error("styles not found for " + scopeRange.scope); }
				var classNamesString = classNames.join(" ");
				styleRanges.push({start: scopeRange.start, end: scopeRange.end, style: {styleClass: classNamesString}});
//				console.debug("{start " + styleRanges[i].start + ", end " + styleRanges[i].end + ", style: " + styleRanges[i].style.styleClass + "}");
			}
			return styleRanges;
		}
	};
	
	return {
		RegexUtil: RegexUtil,
		TextMateStyler: TextMateStyler
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation 
 ******************************************************************************/
/*eslint-env browser, amd*/
define("orion/editor/AsyncStyler", ['i18n!orion/editor/nls/messages', 'orion/editor/annotations'], function(messages, mAnnotations) {
	var SERVICE_NAME = "orion.edit.highlighter";
	var HIGHLIGHT_ERROR_ANNOTATION = "orion.annotation.highlightError";
	var badServiceError = SERVICE_NAME + " service must be an event emitter";
	mAnnotations.AnnotationType.registerType(HIGHLIGHT_ERROR_ANNOTATION, {
		title: messages.syntaxError,
		html: "<div class='annotationHTML error'></div>",
		rangeStyle: {styleClass: "annotationRange error"}
	});

	function isRelevant(serviceReference) {
		return serviceReference.getProperty("objectClass").indexOf(SERVICE_NAME) !== -1 &&
				serviceReference.getProperty("type") === "highlighter";
	}

	/**
	 * @name orion.editor.AsyncStyler
	 * @class Provides asynchronous styling for a TextView using registered "highlighter" services.
	 * @description Creates an <code>AsyncStyler</code>. An AsyncStyler allows style information to be sent to a 
	 * <code>TextView</code> asynchronously through the service segistry. Style is generated by <em>style providers</em>, which are services
	 * having the <code>'orion.edit.highlighter'</code> service name and a <code>type</code> === <code>'highlighter'</code> service property.
	 *
	 * <p>A style provider monitors changes to the TextView (typically using an <code>orion.edit.model</code> service) and 
	 * dispatches a service event of type <code>'orion.edit.highlighter.styleReady'</code> when it has style information to send.
	 * The event carries a payload of style information for one or more lines in the TextView. The AsyncStyler then applies
	 * the style information fron the event to the TextView using the {@link orion.editor.TextView#event:onLineStyle} API.
	 * </p>
	 *
	 * <p>Applying style information may cause the TextView to be redrawn, which is potentially expensive. To minimize the 
	 * number of redraws, a provider should provide style for many lines in a single StyleReadyEvent.
	 * </p>
	 *
	 * @param {orion.editor.TextView} textView The TextView to style.
	 * @param {orion.serviceregistry.ServiceRegistry} serviceRegistry The ServiceRegistry to monitor for highlighter services.
	 * @param {orion.editor.AnnotationModel} [annotationModel] The Annotation Model to use for creating error and warning annotations.
	 * @see orion.editor.StyleReadyEvent
	 */
	function AsyncStyler(textView, serviceRegistry, annotationModel) {
		this.initialize(textView, serviceRegistry, annotationModel);
		this.lineStyles = [];
	}
	AsyncStyler.prototype = /** @lends orion.editor.AsyncStyler.prototype*/ {
		/** @private */
		initialize: function(textView, serviceRegistry, annotationModel) {
			this.textView = textView;
			this.serviceRegistry = serviceRegistry;
			this.annotationModel = annotationModel; 
			this.services = [];

			var self = this;
			this.listener = {
				onModelChanging: function(e) {
					self.onModelChanging(e);
				},
				onModelChanged: function(e) {
					self.onModelChanged(e);
				},
				onDestroy: function(e) {
					self.onDestroy(e);
				},
				onLineStyle: function(e) {
					self.onLineStyle(e);
				},
				onStyleReady: function(e) {
					self.onStyleReady(e);
				},
				onServiceAdded: function(serviceEvent) {
					self.onServiceAdded(serviceEvent.serviceReference, self.serviceRegistry.getService(serviceEvent.serviceReference));
				},
				onServiceRemoved: function(serviceEvent) {
					self.onServiceRemoved(serviceEvent.serviceReference, self.serviceRegistry.getService(serviceEvent.serviceReference));
				}
			};
			textView.addEventListener("ModelChanging", this.listener.onModelChanging);
			textView.addEventListener("ModelChanged", this.listener.onModelChanged);
			textView.addEventListener("Destroy", this.listener.onDestroy);
			textView.addEventListener("LineStyle", this.listener.onLineStyle);
			serviceRegistry.addEventListener("registered", this.listener.onServiceAdded);
			serviceRegistry.addEventListener("unregistering", this.listener.onServiceRemoved);

			var serviceRefs = serviceRegistry.getServiceReferences(SERVICE_NAME);
			for (var i = 0; i < serviceRefs.length; i++) {
				var serviceRef = serviceRefs[i];
				if (isRelevant(serviceRef)) {
					this.addServiceListener(serviceRegistry.getService(serviceRef));
				}
			}
		},
		/** @private */
		onDestroy: function(e) {
			this.destroy();
		},
		/** Deactivates this styler and removes any listeners it registered. */
		destroy: function() {
			if (this.textView) {
				this.textView.removeEventListener("ModelChanging", this.listener.onModelChanging);
				this.textView.removeEventListener("ModelChanged", this.listener.onModelChanged);
				this.textView.removeEventListener("Destroy", this.listener.onDestroy);
				this.textView.removeEventListener("LineStyle", this.listener.onLineStyle);
				this.textView = null;
			}
			if (this.services) {
				for (var i = 0; i < this.services.length; i++) {
					this.removeServiceListener(this.services[i]);
				}
				this.services = null;
			}
			if (this.serviceRegistry) {
				this.serviceRegistry.removeEventListener("registered", this.listener.onServiceAdded);
				this.serviceRegistry.removeEventListener("unregistering", this.listener.onServiceRemoved);
				this.serviceRegistry = null;
			}
			this.listener = null;
			this.lineStyles = null;
		},
		/** @private */
		onModelChanging: function(e) {
			this.startLine = this.textView.getModel().getLineAtOffset(e.start);
		},
		/** @private */
		onModelChanged: function(e) {
			var startLine = this.startLine;
			if (e.addedLineCount || e.removedLineCount) {
				Array.prototype.splice.apply(this.lineStyles, [startLine, e.removedLineCount].concat(this._getEmptyStyle(e.addedLineCount)));
			}
		},
		/** @private */
		onStyleReady: function(e) {
			var style = e.lineStyles || e.style;
			var min = Number.MAX_VALUE, max = -1;
			var model = this.textView.getModel();
			for (var lineIndex in style) {
				if (Object.prototype.hasOwnProperty.call(style, lineIndex)) {
					this.lineStyles[lineIndex] = style[lineIndex];
					min = Math.min(min, lineIndex);
					max = Math.max(max, lineIndex);
				}
			}
//			console.debug("Got style for lines " + (min+1) + " to " + (max+1));
			min = Math.max(min, 0);
			max = Math.min(max, model.getLineCount());
			
			var annotationModel = this.annotationModel;
			if (annotationModel) {
				var annos = annotationModel.getAnnotations(model.getLineStart(min), model.getLineEnd(max));
				var toRemove = [];
				while (annos.hasNext()) {
					var anno = annos.next();
					if (anno.type === HIGHLIGHT_ERROR_ANNOTATION) {
						toRemove.push(anno);
					}
				}
				var toAdd = [];
				for (var i = min; i <= max; i++) {
					lineIndex = i;
					var lineStyle = this.lineStyles[lineIndex], errors = lineStyle && lineStyle.errors;
					var lineStart = model.getLineStart(lineIndex);
					if (errors) {
						for (var j=0; j < errors.length; j++) {
							var err = errors[j];
							toAdd.push(mAnnotations.AnnotationType.createAnnotation(HIGHLIGHT_ERROR_ANNOTATION, err.start + lineStart, err.end + lineStart));
						}
					}
				}
				annotationModel.replaceAnnotations(toRemove, toAdd);
			}
			this.textView.redrawLines(min, max + 1);
		},
		/** @private */
		onLineStyle: function(e) {
			function _toDocumentOffset(ranges, lineStart) {
				var len = ranges.length, result = [];
				for (var i=0; i < len; i++) {
					var r = ranges[i];
					result.push({
						start: r.start + lineStart,
						end: r.end + lineStart,
						style: r.style
					});
				}
				return result;
			}
			var style = this.lineStyles[e.lineIndex];
			if (style) {
				// The 'ranges', 'errors' are of type {@link orion.editor.LineStyleEvent#ranges}, except the 
				// start and end indices are line-relative offsets, not document-relative.
				if (style.ranges) { e.ranges = _toDocumentOffset(style.ranges, e.lineStart); }
				else if (style.style) { e.style = style.style; }
			}
		},
		/** @private */
		_getEmptyStyle: function(n) {
			var result = [];
			for (var i=0; i < n; i++) {
				result.push(null);
			}
			return result;
		},
		/**
		 * Sets the content type ID for which style information will be provided. The ID will be passed to all style provider 
		 * services monitored by this AsyncStyler by calling the provider's own <code>setContentType(contentTypeId)</code> method.
		 *
		 * <p>In this way, a single provider service can be registered for several content types, and select different logic for 
		 * each type.</p>
		 * @param {String} contentTypeId The Content Type ID describing the kind of file currently being edited in the TextView.
		 * @see orion.core.ContentType
		 */
		setContentType: function(contentTypeId) {
			this.contentType = contentTypeId;
			if (this.services) {
				for (var i = 0; i < this.services.length; i++) {
					var service = this.services[i];
					if (service.setContentType) {
						var progress = this.serviceRegistry.getService("orion.page.progress");
						if(progress){
							progress.progress(service.setContentType(this.contentType), "Styling content type: " + this.contentType.id ? this.contentType.id: this.contentType);
						} else {
							service.setContentType(this.contentType);
						}
					}
				}
			}
		},
		/** @private */
		onServiceAdded: function(serviceRef, service) {
			if (isRelevant(serviceRef)) {
				this.addServiceListener(service);
			}
		},
		/** @private */
		onServiceRemoved: function(serviceRef, service) {
			if (this.services.indexOf(service) !== -1) {
				this.removeServiceListener(service);
			}
		},
		/** @private */
		addServiceListener: function(service) {
			if (typeof service.addEventListener === "function") {
				service.addEventListener("orion.edit.highlighter.styleReady", this.listener.onStyleReady);
				this.services.push(service);
				if (service.setContentType && this.contentType) {
					var progress = this.serviceRegistry.getService("orion.page.progress");
					if(progress){
						progress.progress(service.setContentType(this.contentType), "Styling content type: " + this.contentType.id ? this.contentType.id: this.contentType);
					} else {
						service.setContentType(this.contentType);
					}
				}
			} else {
				if (typeof console !== "undefined") {
					console.log(new Error(badServiceError));
				}
			}
		},
		/** @private */
		removeServiceListener: function(service) {
			if (typeof service.removeEventListener === "function") {
				service.removeEventListener("orion.edit.highlighter.styleReady", this.listener.onStyleReady);
				var serviceIndex = this.services.indexOf(service);
				if (serviceIndex !== -1) {
					this.services.splice(serviceIndex, 1);
				}
			} else {
				if (typeof console !== "undefined") {
					console.log(new Error(badServiceError));
				}
			}
		}
	};

	/**
	 * @name orion.editor.StyleReadyEvent
	 * @class Represents the styling for a range of lines, as provided by a service.
	 * @description Represents the styling for a range of lines, as provided by a service.
	 * @property {Object} lineStyles A map of style information. Each key of the map is a line index, and the value 
	 * is a {@link orion.editor.StyleReadyEvent#LineStyle} giving the style information for the line.
	 */
	/**
	 * @name orion.editor.StyleReadyEvent#LineStyle
	 * @class Represents style information for a line.
	 * @description Represents style information for a line.
	 * <p>Note that the offsets given in the {@link #ranges} and {@link #errors} properties are relative to the start of the
	 * line that this LineStyle is associated with, not the start of the document.</p>
	 * @property {orion.editor.StyleRange[]} ranges Optional; Gives the styles for this line.
	 * @property {orion.editor.StyleRange[]} errors Optional; Gives the error styles for this line. Error styles will be 
	 * presented as annotations in the UI.
	 */

	return AsyncStyler;
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/highlight',['examples/editor/textStyler', 'orion/editor/textStyler', 'orion/editor/textMateStyler', 'orion/editor/AsyncStyler', 'orion/Deferred'], 
		function(mTextStyler, mTextStyler2, mTextMateStyler, AsyncStyler, Deferred) {

	var NEW = 1;

	/**
	 * Returns a promise that will provide a styler for the given content type.
	 * @static
	 * @param {orion.serviceregistry.ServiceRegistry} serviceRegistry
	 * @param {orion.core.ContentTypeRegistry} contentTypeService
	 * @param {orion.core.ContentType} contentType
	 * @param {orion.editor.TextView} textView
	 * @param {orion.editor.AnnotationModel} annotationModel
	 * @param {String} [fileName] Deprecated.
	 * @param {Boolean} [allowAsync=true]
	 * @returns {orion.Deferred}
	 */
	function createStyler(serviceRegistry, contentTypeService, contentType, textView, annotationModel, fileName, allowAsync) {
		// Returns a promise (if provider matches) or null (if it doesn't match).
		function getPromise(provider, extension) {
			var contentTypeIds = provider.getProperty("contentType") || provider.getProperty("contentTypes"), //$NON-NLS-1$ //$NON-NLS-0$
			    fileTypes = provider.getProperty("fileTypes"); // backwards compatibility //$NON-NLS-0$
			if (contentTypeIds) {
				return Deferred.when(contentTypeService.isSomeExtensionOf(contentType, contentTypeIds)).then(
					function (isMatch) {
						return isMatch ? provider : null;
					});
			} else if (extension && fileTypes && fileTypes.indexOf(extension) !== -1) {
				var d = new Deferred();
				d.resolve(provider);
				return d;
			}
			return null;
		}
		function isAllowed(provider) {
			return allowAsync || provider.getProperty("type") !== "highlighter"; //$NON-NLS-1$ //$NON-NLS-0$
		}
		function createDefaultStyler(contentType) {
			var styler = null;
			switch (contentType && contentType.id) {
				case "application/javascript": //$NON-NLS-0$
				case "application/json": //$NON-NLS-0$
					styler = new mTextStyler.TextStyler(textView, "js", annotationModel); //$NON-NLS-0$
					break;
				case "text/x-java-source": //$NON-NLS-0$
					styler = new mTextStyler.TextStyler(textView, "java", annotationModel); //$NON-NLS-0$
					break;
				case "text/css": //$NON-NLS-0$
					styler = new mTextStyler.TextStyler(textView, "css", annotationModel); //$NON-NLS-0$
					break;
			}
			return styler;
		}
		// Check default styler
		if (!NEW) {
			var styler = createDefaultStyler(contentType);
			if (styler) {
				var result = new Deferred();
				result.resolve(styler);
				return result;
			}
		}

		if (NEW && !this.orionGrammars) {
			this.orionGrammars = {};
		}

		// Check services
		var extension = fileName && fileName.split(".").pop().toLowerCase(); //$NON-NLS-0$
		var serviceRefs = serviceRegistry.getServiceReferences("orion.edit.highlighter"); //$NON-NLS-0$
		var textmateGrammars = [], promises = [];
		for (var i = 0; i < serviceRefs.length; i++) {
			var serviceRef = serviceRefs[i];
			var type = serviceRef.getProperty("type");
			if (type === "grammar" || (!NEW && typeof type === "undefined")) { //$NON-NLS-1$ //$NON-NLS-0$
				textmateGrammars.push(serviceRef.getProperty("grammar")); //$NON-NLS-0$
			} else if (type !== "highlighter") {
				var id = serviceRef.getProperty("id");
				if (id && !this.orionGrammars[id]) {
					this.orionGrammars[id] = {
						id: id,
						contentTypes: serviceRef.getProperty("contentTypes"),
						patterns: serviceRef.getProperty("patterns"),
						repository: serviceRef.getProperty("repository")
					};
				}
			}
			var promise = getPromise(serviceRef, extension);
			if (promise) {
				promises.push(promise);
			}
		}
		return Deferred.all(promises, function(error) {return {_error: error};}).then(function(promises) {
			// Take the last matching provider. Could consider ranking them here.
			var provider;
			for (var i = promises.length - 1; i >= 0; i--) {
				var promise = promises[i];
				if (promise && !promise._error && isAllowed(promise)) {
					provider = promise;
					break;
				}
			}
			var styler;
			if (provider) {
				var type = provider.getProperty("type"); //$NON-NLS-0$
				if (type === "highlighter") { //$NON-NLS-0$
					styler = new AsyncStyler(textView, serviceRegistry, annotationModel);
					styler.setContentType(contentType);
				} else if (type === "grammar" || (!NEW && typeof type === "undefined")) { //$NON-NLS-1$ //$NON-NLS-0$
					var textmateGrammar = provider.getProperty("grammar"); //$NON-NLS-0$
					styler = new mTextMateStyler.TextMateStyler(textView, textmateGrammar, textmateGrammars);
				} else {
					if (NEW) {
						var grammars = [];
						for(var key in this.orionGrammars) {
						    grammars.push(this.orionGrammars[key]);
						}
						var stylerAdapter = new mTextStyler2.createPatternBasedAdapter(grammars, provider.getProperty("id"), contentType.id);  //$NON-NLS-0$
						styler = new mTextStyler2.TextStyler(textView, annotationModel, stylerAdapter);
					}
				}
			}
			return styler;
		});
	}
	
	/**
	 * @name orion.highlight.SyntaxHighlighter
	 * @class
	 * @description 
	 * <p>Requires service {@link orion.core.ContentTypeRegistry}</p>
	 * @param {orion.serviceregistry.ServiceRegistry} serviceRegistry Registry to look up highlight providers from.
	 * @param {orion.core.ContentType} [contentTypeService=null] A stand alone content type service that is not registered in theservice registry.
	 */
	function SyntaxHighlighter(serviceRegistry, contentTypeService) {
		this.serviceRegistry = serviceRegistry;
		this.contentTypeService = contentTypeService;
		this.styler = null;
	}
	SyntaxHighlighter.prototype = /** @lends orion.highlight.SyntaxHighlighter.prototype */ {
		/**
		 * @param {orion.core.ContentType} contentType
		 * @param {orion.editor.TextView} textView
		 * @param {orion.editor.AnnotationModel} annotationModel
		 * @param {String} [fileName] <i>Deprecated.</i> For backwards compatibility only, service-contributed highlighters
		 * will be checked against the file extension instead of contentType.
		 * @param {Boolean} [allowAsync=true] If true, plugin-contributed asynchronous highlighters (i.e. <code>type == "highlighter"</code>
		 * will be consulted. If false, only rule-based highlighters will be consulted.
		 * @returns {orion.Deferred} A promise that is resolved when this highlighter has been set up.
		 */
		setup: function(fileContentType, textView, annotationModel, fileName, allowAsync) {
			allowAsync = typeof allowAsync === "undefined" ? true : allowAsync; //$NON-NLS-0$
			if (this.styler) {
				if (this.styler.destroy) {
					this.styler.destroy();
				}
				this.styler = null;
			}
			var self = this;
			return createStyler(this.serviceRegistry, this.contentTypeService ? this.contentTypeService : this.serviceRegistry.getService("orion.core.contentTypeRegistry"), //$NON-NLS-0$
				fileContentType, textView, annotationModel, fileName, allowAsync).then(
					function(styler) {
						self.styler = styler;
						return styler;
					});
		},
		getStyler: function() {
			return this.styler;
		}
	};
	return {
		createStyler: createStyler,
		SyntaxHighlighter: SyntaxHighlighter
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/navigate/nls/messages',{
	root: {//Default message bundle
		"Navigator": "Navigator",
		"Strings Xtrnalizr": "Strings Xtrnalizr",
		"Externalize strings": "Externalize strings from JavaScript files in this folder.",
		"NotSupportFileSystem":"${0} is not supported in this file system",
		"SrcNotSupportBinRead":"Source file service does not support binary read",
		"TargetNotSupportBinWrite":"Target file service does not support binary write",
		"NoFileSrv": "No matching file service for location: ${0}",
		"Choose a Folder": "Choose a Folder",
		"Copy of ${0}": "Copy of ${0}",
		"EnterName": "Enter a new name for '${0}'",
		"ChooseFolder": "Choose folder...",
		"Rename": "Rename",
		"RenameFilesFolders": "Rename the selected files or folders",
		"CompareEach": "Compare with each other",
		"Compare 2 files": "Compare the selected 2 files with each other",
		"Compare with...": "Compare with...",
		"CompareFolders": "Compare the selected folder with a specified folder",
		"Delete": "Delete",
		"Unknown item": "Unknown item",
		"delete item msg": "Are you sure you want to delete these ${0} items?",
		"DeleteTrg": "Are you sure you want to delete '${0}'?",
		"Zip": "Zip",
		"ZipDL": "Create a zip file of the folder contents and download it",
		"New File": "File",
		"Create a new file": "Create a new file",
		"Name:": "Name:",
		"New Folder": "Folder",
		"Folder name:": "Folder name:",
		"Create a new folder": "Create a new folder",
		"Creating folder": "Creating folder",
		"Folder": "Folder",
		"Create an empty folder": "Create an empty folder",
		"CreateEmptyMsg": "Create an empty folder on the Orion server. You can import, upload, or create content in the editor.",
		"Sample HTML5 Site": "Sample HTML5 Site",
		"Generate a sample": "Generate a sample",
		"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.",
		"Creating a folder for ${0}": "Creating a folder for ${0}",
		"SFTP Import": "SFTP Import",
		"Import content from SFTP": "Import content from SFTP",
		"Imported Content": "Imported Content",
		"Upload a Zip": "Upload a Zip",
		"Upload content from a local zip file": "Upload content from a local zip file",
		"Uploaded Content": "Uploaded Content",
		"Clone Git Repository": "Clone Git Repository",
		"Clone a git repository": "Clone a git repository",
		"Link to Server": "Link to Server",
		"LinkContent": "Link to existing content on the server",
		"CreateLinkedFolder": "Create a folder that links to an existing folder on the server.",
		"Server path:": "Server path:",
		"NameLocationNotClear": "The name and server location were not specified.",
		"Go Up": "Go Up",
		"GoUpToParent": "Move up to the parent folder",
		"Go Into": "Go Into",
		"GoSelectedFolder": "Move into the selected folder",
		"File or zip archive": "File or zip archive",
		"ImportLcFile": "Import a file or zip archive from your local file system",
		"SFTP from...": "SFTP",
		"CpyFrmSftp": "Copy files and folders from a specified SFTP connection",
		"Importing from ${0}": "Importing from ${0}",
		"SFTP to...": "SFTP",
		"CpyToSftp": "Copy files and folders to a specified SFTP location",
		"Exporting": "Exporting to ${0}",
		"Pasting ${0}": "Pasting ${0}",
		"Copy to": "Copy to",
		"Move to": "Move to",
		"Copying ${0}": "Copying ${0}",
		"Moving ${0}": "Moving ${0}",
		"Renaming ${0}": "Renaming ${0}",
		"Deleting ${0}": "Deleting ${0}",
		"Creating ${0}": "Creating ${0}",
		"Linking to ${0}": "Linking to ${0}",
		"MvToLocation": "Move files and folders to a new location",
		"Cut": "Cut",
		"Copy": "Copy",
		"Fetching children of ": "Fetching children of ",
		"Paste": "Paste",
		"Open With": "Open With",
		"Loading ": "Loading ",
		"New": "New",
		"File": "File",
		"Actions": "Actions",
		"Orion Content": "Orion Content",
		"Create new content": "Create new content",
		"Import from HTTP...": "HTTP",
		"File URL:": "File URL:",
		"ImportURL": "Import a file from a URL and optionally unzip it",
		"Unzip *.zip files:": "Unzip *.zip files:",
		"Extracted from:": "Extracted from:",
		"FolderDropNotSupported": "Did not drop ${0}. Folder drop is not supported in this browser.",
		"CreateFolderErr": "You cannot copy files directly into the workspace. Create a folder first.",
		"Unzip ${0}?": "Unzip ${0}?",
		"Upload progress: ": "Upload progress: ",
		"Uploading ": "Uploading ",
		"Cancel upload": "Cancel upload",
		"UploadingFileErr": "Uploading the following file failed: ",
		"Enter project name:": "Enter project name:",
		"Create new project" : "Create new project",
		"Creating project ${0}": "Creating project ${0}",
		"NoFile": "Use the ${0} menu to create new files and folders. Click a file to start coding.",
		"Download": "Download",
		"Download_tooltips": "Download the file contents as the displayed name",
		"Downloading...": "Reading file contents...",
		"Download not supported": "Contents download is not supported in this browser.",
		"gettingContentFrom": "Getting content from ",
		"deletingLaunchConfiguration": "Deleting launch configuration...",
		"deployTo": "Deploy to ",
		"deploy": "Deploy ",
		"connect": "Connect",
		"fetchContent": "Fetch content",
		"fetchContentOf": "Fetch content of ",
		"disconnectFromProject": "Disconnect from project",
		"doNotTreatThisFolder": "Do not treat this folder as a part of the project",
		"checkStatus": "Check status",
		"checkApplicationStatus": "Check application status",
		"checkApplicationState": "Check application state",
		"stop": "Stop",
		"start": "Start",
		"stopApplication": "Stop application",
		"startApplication": "Start application",
		"manage": "Manage",
		"manageThisApplicationOnRemote": "Manage this application on remote server",
		"deleteLaunchConfiguration": "Delete this launch configuration",
		"deployThisApplicationAgain": "Deploy this application again",
		"associatedFolder": "Associated Folder",
		"associateAFolderFromThe": "Associate a folder from the workspace with this project.",
		"convertToProject": "Convert to project",
		"convertThisFolderIntoA": "Convert this folder into a project",
		"thisFolderIsAProject": "This folder is a project already.",
		"basic": "Basic",
		"createAnEmptyProject.": "Create an empty project.",
		"sFTP": "SFTP",
		"createAProjectFromAn": "Create a project from an SFTP site.",
		'readMeCommandName': 'Readme File',  //$NON-NLS-0$  //$NON-NLS-1$
		'readMeCommandTooltip': 'Create a README.md file in this project',  //$NON-NLS-0$  //$NON-NLS-1$
		'zipArchiveCommandName': 'Zip archive',  //$NON-NLS-0$  //$NON-NLS-1$
		'zipArchiveCommandTooltip': 'Create a project from a local zip archive.',  //$NON-NLS-0$  //$NON-NLS-1$
		'Url:': 'Url:',  //$NON-NLS-0$  //$NON-NLS-1$
		'notZip' : 'The following files are not zip files: ${0}. Would you like to continue the import?', //$NON-NLS-0$  //$NON-NLS-1$
		'notZipMultiple' : 'There are multiple non-zip files being uploaded. Would you like to continue the import?', //$NON-NLS-0$  //$NON-NLS-1$
		"Cancel": "Cancel", //$NON-NLS-0$  //$NON-NLS-1$
		"Ok": "Ok", //$NON-NLS-0$  //$NON-NLS-1$
		"missingCredentials": "Enter the ${0} authentication credentials associated with ${1} to check its status." //$NON-NLS-0$  //$NON-NLS-1$
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/ja/messages',{
	"Navigator": "ナビゲーター",
	"Strings Xtrnalizr": "Strings Xtrnalizr",
	"Externalize strings": "このフォルダーの JavaScript ファイルのストリングを外部化します。",
	"NotSupportFileSystem":"${0} は、このファイル・システムでサポートされていません",
	"SrcNotSupportBinRead":"ソース・ファイル・サービスはバイナリーの読み取りをサポートしません",
	"TargetNotSupportBinWrite":"ターゲット・ファイル・サービスはバイナリーの書き込みをサポートしません",
	"NoFileSrv": "このロケーションには一致するファイル・サービスがありません: ${0}",
	"Choose a Folder": "フォルダーの選択",
	"Copy of ${0}": "コピー - ${0}",
	"EnterName": "'${0}' の新規名を入力してください",
	"ChooseFolder": "フォルダーの選択...",
	"Rename": "名前変更",
	"RenameFilesFolders": "選択したファイルまたはフォルダーの名前変更",
	"CompareEach": "相互比較",
	"Compare 2 files": "選択した 2 つのファイルを相互に比較",
	"Compare with...": "比較...",
	"CompareFolders": "選択されたフォルダーを指定したフォルダーと比較",
	"Delete": "削除",
	"Unknown item": "不明な項目",
	"delete item msg": "これらの ${0} 個の項目を削除しますか?",
	"DeleteTrg": "'${0}' を削除しますか?",
	"Zip": "zip",
	"ZipDL": "フォルダー内容の Zip ファイルを作成し、ダウンロードします",
	"New File": "ファイル",
	"Create a new file": "新しいファイルの作成",
	"Name:": "名前:",
	"New Folder": "フォルダー",
	"Folder name:": "フォルダー名:",
	"Create a new folder": "新規フォルダーの作成",
	"Creating folder": "フォルダーの作成 ",
	"Folder": "フォルダー",
	"Create an empty folder": "空のフォルダーの作成",
	"CreateEmptyMsg": "Orion サーバーに空のフォルダーを作成します。エディターで、コンテンツのインポート、アップロード、または作成ができます。",
	"Sample HTML5 Site": "サンプル HTML5 サイト",
	"Generate a sample": "サンプルの生成",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "HTML5 \"Hello World\" Web サイト (JavaScript、HTML、および CSS ファイルを含む) を生成します。",
	"Creating a folder for ${0}": "${0} のフォルダーを作成中",
	"SFTP Import": "SFTP インポート",
	"Import content from SFTP": "SFTP からコンテンツをインポート",
	"Imported Content": "インポートされたコンテンツ",
	"Upload a Zip": "Zip のアップロード",
	"Upload content from a local zip file": "ローカル Zip ファイルのコンテンツをアップロード",
	"Uploaded Content": "アップロードされたコンテンツ",
	"Clone Git Repository": "Git リポジトリーのクローン",
	"Clone a git repository": "Git リポジトリーのクローン",
	"Link to Server": "サーバーにリンク",
	"LinkContent": "サーバー上の既存のコンテンツへのリンク",
	"CreateLinkedFolder": "サーバー上の既存のフォルダーにリンクするフォルダーを作成します。",
	"Server path:": "サーバー・パス: ",
	"NameLocationNotClear": "名前とサーバーのロケーションが指定されていません。",
	"Go Up": "上へ",
	"GoUpToParent": "親フォルダーへ移動",
	"Go Into": "次へジャンプ",
	"GoSelectedFolder": "選択したフォルダーに移動します。",
	"File or zip archive": "ファイルまたは zip アーカイブ",
	"ImportLcFile": "ファイルまたは zip アーカイブをローカル・ファイル・システムからインポート",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "指定された SFTP 接続からファイルとフォルダーをコピー",
	"Importing from ${0}": "インポート元 ${0}",
	"SFTP to...": "SFTP",
	"CpyToSftp": "指定された SFTP ロケーションにファイルとフォルダーをコピー",
	"Exporting": "${0} にインポート中",
	"Pasting ${0}": "貼り付け ${0}",
	"Copy to": "コピー先",
	"Move to": "移動先",
	"Copying ${0}": "${0} のコピー中",
	"Moving ${0}": "${0} の移動中",
	"Renaming ${0}": "${0} の名前変更中",
	"Deleting ${0}": "${0} の削除中",
	"Creating ${0}": "${0} の作成中",
	"Linking to ${0}": "${0} にリンク中",
	"MvToLocation": "ファイルとフォルダーを新しいロケーションに移動",
	"Cut": "切り取り",
	"Copy": "コピー",
	"Fetching children of ": "次の子をフェッチしています: ",
	"Paste": "貼り付け",
	"Open With": "アプリケーションから開く",
	"Loading ": "ロード中 ",
	"New": "新規",
	"File": "ファイル",
	"Actions": "アクション",
	"Orion Content": "Orion コンテンツ",
	"Create new content": "新規コンテンツの作成",
	"Import from HTTP...": "HTTP",
	"File URL:": "ファイルの URL:",
	"ImportURL": "URL からファイルをインポートして、オプションで unzip します",
	"Unzip *.zip files:": "*.zip ファイルを unzip します:",
	"Extracted from:": "抽出元:",
	"FolderDropNotSupported": "${0} をドロップしませんでした。フォルダーのドロップは、このブラウザーではサポートされていません。",
	"CreateFolderErr": "ファイルをワークスペースに直接コピーすることはできません。まずフォルダーを作成します。",
	"Unzip ${0}?": "${0} を unzip しますか?",
	"Upload progress: ": "アップロードの進行状況: ",
	"Uploading ": "アップロード ",
	"Cancel upload": "アップロードのキャンセル",
	"UploadingFileErr": "次のファイルのアップロードに失敗しました: ",
	"Enter project name:": "プロジェクト名を入力してください:",
	"Create new project" : "新規プロジェクトの作成",
	"Creating project ${0}": "プロジェクト ${0} の作成中",
	"NoFile": "新しいファイルやフォルダーを作成するには ${0} メニューを使用してください。ファイルをクリックすると、コーディングが開始します。",
	"Download": "ダウンロード",
	"Download_tooltips": "表示された名前でファイルの内容をダウンロードします",
	"Downloading...": "ファイル内容の読み取り中...",
	"Download not supported": "内容のダウンロードはこのブラウザーではサポートされていません。",
	"gettingContentFrom": "コンテンツの取得先",
	"deployTo": "デプロイ先",
	"deploy": "デプロイ",
	"connect": "接続",
	"fetchContent": "コンテンツの取り出し",
	"fetchContentOf": "次のコンテンツの取り出し",
	"disconnectFromProject": "プロジェクトから切断",
	"doNotTreatThisFolder": "このフォルダーをプロジェクトの一部として見なさない",
	"checkStatus": "状況の確認",
	"checkApplicationStatus": "アプリケーション状況の確認",
	"checkApplicationState": "アプリケーション状態の確認",
	"stop": "停止",
	"start": "開始",
	"stopApplication": "アプリケーションの停止",
	"startApplication": "アプリケーションの開始",
	"manage": "管理",
	"manageThisApplicationOnRemote": "このアプリケーションをリモート・サーバーで管理",
	"deployThisApplicationAgain": "このアプリケーションを再度デプロイ",
	"associatedFolder": "関連フォルダー",
	"associateAFolderFromThe": "ワークスペースからのフォルダーをこのプロジェクトと関連付けます。",
	"convertToProject": "プロジェクトに変換",
	"convertThisFolderIntoA": "このフォルダーをプロジェクトに変換",
	"thisFolderIsAProject": "このフォルダーは既にプロジェクトです。",
	"basic": "基本",
	"createAnEmptyProject.": "空のプロジェクトを作成します。",
	"sFTP": "SFTP",
	"createAProjectFromAn": "SFTP サイトからプロジェクトを作成します。",
	'readMeCommandName': 'README ファイル',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'このプロジェクトの README.md ファイルを作成',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'zip アーカイブ',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'ローカルの zip アーカイブからプロジェクトを作成します。',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'URL:',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : '次のファイルは zip ファイルではありません: ${0}。インポートを続行しますか? ', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : '複数の非 zip ファイルがアップロードされています。インポートを続行しますか? ' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/zh/messages',{
	"Navigator": "导航器",
	"Strings Xtrnalizr": "字符串 Xtrnalizr",
	"Externalize strings": "将此文件夹中的 JavaScript 文件中的字符串外部化。",
	"NotSupportFileSystem":"${0} 在此文件系统中不受支持",
	"SrcNotSupportBinRead":"源文件服务不支持读取二进制文件",
	"TargetNotSupportBinWrite":"目标文件服务不支持写入二进制文件",
	"NoFileSrv": "以下位置没有相匹配的文件服务：${0}",
	"Choose a Folder": "选择文件夹",
	"Copy of ${0}": "${0} 的副本",
	"EnterName": "为“${0}”输入新名称",
	"ChooseFolder": "选择文件夹...",
	"Rename": "重命名",
	"RenameFilesFolders": "将所选择的文件或文件夹重命名",
	"CompareEach": "相互比较",
	"Compare 2 files": "将所选的 2 个文件相互比较",
	"Compare with...": "比较对象...",
	"CompareFolders": "将所选文件夹与指定文件夹进行比较",
	"Delete": "删除",
	"Unknown item": "未知项",
	"delete item msg": "确定要删除这些 ${0} 项吗？",
	"DeleteTrg": "确定要删除“${0}”吗？",
	"Zip": "zip",
	"ZipDL": "创建文件夹内容的 zip 文件并下载该文件",
	"New File": "文件",
	"Create a new file": "创建新文件",
	"Name:": "名称：",
	"New Folder": "文件夹",
	"Folder name:": "文件夹名：",
	"Create a new folder": "创建新文件夹",
	"Creating folder": "正在创建文件夹 ",
	"Folder": "文件夹",
	"Create an empty folder": "创建空文件夹",
	"CreateEmptyMsg": "在 Orion 服务器上创建空文件夹。您可以在编辑器中导入、上载或创建内容。",
	"Sample HTML5 Site": "样本 HTML5 站点",
	"Generate a sample": "生成样本",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "生成 HTML5“Hello World”Web 站点（其中包括 JavaScript、HTML 和 CSS 文件）。",
	"Creating a folder for ${0}": "正在为 ${0} 创建文件夹",
	"SFTP Import": "SFTP 导入",
	"Import content from SFTP": "从 SFTP 中导入内容",
	"Imported Content": "已导入的内容",
	"Upload a Zip": "上载 Zip 文件",
	"Upload content from a local zip file": "上载本地 zip 文件中的内容",
	"Uploaded Content": "已上载的内容",
	"Clone Git Repository": "克隆 Git 存储库",
	"Clone a git repository": "克隆 Git 存储库",
	"Link to Server": "链接至服务器",
	"LinkContent": "链接至服务器上的现有内容",
	"CreateLinkedFolder": "创建一个链接至服务器上的现有文件夹的文件夹。",
	"Server path:": "服务器路径：",
	"NameLocationNotClear": "未指定名称和服务器位置。",
	"Go Up": "上移",
	"GoUpToParent": "上移到父文件夹",
	"Go Into": "进入",
	"GoSelectedFolder": "移到所选择的文件夹中",
	"File or zip archive": "文件或 zip 归档",
	"ImportLcFile": "从本地文件系统中导入文件或 zip 归档",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "从所指定的 SFTP 连接复制文件和文件夹",
	"Importing from ${0}": "正在从 ${0} 导入",
	"SFTP to...": "SFTP",
	"CpyToSftp": "将文件和文件夹复制到所指定的 SFTP 位置",
	"Exporting": "正在导出到 ${0}",
	"Pasting ${0}": "正在粘贴 ${0}",
	"Copy to": "复制到",
	"Move to": "移至",
	"Copying ${0}": "正在复制 ${0}",
	"Moving ${0}": "正在移动 ${0}",
	"Renaming ${0}": "正在重命名 ${0}",
	"Deleting ${0}": "正在删除 ${0}",
	"Creating ${0}": "正在创建 ${0}",
	"Linking to ${0}": "正在链接至 ${0}",
	"MvToLocation": "将文件和文件夹移至新位置",
	"Cut": "剪切",
	"Copy": "复制",
	"Fetching children of ": "正在访存子代",
	"Paste": "粘贴",
	"Open With": "打开方式",
	"Loading ": "正在装入",
	"New": "新建",
	"File": "文件",
	"Actions": "操作",
	"Orion Content": "Orion 内容",
	"Create new content": "创建新内容",
	"Import from HTTP...": "HTTP",
	"File URL:": "文件 URL：",
	"ImportURL": "从 URL 导入文件，还可以选择将其解压缩",
	"Unzip *.zip files:": "将 *.zip 文件解压缩：",
	"Extracted from:": "已从以下位置解压缩：",
	"FolderDropNotSupported": "未删除 ${0}。在此浏览器中不支持删除文件夹。",
	"CreateFolderErr": "您无法将文件直接复制到工作空间中。请先创建一个文件夹。",
	"Unzip ${0}?": "要将 ${0} 解压缩吗？",
	"Upload progress: ": "上载进度：",
	"Uploading ": "正在上载 ",
	"Cancel upload": "取消上载",
	"UploadingFileErr": "上载以下文件失败：",
	"Enter project name:": "输入项目名称：",
	"Create new project" : "创建新项目",
	"Creating project ${0}": "正在创建项目 ${0}",
	"NoFile": "请使用${0}菜单来创建新的文件和文件夹。单击文件以开始编码。",
	"Download": "下载",
	"Download_tooltips": "将文件内容以所显示的名称下载",
	"Downloading...": "正在读取文件内容...",
	"Download not supported": "在此浏览器中不支持下载内容。",
	"gettingContentFrom": "从以下位置获取内容",
	"deployTo": "部署至",
	"deploy": "部署",
	"connect": "连接",
	"fetchContent": "访存内容",
	"fetchContentOf": "访存以下内容",
	"disconnectFromProject": "断开与项目的连接",
	"doNotTreatThisFolder": "此文件夹不属于项目",
	"checkStatus": "检查状态",
	"checkApplicationStatus": "检查应用程序状态",
	"checkApplicationState": "检查应用程序状态",
	"stop": "停止",
	"start": "开始",
	"stopApplication": "停止应用程序",
	"startApplication": "启动应用程序",
	"manage": "管理",
	"manageThisApplicationOnRemote": "在远程服务器上管理此应用程序",
	"deployThisApplicationAgain": "再次部署此应用程序",
	"associatedFolder": "关联的文件夹",
	"associateAFolderFromThe": "将工作空间中的文件夹与此项目相关联。",
	"convertToProject": "转换为项目",
	"convertThisFolderIntoA": "将此文件夹转换到项目中",
	"thisFolderIsAProject": "此文件夹已经是项目。",
	"basic": "基本",
	"createAnEmptyProject.": "创建空项目。",
	"sFTP": "SFTP",
	"createAProjectFromAn": "从 SFTP 站点创建项目。",
	'readMeCommandName': '自述文件',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': '在此项目中创建 README.md 文件',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'ZIP 归档',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': '从本地 ZIP 归档中创建项目。',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'Url：',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : '以下文件不是 zip 文件：${0}。要继续导入吗？', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : '存在多个要上载的非 zip 文件。要继续导入吗？' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/zh-tw/messages',{
	"Navigator": "導覽器",
	"Strings Xtrnalizr": "字串 Xtrnalizr",
	"Externalize strings": "從這個資料夾中的 JavaScript 檔將字串提出。",
	"NotSupportFileSystem":"在此檔案系統中不支援 ${0}",
	"SrcNotSupportBinRead":"原始檔服務不支援讀取二進位檔",
	"TargetNotSupportBinWrite":"目標檔案服務不支援寫入二進位檔",
	"NoFileSrv": "位置沒有相符的檔案服務：${0}",
	"Choose a Folder": "選擇資料夾",
	"Copy of ${0}": "${0} 的副本",
	"EnterName": "輸入 '${0}' 的新名稱",
	"ChooseFolder": "選擇資料夾...",
	"Rename": "重新命名",
	"RenameFilesFolders": "重新命名選取的檔案或資料夾",
	"CompareEach": "互相比較",
	"Compare 2 files": "將選取的 2 個檔案互相比較",
	"Compare with...": "相互比較...",
	"CompareFolders": "將選取的資料夾與指定的資料夾互相比較",
	"Delete": "刪除",
	"Unknown item": "不明項目",
	"delete item msg": "您確定要刪除這 ${0} 個項目嗎？",
	"DeleteTrg": "確定要刪除 '${0}' 嗎？",
	"Zip": "Zip",
	"ZipDL": "建立資料夾內容的 zip 檔並下載它",
	"New File": "檔案",
	"Create a new file": "建立新的檔案",
	"Name:": "名稱：",
	"New Folder": "資料夾",
	"Folder name:": "資料夾名稱：",
	"Create a new folder": "建立新資料夾",
	"Creating folder": "建立資料夾",
	"Folder": "資料夾",
	"Create an empty folder": "建立空的資料夾",
	"CreateEmptyMsg": "在 Orion 伺服器上建立空的資料夾。您可以在編輯器中匯入、上傳或建立內容。",
	"Sample HTML5 Site": "HTML5 範例網站",
	"Generate a sample": "產生範例",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "產生 HTML5 \"Hello World\" 網站，包含 JavaScript、HTML 及 CSS 檔。",
	"Creating a folder for ${0}": "建立 ${0} 的資料夾",
	"SFTP Import": "SFTP 匯入",
	"Import content from SFTP": "從 SFTP 匯入內容",
	"Imported Content": "匯入的內容",
	"Upload a Zip": "上傳 Zip",
	"Upload content from a local zip file": "從本端 zip 檔上傳內容",
	"Uploaded Content": "上傳的內容",
	"Clone Git Repository": "複製 Git 儲存庫",
	"Clone a git repository": "複製 Git 儲存庫",
	"Link to Server": "鏈結至伺服器",
	"LinkContent": "鏈結至伺服器上的現有內容",
	"CreateLinkedFolder": "建立資料夾來鏈結至伺服器上的現有資料夾。",
	"Server path:": "伺服器路徑：",
	"NameLocationNotClear": "未指定名稱和伺服器位置。",
	"Go Up": "往上",
	"GoUpToParent": "往上移至上層資料夾",
	"Go Into": "進入",
	"GoSelectedFolder": "移至選取的資料夾",
	"File or zip archive": "檔案或 zip 保存檔",
	"ImportLcFile": "從本端檔案系統匯入檔案或 zip 保存檔",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "從指定的 SFTP 連線複製檔案和資料夾",
	"Importing from ${0}": "正在從 ${0} 匯入",
	"SFTP to...": "SFTP",
	"CpyToSftp": "將檔案和資料夾複製到指定的 SFTP 位置",
	"Exporting": "正在匯出至 ${0}",
	"Pasting ${0}": "正在貼上 ${0}",
	"Copy to": "複製到",
	"Move to": "移動到",
	"Copying ${0}": "正在複製 ${0}",
	"Moving ${0}": "正在移動 ${0}",
	"Renaming ${0}": "正在重新命名 ${0}",
	"Deleting ${0}": "正在刪除 ${0}",
	"Creating ${0}": "正在建立 ${0}",
	"Linking to ${0}": "正在鏈結至 ${0}",
	"MvToLocation": "將檔案和資料夾移至新的位置",
	"Cut": "剪下",
	"Copy": "複製",
	"Fetching children of ": "正在提取子項：",
	"Paste": "貼上",
	"Open With": "開啟工具",
	"Loading ": "正在載入 ",
	"New": "新建",
	"File": "檔案",
	"Actions": "動作",
	"Orion Content": "Orion 內容",
	"Create new content": "建立新內容",
	"Import from HTTP...": "HTTP",
	"File URL:": "檔案 URL：",
	"ImportURL": "從 URL 匯入檔案，並可選擇將其解壓縮",
	"Unzip *.zip files:": "將 *.zip 檔解壓縮：",
	"Extracted from:": "已從下列位置解壓縮：",
	"FolderDropNotSupported": "未捨棄 ${0}。 在這個瀏覽器中不支援捨棄資料夾。",
	"CreateFolderErr": "您無法將檔案直接複製到工作區。請先建立資料夾。",
	"Unzip ${0}?": "要將 ${0} 解壓縮嗎？",
	"Upload progress: ": "上傳進度：",
	"Uploading ": "上傳中",
	"Cancel upload": "取消上傳",
	"UploadingFileErr": "上傳下列檔案失敗：",
	"Enter project name:": "輸入專案名稱：",
	"Create new project" : "建立新專案",
	"Creating project ${0}": "正在建立專案 ${0}",
	"NoFile": "使用 ${0}功能表來建立新的檔案與資料夾。請按一下檔案，開始編碼。",
	"Download": "下載",
	"Download_tooltips": "以顯示的名稱下載檔案內容",
	"Downloading...": "正在讀取檔案內容...",
	"Download not supported": "這個瀏覽器中不支援下載內容。",
	"gettingContentFrom": "從下列取得內容 ",
	"deployTo": "部署至 ",
	"deploy": "部署 ",
	"connect": "連接",
	"fetchContent": "提取內容",
	"fetchContentOf": "提取下列的內容 ",
	"disconnectFromProject": "與專案切斷連接",
	"doNotTreatThisFolder": "不要將此資料夾視為專案的一部份",
	"checkStatus": "檢查狀態",
	"checkApplicationStatus": "檢查應用程式狀態",
	"checkApplicationState": "檢查應用程式狀態",
	"stop": "停止",
	"start": "啟動",
	"stopApplication": "停止應用程式",
	"startApplication": "開始應用程式",
	"manage": "管理",
	"manageThisApplicationOnRemote": "在遠端伺服器上管理此應用程式",
	"deployThisApplicationAgain": "重新部署此應用程式",
	"associatedFolder": "關聯的資料夾",
	"associateAFolderFromThe": "從工作區將資料夾關聯到這個專案。",
	"convertToProject": "轉換成專案",
	"convertThisFolderIntoA": "將這個資料夾轉換成專案",
	"thisFolderIsAProject": "這個資料夾已經是專案。",
	"basic": "基本",
	"createAnEmptyProject.": "建立空的專案。",
	"sFTP": "SFTP",
	"createAProjectFromAn": "從 SFTP 站台建立專案。",
	'readMeCommandName': 'README 檔',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': '在這個專案中建立 README.md 檔',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'Zip 保存檔',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': '從本端 zip 保存檔來建立專案。',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'URL：',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : '下列檔案不是壓縮檔：${0}。您要繼續匯入嗎？', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : '正在上傳多個非壓縮檔。您要繼續匯入嗎？' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/fr/messages',{
	"Navigator": "Navigateur",
	"Strings Xtrnalizr": "Système d'externalisation de chaînes",
	"Externalize strings": "Externaliser les chaînes des fichiers JavaScript dans ce dossier.",
	"NotSupportFileSystem":"${0} n'est pas pris en charge dans ce système de fichiers",
	"SrcNotSupportBinRead":"Le service de fichier source ne prend pas en charge la lecture binaire",
	"TargetNotSupportBinWrite":"Le service de fichier cible ne prend pas en charge l'écriture binaire",
	"NoFileSrv": "Aucun service de fichier correspondant pour l'emplacement : ${0}",
	"Choose a Folder": "Sélectionnez un dossier",
	"Copy of ${0}": "Copie de ${0}",
	"EnterName": "Entrez un nouveau nom pour '${0}'",
	"ChooseFolder": "Sélectionnez un dossier...",
	"Rename": "Renommer",
	"RenameFilesFolders": "Renommer les fichiers ou les dossiers sélectionnés",
	"CompareEach": "Comparer les uns avec les autres",
	"Compare 2 files": "Comparer les 2 fichiers sélectionnés",
	"Compare with...": "Comparer avec...",
	"CompareFolders": "Comparer le dossier sélectionné avec le dossier spécifié",
	"Delete": "Supprimer",
	"Unknown item": "Elément inconnu",
	"delete item msg": "Voulez-vous vraiment supprimer ces éléments ${0} ?",
	"DeleteTrg": "Voulez-vous vraiment supprimer '${0}' ?",
	"Zip": "Zip",
	"ZipDL": "Créez un fichier zip du contenu du dossier et téléchargez-le",
	"New File": "Fichier",
	"Create a new file": "Créer un nouveau fichier",
	"Name:": "Nom :",
	"New Folder": "Dossier",
	"Folder name:": "Nom du dossier :",
	"Create a new folder": "Créer un nouveau dossier",
	"Creating folder": "Création du dossier",
	"Folder": "Dossier",
	"Create an empty folder": "Créer un dossier vide",
	"CreateEmptyMsg": "Créez un dossier vide sur le serveur Orion. Vous pouvez importer, télécharger ou créer le contenu dans l'éditeur.",
	"Sample HTML5 Site": "Exemple de site HTML5",
	"Generate a sample": "Générer un échantillon",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "Générez un site Web HTML5 \"Hello World\", y compris des fichiers JavaScript, HTML et CSS.",
	"Creating a folder for ${0}": "Création d'un dossier pour ${0}",
	"SFTP Import": "Importation de SFTP",
	"Import content from SFTP": "Importer du contenu de SFTP",
	"Imported Content": "Contenu importé",
	"Upload a Zip": "Télécharger un fichier zip",
	"Upload content from a local zip file": "Télécharger le contenu à partir d'un fichier zip local",
	"Uploaded Content": "Contenu téléchargé",
	"Clone Git Repository": "Cloner un référentiel Git",
	"Clone a git repository": "Cloner un référentiel Git",
	"Link to Server": "Lier à un serveur",
	"LinkContent": "Lier au contenu existant sur le serveur",
	"CreateLinkedFolder": "Créez un dossier établissant un lien vers un dossier existant sur le serveur.",
	"Server path:": "Chemin du serveur :",
	"NameLocationNotClear": "Le nom et l'emplacement du serveur n'ont pas été spécifiés.",
	"Go Up": "Remonter",
	"GoUpToParent": "Remonter vers le dossier parent",
	"Go Into": "Aller dans",
	"GoSelectedFolder": "Accéder au dossier sélectionné",
	"File or zip archive": "Fichier ou archive zip",
	"ImportLcFile": "Importer un fichier ou une archive zip à partir de votre système de fichiers local",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "Copier les fichiers et les dossiers d'une connexion SFTP spécifiée",
	"Importing from ${0}": "Importation à partir de ${0}",
	"SFTP to...": "SFTP",
	"CpyToSftp": "Copier les fichiers et les dossiers vers un emplacement SFTP spécifié",
	"Exporting": "Exportation dans ${0}",
	"Pasting ${0}": "Collage de ${0}",
	"Copy to": "Copier vers",
	"Move to": "Déplacer vers",
	"Copying ${0}": "Copie de ${0}",
	"Moving ${0}": "Déplacement de ${0}",
	"Renaming ${0}": "Changement de nom de ${0}",
	"Deleting ${0}": "Suppression de ${0}",
	"Creating ${0}": "Création de ${0}",
	"Linking to ${0}": "Liaison vers ${0}",
	"MvToLocation": "Transférer les fichiers et les dossiers vers un nouvel emplacement",
	"Cut": "Couper",
	"Copy": "Copier",
	"Fetching children of ": "Extraction des enfants de ",
	"Paste": "Coller",
	"Open With": "Ouvrir avec",
	"Loading ": "Chargement ",
	"New": "Nouveau",
	"File": "Fichier",
	"Actions": "Actions",
	"Orion Content": "Contenu Orion",
	"Create new content": "Créer un nouveau contenu",
	"Import from HTTP...": "HTTP",
	"File URL:": "Adresse URL du fichier :",
	"ImportURL": "Importer un fichier à partir d'une URL et éventuellement, le décompresser",
	"Unzip *.zip files:": "Décompresser les fichiers *.zip :",
	"Extracted from:": "Extrait de :",
	"FolderDropNotSupported": "${0} n'a pas été supprimé. La suppression de dossier n'est pas prise en charge dans ce navigateur.",
	"CreateFolderErr": "Vous ne pouvez pas copier des fichiers directement dans l'espace de travail. Vous devez d'abord créer un dossier.",
	"Unzip ${0}?": "Voulez-vous décompresser ${0} ?",
	"Upload progress: ": "Progression du téléchargement : ",
	"Uploading ": "Téléchargement de ",
	"Cancel upload": "Annuler le téléchargement en amont",
	"UploadingFileErr": "Echec du téléchargement du fichier suivant : ",
	"Enter project name:": "Entrez le nom du projet :",
	"Create new project" : "Créer un projet ",
	"Creating project ${0}": "Création du projet ${0}",
	"NoFile": "Utilisez le menu ${0} pour créer de nouveaux fichiers et dossiers. Cliquez sur un fichier pour commencer le codage.",
	"Download": "Télécharger",
	"Download_tooltips": "Télécharger le contenu du fichier sous le nom affiché",
	"Downloading...": "Lecture du contenu du fichier...",
	"Download not supported": "Le téléchargement du contenu n'est pas pris en charge dans ce navigateur.",
	"gettingContentFrom": "Obtention d'un contenu de ",
	"deployTo": "Déployer vers ",
	"deploy": "Déployer ",
	"connect": "Connecter",
	"fetchContent": "Extraire un contenu",
	"fetchContentOf": "Extraire un contenu de ",
	"disconnectFromProject": "Déconnecter du projet",
	"doNotTreatThisFolder": "Ne pas traiter ce dossier en tant que partie du projet",
	"checkStatus": "Vérifier le statut",
	"checkApplicationStatus": "Vérifier le statut de l'application",
	"checkApplicationState": "Vérifier l'état de l'application",
	"stop": "Arrêt",
	"start": "Démarrage",
	"stopApplication": "Arrêter l'application",
	"startApplication": "Démarrer l'application",
	"manage": "Gérer",
	"manageThisApplicationOnRemote": "Gérer cette application sur un serveur distant",
	"deployThisApplicationAgain": "Redéployer cette application",
	"associatedFolder": "Dossier associé",
	"associateAFolderFromThe": "Associer un dossier de l'espace de travail à ce projet.",
	"convertToProject": "Convertir en projet",
	"convertThisFolderIntoA": "Convertir ce dossier en projet",
	"thisFolderIsAProject": "Ce dossier est déjà un projet.",
	"basic": "Basique",
	"createAnEmptyProject.": "Créer un projet vide",
	"sFTP": "SFTP",
	"createAProjectFromAn": "Créer un projet à partir d'un site SFTP.",
	'readMeCommandName': 'Fichier Readme',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'Créer un fichier README.md dans ce projet',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'Archive Zip',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'Créer un projet à partir d\'une archive ZIP locale.',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'URL :',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : 'Les fichiers suivants ne sont pas des fichiers zip : ${0}. Voulez-vous continuer l\'importation ? ', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : 'Plusieurs fichiers autres que des fichiers zip sont en cours de téléchargement. Voulez-vous continuer l\'importation ? ' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/de/messages',{
	"Navigator": "Navigator",
	"Strings Xtrnalizr": "Strings Xtrnalizr",
	"Externalize strings": "Zeichenfolgen aus JavaScript-Dateien in diesen Ordner auslagern",
	"NotSupportFileSystem":"${0} wird in diesem Dateisystem nicht unterstützt.",
	"SrcNotSupportBinRead":"Der Quellendateiservice unterstützt binäre Lesevorgänge nicht.",
	"TargetNotSupportBinWrite":"Der Zieldateiservice unterstützt binäre Schreibvorgänge nicht.",
	"NoFileSrv": "Kein übereinstimmender Dateiservice für Position: ${0}",
	"Choose a Folder": "Ordner auswählen",
	"Copy of ${0}": "Kopie von ${0}",
	"EnterName": "Geben Sie einen neuen Namen für '${0}' ein.",
	"ChooseFolder": "Ordner auswählen...",
	"Rename": "Umbenennen",
	"RenameFilesFolders": "Ausgewählte Dateien oder Ordner umbenennen",
	"CompareEach": "Miteinander vergleichen",
	"Compare 2 files": "Die beiden ausgewählten Dateien miteinander vergleichen",
	"Compare with...": "Vergleichen mit...",
	"CompareFolders": "Den ausgewählten Ordner mit einem angegebenen Ordner vergleichen",
	"Delete": "Löschen",
	"Unknown item": "Unbekanntes Element",
	"delete item msg": "Sollen diese ${0} Elemente tatsächlich gelöscht werden?",
	"DeleteTrg": "Soll '${0}' tatsächlich gelöscht werden?",
	"Zip": "Zip",
	"ZipDL": "ZIP-Datei des Ordnerinhalts erstellen und herunterladen",
	"New File": "Datei",
	"Create a new file": "Eine neue Datei erzeugen",
	"Name:": "Name:",
	"New Folder": "Ordner",
	"Folder name:": "Ordnername:",
	"Create a new folder": "Neuen Ordner erstellen",
	"Creating folder": "Ordner erstellen",
	"Folder": "Ordner",
	"Create an empty folder": "Leeren Ordner erstellen",
	"CreateEmptyMsg": "Leeren Ordner auf dem Orion-Server erstellen. Sie können Inhalte in den Editor importieren, in den Editor hochladen oder im Editor erstellen.",
	"Sample HTML5 Site": "HTML5-Beispielsite",
	"Generate a sample": "Beispiel erstellen",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "HTML5-Website \"Hello World\" einschließlich der JavaScript-, HTML- und CSS-Dateien generieren.",
	"Creating a folder for ${0}": "Ordner für ${0} wird erstellt",
	"SFTP Import": "SFTP-Import",
	"Import content from SFTP": "Inhalt aus SFTP importieren",
	"Imported Content": "Importierter Inhalt",
	"Upload a Zip": "ZIP-Datei hochladen",
	"Upload content from a local zip file": "Inhalt aus einer lokalen ZIP-Datei hochladen",
	"Uploaded Content": "Hochgeladener Inhalt",
	"Clone Git Repository": "Git-Repository klonen",
	"Clone a git repository": "Git-Repository klonen",
	"Link to Server": "Link zum Server",
	"LinkContent": "Stellen Sie einen Link zum vorhandenen Inhalt auf dem Server her",
	"CreateLinkedFolder": "Erstellen Sie einen Ordner, der einen Link zu einem vorhandenen Ordner auf dem Server herstellt.",
	"Server path:": "Serverpfad:",
	"NameLocationNotClear": "Der Name und die Position des Servers wurden nicht angegeben.",
	"Go Up": "Nach oben",
	"GoUpToParent": "In den übergeordneten Ordner wechseln",
	"Go Into": "Gehe in",
	"GoSelectedFolder": "In ausgewählten Ordner gehen",
	"File or zip archive": "Datei oder ZIP-Archiv",
	"ImportLcFile": "Datei oder ZIP-Archiv aus Ihrem lokalen Dateisystem importieren",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "Dateien und Ordner aus einer angegebenen SFTP-Verbindung kopieren",
	"Importing from ${0}": "Import aus ${0} läuft",
	"SFTP to...": "SFTP",
	"CpyToSftp": "Dateien und Ordner an eine angegebene SFTP-Position kopieren",
	"Exporting": "Exportieren nach ${0}",
	"Pasting ${0}": "${0} wird eingefügt",
	"Copy to": "Kopieren nach",
	"Move to": "Verschieben nach",
	"Copying ${0}": "${0} wird kopiert",
	"Moving ${0}": "${0} wird verschoben",
	"Renaming ${0}": "${0} wird umbenannt",
	"Deleting ${0}": "${0} wird gelöscht",
	"Creating ${0}": "${0} wird erstellt",
	"Linking to ${0}": "Link zu ${0} wird hergestellt",
	"MvToLocation": "Dateien und Ordner an eine neue Position versetzen",
	"Cut": "Ausschneiden",
	"Copy": "Kopieren",
	"Fetching children of ": "Hiervon untergeordnete Elemente abrufen: ",
	"Paste": "Einfügen",
	"Open With": "Öffnen mit",
	"Loading ": "Ladevorgang läuft ",
	"New": "Neu",
	"File": "Datei",
	"Actions": "Aktionen",
	"Orion Content": "Orion-Inhalt",
	"Create new content": "Neuen Inhalt erstellen",
	"Import from HTTP...": "HTTP",
	"File URL:": "Datei-URL:",
	"ImportURL": "Datei von einer URL importieren und optional dekomprimieren",
	"Unzip *.zip files:": "ZIP-Dateien dekomprimieren:",
	"Extracted from:": "Extrahiert aus:",
	"FolderDropNotSupported": "${0} wurde nicht gelöscht. Das Löschen von Ordnern wird in diesem Browser nicht unterstützt.",
	"CreateFolderErr": "Sie können Dateien nicht direkt in den Arbeitsbereich kopieren. Erstellen Sie zunächst einen Ordner.",
	"Unzip ${0}?": "${0} dekomprimieren?",
	"Upload progress: ": "Uploadfortschritt: ",
	"Uploading ": "Upload läuft ",
	"Cancel upload": "Upload abbrechen",
	"UploadingFileErr": "Für folgende Datei ist der Uploadvorgang fehlgeschlagen: ",
	"Enter project name:": "Projektname eingeben:",
	"Create new project" : "Neues Projekt erstellen",
	"Creating project ${0}": "Projekt ${0} wird erstellt",
	"NoFile": "Verwenden Sie das Menü ${0}, um neue Dateien und Ordner zu erstellen. Klicken Sie auf eine Datei, um mit der Codierung zu beginnen.",
	"Download": "Herunterladen",
	"Download_tooltips": "Dateiinhalt unter angezeigtem Namen herunterladen",
	"Downloading...": "Dateiinhalt wird gelesen...",
	"Download not supported": "Das Herunterladen von Inhalt wird in diesem Browser nicht unterstützt.",
	"gettingContentFrom": "Inhalt abrufen von ",
	"deployTo": "Bereitstellen in ",
	"deploy": "Bereitstellen ",
	"connect": "Verbinden",
	"fetchContent": "Inhalt abrufen",
	"fetchContentOf": "Inhalt abrufen von ",
	"disconnectFromProject": "Verbindung zu Projekt trennen",
	"doNotTreatThisFolder": "Diesen Ordner nicht als Teil des hs behandeln",
	"checkStatus": "Status prüfen",
	"checkApplicationStatus": "Anwendungsstatus prüfen",
	"checkApplicationState": "Anwendungszustand prüfen",
	"stop": "Stoppen",
	"start": "Starten",
	"stopApplication": "Anwendung stoppen",
	"startApplication": "Anwendung starten",
	"manage": "Verwalten",
	"manageThisApplicationOnRemote": "Diese Anwendung auf fernem Server verwalten",
	"deployThisApplicationAgain": "Diese Anwendung erneut bereitstellen",
	"associatedFolder": "Zugeordneter Ordner",
	"associateAFolderFromThe": "Diesem Projekt einen Ordner aus dem Arbeitsbereich zuordnen.",
	"convertToProject": "In Projekt konvertieren",
	"convertThisFolderIntoA": "Diesen Ordner in ein Projekt konvertieren",
	"thisFolderIsAProject": "Dieser Ordner ist bereits ein Projekt.",
	"basic": "Basis",
	"createAnEmptyProject.": "Leeres Projekt erstellen.",
	"sFTP": "SFTP",
	"createAProjectFromAn": "Projekt aus einer SFTP-Site erstellen.",
	'readMeCommandName': 'Readme-Datei',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'Eine README.md-Datei in diesem Projekt erstellen',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'ZIP-Archiv',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'Ein Projekt aus einem lokalen ZIP-Archiv erstellen.',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'URL:',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : 'Die folgenden Dateien sind keine ZIP-Dateien: ${0}. Soll der Import fortgesetzt werden?', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : 'Der Upload umfasst mehrere nicht mit ZIP komprimierte Dateien. Soll der Import fortgesetzt werden?' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/it/messages',{
	"Navigator": "Navigator",
	"Strings Xtrnalizr": "Stringhe Xtrnalizr",
	"Externalize strings": "Esternalizza stringhe dai file JavaScript in questa cartella.",
	"NotSupportFileSystem":"${0} non è supportato in questo file di sistema",
	"SrcNotSupportBinRead":"Il servizio file di origine non supporta la lettura binaria",
	"TargetNotSupportBinWrite":"Il servizio file di destinazione non supporta la scrittura binaria",
	"NoFileSrv": "Nessun servizio file corrispondente per ubicazione: ${0}",
	"Choose a Folder": "Seleziona una cartella",
	"Copy of ${0}": "Copia di ${0}",
	"EnterName": "Immettere un nuovo nome per '${0}'",
	"ChooseFolder": "Scegli cartella...",
	"Rename": "Rinomina",
	"RenameFilesFolders": "Ridenomina i file o le cartelle selezionate",
	"CompareEach": "Confronta l'uno con l'altro",
	"Compare 2 files": "Confronta l'uno con l'altro di 2 file selezionati",
	"Compare with...": "Confronta con...",
	"CompareFolders": "Confronta la cartella selezionata con una cartella specificata",
	"Delete": "Elimina",
	"Unknown item": "Elemento sconosciuto",
	"delete item msg": "Eliminare questi elementi ${0}?",
	"DeleteTrg": "Eliminare '${0}'?",
	"Zip": "Zip",
	"ZipDL": "Creare un file zip del contenuto della cartella e scaricarlo",
	"New File": "File",
	"Create a new file": "Crea un nuovo file",
	"Name:": "Nome:",
	"New Folder": "Cartella",
	"Folder name:": "Nome cartella:",
	"Create a new folder": "Crea una nuova cartella",
	"Creating folder": "Creazione cartella",
	"Folder": "Cartella",
	"Create an empty folder": "Crea una cartella vuota",
	"CreateEmptyMsg": "Crea una cartella vuota nel server Orion. È possibile importare, caricare o creare il contenuto nell'editor.",
	"Sample HTML5 Site": "Sito HTML5 di esempio",
	"Generate a sample": "Genera un esempio",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "Genera un sito Web HTML5 \"Hello World\", includendo i file JavaScript, HTML e CSS.",
	"Creating a folder for ${0}": "Creazione di una cartella per ${0}",
	"SFTP Import": "Importazione SFTP",
	"Import content from SFTP": "Importa contenuto da SFTP",
	"Imported Content": "Contenuto importato",
	"Upload a Zip": "Carica uno Zip",
	"Upload content from a local zip file": "Carica il contenuto da un file zip locale",
	"Uploaded Content": "Contenuto caricato",
	"Clone Git Repository": "Clona repository Git",
	"Clone a git repository": "Clona repository git",
	"Link to Server": "Collega al server",
	"LinkContent": "Collega al contenuto esistente sul server",
	"CreateLinkedFolder": "Crea una cartella che si collega ad una cartella esistente sul server.",
	"Server path:": "Percorso del server:",
	"NameLocationNotClear": "Il nome e la posizione del server non sono stati specificati.",
	"Go Up": "Vai su",
	"GoUpToParent": "Sposta sulla cartella padre",
	"Go Into": "Vai in",
	"GoSelectedFolder": "Sposta nella cartella selezionata",
	"File or zip archive": "File o archivio zip",
	"ImportLcFile": "Importa un file o archivio zip dal proprio file system locale",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "Copia file e cartelle da una connessione SFTP specificata",
	"Importing from ${0}": "Importazione da ${0}",
	"SFTP to...": "SFTP",
	"CpyToSftp": "Copia file e cartelle in una posizione SFTP specificata",
	"Exporting": "Esportazione in ${0}",
	"Pasting ${0}": "Operazione di incolla da ${0}",
	"Copy to": "Copia in",
	"Move to": "Sposta in",
	"Copying ${0}": "Copia di ${0}",
	"Moving ${0}": "Spostamento di ${0}",
	"Renaming ${0}": "Ridenominazione di ${0}",
	"Deleting ${0}": "Eliminazione di ${0}",
	"Creating ${0}": "Creazione di ${0}",
	"Linking to ${0}": "Collegamento a ${0}",
	"MvToLocation": "Sposta file e cartelle in una nuova posizione",
	"Cut": "Taglia",
	"Copy": "Copia",
	"Fetching children of ": "Recupero elementi secondari di ",
	"Paste": "Incolla",
	"Open With": "Apri con",
	"Loading ": "Caricamento ",
	"New": "Nuovo",
	"File": "File",
	"Actions": "Azioni",
	"Orion Content": "Il contenuto Orion",
	"Create new content": "Crea un nuovo contenuto",
	"Import from HTTP...": "HTTP",
	"File URL:": "URL file:",
	"ImportURL": "Importa un file da un URL e decomprimi facoltativamente il file",
	"Unzip *.zip files:": "Decomprimi file *.zip:",
	"Extracted from:": "Estratti da:",
	"FolderDropNotSupported": "${0} non è stato eliminato. L'eliminazione della cartella non è supportata in questo browser.",
	"CreateFolderErr": "Non è possibile copiare i file direttamente nello spazio di lavoro. Creare prima una cartella.",
	"Unzip ${0}?": "Decomprimere ${0}?",
	"Upload progress: ": "Avanzamento caricamento: ",
	"Uploading ": "Aggiornamento ",
	"Cancel upload": "Annulla caricamento",
	"UploadingFileErr": "Il caricamento del seguente file non è riuscito: ",
	"Enter project name:": "Immetti nome progetto:",
	"Create new project" : "Crea nuovo progetto",
	"Creating project ${0}": "Creazione del progetto ${0}",
	"NoFile": "Utilizzare il menu ${0} per creare nuovi file e cartelle. Fare clic su un file per avviare la codifica.",
	"Download": "Download",
	"Download_tooltips": "Eseguire il download del contenuto file con il nome visualizzato",
	"Downloading...": "Lettura del contenuto file in corso...",
	"Download not supported": "Il download del contenuto non è supportato in questo browser.",
	"gettingContentFrom": "Richiamo del contenuto da ",
	"deployTo": "Distribuisci a ",
	"deploy": "Distribuisci ",
	"connect": "Connetti",
	"fetchContent": "Recupera contenuto",
	"fetchContentOf": "Recupera contenuto di ",
	"disconnectFromProject": "Disconnetti dal progetto",
	"doNotTreatThisFolder": "Non considerare questa cartella come parte del progetto",
	"checkStatus": "Verifica condizione",
	"checkApplicationStatus": "Verifica condizione applicazione",
	"checkApplicationState": "Verifica stato applicazione",
	"stop": "Arresta",
	"start": "Avvia",
	"stopApplication": "Arresta applicazione",
	"startApplication": "Avvia applicazione",
	"manage": "Gestisci",
	"manageThisApplicationOnRemote": "Gestisci questa applicazione sul server remoto",
	"deployThisApplicationAgain": "Distribuisci nuovamente questa applicazione",
	"associatedFolder": "Cartella associata",
	"associateAFolderFromThe": "Associa una cartella dallo spazio di lavoro a questo progetto.",
	"convertToProject": "Converti nel progetto",
	"convertThisFolderIntoA": "Converti questa cartella in un progetto",
	"thisFolderIsAProject": "Questa cartella è già un progetto.",
	"basic": "Elemento di base",
	"createAnEmptyProject.": "Creare un progetto vuoto.",
	"sFTP": "SFTP",
	"createAProjectFromAn": "Creare un progetto da un sito SFTP.",
	'readMeCommandName': 'File Readme',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'Crea un file README.md in questo progetto',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'Archivio Zip',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'Crea un progetto da un archivio zip locale.',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'Url:',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : 'I seguenti file non sono file di zip: ${0}. Si desidera continuare l\'importazione?', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : 'Esistono più file non in formato zip in fase di caricamento. Si desidera continuare l\'importazione?' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/es/messages',{
	"Navigator": "Navegador",
	"Strings Xtrnalizr": "Externalizar series",
	"Externalize strings": "Externalizar series de JavaScript en esta carpeta.",
	"NotSupportFileSystem":"${0} no está soportado en este sistema de archivos",
	"SrcNotSupportBinRead":"El servicio del archivo de origen no da soporte a la lectura binaria",
	"TargetNotSupportBinWrite":"El servicio del archivo de destino no da soporte a la escritura binaria",
	"NoFileSrv": "No hay ningún servicio de archivos coincidente para la ubicación: ${0}",
	"Choose a Folder": "Elegir carpeta",
	"Copy of ${0}": "Copia de ${0}",
	"EnterName": "Teclee un nombre nuevo para '${0}'",
	"ChooseFolder": "Seleccionar carpeta...",
	"Rename": "Renombrar",
	"RenameFilesFolders": "Renombrar archivos o carpetas seleccionados",
	"CompareEach": "Comparar entre sí",
	"Compare 2 files": "Comparar entre sí los 2 archivos seleccionados",
	"Compare with...": "Comparar con...",
	"CompareFolders": "Comparar la carpeta seleccionada con la carpeta especificada",
	"Delete": "Suprimir",
	"Unknown item": "Elemento desconocido",
	"delete item msg": "¿Seguro que desea suprimir estos ${0} artículos?",
	"DeleteTrg": "¿Seguro que desea suprimir '${0}'?",
	"Zip": "Zip",
	"ZipDL": "Cree un archivo zip del contenido de la carpeta y descárguelo",
	"New File": "Archivo",
	"Create a new file": "Crear archivo nuevo",
	"Name:": "Nombre:",
	"New Folder": "Carpeta",
	"Folder name:": "Nombre de carpeta:",
	"Create a new folder": "Crear una carpeta nueva",
	"Creating folder": "Creando carpeta",
	"Folder": "Carpeta",
	"Create an empty folder": "Crear carpeta vacía",
	"CreateEmptyMsg": "Cree una carpeta vacía en el servidor Orion. Puede importar, cargar o crear contenido en el editor.",
	"Sample HTML5 Site": "Sitio HTML5 de ejemplo",
	"Generate a sample": "Generar un ejemplo",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "Generar un sitio web HTML5 \"Hello World\", con JavaScript, HTML y archivos CSS.",
	"Creating a folder for ${0}": "Creando una carpeta para ${0}",
	"SFTP Import": "Importación SFTP",
	"Import content from SFTP": "Importar contenido de SFTP",
	"Imported Content": "Contenido importado",
	"Upload a Zip": "Cargar un zip",
	"Upload content from a local zip file": "Cargar el contenido de un archivo zip local",
	"Uploaded Content": "Contenido cargado",
	"Clone Git Repository": "Clonar repositorio git",
	"Clone a git repository": "Clonar un repositorio git",
	"Link to Server": "Enlazar con servidor",
	"LinkContent": "Enlazar el contenido existente en el servidor",
	"CreateLinkedFolder": "Cree una carpeta que enlace con una carpeta existente del servidor.",
	"Server path:": "Vía de acceso de servidor:",
	"NameLocationNotClear": "No ha especificado el nombre y la ubicación del servidor.",
	"Go Up": "Subir",
	"GoUpToParent": "Subir a la carpeta padre",
	"Go Into": "Ir a",
	"GoSelectedFolder": "Mover a la carpeta seleccionada",
	"File or zip archive": "Archivo o archivador zip",
	"ImportLcFile": "Importar un archivo o un archivador zip del sistema de archivos local",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "Copiar archivos y carpetas de una conexión SFTP especificada",
	"Importing from ${0}": "Importar de ${0}",
	"SFTP to...": "SFTP",
	"CpyToSftp": "Copiar archivos y carpetas en una ubicación SFTP especificada",
	"Exporting": "Exportando a ${0}",
	"Pasting ${0}": "Pegando ${0}",
	"Copy to": "Copiar en",
	"Move to": "Mover a",
	"Copying ${0}": "Copiando ${0}",
	"Moving ${0}": "Moviendo ${0}",
	"Renaming ${0}": "Renombrando ${0}",
	"Deleting ${0}": "Suprimiendo ${0}",
	"Creating ${0}": "Creando ${0}",
	"Linking to ${0}": "Enlazando con ${0}",
	"MvToLocation": "Mover archivos y carpetas a una nueva ubicación",
	"Cut": "Cortar",
	"Copy": "Copiar",
	"Fetching children of ": "Extrayendo hijos de ",
	"Paste": "Pegar",
	"Open With": "Abrir con",
	"Loading ": "Cargando ",
	"New": "Nuevo",
	"File": "Archivo",
	"Actions": "Acciones",
	"Orion Content": "Contenido de Orion",
	"Create new content": "Crear contenido nuevo",
	"Import from HTTP...": "HTTP",
	"File URL:": "URL de archivo:",
	"ImportURL": "Importar un archivo desde un URL y descomprimirlo de manera opcional",
	"Unzip *.zip files:": "Descomprimir archivos *.zip:",
	"Extracted from:": "Extraídos de:",
	"FolderDropNotSupported": "No se ha eliminado ${0}. En este navegador no se puede eliminar una carpeta.",
	"CreateFolderErr": "No puede copiar archivos directamente en el espacio de trabajo. Cree primero una carpeta.",
	"Unzip ${0}?": "¿Desea descomprimir ${0}?",
	"Upload progress: ": "Progreso de carga: ",
	"Uploading ": "Subiendo ",
	"Cancel upload": "Cancelar carga",
	"UploadingFileErr": "Ha fallado la carga del archivo siguiente: ",
	"Enter project name:": "Especifique el nombre del proyecto:",
	"Create new project" : "Crear nuevo proyecto ",
	"Creating project ${0}": "Creando proyecto ${0}",
	"NoFile": "Utilice el menú ${0} para crear archivos y carpetas nuevos. Pulse un archivo para iniciar la codificación.",
	"Download": "Descargar",
	"Download_tooltips": "Descargar el contenido del archivo como el nombre visualizado",
	"Downloading...": "Leyendo el contenido del archivo...",
	"Download not supported": "La descarga de contenido no está soportada en este navegador.",
	"gettingContentFrom": "Obteniendo contenido de ",
	"deployTo": "Desplegar en ",
	"deploy": "Desplegar ",
	"connect": "Conectar",
	"fetchContent": "Captar contenido",
	"fetchContentOf": "Captar contenido de ",
	"disconnectFromProject": "Desconectar del proyecto",
	"doNotTreatThisFolder": "No tratar esta carpeta como parte del proyecto",
	"checkStatus": "Comprobar estado",
	"checkApplicationStatus": "Comprobar estado de la aplicación",
	"checkApplicationState": "Comprobar estado de la aplicación",
	"stop": "Detener",
	"start": "Iniciar",
	"stopApplication": "Detener aplicación",
	"startApplication": "Iniciar aplicación",
	"manage": "Gestionar",
	"manageThisApplicationOnRemote": "Gestionar esta aplicación en un servidor remoto",
	"deployThisApplicationAgain": "Volver a desplegar esta aplicación",
	"associatedFolder": "Carpeta asociada",
	"associateAFolderFromThe": "Asociar una carpeta del espacio de trabajo a este proyecto.",
	"convertToProject": "Convertir en proyecto",
	"convertThisFolderIntoA": "Convertir esta carpeta en un proyecto",
	"thisFolderIsAProject": "Esta carpeta ya es un proyecto.",
	"basic": "Básico",
	"createAnEmptyProject.": "Crear un proyecto vacío.",
	"sFTP": "SFTP",
	"createAProjectFromAn": "Crear un proyecto a partir de un sitio SFTP.",
	'readMeCommandName': 'Archivo readme',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'Crear un archivo README.md en este proyecto',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'Archivo zip',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'Crear un proyecto a partir de un archivo zip local.',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'URL:',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : 'Los siguientes archivos no son archivos zip: ${0}. ¿Desea para continuar con la importación?', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : 'Se están cargando varios archivos que no son zip. ¿Desea para continuar con la importación?' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/navigate/nls/pt-br/messages',{
	"Navigator": "Navegador",
	"Strings Xtrnalizr": "Sequências Xtrnalizr",
	"Externalize strings": "Externalize sequências de arquivos JavaScript nesta pasta.",
	"NotSupportFileSystem":"${0} não é suportado neste sistema de arquivos",
	"SrcNotSupportBinRead":"Serviço de arquivo de origem não suporta leitura binária",
	"TargetNotSupportBinWrite":"Serviço de arquivo de destino não suporta gravação binária",
	"NoFileSrv": "Nenhum serviço de arquivo correspondente para o local: ${0}",
	"Choose a Folder": "Escolher uma Pasta",
	"Copy of ${0}": "Cópia de ${0}",
	"EnterName": "Digite um novo nome para '${0}'",
	"ChooseFolder": "Escolher Pasta...",
	"Rename": "Renomear",
	"RenameFilesFolders": "Renomear os arquivos ou pastas selecionados(as)",
	"CompareEach": "Comparar um ao outro",
	"Compare 2 files": "Comparar os 2 arquivos selecionados um com o outro",
	"Compare with...": "Comparar com...",
	"CompareFolders": "Comparar a pasta selecionada com uma pasta específica",
	"Delete": "Excluir",
	"Unknown item": "Item desconhecido",
	"delete item msg": "Tem certeza de que deseja excluir estes ${0} itens?",
	"DeleteTrg": "Tem certeza de que deseja excluir '${0}'?",
	"Zip": "Zip",
	"ZipDL": "Criar um arquivo zip do conteúdo da pasta e fazer seu download",
	"New File": "Arquivo",
	"Create a new file": "Criar um novo arquivo",
	"Name:": "Nome:",
	"New Folder": "Pasta",
	"Folder name:": "Nome da Pasta:",
	"Create a new folder": "Criar uma nova pasta",
	"Creating folder": "Criando pasta",
	"Folder": "Pasta",
	"Create an empty folder": "Criar uma pasta vazia",
	"CreateEmptyMsg": "Criar uma pasta vazia do servidor Orion. É possível importar, fazer upload ou criar conteúdo no editor.",
	"Sample HTML5 Site": "Site HTML5 de Amostra",
	"Generate a sample": "Gerar uma amostra",
	"Generate an HTML5 \"Hello World\" website, including JavaScript, HTML, and CSS files.": "Gerar um website HTML5 \"Hello World\", incluindo os arquivos JavaScript, HTML e CSS.",
	"Creating a folder for ${0}": "Criando uma pasta para ${0}",
	"SFTP Import": "Importação do SFTP",
	"Import content from SFTP": "Importar conteúdo de SFTP",
	"Imported Content": "Conteúdo Importado",
	"Upload a Zip": "Upload de um Zip",
	"Upload content from a local zip file": "Fazer upload de conteúdo de um arquivo zip local",
	"Uploaded Content": "Conteúdo transferido por upload",
	"Clone Git Repository": "Clonar Repositório Git",
	"Clone a git repository": "Clonar um repositório git",
	"Link to Server": "Link para o Servidor",
	"LinkContent": "Link para o conteúdo existente no servidor",
	"CreateLinkedFolder": "Criar uma pasta que vincule a uma pasta existente no servidor.",
	"Server path:": "Caminho do servidor:",
	"NameLocationNotClear": "O nome e o local do servidor não foram especificados.",
	"Go Up": "Ir Para Cima",
	"GoUpToParent": "Mover para cima para a pasta-pai",
	"Go Into": "Entrar",
	"GoSelectedFolder": "Mover para a pasta selecionada",
	"File or zip archive": "Arquivo ou archive zip",
	"ImportLcFile": "Importar um arquivo ou archive zip do sistema de arquivos local",
	"SFTP from...": "SFTP",
	"CpyFrmSftp": "Copiar arquivos e pastas de uma conexão SFTP especificada",
	"Importing from ${0}": "Importando a partir de ${0}",
	"SFTP to...": "SFTP",
	"CpyToSftp": "Copiar arquivos e pastas para um local SFTP especificado",
	"Exporting": "Exportando para ${0}",
	"Pasting ${0}": "Colando ${0}",
	"Copy to": "Copiar para",
	"Move to": "Mover para",
	"Copying ${0}": "Copiando ${0}",
	"Moving ${0}": "Movendo ${0}",
	"Renaming ${0}": "Renomeando ${0}",
	"Deleting ${0}": "Excluindo ${0}",
	"Creating ${0}": "Criando ${0}",
	"Linking to ${0}": "Vinculando a ${0}",
	"MvToLocation": "Mover arquivos e pastas para um novo local",
	"Cut": "Recortar",
	"Copy": "Copiar",
	"Fetching children of ": "Buscando filhos de ",
	"Paste": "Colar",
	"Open With": "Abrir com",
	"Loading ": "Carregando ",
	"New": "Novo(a)",
	"File": "Arquivo",
	"Actions": "Ações",
	"Orion Content": "Conteúdo do Orion",
	"Create new content": "Criar novo conteúdo",
	"Import from HTTP...": "HTTP",
	"File URL:": "URL do Arquivo:",
	"ImportURL": "Importar um arquivo de uma URL e opcionalmente descompactá-lo",
	"Unzip *.zip files:": "Descompactar arquivos *.zip:",
	"Extracted from:": "Extraído de:",
	"FolderDropNotSupported": "Não descartou ${0}. O descarte da pasta não é suportado neste navegador.",
	"CreateFolderErr": "Não é possível copiar os arquivos diretamente na área de trabalho. Crie uma pasta primeiro.",
	"Unzip ${0}?": "Descompactar ${0}?",
	"Upload progress: ": "Progresso do upload: ",
	"Uploading ": "Fazendo upload ",
	"Cancel upload": "Cancelar Upload",
	"UploadingFileErr": "Falha ao fazer upload do arquivo: ",
	"Enter project name:": "Insira o nome do projeto:",
	"Create new project" : "Criar novo projeto",
	"Creating project ${0}": "Criando o projeto ${0}",
	"NoFile": "Use o menu ${0} para criar novos arquivos e pastas. Clique em um arquivo para iniciar a codificação.",
	"Download": "Fazer Download",
	"Download_tooltips": "Faça download do conteúdo do arquivo como o nome exibido",
	"Downloading...": "Lendo conteúdo do arquivo...",
	"Download not supported": "O download de conteúdo não é suportado neste navegador.",
	"gettingContentFrom": "Obtendo conteúdo de ",
	"deployTo": "Implementar para ",
	"deploy": "Implementar ",
	"connect": "Conectar",
	"fetchContent": "Buscar conteúdo",
	"fetchContentOf": "Buscar conteúdo de ",
	"disconnectFromProject": "Desconectar do projeto",
	"doNotTreatThisFolder": "Não tratar esta pasta como parte do projeto",
	"checkStatus": "Verificar status",
	"checkApplicationStatus": "Verificar status do aplicativo",
	"checkApplicationState": "Verificar estado do aplicativo",
	"stop": "Parar",
	"start": "Iniciar",
	"stopApplication": "Parar aplicativo",
	"startApplication": "Iniciar aplicativo",
	"manage": "Gerenciar",
	"manageThisApplicationOnRemote": "Gerenciar este aplicativo no servidor remoto",
	"deployThisApplicationAgain": "Implementar este aplicativo novamente",
	"associatedFolder": "Pasta Associada",
	"associateAFolderFromThe": "Associar uma pasta da área de trabalho a este projeto.",
	"convertToProject": "Converter em projeto",
	"convertThisFolderIntoA": "Converter esta pasta em um projeto",
	"thisFolderIsAProject": "Esta pasta já é um projeto.",
	"basic": "Básico",
	"createAnEmptyProject.": "Criar um projeto vazio.",
	"sFTP": "SFTP",
	"createAProjectFromAn": "Criar um projeto a partir de um site de SFTP.",
	'readMeCommandName': 'Arquivo Leia-me',  //$NON-NLS-0$  //$NON-NLS-1$
	'readMeCommandTooltip': 'Criar um arquivo README.md neste projeto',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandName': 'Archive Zip',  //$NON-NLS-0$  //$NON-NLS-1$
	'zipArchiveCommandTooltip': 'Criar um projeto a partir do archive zip local.',  //$NON-NLS-0$  //$NON-NLS-1$
	'Url:': 'Url:',  //$NON-NLS-0$  //$NON-NLS-1$
	'notZip' : 'Os arquivos a seguir não são arquivos zip: ${0}. Deseja continuar a importação?', //$NON-NLS-0$  //$NON-NLS-1$
	'notZipMultiple' : 'Há vários arquivos não zip sendo transferidos por upload. Deseja continuar a importação?' //$NON-NLS-0$  //$NON-NLS-1$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
/** @namespace The global container for eclipse APIs. */

define('orion/fileClient',['i18n!orion/navigate/nls/messages', "orion/Deferred", "orion/i18nUtil"], function(messages, Deferred, i18nUtil){
	/**
	 * This helper method implements invocation of the service call,
	 * with retry on authentication error if needed.
	 * @private
	 */
	function _doServiceCall(fileService, funcName, funcArgs) {
		//if the function is not implemented in the file service, we throw an exception to the caller
		if(!fileService[funcName]){
			throw new Error(i18nUtil.formatMessage(messages["NotSupportFileSystem"], funcName));
		}
		return fileService[funcName].apply(fileService, funcArgs);
	}
	
	function _copy(sourceService, sourceLocation, targetService, targetLocation) {
		
		if (!sourceService.readBlob) {
			throw new Error(messages["SrcNotSupportBinRead"]);
		}

		if (!targetService.writeBlob) {
			throw new Error(messages["TargetNotSupportBinWrite"]);
		}
	
		if (sourceLocation[sourceLocation.length -1] !== "/") { //$NON-NLS-0$
			return _doServiceCall(sourceService, "readBlob", [sourceLocation]).then(function(contents) { //$NON-NLS-0$
				return _doServiceCall(targetService, "writeBlob", [targetLocation, contents]); //$NON-NLS-0$
			});
		}

		var temp = targetLocation.substring(0, targetLocation.length - 1);
		var name = decodeURIComponent(temp.substring(temp.lastIndexOf("/")+1)); //$NON-NLS-0$
		var parentLocation = temp.substring(0, temp.lastIndexOf("/")+1);  //$NON-NLS-0$

		return _doServiceCall(targetService, "createFolder", [parentLocation, name]).then(function() { //$NON-NLS-0$
			return;
		}, function() {
			return;
		}).then(function() {
			return _doServiceCall(sourceService, "fetchChildren", [sourceLocation]).then(function(children) { //$NON-NLS-0$
				var results = [];
				for(var i = 0; i < children.length; ++i) {
					var childSourceLocation = children[i].Location;
					var childTemp =  childSourceLocation;
					if (children[i].Directory) {
						childTemp = childSourceLocation.substring(0, childSourceLocation.length - 1);
					}
					var childName = decodeURIComponent(childTemp.substring(childTemp.lastIndexOf("/")+1)); //$NON-NLS-0$
					
					var childTargetLocation = targetLocation + encodeURIComponent(childName);
					if (children[i].Directory) {
						childTargetLocation += "/"; //$NON-NLS-0$
					}
					results[i] = _copy(sourceService, childSourceLocation, targetService, childTargetLocation);
				}
				return Deferred.all(results);
			});
		});
	}
	
	
	/**
	 * Creates a new file client.
	 * @class The file client provides a convenience API for interacting with file services
	 * provided by plugins. This class handles authorization, and authentication-related
	 * error handling.
	 * @name orion.fileClient.FileClient
	 */
	function FileClient(serviceRegistry, filter) {
		var allReferences = serviceRegistry.getServiceReferences("orion.core.file"); //$NON-NLS-0$
		var _references = allReferences;
		if (filter) {
			_references = [];
			for(var i = 0; i < allReferences.length; ++i) {
				if (filter(allReferences[i])) {
					_references.push(allReferences[i]);
				}
			}
		}
		_references.sort(function (ref1, ref2) {
			var ranking1 = ref1.getProperty("ranking") || 0;
			var ranking2 = ref2.getProperty("ranking")  || 0;
			return ranking1 - ranking2;
		});
		var _patterns = [];
		var _services = [];
		var _names = [];
		
		function _noMatch(location) {
			var d = new Deferred();
			d.reject(messages["No Matching FileService for location:"] + location);
			return d;
		}
		
		var _fileSystemsRoots = [];
		var _allFileSystemsService =  {
			fetchChildren: function() {
				var d = new Deferred();
				d.resolve(_fileSystemsRoots);
				return d;
			},
			createWorkspace: function() {
				var d = new Deferred();
				d.reject(messages["no file service"]);
				return d;
			},
			loadWorkspaces: function() {
				var d = new Deferred();
				d.reject(messages['no file service']);
				return d;
			},
			loadWorkspace: function(location) {
				var d = new Deferred();
				window.setTimeout(function() {
					d.resolve({
						Directory: true, 
						Length: 0, 
						LocalTimeStamp: 0,
						Name: messages["File Servers"],
						Location: "/",  //$NON-NLS-0$
						Children: _fileSystemsRoots,
						ChildrenLocation: "/" //$NON-NLS-0$
					});
				}, 100);
				return d;
			},
			search: _noMatch,
			createProject: _noMatch,
			createFolder: _noMatch,
			createFile: _noMatch,
			deleteFile: _noMatch,
			moveFile: _noMatch,
			copyFile: _noMatch,
			read: _noMatch,
			write: _noMatch
		};
				
		for(var j = 0; j < _references.length; ++j) {
			_fileSystemsRoots[j] = {
				Directory: true, 
				Length: 0, 
				LocalTimeStamp: 0,
				Location: _references[j].getProperty("top"), //$NON-NLS-0$
				ChildrenLocation: _references[j].getProperty("top"), //$NON-NLS-0$
				Name: _references[j].getProperty("Name")		 //$NON-NLS-0$
			};

			var patternStringArray = _references[j].getProperty("pattern") || _references[j].getProperty("top").replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1"); //$NON-NLS-1$ //$NON-NLS-0$
			if (!Array.isArray(patternStringArray)) {
				patternStringArray = [patternStringArray];
			}
			var patterns = [];
			for (var k = 0; k < patternStringArray.length; k++) {
				var patternString = patternStringArray[k];
				if (patternString[0] !== "^") { //$NON-NLS-0$
					patternString = "^" + patternString; //$NON-NLS-0$
				}
				patterns.push(new RegExp(patternString));
			}
			_patterns[j] = patterns;			
			_services[j] = serviceRegistry.getService(_references[j]);
			_names[j] = _references[j].getProperty("Name"); //$NON-NLS-0$
			
			if(_references[j].getProperty("NameKey") && _references[j].getProperty("nls")){
				i18nUtil.getMessageBundle(_references[j].getProperty("nls")).then(function(j, pluginMessages){
					_fileSystemsRoots[j].Name = pluginMessages[_references[j].getProperty("NameKey")]; //$NON-NLS-0$
					_names[j] = pluginMessages[_references[j].getProperty("NameKey")]; //$NON-NLS-0$
				}.bind(this, j));
			}
		}
				
		this._getServiceIndex = function(location) {
			// client must specify via "/" when a multi file service tree is truly wanted
			if (location === "/") { //$NON-NLS-0$
				return -1;
			} else if (!location || (location.length && location.length === 0)) {
				// TODO we could make the default file service a preference but for now we use the first one
				return _services[0] ? 0 : -1;
			}
			for(var i = 0; i < _patterns.length; ++i) {
				for (var j = 0; j < _patterns[i].length; j++) {
					if (_patterns[i][j].test(location)) {
						return i;
					}
				}
			}
			throw new Error(i18nUtil.formatMessage(messages['NoFileSrv'], location));
		};
		
		this._getService = function(location) {
			var i = this._getServiceIndex(location);
			return i === -1 ? _allFileSystemsService : _services[i];
		};
		
		this._getServiceName = function(location) {
			var i = this._getServiceIndex(location);
			return i === -1 ? _allFileSystemsService.Name : _names[i];
		};
		
		this._getServiceRootURL = function(location) {
			var i = this._getServiceIndex(location);
			return i === -1 ? _allFileSystemsService.Location : _fileSystemsRoots[i].Location;
		};
	}
	
	FileClient.prototype = /**@lends orion.fileClient.FileClient.prototype */ {
		/**
		 * Returns the file service managing this location
		 * @param location The location of the item 
		 */
		getService: function(location) {
			return this._getService(location);
		},
		 
		/**
		 * Returns the name of the file service managing this location
		 * @param location The location of the item 
		 */
		fileServiceName: function(location) {
			return this._getServiceName(location);
		},
		 
		/**
		 * Returns the root url of the file service managing this location
		 * @param location The location of the item 
		 */
		fileServiceRootURL: function(location) {
			return this._getServiceRootURL(location);
		},
		 
		/**
		 * Obtains the children of a remote resource
		 * @param location The location of the item to obtain children for
		 * @return A deferred that will provide the array of child objects when complete
		 */
		fetchChildren: function(location) {
			return _doServiceCall(this._getService(location), "fetchChildren", arguments); //$NON-NLS-0$
		},

		/**
		 * Creates a new workspace with the given name. The resulting workspace is
		 * passed as a parameter to the provided onCreate function.
		 * @param {String} name The name of the new workspace
		 */
		createWorkspace: function(name) {
			return _doServiceCall(this._getService(), "createWorkspace", arguments); //$NON-NLS-0$
		},

		/**
		 * Loads all the user's workspaces. Returns a deferred that will provide the loaded
		 * workspaces when ready.
		 */
		loadWorkspaces: function() {
			return _doServiceCall(this._getService(), "loadWorkspaces", arguments); //$NON-NLS-0$
		},
		
		/**
		 * Loads the workspace with the given id and sets it to be the current
		 * workspace for the IDE. The workspace is created if none already exists.
		 * @param {String} location the location of the workspace to load
		 * @param {Function} onLoad the function to invoke when the workspace is loaded
		 */
		loadWorkspace: function(location) {
			return _doServiceCall(this._getService(location), "loadWorkspace", arguments); //$NON-NLS-0$
		},
		
		/**
		 * Adds a project to a workspace.
		 * @param {String} url The workspace location
		 * @param {String} projectName the human-readable name of the project
		 * @param {String} serverPath The optional path of the project on the server.
		 * @param {Boolean} create If true, the project is created on the server file system if it doesn't already exist
		 */
		createProject: function(url, projectName, serverPath, create) {
			return _doServiceCall(this._getService(url), "createProject", arguments); //$NON-NLS-0$
		},
		/**
		 * Creates a folder.
		 * @param {String} parentLocation The location of the parent folder
		 * @param {String} folderName The name of the folder to create
		 * @return {Object} JSON representation of the created folder
		 */
		createFolder: function(parentLocation, folderName) {
			return _doServiceCall(this._getService(parentLocation), "createFolder", arguments); //$NON-NLS-0$
		},
		/**
		 * Create a new file in a specified location. Returns a deferred that will provide
		 * The new file object when ready.
		 * @param {String} parentLocation The location of the parent folder
		 * @param {String} fileName The name of the file to create
		 * @return {Object} A deferred that will provide the new file object
		 */
		createFile: function(parentLocation, fileName) {
			return _doServiceCall(this._getService(parentLocation), "createFile", arguments); //$NON-NLS-0$
		},
		/**
		 * Deletes a file, directory, or project.
		 * @param {String} location The location of the file or directory to delete.
		 */
		deleteFile: function(location) {
			return _doServiceCall(this._getService(location), "deleteFile", arguments); //$NON-NLS-0$
		},
		
		/**		 
		 * Moves a file or directory.
		 * @param {String} sourceLocation The location of the file or directory to move.
		 * @param {String} targetLocation The location of the target folder.
		 * @param {String} [name] The name of the destination file or directory in the case of a rename
		 */
		moveFile: function(sourceLocation, targetLocation, name) {
			var sourceService = this._getService(sourceLocation);
			var targetService = this._getService(targetLocation);
			
			if (sourceService === targetService) {
				return _doServiceCall(sourceService, "moveFile", arguments);				 //$NON-NLS-0$
			}
			
			var isDirectory = sourceLocation[sourceLocation.length -1] === "/"; //$NON-NLS-0$
			var target = targetLocation;
			
			if (target[target.length -1] !== "/") { //$NON-NLS-0$
				target += "/"; //$NON-NLS-0$
			}
			
			if (name) {
				target += encodeURIComponent(name);
			} else {
				var temp = sourceLocation;
				if (isDirectory) {
					temp = temp.substring(0, temp.length - 1);
				}
				target += temp.substring(temp.lastIndexOf("/")+1); //$NON-NLS-0$
			}
			
			if (isDirectory && target[target.length -1] !== "/") { //$NON-NLS-0$
				target += "/"; //$NON-NLS-0$
			}
	
			return _copy(sourceService, sourceLocation, targetService, target).then(function() {
				return _doServiceCall(sourceService, "deleteFile", [sourceLocation]); //$NON-NLS-0$
			});
			
		},
				
		/**
		 * Copies a file or directory.
		 * @param {String} sourceLocation The location of the file or directory to copy.
		 * @param {String} targetLocation The location of the target folder.
		 * @param {String} [name] The name of the destination file or directory in the case of a rename
		 */
		copyFile: function(sourceLocation, targetLocation, name) {
			var sourceService = this._getService(sourceLocation);
			var targetService = this._getService(targetLocation);
			
			if (sourceService === targetService) {
				return _doServiceCall(sourceService, "copyFile", arguments);				 //$NON-NLS-0$
			}
			
			var isDirectory = sourceLocation[sourceLocation.length -1] === "/"; //$NON-NLS-0$
			var target = targetLocation;
			
			if (target[target.length -1] !== "/") { //$NON-NLS-0$
				target += "/"; //$NON-NLS-0$
			}
			
			if (name) {
				target += encodeURIComponent(name);
			} else {
				var temp = sourceLocation;
				if (isDirectory) {
					temp = temp.substring(0, temp.length - 1);
				}
				target += temp.substring(temp.lastIndexOf("/")+1); //$NON-NLS-0$
			}
			
			if (isDirectory && target[target.length -1] !== "/") { //$NON-NLS-0$
				target += "/"; //$NON-NLS-0$
			}

			return _copy(sourceService, sourceLocation, targetService, target);
		},

		/**
		 * Returns the contents or metadata of the file at the given location.
		 *
		 * @param {String} location The location of the file to get contents for
		 * @param {Boolean} [isMetadata] If defined and true, returns the file metadata, 
		 *   otherwise file contents are returned
		 * @return A deferred that will be provided with the contents or metadata when available
		 */
		read: function(location, isMetadata) {
			return _doServiceCall(this._getService(location), "read", arguments); //$NON-NLS-0$
		},

		/**
		 * Returns the blob contents of the file at the given location.
		 *
		 * @param {String} location The location of the file to get contents for
		 * @return A deferred that will be provided with the blob contents when available
		 */
		readBlob: function(location) {
			return _doServiceCall(this._getService(location), "readBlob", arguments); //$NON-NLS-0$
		},

		/**
		 * Writes the contents or metadata of the file at the given location.
		 *
		 * @param {String} location The location of the file to set contents for
		 * @param {String|Object} contents The content string, or metadata object to write
		 * @param {String|Object} args Additional arguments used during write operation (i.e. ETag) 
		 * @return A deferred for chaining events after the write completes with new metadata object
		 */		
		write: function(location, contents, args) {
			return _doServiceCall(this._getService(location), "write", arguments); //$NON-NLS-0$
		},

		/**
		 * Imports file and directory contents from another server
		 *
		 * @param {String} targetLocation The location of the folder to import into
		 * @param {Object} options An object specifying the import parameters
		 * @return A deferred for chaining events after the import completes
		 */		
		remoteImport: function(targetLocation, options) {
			return _doServiceCall(this._getService(targetLocation), "remoteImport", arguments); //$NON-NLS-0$
		},

		/**
		 * Exports file and directory contents to another server
		 *
		 * @param {String} sourceLocation The location of the folder to export from
		 * @param {Object} options An object specifying the export parameters
		 * @return A deferred for chaining events after the export completes
		 */		
		remoteExport: function(sourceLocation, options) {
			return _doServiceCall(this._getService(sourceLocation), "remoteExport", arguments); //$NON-NLS-0$
		},
		
		/**
		 * Performs a search with the given search parameters.
		 * @param {Object} searchParams The JSON object that describes all the search parameters.
		 * @param {String} searchParams.resource Required. The location where search is performed. Required. Normally a sub folder of the file system. Empty string means the root of the file system.
		 * @param {String} searchParams.keyword The search keyword. Required but can be empty string.  If fileType is a specific type and the keyword is empty, then list up all the files of that type. If searchParams.regEx is true then the keyword has to be a valid regular expression. 
		 * @param {String} searchParams.sort Required. Defines the order of the return results. Should be either "Path asc" or "Name asc". Extensions are possible but not currently supported.  
		 * @param {boolean} searchParams.nameSearch Optional. If true, the search performs only file name search. 
		 * @param {String} searchParams.fileType Optional. The file type. If specified, search will be performed under this file type. E.g. "*.*" means all file types. "html" means html files.
		 * @param {Boolean} searchParams.regEx Optional. The option of regular expression search.
		 * @param {integer} searchParams.start Optional. The zero based start number for the range of the returned hits. E.g if there are 1000 hits in total, then 5 means the 6th hit.
		 * @param {integer} searchParams.rows Optional. The number of hits of the range. E.g if there are 1000 hits in total and start=5 and rows=40, then the return range is 6th-45th.
		 */
		search: function(searchParams) {
			return _doServiceCall(this._getService(searchParams.resource), "search", arguments); //$NON-NLS-0$
		}
	};//end FileClient prototype
	FileClient.prototype.constructor = FileClient;

	//return the module exports
	return {FileClient: FileClient};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 * program and the accompanying materials are made available under the terms of
 * the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 * and the Eclipse Distribution License v1.0
 * (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/globalCommands',[], function() {
	return {
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/search/nls/messages',{
	root: {//Default message bundle
		"Find:": "Find:",
		"Find With": "Find With",
		"ReplaceWith:": "ReplaceWith:",
		"Replace With": "Replace With",
		"Show all": "Show all",
		"Wrap search": "Wrap search",
		"Incremental search": "Incremental search",
		"Whole Word": "Whole Word",
		"Regular expression": "Regular expression",
		"Find after replace": "Find after replace",
		"Options": "Options",
		"Find next match": "Find next match",
		"Find previous match": "Find previous match",
		"Next": "Next",
		"Previous": "Previous",
		"Replace": "Replace",
		"Replace...": "Replace...",
		"Replace All": "Replace All",
		"Show Replace": "Switch to Replace Mode",
		"Hide Replace": "Switch to Search Mode",
		"Search ${0}": "Search ${0}",
		"TypeKeyOrWildCard": "Type a keyword or wild card to search in ",
		"Search failed.": "Search failed.",
		"NoMatchFound": "No matches found for ${0}",
		"Searching...": "Searching...",
		"ResourceChanged.": "Resource has been changed by others.",
		"Failed to write file.": "Failed to write file.",
		"Results": "Results",
		"FilesAofBmatchingC": "Files ${0} of ${1} matching \"${2}\"",
		"ReplaceAwithBforCofD": "Replace \"${0}\" with \"${1}\" for files ${2} of ${3}",
		"Location": "Location",
		"Click to compare": "Click to compare",
		"Search again in this folder with \"${0}\"": "Search again in this folder with \"${0}\"",
		"Files replaced": "Files replaced",
		"Status": "Status",
		"matchesReplacedMsg": "${0} out of ${1}  matches replaced.",
		"Replace all matches with...": "Replace all matches with...",
		"Apply Changes": "Replace Selected",
		"Replace all selected matches": "Replace all selected matches",
		"Hide Compare": "Hide Compare",
		"Hide compare view of changes": "Hide compare view of changes",
		"Show Compare": "Show Compare",
		"Show compare view of changes": "Show compare view of changes",
		"Show All": "Show All",
		"Show all the results in one page": "Show all the results in one page",
		"< Previous Page": "< Previous Page",
		"Show previous page of search result": "Show previous page of search result",
		"Next Page >": "Next Page >",
		"Show next page of search result": "Show next page of search result",
		"Next result": "Next result",
		"Previous result": "Previous result",
		"Expand all results": "Expand all results",
		"Collapse all results": "Collapse all results",
		"Writing files...": "Writing files...",
		"Preparing preview...": "Preparing preview...",
		"Replaced File (${0})": "Replaced File (${0})",
		"Original File (${0})": "Original File (${0})",
		"Sort by Name": "Sort by Name",
		"Compare changes": "Compare changes",
		"Search Results": "Search Results",
		"Replace All Matches": "Replace All Matches",
		"No matches": "No matches",
		"Rename": "Rename",
		"Search": "Search",
		"All types": "All types",
		"File type": "File type",
		"All ${0} files": "All ${0} files",
		"${0} is already saved": "${0} is already saved",
		"Type a search term": "Type a search term",
		"Type a replace term": "Type a replace term",
		"Case sensitive": "Case sensitive",
		"File name": "File name",
		"Path name": "Path name",
		"Save": "Save",
		"Type filter text": "Type filter text",
		"Scope Search": "Scoped Search",
		"Open in Search page for this directory": "Open the Search page for this folder.",
		"${0}. Try your search again.": "${0}. Try your search again.",
		"DeleteSearchTrmMsg": "Click or use delete key to delete the search term",
		"${0} matches": "${0} matches",
		"regexOptionOff" : "Regular expressions are off. Click here or use the options to turn them on for replacement",
		"regexOptionOn" : "Regular expressions are on. Click here or use the options to turn them off",
		"Scope": "Scope",
		"Show previous search terms": "Show previous search terms",
		"Show previous replace terms": "Show previous replace terms",
		"Show replacement preview": "Show replacement preview",
		"File name patterns (comma-separated)": "File name patterns (comma-separated)",
		"(* = any string, ? = any character)": "(* = any string, ? = any character)",
		"Choose a Folder": "Choose a Folder",
		"Remove from search results": "Remove from search results",
		"^ Edit Search": "^ Edit Search",
		"Preview: " : "Preview: ",
		"fullPath": "Show Full Path",
		"switchFullPath": "Show/hide full path"
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/ja/messages',{
	"Find:": "検索:",
	"Find With": "検索内容",
	"ReplaceWith:": "置換:",
	"Replace With": "置換",
	"Show all": "すべて表示",
	"Wrap search": "循環検索",
	"Incremental search": "増分検索",
	"Whole Word": "単語全体",
	"Regular expression": "正規表現",
	"Find after replace": "置換後に検索",
	"Options": "オプション",
	"Find next match": "次の一致を検索",
	"Find previous match": "前の一致を検索",
	"Next": "次へ",
	"Previous": "前へ",
	"Replace": "置換",
	"Replace...": "置換...",
	"Replace All": "すべて置換",
	"Show Replace": "置換モードに切り替え",
	"Hide Replace": "検索モードに切り替え",
	"Search ${0}": "${0} の検索",
	"TypeKeyOrWildCard": "検索対象のキーワードまたはワイルドカードを入力",
	"Search failed.": "検索に失敗しました。",
	"NoMatchFound": "${0} と一致するものはありませんでした",
	"Searching...": "検索中...",
	"ResourceChanged.": "リソースが他のユーザーによって変更されています。",
	"Failed to write file.": "ファイルの書き込みに失敗しました。",
	"Results": "結果",
	"FilesAofBmatchingC": "\"${2}\" に一致するファイル数: ${0} / ${1}",
	"ReplaceAwithBforCofD": "ファイル ${2}/${3} の \"${0}\" を \"${1}\" に置き換える",
	"Location": "ロケーション",
	"Click to compare": "クリックして比較",
	"Search again in this folder with \"${0}\"": "\"${0}\" でこのフォルダーを再検索",
	"Files replaced": "ファイルが置き換えられました",
	"Status": "状況",
	"matchesReplacedMsg": "${1} 個のうち ${0} 個が置き換えられました。",
	"Replace all matches with...": "すべての一致の置換内容...",
	"Apply Changes": "選択対象を置換",
	"Replace all selected matches": "選択されたすべての一致を置換",
	"Hide Compare": "比較の非表示",
	"Hide compare view of changes": "変更の比較ビューの非表示",
	"Show Compare": "比較の表示",
	"Show compare view of changes": "変更の比較ビューの表示",
	"Show All": "すべて表示",
	"Show all the results in one page": "すべての結果を 1 ページに表示",
	"< Previous Page": "< 前ページ",
	"Show previous page of search result": "検索結果の前ページを表示",
	"Next Page >": "次ページ >",
	"Show next page of search result": "検索結果の次ページを表示",
	"Next result": "次の結果",
	"Previous result": "前の結果",
	"Expand all results": "すべての結果を展開表示",
	"Collapse all results": "すべての結果を省略表示",
	"Writing files...": "ファイルの書き込み中...",
	"Preparing preview...": "プレビューの準備中...",
	"Replaced File (${0})": "置換済みファイル (${0})",
	"Original File (${0})": "元のファイル (${0})",
	"Sort by Name": "名前でソート",
	"Compare changes": "変更の比較",
	"Search Results": "検索結果",
	"Replace All Matches": "すべての一致を置換",
	"No matches": "一致がありません",
	"Rename": "名前変更",
	"Search": "検索",
	"All types": "すべてのタイプ",
	"File type": "ファイル・タイプ",
	"All ${0} files": "すべての ${0} ファイル",
	"${0} is already saved": "${0} は既に保存されています",
	"Type a search term": "検索語を入力します",
	"Type a replace term": "置換語を入力します",
	"Case sensitive": "大/小文字を区別",
	"File name": "ファイル名",
	"Path name": "パス名",
	"Save": "保存",
	"Type filter text": "フィルター入力",
	"Scope Search": "スコープ検索",
	"Open in Search page for this directory": "このフォルダーの検索ページを開きます。",
	"${0}. Try your search again.": "${0}. 検索を再試行してください。",
	"DeleteSearchTrmMsg": "検索語を削除するには、クリックするか、Delete キーを使用します",
	"${0} matches": "${0} 個の一致",
	"regexOptionOff" : "正規表現はオフです。ここをクリックするか、オプションを使用して、置換用にオンにしてください",
	"regexOptionOn" : "正規表現はオンです。ここをクリックするか、オプションを使用して、オフにしてください",
	"Scope": "スコープ",
	"Show previous search terms": "以前の検索項目を表示",
	"Show previous replace terms": "以前の置換項目を表示",
	"Show replacement preview": "置換プレビューの表示",
	"File name patterns (comma-separated)": "ファイル名のパターン (コンマ区切り)",
	"(* = any string, ? = any character)": "(* = 任意のストリング、? = 任意の文字)",
	"Choose a Folder": "フォルダーの選択",
	"Remove from search results": "検索結果から削除",
	"^ Edit Search": "^ 検索の編集",
	"Preview: " : "プレビュー:",
	"fullPath": "絶対パスの表示",
	"switchFullPath": "絶対パスの表示/非表示"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/zh/messages',{
	"Find:": "查找：",
	"Find With": "查找方式",
	"ReplaceWith:": "替换为：",
	"Replace With": "替换为",
	"Show all": "全部显示",
	"Wrap search": "回绕搜索",
	"Incremental search": "增量搜索",
	"Whole Word": "整个单词",
	"Regular expression": "正则表达式",
	"Find after replace": "替换之后查找",
	"Options": "选项",
	"Find next match": "查找下一个匹配项",
	"Find previous match": "查找前一个匹配项",
	"Next": "下一个",
	"Previous": "上一个",
	"Replace": "替换",
	"Replace...": "替换...",
	"Replace All": "全部替换",
	"Show Replace": "切换至替换方式",
	"Hide Replace": "切换至搜索方式",
	"Search ${0}": "搜索 ${0}",
	"TypeKeyOrWildCard": "输入要搜索的关键字或通配符",
	"Search failed.": "搜索失败。",
	"NoMatchFound": "未找到 ${0} 的任何匹配项",
	"Searching...": "正在搜索...",
	"ResourceChanged.": "其他用户已更改此资源。",
	"Failed to write file.": "未能写入文件。",
	"Results": "结果",
	"FilesAofBmatchingC": "${0} 个文件（共 ${1} 个）与“${2}”相匹配",
	"ReplaceAwithBforCofD": "用“${1}”替换“${0}”，${2} 个文件，共 ${3} 个",
	"Location": "位置",
	"Click to compare": "单击以进行比较",
	"Search again in this folder with \"${0}\"": "在此文件夹中使用“${0}”再次搜索",
	"Files replaced": "已替换文件",
	"Status": "状态",
	"matchesReplacedMsg": "已替换 ${0} 个匹配项（共 ${1} 个）。",
	"Replace all matches with...": "将所有匹配项替换为...",
	"Apply Changes": "替换所选项",
	"Replace all selected matches": "替换所选择的所有匹配项",
	"Hide Compare": "隐藏比较",
	"Hide compare view of changes": "隐藏更改的比较视图",
	"Show Compare": "显示比较",
	"Show compare view of changes": "显示更改的比较视图",
	"Show All": "全部显示",
	"Show all the results in one page": "在一个页面中显示所有结果",
	"< Previous Page": "< 上一页",
	"Show previous page of search result": "显示搜索结果的上一页",
	"Next Page >": "下一页 >",
	"Show next page of search result": "显示搜索结果的下一页",
	"Next result": "下一个结果",
	"Previous result": "前一个结果",
	"Expand all results": "展开所有结果",
	"Collapse all results": "折叠所有结果",
	"Writing files...": "正在写入文件...",
	"Preparing preview...": "正在准备预览...",
	"Replaced File (${0})": "已替换的文件 (${0})",
	"Original File (${0})": "原始文件 (${0})",
	"Sort by Name": "按名称排序",
	"Compare changes": "比较更改",
	"Search Results": "搜索结果",
	"Replace All Matches": "替换所有匹配项",
	"No matches": "无匹配项",
	"Rename": "重命名",
	"Search": "搜索",
	"All types": "所有类型",
	"File type": "文件类型",
	"All ${0} files": "所有 ${0} 文件",
	"${0} is already saved": "已保存 ${0}",
	"Type a search term": "输入搜索项",
	"Type a replace term": "输入替换项",
	"Case sensitive": "区分大小写",
	"File name": "文件名",
	"Path name": "路径名",
	"Save": "保存",
	"Type filter text": "输入过滤器文本",
	"Scope Search": "已限定范围的搜索",
	"Open in Search page for this directory": "请对此文件夹打开“搜索”页面。",
	"${0}. Try your search again.": "${0}. 请再次尝试搜索。",
	"DeleteSearchTrmMsg": "单击或者使用“删除”键来删除搜索项",
	"${0} matches": "${0} 个匹配项",
	"regexOptionOff" : "正则表达式已关闭。单击此处或使用打开选项以进行替换",
	"regexOptionOn" : "正则表达式已打开。单击此处或使用关闭选项",
	"Scope": "作用域",
	"Show previous search terms": "显示先前的搜索项",
	"Show previous replace terms": "显示先前的替换项",
	"Show replacement preview": "显示替换预览",
	"File name patterns (comma-separated)": "文件名模式（以逗号分隔）",
	"(* = any string, ? = any character)": "（* = 任意字符串，? = 任意字符）",
	"Choose a Folder": "选择文件夹",
	"Remove from search results": "从搜索结果中除去",
	"^ Edit Search": "^ 编辑搜索",
	"Preview: " : "预览：",
	"fullPath": "显示完整路径",
	"switchFullPath": "显示/隐藏完整路径"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/zh-tw/messages',{
	"Find:": "尋找：",
	"Find With": "尋找",
	"ReplaceWith:": "取代為：",
	"Replace With": "取代為",
	"Show all": "全部顯示",
	"Wrap search": "折返搜尋",
	"Incremental search": "漸進式搜尋",
	"Whole Word": "完整單字",
	"Regular expression": "正規表示式",
	"Find after replace": "取代之後尋找",
	"Options": "選項",
	"Find next match": "尋找下一個相符項",
	"Find previous match": "尋找上一個相符項",
	"Next": "下一步",
	"Previous": "上一步",
	"Replace": "取代",
	"Replace...": "取代...",
	"Replace All": "全部取代",
	"Show Replace": "切換至取代模式",
	"Hide Replace": "切換至搜尋模式",
	"Search ${0}": "搜尋${0}",
	"TypeKeyOrWildCard": "輸入關鍵字或萬用字元，在下列位置中搜尋： ",
	"Search failed.": "搜尋失敗。",
	"NoMatchFound": "找不到 ${0} 的任何相符項",
	"Searching...": "搜尋中...",
	"ResourceChanged.": "其他使用者已變更資源。",
	"Failed to write file.": "無法寫入檔案。",
	"Results": "結果",
	"FilesAofBmatchingC": "${1} 之 ${0} 個檔案符合 \"${2}\"",
	"ReplaceAwithBforCofD": "在第 ${2} 個檔案（共 ${3} 個）中將 \"${0}\" 取代為 \"${1}\"",
	"Location": "位置",
	"Click to compare": "按一下以比較",
	"Search again in this folder with \"${0}\"": "使用 \"${0}\" 在這個資料夾中再次搜尋",
	"Files replaced": "已取代檔案",
	"Status": "狀態",
	"matchesReplacedMsg": "已取代 ${0} 個相符項，共 ${1} 個。",
	"Replace all matches with...": "將所有相符項取代為...",
	"Apply Changes": "取代選取項目",
	"Replace all selected matches": "取代所有選取的相符項",
	"Hide Compare": "隱藏比較",
	"Hide compare view of changes": "隱藏變更的比較視圖",
	"Show Compare": "顯示比較",
	"Show compare view of changes": "顯示變更的比較視圖",
	"Show All": "顯示全部",
	"Show all the results in one page": "將所有結果顯示在一頁中",
	"< Previous Page": "< 上一頁",
	"Show previous page of search result": "顯示上一頁搜尋結果",
	"Next Page >": "下一頁 >",
	"Show next page of search result": "顯示下一頁搜尋結果",
	"Next result": "下一個結果",
	"Previous result": "上一個結果",
	"Expand all results": "展開所有結果",
	"Collapse all results": "收合所有結果",
	"Writing files...": "正在寫入檔案...",
	"Preparing preview...": "正在準備預覽...",
	"Replaced File (${0})": "取代的檔案 (${0})",
	"Original File (${0})": "原始檔案 (${0})",
	"Sort by Name": "依名稱排序",
	"Compare changes": "比較變更",
	"Search Results": "搜尋結果",
	"Replace All Matches": "取代所有相符項",
	"No matches": "沒有相符的項目",
	"Rename": "重新命名",
	"Search": "搜尋",
	"All types": "所有類型",
	"File type": "檔案類型",
	"All ${0} files": "所有 ${0} 個檔案",
	"${0} is already saved": "${0} 已儲存",
	"Type a search term": "輸入搜尋詞彙",
	"Type a replace term": "輸入取代詞彙",
	"Case sensitive": "區分大小寫",
	"File name": "檔名",
	"Path name": "路徑名稱",
	"Save": "儲存",
	"Type filter text": "輸入過濾文字",
	"Scope Search": "限定範圍的搜尋",
	"Open in Search page for this directory": "針對這個資料夾開啟「搜尋」頁面。",
	"${0}. Try your search again.": "${0}. 請重試搜尋。",
	"DeleteSearchTrmMsg": "按一下或使用刪除鍵來刪除搜尋詞彙",
	"${0} matches": "${0} 個相符項",
	"regexOptionOff" : "正規表示式已關閉。 請按一下這裡或使用選項來開啟它們以進行取代",
	"regexOptionOn" : "正規表示式已開啟。 請按一下這裡或使用選項來關閉它們",
	"Scope": "範圍",
	"Show previous search terms": "顯示先前的搜尋詞彙",
	"Show previous replace terms": "顯示先前的取代詞彙",
	"Show replacement preview": "顯示取代預覽",
	"File name patterns (comma-separated)": "檔名型樣（以逗點區隔）",
	"(* = any string, ? = any character)": "（* = 任何字串，? = 任何字元）",
	"Choose a Folder": "選擇資料夾",
	"Remove from search results": "從搜尋結果中移除",
	"^ Edit Search": "^ 編輯搜尋",
	"Preview: " : "預覽： ",
	"fullPath": "顯示完整路徑",
	"switchFullPath": "顯示/隱藏完整路徑"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/fr/messages',{
	"Find:": "Rechercher :",
	"Find With": "Rechercher avec",
	"ReplaceWith:": "Remplacer :",
	"Replace With": "Remplacer par",
	"Show all": "Afficher tout",
	"Wrap search": "Recherche en boucle",
	"Incremental search": "Recherche incrémentielle",
	"Whole Word": "Mot entier",
	"Regular expression": "Expression régulière",
	"Find after replace": "Rechercher après remplacement",
	"Options": "Options",
	"Find next match": "Rechercher l'occurrence suivante",
	"Find previous match": "Rechercher l'occurrence précédente",
	"Next": "Suivant",
	"Previous": "Précédent",
	"Replace": "Remplacer",
	"Replace...": "Remplacer...",
	"Replace All": "Remplacer tout",
	"Show Replace": "Basculer en mode remplacement",
	"Hide Replace": "Basculer en mode de recherche",
	"Search ${0}": "Recherche dans ${0}",
	"TypeKeyOrWildCard": "Entrez un mot clé ou un caractère générique à rechercher ",
	"Search failed.": "Échec de la recherche.",
	"NoMatchFound": "Aucune correspondance trouvée pour ${0}",
	"Searching...": "Recherche en cours...",
	"ResourceChanged.": "La ressource a été modifiée par d'autres utilisateurs.",
	"Failed to write file.": "Echec de l'écriture du fichier.",
	"Results": "Résultats",
	"FilesAofBmatchingC": "Fichiers ${0} de ${1} correspondant à \"${2}\"",
	"ReplaceAwithBforCofD": "Remplacer \"${0}\" par \"${1}\" pour les fichiers ${2} sur ${3}",
	"Location": "Emplacement",
	"Click to compare": "Cliquez pour comparer",
	"Search again in this folder with \"${0}\"": "Rechercher dans ce dossier avec \"${0}\"",
	"Files replaced": "Fichiers remplacés",
	"Status": "Etat",
	"matchesReplacedMsg": "${0} correspondances remplacées sur ${1}.",
	"Replace all matches with...": "Remplacer tous les correspondances par...",
	"Apply Changes": "Remplacer la sélection",
	"Replace all selected matches": "Remplacer toutes les correspondances sélectionnées",
	"Hide Compare": "Masquer la comparaison",
	"Hide compare view of changes": "Masquer la comparaison de la vue des changements",
	"Show Compare": "Afficher la comparaison",
	"Show compare view of changes": "Afficher la comparaison de la vue des changements",
	"Show All": "Afficher tout",
	"Show all the results in one page": "Afficher tous les résultats sur une page",
	"< Previous Page": "< - Page précédente",
	"Show previous page of search result": "Afficher la page précédente des résultats de la recherche",
	"Next Page >": "Page suivante >",
	"Show next page of search result": "Afficher la page suivante des résultats de la recherche",
	"Next result": "Résultat suivant",
	"Previous result": "Résultat précédent",
	"Expand all results": "Développer tous les résultats",
	"Collapse all results": "Réduire tous les résultats",
	"Writing files...": "Ecriture des fichiers en cours...",
	"Preparing preview...": "Préparation de l'aperçu...",
	"Replaced File (${0})": "Fichier remplacé (${0})",
	"Original File (${0})": "Fichier d'origine (${0})",
	"Sort by Name": "Trier par nom",
	"Compare changes": "Comparer les changements",
	"Search Results": "Résultats de la recherche",
	"Replace All Matches": "Remplacer toutes les correspondances",
	"No matches": "Aucune correspondance",
	"Rename": "Attribution d'un nouveau nom",
	"Search": "Recherche",
	"All types": "Tous les types",
	"File type": "Type de fichier",
	"All ${0} files": "Tous les fichiers ${0}",
	"${0} is already saved": "${0} est déjà enregistré",
	"Type a search term": "Entrer un terme de recherche",
	"Type a replace term": "Entrer un terme de remplacement",
	"Case sensitive": "Sensible à la casse",
	"File name": "Nom du fichier",
	"Path name": "Nom du chemin d'accès",
	"Save": "Sauvegarder",
	"Type filter text": "Entrer le texte du filtre",
	"Scope Search": "Recherche étendue",
	"Open in Search page for this directory": "Ouvrir la page Recherche pour ce dossier.",
	"${0}. Try your search again.": "${0}. Lancez à nouveau votre recherche.",
	"DeleteSearchTrmMsg": "Cliquez sur Supprimer ou utilisez la touche de suppression pour supprimer un terme de recherche",
	"${0} matches": "${0} correspondance(s)",
	"regexOptionOff" : "Les expressions régulières sont désactivées. Cliquez ici ou utilisez les options pour les activer pour le remplacement",
	"regexOptionOn" : "Les expressions régulières sont activées. Cliquez ici ou utilisez les options pour les désactiver",
	"Scope": "Portée",
	"Show previous search terms": "Afficher les termes précédemment recherchés",
	"Show previous replace terms": "Afficher les termes précédemment remplacés",
	"Show replacement preview": "Afficher l'aperçu du remplacement",
	"File name patterns (comma-separated)": "Modèles de nom de fichier (séparés par des virgules)",
	"(* = any string, ? = any character)": "(* = toute chaîne, ? = tout caractère)",
	"Choose a Folder": "Sélectionnez un dossier",
	"Remove from search results": "Retirer des résultats de la recherche",
	"^ Edit Search": "^ Editer la recherche",
	"Preview: " : "Aperçu : ",
	"fullPath": "Afficher le chemin complet ",
	"switchFullPath": "Afficher/masquer le chemin complet "
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/de/messages',{
	"Find:": "Suchen:",
	"Find With": "Suchen mit",
	"ReplaceWith:": "ReplaceWith:",
	"Replace With": "Ersetzen durch",
	"Show all": "Alle anzeigen",
	"Wrap search": "Suche mit Umlauf",
	"Incremental search": "Inkrementelle Suche",
	"Whole Word": "Ganzes Wort",
	"Regular expression": "Regulärer Ausdruck",
	"Find after replace": "Suchen nach Ersetzen",
	"Options": "Optionen",
	"Find next match": "Nächste Übereinstimmung suchen",
	"Find previous match": "Vorherige Übereinstimmung suchen",
	"Next": "Nächste",
	"Previous": "Vorherige",
	"Replace": "Ersetzen",
	"Replace...": "Ersetzen...",
	"Replace All": "Global ersetzen",
	"Show Replace": "In Ersetzungsmodus umschalten",
	"Hide Replace": "In Suchmodus umschalten",
	"Search ${0}": "${0} durchsuchen",
	"TypeKeyOrWildCard": "Schlüsselwort oder Platzhalterzeichen eingeben zur Suche in ",
	"Search failed.": "Suche fehlgeschlagen.",
	"NoMatchFound": "Keine Übereinstimmungen für ${0} gefunden.",
	"Searching...": "Suchen...",
	"ResourceChanged.": "Die Ressource wurde von anderen Benutzern geändert.",
	"Failed to write file.": "Schreiboperation in Datei ist fehlgeschlagen.",
	"Results": "Ergebnisse",
	"FilesAofBmatchingC": "Dateien ${0} von ${1} übereinstimmend mit \"${2}\"",
	"ReplaceAwithBforCofD": "\"${0}\" durch \"${1}\" für Dateien ${2} von ${3} ersetzen",
	"Location": "Position",
	"Click to compare": "Klicken Sie hier, um den Vergleich durchzuführen",
	"Search again in this folder with \"${0}\"": "Suche in diesem Ordner wiederholen mit ${0}\"",
	"Files replaced": "Dateien ersetzt",
	"Status": "Status",
	"matchesReplacedMsg": "${0} von ${1} Übereinstimmungen wurden ersetzt.",
	"Replace all matches with...": "Alle Übereinstimmungen ersetzen durch...",
	"Apply Changes": "Ausgewählte ersetzen",
	"Replace all selected matches": "Alle ausgewählten Übereinstimmungen ersetzen",
	"Hide Compare": "Vergleich ausblenden",
	"Hide compare view of changes": "Vergleichsansicht der Änderungen ausblenden",
	"Show Compare": "Vergleich einblenden",
	"Show compare view of changes": "Vergleichsansicht der Änderungen einblenden",
	"Show All": "Alle einblenden",
	"Show all the results in one page": "Alle Ergebnisse auf einer Seite anzeigen",
	"< Previous Page": "< Vorherige Seite",
	"Show previous page of search result": "Vorherige Seite der Suchergebnisse anzeigen",
	"Next Page >": "Nächste Seite >",
	"Show next page of search result": "Nächste Seite der Suchergebnisse anzeigen",
	"Next result": "Nächstes Ergebnis",
	"Previous result": "Vorheriges Ergebnis",
	"Expand all results": "Alle Ergebnisse einblenden",
	"Collapse all results": "Alle Ergebnisse ausblenden",
	"Writing files...": "Schreiboperationen in Dateien werden ausgeführt...",
	"Preparing preview...": "Vorschau wird vorbereitet...",
	"Replaced File (${0})": "Ersetzte Datei (${0})",
	"Original File (${0})": "Ursprüngliche Datei (${0})",
	"Sort by Name": "Nach Namen sortieren",
	"Compare changes": "Änderungen vergleichen",
	"Search Results": "Suchergebnisse",
	"Replace All Matches": "Alle Übereinstimmungen ersetzen",
	"No matches": "Keine Übereinstimmungen",
	"Rename": "Umbenennen",
	"Search": "Suchen",
	"All types": "Alle Typen",
	"File type": "Dateityp",
	"All ${0} files": "Alle ${0}-Dateien",
	"${0} is already saved": "${0} wurde bereits gespeichert.",
	"Type a search term": "Suchbegriff eingeben",
	"Type a replace term": "Ersetzungsbegriff eingeben",
	"Case sensitive": "Groß-/Kleinschreibung",
	"File name": "Dateiname",
	"Path name": "Pfadname",
	"Save": "Speichern",
	"Type filter text": "Filtertext eingeben",
	"Scope Search": "Bereichsorientierte Suche",
	"Open in Search page for this directory": "Öffnen Sie die Suchseite für diesen Ordner.",
	"${0}. Try your search again.": "${0}. Wiederholen Sie die Suche.",
	"DeleteSearchTrmMsg": "Klicken Sie hier oder verwenden Sie die Löschtaste, um den Suchbegriff zu löschen.",
	"${0} matches": "${0} Übereinstimmungen",
	"regexOptionOff" : "Reguläre Ausdrücke sind inaktiviert. Klicken Sie hier, oder verwenden Sie die Optionen, um Sie zum Ersetzen zu aktivieren",
	"regexOptionOn" : "Reguläre Ausdrücke sind aktiviert. Klicken Sie hier, oder verwenden Sie die Optionen, um Sie zu in aktivieren",
	"Scope": "Bereich",
	"Show previous search terms": "Vorherige Suchbegriffe anzeigen",
	"Show previous replace terms": "Vorherige Ersetzungsbegriffe anzeigen",
	"Show replacement preview": "Voranzeige von Ersetzungen anzeigen",
	"File name patterns (comma-separated)": "Dateinamensmuster (durch Kommata getrennt)",
	"(* = any string, ? = any character)": "(* = beliebige Zeichenfolge, ? = beliebiges Zeichen)",
	"Choose a Folder": "Ordner auswählen",
	"Remove from search results": "Aus Suchergebnissen entfernen",
	"^ Edit Search": "^ Suche bearbeiten",
	"Preview: " : "Vorschau: ",
	"fullPath": "Vollständigen Pfad anzeigen",
	"switchFullPath": "Vollständigen Pfad ein-/ausblenden"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/it/messages',{
	"Find:": "Trova:",
	"Find With": "Trova con",
	"ReplaceWith:": "SostituisciCon:",
	"Replace With": "Sostituisci con",
	"Show all": "Mostra tutti",
	"Wrap search": "Wrapping ricerca",
	"Incremental search": "Ricerca incrementale",
	"Whole Word": "Parola intera",
	"Regular expression": "Espressione regolare",
	"Find after replace": "Trova e sostituisci",
	"Options": "Opzioni",
	"Find next match": "Trova corrispondenza successiva",
	"Find previous match": "Trova corrispondenza precedente",
	"Next": "Avanti",
	"Previous": "Indietro",
	"Replace": "Sostituisci",
	"Replace...": "Sostituisci...",
	"Replace All": "Sostituisci tutto",
	"Show Replace": "Passa alla modalità di sostituzione",
	"Hide Replace": "Passa alla modalità di ricerca",
	"Search ${0}": "Cerca ${0}",
	"TypeKeyOrWildCard": "Immetti una parola chiave o un carattere jolly per cercare in ",
	"Search failed.": "Ricerca non riuscita.",
	"NoMatchFound": "Nessuna corrispondenza trovata per ${0}",
	"Searching...": "Ricerca in corso...",
	"ResourceChanged.": "La risorsa è stata modificata da altri.",
	"Failed to write file.": "Errore di scrittura file.",
	"Results": "Risultati",
	"FilesAofBmatchingC": "File ${0} di ${1} corrispondenti a \"${2}\"",
	"ReplaceAwithBforCofD": "Sostituisci \"${0}\" con \"${1}\" per i file ${2} di ${3}",
	"Location": "Ubicazione",
	"Click to compare": "Fai clic per confrontare",
	"Search again in this folder with \"${0}\"": "Cerca di nuovo in questa cartella con \"${0}\"",
	"Files replaced": "File sostituiti",
	"Status": "Stato",
	"matchesReplacedMsg": "${0} al di fuori di corrispondenze ${1}  sostituite.",
	"Replace all matches with...": "Sostituisci tutte le corrispondenze con...",
	"Apply Changes": "Sostituzione selezionata",
	"Replace all selected matches": "Sostituisci tutte le corrispondenze selezionate",
	"Hide Compare": "Nascondi confronto",
	"Hide compare view of changes": "Nascondi vista di confronto delle modifiche",
	"Show Compare": "Mostra confronto",
	"Show compare view of changes": "Mostra vista di confronto delle modifiche",
	"Show All": "Mostra tutti",
	"Show all the results in one page": "Mostra tutti i risultati in una pagina",
	"< Previous Page": "<Pagina precedente",
	"Show previous page of search result": "Mostra la pagina precedente del risultato della ricerca",
	"Next Page >": "Pagina successiva >",
	"Show next page of search result": "Mostra la pagina successiva del risultato della ricerca",
	"Next result": "Risultato successivo",
	"Previous result": "Risultato precedente",
	"Expand all results": "Espandi tutti i risultati",
	"Collapse all results": "Comprimi tutti i risultati",
	"Writing files...": "Scrittura file...",
	"Preparing preview...": "Preparazione in corso dell'anteprima...",
	"Replaced File (${0})": "File sostituito (${0})",
	"Original File (${0})": "File originale (${0})",
	"Sort by Name": "Ordina per nome",
	"Compare changes": "Confronta modifiche",
	"Search Results": "Risultati della ricerca",
	"Replace All Matches": "Sostituisci tutte le corrispondenze",
	"No matches": "Nessuna corrispondenza",
	"Rename": "Rinomina",
	"Search": "Cerca",
	"All types": "Tutti i tipi",
	"File type": "Tipo di file",
	"All ${0} files": "Tutti i ${0} file",
	"${0} is already saved": "${0} è già salvato",
	"Type a search term": "Immettere un termine di ricerca",
	"Type a replace term": "Immettere un termine di sostituzione",
	"Case sensitive": "Sensibile al maiuscolo/minuscolo",
	"File name": "Nome file",
	"Path name": "Nome percorso",
	"Save": "Salva",
	"Type filter text": "Immetti testo del filtro",
	"Scope Search": "Ricerca con ambito",
	"Open in Search page for this directory": "Aprire la pagina Cerca per questa cartella.",
	"${0}. Try your search again.": "${0}. Riprovare la ricerca.",
	"DeleteSearchTrmMsg": "Fare clic o utilizzare il tasto di eliminazione per eliminare il termine di ricerca",
	"${0} matches": "${0} corrispondenze",
	"regexOptionOff" : "Le espressioni regolari non sono attive. Fare clic qui per utilizzare le opzioni per attivarle per la sostituzione.",
	"regexOptionOn" : "Le espressioni regolari sono attive. Fare clic qui per utilizzare le opzioni per disattivarle",
	"Scope": "Ambito",
	"Show previous search terms": "Mostra precedenti termini di ricerca",
	"Show previous replace terms": "Mostra precedenti termini di sostituzione",
	"Show replacement preview": "Mostra anteprima sostituzione",
	"File name patterns (comma-separated)": "Modelli di nome file (separati da virgole)",
	"(* = any string, ? = any character)": "(* = qualsiasi stringa, ? = tutti i caratteri)",
	"Choose a Folder": "Seleziona una cartella",
	"Remove from search results": "Rimuovi dai risultati della ricerca",
	"^ Edit Search": "^ Modifica ricerca",
	"Preview: " : "Anteprima: ",
	"fullPath": "Mostra percorso completo ",
	"switchFullPath": "Mostra/Nascondi percorso completo"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/es/messages',{
	"Find:": "Encontrar:",
	"Find With": "Buscar con",
	"ReplaceWith:": "Sustituir por:",
	"Replace With": "Sustituir por",
	"Show all": "Mostrar todo",
	"Wrap search": "Reiniciar búsqueda",
	"Incremental search": "Búsqueda incremental",
	"Whole Word": "Palabra completa",
	"Regular expression": "Expresión regular",
	"Find after replace": "Buscar y sustituir",
	"Options": "Opciones",
	"Find next match": "Buscar coincidencia siguiente",
	"Find previous match": "Buscar coincidencia anterior",
	"Next": "Siguiente",
	"Previous": "Anterior",
	"Replace": "Sustituir",
	"Replace...": "Sustituir...",
	"Replace All": "Sustituir todo",
	"Show Replace": "Conmutar a modalidad de sustitución",
	"Hide Replace": "Conmutar a modalidad de búsqueda",
	"Search ${0}": "Buscar ${0}",
	"TypeKeyOrWildCard": "Escriba una palabra clave o un carácter comodín para realizar la búsqueda. ",
	"Search failed.": "Error de búsqueda.",
	"NoMatchFound": "No se han encontrado coincidencias para ${0}",
	"Searching...": "Buscando...",
	"ResourceChanged.": "El recurso ha sido modificado por otros.",
	"Failed to write file.": "No se ha podido escribir en el archivo.",
	"Results": "Resultados",
	"FilesAofBmatchingC": "Archivos ${0} de ${1} coincidentes con \"${2}\"",
	"ReplaceAwithBforCofD": "Sustituir \"${0}\" por \"${1}\" para los archivos ${2} de ${3}",
	"Location": "Ubicación",
	"Click to compare": "Pulse para comparar",
	"Search again in this folder with \"${0}\"": "Buscar de nuevo en esta carpeta con \"${0}\"",
	"Files replaced": "Archivos sustituidos",
	"Status": "Estado",
	"matchesReplacedMsg": "Se han sustituido ${0} de ${1} coincidencias.",
	"Replace all matches with...": "Sustituir todas las coincidencias por...",
	"Apply Changes": "Sustituir seleccionado",
	"Replace all selected matches": "Sustituir todas las coincidencias seleccionadas",
	"Hide Compare": "Ocultar comparación",
	"Hide compare view of changes": "Ocultar vista de cambios de comparación",
	"Show Compare": "Mostrar comparación",
	"Show compare view of changes": "Mostrar vista de cambios de comparación",
	"Show All": "Mostrar todo",
	"Show all the results in one page": "Mostrar todos los resultados en una página",
	"< Previous Page": "Página anterior de <",
	"Show previous page of search result": "Mostrar página anterior de resultados de la búsqueda",
	"Next Page >": "Página siguiente >",
	"Show next page of search result": "Mostrar página siguiente de resultados de la búsqueda",
	"Next result": "Siguiente resultado",
	"Previous result": "Resultado anterior",
	"Expand all results": "Expandir todos los resultados",
	"Collapse all results": "Contraer todos los resultados",
	"Writing files...": "Escribiendo archivos...",
	"Preparing preview...": "Preparando vista previa...",
	"Replaced File (${0})": "Archivo sustituido (${0})",
	"Original File (${0})": "Archivo original (${0})",
	"Sort by Name": "Ordenar por nombre",
	"Compare changes": "Comparar cambios",
	"Search Results": "Buscar resultados",
	"Replace All Matches": "Sustituir todas las coincidencias",
	"No matches": "Sin coincidencias",
	"Rename": "Renombrar",
	"Search": "Buscar",
	"All types": "Todos los tipos",
	"File type": "Tipo de archivo",
	"All ${0} files": "Todos los archivos ${0}",
	"${0} is already saved": "${0} ya está guardado",
	"Type a search term": "Escriba un término de búsqueda",
	"Type a replace term": "Escriba un término sustituto",
	"Case sensitive": "Sensible a mayúsculas y minúsculas",
	"File name": "Nombre de archivo",
	"Path name": "Nombre de vía de acceso",
	"Save": "Guardar",
	"Type filter text": "Escriba el texto de filtro",
	"Scope Search": "Búsqueda en ámbito",
	"Open in Search page for this directory": "Abrir la página de búsqueda para esta carpeta.",
	"${0}. Try your search again.": "${0}. Vuelva a intentar la búsqueda.",
	"DeleteSearchTrmMsg": "Pulse o utilice la tecla de supresión para suprimir el término de búsqueda",
	"${0} matches": "${0}coincidencias",
	"regexOptionOff" : "Las expresiones regulares están desactivadas. Pulse aquí o utilice las opciones para activarlas para sustitución",
	"regexOptionOn" : "Las expresiones regulares están activadas. Pulse aquí o utilice las opciones para desactivarlas",
	"Scope": "Ámbito",
	"Show previous search terms": "Mostrar términos de búsqueda anteriores",
	"Show previous replace terms": "Mostrar términos de sustitución anteriores",
	"Show replacement preview": "Mostrar vista previa de sustitución",
	"File name patterns (comma-separated)": "Patrones de nombre de archivo (separados por comas)",
	"(* = any string, ? = any character)": "(* = cualquier serie, ? = cualquier carácter)",
	"Choose a Folder": "Elegir carpeta",
	"Remove from search results": "Eliminar de los resultados de la búsqueda",
	"^ Edit Search": "^ Editar búsqueda",
	"Preview: " : "Vista previa: ",
	"fullPath": "Muestra la vía de acceso completa",
	"switchFullPath": "Mostrar/ocultar vía de acceso completa"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/search/nls/pt-br/messages',{
	"Find:": "Localizar:",
	"Find With": "Localizar Com",
	"ReplaceWith:": "Substituir Com",
	"Replace With": "Substituir por",
	"Show all": "Exibir Tudo",
	"Wrap search": "Quebrar a Procura",
	"Incremental search": "Procura incremental",
	"Whole Word": "Palavra Inteira",
	"Regular expression": "Expressão regular",
	"Find after replace": "Localizar após substituir",
	"Options": "Opções",
	"Find next match": "Localizar a próxima correspondência",
	"Find previous match": "Localizar a correspondência anterior",
	"Next": "Próximo",
	"Previous": "Anterior",
	"Replace": "Substituir",
	"Replace...": "Substituir...",
	"Replace All": "Substituir Tudo",
	"Show Replace": "Alternar para Modo de substituição",
	"Hide Replace": "Alternar para Modo de procura",
	"Search ${0}": "Procura ${0}",
	"TypeKeyOrWildCard": "Digite uma palavra-chave ou caractere curinga para a procura ",
	"Search failed.": "Falha na pesquisa.",
	"NoMatchFound": "Nenhuma correspondência localizada para ${0}",
	"Searching...": "Procurando...",
	"ResourceChanged.": "O recurso foi alterado por outros.",
	"Failed to write file.": "Falha ao gravar o arquivo.",
	"Results": "Resultados",
	"FilesAofBmatchingC": "Arquivos ${0} de ${1} correspondentes a \"${2}\"",
	"ReplaceAwithBforCofD": "Substituir \"${0}\" por \"${1}\" para arquivos ${2} de ${3}",
	"Location": "Localização",
	"Click to compare": "Clique para comparar",
	"Search again in this folder with \"${0}\"": "Procure novamente nesta pasta com \"${0}\"",
	"Files replaced": "Arquivos substituídos",
	"Status": "Status",
	"matchesReplacedMsg": "${0} fora de ${1} correspondências substituídas.",
	"Replace all matches with...": "Substituir todas as correspondências com...",
	"Apply Changes": "Substituir selecionado",
	"Replace all selected matches": "Substituir todas as correspondências selecionadas",
	"Hide Compare": "Ocultar Comparação",
	"Hide compare view of changes": "Ocultar a visualização de comparação das mudanças",
	"Show Compare": "Mostrar a Comparação",
	"Show compare view of changes": "Mostrar visualização comparada das mudanças",
	"Show All": "Mostrar tudo",
	"Show all the results in one page": "Mostrar todos os resultados em uma página",
	"< Previous Page": "< Página Anterior",
	"Show previous page of search result": "Mostrar a página anterior de resultado da procura",
	"Next Page >": "Próxima Página >",
	"Show next page of search result": "Mostrar a próxima página de resultado da procura",
	"Next result": "Próximo resultado",
	"Previous result": "Resultado anterior",
	"Expand all results": "Expandir todos os resultados",
	"Collapse all results": "Reduzir todos os resultados",
	"Writing files...": "Gravando arquivos...",
	"Preparing preview...": "Preparando visualização...",
	"Replaced File (${0})": "Arquivo Substituído (${0})",
	"Original File (${0})": "Arquivo Original (${0})",
	"Sort by Name": "Classificar por Nome",
	"Compare changes": "Comparar as mudanças",
	"Search Results": "Resultados da pesquisa",
	"Replace All Matches": "Substituir Todas as Correspondências",
	"No matches": "Nenhuma correspondência",
	"Rename": "Renomear",
	"Search": "Pesquisar",
	"All types": "Todos os tipos",
	"File type": "Tipo de Arquivo",
	"All ${0} files": "Todos os ${0} arquivos",
	"${0} is already saved": "${0} já está salvo",
	"Type a search term": "Digite um termo de procura",
	"Type a replace term": "Digite um termo de substituição",
	"Case sensitive": "Fazer distinção entre maiúsculas e minúsculas",
	"File name": "Nome do arquivo",
	"Path name": "Nome do caminho",
	"Save": "Salvar",
	"Type filter text": "Digite o Texto de Filtro",
	"Scope Search": "Procura com escopo definido",
	"Open in Search page for this directory": "Abra a página Procurar para esta pasta.",
	"${0}. Try your search again.": "${0}. Tente novamente sua procura.",
	"DeleteSearchTrmMsg": "Clique ou use a tecla delete para excluir o termo de procura",
	"${0} matches": "${0}corresponde",
	"regexOptionOff" : "As expressões regulares estão desativadas. Clique aqui ou use as opções para ativá-las para substituição",
	"regexOptionOn" : "As expressões regulares estão ativadas. Clique aqui ou use as opções para desativá-las",
	"Scope": "Escopo",
	"Show previous search terms": "Mostrar termos de procura anterior",
	"Show previous replace terms": "Mostrar termos de substituição anterior",
	"Show replacement preview": "Mostrar substituição anterior",
	"File name patterns (comma-separated)": "Padrões de nome de arquivo (separados por vírgula)",
	"(* = any string, ? = any character)": "(* = qualquer cadeia, ? = qualquer caractere)",
	"Choose a Folder": "Escolher uma Pasta",
	"Remove from search results": "Remover dos resultados da procura",
	"^ Edit Search": "^ Editar procura",
	"Preview: " : "Visualização: ",
	"fullPath": "Mostrar caminho completo",
	"switchFullPath": "Mostrar/ocultar caminho completo"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/inputCompletion/inputCompletion',['orion/EventTarget'], function( EventTarget){

	/**
	 * InputCompletion is an alternative to datalist support in html5.
	 * When binded with an html input element, it provides the input completion while user is typing in the input field.
	 * @param {DOMElement} inputFieldOrId The "text" type input html element. This is required.
	 * @param {function} binderFunc The callback function to provide a full set of proposal items that the proposal is based on.
	 * If a binder function is provided, every time when the input field is focused, we would ask for the full set of data and propose based on that.	 
	 * The parameter of the binderFunc is another call back function. The implementation of the binderFunc has to pass an array of 
	 * items to the call back.
	 * Each item must have 3 properties:
	 * <ul>
	 *   <li>type: can be either "proposal" or "category"</li>
	 *   <li>label: the display name of the item</li>
	 *   <li>value: the value that will be filtered on and send back to the input field</li>
	 * </ul>
	 *
	 * @param {Object} options The options that may affect how the proposal works.
	 * @param {Function} options.extendedProvider The extended provider function(keyword, callback(returnedProposals)) that provides additional proposals.
	 *        It basically provides a list of proposals by a given keyword and a call back. It should call the call back to return the proposals. 
	 * Each item in the return list must have properties as below:
	 * <ul>
	 *   <li>filterForMe: true or false. True means it asks inputCompletion to filter o nteh result. false means it is already filterd.
	 *   <li>proposals: A list/array of proposals. Each item has the properties {type, label, value} decribed above.</li>
	 * </ul>
	 * @param {String} options.group The group name of input completion. If there will be multiple input completion in one page, the group name is nice to provide.
	 * @param {Boolean} options.proposeFromStart The flag to propose strings that only match from start(index 0). If not provided, the flag is set to false.
	 * For example if this flag is true, "foo" will only match "fo" but not "oo". If false, "foo" will match both "fo" and "oo".
	 * @param {Function} options.onDelete The onDelete function(itemToBeDleted, eventTarget)) that provides the deletion of a proposal item.
	 * @param {String} options.deleteToolTips The string that represents the toolltips for the deletion.
	 */
	function InputCompletion(inputFieldOrId, binderFunc, options) {
		EventTarget.attach(this);
		this._binderFunc = binderFunc;
		this.setInputField(inputFieldOrId);
		var idFrefix = options ? options.group: null;
		if(!idFrefix){
			if(this._inputField && this._inputField.id){
				idFrefix = this._inputField.id;
			} else {
				idFrefix = "default__input__group"; //$NON-NLS-0$
			}
		}
		this._completionIdPrefix = idFrefix + "__completion__"; //$NON-NLS-0$
		this._proposeFromStart = options ? options.proposeFromStart : false;
		this._extendedProvider = options ? options.extendedProvider : null;
		this._serviceRegistry = options ? options.serviceRegistry : null;
		this._onDelete = options ? options.onDelete : null;
		this._deleteToolTips = options ? options.deleteToolTips : "";
		this._proposalIndex = -1;
		this._dismissed = true;
		this._mouseDown = false;
		this._dataList = [];
		this._initUI();
		
		this._listeners = [];
		var dataListHandler = function(event) {
			if(this._binderFunc){// If a binder function is provided, every time when the input field is focused, we would ask for the full set of data and propose based on that
				var completion = this;
				this._binderFunc(function(dataList){
					this._bind(dataList);
					if(event.deleting){
						this._proposeOn(this._inputField.value);
						this._selectProposal(this._proposalIndex, true);
					}
				}.bind(completion));
			}
		}.bind(this);
		this.addEventListener("inputDataListChanged", dataListHandler);//$NON-NLS-0$
		this._listeners.push({evtTarget: this, type: "inputDataListChanged", handler: dataListHandler});//$NON-NLS-0$
		
		var mouseDownHandler = function(e) {
			this._mouseDown = true;
		}.bind(this);
		this._completionUIContainer.addEventListener("mousedown", mouseDownHandler);//$NON-NLS-0$
		this._listeners.push({evtTarget: this._completionUIContainer, type: "mousedown", handler: mouseDownHandler});//$NON-NLS-0$
		
		var mouseUpHandler = function(e) {
			this._mouseDown = false;
		}.bind(this);
		this._completionUIContainer.addEventListener("mouseup", mouseUpHandler);//$NON-NLS-0$
		this._listeners.push({evtTarget: this._completionUIContainer, type: "mouseup", handler: mouseUpHandler});//$NON-NLS-0$
	}
	
	/**
	 * Private
	 */
	InputCompletion.prototype._removeListeners = function(listeners){
		if(listeners){
			listeners.forEach(function(listener){
				listener.evtTarget.removeEventListener(listener.type, listener.handler, false);
			});
		}
	};
		
	InputCompletion.prototype.destroy = function(){
		this._removeListeners(this._inputFieldListeners);
		this._removeListeners(this.listeners);
	};
	
	/**
	 * Check is the data list already has an item whose value is the given value.
	 * @param {String} value The given value.
	 */
	InputCompletion.prototype.hasValueOf = function(value){
		return this._dataList.some(function(item){
			return item.value === value;
		});
	};
	
	/**
	 * Initialize or reset the nput field for the completion.
	 * When called by teh caller, it will check if a previous input field is hooked with the completion. If so then remove all the listeners on the previous input field.
	 * @param {DOMElement} inputFieldOrId The "text" type input html element. This is required.
	 */
	InputCompletion.prototype.setInputField = function(inputFieldOrId){
		if(this._inputField && this._inputFieldListeners){
			this._removeListeners(this._inputFieldListeners);
		}
		this._inputFieldListeners = [];
		this._inputField = inputFieldOrId;
		if (typeof(this._inputField) === "string") { //$NON-NLS-0$
			this._inputField = document.getElementById(this._inputField);
		}
		
		var blurHanlder = function(e) {
			if(this._mouseDown){
				var completion = this;
				window.setTimeout(function(){ //wait a few milliseconds for the input field to focus 
					this._inputField.focus();
				}.bind(completion), 200);
			} else {
				if (document.activeElement !== this._inputField) { //guard against temporary loss of focus
					this._dismiss();
				}
			}
		}.bind(this);
		this._inputField.addEventListener("blur", blurHanlder); //$NON-NLS-0$
		this._inputFieldListeners.push({evtTarget: this._inputField, type: "blur", handler: blurHanlder}); //$NON-NLS-0$
		
		var keyDownHandler = function(e) {
			this.onKeyDown(e);
		}.bind(this);
		this._inputField.addEventListener("keydown", keyDownHandler); //$NON-NLS-0$
		this._inputFieldListeners.push({evtTarget: this._inputField, type: "keydown", handler: keyDownHandler}); //$NON-NLS-0$

		var inputChangeHandler = function(e) {
			this._proposeOn(this._inputField.value);
		}.bind(this);
		this._inputField.addEventListener("input", inputChangeHandler); //$NON-NLS-0$
		this._inputFieldListeners.push({evtTarget: this._inputField, type: "input", handler: inputChangeHandler}); //$NON-NLS-0$
		
		var focusHandler = function(e) {
			if(!this._dismissed || !this._binderFunc){
				return;
			}
			if(this._dismissing){
				this._dismissing = false;
				return;
			}
			if(this._binderFunc){// If a binder function is provided, every time when the input field is focused, we would ask for the full set of data and propose based on that
				var completion = this;
				this._binderFunc(function(dataList){
					this._bind(dataList);
					if(this._inputField.value) {
						//this._proposeOn(this._inputField.value);
					}
				}.bind(completion));
			}
		}.bind(this);
		this._inputField.addEventListener("focus", focusHandler); //$NON-NLS-0$
		this._inputFieldListeners.push({evtTarget: this._inputField, type: "focus", handler: focusHandler}); //$NON-NLS-0$
	};

	/**
	 * The key listener on enter , down&up arrow and ESC keys.
	 * The user of the input completion has to listen on the key board events and call this function.
	 * If this function returns true, the caller's listener has to stop handling it.
	 */
	InputCompletion.prototype.onKeyDown = function(e){
		if(this._dismissed){
			return true;
		}
		var keyCode= e.charCode || e.keyCode;
		if (keyCode === 13/* Enter */) {//If there is already a selected/hightlighted item in the proposal list, then put hte proposal back to the input field and dismiss the proposal UI
			if(this._proposalList && this._proposalList.length > 0 && this._proposalIndex >= 0 && this._proposalIndex < this._proposalList.length){
				e.preventDefault();
				this._dismiss(this._proposalList[this._proposalIndex].item.value, e.ctrlKey);
				e.stopPropagation();
				return false;
			}
			return true;
		} else if((keyCode === 40 /* Down arrow */ || keyCode === 38 /* Up arrow */) && this._proposalList && this._proposalList.length > 0){
			e.preventDefault();
			this._walk(keyCode === 40);//In case of down or up arrows, jsut walk forward or backward in the list and highlight it.
			e.stopPropagation();
			return false;
		} else if(keyCode === 27/* ESC */) {
			e.preventDefault();
			this._dismiss();//Dismiss the proposal UI and do nothing.
			return false;
		} else if(keyCode === 46/* DELETE */) {
			if(this._proposalIndex > -1 && this._onDelete) { //If a proposal is highlighted in the suggestion and the onDelete callback is provided, the delete key will delete the proposal.
				e.preventDefault();
				this._onDelete(this._proposalList[this._proposalIndex].item.value, this);
				this._resetIndexAfterDeletion();
				e.stopPropagation();
				return false;
			}
			return true;
		}
		return true;
	};

	InputCompletion.prototype._resetIndexAfterDeletion = function(){
		if(this._proposalList.length <= 1) {
			this._proposalIndex = -1;
		} else if(this._proposalIndex === (this._proposalList.length - 1)) {
			this._proposalIndex = this._proposalList.length - 2;
		}
	};
	
	InputCompletion.prototype._bind = function(dataList){
		this._dataList = dataList;
	};
	
	InputCompletion.prototype._getUIContainerID = function(){
		return this._completionIdPrefix + "UIContainer"; //$NON-NLS-0$
	};

	InputCompletion.prototype._getUIProposalListId = function(){
		return this._completionIdPrefix + "UIProposalList"; //$NON-NLS-0$
	};
	
	InputCompletion.prototype._initUI = function(){
		this._completionUIContainer = document.getElementById(this._getUIContainerID());
		if(!this._completionUIContainer){
			this._completionUIContainer = document.createElement('div'); //$NON-NLS-0$
			this._completionUIContainer.id = this._getUIContainerID();
			this._completionUIContainer.style.display = "none"; //$NON-NLS-0$
			this._completionUIContainer.className = "inputCompletionContainer"; //$NON-NLS-0$
			this._completionUIContainer.setAttribute("role", "list"); //$NON-NLS-1$ //$NON-NLS-0$
			this._completionUIContainer.setAttribute("aria-atomic", "true"); //$NON-NLS-1$ //$NON-NLS-0$
			this._completionUIContainer.setAttribute("aria-live", "assertive"); //$NON-NLS-1$ //$NON-NLS-0$
			document.body.appendChild(this._completionUIContainer);
		}
		this._completionUIContainer.textContent = "";
		this._completionUL = document.getElementById(this._getUIProposalListId());
		if(!this._completionUL){
			this._completionUL = document.createElement('ul');//$NON-NLS-0$
			this._completionUL.id = this._getUIProposalListId();
			this._completionUL.className = "inputCompletionUL";//$NON-NLS-0$
		}
		this._completionUL.textContent = "";
		this._completionUIContainer.appendChild(this._completionUL);
	};
	
	InputCompletion.prototype._createProposalLink = function(name, href, boldIndex, boldLength) {
		var link = document.createElement("a"); //$NON-NLS-0$
		link.href = require.toUrl(href);
		link.appendChild(this._createBoldText(name, boldIndex, boldLength));
		return link;
	};
	
	InputCompletion.prototype._createBoldText = function(text, boldIndex, boldLength, parent){
		if(boldIndex < 0){
			return document.createTextNode(text);
		}
		var parentSpan = parent ? parent: document.createElement('span'); //$NON-NLS-0$
		var startIndex = 0;
		var textNode;
		if(startIndex !== boldIndex){
			textNode = document.createTextNode(text.substring(startIndex, boldIndex));
			parentSpan.appendChild(textNode);
		} 
		var matchSegBold = document.createElement('b'); //$NON-NLS-0$
		parentSpan.appendChild(matchSegBold);
		textNode = document.createTextNode(text.substring(boldIndex, boldIndex+boldLength));
		matchSegBold.appendChild(textNode);
		
		if((boldIndex + boldLength) < text.length){
			textNode = document.createTextNode(text.substring(boldIndex + boldLength));
			parentSpan.appendChild(textNode);
		}
		return parentSpan;
	};
	
	InputCompletion.prototype._proposeOnCategory = function(categoryName, categoryList){
		if(categoryList.length === 0){
			return;
		}
		var listEle;
		if(categoryName){
			listEle = document.createElement('li'); //$NON-NLS-0$
			listEle.className = "inputCompletionLICategory"; //$NON-NLS-0$
			var liText = document.createTextNode(categoryName);
			listEle.appendChild(liText);
			this._completionUL.appendChild(listEle);
		}
		
		categoryList.forEach(function(category) {
			listEle = document.createElement('li'); //$NON-NLS-0$
			listEle.onmouseover = function(e){
				this._selectProposal(e.currentTarget);
			}.bind(this);
			listEle.onclick = function(e){
				this._dismiss(e.currentTarget.completionItem.value);
			}.bind(this);
			listEle.className = "inputCompletionLINormal"; //$NON-NLS-0$
			listEle.completionItem = category.item;
			var deleteBtn;
			if(typeof category.item.value === "string"){ //$NON-NLS-0$
				var tbl = document.createElement('table'); //$NON-NLS-0$
				tbl.style.width = "100%"; //$NON-NLS-0$
				tbl.style.tableLayout = 'fixed'; //$NON-NLS-0$
				tbl.style.borderSpacing = "0"; //$NON-NLS-0$
				var tr = document.createElement('tr'); //$NON-NLS-0$
				tr.style.width = this._inputField.offsetWidth + "px"; //$NON-NLS-0$
				tbl.appendChild(tr);
				var td1 = document.createElement('td'); //$NON-NLS-0$
				td1.classList.add("inputCompletionLILeftTD"); //$NON-NLS-0$
				var liTextEle = this._createBoldText(category.item.value, category.boldIndex, category.boldLength);
				td1.appendChild(liTextEle);
				td1.style.overflow = 'hidden'; //$NON-NLS-0$
				tr.appendChild(td1);
				
				if(this._onDelete) {
					deleteBtn = document.createElement('button'); //$NON-NLS-0$
					deleteBtn.classList.add("inputCompletionDismissButton"); //$NON-NLS-0$
					deleteBtn.classList.add("layoutRight"); //$NON-NLS-0$
					deleteBtn.classList.add("core-sprite-close"); //$NON-NLS-0$
					deleteBtn.classList.add("imageSprite"); //$NON-NLS-0$
					deleteBtn.style.display = "none"; //$NON-NLS-0$
					deleteBtn.style.margin = "0 0 0"; //$NON-NLS-0$
					deleteBtn.title = this._deleteToolTips;
					deleteBtn.onclick = function(e){
						e.stopPropagation();
						this._onDelete(category.item.value, this);
						this._resetIndexAfterDeletion();
					}.bind(this);
					var td2 = document.createElement('td'); //$NON-NLS-0$
					td2.classList.add("inputCompletionLIRightTD"); //$NON-NLS-0$
					td2.appendChild(deleteBtn);
					tr.appendChild(td2);
				}
				listEle.appendChild(tbl);
			} else if(category.item.value.name && category.item.value.type === "link"){ //$NON-NLS-0$
				listEle.appendChild(this._createProposalLink(category.item.value.name, category.item.value.value, category.boldIndex, category.boldLength));
			}
			this._completionUL.appendChild(listEle);
			this._proposalList.push({item: category.item, domNode: listEle, deleteBtn: deleteBtn});
		}.bind(this));
	};

	InputCompletion.prototype._domNode2Index = function(domNode){
		if(this._proposalList) {
			for(var i=0; i < this._proposalList.length; i++){
				if(this._proposalList[i].domNode === domNode){
					return i;
				}
			}
		}
		return -1;
	};
	
	InputCompletion.prototype._highlight = function(indexOrDomNode, selected){
		var domNode = indexOrDomNode;
		var deleteBtn;
		var fromIndex = false;
		if(!isNaN(domNode)){
			fromIndex = true;
			if(this._proposalList && indexOrDomNode >= 0 && indexOrDomNode < this._proposalList.length){
				domNode = this._proposalList[indexOrDomNode].domNode;
				deleteBtn = this._proposalList[indexOrDomNode].deleteBtn;
			} else {
				domNode = null;
			}
		}
		if(domNode){
			domNode.className = (selected ? "inputCompletionLISelected": "inputCompletionLINormal"); //$NON-NLS-1$ //$NON-NLS-0$
			if(deleteBtn){
				deleteBtn.style.display = selected ? "": "none"; //$NON-NLS-0$
			}
			if(selected && fromIndex){
				if (domNode.offsetTop < this._completionUIContainer.scrollTop) {
					domNode.scrollIntoView(true);
				} else if ((domNode.offsetTop + domNode.offsetHeight) > (this._completionUIContainer.scrollTop + this._completionUIContainer.clientHeight)) {
					domNode.scrollIntoView(false);
				}
			}
		}
	};

	InputCompletion.prototype._selectProposal = function(indexOrDomNode, force){
		var index = indexOrDomNode;
		if(isNaN(index)){
			index = this._domNode2Index(indexOrDomNode);
		}
		if(index !== this._proposalIndex || force){
			this._highlight(this._proposalIndex, false);
			this._proposalIndex = index;
			this._highlight(this._proposalIndex, true);
		}
	};
	
	InputCompletion.prototype._dismiss = function(valueToInputField, ctrlKey){
		if(this._mouseDown){
			return;
		}
		this._dismissed = true;
		this._proposalList = null;
		this._proposalIndex = -1;
		
		if(typeof valueToInputField === "string"){ //$NON-NLS-0$
			this._inputField.value = valueToInputField;
			this._dismissing = true;
			this._inputField.focus();
		} else if(valueToInputField && valueToInputField.name && valueToInputField.type === "link"){ //$NON-NLS-0$
			if(ctrlKey){
				window.open(valueToInputField.value);
			} else {
				window.location.href = valueToInputField.value;
			}
		}
		this._completionUIContainer.style.display = "none"; //$NON-NLS-0$
	};
	
	InputCompletion.prototype._show = function(){
		if(this._proposalList && this._proposalList.length > 0){
			var curLeft=0, curTop=0;
			var offsetParent = this._inputField;
			while (offsetParent) {
				curLeft += offsetParent.offsetLeft;
				curTop += offsetParent.offsetTop;
		        offsetParent = offsetParent.offsetParent;
			}
			this._completionUIContainer.style.display = "block"; //$NON-NLS-0$
			this._completionUIContainer.style.top = curTop + this._inputField.offsetHeight + 2 + "px"; //$NON-NLS-0$
			this._completionUIContainer.style.left = curLeft + "px"; //$NON-NLS-0$
			this._completionUIContainer.style.width = this._inputField.offsetWidth + "px"; //$NON-NLS-0$
			this._mouseDown = false;
			this._dismissed = false;
		} else {
			this._dismissed = true;
			this._proposalList = null;
			this._proposalIndex = -1;
			this._completionUIContainer.style.display = "none"; //$NON-NLS-0$
		}
	};
	
	InputCompletion.prototype._walk = function(forwad){
		var index = this._proposalIndex + (forwad ? 1: -1);
		if(index < -1){
			index = this._proposalList.length -1;
		} else if( index >= this._proposalList.length){
			index = -1;
		}
		this._selectProposal(index);
	};
	
	InputCompletion.prototype._proposeOnList = function(datalist, searchTerm, filterForMe){
		var categoryName = "";
		var categoryList = [];
		var searchTermLen = searchTerm ? searchTerm.length : 0;
		
		datalist.forEach(function(data) {
			if(data.type === "category"){ //$NON-NLS-0$
				this._proposeOnCategory(categoryName, categoryList);
				categoryName = data.label;
				categoryList = [];
			} else {
				var proposed = true;
				var pIndex = -1;
				if(searchTerm && filterForMe){
					var searchOn;
					if(typeof data.value === "string"){ //$NON-NLS-0$
						searchOn = data.value.toLowerCase();
					} else if(data.value.name){
						searchOn = data.value.name.toLowerCase();
					}
					pIndex = searchOn.indexOf(searchTerm);
					if(pIndex < 0){
						proposed = false;
					} else if(this._proposeFromStart){
						proposed = (pIndex === 0);
					} 
				}
				if(proposed){
					categoryList.push({item: data, boldIndex: pIndex, boldLength: searchTermLen});
				}
			}
		}.bind(this));
		this._proposeOnCategory(categoryName, categoryList);
	};
	
	InputCompletion.prototype._proposeOn = function(inputValue){
		this._completionUL.textContent = "";
		var searchTerm = inputValue ? inputValue.toLowerCase() : null;
		this._proposalList = [];
		//var topList = [{type: "proposal", value: {name: "Advanced Search", value: "/settings/settings.html", type: "link"}}]
		//this._proposeOnList(topList, searchTerm, false);
		this._proposeOnList(this._dataList, searchTerm, true);
		if(this._extendedProvider && searchTerm){
			this._extendedProvider(inputValue, function(extendedProposals){
				if(extendedProposals){
					var completion = this;
					extendedProposals.forEach(function(extendedProposal) {
						this._proposeOnList(extendedProposal.proposals, extendedProposal.filterForMe ? searchTerm : inputValue, extendedProposal.filterForMe);
					}.bind(completion));
				}
				this._show();	
			}.bind(this), []);
		} else {
			this._show();
		}
	};
	InputCompletion.prototype.constructor = InputCompletion;

	//return module exports
	return {
		InputCompletion: InputCompletion
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others. All rights reserved.
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: 
 *	IBM Corporation - initial API and implementation
 *	Adrian Aichner - regular expression capture group support in replace
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/searchAndReplace/textSearcher',[
	'i18n!orion/search/nls/messages', 
	'orion/editor/find', 'orion/commands', 
	'orion/objects',
	'orion/inputCompletion/inputCompletion', 
	'orion/webui/littlelib' ], 
	function(messages, mFind, mCommands, objects, mInputCompletion, lib){
	
	var MAX_RECENT_FIND_NUMBER = 30;
	function TextSearcher(editor, serviceRegistry, cmdservice, undoStack, options) {
		mFind.Find.call(this, editor, undoStack, options);
		this._serviceRegistry = serviceRegistry;
		this._commandService = cmdservice;
	}
	
	TextSearcher.prototype = new mFind.Find();
	
	objects.mixin (TextSearcher.prototype, {
		getFindString: function() {
			var input = document.getElementById("localSearchFindWith"); //$NON-NLS-0$
			if (!input) {
				return mFind.Find.prototype.getFindString.call(this);
			}
			return input.value;
		},
		getReplaceString: function() {
			var input = document.getElementById("localSearchReplaceWith"); //$NON-NLS-0$
			if (!input) {
				return mFind.Find.prototype.getReplaceString(this);
			}
			return input.value;
		},
		hide: function() {
			var visible = this.isVisible();
			mFind.Find.prototype.hide.call(this);
			if(visible){
				this._commandService.closeParameterCollector();
			}
		},
		show: function(options) {
			mFind.Find.prototype.show.call(this, options);
			var findString = options.findString;
			this._addRecentfind(findString);
			var replaceString = options.replaceString;
			var findDiv = document.getElementById("localSearchFindWith"); //$NON-NLS-0$
			if (!findDiv) {
				this._createActionTable();
				findDiv = document.getElementById("localSearchFindWith"); //$NON-NLS-0$
			}
			if (findString) {
				findDiv.value = findString;
			}
			if (replaceString) {
				var replaceDiv = document.getElementById("localSearchReplaceWith"); //$NON-NLS-0$
				replaceDiv.value = replaceString;
			}
			window.setTimeout(function() {
				findDiv.select();
				findDiv.focus();
			}, 10);
		},
		_showReplaceInfo: function() {
			if(this._regex) {
				this._replaceInfo.src = "data:image/gif;base64,R0lGODlhBwAIAMQAAMzX6cbT5kh4qFiIuKC40FCIuGSXwmWZw2SaxGacxmadxmWcxbPM4GigyJW92JzC26DI0P///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABIALAAAAAAHAAgAAAUmoEQUQkFI0PBEz5A2yII0w9AwkUPbRpTsjUNEQUsFIgCXiGSShAAAOw==";//$NON-NLS-0$
				this._replaceInfo.title=messages["regexOptionOn"];
				this._replaceInfo.style.display = "";
			} else {
				this._replaceInfo.src ="data:image/gif;base64,R0lGODlhBwAIAEAAACH5BAEAABIALAAAAAAHAAgAhwAAAAAAMwAAZgAAmQAAzAAA/wArAAArMwArZgArmQArzAAr/wBVAABVMwBVZgBVmQBVzABV/wCAAACAMwCAZgCAmQCAzACA/wCqAACqMwCqZgCqmQCqzACq/wDVAADVMwDVZgDVmQDVzADV/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMrADMrMzMrZjMrmTMrzDMr/zNVADNVMzNVZjNVmTNVzDNV/zOAADOAMzOAZjOAmTOAzDOA/zOqADOqMzOqZjOqmTOqzDOq/zPVADPVMzPVZjPVmTPVzDPV/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YrAGYrM2YrZmYrmWYrzGYr/2ZVAGZVM2ZVZmZVmWZVzGZV/2aAAGaAM2aAZmaAmWaAzGaA/2aqAGaqM2aqZmaqmWaqzGaq/2bVAGbVM2bVZmbVmWbVzGbV/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5krAJkrM5krZpkrmZkrzJkr/5lVAJlVM5lVZplVmZlVzJlV/5mAAJmAM5mAZpmAmZmAzJmA/5mqAJmqM5mqZpmqmZmqzJmq/5nVAJnVM5nVZpnVmZnVzJnV/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wrAMwrM8wrZswrmcwrzMwr/8xVAMxVM8xVZsxVmcxVzMxV/8yAAMyAM8yAZsyAmcyAzMyA/8yqAMyqM8yqZsyqmcyqzMyq/8zVAMzVM8zVZszVmczVzMzV/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8rAP8rM/8rZv8rmf8rzP8r//9VAP9VM/9VZv9Vmf9VzP9V//+AAP+AM/+AZv+Amf+AzP+A//+qAP+qM/+qZv+qmf+qzP+q///VAP/VM//VZv/Vmf/VzP/V////AP//M///Zv//mf//zP///wAAAAAAAAAAAAAAAAgsAPcpQzMJjbJ9xNAQQ6hwUqaHDws+3PeQoMN9DiUuzFRQ2ZiDyyYdHFhwYUAAOw==";
				this._replaceInfo.title=messages["regexOptionOff"];
				this._replaceInfo.style.display = "";
			}
		},
		_createActionTable: function() {
			var that = this;
			this._commandService.openParameterCollector("pageNavigationActions", function(parentDiv) { //$NON-NLS-0$
	
				// create the input box for searchTerm
				var searchStringInput = document.createElement('input'); //$NON-NLS-0$
				searchStringInput.type = "text"; //$NON-NLS-0$
				searchStringInput.name = messages["Find:"];
				searchStringInput.className = "parameterInput"; //$NON-NLS-0$
				searchStringInput.id = "localSearchFindWith"; //$NON-NLS-0$
				searchStringInput.placeholder=messages["Find With"];
				searchStringInput.oninput = function(evt){
					return that._handleInput(evt);
				};
				searchStringInput.onkeydown = function(evt){
					return that._handleKeyDown(evt);
				};
				parentDiv.appendChild(searchStringInput);
				that._initCompletion(searchStringInput);				
				that._createButton(messages["Next"], parentDiv, function() { //$NON-NLS-0$
					that._addRecentfind(that.getFindString());
					that.find(true);
				});			
				that._createButton(messages["Previous"], parentDiv, function() { //$NON-NLS-0$
					that._addRecentfind(that.getFindString());
					that.find(false);
				});			
				
				var readonly = that._editor.getTextView().getOptions("readonly"); //$NON-NLS-0$
				if (!readonly) {
					// create replace text
					var replaceStringInput = document.createElement('input'); //$NON-NLS-0$
					replaceStringInput.type = "text"; //$NON-NLS-0$
					replaceStringInput.name = messages["ReplaceWith:"];
					replaceStringInput.className = "parameterInput"; //$NON-NLS-0$
					replaceStringInput.id = "localSearchReplaceWith"; //$NON-NLS-0$
					replaceStringInput.placeholder=messages["Replace With"];
					replaceStringInput.onkeydown = function(evt){
						return that._handleKeyDown(evt);
					};
					parentDiv.appendChild(replaceStringInput);
					that._replaceInfo = that._createInfoImage(null, parentDiv, null);
					that._showReplaceInfo();
					that._createButton(messages["Replace"], parentDiv, function() {that.replace();}); //$NON-NLS-0$		
					that._createButton(messages["Replace All"], parentDiv, function() {that.replaceAll();});	//$NON-NLS-0$
				}

				var optionsDiv = document.createElement("div"); //$NON-NLS-0$
				parentDiv.appendChild(optionsDiv);
				optionsDiv.classList.add("findOptionsDiv"); //$NON-NLS-0$
				var optionMenu = mCommands.createDropdownMenu(optionsDiv, messages['Options'], null, "dismissButton", null, true); //$NON-NLS-0$
				optionMenu.menuButton.classList.add("parameterInlineButton"); //$NON-NLS-0$
				mCommands.createCheckedMenuItem(optionMenu.menu, messages["Show all"], that._showAll,
					function(event) {
						var checked = event.target.checked;
						that.setOptions({showAll: checked});
						optionMenu.dropdown.close(true);
					});
				
				mCommands.createCheckedMenuItem(optionMenu.menu, messages["Case sensitive"], !that._caseInsensitive,
					function(event) {
						that.setOptions({caseInsensitive: !event.target.checked});
						optionMenu.dropdown.close(true);
						that.find(true);
					});
				
				mCommands.createCheckedMenuItem(optionMenu.menu,  messages["Wrap search"], that._wrap,
					function(event) {
						that.setOptions({wrap: event.target.checked});
						optionMenu.dropdown.close(true);
					});
					
				mCommands.createCheckedMenuItem(optionMenu.menu,  messages["Incremental search"], that._incremental,
					function(event) {
						that.setOptions({incremental: event.target.checked});
						optionMenu.dropdown.close(true);
					});
					
				mCommands.createCheckedMenuItem(optionMenu.menu,  messages["Whole Word"], that._wholeWord,
					function(event) {
						that.setOptions({wholeWord: event.target.checked});
						optionMenu.dropdown.close(true);
						that.find(true);
					});
					
				that._regExBox = mCommands.createCheckedMenuItem(optionMenu.menu,  messages["Regular expression"], that._regex,
					function(event) {
						that.setOptions({regex: event.target.checked});
						optionMenu.dropdown.close(true);
						that.find(true);
						that._showReplaceInfo();
					});

				if (!readonly) {
					mCommands.createCheckedMenuItem(optionMenu.menu,  messages["Find after replace"], that._findAfterReplace,
						function(event) {
							that.setOptions({findAfterReplace: event.target.checked});
							optionMenu.dropdown.close(true);
						});
				}
					
				return searchStringInput;
			},
			function(){that.hide();});
		},
		_storeRecentFind: function(recentFinds, eventTarget, deleting){
			this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(prefs) {  //$NON-NLS-1$ //$NON-NLS-0$
				prefs.put("recentFind", recentFinds); //$NON-NLS-0$
				if(eventTarget) {
					window.setTimeout(function() {
						eventTarget.dispatchEvent({type:"inputDataListChanged", deleting: deleting}); //$NON-NLS-0$
					}.bind(this), 20);
				}
			});
		},
		_addRecentfind: function(findString){
			if(typeof findString !== "string" || !findString ){ //$NON-NLS-0$
				return;
			}
			//If the string is already in the input completion list, do not bother asking preference service.
			if(this._completion && this._completion.hasValueOf(findString)){
				return;
			}
			this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(prefs) {  //$NON-NLS-1$ //$NON-NLS-0$
				var i;
				var searches = prefs.get("recentFind"); //$NON-NLS-0$
				if (typeof searches === "string") { //$NON-NLS-0$
					searches = JSON.parse(searches);
				}
				if (searches) {
					for (i in searches) {
						if (searches[i].name === findString) {
							return;
						}
					}
					if(searches.length >= MAX_RECENT_FIND_NUMBER){
						var len = searches.length;
						searches.splice(MAX_RECENT_FIND_NUMBER-1, len-MAX_RECENT_FIND_NUMBER+1);
					}
				} else {
					searches = [];
				}
				searches.splice(0,0,{ "name": findString});//$NON-NLS-0$
				this._storeRecentFind(searches, this._completion);
			}.bind(this));
		},
		_removeRecentSearch: function( searchName, eventTarget){
			if(typeof searchName !== "string" || !searchName ){ //$NON-NLS-0$
				return;
			}
			this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(prefs) {  //$NON-NLS-1$ //$NON-NLS-0$
				var i;
				var searches = prefs.get("recentFind"); //$NON-NLS-0$
				if (typeof searches === "string") { //$NON-NLS-0$
					searches = JSON.parse(searches);
				}
				if (searches) {
					for (i in searches) {
						if (searches[i].name === searchName) {
							searches.splice(i, 1);
							this._storeRecentFind(searches, eventTarget, true);
							break;
						}
					}
				}
			}.bind(this));
		},
	    _initCompletion: function(searchStringInput) {
			if(this._completion){
				this._completion.setInputField(searchStringInput);
			} else { //Create the inputCompletion lazily.
				//Required. Reading recent&saved search from user preference. Once done call the uiCallback
				var defaultProposalProvider = function(uiCallback){
					this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(prefs) {  //$NON-NLS-1$ //$NON-NLS-0$
						var searches = prefs.get("recentFind"); //$NON-NLS-0$
						if (typeof searches === "string") { //$NON-NLS-0$
							searches = JSON.parse(searches);
						}
						if (searches) {
							var fullSet = [];
							searches.forEach(function(find) {
								fullSet.push({type: "proposal", label: find.name, value: find.name});//$NON-NLS-0$
							});
							uiCallback(fullSet);
						}
					});
				}.bind(this);
				//Create and hook up the inputCompletion instance with the search box dom node.
				//The defaultProposalProvider provides proposals from the recent and saved searches.
				//The exendedProposalProvider provides proposals from plugins.
				this._completion = new mInputCompletion.InputCompletion(searchStringInput, defaultProposalProvider, {serviceRegistry: this._serviceRegistry, group: "localSearch", //$NON-NLS-0$
					onDelete: function(item, evtTarget) {
						this._removeRecentSearch(item, evtTarget);
					}.bind(this),
					deleteToolTips: messages['DeleteSearchTrmMsg']
				});
	    	}
	    },
		_createButton: function(text, parent, callback) {
			var button  = document.createElement("button"); //$NON-NLS-0$
			button.addEventListener("click", callback.bind(this), false); //$NON-NLS-0$
			var self = this;
			button.addEventListener("keydown", function(e) { //$NON-NLS-0$
				if (e.keyCode === lib.KEY.ESCAPE) {
					self.hide();
				}
			});
			button.appendChild(document.createTextNode(text)); //$NON-NLS-0$
			button.className = "dismissButton parameterInlineButton"; //$NON-NLS-0$
			
			parent.appendChild(button);
		},
		_createInfoImage: function(text, parent, callback) {
			var image = document.createElement("img"); //$NON-NLS-0$
			image.classList.add("replaceInfo"); //$NON-NLS-0$
			image.addEventListener("click", function(e) { //$NON-NLS-0$
				this._regExBox.checked = !this._regex;
				this.setOptions({regex: !this._regex});
				this.find(true);
				this._showReplaceInfo();
			}.bind(this));
			parent.appendChild(image);
			return image;
		},
		_handleInput: function(evt){
			if (this._incremental) {
				this.find(true, null, true);
			}
			return true;
		},
		_handleKeyDown: function(evt){
			var ctrlKeyOnly = (this.isMac ? evt.metaKey : evt.ctrlKey) && !evt.altKey && !evt.shiftKey;
			if(ctrlKeyOnly && evt.keyCode === 70/*"f"*/ ) {
				if( evt.stopPropagation ) { 
					evt.stopPropagation(); 
				}
				evt.cancelBubble = true;
				return false;
			}
			//We can't use ctrlKeyOnly on "k" because ctrl+shift+k means find previous match when the find bar gets focus
			if(((this.isMac ? evt.metaKey : evt.ctrlKey) && !evt.altKey && evt.keyCode === 75/*"k"*/) || evt.keyCode === 13/*enter*/){
				if( evt.stopPropagation ) { 
					evt.stopPropagation(); 
				}
				evt.cancelBubble = true;
				this._addRecentfind(this.getFindString());
				if (evt.keyCode === 13) {
					this.find(this._reverse ? evt.shiftKey : !evt.shiftKey);
				} else {
					this.find(!evt.shiftKey);
				}
				return false;
			}
			if( ctrlKeyOnly &&  evt.keyCode === 82 /*"r"*/){
				if( evt.stopPropagation ) { 
					evt.stopPropagation(); 
				}
				evt.cancelBubble = true;
				this.replace();
				return false;
			}
			if( evt.keyCode === 27/*ESC*/ ){
				this.hide();
				return false;
			}
			return true;
		}
	});

	return {TextSearcher: TextSearcher};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 * program and the accompanying materials are made available under the terms of
 * the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 * and the Eclipse Distribution License v1.0
 * (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/editorCommands',[], function() {
	return {
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/edit/nls/messages',{
	root: {//Default message bundle
		"Editor": "Editor", //$NON-NLS-1$ //$NON-NLS-0$
		"switchEditor": "Switch Editor", //$NON-NLS-1$ //$NON-NLS-0$
		"Fetching": "Fetching: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"confirmUnsavedChanges": "There are unsaved changes. Do you still want to navigate away?", //$NON-NLS-1$ //$NON-NLS-0$
		"searchFiles": "Quick Search...", //$NON-NLS-1$ //$NON-NLS-0$
		"searchTerm": "Enter search term:", //$NON-NLS-1$ //$NON-NLS-0$
		"unsavedChanges": "There are unsaved changes.", //$NON-NLS-1$ //$NON-NLS-0$
		"unsavedAutoSaveChanges": "Please stay on the page until Auto Save is complete.", //$NON-NLS-1$ //$NON-NLS-0$
		"Save": "Save", //$NON-NLS-1$ //$NON-NLS-0$
		"Saved": "Saved", //$NON-NLS-1$ //$NON-NLS-0$
		"Blame": "Blame", //$NON-NLS-1$ //$NON-NLS-0$
		"BlameTooltip":"Show blame annotations", //$NON-NLS-1$ //$NON-NLS-0$
		"Diff": "Diff", //$NON-NLS-1$//$NON-NLS-0$
		"DiffTooltip":"Show diff annotations", //$NON-NLS-1$//$NON-NLS-0$
		"saveOutOfSync": "Resource is out of sync with the server. Do you want to save it anyway?", //$NON-NLS-1$ //$NON-NLS-0$
		"loadOutOfSync": "Resource is out of sync with the server. Do you want to load it anyway? This will overwrite your local changes.", //$NON-NLS-1$ //$NON-NLS-0$
		"ReadingMetadata": "Reading metadata of ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"ReadingMetadataError": "Cannot get metadata of ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"Reading": "Reading ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"readonly": "Read Only.", //$NON-NLS-1$ //$NON-NLS-0$
		"saveFile": "Save this file", //$NON-NLS-1$ //$NON-NLS-0$
		"toggleZoomRuler": "Toggle Zoom Ruler", //$NON-NLS-1$ //$NON-NLS-0$
		"gotoLine": "Go to line...", //$NON-NLS-1$ //$NON-NLS-0$
		"gotoLineTooltip": "Go to specified line number", //$NON-NLS-1$ //$NON-NLS-0$
		"gotoLinePrompt": "Go to line:", //$NON-NLS-1$ //$NON-NLS-0$
		"Undo": "Undo", //$NON-NLS-1$ //$NON-NLS-0$
		"Redo": "Redo", //$NON-NLS-1$ //$NON-NLS-0$
		"Find": "Find...", //$NON-NLS-1$ //$NON-NLS-0$
		"noResponse": "No response from server. Check your internet connection and try again.", //$NON-NLS-1$ //$NON-NLS-0$
		"savingFile": "Saving file ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"running": "Running ${0}", //$NON-NLS-1$ //$NON-NLS-0$
		"Saving..." : "Saving...", //$NON-NLS-1$ //$NON-NLS-0$
		"View": "View", //$NON-NLS-1$ //$NON-NLS-0$
		"SidePanel": "Side Panel", //$NON-NLS-1$ //$NON-NLS-0$
		"SidePanelTooltip": "Choose what to show in the side panel.", //$NON-NLS-1$ //$NON-NLS-0$
		"Slideout": "Slideout", //$NON-NLS-1$ //$NON-NLS-0$
		"Actions": "Actions", //$NON-NLS-1$ //$NON-NLS-0$
		"Navigator": "Navigator", //$NON-NLS-1$ //$NON-NLS-0$
		"FolderNavigator": "Folder Navigator", //$NON-NLS-1$ //$NON-NLS-0$
		"Project": "Project", //$NON-NLS-1$ //$NON-NLS-0$
		"New": "New", //$NON-NLS-1$ //$NON-NLS-0$
		"File": "File", //$NON-NLS-1$ //$NON-NLS-0$
		"Edit": "Edit", //$NON-NLS-1$ //$NON-NLS-0$
		"Tools": "Tools", //$NON-NLS-1$ //$NON-NLS-0$
		"Add": "Add", //$NON-NLS-1$ //$NON-NLS-0$
		"noActions": "There are no actions for the current selection.", //$NON-NLS-1$ //$NON-NLS-0$
		"NoFile": "Use the ${0} to create new files and folders. Click a file to start coding.", //$NON-NLS-1$ //$NON-NLS-0$
		"LocalEditorSettings": "Local Editor Settings", //$NON-NLS-1$ //$NON-NLS-0$
		"NoProject": "${0} is not a project. To convert it to a project use ${1}.", //$NON-NLS-1$ //$NON-NLS-0$
		"NoProjects": "There are no projects in your workspace. Use the ${0} menu to create projects.", //$NON-NLS-1$ //$NON-NLS-0$
		"Disconnected": "${0} (disconnected)", //$NON-NLS-1$ //$NON-NLS-0$
		"ChooseFS": "Choose Filesystem", //$NON-NLS-1$ //$NON-NLS-0$
		"ChooseFSTooltip": "Choose the filesystem you want to view.", //$NON-NLS-1$ //$NON-NLS-0$
		"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
		"Deploy": "Deploy", //$NON-NLS-1$ //$NON-NLS-0$
		"Deploy As": "Deploy As", //$NON-NLS-1$ //$NON-NLS-0$
		"Import": "Import", //$NON-NLS-1$ //$NON-NLS-0$
		"Export": "Export", //$NON-NLS-1$ //$NON-NLS-0$
		"OpenWith": "Open with", //$NON-NLS-1$ //$NON-NLS-0$
		"OpenRelated": "Open related", //$NON-NLS-1$ //$NON-NLS-0$
		"Dependency": "Dependency", //$NON-NLS-1$ //$NON-NLS-0$
		"UnnamedCommand": "Unnamed", //$NON-NLS-1$ //$NON-NLS-0$
		"searchInFolder": "Search in folder...",  //$NON-NLS-1$ //$NON-NLS-0$
		"Global Search": "Global Search...", //$NON-NLS-1$ //$NON-NLS-0$
		"ClickEditLabel": "Click to edit", //$NON-NLS-1$ //$NON-NLS-0$
		"ProjectInfo": "Project Information", //$NON-NLS-1$ //$NON-NLS-0$
		"DeployInfo": "Deployment Information", //$NON-NLS-1$ //$NON-NLS-0$
		"Name": "Name", //$NON-NLS-1$ //$NON-NLS-0$
		"Description": "Description", //$NON-NLS-1$ //$NON-NLS-0$
		"Site": "Site", //$NON-NLS-1$ //$NON-NLS-0$
		'projectsSectionTitle': 'Projects',  //$NON-NLS-0$  //$NON-NLS-1$
		'listingProjects': 'Listing projects...',  //$NON-NLS-0$  //$NON-NLS-1$
		'gettingWorkspaceInfo': 'Getting workspace information...',  //$NON-NLS-0$  //$NON-NLS-1$
		"showProblems": "Show problems...",  //$NON-NLS-1$ //$NON-NLS-0$
		"showTooltip": "Show Tooltip", //$NON-NLS-1$ //$NON-NLS-0$
		"showTooltipTooltip": "Shows the tooltip immediately based on the caret position" //$NON-NLS-1$ //$NON-NLS-0$
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/ja/messages',{
	"Editor": "エディター", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "エディターの切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "取り出し中: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "保存されていない変更があります。 このままナビゲートしますか?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "クイック検索...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "検索語を入力してください:", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "保存されていない変更があります。", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "自動保存が完了するまでこのページを開いておいてください。", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "保存", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "保存済み", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "変更履歴", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"変更履歴注釈の表示", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "リソースは、サーバーと同期がとれていません。 このまま保存しますか?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "リソースは、サーバーと同期がとれていません。 ロードしますか? この処理により、ローカルの変更内容が上書きされます。", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "${0} のメタデータの読み取り中", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "${0} のメタデータを取得できません", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "${0} の読み取り中です", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "読み取り専用", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "このファイルを保存", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "ズーム・ルーラーを切り替え", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "指定行へジャンプ...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "行番号を指定してジャンプ", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "移動先の行:", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "元に戻す", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "やり直し", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "検索...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "サーバーからの応答がありません。インターネット接続を確認してから、再試行してください。", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "ファイル ${0} を保存中", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "${0} を実行中", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "保存中...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "表示", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "サイド・パネル", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "サイド・パネルの表示内容を選択します。", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Slideout", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "アクション", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "ナビゲーター", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "フォルダー・ナビゲーター", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "プロジェクト", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "新規", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "ファイル", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "編集", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "ツール", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "追加", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "現在の選択項目に使用できるアクションはありません。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "新しいファイルやフォルダーを作成するには ${0} を使用してください。ファイルをクリックすると、コーディングが開始します。", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "ローカル・エディター設定", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} はプロジェクトではありません。プロジェクトに変換するには ${1} を使用してください。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "ワークスペースにプロジェクトがありません。${0} メニューを使用してプロジェクトを作成してください。", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (切断)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "ファイル・システムの選択", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "表示するファイル・システムを選択します。", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "デプロイ", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "形式を指定してデプロイ", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "インポート", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "エクスポート", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "アプリケーションから開く", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "関連項目を開く", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "依存関係", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "名前なし", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "フォルダー内で検索...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "グローバル・サーチ...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "編集するにはクリックします", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "プロジェクト情報", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "デプロイメント情報", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "名前", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "説明", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "サイト", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'プロジェクト',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'プロジェクトのリストを作成中...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'ワークスペース情報を取得中...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "問題を表示...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/zh/messages',{
	"Editor": "编辑器", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "切换编辑器", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "正在访存：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "存在未保存的更改。仍然要浏览吗？", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "快速搜索...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "输入搜索项：", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "存在未保存的更改。", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "请停留在该页面，直到完成“自动保存”为止。", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "保存", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "已保存", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "负责", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"显示负责注释", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "资源与服务器不同步。无论如何都要保存此资源吗？", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "资源与服务器不同步。无论如何都要将其装入吗？这将覆盖您在本地所作的更改。", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "正在读取 ${0} 的元数据", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "无法获取 ${0} 的元数据", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "正在读取 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "只读。", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "保存此文件", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "切换缩放标尺", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "转至行...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "转至所指定的行号", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "转至行：", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "撤销", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "重做", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "查找...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "服务器没有响应。请检查因特网连接，然后重试。", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "正在保存文件 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "正在运行 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "正在保存...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "查看", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "侧面板", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "选择要在侧面板中显示的内容。", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "滑出式", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "操作", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "导航器", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "文件夹导航器", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "项目", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "新建", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "文件", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "编辑", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "工具", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "添加", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "不存在对当前选择执行的操作。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "使用 ${0} 来创建新的文件和文件夹。单击文件以开始编码。", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "本地编辑器设置", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} 不是项目。要将其转换为项目，请使用 ${1}。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "工作空间中不存在项目。请使用${0}菜单来创建项目。", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0}（已断开连接）", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "选择文件系统", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "请选择您要查看的文件系统。", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "部署", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "部署方式", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "导入", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "导出", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "打开方式", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "打开相关项", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "依赖关系", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "未命名", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "在文件夹中搜索...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "全局搜索...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "单击此项以进行编辑", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "项目信息", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "部署信息", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "名称", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "描述", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "站点", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': '项目',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': '正在列示项目...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': '正在获取工作空间信息...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "显示问题...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/zh-tw/messages',{
	"Editor": "編輯器", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "切換編輯器", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "正在提取：${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "有未儲存的變更。您仍要離開嗎？", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "快速搜尋...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "輸入搜尋詞彙：", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "有未儲存的變更。", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "請停留在頁面上，直到「自動儲存」完成為止。", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "儲存", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "已儲存", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Blame", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"顯示 Blame 註釋", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "資源與伺服器不同步。 您仍要儲存嗎？", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "資源與伺服器不同步。 您還是要載入嗎？ 這會改寫您在本端所做的變更。", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "正在讀取 ${0} 的 meta 資料", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "無法取得 ${0} 的 meta 資料", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "正在讀取 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "唯讀。", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "儲存這個檔案", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "切換縮放尺規", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "移至行...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "移至指定的行號", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "移至行：", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "復原", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "重做", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "尋找...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "伺服器沒有回應。 請檢查網際網路連線，然後再試一次。", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "正在儲存 ${0} 檔", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "正在執行 ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "正在儲存...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "檢視", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "側邊畫面", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "選擇側邊畫面中要顯示的項目。", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "滑出", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "動作", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "導覽器", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "資料夾導覽器", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "專案", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "新建", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "檔案", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "編輯", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "工具", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "新增", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "現行選項沒有動作。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "使用 ${0} 來建立新的檔案與資料夾。 請按一下檔案，開始編碼。", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "本端編輯器設定", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} 不是專案。 如果要轉換成專案，請使用 ${1}。", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "您的工作區中沒有專案。 請使用${0}功能表來建立專案。", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0}（已斷線）", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "選擇檔案系統", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "選擇您想檢視的檔案系統。", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "部署", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "部署方式", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "匯入", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "匯出", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "開啟工具", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "開啟相關項目", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "相依關係", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "未命名", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "在資料夾中搜尋...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "廣域搜尋...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "按一下以編輯", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "專案資訊", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "部署資訊", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "名稱", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "說明", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "網站", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': '專案',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': '正在列出專案...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': '正在取得工作區資訊...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "顯示問題...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/fr/messages',{
	"Editor": "Editeur", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "Basculer vers un autre éditeur", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "Extraction : ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "Certains changements n'ont pas été sauvegardés. Voulez-vous toujours quitter ?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "Recherche rapide...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "Entrez le terme recherché :", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "Certaines modifications n'ont pas été sauvegardées.", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "Restez sur la page jusqu'à la fin de la sauvegarde automatique.", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "Sauvegarder", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "Sauvegardé", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Reproche", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"Afficher les annotations de reproche", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "Ressource non synchronisée avec le serveur. Voulez-vous la sauvegarder quand même ?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "Ressource non synchronisée avec le serveur. Voulez-vous la charger malgré tout ? Vous remplacerez vos modifications locales.", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "Lecture des métadonnées de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "Impossible d'obtenir les métadonnées de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "Lecture de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "Lecture seule.", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "Sauvegarder ce fichier", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "Activer/désactiver la règle de zoom", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Aller à la ligne...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "Accéder au numéro de ligne spécifié", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "Accéder à la ligne :", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "Annuler", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "Répéter", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "Rechercher...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "Aucune réponse du serveur. Vérifiez votre connexion Internet et essayez à nouveau.", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "Sauvegarde du fichier ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "Exécution de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "Sauvegarde...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "Vue", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "Panneau latéral", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "Sélectionner les éléments à afficher dans le panneau latéral.", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Glissement", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "Actions", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "Navigateur", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "Navigateur de dossiers", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "Projet", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "Nouveau", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "Fichier", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "Edition", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "Outils", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "Ajouter", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "Il n'existe aucune action pour la sélection en cours.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "Utilisez ${0} pour créer des fichiers et des dossiers. Cliquez sur un fichier pour commencer le codage.", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "Paramètres de l'éditeur local", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} n'est pas un projet. Pour le convertir en projet, utilisez ${1}.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "Il n'existe aucun projet dans votre espace de travail. Utilisez le menu ${0} pour créer des projets.", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (déconnecté)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "Sélectionner un système de fichiers", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "Sélectionnez le système de fichiers que vous voulez afficher.", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "Déployer", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "Déployer en tant que", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "Importer", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "Exporter", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "Ouvrir avec", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "Ouvrir un élément connexe", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "Dépendance", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "Sans nom", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "Rechercher dans un dossier...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "Recherche globale...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "Cliquez pour éditer", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "Informations du projet", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "Informations de déploiement", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "Nom", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "Description", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "Site", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'Projets',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'Listage des projets...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'Obtention d\'informations sur l\'espace de travail...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "Afficher les problèmes... ",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/de/messages',{
	"Editor": "Editor", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "Wechseleditor", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "${0} wird abgerufen", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "Nicht gespeicherte Änderungen vorhanden. Wollen Sie trotzdem zu einer anderen Position navigieren?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "Schnellsuche...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "Suchbegriff eingeben:", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "Nicht gespeicherte Änderungen vorhanden.", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "Verbleiben Sie so lange auf der Seite, bis der Vorgang der automatischen Speicherung beendet worden ist.", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "Speichern", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "Gespeichert", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Verantwortliche/r", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"Anmerkungen der Verantwortlichen anzeigen", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "Die Ressource ist nicht mit dem Server synchronisiert. Möchten Sie sie trotzdem speichern?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "Die Ressource ist nicht mit dem Server synchronisiert. Soll sie dennoch geladen werden? Ihre lokalen Änderungen werden hierdurch überschrieben.", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "Metadaten von ${0} werden gelesen", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "Metadaten von ${0} können nicht abgerufen werden", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "${0} wird gelesen", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "Schreibgeschützt.", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "Diese Datei speichern", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "Zoomskala ein-/ausschalten", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Gehe zu Zeile...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "Zu angegebener Zeilennummer springen", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "Zu Zeile springen:", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "Widerrufen", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "Widerruf zurücknehmen", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "Suchen von...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "Vom Server wurde keine Antwort erhalten. Überprüfen Sie Ihre Internetverbindung und wiederholen Sie die Operation.", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "Datei ${0} wird gespeichert", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "${0} wird ausgeführt", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "Speichervorgang wird ausgeführt...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "Ansicht", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "Seitenanzeige", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "Auswählen, was im seitlichen Fensterbereich angezeigt werden soll.", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Slideout", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "Aktionen", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "Navigator", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "Ordnernavigator", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "Projekt", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "Neu", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "Datei", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "Bearbeiten", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "Tools", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "Hinzufügen", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "Für die aktuelle Auswahl sind keine Aktionen vorhanden.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "Verwenden Sie ${0}, um neue Dateien und Ordner zu erstellen. Klicken Sie auf eine Datei, um mit der Codierung zu beginnen.", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "Lokale Einstellungen für Editor", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} ist kein Projekt. Verwenden Sie ${1}, um es in ein Projekt zu konvertieren.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "Ihr Arbeitsbereich enthält keine Projekte. Verwenden Sie das ${0}-Menü, um Projekte zu erstellen.", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (Verbindung getrennt)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "Dateisystem auswählen", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "Dateisystem auswählen, das angezeigt werden soll.", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "Bereitstellen", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "Bereitstellen als", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "Importieren", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "Exportieren", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "Öffnen mit", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "Zugehörige öffnen", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "Abhängigkeit", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "Nicht benannt", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "Suchen in Ordner...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "Globale Suche...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "Zum Bearbeiten klicken", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "Projektinformationen", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "Bereitstellungsinformationen", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "Name", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "Beschreibung", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "Site", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'Projekte',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'Projekte werden aufgelistet...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'Arbeitsbereichsinformationen werden abgerufen...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "Probleme anzeigen...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/it/messages',{
	"Editor": "Editor", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "Cambia editor", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "Richiamo dati: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "Esistono modifiche non salvate. Si desidera ancora navigare?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "Ricerca rapida...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "Immetti termine di ricerca:", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "Esistono modifiche non salvate.", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "Non cambiare pagina fino a quando il salvataggio automatico è completato.", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "Salva", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "Salvato", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Blame", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"Mostra annotazioni blame", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "La risorsa non è sincronizzata con il server. Si desidera salvarla comunque?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "La risorsa non è sincronizzata con il server. Si desidera caricarla comunque? Ciò sovrascriverà le modifiche locali.", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "Lettura di metadati di ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "Impossibile acquisire i metadati di ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "Lettura in corso ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "Sola lettura.", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "Salva questo file", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "Attiva/disattiva righello zoom", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Vai alla riga...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "Vai alla riga specificata", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "Vai alla riga:", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "Annulla", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "Riesegui", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "Trova...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "Nessuna risposta dal server. Controllare la connessione Internet e riprovare.", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "Salvataggio file ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "Esecuzione di ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "Salvataggio in corso...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "Vista", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "Pannello laterale", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "Scegliere cosa mostrare nel pannello laterale.", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Sfila", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "Azioni", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "Navigator", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "Navigator della cartella", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "Progetto", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "Nuovo", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "File", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "Modifica", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "Strumenti", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "Aggiungi", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "Non vi sono azioni per la selezione corrente.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "Utilizzare ${0} per creare nuovi file e cartelle. Fare clic su un file per avviare la codifica.", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "Impostazioni dell'editor locali", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} non è un progetto. Per convertirlo in un progetto utilizzare ${1}.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "Non vi sono progetti nel proprio spazio di lavoro. Utilizzare il menu ${0} per creare i progetti.", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (scollegato)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "Scegli filesystem", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "Scegliere il file system che si desidera visualizzare.", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "Distribuisci", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "Distribuisci come", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "Importa", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "Esporta", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "Apri con", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "Apri elemento correlato", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "Dipendenza", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "Senza nome", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "Ricerca nella cartella...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "Ricerca globale...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "Fare clic per modificare", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "Informazioni sul progetto", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "Informazioni sulla distribuzione", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "Nome", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "Descrizione", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "Sito", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'Progetti',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'Elenco dei progetti...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'Acquisizione informazioni sullo spazio di lavoro...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "Mostra problemi...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/es/messages',{
	"Editor": "Editor", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "Conmutar editor", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "Captando: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "Hay cambios no guardados. ¿Desea salir de todos modos?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "Búsqueda rápida...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "Especifique el término de búsqueda:", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "Hay cambios no guardados.", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "Permanezca en la página hasta que el Guardado automático haya finalizado.", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "Guardar", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "Guardado", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Culpa", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"Mostrar anotaciones de culpa", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "El recurso no está sincronizado con el servidor. ¿Desea guardarlo de todos modos?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "El recurso no está sincronizado con el servidor. ¿Desea cargarlo de todos modos? Se sobrescribirán los cambios locales.", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "Leyendo metadatos de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "No se pueden obtener los metadatos de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "Leyendo ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "Solo de lectura.", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "Guardar este archivo", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "Conmutar regla de zoom", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Ir a la línea...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "Ir al número de línea especificado", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "Ir a la línea:", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "Deshacer", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "Rehacer", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "Buscar...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "No hay respuesta del servidor. Compruebe la conexión de Internet e inténtelo de nuevo.", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "Guardando archivo ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "Ejecutando ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "Guardando...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "Ver", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "Panel lateral", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "Elija qué desea mostrar en el panel lateral.", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Deslizar", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "Acciones", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "Navegador", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "Navegador de carpeta", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "Proyecto", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "Nuevo", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "Archivo", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "Editar", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "Herramientas", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "Añadir", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "No hay acciones para la selección actual.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "Utilizar ${0} para crear nuevos archivos y carpetas. Pulse un archivo para iniciar la codificación.", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "Valores del editor local", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} no es un proyecto. Para convertirlo en un proyecto, utilice ${1}.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "No hay proyectos en el espacio de trabajo. Utilice el menú ${0} para crear proyectos.", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (desconectado)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "Elegir sistema de archivos", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "Elija el sistema de archivos que desea ver.", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "Desplegar", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "Desplegar como", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "Importar", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "Exportar", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "Abrir con", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "Abrir relacionado", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "Dependencia", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "Sin nombre", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "Buscar en carpeta...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "Búsqueda global...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "Pulse para editar", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "Información de proyecto", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "Información de despliegue", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "Nombre", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "Descripción", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "Sitio", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'Proyectos',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'Listando proyectos...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'Obteniendo información de espacio de trabajo...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "Mostrar problemas...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 ******************************************************************************/

/*eslint-env browser, amd*/
//NLS_CHARSET=UTF-8

define('orion/edit/nls/pt-br/messages',{
	"Editor": "Editor", //$NON-NLS-1$ //$NON-NLS-0$
	"switchEditor": "Alternar editor", //$NON-NLS-1$ //$NON-NLS-0$
	"Fetching": "Buscando: ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"confirmUnsavedChanges": "Há mudanças não salvas. Ainda deseja sair?", //$NON-NLS-1$ //$NON-NLS-0$
	"searchFiles": "Procura rápida...", //$NON-NLS-1$ //$NON-NLS-0$
	"searchTerm": "Inserir termo da procura:", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedChanges": "Há mudanças não salvas.", //$NON-NLS-1$ //$NON-NLS-0$
	"unsavedAutoSaveChanges": "Permaneça na página até que o Salvamento automático seja concluído.", //$NON-NLS-1$ //$NON-NLS-0$
	"Save": "Salvar", //$NON-NLS-1$ //$NON-NLS-0$
	"Saved": "Salvo", //$NON-NLS-1$ //$NON-NLS-0$
	"Blame": "Defeito", //$NON-NLS-1$ //$NON-NLS-0$
	"BlameTooltip":"Mostrar anotações de defeito", //$NON-NLS-1$ //$NON-NLS-0$
	"saveOutOfSync": "O recurso está fora de sincronização com o servidor. Deseja salvá-la de qualquer maneira?", //$NON-NLS-1$ //$NON-NLS-0$
	"loadOutOfSync": "O recurso está fora de sincronização com o servidor. Deseja carregá-lo de qualquer maneira? Isso sobrescreverá suas mudanças locais.", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadata": "Lendo metadados de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"ReadingMetadataError": "Não é possível obter metadados de ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Reading": "Lendo ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"readonly": "Somente leitura.", //$NON-NLS-1$ //$NON-NLS-0$
	"saveFile": "Salvar este arquivo", //$NON-NLS-1$ //$NON-NLS-0$
	"toggleZoomRuler": "Alternar régua de zoom", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLine": "Acessar linha...", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLineTooltip": "Acessar número de linha especificado", //$NON-NLS-1$ //$NON-NLS-0$
	"gotoLinePrompt": "Acessar linha:", //$NON-NLS-1$ //$NON-NLS-0$
	"Undo": "Desfazer", //$NON-NLS-1$ //$NON-NLS-0$
	"Redo": "Refazer", //$NON-NLS-1$ //$NON-NLS-0$
	"Find": "Localizar...", //$NON-NLS-1$ //$NON-NLS-0$
	"noResponse": "Nenhuma resposta do servidor. Verifique sua conexão de Internet e tente novamente.", //$NON-NLS-1$ //$NON-NLS-0$
	"savingFile": "Salvando arquivo ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"running": "Executando ${0}", //$NON-NLS-1$ //$NON-NLS-0$
	"Saving..." : "Salvando...", //$NON-NLS-1$ //$NON-NLS-0$
	"View": "Visualização", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanel": "Painel Lateral", //$NON-NLS-1$ //$NON-NLS-0$
	"SidePanelTooltip": "Escolha o que mostrar no painel lateral.", //$NON-NLS-1$ //$NON-NLS-0$
	"Slideout": "Deslizamento", //$NON-NLS-1$ //$NON-NLS-0$
	"Actions": "Ações", //$NON-NLS-1$ //$NON-NLS-0$
	"Navigator": "Navegador", //$NON-NLS-1$ //$NON-NLS-0$
	"FolderNavigator": "Navegador de pastas", //$NON-NLS-1$ //$NON-NLS-0$
	"Project": "Projeto", //$NON-NLS-1$ //$NON-NLS-0$
	"New": "Novo(a)", //$NON-NLS-1$ //$NON-NLS-0$
	"File": "Arquivo", //$NON-NLS-1$ //$NON-NLS-0$
	"Edit": "Editar", //$NON-NLS-1$ //$NON-NLS-0$
	"Tools": "Ferramentas", //$NON-NLS-1$ //$NON-NLS-0$
	"Add": "Incluir", //$NON-NLS-1$ //$NON-NLS-0$
	"noActions": "Não há ações para a seleção atual.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoFile": "Utilize o ${0} para criar novos arquivos e pastas. Clique em um arquivo para iniciar a codificação.", //$NON-NLS-1$ //$NON-NLS-0$
	"LocalEditorSettings": "Configurações do Editor Local", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProject": "${0} não é um projeto. Para convertê-lo em um projeto, use ${1}.", //$NON-NLS-1$ //$NON-NLS-0$
	"NoProjects": "Não há projetos na área de trabalho. Use o menu ${0} para criar projetos.", //$NON-NLS-1$ //$NON-NLS-0$
	"Disconnected": "${0} (desconectado)", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFS": "Escolher sistema de arquivos", //$NON-NLS-1$ //$NON-NLS-0$
	"ChooseFSTooltip": "Escolha o sistema de arquivos que deseja visualizar.", //$NON-NLS-1$ //$NON-NLS-0$
	"FSTitle": "${0} (${1})", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy": "Implementar", //$NON-NLS-1$ //$NON-NLS-0$
	"Deploy As": "Implementar como", //$NON-NLS-1$ //$NON-NLS-0$
	"Import": "Importar", //$NON-NLS-1$ //$NON-NLS-0$
	"Export": "Exportar", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenWith": "Abrir com", //$NON-NLS-1$ //$NON-NLS-0$
	"OpenRelated": "Abrir relacionado", //$NON-NLS-1$ //$NON-NLS-0$
	"Dependency": "Dependência", //$NON-NLS-1$ //$NON-NLS-0$
	"UnnamedCommand": "Não Denominado", //$NON-NLS-1$ //$NON-NLS-0$
	"searchInFolder": "Procurar na pasta...",  //$NON-NLS-1$ //$NON-NLS-0$
	"Global Search": "Procura global...", //$NON-NLS-1$ //$NON-NLS-0$
	"ClickEditLabel": "Clique para editar", //$NON-NLS-1$ //$NON-NLS-0$
	"ProjectInfo": "Informações sobre o Projeto", //$NON-NLS-1$ //$NON-NLS-0$
	"DeployInfo": "Informações de implementação", //$NON-NLS-1$ //$NON-NLS-0$
	"Name": "Nome", //$NON-NLS-1$ //$NON-NLS-0$
	"Description": "Descrição", //$NON-NLS-1$ //$NON-NLS-0$
	"Site": "Site", //$NON-NLS-1$ //$NON-NLS-0$
	'projectsSectionTitle': 'Projetos',  //$NON-NLS-0$  //$NON-NLS-1$
	'listingProjects': 'Listando projetos...',  //$NON-NLS-0$  //$NON-NLS-1$
	'gettingWorkspaceInfo': 'Obtendo informações da área de trabalho...',  //$NON-NLS-0$  //$NON-NLS-1$
	"showProblems": "Mostrar problemas...",  //$NON-NLS-1$ //$NON-NLS-0$
});


/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/explorers/navigationUtils',[], function() {
	var userAgent = navigator.userAgent;
	var isPad = userAgent.indexOf("iPad") !== -1; //$NON-NLS-0$
	
	/**
	 * Generate a grid navigation item into a given array. A grid navigation item is presented by a wrapper object wrapping the domNode. 
	 *
	 * @param {Array} domNodeWrapperList the array that holds the grid navigation item. Normally the .gridChildren property from a row model.
	 * @param {Element} element the html dom element representing a grid. Normally left or right arrow keys on the current row highlight the dom element.
	 *        When a grid is rendered, the caller has to decide what dom element can be passed. 
	 */
	 
	 
	function generateNavGrid(domNodeWrapperList, domNode, widget, onClick) {
		if(isPad){
			return;
		}
		if(!domNodeWrapperList){
			return;
		}
		domNodeWrapperList.push({domNode: domNode});
		domNode.style.outline = "none"; //$NON-NLS-0$
	}
                
	/**
	 * Add a grid navigation item to the navigation dictionary. A row navigation model normally comes from any node in a {treeModelIterator}.
	 * The .gridChildren property will be lazily created on the row model as an array where all the grid navigation items live.
	 *
	 * @param {ExplorerNavDict} navDict the dictionary that holds the info of all navigation info from model id.
	 * @param {object} rowModel the row model from the {treeModelIterator}.
	 * @param {Element} element the html dom element representing a grid. Normally left or right arrow keys on the current row highlight the dom element.
	 *        When a grid is rendered, the caller has to decide what dom element can be passed. 
	 */
	function addNavGrid(navDict, rowModel, domNode) {
		if(!navDict){
			return;
		}
		var navHolder = navDict.getGridNavHolder(rowModel, true);
		if(navHolder){
			generateNavGrid(navHolder, domNode);
		}
	}
	
	/**
	 * Remove a grid navigation item from a given array. A grid navigation item is presented by a wrapper object wrapping the domNode, widget and onClick properties. 
	 *
	 * @param {Array} domNodeWrapperList the array that holds the grid navigation item. Normally the .gridChildren property from a row model.
	 * @param {DomNode} domNode the html dom node representing a grid. Normally left or right arrow keys on the current row highlight the dom node.
	 *        When a grid is rendered, the caller has to decide what dom node can be passed. 
	 */
	function removeNavGrid(domNodeWrapperList, domNode) {
		if(!domNodeWrapperList){
			return;
		}
		
		for(var i = 0; i < domNodeWrapperList.length ; i++){
			if(domNodeWrapperList[i].domNode === domNode){
				domNodeWrapperList.splice(i, 1);
				return;
			}
		}
	}
	//return module exports
	return {
		addNavGrid: addNavGrid,
		generateNavGrid: generateNavGrid,
		removeNavGrid: removeNavGrid
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 * program and the accompanying materials are made available under the terms of
 * the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 * and the Eclipse Distribution License v1.0
 * (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/extensionCommands',[], function() {
	return {
		getOpenWithCommands: function() {
			return [];
		},
		getOpenWithCommand: function(commandService, item, openWithCommands) {
			return null;
		}
	};
});

/*******************************************************************************
 * Copyright (c) 2014 SAP AG and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *     SAP AG - initial API and implementation
 *******************************************************************************/
define('orion/xsrfUtils',[],function(){
	var XSRF_TOKEN = "x-csrf-token";//$NON-NLS-0$

	/**
	 * extracts value of xsrf cookie if available
	 */
	function getCSRFToken() {
		var cookies = document.cookie.split(";");//$NON-NLS-0$

		var i,n,v;
		for(i = 0; i<cookies.length; i++) {
			n = cookies[i].substr(0, cookies[i].indexOf("=")).trim();//$NON-NLS-0$
			v = cookies[i].substr(cookies[i].indexOf("=") + 1).trim();//$NON-NLS-0$

			if(n == XSRF_TOKEN) {
				return v;
			}
		}
	}

	/**
	 * adds xsrf nonce to header if set in cookies
	 * @param {Object} request header
	 */
	function setNonceHeader(headers) {
		var token = getCSRFToken();
		if (token) {
			headers[XSRF_TOKEN] = token;
		}
	}

	/**
	 * adds xsrf nonce to an XMLHTTPRequest object if set in cookies
	 * @param {Object} XMLHttpRequest object
	 */
	function addCSRFNonce(request) {
		var token = getCSRFToken();
		if(token) {
			request.setRequestHeader(XSRF_TOKEN, token);
		}
	}

	return {
		XSRF_TOKEN: XSRF_TOKEN,
		getCSRFToken: getCSRFToken,
		setNonceHeader: setNonceHeader,
		addCSRFNonce: addCSRFNonce
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/*global URL*/
/**
 * @name orion.xhr
 * @namespace Provides a promise-based API to {@link XMLHttpRequest}.
 */
define('orion/xhr',[
	'orion/Deferred',
	'orion/xsrfUtils',
	'orion/URL-shim', // no exports, must come last
], function(Deferred, xsrfUtils) {

	/**
	 * @name orion.xhr.Result
	 * @class Wraps an XHR response or failure.
	 * @property {Object} args Arguments passed to the {@link orion.xhr.xhr} call.
	 * @property {Object|ArrayBuffer|Blob|Document|String} response The <code>response</code> object returned by the XMLHttpRequest.
	 * It is typed according to the <code>responseType</code> passed to the XHR call (by default it is a {@link String}).
	 * @property {String} [responseText] The <code>response</code> returned by the XMLHttpRequest, if it is a {@link String}.
	 * If the <code>response</code> is not a String, this property is <code>null</code>.
	 * @property {Number} status The HTTP status code returned by the XMLHttpRequest.
	 * @property {String} url The URL that the XHR request was made to.
	 * @property {XMLHttpRequest} xhr The underlying XMLHttpRequest object.
	 * @property {String|Error} error <i>Optional</i>. If a timeout occurred or an error was thrown while performing the
	 * XMLHttpRequest, this field contains information about the error.
	 */

	/**
	 * @param {String} url
	 * @param {Object} options
	 * @param {XMLHttpRequest} xhr
	 * @param {String|Error} [error]
	 */
	function makeResult(url, options, xhr, error) {
		var response = typeof xhr.response !== 'undefined' ? xhr.response : xhr.responseText; //$NON-NLS-0$
		var responseText = typeof response === 'string' ? response : null; //$NON-NLS-0$
		var status;
		try {
			status = xhr.status;
		} catch (e) {
			status = 0;
		}
		var result = {
			args: options,
			response: response,
			responseText: responseText,
			status: status,
			url: url,
			xhr: xhr
		};
		if (typeof error !== 'undefined') { //$NON-NLS-0$
			result.error = error;
		}
		return result;
	}

	function isSameOrigin(url) {
		return new URL(location.href).origin === new URL(url, location.href).origin;
	}

	/**
	 * Wrapper for {@link XMLHttpRequest} that returns a promise.
	 * @name xhr
	 * @function
	 * @memberOf orion.xhr
	 * @param {String} method One of 'GET', 'POST', 'PUT', 'DELETE'.
	 * @param {String} url The URL to request.
	 * @param {Object} [options]
	 * @param {Object|ArrayBuffer|Blob|Document} [options.data] The raw data to send as the request body. (Only allowed for POST and PUT).
	 * @param {Object} [options.headers] A map of header names and values to set on the request.
	 * @param {Boolean} [options.log=false] If <code>true</code>, failed requests will be logged to the JavaScript console.
	 * @param {String} [options.responseType=''] Determines the type of the response object returned. Value must be one of the following:
	 * <ul><li><code>'arraybuffer'</code>
	 * <li><code>'blob'</code>
	 * <li><code>'document'</code>
	 * <li><code>'json'</code>
	 * <li><code>'text'</code>
	 * <li><code>''</code> (same as <code>'text'</code>)</ul>
	 * @param {Number} [options.timeout=0] Timeout in milliseconds. Defaults to 0 (no timeout).
	 * @returns {Deferred} A deferred for the result. The deferred will resolve on 2xx, 3xx status codes or reject on 4xx, 5xx status codes.
	 * In both cases a {@link orion.xhr.Result} is provided to the listener.
	 */
	// TODO: upload progress, user/password
	function _xhr(method, url, options/*, XMLHttpRequestImpl */) {
		options = options || {};
		var xhr = (arguments.length > 3 && arguments[3]) ? arguments[3] : new XMLHttpRequest(); //$NON-NLS-0$
		var d = new Deferred();
		var headers = options.headers || {};
		if (isSameOrigin(url)) {
			xsrfUtils.setNonceHeader(headers);
		}
		var log = options.log || false;
		var data;
		if (typeof headers['X-Requested-With'] === 'undefined') { //$NON-NLS-1$ //$NON-NLS-0$
			headers['X-Requested-With'] = 'XMLHttpRequest'; //$NON-NLS-1$ //$NON-NLS-0$
		}
		if (typeof options.data !== 'undefined' && (method === 'POST' || method === 'PUT')) { //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			data = options.data;
		}
		
		var cancelled = false;
		var aborted = false;
		d.promise.then(undefined, function(error) {
			cancelled = true;
			if (!aborted && error instanceof Error && error.name === "Cancel") {
				xhr.abort();
			}
		});
		
		xhr.onabort = function() {
			aborted = true;
			if (!cancelled) {
				var cancelError = new Error("Cancel");
				cancelError.name = "Cancel";
				d.reject(cancelError);
			}
		};
		xhr.onload = function() {
			var result = makeResult(url, options, xhr);
			if(200 <= xhr.status && xhr.status < 400) {
				d.resolve(result);
			} else {
				d.reject(result);
				if(log && typeof console !== 'undefined') { //$NON-NLS-0$
					console.log(new Error(xhr.statusText));
				}
			}
		};
		xhr.onerror = function() {
			var result = makeResult(url, options, xhr);
			d.reject(result);
			if (log && typeof console !== 'undefined') { //$NON-NLS-0$
				console.log(new Error(xhr.statusText));
			}
		};
		xhr.onprogress = function(progressEvent) {
			progressEvent.xhr = xhr;
			d.progress(progressEvent);
		};
	
		try {
			xhr.open(method, url, true /* async */);
			if (typeof options.responseType === 'string') { //$NON-NLS-0$
				xhr.responseType = options.responseType;
			}
			if (typeof options.timeout === 'number') { //$NON-NLS-0$
				if (typeof xhr.timeout === 'number') { //$NON-NLS-0$
					// Browser supports XHR timeout
					xhr.timeout = options.timeout;
					xhr.addEventListener('timeout', function(e) { //$NON-NLS-0$
						d.reject(makeResult(url, options, xhr, 'Timeout exceeded')); //$NON-NLS-0$
					});
				} else {
					// Use our own timer
					var timeoutId = setTimeout(function() {
						d.reject(makeResult(url, options, xhr, 'Timeout exceeded')); //$NON-NLS-0$
					}, options.timeout);
					d.promise.then(clearTimeout.bind(null, timeoutId), clearTimeout.bind(null, timeoutId));
				}
			}
			Object.keys(headers).forEach(function(key) {
				xhr.setRequestHeader(key, headers[key]);
			});
			xhr.send(data || null);
		} catch (e) {
			d.reject(makeResult(url, options, xhr, e));
		}

		return d.promise;
	}
	return _xhr;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others. 
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
/*global URL*/
define('orion/widgets/browse/commitInfoRenderer',[
	'orion/objects',
	"orion/URITemplate",
	'orion/webui/littlelib',
	'orion/xhr',
	'orion/URL-shim'
], function(objects, URITemplate, lib, xhr) {

	function _timeDifference(commitTimeStamp) {
		var currentDate = new Date();
		var commitDate = new Date(commitTimeStamp);
	    var difference = currentDate.getTime() - commitDate.getTime();
	    var yearDiff = Math.floor(difference/1000/60/60/24/365);
	    difference -= yearDiff*1000*60*60*24*365;
	    var monthDiff = Math.floor(difference/1000/60/60/24/30);
	    difference -= monthDiff*1000*60*60*24*30;
	    var daysDifference = Math.floor(difference/1000/60/60/24);
	    difference -= daysDifference*1000*60*60*24;
		var hoursDifference = Math.floor(difference/1000/60/60);
	    difference -= hoursDifference*1000*60*60;
	    var minutesDifference = Math.floor(difference/1000/60);
	    difference -= minutesDifference*1000*60;
	    var secondsDifference = Math.floor(difference/1000);
	    return {year: yearDiff, month: monthDiff, day: daysDifference, hour: hoursDifference, minute: minutesDifference, second: secondsDifference};
	}
	function _generateTimeString(number, singleTerm, term) {
		if(number > 0) {
			if(number === 1) {
				return singleTerm + " ";
			}
			return number + " " + term + " ";
		}
		return "";
	}
	function calculateTime(commitTimeStamp) {
		var diff = _timeDifference(commitTimeStamp);
		var yearStr = _generateTimeString(diff.year, "a year", "years");
		var monthStr = _generateTimeString(diff.month, "a month", "months");
		var dayStr = _generateTimeString(diff.day, "a day", "days");
		var hourStr = _generateTimeString(diff.hour, "an hour", "hours");
		var minuteStr = _generateTimeString(diff.minute, "a minute", "minutes");
		var disPlayStr = "";
		if(yearStr) {
			disPlayStr = diff.year > 0 ? yearStr : yearStr + monthStr;
		} else if(monthStr) {
			disPlayStr = diff.month > 0 ? monthStr : monthStr + dayStr;
		} else if(dayStr) {
			disPlayStr = diff.day > 0 ? dayStr : dayStr + hourStr;
		} else if(hourStr) {
			disPlayStr = diff.hour > 0 ? hourStr : hourStr + minuteStr;
		} else if(minuteStr) {
			disPlayStr = minuteStr;
		}
		if(disPlayStr) {
			return disPlayStr + "ago";
		}	
		return "Just now";	
	}
	/**
	 * @name orion.widgets.browse.CommitInfoRenderer
	 * @class Comit Info renderer.
	 * @description Renders a DIV with commit information.
	 * @name orion.browse.CommitInfoOptions
	 *
	 * @property {String|DOMElement} parent the parent element for the commit information, it can be either a DOM element or an ID for a DOM element.
	 * @property {Object} commitInfo the information object of a commit information.
	 *	{
	 *	   Author: {Name: "string", Email: "email@addre.ss", Date: milliseconds(integer) },
	 *	   Committer: {Name: "string", Email: "email@addre.ss", Date: milliseconds(integer) },
	 *	   Message: "string",
	 * 	   URL: "string",
	 * 	   AvatarURL: "string"
	 *	}
	 */

	function CommitInfoRenderer(params) {
		this._parentDomNode = lib.node(params.parent);//Required
		this._commitInfo = params.commitInfo;//Required
	}
	objects.mixin(CommitInfoRenderer.prototype, /** @lends orion.widgets.Filesystem.CommitInfoRenderer */ {
		destroy: function() {
		},
		_simpleMessage: function(maxLength) {
			var message = this._commitInfo.Message ? this._commitInfo.Message : "";
			if(message) {
				var arrayofMsg = message.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");		
				if(arrayofMsg && arrayofMsg.length > 0) {
					message = arrayofMsg[0];
				}
				if(maxLength > 10 && message.length > maxLength) {
					message = message.substring(0, maxLength-3) + "...";
				}
			}
			return message;
		},
		_generateMessageNode: function(message) {
			var messageNode;
			if(this._commitInfo.URL || this._commitInfo.SHA1) {
				messageNode = document.createElement("a"); //$NON-NLS-0$
				if(this._commitInfo.SHA1) {
					var commitURLBase = (new URL("commit", window.location.href)).href;
					commitURLBase = decodeURIComponent(commitURLBase);
					messageNode.href = new URITemplate(commitURLBase + "{/SHA1}").expand(this._commitInfo);
				} else {
					messageNode.href = this._commitInfo.URL;
				}
				messageNode.classList.add("commitInfolink"); //$NON-NLS-0$
				messageNode.appendChild(document.createTextNode(message));
			} else {
				messageNode = document.createElement("span"); //$NON-NLS-0$
				messageNode.appendChild(document.createTextNode(message));
			}
			return messageNode;
		},
		_requestPhotoURL: function(userId, avatarImage) {
			var _this = this;
			var relativeURL = "/manage/service/com.ibm.team.jazzhub.common.service.IPhotoService/getContributorPhotoURI";
			var absURL = new URL(relativeURL, window.location.href);
			absURL.query.set("contributorUserId", userId);
			var requestURL = absURL.href;
			xhr("GET", requestURL, {
				timeout: 15000
			}).then(function(result) {
				var photo = JSON.parse(result.response);
				avatarImage.src = photo.photoURI;
			}, function() { _this._useOtherPhotoURL(avatarImage);});
			
		},
		_useOtherPhotoURL: function(avatarImage) {
			if(this._commitInfo.AvatarURL) {
				avatarImage.src = this._commitInfo.AvatarURL;
			} else {
				avatarImage.src = "https://www.gravatar.com/avatar/?d=mm";
			}
		},
		renderSimple: function(maxWidth) {
			this._parentDomNode.appendChild(this._generateMessageNode(this._simpleMessage(maxWidth)));
		},
		render: function(commitLabel, showAvatar) {
			//var commitDate = this._commitInfo.Author && this._commitInfo.Author.Date ? new Date(this._commitInfo.Author.Date).toLocaleString() : "";
			var commitDate = this._commitInfo.Author && this._commitInfo.Author.Date ? calculateTime(this._commitInfo.Author.Date) : "";
			
			var message = this._simpleMessage(-1);
			var authorName = this._commitInfo.Author && this._commitInfo.Author.Name ? this._commitInfo.Author.Name : "";
			
			//Render the avatar or label
			var label = commitLabel;
			if(!label) {
				label = "Commit";
			}
			label = "Last " + label;
			if(showAvatar) {
				var avatarContainer = document.createElement("div");
				var avatarImage = new Image();//document.createElement("image");
				if(this._commitInfo.Author && this._commitInfo.Author.UserId) {
					this._requestPhotoURL(this._commitInfo.Author.UserId, avatarImage);
				} else {
					this._useOtherPhotoURL(avatarImage);
				}
				avatarImage.classList.add("commitInfoAvatar"); //$NON-NLS-0$
				avatarContainer.appendChild(avatarImage);
				this._parentDomNode.appendChild(avatarContainer);
			} else {
				var labelContainer = document.createElement("div");
				labelContainer.classList.add("commitInfoLabelContainer"); //$NON-NLS-0$
				labelContainer.appendChild(document.createTextNode(label.toUpperCase()));
				this._parentDomNode.appendChild(labelContainer);
			}
			
			//Render the message, author and date on the right of the avatar
			var messageContainer = document.createElement("div");
			messageContainer.classList.add("commitInfoMessageContainer"); //$NON-NLS-0$
			
			var authorNode = document.createElement("div");
			authorNode.classList.add("commitInfoAutorContainer"); //$NON-NLS-0$
			var fragment = document.createDocumentFragment();
			var nameLabel = document.createElement("span"); //$NON-NLS-0$
			nameLabel.appendChild(document.createTextNode(authorName)); //$NON-NLS-0$
			nameLabel.classList.add("navColumnBold"); //$NON-NLS-0$
			var segments;
			if(showAvatar) {
				var segLabel = document.createElement("span"); //$NON-NLS-0$
				segLabel.appendChild(document.createTextNode(label)); //$NON-NLS-0$
				segLabel.classList.add("navColumnBold"); //$NON-NLS-0$
				fragment.textContent = commitDate ? "${0} by ${1} " + commitDate +"." : "${0} by ${1}.";
				segments = [segLabel, nameLabel];
			} else {
				fragment.textContent = commitDate ? "by ${0} " + commitDate +"." : "by ${0}.";
				segments = [nameLabel];
			}
			lib.processDOMNodes(fragment, segments);
			authorNode.appendChild(fragment);
			messageContainer.appendChild(authorNode);
			
			var messageTextContainer = document.createElement("div");
			messageTextContainer.classList.add("commitInfoMessageTextContainer"); //$NON-NLS-0$
			messageTextContainer.appendChild(this._generateMessageNode(message));
			messageContainer.appendChild(messageTextContainer);

			this._parentDomNode.appendChild(messageContainer);
		}
	});

	return {CommitInfoRenderer: CommitInfoRenderer,
			calculateTime: calculateTime
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/contentTypes',[], function() {
	var SERVICE_ID = "orion.core.contentTypeRegistry"; //$NON-NLS-0$
	var EXTENSION_ID = "orion.core.contenttype"; //$NON-NLS-0$
	var OLD_EXTENSION_ID = "orion.file.contenttype"; // backwards compatibility //$NON-NLS-0$

	/**
	 * @name orion.core.ContentType
	 * @class Represents a content type known to Orion.
	 * @property {String} id Unique identifier of this ContentType.
	 * @property {String} name User-readable name of this ContentType.
	 * @property {String} extends Optional; Gives the ID of another ContentType that is this one's parent.
	 * @property {String[]} extension Optional; List of file extensions characterizing this ContentType. Extensions are not case-sensitive.
	 * @property {String[]} filename Optional; List of filenames characterizing this ContentType.
	 */

	function contains(array, item) {
		return array.indexOf(item) !== -1;
	}

	function isImage(contentType) {
		switch (contentType && contentType.id) {
			case "image/jpeg": //$NON-NLS-0$
			case "image/png": //$NON-NLS-0$
			case "image/gif": //$NON-NLS-0$
			case "image/ico": //$NON-NLS-0$
			case "image/tiff": //$NON-NLS-0$
			case "image/svg": //$NON-NLS-0$
				return true;
		}
		return false;
	}
	
	function isBinary(cType) {
		if(!cType) {
			return false;
		}
		return (cType.id === "application/octet-stream" || cType['extends'] === "application/octet-stream"); //$NON-NLS-0$ //$NON-NLS-1$ //$NON-NLS-2$
	}
	
	/**
	 * @name getFilenameContentType
	 * @description Return the best contentType match to the given filename or null if no match. Filename pattern checked first, then extension
	 * @param filename the filename to compare against contentTypes
	 * @param contentTypes the array of possible contentTypes to check
	 * @returns returns ContentType that is the best match or null
	 */
	function getFilenameContentType(/**String*/ filename, contentTypes) {
		if (typeof filename !== "string") { //$NON-NLS-0$
			return null;
		}
		
		var best = null;
		var current;
		
		var extStart = filename.indexOf('.'); //$NON-NLS-0$
		extStart++; // leading period not included in extension
		var extension = filename.substring(extStart).toLowerCase();
		
		// Check the most common cases, exact filename match or full extension match
		for (var i=0; i < contentTypes.length; i++) {
			current = contentTypes[i];
			if (current.filename.indexOf(filename) >= 0){
				best = current;
				break;
			}
			
			if (contains(current.extension, extension)){
				// A filename match is considered better than a perfect extension match
				best = current;
				continue;
			}
		}
		
		// Check the less common case where the filename contains periods (foo.bar.a.b check 'bar.a.b' then 'a.b' then 'b')
		if (!best){
			extStart = extension.indexOf('.'); //$NON-NLS-0$
			while (!best && extStart >= 0){
				extStart++; // leading period not included in extension
				extension = extension.substring(extStart);
				for (i=0; i < contentTypes.length; i++) {
					current = contentTypes[i];
					if (contains(current.extension, extension)){
						best = current;
						break;
					}
				}
				extStart = extension.indexOf('.'); //$NON-NLS-0$
			}
		}
		
		return best;		
	}

	function array(obj) {
		if (obj === null || typeof obj === "undefined") { return []; } //$NON-NLS-0$
			return (Array.isArray(obj)) ? obj : [obj];
		}

	function arrayLowerCase(obj) {
		return array(obj).map(function(str) { return String.prototype.toLowerCase.call(str); });
	}

	function process(contentTypeData) {
		return {
			id: contentTypeData.id,
			name: contentTypeData.name,
			image: contentTypeData.image,
			imageClass: contentTypeData.imageClass,
			"extends": contentTypeData["extends"], //$NON-NLS-1$ //$NON-NLS-0$
			extension: arrayLowerCase(contentTypeData.extension),
			filename: array(contentTypeData.filename)
		};
	}

	function buildMap(contentTypeDatas) {
		var map = Object.create(null);
		contentTypeDatas.map(process).forEach(function(contentType) {
			if (!Object.prototype.hasOwnProperty.call(map, contentType.id)) {
				map[contentType.id] = contentType;
			}
		});
		return map;
	}

	function buildMapFromServiceRegistry(serviceRegistry) {
		var serviceReferences = serviceRegistry.getServiceReferences(EXTENSION_ID).concat(
				serviceRegistry.getServiceReferences(OLD_EXTENSION_ID));
		var contentTypeDatas = [];
		for (var i=0; i < serviceReferences.length; i++) {
			var serviceRef = serviceReferences[i], types = array(serviceRef.getProperty("contentTypes")); //$NON-NLS-0$
			for (var j=0; j < types.length; j++) {
				contentTypeDatas.push(types[j]);
			}
		}
		return buildMap(contentTypeDatas);
	}

	/**
	 * @name orion.core.ContentTypeRegistry
	 * @class A service for querying {@link orion.core.ContentType}s.
	 * @description A registry that provides information about {@link orion.core.ContentType}s.
	 *
	 * <p>If a {@link orion.serviceregistry.ServiceRegistry} is available, clients should request the service with
	 * objectClass <code>"orion.core.contentTypeRegistry"</code> from the registry rather than instantiate this 
	 * class directly. This constructor is intended for use only by page initialization code.</p>
	 *
	 * @param {orion.serviceregistry.ServiceRegistry|orion.core.ContentType[]} dataSource The service registry
	 * to use for looking up available content types and for registering this ContentTypeRegistry.
	 * 
	 * <p>Alternatively, an array of ContentType data may be passed instead, which allows clients to use this
	 * ContentTypeRegistry without a service registry.</p>
	 */
	function ContentTypeRegistry(dataSource) {
		if (dataSource && dataSource.registerService) {
			this.serviceRegistry = dataSource;
			this.map = buildMapFromServiceRegistry(dataSource);
			dataSource.registerService(SERVICE_ID, this);
		} else if (Array.isArray(dataSource)) {
			this.serviceRegistry = null;
			this.map = buildMap(dataSource);
		} else {
			throw new Error("Invalid parameter"); //$NON-NLS-0$
		}
	}
	ContentTypeRegistry.prototype = /** @lends orion.core.ContentTypeRegistry.prototype */ {
		/**
		 * Gets all the ContentTypes in the registry.
		 * @returns {orion.core.ContentType[]} An array of all registered ContentTypes.
		 */
		getContentTypes: function() {
			var map = this.getContentTypesMap();
			var types = [];
			for (var type in map) {
				if (Object.prototype.hasOwnProperty.call(map, type)) {
					types.push(map[type]);
				}
			}
			return types;
		},
		/**
		 * Gets a map of all ContentTypes.
		 * @return {Object} A map whose keys are ContentType IDs and values are the {@link orion.core.ContentType} having that ID.
		 */
		getContentTypesMap: function() {
			return this.map;
		},
		/**
		 * Looks up the ContentType for a file or search result, given the metadata.
		 * @param {Object} fileMetadata Metadata for a file or search result.
		 * @returns {orion.core.ContentType} The ContentType for the file, or <code>null</code> if none could be found.
		 */
		getFileContentType: function(fileMetadata) {
			return getFilenameContentType(fileMetadata.Name, this.getContentTypes());
		},
		/**
		 * Looks up the ContentType, given a filename.
		 * @param {String} filename The filename.
		 * @returns {orion.core.ContentType} The ContentType for the file, or <code>null</code> if none could be found.
		 */
		getFilenameContentType: function(filename) {
			return getFilenameContentType(filename, this.getContentTypes());
		},
		/**
		 * Gets a ContentType by ID.
		 * @param {String} id The ContentType ID.
		 * @returns {orion.core.ContentType} The ContentType having the given ID, or <code>null</code>.
		 */
		getContentType: function(id) {
			return this.map[id] || null;
		},
		/**
		 * Determines whether a ContentType is an extension of another.
		 * @param {orion.core.ContentType|String} contentTypeA ContentType or ContentType ID.
		 * @param {orion.core.ContentType|String} contentTypeB ContentType or ContentType ID.
		 * @returns {Boolean} Returns <code>true</code> if <code>contentTypeA</code> equals <code>contentTypeB</code>,
		 *  or <code>contentTypeA</code> descends from <code>contentTypeB</code>.
		 */
		isExtensionOf: function(contentTypeA, contentTypeB) {
			contentTypeA = (typeof contentTypeA === "string") ? this.getContentType(contentTypeA) : contentTypeA; //$NON-NLS-0$
			contentTypeB = (typeof contentTypeB === "string") ? this.getContentType(contentTypeB) : contentTypeB; //$NON-NLS-0$
			if (!contentTypeA || !contentTypeB) { return false; }
			if (contentTypeA.id === contentTypeB.id) { return true; }
			else {
				var parent = contentTypeA, seen = {};
				while (parent && (parent = this.getContentType(parent['extends']))) { //$NON-NLS-0$
					if (parent.id === contentTypeB.id) { return true; }
					if (seen[parent.id]) { throw new Error("Cycle: " + parent.id); } //$NON-NLS-0$
					seen[parent.id] = true;
				}
			}
			return false;
		},
		/**
		 * Similar to {@link #isExtensionOf}, but works on an array of contentTypes.
		 * @param {orion.core.ContentType|String} contentType ContentType or ContentType ID.
		 * @param {orion.core.ContentType[]|String[]} contentTypes Array of ContentTypes or ContentType IDs.
		 * @returns {Boolean} <code>true</code> if <code>contentType</code> equals or descends from any of the
		 * ContentTypes in <code>contentTypes</code>.
		 */
		isSomeExtensionOf: function(contentType, contentTypes) {
			for (var i=0; i < contentTypes.length; i++) {
				if (this.isExtensionOf(contentType, contentTypes[i])) {
					return true;
				}
			}
			return false;
		}
	};
	return {
		ContentTypeRegistry: ContentTypeRegistry,
		isImage: isImage,
		isBinary: isBinary,
		getFilenameContentType: getFilenameContentType
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/explorers/navigatorRenderer',[
	'i18n!orion/navigate/nls/messages',
	'orion/Deferred',
	'orion/explorers/explorer',
	'orion/explorers/navigationUtils',
	'orion/extensionCommands',
	'orion/objects',
	'orion/URITemplate',
	'orion/widgets/browse/commitInfoRenderer',
	'orion/contentTypes',
	'orion/webui/littlelib'
], function(messages, Deferred, mExplorer, mNavUtils, mExtensionCommands, objects, URITemplate, mCommitInfoRenderer, mContentTypes, lib) {
		
	var max_more_info_column_length = 60;
	/* Internal */
	function addImageToLink(contentType, link, location, replace) {
		var image;
		if (contentType) {
			var imageClass = contentType.imageClass, imageURL = contentType.image;
			if (imageClass) {
				image = document.createElement("span"); //$NON-NLS-0$
				image.className += imageClass; // may be several classes in here
				image.classList.add("thumbnail"); //$NON-NLS-0$
			} else if (imageURL) {
				image = document.createElement("img"); //$NON-NLS-0$
				image.src = imageURL;
				// to minimize the height/width in case of a large one
				image.classList.add("thumbnail"); //$NON-NLS-0$
			}
			if (image) {
				link.replaceChild(image, replace);
			}
		}
		return image ? image : replace;
	}
	
	var uriTemplate = new URITemplate("#{,resource,params*}"); //$NON-NLS-0$
	
	var clickedItem;
	/**
	 * Returns the last item clicked by links created with #createLink.
	 * @name orion.explorer.NavigatorRenderer.getClickedItem
	 * @function
	 */
	function getClickedItem() {
		return clickedItem;
	}
		
	/**
	 * Exported so that it can be used by other UI that wants to use navigator-style links. commandService and contentTypeService  are necessary to compute 
	 * the proper editor for a file.
	 * @name orion.explorer.NavigatorRenderer.createLink
	 * @function
	 * @param {String} folderPageURL the page you want to direct folders to (such as navigator).  Using a blank string will just hash the current page.
	 * @param {Object} item a json object describing an Orion file or folder
	 * @param {Object} commandService necessary to compute the proper editor for a file. Must be a synchronous, in-page service, not retrieved 
	 * from the service registry.
	 * @param {Object[]} [openWithCommands] The "open with" commands used to generate link hrefs. If this parameter is not provided, the caller must
	 * have already processed the service extension and added to the command registry (usually by calling {@link orion.extensionCommands.createAndPlaceFileCommandsExtension}).
	 * @param {Object} [linkProperties] gives additional properties to mix in to the HTML anchor element.
	 * @param {Object} [uriParams] A map giving additional parameters that will be provided to the URI template that generates the href.
	 * @param {Object} [separateImageHolder] Separate image holder object. {holderDom: dom}. If separateImageHolder is not defined, the file icon image is rendered in the link as the first child.
	 * @param {NavigatorRenderer} [renderer] The renderer object. Optional. If defined, renderer.updateFileNode() is called to update the file element for sub classes.
	 * If separateImageHolder is defined with holderDom property, the file icon iamge is rendered in separateImageHolder.holderDom.
	 * IF separateImageHolder is defined as an empty object, {}, the file icon iamge is not rendered at all.
	 */
	function createLink(folderPageURL, item, commandService, contentTypeService, openWithCommands, linkProperties, uriParams, separateImageHolder, renderer) {
		// TODO FIXME folderPageURL is bad; need to use URITemplates here.
		// TODO FIXME refactor the async href calculation portion of this function into a separate function, for clients who do not want the <A> created.
		item = objects.clone(item);
		var link;
		if (item.Directory) {
			link = document.createElement("a"); //$NON-NLS-0$
			link.className = "navlinkonpage"; //$NON-NLS-0$
			var template = !folderPageURL ? uriTemplate : new URITemplate(folderPageURL + "#{,resource,params*}"); //$NON-NLS-0$
			link.href = template.expand({resource: item.ChildrenLocation});
			if(item.Name){
				link.appendChild(document.createTextNode(item.Name));
			}
		} else {
			if (!openWithCommands) {
				openWithCommands = mExtensionCommands.getOpenWithCommands(commandService);
			}
			link = document.createElement("a"); //$NON-NLS-0$
			link.className= "navlink targetSelector"; //$NON-NLS-0$
			if (linkProperties && typeof linkProperties === "object") { //$NON-NLS-0$
				Object.keys(linkProperties).forEach(function(property) {
					link[property] = linkProperties[property];
				});
			}
			var imageHolderDom = null, image = null;
			if(separateImageHolder) {
				imageHolderDom = separateImageHolder.holderDom;
			} else {
				imageHolderDom = link;
			}
			if(imageHolderDom) {
				image = document.createElement("span"); //$NON-NLS-0$
				image.className = "core-sprite-file modelDecorationSprite thumbnail"; //$NON-NLS-0$
				imageHolderDom.appendChild(image);
			}
			if(item.Name){
				link.appendChild(document.createTextNode(item.Name));
			}
			var href = item.Location;
			if (uriParams && typeof uriParams === "object") { //$NON-NLS-0$
				item.params = {};
				objects.mixin(item.params, uriParams);
			}
			var openWithCommand = mExtensionCommands.getOpenWithCommand(commandService, item, openWithCommands);
			if (openWithCommand) {
				href = openWithCommand.hrefCallback({items: item});
			}
			Deferred.when(contentTypeService.getFileContentType(item), function(contentType) {
				var iconElement;
				if(imageHolderDom) {
					iconElement = addImageToLink(contentType, imageHolderDom, item.Location, image);
				}
				link.href = href;
				if(renderer && typeof renderer.updateFileNode === 'function') { //$NON-NLS-0$
					renderer.updateFileNode(item, link, mContentTypes.isImage(contentType), iconElement);
				}
			});
		}
		link.addEventListener("click", function() { //$NON-NLS-0$
			clickedItem = item;
		}.bind(this), false);
		return link;
	}
		
	/**
	 * @name orion.explorer.NavigatorRenderer
	 * @class Renderer for a tree-table of files, like the Orion Navigator.
	 * @description Renderer for a tree-table of files, like the Orion Navigator.
	 * @param {Object} options
	 * @param {orion.explorer.Explorer} explorer
	 * @param {orion.commandregistry.CommandRegistry} commandRegistry
	 * @param {orion.core.ContentTypeRegistry} contentTypeService
	 */
	function NavigatorRenderer (options, explorer, commandService, contentTypeService) {
		this.explorer = explorer;
		this.commandService = commandService;
		this.contentTypeService = contentTypeService;
		this.openWithCommands = null;
		this.actionScopeId = options.actionScopeId;
		
		this._init(options);
	}
	NavigatorRenderer.prototype = new mExplorer.SelectionRenderer(); 

	NavigatorRenderer.prototype.wrapperCallback = function(wrapperElement) {
		wrapperElement.setAttribute("role", "tree"); //$NON-NLS-1$ //$NON-NLS-0$
	};

	NavigatorRenderer.prototype.tableCallback = function(tableElement) {
		tableElement.setAttribute("aria-label", messages["Navigator"]); //$NON-NLS-1$ //$NON-NLS-0$
		tableElement.setAttribute("role", "presentation"); //$NON-NLS-1$ //$NON-NLS-0$
	};

	/**
	 * @param {Element} rowElement
	 */
	NavigatorRenderer.prototype.rowCallback = function(rowElement, model) {
		rowElement.setAttribute("role", "treeitem"); //$NON-NLS-1$ //$NON-NLS-0$
	};
	
	
	/**
	 * @param {Element} bodyElement
	 */
	NavigatorRenderer.prototype.emptyCallback = function(bodyElement) {
		var tr = document.createElement("tr"); //$NON-NLS-0$
		var td = document.createElement("td"); //$NON-NLS-0$
		td.colSpan = this.oneColumn ? 1 : 3;
		var noFile = document.createElement("div"); //$NON-NLS-0$
		noFile.classList.add("noFile"); //$NON-NLS-0$
		noFile.textContent = messages["NoFile"];
		var plusIcon = document.createElement("span"); //$NON-NLS-0$
		plusIcon.appendChild(document.createTextNode(messages["File"]));
		lib.processDOMNodes(noFile, [plusIcon]);
		td.appendChild(noFile);
		tr.appendChild(td);
		bodyElement.appendChild(tr);
	};

	/**
	 * @param {int|string} the local time stamp
	 */
	NavigatorRenderer.prototype.getDisplayTime = function(timeStamp) {
		return new Date(timeStamp).toLocaleString();
	};
	
	/**
	 * @param {Element} parent the parent dom where the commit info is rendered
	 * @param {Object} commitInfo the commit info
	 */
	NavigatorRenderer.prototype.getCommitRenderer = function(parent, commitInfo) {
		return new mCommitInfoRenderer.CommitInfoRenderer({parent: parent, commitInfo: commitInfo});
	};
	
	/**
	 * Creates the column header element. We are really only using the header for a spacer at this point.
	 * @name orion.explorer.NavigatorRenderer.prototype.getCellHeaderElement
	 * @function
	 * @returns {Element}
	 */
	NavigatorRenderer.prototype.getCellHeaderElement = function(col_no){
		// TODO see https://bugs.eclipse.org/bugs/show_bug.cgi?id=400121
		if (this.oneColumn && col_no !== 0) {
			return null;
		}

		switch(col_no){
		case 0:
		case 1:
		case 2:
			var th = document.createElement("th"); //$NON-NLS-0$
			th.style.height = "8px"; //$NON-NLS-0$
		}
	};
		
	/**
	 * Creates a image DOM Element for the specified folder.
	 * @name orion.explorer.NavigatorRenderer#getFolderImage
	 * @type {Function}
	 * @param {Object} folder The folder to create an image for.
	 * @returns {Element} The folder image element.
	 */
	NavigatorRenderer.prototype.getFolderImage = function(folder) {
		if (!this.showFolderImage) {
			return null;
		}
		var span = document.createElement("span"); //$NON-NLS-0$
		span.className = "core-sprite-folder modelDecorationSprite"; //$NON-NLS-0$
		return span;
	};

	/**
	* Subclasses can override this function to customize the DOM Element that is created to represent a folder.
	 * The default implementation creates either a hyperlink or a plain text node.
	 * @name orion.explorer.NavigatorRenderer#createFolderNode
	 * @type {Function}
	 * @see orion.explorer.NavigatorRenderer#showFolderLinks
	 * @see orion.explorer.NavigatorRenderer#folderLink
	 * @param {Object} folder The folder to create a node for.
	 * @returns {Element} The folder element.
	 */
	// The returned element must have an <code>id</code> property.
	NavigatorRenderer.prototype.createFolderNode = function(folder) {
		var itemNode;
		if (this.showFolderLinks) { //$NON-NLS-0$
			// TODO see https://bugs.eclipse.org/bugs/show_bug.cgi?id=400121
			itemNode = createLink(this.folderLink || "", folder, this.commandService, this.contentTypeService); //$NON-NLS-0$
			var image = this.getFolderImage(folder);
			if (image) {
				itemNode.insertBefore(image, itemNode.firstChild);
			}
		} else {
			itemNode = document.createElement("span"); //$NON-NLS-0$
			itemNode.textContent = folder.Name;
		}
		return itemNode;
	};

	/**
	* Subclasses can override this function to customize the DOM Element that is created to represent a file.
	 * The default implementation does nothing.
	 * @name orion.explorer.NavigatorRenderer#updateFileNode
	 * @type {Function}
	 * @param {Object} file The file model to update for.
	 * @param {Element} fileNode The file node to update.
	 * @param {Boolean} isImage The flag to indicate if the file is an image file.
	 */
	// The returned element must have an <code>id</code> property.
	NavigatorRenderer.prototype.updateFileNode = function(file, fileNode, isImage) {
	};

	/**
	 * Whether the default implementation of {@link #createFolderNode} should show folders should as links (<code>true</code>),
	 * or just plain text (<code>false</code>).
	 * @name orion.explorer.NavigatorRenderer#showFolderLinks
	 * @type {Boolean}
	 * @default true
	 */
	NavigatorRenderer.prototype.showFolderLinks = true;
	/**
	 * Gives the base href to be used by the default implementation of {@link #createFolderNode} for creating folder links.
	 * This property only takes effect if {@link #showFolderLinks} is <code>true</code>. 
	 * TODO see <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=400121">Bug 400121</a>
	 * @name orion.explorer.NavigatorRenderer#folderLink
	 * @type {String}
	 * @default ""
	 */
	/**
	 * Generate the DOM element for a cell. If you override this function, you will most likely have to override {@link orion.explorers.FileExplorer#getNameNode}
	 * in your explorer class.
	 * @name orion.explorer.NavigatorRenderer#getCellElement
	 * @function
	 * @returns {Element}
	 */
	NavigatorRenderer.prototype.getCellElement = function(col_no, item, tableRow){
		var timeStampCase = item.LastCommit ? 2 : 1;
		var sizeCase = item.LastCommit ? 3 : 2;
		var commitCase = item.LastCommit ? 1 : -1;
		switch(col_no){
		case 0:
			var col = document.createElement('td'); //$NON-NLS-0$
			var span = document.createElement("span"); //$NON-NLS-0$
			span.id = tableRow.id+"MainCol"; //$NON-NLS-0$
			span.setAttribute("role", "presentation"); //$NON-NLS-1$ //$NON-NLS-0$
			col.appendChild(span);
			col.setAttribute("role", "presentation"); //$NON-NLS-1$ //$NON-NLS-0$
			span.className = "mainNavColumn"; //$NON-NLS-0$
			var itemNode;
			if (item.Directory) {
				// defined in ExplorerRenderer.  Sets up the expand/collapse behavior
				this.getExpandImage(tableRow, span);
				itemNode = this.createFolderNode(item);

				span.appendChild(itemNode);
				this.explorer._makeDropTarget(item, itemNode);
				this.explorer._makeDropTarget(item, tableRow);
			} else {
				if (!this.openWithCommands) {
					this.openWithCommands = mExtensionCommands.getOpenWithCommands(this.commandService);
				}
				itemNode = createLink("", item, this.commandService, this.contentTypeService, this.openWithCommands, null, null, null, this);
				span.appendChild(itemNode); //$NON-NLS-0$
			}
			if (itemNode) {
				// orion.explorers.FileExplorer#getNameNode
				itemNode.id = tableRow.id + "NameLink"; //$NON-NLS-0$
				if (itemNode.nodeType === 1) {
					mNavUtils.addNavGrid(this.explorer.getNavDict(), item, itemNode);
					itemNode.setAttribute("role", "link"); //$NON-NLS-1$ //$NON-NLS-0$
					itemNode.setAttribute("tabindex", "-1"); //$NON-NLS-1$ //$NON-NLS-0$
				}
			}
			// render any inline commands that are present.
			if (this.actionScopeId) {
				this.commandService.renderCommands(this.actionScopeId, span, item, this.explorer, "tool", null, true); //$NON-NLS-0$
			}
			return col;
		case timeStampCase:
			// TODO see https://bugs.eclipse.org/bugs/show_bug.cgi?id=400121
			if (this.oneColumn) {
				return null;
			}
			var dateColumn = document.createElement('td'); //$NON-NLS-0$
			if (item.LocalTimeStamp) {
				dateColumn.textContent = this.getDisplayTime(item.LocalTimeStamp);
			}
			return dateColumn;
		case sizeCase:
			// TODO see https://bugs.eclipse.org/bugs/show_bug.cgi?id=400121
			if (this.oneColumn) {
				return null;
			}
			var sizeColumn = document.createElement('td'); //$NON-NLS-0$
			if (!item.Directory && typeof item.Length === "number") { //$NON-NLS-0$
				var length = parseInt(item.Length, 10),
					kb = length / 1024;
				sizeColumn.textContent = Math.ceil(kb).toLocaleString() + " KB"; //$NON-NLS-0$
			}
			sizeColumn.style.textAlign = "right"; //$NON-NLS-0$
			return sizeColumn;
		case commitCase:// LastCommit field is optional. For file services that dod not return this properties, we do not have to render this column.
			if (this.oneColumn || !item.LastCommit) {
				return null;
			}
			var messageColumn = document.createElement('td'); //$NON-NLS-0$
			this.getCommitRenderer(messageColumn, item.LastCommit).renderSimple(max_more_info_column_length);
			return messageColumn;
		}
	};
	NavigatorRenderer.prototype.constructor = NavigatorRenderer;
	
	//return module exports
	return {
		NavigatorRenderer: NavigatorRenderer,
		getClickedItem: getClickedItem,
		createLink: createLink
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/

/*eslint-env browser, amd*/
define('orion/inputManager',[
	'i18n!orion/edit/nls/messages',
	'orion/explorers/navigatorRenderer',
	'orion/i18nUtil',
	'orion/Deferred',
	'orion/EventTarget',
	'orion/objects',
	'orion/PageUtil',
	'orion/metrics'
], function(messages, mNavigatorRenderer, i18nUtil, Deferred, EventTarget, objects, PageUtil, mMetrics) {

	function Idle(options){
		this._document = options.document || document;
		this._timeout = options.timeout;
		//TODO: remove listeners if there are no clients
		//TODO: add support for multiple clients with different timeouts
		var events = ["keypress","keydown","keyup"]; //$NON-NLS-0$ //$NON-NLS-1$ //$NON-NLS-2$
		var reset = function (e) { this._resetTimer(); }.bind(this);
		for (var i = 0; i < events.length; i++) {
			var event = events[i];
			this._document.addEventListener(event, reset, true);
		}
		EventTarget.attach(this);
	}

	Idle.prototype = {
		_resetTimer: function() {
			var window = this._document.defaultView || this._document.parentWindow;
			if (this._timer) {
				window.clearTimeout(this._timer);
				this._timer = null;
			}
			if (this._timeout !== -1) {
				this._timer = window.setTimeout(function() {
					this.onIdle({type:"Idle"});	//$NON-NLS-0$
					this._timer = null;
					this._resetTimer();
				}.bind(this), this._timeout);
			}
		},
		onIdle: function (idleEvent) {
			return this.dispatchEvent(idleEvent);
		},
		setTimeout: function(timeout) {
			this._timeout = timeout;
			this._resetTimer();
		}
	};

	function _makeError(error) {
		var newError = {
			Severity: "Error", //$NON-NLS-0$
			Message: messages.noResponse
		};
		if(error.name === "Cancel") {
			return {Severity: "Warning", Message: error.name, Cancel: true};
		} else if (error.status === 0) {
			newError.Cancel = true;
			return newError; // might do better here
		} else if (error.responseText) {
			var responseText = error.responseText;
			try {
				var parsedError = JSON.parse(responseText);
				newError.Severity = parsedError.Severity || newError.Severity;
				newError.Message = parsedError.Message || newError.Message;
			} catch (e) {
				newError.Message = responseText;
			}
		} else {
			try {
				newError.Message = JSON.stringify(error);
			} catch (e) {
				// best effort - fallthrough
			}
		}
		return newError;
	}

	function handleError(statusService, error) {
		if (!statusService) {
			window.console.log(error);
			return;
		}
		if (!error.Severity) {
			error = _makeError(error);
		}
		statusService.setProgressResult(error);
		return error;
	}

	/**
	 * @name orion.editor.InputManager
	 * @class
	 */
	function InputManager(options) {
		EventTarget.attach(this);
		this.serviceRegistry = options.serviceRegistry;
		this.statusService = options.statusService;
		this.fileClient = options.fileClient;
		this.progressService = options.progressService;
		this.contentTypeRegistry = options.contentTypeRegistry;
		this.selection = options.selection;
		this._input = this._title = "";
		this.dispatcher = null;
		this._unsavedChanges = [];
	}
	objects.mixin(InputManager.prototype, /** @lends orion.editor.InputManager.prototype */ {
		/**
		 * @returns {orion.Promise} Promise resolving to the new Location we should use
		 */
		_maybeLoadWorkspace: function(resource) {
			var fileClient = this.fileClient;
			// If it appears to be a workspaceRootURL we cannot load it directly, have to get the workspace first
			if (resource === fileClient.fileServiceRootURL(resource)) {
				return fileClient.loadWorkspace(resource).then(function(workspace) {
					return workspace.Location;
				});
			}
			return new Deferred().resolve(resource);
		},
		/**
		 * Wrapper for fileClient.read() that tolerates a filesystem root URL passed as location. If location is indeed
		 * a filesystem root URL, the original read() operation is instead performed on the workspace.
		 */
		_read: function(location /**, readArgs*/) {
			var cachedMetadata = this.cachedMetadata || mNavigatorRenderer.getClickedItem();
			if (cachedMetadata && cachedMetadata.Location === location &&
				cachedMetadata.Parents && cachedMetadata.Attributes &&
				cachedMetadata.ETag
			) {
				return new Deferred().resolve(cachedMetadata);
			}
			var fileClient = this.fileClient;
			var readArgs = Array.prototype.slice.call(arguments, 1);
			return this._maybeLoadWorkspace(location).then(function(newLocation) {
				return fileClient.read.apply(fileClient, [newLocation].concat(readArgs));
			});
		},
		load: function() {
			var fileURI = this.getInput();
			if (!fileURI) { return; }
			var fileClient = this.fileClient;
			var resource = this._parsedLocation.resource;
			var progressService = this.progressService;
			var progress = function(deferred, msgKey, uri) {
				if (!progressService) { return deferred; }
				return progressService.progress(deferred, i18nUtil.formatMessage(msgKey, uri));
			};
			var editor = this.getEditor();
			if (this._fileMetadata) {
				//Reload if out of sync, unless we are already in the process of saving
				if (!this._saving && !this._fileMetadata.Directory && !this._readonly) {
					progress(fileClient.read(resource, true), messages.ReadingMetadata, fileURI).then(function(data) {
						if (this._fileMetadata && this._fileMetadata.Location === data.Location && this._fileMetadata.ETag !== data.ETag) {
							this._fileMetadata = data;
							if (!editor.isDirty() || window.confirm(messages.loadOutOfSync)) {
								progress(fileClient.read(resource), messages.Reading, fileURI).then(function(contents) {
									editor.setInput(fileURI, null, contents);
									this._unsavedChanges = [];
								}.bind(this));
							}
						}
					}.bind(this));
				}
			} else {
				var progressTimeout = window.setTimeout(function() {
					progressTimeout = null;
					this.reportStatus(i18nUtil.formatMessage(messages.Fetching, fileURI));
				}.bind(this), 800);
				var clearTimeout = function() {
					this.reportStatus("");
					if (progressTimeout) {
						window.clearTimeout(progressTimeout);
					}
				}.bind(this);
				var errorHandler = function(error) {
					clearTimeout();
					var statusService = null;
					if(this.serviceRegistry) {
						statusService = this.serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
					} else if(this.statusService) {
						statusService = this.statusService;
					}
					handleError(statusService, error);
					this._setNoInput();
				}.bind(this);
				this._acceptPatch = null;
				// Read metadata
				progress(this._read(resource, true), messages.ReadingMetadata, resource).then(function(metadata) {
					if(!metadata) {
						errorHandler({responseText: i18nUtil.formatMessage(messages.ReadingMetadataError, resource)});
					} else if (metadata.Directory) {
						// Fetch children
						Deferred.when(metadata.Children || progress(fileClient.fetchChildren(metadata.ChildrenLocation), messages.Reading, fileURI), function(contents) {
							clearTimeout();
							metadata.Children = contents;
							this._setInputContents(this._parsedLocation, fileURI, contents, metadata);
						}.bind(this), errorHandler);
					} else {
						// Read contents if this is a text file
						if (this._isText(metadata)) {
							// Read text contents
							progress(fileClient.read(resource, false, true), messages.Reading, fileURI).then(function(contents) {
								clearTimeout();
								if (typeof contents !== "string") { //$NON-NLS-0$
									this._acceptPatch = contents.acceptPatch;
									contents = contents.result;
								}
								this._setInputContents(this._parsedLocation, fileURI, contents, metadata);
							}.bind(this), errorHandler);
						} else {
							progress(fileClient._getService(resource).readBlob(resource), messages.Reading, fileURI).then(function(contents) {
								clearTimeout();
								this._setInputContents(this._parsedLocation, fileURI, contents, metadata);
							}.bind(this), errorHandler);
						}
					}
				}.bind(this), errorHandler);
			}
		},
		processParameters: function(input) {
			var editor = this.getEditor();
			if (editor && editor.processParameters) {
				editor.processParameters(input);
			}
		},
		getAutoLoadEnabled: function() {
			return this._autoLoadEnabled;
		},
		getAutoSaveEnabled: function() {
			return this._autoSaveEnabled;
		},
		getEditor: function() {
			return this.editor;
		},
		getInput: function() {
			return this._input;
		},
		getTitle: function() {
			return this._title;
		},
		getFileMetadata: function() {
			return this._fileMetadata;
		},
		getReadOnly: function() {
			var data = this._fileMetadata;
			return this._readonly || !data || (data.Attributes && data.Attributes.ReadOnly);
		},
		getContentType: function() {
			return this._contentType;
		},
		onFocus: function(e) {
			// If there was an error while auto saving, auto save is temporarily disabled and
			// we retry saving every time the editor gets focus
			if (this._autoSaveEnabled && this._errorSaving) {
				this.save();
				return;
			}
			if (this._autoLoadEnabled) {
				this.load();
			}
		},
		onChanging: function(e) {
			if (!this._getSaveDiffsEnabled()) { return; }
			var length = this._unsavedChanges.length;
			var addedCharCount = e.addedCharCount;
			var removedCharCount = e.removedCharCount;
			var start = e.start;
			var end = e.start + removedCharCount;
			var type = 0;
			if (addedCharCount === 0) {
				type = -1;
			} else if (removedCharCount === 0) {
				type = 1;
			}
			if (length > 0) {
				if (type === this.previousChangeType) {
					var previousChange = this._unsavedChanges[length-1];
					if (removedCharCount === 0 && start === previousChange.end + previousChange.text.length) {
						previousChange.text += e.text;
						return;
					}
					if (e.addedCharCount === 0 && end === previousChange.start) {
						previousChange.start = start;
						return;
					}
				}
			}
			this.previousChangeType = type;
			this._unsavedChanges.push({start:start, end:end, text:e.text});
		},
		reportStatus: function(msg) {
			if (this.statusReporter) {
				this.statusReporter(msg);
			} else if (this.editor) {
				this.editor.reportStatus(msg);
			}
		},
		save: function(closing) {
			if (this._saving) { return this._savingDeferred; }
			var self = this;
			this._savingDeferred = new Deferred();
			this._saving = true;
			function done(result) {
				var deferred = self._savingDeferred;
				deferred.resolve(result);
				self._savingDeferred = null;
				self._saving = false;
				return deferred;
			}
			var editor = this.getEditor();
			if (!editor || !editor.isDirty() || this.getReadOnly()) { return done(); }
			var failedSaving = this._errorSaving;
			var input = this.getInput();
			this.reportStatus(messages['Saving...']);

			this.dispatchEvent({ type: "Saving", inputManager: this}); //$NON-NLS-0$

			editor.markClean();
			var contents = editor.getText();
			var data = contents;
			if (this._getSaveDiffsEnabled() && !this._errorSaving) {
				var changes = this._unsavedChanges;
				var length = 0;
				for (var i = 0; i < changes.length; i++) {
					length += changes[i].text.length;
				}
				if (contents.length > length) {
					data = {
						diff: changes
					};
				}
			}
			this._unsavedChanges = [];
			this._errorSaving = false;

			var etag = this.getFileMetadata().ETag;
			var args = { "ETag" : etag }; //$NON-NLS-0$
			var resource = this._parsedLocation.resource;
			var def = this.fileClient.write(resource, data, args);
			var progress = this.progressService;
			var statusService = null;
			if(this.serviceRegistry){
				statusService = this.serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
			}
			if (progress) {
				def = progress.progress(def, i18nUtil.formatMessage(messages.savingFile, input));
			}
			function successHandler(result) {
				if (input === self.getInput()) {
					self.getFileMetadata().ETag = result.ETag;
					editor.setInput(input, null, contents, true);
				}
				self.reportStatus("");
				if (failedSaving && statusService) {
					statusService.setProgressResult({Message:messages.Saved, Severity:"Normal"}); //$NON-NLS-0$
				}
				if (self.postSave) {
					self.postSave(closing);
				}
				return done(result);
			}
			function errorHandler(error) {
				self.reportStatus("");
				var errorMsg = handleError(statusService, error);
				if (errorMsg.Message === messages.noResponse) {
					mMetrics.logEvent("status", "error", 
						this._autoSaveActive?"auto-save":"save", error.status);
				}
				self._errorSaving = true;
				return done();
			}
			def.then(successHandler, function(error) {
				// expected error - HTTP 412 Precondition Failed
				// occurs when file is out of sync with the server
				if (error.status === 412) {
					var forceSave = window.confirm(messages.saveOutOfSync);
					if (forceSave) {
						// repeat save operation, but without ETag
						var def = self.fileClient.write(resource, contents);
						if (progress) {
							def = progress.progress(def, i18nUtil.formatMessage(messages.savingFile, input));
						}
						def.then(successHandler, errorHandler);
					} else {
						return done();
					}
				} else {
					// unknown error
					errorHandler(error);
				}
			});
			return this._savingDeferred;
		},
		setAutoLoadEnabled: function(enabled) {
			this._autoLoadEnabled = enabled;
		},
		/**
		 * Set the autosave timeout. If the timeout is <code>-1</code>, autosave is
		 * disabled.
		 * @param {Number} timeout - the autosave timeout in milliseconds
		 */
		setAutoSaveTimeout: function(timeout) {
			this._autoSaveEnabled = timeout !== -1;
			this._autoSaveActive = false;
			if (!this._idle) {
				var options = {
					document: document,
					timeout: timeout
				};
				this._idle = new Idle(options);
				this._idle.addEventListener("Idle", function () { //$NON-NLS-0$
					if (!this._errorSaving) {
						try {
							this._autoSaveActive = true;
							this.save();
						} finally {
							this._autoSaveActive = false;
						}
					}
				}.bind(this));
			} else {
				this._idle.setTimeout(timeout);
			}
		},
		setContentType: function(contentType) {
			this._contentType = contentType;
		},
		setInput: function(location) {
			if (this._ignoreInput) { return; }
			if (!location) {
				location = PageUtil.hash();
			}
			if (typeof location !== "string") { //$NON-NLS-0$
				return;
			}
			var editor = this.getEditor();
			if (location && location[0] !== "#") { //$NON-NLS-0$
				location = "#" + location; //$NON-NLS-0$
			}
			var input = PageUtil.matchResourceParameters(location), oldInput = this._parsedLocation || {};
			if (editor && editor.isDirty()) {
				var oldLocation = this._location;
				var oldResource = oldInput.resource;
				var newResource = input.resource;
				if (oldResource !== newResource) {
					if (this._autoSaveEnabled) {
						this.save();
					} else if (!window.confirm(messages.confirmUnsavedChanges)) {
						window.location.hash = oldLocation;
						return;
					}
				}
			}
			var editorChanged = editor && oldInput.editor !== input.editor;
			this._location = location;
			this._parsedLocation = input;
			this._ignoreInput = true;
			if(this.selection) {
				this.selection.setSelections(location);
			}
			this._ignoreInput = false;
			var fileURI = input.resource;
			if (fileURI) {
				if (fileURI === this._input) {
					if (editorChanged) {
						this.reportStatus("");
						this._setInputContents(input, fileURI, null, this._fileMetadata, this._isText(this._fileMetadata));
					} else {
						this.processParameters(input);
					}
				} else {
					this._input = fileURI;
					this._readonly = false;
					this._fileMetadata = null;
					this.load();
				}
			} else {
				this._setNoInput(true);
			}
		},
		setTitle: function(title) {
			var indexOfSlash = title.lastIndexOf("/"); //$NON-NLS-0$
			var shortTitle = title;
			if (indexOfSlash !== -1) {
				shortTitle = shortTitle.substring(indexOfSlash + 1);
			}
			this._title = shortTitle;
		},
		setSaveDiffsEnabled: function(enabled) {
			this._saveDiffsEnabled = enabled;
		},
		_getSaveDiffsEnabled: function() {
			return this._saveDiffsEnabled && this._acceptPatch !== null && this._acceptPatch.indexOf("application/json-patch") !== -1; //$NON-NLS-0$
		},
		_unknownContentTypeAsText: function() {// Return true if we think unknown content type is text type
			return true;
		},
		_isText: function(metadata) {
			var contentType = this.contentTypeRegistry.getFileContentType(metadata);
			// Allow unkownn content types to be loaded as text files
			if (!contentType) { return this._unknownContentTypeAsText(); }
			var textPlain = this.contentTypeRegistry.getContentType("text/plain"); //$NON-NLS-0$
			return this.contentTypeRegistry.isExtensionOf(contentType, textPlain);
		},
		_setNoInput: function(loadRoot) {
			if (loadRoot) {
				this.fileClient.loadWorkspace("").then(function(root) {
					this._input = root.ChildrenLocation;
					this._setInputContents(root.ChildrenLocation, null, root, root);
				}.bind(this));
				return;
			}
			// No input, no editor.
			this._input = this._title = this._fileMetadata = null;
			this.setContentType(null);
			this.dispatchEvent({ type: "InputChanged", input: null }); //$NON-NLS-0$
		},
		_setInputContents: function(input, title, contents, metadata, noSetInput) {
			var name, isDir = false;
			if (metadata) {
				this._fileMetadata = metadata;
				this.setTitle(metadata.Location || String(metadata));
				this.setContentType(this.contentTypeRegistry.getFileContentType(metadata));
				name = metadata.Name;
				isDir = metadata.Directory;
			} else {
				// No metadata
				this._fileMetadata = null;
				this.setTitle(title);
				this.setContentType(this.contentTypeRegistry.getFilenameContentType(this.getTitle()));
				name = this.getTitle();
			}
			var editor = this.getEditor();
			if (this._focusListener) {
				if (editor && editor.getTextView && editor.getTextView()) {
					editor.getTextView().removeEventListener("Focus", this._focusListener); //$NON-NLS-0$
				}
				this._focusListener = null;
			}
			if (this._changingListener) {
				if (editor && editor.getModel && editor.getModel()) {
					editor.getModel().removeEventListener("Changing", this._changingListener); //$NON-NLS-0$
				}
				this._changingListener = null;
			}
			var evt = {
				type: "InputChanged", //$NON-NLS-0$
				input: input,
				name: name,
				title: title,
				contentType: this.getContentType(),
				metadata: metadata,
				location: window.location,
				contents: contents
			};
			this.dispatchEvent(evt);
			this.editor = editor = evt.editor;
			if (!isDir) {
				if (editor && editor.getModel && editor.getModel()) {
					editor.getModel().addEventListener("Changing", this._changingListener = this.onChanging.bind(this)); //$NON-NLS-0$
				}
				if (!noSetInput) {
					editor.setInput(title, null, contents);
				}
				if (editor && editor.getTextView && editor.getTextView()) {
					editor.getTextView().addEventListener("Focus", this._focusListener = this.onFocus.bind(this)); //$NON-NLS-0$
				}
				this._unsavedChanges = [];
				this.processParameters(input);
			}

			mMetrics.logPageLoadTiming("interactive", window.location.pathname); //$NON-NLS-0$
		}
	});
	return {
		handleError: handleError,
		InputManager: InputManager
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/*global prompt URL*/
define('orion/compare/resourceComparer',[
    'i18n!orion/compare/nls/messages',
    'orion/i18nUtil',
    'orion/Deferred', 
    'orion/webui/littlelib', 
    'orion/compare/compareUtils', 
    'orion/compare/diffProvider', 
    'orion/compare/compareView', 
    'orion/highlight', 
	'orion/fileClient', 
	'orion/globalCommands', 
	'orion/commands', 
	'orion/keyBinding', 
	'orion/searchAndReplace/textSearcher', 
	'orion/editorCommands', 
	'orion/objects', 
	'orion/inputManager', 
	'orion/editor/editorFeatures', 
	'orion/contentTypes', 
	'orion/URL-shim'
], function(messages, i18nUtil, Deferred, lib, mCompareUtils, mDiffProvider, mCompareView, Highlight, mFileClient, mGlobalCommands, mCommands, mKeyBinding, mSearcher, mEditorCommands, objects, mInputManager, mEditorFeatures, mContentTypes) {

var exports = {};

exports.DefaultDiffProvider = (function() {
	function DefaultDiffProvider(serviceRegistry){
		this.serviceRegistry = serviceRegistry;
		this._diffProvider = new mDiffProvider.DiffProvider(serviceRegistry);
	}	
	DefaultDiffProvider.prototype = {
		_resolveTwoFiles: function(oldFileURL, newFileURL){
			var that = this;
			var compareTwo = function(results) {
				if(Array.isArray(results) && results.length === 2 && results[0] && results[1]){
					var oldFileContentType = results[0];
					var newFileContentType = results[1];
					return new Deferred().resolve({ oldFile:{URL: oldFileURL, Name: that._resolveFileName(oldFileURL), Type: oldFileContentType},
								newFile:{URL: newFileURL, Name: that._resolveFileName(newFileURL), Type: newFileContentType},
								diffContent: that._diffContent
							 });
				} else {
					var oldFileName = oldFileURL ? that._resolveFileName(oldFileURL) : ""; //$NON-NLS-0$
					var newFileName = newFileURL ? that._resolveFileName(newFileURL) : ""; //$NON-NLS-0$
					return new Deferred().resolve({ oldFile:{URL: oldFileURL, Name: oldFileName, Type: null},
								newFile:{URL: newFileURL, Name: newFileName, Type: null},
								diffContent: that._diffContent
							 });
				}
			};
			return Deferred.all([ that._getContentType(oldFileURL), that._getContentType(newFileURL)], function(error) { return {_error: error}; }).then(compareTwo);
		},
		
		//TODO : get the file name from file service
		_resolveFileName: function(fileURL){
			var fileName = fileURL.split("?")[0]; //$NON-NLS-0$
			return fileName;
		},
		
		_getContentType: function(fileURL){
			var filename = this._resolveFileName(fileURL);
			return this.serviceRegistry.getService("orion.core.contentTypeRegistry").getFilenameContentType(filename); //$NON-NLS-0$
		},
		
		_resolveComplexFileURL: function(complexURL) {
			var that = this;
			return this._diffProvider.getDiffFileURI(complexURL).then(function(jsonData, secondArg) {
				return that._resolveTwoFiles(jsonData.Old, jsonData.New);
			}, function(){});
		},
		
		resolveDiff: function(resource, compareTo, hasConflicts, ignoreWhitespace) {
			this._hasConflicts = hasConflicts;
			if(compareTo){
				return this._resolveTwoFiles(compareTo, resource);
			} else {
				if(!this._diffProvider){
					console.log("A diff provider is needed for compound diff URL"); //$NON-NLS-0$
					return;
				}
				var that = this;
				var ignoreWS = ignoreWhitespace ? "true" : "false";
				return that._diffProvider.getDiffContent(resource, {ignoreWS: ignoreWS}).then(function(jsonData) {
					if (that._hasConflicts) {
						that._diffContent = jsonData.split("diff --git")[1]; //$NON-NLS-0$
					} else {
						that._diffContent = jsonData;
					}
					return that._resolveComplexFileURL(resource);
				}, function(){});
			}
		}
	};
	return DefaultDiffProvider;
}());

function CompareStyler(registry){
	this._syntaxHighlither = new Highlight.SyntaxHighlighter(registry);
}	
CompareStyler.prototype = {
	highlight: function(fileName, contentType, editor) {
		return this._syntaxHighlither.setup(contentType, editor.getTextView(), 
									 null, //passing an AnnotationModel allows the styler to use it to annotate tasks/comment folding/etc, but we do not really need this in compare editor
									 fileName,
									 false /*bug 378193*/);
	}
};
var SAVE_EMBEDDED = true;
//SAVE_EMBEDDED = (new URL(window.location.href).query.get("save") === "true");

exports.ResourceComparer = (function() {
	function ResourceComparer (serviceRegistry, commandRegistry, options, viewOptions) {
		this._registry = serviceRegistry;
		this._commandService = commandRegistry;
		this._fileClient = new mFileClient.FileClient(serviceRegistry);
		this._searchService = this._registry.getService("orion.core.search"); //$NON-NLS-0$
		var progressService = this._progress = this._registry.getService("orion.page.progress"); //$NON-NLS-0$
		this._progressFunc =  function(deferred, msgKey, uri) {
			if (!progressService) { return deferred; }
			return progressService.progress(deferred, i18nUtil.formatMessage(msgKey, uri));
		};
		this.setOptions(options, true);
		this._inputManagers = [];
		viewOptions.preCreate = this._initInputManagers.bind(this);
		viewOptions.postCreate = function () {
			this._inputManagers.forEach(function(inputManager) {
				if(inputManager.manager){
					var editor = this._compareView.getWidget().getEditors()[inputManager.manager._editorIndex];
					editor.addEventListener("DirtyChanged", function(evt) { //$NON-NLS-0$
						inputManager.manager.setDirty(editor.isDirty());
					});
				}
			}.bind(this));
		}.bind(this);
		viewOptions.onInputChanged = this._inputChanged.bind(this);
		viewOptions.onSave = this.save.bind(this);
		if(options.toggleable) {
			this._compareView = new mCompareView.toggleableCompareView(options.type === "inline" ? "inline" : "twoWay", viewOptions); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		} else if(options.type === "inline") { //$NON-NLS-0$
			this._compareView = new mCompareView.inlineCompareView(viewOptions);
		} else {
			this._compareView = new mCompareView.TwoWayCompareView(viewOptions);
		}
		this._compareView.getWidget().setOptions({ignoreWhitespace: options.ignoreWhitespace});
		this._compareView.getWidget().setOptions({diffProvider: options.diffProvider});
		this._compareView.getWidget().setOptions({resource: options.resource});
		this._compareView.getWidget().setOptions({titleIds: this.options.saveLeft ? this.options.saveLeft.titleIds : null });
		this._compareView.getWidget().setOptions({extCmdHolder: this});
		if(viewOptions.highlighters){
			this._compareView.getWidget().setOptions({highlighters: viewOptions.highlighters});
		} else {
			this._compareView.getWidget().setOptions({highlighters: [new CompareStyler(serviceRegistry), new CompareStyler(serviceRegistry)]});
		}
		if(!viewOptions.oldFile){//Create a default file option object for right side 
			this._compareView.getWidget().setOptions({oldFile: {readonly: this._checkReadonly(options.readonlyRight)}});
		}
		if(!viewOptions.newFile){//Create a default file option object for left side
			this._compareView.getWidget().setOptions({newFile: {readonly: this._checkReadonly(options.readonly, true)}});
		}
		this.initExtCmds();
		this._compareView.getWidget().initEditors( messages['fetching...']);
	}
	ResourceComparer.prototype = {
		_clearOptions: function(){
			this.options = {};
		},
		_checkReadonly: function(readonlyFlag, isLeft){
			if(isLeft){//Legacy: If not defined, left side readonly is false
				if(this.options.saveLeft && !SAVE_EMBEDDED) {
					return true;
				}
				return typeof readonlyFlag === "undefined" ? false : readonlyFlag; //$NON-NLS-0$
			} else {//Legacy: If not defined, right side readonly is true
				if(this.options.saveRight && !SAVE_EMBEDDED) {
					return true;
				}
				return typeof readonlyFlag === "undefined" ? true : readonlyFlag; //$NON-NLS-0$
			}
		},
		_getFileOptions: function(editorIndex) {
			return (editorIndex === 1 ? this._compareView.getWidget().options.newFile : this._compareView.getWidget().options.oldFile);
		},
		_createInputManager: function() {
			var im = new mInputManager.InputManager({
						serviceRegistry: this._registry,
						fileClient: this._fileClient,
						progressService: this._progress
			});
			im.getReadOnly = function() {
				return false;
			};
			return im;
		},
		_saveCmdVisible: function() {
			return this._compareView.getWidget().type === "twoWay";
		},
		_initInputManagers: function() {
			this._inputManagers = [{}, {}];
			//We only create input managers when it is a non toggleable side by side compare widget
			if(this._compareView.getWidget()._uiFactory && this._compareView.getWidget().type === "twoWay") { //$NON-NLS-0$
				//Create the right hand side input manager
				if(!this._checkReadonly(this.options.readonlyRight)) {
					this._inputManagers[0].manager = this._createInputManager();
					this._initInputManager(this._inputManagers[0].manager, 0, this.options.saveRight ? this.options.saveRight.saveCmdContainerId : this._compareView.getWidget()._uiFactory.getActionDivId(), !!this.options.saveRight);
				}
				//Create the left hand side input manager
				if(!this._checkReadonly(this.options.readonly, true)) {
					this._inputManagers[1].manager =  this._createInputManager();
					this._initInputManager(this._inputManagers[1].manager, 1, this.options.saveLeft ? this.options.saveLeft.saveCmdContainerId : this._compareView.getWidget()._uiFactory.getActionDivId(true), !!this.options.saveLeft);
				}
			}
			var that = this;
			this._inputManagers.forEach(function(inputManager) {
				if(inputManager.manager){
					var keyBindingFactory = function(editor, keyModeStack, undoStack, contentAssist) {
						var localSearcher = new mSearcher.TextSearcher(editor, that._registry, that._commandService, undoStack);
						var keyBindings = new mEditorFeatures.KeyBindingsFactory().createKeyBindings(editor, undoStack, contentAssist, localSearcher);
						var commandGenerator = new mEditorCommands.EditorCommandFactory({
							serviceRegistry: that._registry,
							commandRegistry: that._commandService,
							fileClient: that._fileClient,
							inputManager: inputManager.manager,
							toolbarId: inputManager.manager._actionBarId,
							readonly: false,
							navToolbarId: "pageNavigationActions", //$NON-NLS-0$
							textSearcher: localSearcher
						});
						var saveCmdId = inputManager.manager._editorIndex === 1 ? (that.options.saveLeft ? that.options.saveLeft.saveCmdId : "orion.compare.save.left") : 
													(that.options.saveRight ? that.options.saveRight.saveCmdId : "orion.compare.save.right"); //$NON-NLS-1$ //$NON-NLS-0$
						commandGenerator.generateSimpleEditorCommands(editor, saveCmdId, function() {return that._saveCmdVisible();}, 2000);
						return keyBindings;
					};
					this._getFileOptions(inputManager.manager._editorIndex).keyBindingFactory = keyBindingFactory;
				}
			}.bind(this));
		},
		_initInputManager: function(inputManger, editorIndex, actionBarId, embedded){
			var that = this;
			objects.mixin(inputManger, {
				filePath: "",
				_editorIndex: editorIndex,
				_actionBarId: actionBarId,
				embedded: embedded,
				getInput: function() {
					return this.filePath;
				},
				
				setDirty: function(dirty) {
					var editors = that._compareView.getWidget().getEditors();
					var checkedDirty = dirty;
					if(!this.embedded) {
						if(editors && editors.length === 2){
							checkedDirty = editors[0].isDirty() || editors[1].isDirty();
						}
						mGlobalCommands.setDirtyIndicator(checkedDirty);
						if(that._compareView.getWidget().refreshTitle){
							that._compareView.getWidget().refreshTitle(this._editorIndex, dirty);
						}
					} else if(that._compareView.getWidget().options.titleIds && that._compareView.getWidget().options.titleIds.length > 0) {
						var titleNode;
						if(that._compareView.getWidget().options.maximized && that._compareView.getWidget().options.titleIds.length === 2) {
							titleNode = lib.node(that._compareView.getWidget().options.titleIds[1]);
							if(titleNode) {
								titleNode.textContent = that._compareView.getWidget().options.maximized && dirty ? "*" : "";
							}
						}
						
						titleNode = lib.node(that._compareView.getWidget().options.titleIds[0]);
						if(!titleNode) {
							return;
						}
						//lib.empty(titleNode);
						var label = titleNode.textContent;
						if(label) {
							if (label.charAt(label.length -1) === '*') { //$NON-NLS-0$
								label = label.substring(0, label.length-1);
							}
							titleNode.textContent = checkedDirty ? label + "*" : label;
						}
					}
				},
				
				getFileMetadata: function() {
					return this._fileMetadata;
				},
				
				getEditor: function() {
					return that._compareView.getWidget().getEditors()[this._editorIndex];
				},
							
				setInput: function(fileURI, editor) {
					this._parsedLocation = {resource:fileURI};
					that._progressFunc(that._fileClient.read(fileURI, true), i18nUtil.formatMessage(messages["readingFileMetadata"], fileURI)).then( //$NON-NLS-0$
						function(metadata) {
							this._fileMetadata = metadata;
							if(!this.embedded) {
								var toolbar = lib.node(this._actionBarId); //$NON-NLS-0$
								if (toolbar) {	
									that._commandService.destroy(toolbar);
									var editorIndex = this._editorIndex;
									that._commandService.renderCommands(toolbar.id, toolbar, that._compareView.getWidget().getEditors()[editorIndex], that._compareView.getWidget().getEditors()[editorIndex], "tool"); //$NON-NLS-0$
								}
							}
							if(metadata){
								this.setTitle(metadata.Location, metadata);
							}
						}.bind(this),
						function(error) {
							console.error("Error loading file metadata: " + error.message); //$NON-NLS-0$
							this.setTitle(fileURI);
						}.bind(this)
					);
					this.lastFilePath = fileURI;
				},
				
				setTitle : function(title, /*optional*/ metadata) {
					if(this.embedded) {
						return;
					}
					var name;
					if (metadata) {
						name = metadata.Name;
					}
					mGlobalCommands.setPageTarget({task: messages["compareTreeTitle"], name: name, target: metadata,
								serviceRegistry: that._registry, commandService: that._commandService,
								searchService: that._searchService, fileService: that._fileClient});
					if (title.charAt(0) === '*') { //$NON-NLS-0$
						mGlobalCommands.setDirtyIndicator(true);
					} else {
						mGlobalCommands.setDirtyIndicator(false);
					} 
				},
				
				postSave: function(closing){
					var editors = that._compareView.getWidget().getEditors();
					var newContents = editors[this._editorIndex].getTextView().getText();
					var fileObj = that._getFileOptions(this._editorIndex);
					fileObj.Content = newContents;
					if(!closing) {
						var options = that._compareView.getWidget().options;
						if(options.diffProvider && options.diffContent) {
							var ignoreWS = options.ignoreWhitespace ? "true" : "false";
							options.diffProvider._diffProvider.getDiffContent(options.resource, {ignoreWS: ignoreWS}).then(function(jsonData) {
								if (options.hasConflicts) {
									options.diffContent = jsonData.split("diff --git")[1]; //$NON-NLS-0$
								} else {
									options.diffContent = jsonData;
								}
								that._compareView.getWidget().refresh(true, true, this.embedded ? null : this._editorIndex);
							}.bind(this), function(){});
						} else {
							that._compareView.getWidget().refresh(true, true, this.embedded ? null : this._editorIndex);
						}
					}
				}
			});
		},
		setOptions: function(options, clearExisting){
			if(clearExisting){
				this._clearOptions();
			}
			if(!this.options) {
				this.options = {};
			}
			if(options) {
				Object.keys(options).forEach(function(option) {
					this.options[option] = options[option];
				}.bind(this));
			}
		},
		generateLink: function(compareWidget){	
			var diffPos = compareWidget.getCurrentDiffPos();
			var href = mCompareUtils.generateCompareHref(this.options.resource, {
				compareTo: this.options.compareTo ? this.options.compareTo : undefined,
				readonly: this.options.readonly,
				readonlyRight: this.options.readonlyRight,
				conflict: this.options.hasConflicts,
				block: diffPos.block ? diffPos.block : 1, 
				change: diffPos.change ? diffPos.change : 0 
			});
			var url = new URL(href, window.location.href).href;
			prompt(messages["Copy the link URL:"], url);
		},
		openComparePage: function(compareWidget){	
			var diffPos = compareWidget.getCurrentDiffPos();
			var href = mCompareUtils.generateCompareHref(this.options.resource, {
				compareTo: this.options.compareTo ? this.options.compareTo : undefined,
				readonly: !this.options.editableInComparePage,
				conflict: this.options.hasConflicts,
				block: diffPos.block ? diffPos.block : 1, 
				change: diffPos.change ? diffPos.change : 0 
			});
			return href;
		},
		initExtCmds: function() {
			var cmdProvider = this._compareView.getWidget().options.commandProvider;
			if(cmdProvider && cmdProvider.getOptions().commandSpanId) {
				var commandSpanId = cmdProvider.getOptions().commandSpanId;
				var generateLinkCommand = new mCommands.Command({
					tooltip : messages["GenerateCurDiffLink"],
					name: messages["Generate Link"],
					//imageClass : "core-sprite-link", //$NON-NLS-0$
					id: "orion.compare.generateLink", //$NON-NLS-0$
					groupId: "orion.compareGroup", //$NON-NLS-0$
					visibleWhen: function(item) {
						return item.options.extCmdHolder.options.resource && item.options.extCmdHolder.options.generateLink;
					},
					callback : function(data) {
						data.items.options.extCmdHolder.generateLink(data.items);
				}});
				var openComparePageCommand = new mCommands.Command({
					tooltip : messages["Open the compare page"],
					name: messages["Compare"],
					imageClass : "git-sprite-compare", //$NON-NLS-0$
					id: "orion.compare.openComparePage", //$NON-NLS-0$
					groupId: "orion.compareGroup", //$NON-NLS-0$
					visibleWhen: function(item) {
						return item.options.extCmdHolder.options.resource && !item.options.extCmdHolder.options.generateLink && !item.options.extCmdHolder.options.standAlone;
					},
					hrefCallback: function(data) {
						return data.items.options.extCmdHolder.openComparePage(data.items);
				}});
				this._commandService.addCommand(generateLinkCommand);
				this._commandService.addCommand(openComparePageCommand);
					
				// Register command contributions
				this._commandService.registerCommandContribution(commandSpanId, "orion.compare.openComparePage", 98); //$NON-NLS-0$
				this._commandService.registerCommandContribution(commandSpanId, "orion.compare.generateLink", 99, null, false, new mKeyBinding.KeyBinding('l', true, true)); //$NON-NLS-1$ //$NON-NLS-0$
			}
		},
	    _getFilesContents: function(files){
	        var promises = [];
			files.forEach(function(file) {
				promises.push(this._loadSingleFile(file));
			}.bind(this));
			return Deferred.all(promises, function(error) { return {_error: error}; });
	    },
	    _loadSingleFile: function(file) {
	        return this._progressFunc(this._fileClient.read(file.URL), //$NON-NLS-0$
	                   i18nUtil.formatMessage(messages["readingFile"], file.URL)).then( //$NON-NLS-0$
		        function(contents) {
					file.Content = contents;
					return file;
		        }.bind(this),
		        function(error, ioArgs) {
					if (error.status === 404) {
						file.Content = "";
					} else {
						//TODO: show file loading error in the appropriate editor(error, ioArgs);
					}
					return file;
		        }.bind(this)
			);
	    },
	    _inputChanged: function() {
	    	var that =this;
			this._inputManagers.forEach(function(inputManager) {
				if(inputManager.manager){
					var fileOptions = that._getFileOptions(inputManager.manager._editorIndex);
					var editor = inputManager.manager.getEditor();
					inputManager.manager.filePath = fileOptions.URL;
					inputManager.manager.setInput(fileOptions.URL , editor);
				}
			});
	    },
	    save: function(doSave) {
			if(doSave) {
			   	var promises = [];
				this._inputManagers.forEach(function(inputManager) {
					if(inputManager.manager){
						var editor = inputManager.manager.getEditor();
						if(editor.isDirty()) {
							promises.push(inputManager.manager.save(true));
						}
					}
				});
				return Deferred.all(promises);
			} else {
				return new Deferred().resolve();
			}
	    },
		isDirty: function(){
			return this._compareView.isDirty();
		},
		destroy: function(){
			this._compareView.destroy();
		},
		start: function(){
			if(this.options.resource){
				if(!this.options.diffProvider){
					console.log("A diff provider is needed for Complex diff URL"); //$NON-NLS-0$
					return;
				}
				var that = this;
				return that.options.diffProvider.resolveDiff(that.options.resource, that.options.compareTo, that.options.hasConflicts, that.options.ignoreWhitespace).then( function(diffParam){
					if(diffParam.oldFile) {
						diffParam.oldFile.readonly = that._compareView.getWidget().options.oldFile.readonly;
					}
					if(diffParam.newFile) {
						diffParam.newFile.readonly = that._compareView.getWidget().options.newFile.readonly;
					}
					that._compareView.getWidget().setOptions(diffParam);
					var isImage = mContentTypes.isImage(diffParam.newFile.Type);
					var viewOptions = that._compareView.getWidget().options;
					if(that._checkReadonly(that.options.readonlyRight) || isImage) {
						viewOptions.oldFile.readonly = true;
					}
					if(that._checkReadonly(that.options.readonly, true) || isImage) {
						viewOptions.newFile.readonly = true;
					}
					if(isImage){
						that._compareView.initImageMode();
						return that._compareView.getWidget().refresh().then(function(height){
							return new Deferred().resolve(height + 5);
						});
					} else {
						var filesToLoad = ( viewOptions.diffContent ? [viewOptions.oldFile, viewOptions.newFile] : [viewOptions.oldFile, viewOptions.newFile]); 
						return that._getFilesContents(filesToLoad).then( function(){
							var viewHeight = that._compareView.getWidget().refresh(true);
							that._inputChanged();							
							return new Deferred().resolve(viewHeight);
						}.bind(that));
					}
				});
			}
		}
	};
	return ResourceComparer;
}());

return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/

/**
 * Utility methods that do not have UI dependencies.
 */
define('orion/git/util',[
	'i18n!git/nls/gitmessages',
	'orion/i18nUtil',
	"orion/URL-shim"
], function(messages, i18nUtil) {

	var interestedUnstagedGroup = ["Missing", "Modified", "Untracked", "Conflicting"]; //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	var interestedStagedGroup = ["Added", "Changed", "Removed"]; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	
	function isStaged(change) {
		for (var i = 0; i < interestedStagedGroup.length; i++) {
			if (change.type === interestedStagedGroup[i]) {
				return true;
			}
		}
		return false;
	}
	
	function isUnstaged(change) {
		for (var i = 0; i < interestedUnstagedGroup.length; i++) {
			if (change.type === interestedUnstagedGroup[i]) {
				return true;
			}
		}
		return false;
	}
	
	function isChange(change) {
		return isStaged(change) || isUnstaged(change);
	}
	
	function hasStagedChanges(status) {
		for (var i = 0; i < interestedStagedGroup.length; i++) {
			if (status[interestedStagedGroup[i]].length > 0) {
				return true;
			}
		}
		return false;
	}
	
	function hasUnstagedChanges(status) {
		for (var i = 0; i < interestedUnstagedGroup.length; i++) {
			if (status[interestedUnstagedGroup[i]].length > 0) {
				return true;
			}
		}
		return false;
	}

	/* parses ssh gitUrl to get hostname and port */
	function parseSshGitUrl(gitUrl){
		try {
			/* try ssh:// protocol */
			var url = new URL(gitUrl);
			return {
				host : url.hostname,
				port : url.port
			};
					
		} catch(e){
			/* try scp-like uri */
			try {
				/* [user@]host.xz:path/to/repo.git/ */
				var scp = gitUrl.split(":"); //$NON-NLS-0$
				var hostPart = scp[0].split("@"); //$NON-NLS-0$
				var host = hostPart.length > 1 ? hostPart[1] : hostPart[0];
				return {
					host : host,
					port : 22
				};
				
			} catch(ex){
				/* admit failure */
				return {
					host : "",
					port : ""
				};
			}
		}
	}
	/**
	 * Trims messages, skips empty lines until non-empty one is found
	 */
	function trimCommitMessage(message) {
		var splitted = message.split(/\r\n|\n/);
		var iterator = 0;
		
		while(splitted.length > 0 && /^\s*$/.test(splitted[iterator])) {
			iterator++;
		}
		var maxMessageLength = 100;
		if (splitted[iterator].length > maxMessageLength) return splitted[iterator].substring(0,maxMessageLength);
		return splitted[iterator];
	}
	
	/**
	 * Returns Change-Id and Signed-off-by of a commit if present
	 */
	function getGerritFooter(message) {
		
		var splitted = message.split(/\r\n|\n/);
		var footer = {};
		var changeIdCount = 0, 
			signedOffByPresent = false;
		for (var i = splitted.length-1; i >= 0; --i) {
			var changeId = "Change-Id: ";	//$NON-NLS-0$
			var signedOffBy = "Signed-off-by: ";	//$NON-NLS-0$
			if (splitted[i].indexOf(changeId) === 0) {
				footer.changeId = splitted[i].substring(changeId.length,splitted[i].length);
				if (++changeIdCount > 1) {
					footer = {};
					break;
				}
			} else if (!signedOffByPresent && splitted[i].indexOf(signedOffBy) === 0) {
				footer.signedOffBy = splitted[i].substring(signedOffBy.length,splitted[i].length);
				signedOffBy = true;
			}
		}
		
		return footer;
	}
	
	function shortenRefName(ref) {
		var refName = ref.Name;
		if (ref.Type === "StashCommit") { //$NON-NLS-0$
			refName = i18nUtil.formatMessage(messages["stashIndex"], ref.parent.children.indexOf(ref), refName.substring(0, 6)); //$NON-NLS-0$
		}
		if (ref.Type === "Commit") { //$NON-NLS-0$
			refName = refName.substring(0, 6);
		}
		if (ref.Type === "RemoteTrackingBranch" && !ref.Id) { //$NON-NLS-0$
			refName += messages[" [New branch]"];
		}
		return refName;
	}
	
	function shortenPath(path) {
		var result = path.split('/').slice(-3); //$NON-NLS-0$
		result = result.join("/"); //$NON-NLS-0$
		return result.length < path.length ? "..." + result : path; //$NON-NLS-0$
	}
	
	function relativePath(treePath) {
		var path = "";
		if (typeof treePath === "string") { //$NON-NLS-0$
			path = treePath;
		} else if (treePath) {
			var parents = treePath.Parents;
			if (parents.length > 1) {
				path = treePath.Location.substring(parents[parents.length -2].Location.length);
			}
		}
		return path;
	}
	
	function generateQuery(queries) {
		var result = queries.filter(function(q) { return q; }).join("&");  //$NON-NLS-0$
		if (result.length) {
			result = "?" + result;  //$NON-NLS-0$
		}
		return result;
	}
	
	function isNewBranch(branch) {
		return branch && branch.Type === "RemoteTrackingBranch" && !branch.Id; //$NON-NLS-0$
	}
	
	function tracksRemoteBranch(branch) {
		return branch && branch.RemoteLocation && branch.RemoteLocation[0] && !isNewBranch(branch.RemoteLocation[0].Children[0]);
	}
	
	return {
		isStaged: isStaged,
		isUnstaged: isUnstaged,
		isChange: isChange,
		isNewBranch: isNewBranch,
		tracksRemoteBranch: tracksRemoteBranch,
		generateQuery: generateQuery,
		hasStagedChanges: hasStagedChanges,
		hasUnstagedChanges: hasUnstagedChanges,
		parseSshGitUrl: parseSshGitUrl,
		trimCommitMessage: trimCommitMessage,
		shortenRefName: shortenRefName,
		shortenPath: shortenPath,
		relativePath: relativePath,
		getGerritFooter: getGerritFooter
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/

/**
 * This class extends orion/git/util to provide UI-related utility methods.
 */
define('orion/git/uiUtil',[
	'orion/compare/compareCommands',
	'orion/compare/resourceComparer',
	'orion/webui/littlelib',
	'orion/git/util',
], function(mCompareCommands, mResourceComparer, lib, mGitUtil) {
	var exports = Object.create(mGitUtil); // extend util

	function createFilter(section, msg, callback) {
		var filterDiv = document.createElement("div"); //$NON-NLS-0$
		filterDiv.className = "gitFilterBox"; //$NON-NLS-0$
		var filter = document.createElement("input"); //$NON-NLS-0$
		filter.placeholder = msg;
		filterDiv.appendChild(filter);
		var button = document.createElement("button"); //$NON-NLS-0$
		button.tabIndex = -1;
		button.className = "core-sprite-filter searchButton"; //$NON-NLS-0$
		filterDiv.appendChild(button);
		var doFilter = function() {
			callback(filter.value);
			if (filter.value) {
				button.classList.remove("core-sprite-filter"); //$NON-NLS-0$
				button.classList.add("core-sprite-show-filtered"); //$NON-NLS-0$
			} else {
				button.classList.remove("core-sprite-show-filtered"); //$NON-NLS-0$
				button.classList.add("core-sprite-filter"); //$NON-NLS-0$
			}
		};
		button.addEventListener("click", function(){ //$NON-NLS-0$
			doFilter();
		});
		var sectionContent = section.getContentElement();
		sectionContent.insertBefore(filterDiv, sectionContent.firstChild);
		filter.addEventListener("keydown", function(event) { //$NON-NLS-0$
			if (event.keyCode === 13) {
				doFilter();
			}
		});
		return filter;
	}
	exports.createFilter = createFilter;

	/**
	 * Create an embedded toggleable compare widget inside a given DIV.
	 * @param {Object} serviceRegistry The serviceRegistry.
	 * @param {Object} commandService The commandService.
	 * @param {String} resoure The URL string of the complex URL which will be resolved by a diff provider into two file URLs and the unified diff.
	 * @param {Boolean} hasConflicts The flag to indicate if the compare contains conflicts.
	 * @param {Object} parentDivId The DIV node or string id of the DIV that holds the compare widget.
	 * @param {String} commandSpanId The id of the DIV where all the commands of the compare view are rendered. "Open in compare page", "toggle", "navigate diff" commands will be rendered.
	 * @param {Boolean} editableInComparePage The flag to indicate if opening compage will be editable on the left side. Default is false. Optional.
	 * @param {Object} gridRenderer If all the commands have to be rendered as grids, especially inside a row of Orion explorer, this has to be provided. Optional.
	 * @param {String} compareTo Optional. If the resource parameter is a simple file URL then this can be used as the second file URI to compare with.
	 * @param {String} toggleCommandSpanId Optional. The id of the DIV where the "toggle" command will be rendered. If this parameter is defined, the "toggle" command will ONLY be rendered in this DIV.
	 */
	function createCompareWidget(serviceRegistry, commandService, resource, hasConflicts, parentDivId, commandSpanId, editableInComparePage, gridRenderer, compareTo, toggleCommandSpanId, 
								 preferencesService, saveCmdContainerId, saveCmdId, titleIds, containerModel, standAloneOptions) {
		var setCompareSelection = function(diffProvider, cmdProvider, ignoreWhitespace, type) {
				var comparerOptions = {
				toggleable: true,
				type: type, //$NON-NLS-0$ //From user preference
				ignoreWhitespace: ignoreWhitespace,//From user reference
				readonly: !saveCmdContainerId || !editableInComparePage,
				hasConflicts: hasConflicts,
				diffProvider: diffProvider,
				resource: resource,
				compareTo: compareTo,
				saveLeft: {	saveCmdContainerId: saveCmdContainerId, saveCmdId: saveCmdId, titleIds: titleIds},
				editableInComparePage: editableInComparePage,
				standAlone: (standAloneOptions ? true : false)
			};
			var viewOptions = {
				parentDivId: parentDivId,
				commandProvider: cmdProvider,
				highlighters: (standAloneOptions ? standAloneOptions.highlighters : null)
			};
			var comparer = new mResourceComparer.ResourceComparer(serviceRegistry, commandService, comparerOptions, viewOptions);
			if(containerModel) {
				containerModel.resourceComparer = comparer;
				containerModel.destroy = function() {
					this.resourceComparer.destroy();
				};
			}
			comparer.start().then(function(maxHeight) {
				var vH = 420;
				if (maxHeight < vH) {
					vH = maxHeight;
				}
				var diffContainer = lib.node(parentDivId);
				diffContainer.style.height = vH + "px"; //$NON-NLS-0$
			});
		};
		
		var diffProvider = new mResourceComparer.DefaultDiffProvider(serviceRegistry);
		var cmdProvider = new mCompareCommands.CompareCommandFactory({commandService: commandService, commandSpanId: commandSpanId, toggleCommandSpanId: toggleCommandSpanId, gridRenderer: gridRenderer});
		var ignoreWhitespace = false;
		var mode = "inline";  //$NON-NLS-0$
		if (preferencesService) {
			cmdProvider.addEventListener("compareConfigChanged", function(e) { //$NON-NLS-0$
				preferencesService.getPreferences("/git/compareSettings").then(function(prefs) {  //$NON-NLS-0$
					switch (e.name) {
						case "mode":  //$NON-NLS-0$
							prefs.put("mode", e.value);  //$NON-NLS-0$
						break;
						case "ignoreWhiteSpace":  //$NON-NLS-0$
							prefs.put("ignoreWhitespace", e.value);  //$NON-NLS-0$
						break;
					}
				});
			}.bind(this));
			preferencesService.getPreferences("/git/compareSettings").then(function(prefs) {  //$NON-NLS-0$
				ignoreWhitespace = prefs.get("ignoreWhitespace") || ignoreWhitespace; //$NON-NLS-0$
				mode =  prefs.get("mode") || mode; //$NON-NLS-0$
				setCompareSelection(diffProvider, cmdProvider, ignoreWhitespace, mode);
			});
		} else {
			setCompareSelection(diffProvider, cmdProvider, ignoreWhitespace, mode);
		}
	}
	
	//return module exports
	exports.createCompareWidget = createCompareWidget;
	return exports;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/selection',["orion/EventTarget"], function(EventTarget){

	/**
	 * Constructs a new selection service. Clients should obtain a selection service
	 * by requesting the service <code>orion.page.selection</code> from the service registry.
	 * This service constructor is only intended to be used by page service registry
	 * initialization code.
	 * @name orion.selection.Selection
	 * @class Can provide one or more selections describing objects of interest.  Used to
	 * establish input and output relationships between components.  For example, the selection
	 * in one component can serve as the input of another component.
	 */	
	function Selection(serviceRegistry, selectionServiceId) {
		if (!selectionServiceId) {
			selectionServiceId = "orion.page.selection"; //$NON-NLS-0$
		}
		
		this._serviceRegistry = serviceRegistry;
		EventTarget.attach(this);
		this._serviceRegistration = serviceRegistry.registerService(selectionServiceId, this);
		this._selections = null;  // so we can quickly recognize the "empty" case without comparing arrays.
	}
	 
	Selection.prototype = /** @lends orion.selection.Selection.prototype */ {
		/**
		 * Obtains the current single selection and passes it to the provided function.
		 * @param {Function} onDone The function to invoke with the selection. Deprecated: just use the return value instead.
		 * @returns {Object}
		 */
		getSelection : function(onDone) {
			var result = this._getSingleSelection();
			if (typeof onDone === "function") { //$NON-NLS-0$
				onDone(result);
			}
			return result;
		},
		
		/**
		 * Obtains all current selections and passes them to the provided function.
		 * @param {Function} onDone The function to invoke with the selections. Deprecated: just use the return value instead.
		 * @returns {Array}
		 */
		getSelections: function(onDone) {
			var result = Array.isArray(this._selections) ? this._selections.slice() : [];
			if (typeof onDone === "function") { //$NON-NLS-0$
				onDone(result);
			}
			return result;
		},
		
		_getSingleSelection: function() {
			if (this._selections && this._selections.length > 0) {
				return this._selections[0];
			} 
			return null;
		},
		
		/**
		 * Sets the current selection. Dispatches a <code>selectionChanged</code> event.
		 * @param {Object|Object[]|null} itemOrArray A single selected item, or an array of selected items, or <code>null</code> (meaning no selection).
		 * @see orion.selection.Selection#event:selectionChanged
		 */
		setSelections: function(itemOrArray) {
			var oldSelection = this._selections;
			if (Array.isArray(itemOrArray)) {	
				this._selections = itemOrArray.length > 0 ? itemOrArray.slice() : null;
			} else if (itemOrArray) {
				this._selections = [itemOrArray];
			} else {
				this._selections = null;
			}
			if (oldSelection !== this._selections) {
				this.dispatchEvent({type:"selectionChanged", selection: this._getSingleSelection(), selections: this._selections}); //$NON-NLS-0$
			}
		}
		/**
		 * Dispatched when the selection has changed.
		 * @name orion.selection.Selection#selectionChanged
		 * @class
		 * @event
		 * @param {selectionChangedEvent} selectionChangedEvent
		 * @param {Object} selectionChangedEvent.selection The selected item. If there is no selection, this field is <code>null</code>. If multiple items are selected,
		 * this field refers to the first item in the list.
		 * @param {Object[]} selectionChangedEvent.selections The selected items. If there is no selection, this field is <code>null</code>.
		 * @param {String} selectionChangedEvent.type The type event type. Value is always <code>"selectionChanged"</code>.
		 */
	};
	Selection.prototype.constructor = Selection;

	//return module exports
	return {Selection: Selection};
});

define('text!orion/webui/submenutriggerbutton.html',[],function () { return '<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0"><span class="dropdownCommandName">${ButtonText}</span><span class="dropdownArrowRight core-sprite-closedarrow"></span></span><ul class="dropdownMenu"></ul></li>';});

/*******************************************************************************
 * @license
 * Copyright (c) 2010,2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
 
define('orion/commandRegistry',[
	'orion/commands',
	'orion/explorers/navigationUtils',
	'orion/PageUtil',
	'orion/uiUtils',
	'orion/webui/littlelib',
	'orion/webui/dropdown',
	'orion/webui/tooltip',
	'text!orion/webui/submenutriggerbutton.html',
	'orion/metrics'
], function(Commands, mNavUtils, PageUtil, UIUtil, lib, mDropdown, mTooltip, SubMenuButtonFragment, mMetrics) {

	/**
	 * Constructs a new command registry with the given options.
	 * @class CommandRegistry can render commands appropriate for a particular scope and DOM element.
	 * @name orion.commandregistry.CommandRegistry
	 * @param {Object} options The registry options object
	 * @param {orion.selection.Selection} [options.selection] Optional selection service.
	 */
	function CommandRegistry(options) {
		this._commandList = {};
		this._contributionsByScopeId = {};
		this._activeBindings = {};
		this._urlBindings = {};
		this._pendingBindings = {}; // bindings for as-yet-unknown commands
		this._init(options);
		this._parameterCollector = null;
	}
	CommandRegistry.prototype = /** @lends orion.commandregistry.CommandRegistry.prototype */ {
		_init: function(options) {
			this._selectionService = options.selection;
			var self = this;
			Commands.setKeyBindingProvider(function() { return self._activeBindings; });
		},
		
		/**
		 * Process the provided URL to determine whether any commands should be invoked.  Note that we never
		 * invoke a command callback by URL, only its parameter collector.  If a parameter collector is not
		 * specified, commands in the URL will be ignored.
		 *
		 * @param {String} url a url that may contain URL bindings.
		 */
		processURL: function(url) {
			for (var id in this._urlBindings) {
				if (this._urlBindings[id] && this._urlBindings[id].urlBinding && this._urlBindings[id].command) {
					var match = this._urlBindings[id].urlBinding.match(url);
					if (match) {
						var urlBinding = this._urlBindings[id];
						var command = urlBinding.command;
						var invocation = urlBinding.invocation;
						// If the command has not rendered (visibleWhen=false, etc.) we don't have an invocation.
						if (invocation && invocation.parameters && command.callback) {
							invocation.parameters.setValue(match.parameterName, match.parameterValue);
							var self = this;
							window.setTimeout(function() {
								self._invoke(invocation);
							}, 0);
							return;
						}
					}
				}
			}
		},
		
		/**
		 * @param {String} commandId
		 * @returns {orion.commands.Command}
		 */
		findCommand: function(commandId) {
			return this._commandList[commandId];
		}, 
		
		/**
		 * Run the command with the specified commandId.
		 *
		 * @param {String} commandId the id of the command to run.
		 * @param {Object} item the item on which the command should run.
		 * @param {Object} handler the handler for the command.
		 * @param {orion.commands.ParametersDescription} [parameters] Parameters used on this invocation. Optional.
		 * @param {Object} [userData] Optional user data that should be attached to generated command callbacks.
		 * @param {DOMElement} [parent] Optional parent for the parameter collector.
		 *
		 * Note:  The current implementation will only run the command if a URL binding has been
		 * specified, or if an item to run the command against has been specified.  
		 */
		runCommand: function(commandId, item, handler, parameters, userData, parent) {
			var self = this;
			if (item) {
				var command = this._commandList[commandId];
				var enabled = command && (command.visibleWhen ? command.visibleWhen(item) : true);
				if (enabled && command.callback) {
					var commandInvocation = new Commands.CommandInvocation(handler, item, userData, command, self);
					commandInvocation.domParent = parent;
					return self._invoke(commandInvocation, parameters);
				}
			} else {
				//TODO should we be keeping invocation context for commands without bindings? 
				var binding = this._urlBindings[commandId];
				if (binding && binding.command) {
					if (binding.command.callback) {
						return self._invoke(binding.invocation, parameters);
					}
				}
			}
		},
		
		/**
		 * Return the default selection service that is being used when commands should apply against a selection.
		 */
		getSelectionService: function() {
			return this._selectionService;
		},


		/**
		 * Interface for a parameter collector.
		 * @name orion.commandregistry.ParameterCollector
		 * @class
		 */
		/**
		 * Open a parameter collector and return the dom node where parameter information should be inserted.
		 * @name orion.commandregistry.ParameterCollector#open
		 * @function
		 * @param {String|DOMElement} commandNode the node containing the triggering command
		 * @param {Function} fillFunction a function that will fill the parameter area
		 * @param {Function} onClose a function that will be called when the parameter area is closed
		 * @returns {Boolean} Whether the node is open.
		 */
		/**
		 * Closes any active parameter collectors.
		 * @name orion.commandregistry.ParameterCollector#close
		 * @function
		 */
		/**
		 * Returns a function that can be used to fill a specified parent node with parameter information.
		 * @name orion.commandregistry.ParameterCollector#getFillFunction
		 * @function
		 * @param {orion.commands.CommandInvocation} the command invocation used when gathering parameters
		 * @param {Function} closeFunction an optional function called when the area must be closed. 
		 * @returns {Function} a function that can fill the specified dom node with parameter collection behavior
		 */
		/**
		 * Collect parameters for the given command.
		 * @name orion.commandregistry.ParameterCollector#collectParameters
		 * @function
		 * @param {orion.commands.CommandInvocation} commandInvocation The command invocation
		 * @returns {Boolean} Whether or not required parameters were collected.
		 */
		/**
		 * Provide an object that can collect parameters for a given "tool" command.  When a command that
		 * describes its required parameters is shown in a toolbar (as an image, button, or link), clicking
		 * the command will invoke any registered parameterCollector before calling the command's callback.
		 * This hook allows a page to define a standard way for collecting required parameters that is 
		 * appropriate for the page architecture.  If no parameterCollector is specified, then the command callback
		 * will be responsible for collecting parameters.
		 *
		 * @param {orion.commandregistry.ParameterCollector} parameterCollector
		 */
		setParameterCollector: function(parameterCollector) {
			this._parameterCollector = parameterCollector;
		},

		/**
		 * Open a parameter collector suitable for collecting information about a command.
		 * Once a collector is created, the specified function is used to fill it with
		 * information needed by the command.  This method is used for commands that cannot
		 * rely on a simple parameter description to collect parameters.  Commands that describe
		 * their required parameters do not need to use this method because the command framework
		 * will open and close parameter collectors as needed and call the command callback with
		 * the values of those parameters.
		 *
		 * @param {DOMElement} node the dom node that is displaying the command, or a node in the parameter collector area
		 * @param {Function} fillFunction a function that will fill the parameter area
		 * @param {Function} onClose a function that will be called when the user closes the collector
		 */
		openParameterCollector: function(node, fillFunction, onClose) {
			if (this._parameterCollector) {
				this._parameterCollector.close();
				this._parameterCollector.open(node, fillFunction, onClose);
			}
		},
		
		/**
		 * Open a parameter collector to confirm a command.
		 *
		 * @param {DOMElement} node the dom node that is displaying the command
		 * @param {String} message the message to show when confirming the command
		 * @param {String} yesString the label to show on a yes/true choice
		 * @param {String} noString the label to show on a no/false choice
		 * @param {Boolean} modal indicates whether the confirmation prompt should be modal.
		 * @param {Function} onConfirm a function that will be called when the user confirms the command.  The function
		 * will be called with boolean indicating whether the command was confirmed.
		 */
		confirm: function(node, message, yesString, noString, modal, onConfirm) {
			var result = false;
			if (this._parameterCollector && !modal) {
				var self = this;
				var okCallback = function() {onConfirm(result);};
				var closeFunction = function(){self._parameterCollector.close();}
				var fillFunction = function(parent, buttonParent) {
					var label = document.createElement("span"); //$NON-NLS-0$
					label.classList.add("parameterPrompt"); //$NON-NLS-0$
					label.textContent = message;
					
					parent.appendChild(label);
					var yesButton = document.createElement("button"); //$NON-NLS-0$
					yesButton.addEventListener("click", function(event) { //$NON-NLS-0$
						result = true;
						okCallback();
						closeFunction();
					}, false);
					buttonParent.appendChild(yesButton);
					yesButton.appendChild(document.createTextNode(yesString)); //$NON-NLS-0$
					yesButton.className = "dismissButton"; //$NON-NLS-0$
					var button = document.createElement("button"); //$NON-NLS-0$
					button.addEventListener("click", function(event) { //$NON-NLS-0$
						result = false;
						closeFunction();
					}, false);
					buttonParent.appendChild(button);
					button.appendChild(document.createTextNode(noString)); //$NON-NLS-0$
					button.className = "dismissButton"; //$NON-NLS-0$
					return yesButton;
				};
				this._parameterCollector.close();
				var opened = this._parameterCollector.open(node, fillFunction, function(){});
				if (!opened) {
					var tooltip = new mTooltip.Tooltip({
						node: node,
						afterHiding: function() {
							this.destroy();
						},
						trigger: "click", //$NON-NLS-0$
						position: ["below", "right", "above", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
					});
					var parameterArea = tooltip.contentContainer();
					parameterArea.classList.add("parameterPopup"); //$NON-NLS-0$
					var originalFocusNode = window.document.activeElement;
					closeFunction = function() {
						if (originalFocusNode) {
							originalFocusNode.focus();
						}
						tooltip.destroy();
					};
					var messageArea = document.createElement("div"); //$NON-NLS-0$
					messageArea.classList.add("parameterMessage"); //$NON-NLS-0$
					parameterArea.appendChild(messageArea);
					
					var buttonArea = document.createElement("div"); //$NON-NLS-0$
					parameterArea.appendChild(buttonArea);
					buttonArea.classList.add("layoutRight"); //$NON-NLS-0$
					buttonArea.classList.add("parametersDismiss"); //$NON-NLS-0$
				
					var focusNode = fillFunction(messageArea, buttonArea);
					tooltip.show();
					if (focusNode) {
						window.setTimeout(function() {
								focusNode.focus();
								if (focusNode.select) {
									focusNode.select();
								}
						}, 0);	
					}
				}
				return;
			} 
			result = window.confirm(message);
			onConfirm(result);
		},
		
		/**
		 * Close any active parameter collector.  This method should be used to deactivate a
		 * parameter collector that was opened with <code>openParameterCollector</code>.
		 * Commands that describe their required parameters do not need to use this method 
		 * because the command framework will open and close parameter collectors as needed and 
		 * call the command callback with the values of those parameters.
		 */
		closeParameterCollector: function() {
			if (this._parameterCollector) {
				this._parameterCollector.close();
			}
		},
		
		/**
		 * Returns whether this registry has been configured to collect command parameters
		 *
		 * @returns {Boolean} whether or not this registry is configured to collect parameters.
		 */
		collectsParameters: function() {
			return this._parameterCollector;
		},
		
		/*
		 * Invoke the specified command, collecting parameters if necessary.  This is used inside the framework
		 * when the user invokes a command. If parameters are specified, then these parameters should be used
		 * in lieu of the invocation's parameters.
		 *
		 */
		_invoke: function(commandInvocation, parameters) {
			return this._collectAndInvoke(commandInvocation.makeCopy(parameters), false);
		},
		
		/*
		 * This method is the actual implementation for collecting parameters and invoking a callback.
		 * "forceCollect" specifies whether we should always collect parameters or consult the parameters description to see if we should.
		 */
		_collectAndInvoke: function(commandInvocation, forceCollect, cancelCallback) {
			if (commandInvocation) {
				// Establish whether we should be trying to collect parameters. 
				if (this._parameterCollector && commandInvocation.parameters && commandInvocation.parameters.hasParameters() && 
					(forceCollect || commandInvocation.parameters.shouldCollectParameters())) {
					var collecting = false;
					commandInvocation.parameters.updateParameters(commandInvocation);
					// Consult shouldCollectParameters() again to verify we still need collection. Due to updateParameters(), the CommandInvocation
					// could have dynamically set its parameters to null (meaning no collection should be done).
					if (commandInvocation.parameters.shouldCollectParameters()) {
						collecting = this._parameterCollector.collectParameters(commandInvocation,cancelCallback);
						// The parameter collector cannot collect.  We will do a default implementation using a popup.
						if (!collecting) {
							var tooltip = new mTooltip.Tooltip({
								node: commandInvocation.domNode || commandInvocation.domParent,
								afterHiding: function() {
									this.destroy();
								},
								trigger: "click", //$NON-NLS-0$
								position: ["below", "right", "above", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
							});
							var parameterArea = tooltip.contentContainer();
							parameterArea.classList.add("parameterPopup"); //$NON-NLS-0$
							var originalFocusNode = window.document.activeElement;
							var focusNode = this._parameterCollector.getFillFunction(commandInvocation, function() {
								if (originalFocusNode) {
									originalFocusNode.focus();
								}
								tooltip.destroy();
							}, cancelCallback)(parameterArea);
							tooltip.show();
							if (focusNode) {
								window.setTimeout(function() {
										focusNode.focus();
										if (focusNode.select) {
											focusNode.select();
										}
								}, 0);
							}
							collecting = true;
						}
					}
					if (!collecting) {
						mMetrics.logEvent("command", "invoke", commandInvocation.command.id); //$NON-NLS-1$ //$NON-NLS-0$
						// Just call the callback with the information we had.
						return commandInvocation.command.callback.call(commandInvocation.handler || window, commandInvocation);
					}
				} else {
					mMetrics.logEvent("command", "invoke", commandInvocation.command.id); //$NON-NLS-1$ //$NON-NLS-0$
					// We should not be trying to collect parameters, just call the callback.
					return commandInvocation.command.callback.call(commandInvocation.handler || window, commandInvocation);
				}
			} else {
				window.console.log("Client attempted to invoke command without an available (rendered) command invocation"); //$NON-NLS-0$
			}
		},
		
		/**
		 * Collect the parameters specified in the given command invocation.  If parameters are
		 * collected successfully, invoke the command's callback. This method is used by clients who want to 
		 * control the timing of parameter collection.  For example, if a command must be executed before it can
		 * be determined what parameters are known, the client can try the command in the callback and then call
		 * this function if parameters are needed.  In this case, clients typically configure the parameters description
		 * options with "options.clientWillCollect" set to true.
		 *
		 * @see orion.commands.ParametersDescription
		 *
		 * @param {orion.commands.CommandInvocation} commandInvocation the current invocation of the command 
		 */
		collectParameters: function(commandInvocation,cancelCallback) {
			this._collectAndInvoke(commandInvocation, true, cancelCallback); 
		},
		
		/**
		 * Show the keybindings that are registered with the command registry inside the specified target node.
		 * @param {KeyAssistPanel} keyAssist the key assist panel
		 */
		showKeyBindings: function(keyAssist) {
			var scopes = {};
			var bindingString, binding;
			// see commands.js _processKey
			function execute(activeBinding) {
				return function() {
					Commands.executeBinding(activeBinding);
				};
			}
			var bindings = [];
			for (var aBinding in this._activeBindings) {
				binding = this._activeBindings[aBinding];
				if (binding && binding.keyBinding && binding.command && (binding.command.name || binding.command.tooltip)) {
					bindings.push(binding);
				}
			}
			bindings.sort(function (a, b) {
				var ta = a.command.name || a.command.tooltip;
				var tb = b.command.name || b.command.tooltip;
				return ta.localeCompare(tb);
			});
			for (var i=0; i<bindings.length; i++) {
				binding = bindings[i];
				// skip scopes and process at end
				if (binding.keyBinding.scopeName) {
					if (!scopes[binding.keyBinding.scopeName]) {
						scopes[binding.keyBinding.scopeName] = [];
					}
					scopes[binding.keyBinding.scopeName].push(binding);
				} else {
					bindingString = UIUtil.getUserKeyString(binding.keyBinding);
					keyAssist.createItem(bindingString, binding.command.name || binding.command.tooltip, execute(binding));
				}
			}
			for (var scopedBinding in scopes) {
				if (scopes[scopedBinding].length && scopes[scopedBinding].length > 0) {
					keyAssist.createHeader(scopedBinding);
					scopes[scopedBinding].forEach(function(binding) {
						bindingString = UIUtil.getUserKeyString(binding.keyBinding);
						keyAssist.createItem(bindingString, binding.command.name || binding.command.tooltip, execute(binding));
					});
				}	
			}
		},
		
		/** 
		 * Add a command to the command registry.  Nothing will be shown in the UI
		 * until this command is referenced in a contribution.
		 * @param {orion.commands.Command} command The command being added.
		 * @see registerCommandContribution
		 */
		addCommand: function(command) {
			this._commandList[command.id] = command;
			// Resolve any pending key/url bindings against this command
			var pending = this._pendingBindings[command.id];
			if (pending) {
				var _self = this;
				pending.forEach(function(binding) {
					_self._addBinding(command, binding.type, binding.binding, binding.bindingOnly);
				});
				delete this._pendingBindings[command.id];
			}
		},
		
		/**
		 * Registers a command group and specifies visual information about the group.
		 * @param {String} scopeId The id of a DOM element in which the group should be visible.  Required.
		 *  When commands are rendered for a particular element, the group will be shown only if its scopeId
		 *  matches the id being rendered.
		 * @param {String} groupId The id of the group, must be unique.  May be used for a dom node id of
		 *  the element representing the group
		 * @param {Number} position The relative position of the group within its parent.  Required.
		 * @param {String} [title] The title of the group, optional
		 * @param {String} [parentPath] The path of parent groups, separated by '/'.  For example,
		 *  a path of "group1Id/group2Id" indicates that the group belongs as a child of 
		 *  group2Id, which is itself a child of group1Id.  Optional.
		 * @param {String} [emptyGroupMessage] A message to show if the group is empty and the user activates the UI element
		 *  representing the group.  Optional.  If not specified, then the group UI element won't be shown when it is empty.
		 * @param {String} [imageClass] CSS class of an image to use for this group.
		 * @param {String} [tooltip] Tooltip to show on this group. If not provided, and the group uses an <code>imageClass</code>,
		 * the <code>title</code> will be used as the tooltip.
		 * @param {String} [selectionClass] CSS class to be appended when the command button is selected. Optional.
		 * @param {String} or {boolean} [defaultActionId] Id of an action from this group that should be invoked when the group is selected. This will add an
		 * arrow to the grup that will open the dropdown. Optionally this can be set to <code>true</code> instead of adding a particular action.
		 * If set to <code>true</code> the group will be renderer as if there was a default action, but instead of invoking the default action it will
		 * open the dropdown. Optional.
		 * @param {String} [extraClasses] A string containing space separated css classes that will be applied to group button
		 */	
		addCommandGroup: function(scopeId, groupId, position, title, parentPath, emptyGroupMessage, imageClass, tooltip, selectionClass, defaultActionId, extraClasses) {
			if (!this._contributionsByScopeId[scopeId]) {
				this._contributionsByScopeId[scopeId] = {};
			}
			var parentTable = this._contributionsByScopeId[scopeId];
			if (parentPath) {
				parentTable = this._createEntryForPath(parentTable, parentPath);		
			}
			
			if (parentTable[groupId]) {
				// update existing group definition if info has been supplied
				if (title) {
					parentTable[groupId].title = title;
				}
				if (position) {
					parentTable[groupId].position = position;
				}
				if (imageClass) {
					parentTable[groupId].imageClass = imageClass;
				}
				if (tooltip) {
					parentTable[groupId].tooltip = tooltip;
				}
				if (selectionClass) {
					parentTable[groupId].selectionClass = selectionClass;
				}
				
				if (extraClasses) {
					parentTable[groupId].extraClass = extraClasses;
				}
				
				if(defaultActionId === true){
					parentTable[groupId].pretendDefaultActionId = true;
				} else {
					parentTable[groupId].defaultActionId = defaultActionId;
				}
				

				parentTable[groupId].emptyGroupMessage = emptyGroupMessage;
			} else {
				// create new group definition
				parentTable[groupId] = {title: title, 
										position: position, 
										emptyGroupMessage: emptyGroupMessage,
										imageClass: imageClass,
										tooltip: tooltip,
										selectionClass: selectionClass,
										defaultActionId: defaultActionId === true ? null : defaultActionId,
										pretendDefaultActionId: defaultActionId === true,
										children: {},
										extraClasses: extraClasses};
				parentTable.sortedContributions = null;
			}
		},
		
		_createEntryForPath: function(parentTable, parentPath) {
			if (parentPath) {
				var segments = parentPath.split("/"); //$NON-NLS-0$
				segments.forEach(function(segment) {
					if (segment.length > 1) {
						if (!parentTable[segment]) {
							// empty slot with children
							parentTable[segment] = {position: 0, children: {}};
							parentTable.sortedContributions = null;
						} 
						parentTable = parentTable[segment].children;
					}
				});
			}
			return parentTable;	
		},
		
		/**
		 * Register a selection service that should be used for certain command scopes.
		 * @param {String} scopeId The id describing the scope for which this selection service applies.  Required.
		 *  Only contributions made to this scope will use the selection service.
		 * @param {orion.selection.Selection} selectionService the selection service for the scope.
		 */
		registerSelectionService: function(scopeId, selectionService) {
			if (!this._contributionsByScopeId[scopeId]) {
				this._contributionsByScopeId[scopeId] = {};
			}
			this._contributionsByScopeId[scopeId].localSelectionService = selectionService;
		},
		
		/**
		 * Register a command contribution, which identifies how a command appears
		 * on a page and how it is invoked.
		 * @param {String} scopeId The id describing the scope of the command.  Required.
		 *  This scope id is used when rendering commands.
		 * @param {String} commandId the id of the command.  Required.
		 * @param {Number} position the relative position of the command within its parent.  Required.
		 * @param {String} [parentPath=null] the path of any parent groups, separated by '/'.  For example,
		 *  a path of "group1Id/group2Id/command" indicates that the command belongs as a child of 
		 *  group2Id, which is itself a child of group1Id.  Optional.
		 * @param {boolean} [bindingOnly=false] if true, then the command is never rendered, but the key or URL binding is hooked.
		 * @param {orion.KeyBinding} [keyBinding] a keyBinding for the command.  Optional.
		 * @param {orion.commands.URLBinding} [urlBinding] a url binding for the command.  Optional.
		 */
		registerCommandContribution: function(scopeId, commandId, position, parentPath, bindingOnly, keyBinding, urlBinding) {
			if (!this._contributionsByScopeId[scopeId]) {
				this._contributionsByScopeId[scopeId] = {};
			}
			var parentTable = this._contributionsByScopeId[scopeId];
			if (parentPath) {
				parentTable = this._createEntryForPath(parentTable, parentPath);		
			} 
			
			// store the contribution
			parentTable[commandId] = {position: position};
			
			var command;
			// add to the bindings table now
			if (keyBinding) {
				command = this._commandList[commandId];
				if (command) {
					this._addBinding(command, "key", keyBinding, bindingOnly); //$NON-NLS-0$
				} else {
					this._addPendingBinding(commandId, "key", keyBinding, bindingOnly); //$NON-NLS-0$
				}
			}
			
			// add to the url key table
			if (urlBinding) {
				command = this._commandList[commandId];
				if (command) {
					this._addBinding(command, "url", urlBinding, bindingOnly); //$NON-NLS-0$
				} else {
					this._addPendingBinding(commandId, "url", urlBinding, bindingOnly); //$NON-NLS-0$
				}
			}
			// get rid of sort cache because we have a new contribution
			parentTable.sortedContributions = null;
		},
		
		unregisterCommandContribution: function(scopeId, commandId, parentPath){
			if (!this._contributionsByScopeId[scopeId]) {
				// scope does not exist
				return;
			}
			delete this._commandList[commandId];
			delete this._activeBindings[commandId];
			delete this._urlBindings[commandId];
			delete this._pendingBindings[commandId];
			var parentTable = this._contributionsByScopeId[scopeId];
			if(parentPath){
				var segments = parentPath.split("/"); //$NON-NLS-0$
				segments.forEach(function(segment) {
					if (segment.length > 1) {
						if (!parentTable[segment]) {
							// command does not exist in given path
							return;
						} 
						parentTable = parentTable[segment].children;
					}
				});
			}
			delete parentTable[commandId];
			
			parentTable.sortedContributions = null;
		},

		/**
		 * @param {String} type One of <code>"key"</code>, <code>"url"</code>.
		 */
		_addBinding: function(command, type, binding, bindingOnly) {
			if (!command.id) {
				throw new Error("No command id: " + command);
			}
			if (type === "key") { //$NON-NLS-0$
				this._activeBindings[command.id] = {command: command, keyBinding: binding, bindingOnly: bindingOnly};
			} else if (type === "url") { //$NON-NLS-0$
				this._urlBindings[command.id] = {command: command, urlBinding: binding, bindingOnly: bindingOnly};
			}
		},

		/**
		 * Remembers a key or url binding that has not yet been resolved to a command.
		 * @param {String} type One of <code>"key"</code>, <code>"url"</code>.
		 */
		_addPendingBinding: function(commandId, type, binding, bindingOnly) {
			this._pendingBindings[commandId] = this._pendingBindings[commandId] || [];
			this._pendingBindings[commandId].push({
				type: type,
				binding: binding,
				bindingOnly: bindingOnly
			});
		},

		_checkForTrailingSeparator: function(parent, style, autoRemove) {
			var last;
			if (style === "tool" || style === "button") { //$NON-NLS-1$ //$NON-NLS-0$
				last = parent.childNodes.length > 0 ? parent.childNodes[parent.childNodes.length-1] : null;
				if (last && last.classList.contains("commandSeparator")) { //$NON-NLS-0$
					if (autoRemove) {
						parent.removeChild(last);
						return false;
					} 
					return true;
				}
			}
			if (style === "menu") { //$NON-NLS-0$
				var items = lib.$$array("li > *", parent); //$NON-NLS-0$
				if (items.length > 0 && items[items.length - 1].classList.contains("dropdownSeparator")) { //$NON-NLS-0$
					last = items[items.length - 1];
					if (autoRemove) {
						// reachy reachy.  Remove the anchor's li parent
						last.parentNode.parentNode.removeChild(last.parentNode);
						return false;
					} else {
						return true;
					}
				}
			}
			return false;
		},

		/**
		 * Render the commands that are appropriate for the given scope.
		 * @param {String} scopeId The id describing the scope for which we are rendering commands.  Required.
		 *  Only contributions made to this scope will be rendered.
		 * @param {DOMElement} parent The element in which commands should be rendered.  If commands have been
		 *  previously rendered into this element, it is up to the caller to empty any previously generated content.
		 * @param {Object} [items] An item or array of items to which the command applies.  Optional.  If no
		 *  items are specified and a selection service was specified at creation time, then the selection
		 *  service will be used to determine which items are involved. 
		 * @param {Object} handler The object that should perform the command
		 * @param {String} renderType The style in which the command should be rendered.  "tool" will render
		 *  a tool image in the dom.  "button" will render a text button.  "menu" will render menu items.  
		 * @param {Object} [userData] Optional user data that should be attached to generated command callbacks
		 * @param {Object[]} [domNodeWrapperList] Optional an array used to record any DOM nodes that are rendered during this call.
		 *  If an array is provided, then as commands are rendered, an object will be created to represent the command's node.  
		 *  The object will always have the property "domNode" which contains the node created for the command.  If the command is
		 *  rendered using other means (toolkit widget) then the optional property "widget" should contain the toolkit
		 *  object that represents the specified dom node.
		 */	
		renderCommands: function(scopeId, parent, items, handler, renderType, userData, domNodeWrapperList) {
			if (typeof(scopeId) !== "string") { //$NON-NLS-0$
				throw "a scope id for rendering must be specified"; //$NON-NLS-0$
			}
			parent = lib.node(parent);
			if (!parent) { 
				throw "no parent";  //$NON-NLS-0$
			}

			var contributions = this._contributionsByScopeId[scopeId];

			if (!items && contributions) {
				var selectionService = contributions.localSelectionService || this._selectionService;
				var self = this;
				if (selectionService) {
					selectionService.getSelections(function(selections) {
						self.renderCommands(scopeId, parent, selections, handler, renderType, userData);
					});
				}
				return;
			} 
			if (contributions) {
				this._render(contributions, parent, items, handler, renderType || "button", userData, domNodeWrapperList); //$NON-NLS-0$
				// If the last thing we rendered was a group, it's possible there is an unnecessary trailing separator.
				this._checkForTrailingSeparator(parent, renderType, true);
			}
		},
		
		/**
		 * Destroy all DOM nodes and any other resources used by rendered commands.
		 * This call does not remove the commands from the command registry.  Clients typically call this
		 * function to empty a command area when a client wants to render the commands again due to some 
		 * change in state.  
		 * @param {String|DOMElement} parent The id or DOM node that should be emptied.
		 */
		destroy: function(parent) {
			parent = lib.node(parent);
			if (!parent) { 
				throw "no parent";  //$NON-NLS-0$
			}
			while (parent.hasChildNodes()) {
				var node = parent.firstChild;
				if (node.commandTooltip) {
					node.commandTooltip.destroy();
				}
				if (node.emptyGroupTooltip) {
					node.emptyGroupTooltip.destroy();
				}
				this.destroy(node);
				parent.removeChild(node);
			}
		},
		
		_render: function(contributions, parent, items, handler, renderType, userData, domNodeWrapperList, extraClasses) {
			// sort the items
			var sortedByPosition = contributions.sortedContributions;
			
			if (!sortedByPosition) {
				sortedByPosition = [];
				var pushedItem = false;
				for (var key in contributions) {
					if (Object.prototype.hasOwnProperty.call(contributions, key)) {
						var item = contributions[key];
						if (item && typeof(item.position) === "number") { //$NON-NLS-0$
							item.id = key;
							sortedByPosition.push(item);
							pushedItem = true;
						}
					}
				}
				if (pushedItem) {
					sortedByPosition.sort(function(a,b) {
						return a.position-b.position;
					});
					contributions.sortedContributions = sortedByPosition;
				}
			}
			// now traverse the sorted contributions and render as we go
			var index = 0;
			var self = this;
			sortedByPosition.forEach(function(contribution) {
				var id, invocation;
				
				if( !contribution.imageClass ){
					contribution.imageClass = null;
				}
				
				if (contribution.children && Object.getOwnPropertyNames(contribution.children).length > 0) {
					
					var childContributions = contribution.children;
					var created;
					if (renderType === "tool" || renderType === "button") { //$NON-NLS-0$ //$NON-NLS-1$
						if (contribution.title) {
							// We need a named menu button.  We used to first render into the menu and only 
							// add a menu button in the dom when we knew items were actually rendered.
							// For performance, though, we need to be asynchronous in traversing children, so we will 
							// add the menu button always and then remove it if we don't need it.  
							// If we wait until the end of asynch processing to add the menu button, the layout will have 
							// to be redone. The down side to always adding the menu button is that we may find out we didn't
							// need it after all, which could cause layout to change.
							var defaultInvocation;
							if(contribution.defaultActionId){
								contribution.pretendDefaultActionId = contribution.defaultActionId === true;
								var defaultChild = self._commandList[contribution.defaultActionId];
								if(defaultChild && (defaultChild.visibleWhen ? defaultChild.visibleWhen(items) : true)){
									defaultInvocation = new Commands.CommandInvocation(handler, items, userData, defaultChild, self);
									defaultInvocation.domParent = parent;
								} else {
									contribution.pretendDefaultActionId = true;
								}
							}
						
							created = self._createDropdownMenu(parent, contribution.title, null /*nested*/, null /*populateFunc*/, contribution.imageClass, contribution.tooltip, contribution.selectionClass, null, defaultInvocation, contribution.pretendDefaultActionId, contribution.extraClasses);
							if(domNodeWrapperList){
								mNavUtils.generateNavGrid(domNodeWrapperList, created.menuButton);
							}

							// render the children asynchronously
							if (created) {
//								window.setTimeout(function() {
									self._render(contribution.children, created.menu, items, handler, "menu", userData, domNodeWrapperList);  //$NON-NLS-0$
									// special post-processing when we've created a menu in an image bar.  We want to get rid 
									// of a trailing separator in the menu first, and then decide if our menu is necessary
									self._checkForTrailingSeparator(created.menu, "menu", true);  //$NON-NLS-0$
									// now determine if we actually needed the menu or not
									
									if (created.menu.childNodes.length === 0) {
										if (contribution.emptyGroupMessage) {
											if (!created.menuButton.emptyGroupTooltip) {
												created.menuButton.emptyGroupTooltip = new mTooltip.Tooltip({
													node: created.menuButton,
													text: contribution.emptyGroupMessage,
													trigger: "click", //$NON-NLS-0$
													position: ["below", "right", "above", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
												});
											}
										} else {
											if(domNodeWrapperList){
												mNavUtils.removeNavGrid(domNodeWrapperList, created.menuButton);
											}
											function remove(child) {
												if (child && child.parentNode) {
													child.parentNode.removeChild(child);
												}
											}
											remove(created.menu);
											remove(created.menuButton);
											remove(created.destroyButton);
										}
									} else {
										created.menuButton.style.visibility = "visible";  //$NON-NLS-0$
									}
//								}, 0);
							}
						} else {  
							// rendering a group using a separator on each end. We do it synchronously because order matters with
							// non grouped items.
							var sep;
							// Only draw a separator if there is a non-separator preceding it.
							if (parent.childNodes.length > 0 && !self._checkForTrailingSeparator(parent, renderType)) {
								sep = self.generateSeparatorImage(parent);
							}
							self._render(childContributions, parent, items, handler, renderType, userData, domNodeWrapperList); 
	
							// make sure that more than just the separator got rendered before rendering a trailing separator
							if (parent.childNodes.length > 0) {
								var lastRendered = parent.childNodes[parent.childNodes.length - 1];
								if (lastRendered !== sep) {
									sep = self.generateSeparatorImage(parent);
								}
							}
						}
					} else {
						// group within a menu
						if (contribution.title) {
							var subMenu = self._createDropdownMenu(parent, contribution.title, true, null, null, contribution.imageClass);
							if (subMenu) {
								self._render(childContributions, subMenu.menu, items, handler, "menu", userData, domNodeWrapperList);  //$NON-NLS-0$
								// special post-processing when we've created a menu in an image bar.  We want to get rid 
								// of a trailing separator in the menu first, and then decide if our menu is necessary
								self._checkForTrailingSeparator(subMenu.menu, "menu", true);  //$NON-NLS-0$
								// If no items rendered in the submenu, we don't need it.
								if (subMenu.menu.childNodes.length === 0 && subMenu.destroyButton) {
									parent.removeChild(subMenu.destroyButton);
								}
							}
						} else {  
							// menu items with leading and trailing separators
							// don't render a separator if there is nothing preceding
							if (parent.childNodes.length > 0) {
								self._generateMenuSeparator(parent);
							}
							// synchronously render the children since order matters
							self._render(childContributions, parent, items, handler, renderType, userData, domNodeWrapperList); 
							// Add a trailing separator if children rendered.
							self._generateMenuSeparator(parent);
						}
					}
				} else {
					// processing atomic commands
					var command = self._commandList[contribution.id];
					var render = command ? true : false;
					var keyBinding = null;
					var urlBinding = null;
					if (command) {
						invocation = new Commands.CommandInvocation(handler, items, userData, command, self);
						invocation.domParent = parent;
						var enabled = false;
						try {
							enabled = render && (command.visibleWhen ? command.visibleWhen(items) : true);
						} catch (e) {
							console.log(e);
							throw e;
						}
						// ensure that keybindings are bound to the current handler, items, and user data
						if (self._activeBindings[command.id] && self._activeBindings[command.id].keyBinding) {
							keyBinding = self._activeBindings[command.id];
							if (enabled) {
								keyBinding.invocation = invocation;
							} else {
								keyBinding.invocation = null;
							}
							// if it is a binding only, don't render the command.
							if (keyBinding.bindingOnly) {
								render = false;
							}
						}
						
						// same for url bindings
						if (self._urlBindings[command.id] && self._urlBindings[command.id].urlBinding) {
							urlBinding = self._urlBindings[command.id];
							if (enabled) {
								urlBinding.invocation = invocation;
							} else {
								urlBinding.invocation = null;
							}
							if (urlBinding.bindingOnly) {
								render = false;
							}
						}
						render = render && enabled;
					}
					if (render) {
						if (command.choiceCallback) {
							// special case.  The item wants to provide a set of choices
							var menuParent;
							var nested;
							if (renderType === "tool" || renderType === "button") { //$NON-NLS-1$ //$NON-NLS-0$
								menuParent = parent;
								nested = false;
								if (parent.nodeName.toLowerCase() === "ul") { //$NON-NLS-0$
									menuParent = document.createElement("li"); //$NON-NLS-0$
									parent.appendChild(menuParent);
								}
							} else {
								menuParent = parent;
								nested = true;
							}
							// dropdown button
							var populateFunction = function(menu) {
								command.populateChoicesMenu(menu, items, handler, userData, self);
							};
							self._createDropdownMenu(menuParent, command.name, nested, populateFunction.bind(command), command.imageClass, command.tooltip || command.title, command.selectionClass, command.positioningNode);
						} else {
							// Rendering atomic commands as buttons or menus
							invocation.handler = invocation.handler || this;
							invocation.domParent = parent;
							var element;
							var onClick = function(event) {
								self._invoke(invocation);
							};
							if (renderType === "menu") { //$NON-NLS-0$
								var bindingString = null;
								if (keyBinding && keyBinding.keyBinding) {
									bindingString = UIUtil.getUserKeyString(keyBinding.keyBinding);
								}
								element = Commands.createCommandMenuItem(parent, command, invocation, null, onClick, bindingString);
							} else if (renderType === "quickfix") { //$NON-NLS-0$
								id = renderType + command.id + index; //$NON-NLS-0$ // using the index ensures unique ids within the DOM when a command repeats for each item
								var commandDiv = document.createElement("div"); //$NON-NLS-0$
								parent.appendChild(commandDiv);
								element = Commands.createCommandItem(commandDiv, command, invocation, id, null, renderType === "button", onClick); //$NON-NLS-0$
							} else {
								id = renderType + command.id + index;  //$NON-NLS-0$ // using the index ensures unique ids within the DOM when a command repeats for each item
								element = Commands.createCommandItem(parent, command, invocation, id, null, renderType === "tool", onClick); //$NON-NLS-0$
							} 
							mNavUtils.generateNavGrid(domNodeWrapperList, element);
							invocation.domNode = element;
							index++;
						}
					} 
				}
			});
		},
		
		/*
		 * private.  Parent must exist in the DOM.
		 */
		_createDropdownMenu: function(parent, name, nested, populateFunction, icon, tooltip, selectionClass, positioningNode, defaultInvocation, pretendDefaultActionId, extraClasses) {
			parent = lib.node(parent);
			// We create dropdowns asynchronously so it's possible that the parent has been removed from the document 
			// by the time we are called.  If so, don't bother building a submenu for an orphaned menu.
			if (!parent || !lib.contains(document.body, parent)) {
				return null;
			}
			var menuButton, newMenu, dropdownArrow;
			var destroyButton, menuParent = parent;
			if (nested) {
				var range = document.createRange();
				range.selectNode(parent);
				var buttonFragment = range.createContextualFragment(SubMenuButtonFragment);
				// bind name to fragment variable
				lib.processTextNodes(buttonFragment, {ButtonText: name});
				parent.appendChild(buttonFragment);
				destroyButton = parent.lastChild;
				newMenu = destroyButton.lastChild;
				menuButton = newMenu.previousSibling;
				menuButton.dropdown = new mDropdown.Dropdown({dropdown: newMenu, populate: populateFunction, parentDropdown: parent.dropdown});
				newMenu.dropdown = menuButton.dropdown;
			} else {
				if (parent.nodeName.toLowerCase() === "ul") { //$NON-NLS-0$
					menuParent = document.createElement("li"); //$NON-NLS-0$
					parent.appendChild(menuParent);
					destroyButton = menuParent;
				}
				var buttonCss = null;
				if (icon) {
					buttonCss = "dropdownButtonWithIcon"; //$NON-NLS-0$ // This class distinguishes dropdown buttons with an icon from those without
					tooltip = tooltip || name; // No text and no tooltip => fallback to name
				}
				tooltip = icon ? (tooltip || name) : tooltip;
				var created = Commands.createDropdownMenu(menuParent, name, populateFunction, buttonCss, icon, false, selectionClass, positioningNode, defaultInvocation || pretendDefaultActionId, extraClasses);
				dropdownArrow = created.dropdownArrow;
				menuButton = created.menuButton;
				if (dropdownArrow) {
					if (defaultInvocation) {
						defaultInvocation.domNode = created.menuButton;
					}
					var self = this;
					menuButton.onclick = function(evt){
						var bounds = lib.bounds(dropdownArrow);
						if ((evt.clientX >= bounds.left || pretendDefaultActionId === true) && created.dropdown) {
							created.dropdown.toggle(evt);
						} else {
							self._invoke(defaultInvocation);
						}
					};
					if (created.dropdown) {
						menuButton.onkeydown = function(evt) {
							if (lib.KEY.DOWN === evt.keyCode) {
								created.dropdown.toggle(evt);
								lib.stop(evt);
							}
						};
					}
				}
				newMenu = created.menu;
				var tooltipText, hasDefault = defaultInvocation && defaultInvocation.command && (defaultInvocation.command.tooltip || defaultInvocation.command.name);
				if (hasDefault) {
					tooltipText = defaultInvocation.command.tooltip || defaultInvocation.command.name;
				} else if (hasDefault) {
					tooltipText = tooltip;
				}
				if (tooltipText) {
					menuButton.commandTooltip = new mTooltip.Tooltip({
						node: menuButton,
						text: tooltipText,
						position: ["above", "below", "right", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
					});					
				}
			}
			
			return {menuButton: menuButton, menu: newMenu, dropdown: menuButton.dropdown, destroyButton: destroyButton, dropdownArrow: dropdownArrow};
		},
		
		_generateMenuSeparator: function(dropdown) {
			if (!this._checkForTrailingSeparator(dropdown, "menu")) { //$NON-NLS-0$
				var item = document.createElement("li"); //$NON-NLS-0$
				item.classList.add("dropdownSeparator"); //$NON-NLS-0$
				var sep = document.createElement("span"); //$NON-NLS-0$
				sep.classList.add("dropdownSeparator"); //$NON-NLS-0$
				item.appendChild(sep);
				dropdown.appendChild(item);
			}
		},
		
				
		/**
		 * Add a dom node appropriate for using a separator between different groups
		 * of commands.  This function is useful when a page is precisely arranging groups of commands
		 * (in a table or contiguous spans) and needs to use the same separator that the command registry
		 * would use when rendering different groups of commands.
		 * @param {DOMElement} parent
		 */
		generateSeparatorImage: function(parent) {
			var sep;
			if (parent.nodeName.toLowerCase() === "ul") { //$NON-NLS-0$
				sep = document.createElement("li"); //$NON-NLS-0$
				parent.appendChild(sep);
			} else {
				sep = document.createElement("span"); //$NON-NLS-0$
				parent.appendChild(sep);
			}
			sep.classList.add("core-sprite-sep");  // location in sprite //$NON-NLS-0$
			sep.classList.add("imageSprite");  // sets sprite background //$NON-NLS-0$
			sep.classList.add("commandSeparator"); //$NON-NLS-0$
			return sep;
		}

	};  // end command registry prototype
	CommandRegistry.prototype.constructor = CommandRegistry;

	/**
	 * A URL binding defines how a URL token is bound to a command, and what parameter
	 * is provided
	 * @param {String} token the token in a URL query parameter that identifies the command
	 * @param {String} parameterName the name of the parameter being specified in the value of the query 
	 * 
	 * @name orion.commands.URLBinding
	 * @class
	 */
	function URLBinding (token, parameterName) {
		this.token = token;
		this.parameterName = parameterName;
	}
	URLBinding.prototype = /** @lends orion.commands.URLBinding.prototype */ {
		/**
		 * Returns whether this URL binding matches the given URL
		 * 
		 * @param url the URL.
		 * @returns {Boolean} whether this URL binding matches
		 */
		match: function (url) {
			//ensure this is only the hash portion
			var params = PageUtil.matchResourceParameters(url);
			if (typeof params[this.token] !== "undefined") { //$NON-NLS-0$
				this.parameterValue = params[this.token];
				return this;
			}
			return null;
		}
	};
	URLBinding.prototype.constructor = URLBinding;
	
	/**
	 * A CommandEventListener defines an (optional) UI event listener.
	 * 
	 * @param {String} name the name of the event
	 * @param {Function} handler the event handler function. The handler is provided two parameters on invocation, i. e.
	 * 			the DOM event and the undergoing commandInvocation objects.
	 * @param {Boolean} [capture] the (optional) flag used to determine whether to caputre the event or not
	 */
	function CommandEventListener (event, handler, capture) {
		this.event = event;
		this.handler = handler;
		this.capture = capture || false;
	}
	CommandEventListener.prototype.constructor = CommandEventListener;
	
	
	/**
	 * A CommandParameter defines a parameter that is required by a command.
	 *
	 * @param {String} name the name of the parameter
	 * @param {String} type the type of the parameter, one of the HTML5 input types, or "boolean"
	 * @param {String} [label] the (optional) label that should be used when showing the parameter
	 * @param {String} [value] the (optional) default value for the parameter
	 * @param {Number} [lines] the (optional) number of lines that should be shown when collecting the value.  Valid for type "text" only.
	 * @param {Object|Array} [eventListeners] the (optional) array or single command event listener
	 * @param {Function} [validator] a (optional) validator function
	 * 
	 * @name orion.commands.CommandParameter
	 * @class
	 */
	function CommandParameter (name, type, label, value, lines, eventListeners, validator) {
		this.name = name;
		this.type = type;
		this.label = label;
		this.value = value;
		this.lines = lines || 1;
		this.validator = validator;
		
		this.eventListeners = (Array.isArray(eventListeners)) ?
			eventListeners : (eventListeners ? [eventListeners] : []);
	}
	CommandParameter.prototype = /** @lends orion.commands.CommandParameter.prototype */ {
		/**
		 * Returns whether the user has requested to assign values to optional parameters
		 * 
		 * @returns {Boolean} whether the user has requested optional parameters
		 */
		optionsRequested: function () {
			return this.optionsRequested;
		}
	};
	CommandParameter.prototype.constructor = CommandParameter;
	
	/**
	 * A ParametersDescription defines the parameters required by a command, and whether there are additional
	 * optional parameters that can be specified.  The command registry will attempt to collect required parameters
	 * before calling a command callback.  The command is expected to provide UI for optional parameter, when the user has
	 * signalled a desire to provide optional information.
	 *
	 * @param {orion.commands.CommandParameter[]} parameters an array of CommandParameters that are required
	 * @param {Object} options The parameters description options object.
	 * @param {Boolean} options.hasOptionalParameters specifies whether there are additional optional parameters
	 *			that could be collected.  If true, then the collector will show an affordance for invoking an 
	 *			additional options collector and the client can use the optionsRequested flag to determine whether
	 *			additional parameters should be shown.  Default is false.
	 * @param {Boolean} options.clientCollect specifies whether the client will collect the parameters in its
	 *			callback.  Default is false, which means the callback will not be called until an attempt has
	 *			been made to collect parameters.
	 * @param {Function} options.getParameterElement a function used to look up the DOM element for a given parameter.
	 * @param {Function} options.getSubmitName a function used to return a name to use for the Submit button.
	 *
	 * @param {Function} [getParameters] a function used to define the parameters just before the command is invoked.  This is used
	 *			when a particular invocation of the command will change the parameters. The function will be passed
	 *          the CommandInvocation as a parameter. Any stored parameters will be ignored, and
	 *          replaced with those returned by this function. If no parameters (empty array or <code>null</code>) are returned,
	 *          then it is assumed that the command should not try to obtain parameters before invoking the command's callback
	 *          (similar to <code>options.clientCollect === true</code>).
	 * @name orion.commands.ParametersDescription
	 * @class
	 */
	function ParametersDescription (parameters, options, getParameters) {
		this._storeParameters(parameters);
		this._hasOptionalParameters = options && options.hasOptionalParameters;
		this._options = options;  // saved for making a copy
		this.optionsRequested = false;
		this.getParameters = getParameters;
		this.clientCollect = options && options.clientCollect;
		this.getParameterElement = options && options.getParameterElement;
		this.getSubmitName = options && options.getSubmitName;
		this.getCancelName = options && options.getCancelName;
		this.message = options && options.message;
	}
	ParametersDescription.prototype = /** @lends orion.commands.ParametersDescription.prototype */ {	
	
		_storeParameters: function(parameterArray) {
			this.parameterTable = null;
			if (parameterArray) {
				var table = this.parameterTable = {};
				parameterArray.forEach(function(parameter) {
					table[parameter.name] = parameter;
				});
			}
		},
		
		/**
		 * Update the stored parameters by running the stored function if one has been supplied.
		 */
		updateParameters: function(commandInvocation) {
			if (typeof this.getParameters === "function") { //$NON-NLS-0$
				this._storeParameters(this.getParameters(commandInvocation));
			}
		},
		
		/**
		 * Returns a boolean indicating whether any parameters have been specified.
		 *
		 * @returns {Boolean} whether there are parameters to collect.
		 */
		hasParameters: function() {
			return this.parameterTable !== null;
		},
		
		/**
		 * Returns a boolean indicating whether a collector should try to collect parameters.  If there
		 * are no parameters specified, or the client is expecting to collect them, this will return
		 * <code>false</code>.
		 *
		 * @returns {Boolean} indicating whether the caller should attempt to collect the parameters.
		 */
		shouldCollectParameters: function() {
			return !this.clientCollect && this.hasParameters();
		},
				
		/**
		 * Returns the CommandParameter with the given name, or <code>null</code> if there is no parameter
		 * by that name.
		 *
		 * @param {String} name the name of the parameter
		 * @returns {orion.commands.CommandParameter} the parameter with the given name
		*/
		parameterNamed: function(name) {
			return this.parameterTable[name];
		},
		
		/**
		 * Returns the value of the parameter with the given name, or <code>null</code> if there is no parameter
		 * by that name, or no value for that parameter.
		 *
		 * @param {String} name the name of the parameter
		 * @returns {String} the value of the parameter with the given name
		 */
		valueFor: function(name) {
			var parm = this.parameterTable[name];
			if (parm) {
				return parm.value;
			}
			return null;
		},
		
		/**
		 * Sets the value of the parameter with the given name.
		 *
		 * @param {String} name the name of the parameter
		 * @param {String} value the value of the parameter with the given name
		 */
		setValue: function(name, value) {
			var parm = this.parameterTable[name];
			if (parm) {
				parm.value = value;
			}
		},
		 
		/**
		 * Evaluate the specified function for each parameter.
		 *
		 * @param {Function} func a function which operates on a provided command parameter
		 *
		 */
		forEach: function(func) {
			for (var key in this.parameterTable) {
				if (this.parameterTable[key].type && this.parameterTable[key].name) {
					func(this.parameterTable[key]);
				}
			}
		},
		
		validate: function(name, value) {
			var parm = this.parameterTable[name];
			if (parm && parm.validator) {
				return parm.validator(value);
			}
			return true;
		},
		
		/**
		 * Make a copy of this description.  Used for collecting values when a client doesn't want
		 * the values to be persisted across different objects.
		 *
		 */
		 makeCopy: function() {
			var parameters = [];
			this.forEach(function(parm) {
				var newParm = new CommandParameter(parm.name, parm.type, parm.label, parm.value, parm.lines, parm.eventListeners, parm.validator);
				parameters.push(newParm);
			});
			var copy = new ParametersDescription(parameters, this._options, this.getParameters);
			// this value may have changed since the options
			copy.clientCollect = this.clientCollect;
			copy.message = this.message;
			return copy;
			
		 },
		 /**
		  * Return a boolean indicating whether additional optional parameters are available.
		  */
		 hasOptionalParameters: function() {
			return this._hasOptionalParameters;
		 }
	};
	ParametersDescription.prototype.constructor = ParametersDescription;

	//return the module exports
	return {
		CommandRegistry: CommandRegistry,
		URLBinding: URLBinding,
		ParametersDescription: ParametersDescription,
		CommandParameter: CommandParameter,
		CommandEventListener: CommandEventListener
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
 
 define('orion/git/gitPreferenceStorage',['orion/Deferred'], function(Deferred){
 
	/**
	 * Support class for using the orion preferences as a local
	 * git credentials storage.
	 *
	 * @param serviceRegistry [required] Service registry
	 */
	function PreferenceStorage(serviceRegistry){
		this._prefix = "/git/credentials";
		this._preferenceService = serviceRegistry.getService("orion.core.preference");
	}
	
	PreferenceStorage.prototype = {
		/**
		 * Saves the given git credentials for the given repository.
		 *
		 * @param repository [required] unique repository URL
		 * @param userCredentials.gitSshUsername [optional] git ssh username
		 * @param userCredentials.gitSshPassword [optional] git ssh password
		 * @param userCredentials.gitPrivateKey [optional] git private key
		 * @param userCredentials.gitPassphrase [optional] git passphrase
		 */
		put : function(repository, userCredentials){
			var credentials = {
				gitSshUsername : "",
				gitSshPassword : "",
				gitPrivateKey : "",
				gitPassphrase : ""
			};
			
			if(userCredentials !== undefined){
				if(userCredentials.gitSshUsername !== undefined && userCredentials.gitSshUsername !== null) { credentials.gitSshUsername = userCredentials.gitSshUsername; }
				if(userCredentials.gitSshPassword !== undefined && userCredentials.gitSshPassword !== null) { credentials.gitSshPassword = userCredentials.gitSshPassword; }
				if(userCredentials.gitPrivateKey !== undefined && userCredentials.gitPrivateKey !== null) { credentials.gitPrivateKey = userCredentials.gitPrivateKey; }
				if(userCredentials.gitPassphrase !== undefined && userCredentials.gitPassphrase !== null) { credentials.gitPassphrase = userCredentials.gitPassphrase; }
			}
			
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					var settings = pref.get("settings");
					if(settings === undefined){
						d.reject();
						return;
					}
				
					if(settings.enabled){
						pref.put(repository, credentials);
						d.resolve();
					} else { d.reject(); }
				}
			);
			
			return d;
		},
		
		/**
		 * Retrieves git credentials for the given repository.
		 * Some credentials fields may be in form of empty strings if not present in the storage.
		 *
		 * @param repository [required] unique repository URL
		 */
		get : function(repository){
			var credentials = {
				gitSshUsername : "",
				gitSshPassword : "",
				gitPrivateKey : "",
				gitPassphrase : ""
			};
			
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					var settings = pref.get("settings");
					if(settings === undefined){
						d.reject();
						return;
					}
				
					if(settings.enabled){
						var userCredentials = pref.get(repository);
						if(userCredentials !== undefined) { d.resolve(userCredentials); }
						else { d.resolve(credentials); }
					} else { d.reject(); }
				}
			);
			
			return d;
		},
		
		/**
		 * Determines whether the storage is enabled by the user or not.
		 */
		isEnabled : function(){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					var settings = pref.get("settings");
					if(settings === undefined){
						d.resolve(false);
						return;
					}
					
					d.resolve(settings.enabled);
				}
			);
			
			return d;
		},
		
		/**
		 * Enables the storage for futher use.
		 */
		enable : function(){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					pref.put("settings", { enabled : true });
					d.resolve();
				}
			);
			
			return d;
		},
		
		/**
		 * Disables the storage.
		 * Please note no credentials are erased.
		 */
		disable : function(){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					pref.put("settings", { enabled : false });
					d.resolve();
				}
			);
			
			return d;
		},
		
		/**
		 * Removes all credentials for the given repository.
		 *
		 * @param repository [required] unique repository URL
		 */
		remove : function(repository){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					pref.remove(repository);
					d.resolve();
				}
			);
			
			return d;
		},
		
		/**
		 * Returns all repository URLs, which have stored
		 * credentials in the storage.
		 */
		getRepositories : function(){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix, 2).then(
				function(pref){
					var result = [];
					var repositories = pref.keys();
					
					for(var i=0; i<repositories.length; ++i){
						if(repositories[i] !== "settings"){
							result.push(repositories[i]);
						}
					}
					
					d.resolve(result);
				}
			);
			
			return d;
		}
	};
	
	PreferenceStorage.prototype.constructor = PreferenceStorage;
	return PreferenceStorage;
 });

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
 
 define('orion/git/gitConfigPreference',['orion/Deferred'], function(Deferred){
 
	/**
	 * Support class for using the orion preferences as git config in settings page
	 *
	 * @param serviceRegistry [required] Service registry
	 */
	function GitConfigPreference(serviceRegistry){
		this._prefix = "/git/config"; //$NON-NLS-0$
		this._preferenceService = serviceRegistry.getService("orion.core.preference"); //$NON-NLS-0$
	}
	
	GitConfigPreference.prototype = {
		/**
		 * Get the {GitMail, GitName} object from the user preference.
		 */
		getConfig : function(){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix).then(
				function(pref){
					var userInfo = pref.get("userInfo"); //$NON-NLS-0$
					d.resolve(userInfo);
				}
			);
			return d;
		},
		
		/**
		 * Set the {GitMail, GitName} object into the user preference.
		 */
		setConfig : function(userInfo){
			var d = new Deferred();
			this._preferenceService.getPreferences(this._prefix).then(
				function(pref){
					pref.put("userInfo", userInfo); //$NON-NLS-0$
					d.resolve();
				}
			);
			return d;
		}
	};
	
	GitConfigPreference.prototype.constructor = GitConfigPreference;
	return GitConfigPreference;
 });

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/widgets/nls/messages',{
	root: {//Default message bundle
		"Choose a Folder": "Choose a Folder",
		"OK": "OK",
		"Profile": "Profile",
		"Sign out": "Sign out",
		"N/A": "N/A",
		"logged in since ": "logged in since ",
		"Sign in": "Sign in",
		"Authentication required!": "Authentication required!",
		"Name:": "Name:",
		"Plug-ins": "Plug-ins",
		"Properties": "Properties",
		"Services": "Services",
		"SFTP Transfer": "SFTP Transfer",
		"Remote host:": "Remote host:",
		"Port:": "SFTP Port:",
		"Remote path:": "Remote path:",
		"User name:": "User name:",
		"Password:": "Password:",
		"Start Transfer": "Start Transfer",
		"Location:": "Location:",
		"orion.sftpConnections": "orion.sftpConnections",
		"Drag a file here": "Drag a file here",
		"unzip zips": "Unzip *.zip files",
		"or if you prefer": "(or upload a file using the buttons below)",
		"Upload" : "Upload",
		"Browse...": "Browse...",
		"Import a file or zip": "Import a file or zip",
		"MissingSearchRenderer": "Missing required argument: searchRenderer",
		"Find File Named": "Find File Named",
		"Search": "Search",
		"FileName FolderName": "FileName FolderName(Optional)",
		"Searching...": "Searching...",
		"SearchOccurences": "Searching for occurrences of: \"${0}\"",
		"name": "name",
		"test": "test",
		"Type the name of a file to open (? = any character, * = any string):": "Type the name of a file to open (? = any character, * = any string):",
		"Sign Out": "Sign Out",
		"Sign In": "Sign In",
		"Help": "Help",
		"Report a Bug": "Report a Bug",
		"Keyboard Shortcuts": "Keyboard Shortcuts",
		"Settings": "Settings",
		"View profile of ": "View profile of ",
		"Profiles": "Profiles",
		"Information Needed": "Information Needed",
		"Cancel": "Cancel",
		"If the same file exists in both the source and destination:" : "If the same file exists in both the source and destination:",
		"Cancel the transfer" : "Cancel the transfer",
		"Always overwrite destination" : "Always overwrite destination",
		"Overwrite if source is newer" : "Overwrite if source is newer",
		"New" : "New",
		"Building file skeleton..." : "Building file skeleton...",
		"Add" : "Add",
		"Upload..." : "Upload...",
		"AvailableCmdsType": "For a list of available commands type '${0}'.",
		"Main Pages": "Main Pages",
		"Related Links": "Related Links",
		"Yes": "Yes",
		"No": "No",
		"DeleteSearchTrmMsg": "Click or use delete key to delete the search term",
		"Application": "Application",
		"selectLaunchConfig": "Applications in project",
		"createNew": "Create New...",
		"Running": "Running",
		"checkingStateMessage": "Checking status of ${0}",
		"Status": "Status"
	},
	"ja": true,
	"zh": true,
	"zh-tw": true,
	"fr": true,
	"de": true,
	"it": true,
	"es": true,
	"pt-br": true						
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/ja/messages',{
	"Choose a Folder": "フォルダーの選択",
	"OK": "OK",
	"Profile": "プロファイル",
	"Sign out": "サインアウト",
	"N/A": "N/A",
	"logged in since ": "ログイン時刻",
	"Sign in": "サインイン",
	"Authentication required!": "認証が必要です!",
	"Name:": "名前:",
	"Plug-ins": "プラグイン",
	"Properties": "プロパティー",
	"Services": "サービス",
	"SFTP Transfer": "SFTP 転送",
	"Remote host:": "リモート・ホスト:",
	"Port:": "SFTP ポート:",
	"Remote path:": "リモート・パス:",
	"User name:": "ユーザー名:",
	"Password:": "パスワード:",
	"Start Transfer": "転送開始",
	"Location:": "ロケーション:",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "ファイルをここにドラッグ",
	"unzip zips": "*.zip ファイルを unzip します",
	"or if you prefer": "(または下にあるボタンを使用してファイルをアップロードします)",
	"Upload" : "アップロード",
	"Browse...": "参照...",
	"Import a file or zip": "ファイルまたは zip のインポート",
	"MissingSearchRenderer": "必須引数が欠落: searchRenderer",
	"Find File Named": "名前を指定してファイルを検索",
	"Search": "検索",
	"FileName FolderName": "ファイル名 フォルダー名 (オプション)",
	"Searching...": "検索中...",
	"SearchOccurences": "出現箇所を検索中: \"${0}\"",
	"name": "name",
	"test": "test",
	"Type the name of a file to open (? = any character, * = any string):": "開くファイルの名前を入力 (? = 任意の文字、* = 任意のストリング):",
	"Sign Out": "サインアウト",
	"Sign In": "サインイン",
	"Help": "ヘルプ",
	"Report a Bug": "バグの報告",
	"Keyboard Shortcuts": "キーボード・ショートカット",
	"Settings": "設定",
	"View profile of ": "プロファイル表示の対象",
	"Profiles": "プロファイル",
	"Information Needed": "必要な情報",
	"Cancel": "キャンセル",
	"If the same file exists in both the source and destination:" : "ソースおよび宛先の両方に同じファイルが存在する場合:",
	"Cancel the transfer" : "転送をキャンセルします",
	"Always overwrite destination" : "常に宛先を上書きします",
	"Overwrite if source is newer" : "ソースが新しい場合に上書きします",
	"New" : "新規",
	"Building file skeleton..." : "ファイルのスケルトンを作成中...",
	"Add" : "追加",
	"Upload..." : "アップロード...",
	"AvailableCmdsType": "使用可能なコマンドのリストを参照するには、'${0}' と入力します。",
	"Main Pages": "メイン・ページ",
	"Related Links": "関連リンク",
	"Yes": "はい",
	"No": "いいえ",
	"DeleteSearchTrmMsg": "検索語を削除するには、クリックするか、Delete キーを使用します"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/zh/messages',{
	"Choose a Folder": "选择文件夹",
	"OK": "确定",
	"Profile": "概要文件",
	"Sign out": "注销",
	"N/A": "不适用",
	"logged in since ": "登录时间",
	"Sign in": "登录",
	"Authentication required!": "需要认证！",
	"Name:": "名称：",
	"Plug-ins": "插件",
	"Properties": "属性",
	"Services": "服务",
	"SFTP Transfer": "SFTP 传输",
	"Remote host:": "远程主机：",
	"Port:": "SFTP 端口：",
	"Remote path:": "远程路径：",
	"User name:": "用户名：",
	"Password:": "密码：",
	"Start Transfer": "开始传输",
	"Location:": "位置：",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "请在此处拖动一个文件",
	"unzip zips": "将 *.zip 文件解压缩",
	"or if you prefer": "（或者使用下列按钮来上载文件）",
	"Upload" : "上载",
	"Browse...": "浏览...",
	"Import a file or zip": "导入文件或 zip 文件",
	"MissingSearchRenderer": "缺少必需参数：searchRenderer",
	"Find File Named": "查找所指定的文件",
	"Search": "搜索",
	"FileName FolderName": "文件名 文件夹名称（可选）",
	"Searching...": "正在搜索...",
	"SearchOccurences": "正在搜索“${0}”的出现位置",
	"name": "名称",
	"test": "测试",
	"Type the name of a file to open (? = any character, * = any string):": "输入要打开的文件的名称（? 表示任意字符，* 表示任意字符串）：",
	"Sign Out": "注销",
	"Sign In": "登录",
	"Help": "帮助",
	"Report a Bug": "报告错误",
	"Keyboard Shortcuts": "键盘快捷键",
	"Settings": "设置",
	"View profile of ": "查看概要文件",
	"Profiles": "个人档案",
	"Information Needed": "所需要的信息",
	"Cancel": "取消",
	"If the same file exists in both the source and destination:" : "如果同一文件存在于源和目标：",
	"Cancel the transfer" : "取消传输",
	"Always overwrite destination" : "总是覆盖目标",
	"Overwrite if source is newer" : "如果源比较新，那么覆盖",
	"New" : "新建",
	"Building file skeleton..." : "正在构建文件框架...",
	"Add" : "添加",
	"Upload..." : "上载...",
	"AvailableCmdsType": "获取可用命令类型“${0}”的列表。",
	"Main Pages": "主页",
	"Related Links": "相关链接",
	"Yes": "是",
	"No": "否",
	"DeleteSearchTrmMsg": "单击或者使用“删除”键来删除搜索项"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/zh-tw/messages',{
	"Choose a Folder": "選擇資料夾",
	"OK": "確定",
	"Profile": "設定檔",
	"Sign out": "登出",
	"N/A": "N/A",
	"logged in since ": "登入時間 ",
	"Sign in": "登入",
	"Authentication required!": "需要鑑別！",
	"Name:": "名稱：",
	"Plug-ins": "外掛程式",
	"Properties": "內容",
	"Services": "服務",
	"SFTP Transfer": "SFTP 傳送",
	"Remote host:": "遠端主機：",
	"Port:": "SFTP 埠：",
	"Remote path:": "遠端路徑：",
	"User name:": "使用者名稱：",
	"Password:": "密碼：",
	"Start Transfer": "開始傳送",
	"Location:": "位置：",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "將檔案拖曳到這裡",
	"unzip zips": "解壓縮 *.zip 檔",
	"or if you prefer": "（或使用下列按鈕來上傳檔案）",
	"Upload" : "上傳",
	"Browse...": "瀏覽...",
	"Import a file or zip": "匯入檔案或 zip",
	"MissingSearchRenderer": "遺漏必要引數：searchRenderer",
	"Find File Named": "尋找指名的檔案",
	"Search": "搜尋",
	"FileName FolderName": "檔名 資料夾名稱（選用）",
	"Searching...": "搜尋中...",
	"SearchOccurences": "搜尋相符項目：\"${0}\"",
	"name": "名稱",
	"test": "測試",
	"Type the name of a file to open (? = any character, * = any string):": "輸入要開啟的檔案的名稱（? = 任何字元，* = 任何字串）：",
	"Sign Out": "登出",
	"Sign In": "登入",
	"Help": "說明",
	"Report a Bug": "報告錯誤",
	"Keyboard Shortcuts": "鍵盤快速鍵",
	"Settings": "設定",
	"View profile of ": "檢視設定檔 ",
	"Profiles": "設定檔",
	"Information Needed": "需要資訊",
	"Cancel": "取消",
	"If the same file exists in both the source and destination:" : "如果相同的檔案同時存在於來源和目的地：",
	"Cancel the transfer" : "取消傳送",
	"Always overwrite destination" : "一律改寫目的地",
	"Overwrite if source is newer" : "如果來源較新就改寫",
	"New" : "新建",
	"Building file skeleton..." : "建置檔案 Skeleton...",
	"Add" : "新增",
	"Upload..." : "上傳...",
	"AvailableCmdsType": "如需可用的指令清單，請鍵入 '${0}'。",
	"Main Pages": "主頁面",
	"Related Links": "相關鏈結",
	"Yes": "是",
	"No": "否",
	"DeleteSearchTrmMsg": "按一下或使用刪除鍵來刪除搜尋詞彙"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/fr/messages',{
	"Choose a Folder": "Sélectionnez un dossier",
	"OK": "OK",
	"Profile": "Profil",
	"Sign out": "Déconnexion",
	"N/A": "Non applicable",
	"logged in since ": "connecté depuis ",
	"Sign in": "Connexion",
	"Authentication required!": "Authentification obligatoire !",
	"Name:": "Nom :",
	"Plug-ins": "Plug-in",
	"Properties": "Propriétés",
	"Services": "Services",
	"SFTP Transfer": "Transfert SFTP",
	"Remote host:": "Hôte distant :",
	"Port:": "Port SFTP :",
	"Remote path:": "Chemin d'accès distant :",
	"User name:": "Nom d'utilisateur :",
	"Password:": "Mot de passe :",
	"Start Transfer": "Démarrer le transfert",
	"Location:": "Emplacement :",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "Faites glisser un fichier ici",
	"unzip zips": "Décompresser les fichiers *.zip",
	"or if you prefer": "(ou téléchargez en amont un fichier à l'aide des boutons ci-dessous)",
	"Upload" : "Télécharger",
	"Browse...": "Parcourir...",
	"Import a file or zip": "Importer un fichier non compressé ou un fichier zip",
	"MissingSearchRenderer": "Argument obligatoire manquant : searchRenderer",
	"Find File Named": "Rechercher le fichier nommé",
	"Search": "Rechercher",
	"FileName FolderName": "NomFichier NomDossier (facultatif)",
	"Searching...": "Recherche...",
	"SearchOccurences": "Recherche des occurrences de : \"${0}\"",
	"name": "name",
	"test": "test",
	"Type the name of a file to open (? = any character, * = any string):": "Entrez le nom d'un fichier à ouvrir (? = tout caractère, * = toute chaîne) :",
	"Sign Out": "Fermer la session",
	"Sign In": "Ouvrir une session",
	"Help": "Aide",
	"Report a Bug": "Signaler un bogue",
	"Keyboard Shortcuts": "Raccourcis-clavier",
	"Settings": "Paramètres",
	"View profile of ": "Afficher le profil de ",
	"Profiles": "Profils",
	"Information Needed": "Informations requises",
	"Cancel": "Annuler",
	"If the same file exists in both the source and destination:" : "Si le même fichier existe dans la source et la destination :",
	"Cancel the transfer" : "Annulez le transfert",
	"Always overwrite destination" : "Toujours écraser la destination",
	"Overwrite if source is newer" : "Ecraser si la source est plus récente",
	"New" : "Nouveau",
	"Building file skeleton..." : "Génération du squelette de fichier...",
	"Add" : "Ajoutez",
	"Upload..." : "Télécharger en amont...",
	"AvailableCmdsType": "Pour afficher la liste des commandes disponibles, entrez '${0}'.",
	"Main Pages": "Pages principales",
	"Related Links": "Liens connexes",
	"Yes": "Oui",
	"No": "Non",
	"DeleteSearchTrmMsg": "Cliquez sur Supprimer ou utilisez la touche de suppression pour supprimer un terme de recherche"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/de/messages',{
	"Choose a Folder": "Ordner auswählen",
	"OK": "OK",
	"Profile": "Profil",
	"Sign out": "Abmelden",
	"N/A": "Nicht zutreffend",
	"logged in since ": "angemeldet seit ",
	"Sign in": "Anmelden",
	"Authentication required!": "Authentifizierung erforderlich!",
	"Name:": "Name:",
	"Plug-ins": "Plug-ins",
	"Properties": "Eigenschaften",
	"Services": "Services",
	"SFTP Transfer": "SFTP-Transfer",
	"Remote host:": "Ferner Host:",
	"Port:": "SFTP-Port:",
	"Remote path:": "Ferner Pfad:",
	"User name:": "Benutzername:",
	"Password:": "Kennwort:",
	"Start Transfer": "Transfer starten",
	"Location:": "Position:",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "Datei hierher ziehen",
	"unzip zips": "ZIP-Dateien dekomprimieren",
	"or if you prefer": "(oder Datei mit Schaltflächen unten hochladen)",
	"Upload" : "Hochladen",
	"Browse...": "Durchsuchen...",
	"Import a file or zip": "Datei oder ZIP-Datei importieren",
	"MissingSearchRenderer": "Fehlendes erforderliches Argument: searchRenderer",
	"Find File Named": "Benannte Datei suchen",
	"Search": "Suchen",
	"FileName FolderName": "Dateiname Ordnername (Optional)",
	"Searching...": "Suchen...",
	"SearchOccurences": "Suche nach Vorkommen von: \"${0}\"",
	"name": "Name",
	"test": "Test",
	"Type the name of a file to open (? = any character, * = any string):": "Name der zu öffnenden Datei eingeben (? = beliebiges Zeichen, * = beliebige Zeichenfolge):",
	"Sign Out": "Abmelden",
	"Sign In": "Anmelden",
	"Help": "Hilfe",
	"Report a Bug": "Programmfehler melden",
	"Keyboard Shortcuts": "Tastaturkurzbefehle",
	"Settings": "Einstellungen",
	"View profile of ": "Profil anzeigen von ",
	"Profiles": "Profile",
	"Information Needed": "Information erforderlich",
	"Cancel": "Abbrechen",
	"If the same file exists in both the source and destination:" : "Wenn dieselbe Datei sowohl in der Quelle als auch im Ziel vorhanden ist:",
	"Cancel the transfer" : "Übertragung abbrechen",
	"Always overwrite destination" : "Ziel immer überschreiben",
	"Overwrite if source is newer" : "Überschreiben, falls Quelle neuer ist",
	"New" : "Neu",
	"Building file skeleton..." : "Datei-Skeleton wird erstellt...",
	"Add" : "Hinzufügen",
	"Upload..." : "Hochladen...",
	"AvailableCmdsType": "Geben Sie '${0}' ein, um eine Liste der verfügbaren Befehle anzuzeigen.",
	"Main Pages": "Hauptseiten",
	"Related Links": "Zugehörige Links",
	"Yes": "Ja",
	"No": "Nein",
	"DeleteSearchTrmMsg": "Klicken Sie hier oder verwenden Sie die Löschtaste, um den Suchbegriff zu löschen."
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/it/messages',{
	"Choose a Folder": "Seleziona una cartella",
	"OK": "OK",
	"Profile": "Profilo",
	"Sign out": "Scollega",
	"N/A": "N/D",
	"logged in since ": "eseguito accesso da ",
	"Sign in": "Collega",
	"Authentication required!": "Richiesta autenticazione!",
	"Name:": "Nome:",
	"Plug-ins": "Plug-in",
	"Properties": "Proprietà",
	"Services": "Servizi",
	"SFTP Transfer": "Trasferimento SFTP",
	"Remote host:": "Host remoto:",
	"Port:": "Porta SFTP:",
	"Remote path:": "Percorso remoto:",
	"User name:": "Nome utente:",
	"Password:": "Password:",
	"Start Transfer": "Avvia trasferimento",
	"Location:": "Posizione:",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "Trascina un file qui",
	"unzip zips": "Decomprimi i file *.zip",
	"or if you prefer": "(o caricare un file utilizzando i pulsanti di seguito)",
	"Upload" : "Carica",
	"Browse...": "Sfoglia...",
	"Import a file or zip": "Importa o comprimi un file",
	"MissingSearchRenderer": "Argomento obbligatorio mancante: searchRenderer",
	"Find File Named": "Trova file denominato",
	"Search": "Cerca",
	"FileName FolderName": "NomeFile NomeCartella(Facoltativo)",
	"Searching...": "Ricerca in corso...",
	"SearchOccurences": "Ricerca di ricorrenza di: \"${0}\"",
	"name": "nome",
	"test": "test",
	"Type the name of a file to open (? = any character, * = any string):": "Immetti il nome di un file per aprirlo (? = qualsiasi carattere, * = qualsiasi stringa):",
	"Sign Out": "Esci",
	"Sign In": "Accedi",
	"Help": "Guida",
	"Report a Bug": "Segnala un bug",
	"Keyboard Shortcuts": "Tasti di scelta rapida",
	"Settings": "Impostazioni",
	"View profile of ": "Visualizza profilo ",
	"Profiles": "Profili",
	"Information Needed": "Informazioni necessarie",
	"Cancel": "Annulla",
	"If the same file exists in both the source and destination:" : "Se esiste lo stesso nome sia nell'origine che nella destinazione:",
	"Cancel the transfer" : "Annulla il trasferimento",
	"Always overwrite destination" : "Sostituisci sempre la destinazione",
	"Overwrite if source is newer" : "Sostituisci se l'origine è più recente",
	"New" : "New",
	"Building file skeleton..." : "Creazione della struttura del file in corso...",
	"Add" : "Aggiungi",
	"Upload..." : "Carica...",
	"AvailableCmdsType": "Per un elenco di comandi disponibili immettere '${0}'.",
	"Main Pages": "Pagine principali",
	"Related Links": "Collegamenti correlati",
	"Yes": "Sì",
	"No": "No",
	"DeleteSearchTrmMsg": "Fare clic o utilizzare il tasto di eliminazione per eliminare il termine di ricerca"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/es/messages',{
	"Choose a Folder": "Elegir carpeta",
	"OK": "Aceptar",
	"Profile": "Perfil",
	"Sign out": "Finalizar sesión",
	"N/A": "N/D",
	"logged in since ": "sesión iniciada desde ",
	"Sign in": "Iniciar sesión",
	"Authentication required!": "Se necesita autenticación.",
	"Name:": "Nombre:",
	"Plug-ins": "Plug-ins",
	"Properties": "Propiedades",
	"Services": "Servicios",
	"SFTP Transfer": "Transferencia SFTP",
	"Remote host:": "Host remoto:",
	"Port:": "Puerto SFTP:",
	"Remote path:": "Vía de acceso remota:",
	"User name:": "Nombre de usuario:",
	"Password:": "Contraseña:",
	"Start Transfer": "Iniciar transferencia",
	"Location:": "Ubicación:",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "Arrastre aquí un archivo",
	"unzip zips": "Descomprimir archivos *.zip",
	"or if you prefer": "(o cargar un archivo utilizando los botones siguientes)",
	"Upload" : "Cargar",
	"Browse...": "Examinar...",
	"Import a file or zip": "Importar un archivo o un zip",
	"MissingSearchRenderer": "Falta un argumento necesario: searchRenderer",
	"Find File Named": "Buscar archivo denominado",
	"Search": "Buscar",
	"FileName FolderName": "NombreArchivo NombreCarpeta(Opcional)",
	"Searching...": "Buscando...",
	"SearchOccurences": "Buscando apariciones de: \"${0}\"",
	"name": "nombre",
	"test": "prueba",
	"Type the name of a file to open (? = any character, * = any string):": "Escriba el nombre del archivo que desea abrir (? = cualquier carácter, * = cualquier serie):",
	"Sign Out": "Finalizar sesión",
	"Sign In": "Iniciar sesión",
	"Help": "Ayuda",
	"Report a Bug": "Notificar un error",
	"Keyboard Shortcuts": "Accesos directos del teclado",
	"Settings": "Valores",
	"View profile of ": "Ver perfil de ",
	"Profiles": "Perfiles",
	"Information Needed": "Información necesaria",
	"Cancel": "Cancelar",
	"If the same file exists in both the source and destination:" : "Si el mismo archivo existe en el origen y en el destino:",
	"Cancel the transfer" : "Cancelar la transferencia",
	"Always overwrite destination" : "Sobrescribir siempre el destino",
	"Overwrite if source is newer" : "Sobrescribir si el origen es más reciente",
	"New" : "Nuevo",
	"Building file skeleton..." : "Construyendo esqueleto de archivo...",
	"Add" : "Añadir",
	"Upload..." : "Cargar...",
	"AvailableCmdsType": "Para obtener una lista de los mandatos disponibles, escriba '${0}'.",
	"Main Pages": "Páginas principales",
	"Related Links": "Enlaces relacionados",
	"Yes": "Sí",
	"No": "No",
	"DeleteSearchTrmMsg": "Pulse o utilice la tecla de supresión para suprimir el término de búsqueda"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 ******************************************************************************/

//NLS_CHARSET=UTF-8
/*eslint-env browser, amd*/
define('orion/widgets/nls/pt-br/messages',{
	"Choose a Folder": "Escolher uma Pasta",
	"OK": "OK",
	"Profile": "Perfil",
	"Sign out": "Desconectar",
	"N/A": "N/A",
	"logged in since ": "login efetuado desde ",
	"Sign in": "Registrar",
	"Authentication required!": "Autenticação necessária!",
	"Name:": "Nome:",
	"Plug-ins": "Plug-ins",
	"Properties": "Propriedades",
	"Services": "Serviços",
	"SFTP Transfer": "Transferência de SFTP",
	"Remote host:": "Host remoto:",
	"Port:": "Porta SFTP:",
	"Remote path:": "Caminho remoto:",
	"User name:": "Nome de usuário:",
	"Password:": "Senha:",
	"Start Transfer": "Iniciar Transferência",
	"Location:": "Local:",
	"orion.sftpConnections": "orion.sftpConnections",
	"Drag a file here": "Arraste um arquivo aqui",
	"unzip zips": "Descompacte os arquivos *.zip",
	"or if you prefer": "(ou faça upload de um arquivo utilizando os botões abaixo)",
	"Upload" : "Carregar",
	"Browse...": "Procurar...",
	"Import a file or zip": "Importar um arquivo ou zip",
	"MissingSearchRenderer": "Argumento necessário ausente: searchRenderer",
	"Find File Named": "Localizar Arquivo Nomeado",
	"Search": "Pesquisar",
	"FileName FolderName": "Nome do arquivo Nome da pasta (Opcional)",
	"Searching...": "Procurando...",
	"SearchOccurences": "Procurando por ocorrências de: \"${0}\"",
	"name": "nome",
	"test": "teste",
	"Type the name of a file to open (? = any character, * = any string):": "Digite o nome de um arquivo a ser aberto (? = qualquer caractere, * = qualquer cadeia):",
	"Sign Out": "Sair",
	"Sign In": "Conectar",
	"Help": "Ajuda",
	"Report a Bug": "Relatar um Erro",
	"Keyboard Shortcuts": "Atalhos do Teclado",
	"Settings": "Configurações",
	"View profile of ": "Visualizar perfil de ",
	"Profiles": "Perfis",
	"Information Needed": "Informações Necessárias",
	"Cancel": "Cancelar",
	"If the same file exists in both the source and destination:" : "Se o mesmo arquivo existir na origem e no destino:",
	"Cancel the transfer" : "Cancelar a transferência",
	"Always overwrite destination" : "Sempre sobrescrever o destino",
	"Overwrite if source is newer" : "Sobrescrever se a origem for mais nova",
	"New" : "Novo(a)",
	"Building file skeleton..." : "Construindo o esqueleto do arquivo...",
	"Add" : "Incluir",
	"Upload..." : "Fazer Upload...",
	"AvailableCmdsType": "Para obter uma lista de comandos disponíveis do tipo '${0}'.",
	"Main Pages": "Páginas Principais",
	"Related Links": "Links Relacionados",
	"Yes": "Sim",
	"No": "Não",
	"DeleteSearchTrmMsg": "Clique ou use a tecla delete para excluir o termo de procura"
});


/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/dialog',['orion/webui/littlelib', 'orion/uiUtils'], 
		function(lib, uiUtil) {
	/**
	 * Holds the current opened modal dialog.
	 */
	var modalDialogManager = {
		dialog: null
	};
		
	/**
	 * Dialog is used to implement common dialog behavior in Orion.
	 * Clients use the Dialog prototype and implement the following behavior:
	 *    1.  Ensure that the HTML template for the dialog content is defined in the prototype TEMPLATE variable
	 *        prior to calling the _initialize() function. Set the following fields in the dialog prior to calling the 
	 *        _initialize() function if applicable.
	 *
	 *        messages - If i18n message bindings are used in the template, set the messages field to the messages object that
	 *            should be used to bind strings.
	 *        title - If the dialog should display a title, set the title field.
	 *        buttons - If the dialog should show buttons along the bottom, set an array of button objects.  Each button should
	 *            have a text property that labels the button and a callback property that is called when the button is pushed.
	 *        modal - Set this field to true if modal behavior is desired.
	 * 
	 *    2.  To hook event listeners to elements in the dialog, implement the _bindToDOM function.  DOM elements
	 *        in the template will be bound to variable names prefixed by a '$' character.  For example, the
	 *        element with id "myElement" can be referenced with this.$myElement
	 *
	 *    3.  Implement any of _beforeShowing, _afterShowing, _beforeHiding, _afterHiding to perform initialization and cleanup work.
	 *
	 * Usage: Not instantiated by clients.  The prototype is used by the application dialog instance.
	 * 
	 * @name orion.webui.Dialog
	 */
	function Dialog() {
	}

	Dialog.prototype = /** @lends orion.webui.Dialog.prototype */ {
	
		DISABLED: "disabled", //$NON-NLS-0$
	
		/* Not used by clients */
		CONTAINERTEMPLATE:		
		'<div class="dialog" role="dialog">' + //$NON-NLS-0$
			'<div class="dialogTitle"><span id="title" class="dialogTitleText layoutLeft"></span><button aria-label="Close" class="dismissButton layoutRight core-sprite-close imageSprite" id="closeDialog"></button></div>' + //$NON-NLS-0$
			'<div id="dialogContent" class="dialogContent layoutBlock"></div>' + //$NON-NLS-1$ //$NON-NLS-0$
			'<div id="buttons" class="dialogButtons"></div>' + //$NON-NLS-1$ //$NON-NLS-0$
		'</div>', //$NON-NLS-0$

		/* 
		 * Called by clients once the dialog template has been bound to the TEMPLATE variable, and any additional options (title, buttons,
		 * messages, modal) have been set.
		 */
		_initialize: function() {
			var parent = document.body;
			this.$frameParent = parent;
			this.$$modalExclusions = this.$$modalExclusions || [];
			var range = document.createRange();
			range.selectNode(parent);
			var frameFragment = range.createContextualFragment(this.CONTAINERTEMPLATE);
			parent.appendChild(frameFragment);
			this.$frame = parent.lastChild;
//			this.handle = lib.addAutoDismiss([this.$frame], this.hide.bind(this));
			if (this.title) {
				lib.$("#title", this.$frame).appendChild(document.createTextNode(this.title)); //$NON-NLS-0$
			}
			this.$close = lib.$("#closeDialog", this.$frame);//$NON-NLS-0$
			var self = this;
			this.$close.addEventListener("click", function(event) { //$NON-NLS-0$
				self.hide();
			}, false);
						
			this.$parent = lib.$(".dialogContent", this.$frame); //$NON-NLS-0$
			range = document.createRange();
			range.selectNode(this.$parent);
			var contentFragment = range.createContextualFragment(this.TEMPLATE);
			if (this.messages) {
				lib.processTextNodes(contentFragment, this.messages);
			}
			this.$parent.appendChild(contentFragment);
			this.$buttonContainer = lib.$(".dialogButtons", this.$frame); //$NON-NLS-0$
			this._makeButtons();
			
			// hook key handlers.  This must be done after _makeButtons so that the default callback (if any)
			// is established.
			this.$frame.addEventListener("keydown", function (e) { //$NON-NLS-0$
				if(e.keyCode === lib.KEY.ESCAPE) {
					self.hide();
				} else if (e.keyCode === lib.KEY.ENTER && (typeof self._defaultCallback) === "function") { //$NON-NLS-0$
					self._defaultCallback();
				}
			}, false);
			
			this._bindElements(this.$parent);
			if (typeof this._bindToDom === "function") { //$NON-NLS-0$
				this._bindToDom(this.$parent);
			}
		},
		
		/*
		 * Internal.  Generates any specified buttons.
		 */
		_makeButtons: function() {
			if (this.$buttonContainer && Array.isArray(this.buttons)) {
				var self = this;
				this.buttons.forEach(function(buttonDefinition) {
					var button = uiUtil.createButton(buttonDefinition.text, buttonDefinition.callback);
					if (buttonDefinition.id) {
						button.id = buttonDefinition.id;
						self['$'+ button.id] = button; //$NON-NLS-0$					
					}
					if (buttonDefinition.isDefault) {
						self._defaultCallback = buttonDefinition.callback;
						self._defaultButton = button;
					}
					self.$buttonContainer.appendChild(button);
				});
			}
		},
		

		/*
		 * Internal.  Makes modal behavior by immediately returning focus to the dialog when user leaves the dialog, and by
		 * styling the background to look faded.
		 */
		_makeModal: function(parent) {
			var self = this;
			// We listen to focus lost and remember the last one with focus.  This is great for clicks away from dialog.
			this.$frame.addEventListener("blur", function(e) { //$NON-NLS-0$
				self.$lastFocusedElement = e.target;
			}, true);
			this._modalListener = function(e) { //$NON-NLS-0$
				var preventFocus =	!lib.contains(self.$frame, e.target);
				if (preventFocus) {
					for (var i = 0; i<self.$$modalExclusions.length; i++) {
						if (lib.contains(self.$$modalExclusions[i], e.target)) {
							preventFocus = false;
							break;
						}
					}
				}
				if (preventFocus) {
					window.setTimeout(function() {
						(self.$lastFocusedElement || self.$parent).focus();
					}, 0);
					lib.stop(e);
				}
			};
			this.$frameParent.addEventListener("focus", this._modalListener, true);  //$NON-NLS-0$
			this.$frameParent.addEventListener("click", this._modalListener, true);  //$NON-NLS-0$
			var children = this.$frameParent.childNodes;
			var exclude = false;
			this._addedBackdrop = [];
			for (var i=0; i<children.length; i++) {
				for (var j=0; j<this.$$modalExclusions.length; j++) {
					if (lib.contains(this.$$modalExclusions[j], children[i])) {
						exclude = true;
						break;
					}
				}
				if (!exclude && children[i] !== self.$frame && children[i].classList && !children[i].classList.contains("tooltipContainer")) { //$NON-NLS-0$
					var child = children[i];
					if (!child.classList.contains("modalBackdrop")) {  //$NON-NLS-0$
						child.classList.add("modalBackdrop"); //$NON-NLS-0$
						this._addedBackdrop.push(child);
					} 
				}
			}
			
			// When tabbing out of the dialog, using the above technique (restore to last focus) will put the focus on the last element, but
			// we want it on the first element, so let's prevent the user from tabbing out of the dialog.
			var lastTabbable =  lib.lastTabbable(this.$buttonContainer) || lib.lastTabbable(this.$parent);
			if (lastTabbable) {
				lastTabbable.addEventListener("keydown", function (e) { //$NON-NLS-0$
					if(e.keyCode === lib.KEY.TAB) {
						var firstTabbable = self._getFirstFocusField();
						if (firstTabbable && firstTabbable !== e.target) {
							firstTabbable.focus();
						}
						lib.stop(e);
					} 
				}, false);
			}
		},
		
		_addChildDialog: function(dialog) {
			// Allow the child dialog to take focus.
			this.$$modalExclusions.push(dialog.$frame || dialog.$parent);
		},
		
		_inModalExclusion: function(dialog) {
			// Allow the child dialog to take focus.
			return this.$$modalExclusions.some(function(item) {
				return dialog.$frame === item || dialog.$parent === item;
			});
		},
		
		/*
		 * Internal.  Binds any child nodes with id's to the matching field variables.
		 */
		_bindElements: function(node) {
			for (var i=0; i<node.childNodes.length; i++) {
				var child = node.childNodes[i];
				if (child.id) {
					this['$'+child.id] = child; //$NON-NLS-0$
				}
				this._bindElements(child);
			}
		},
		
		/*
		 * Internal.  Hides the dialog.  Clients should use the before and after
		 * hooks (_beforeHiding, _afterHiding) to do any work related to hiding the dialog, such
		 * as destroying resources.
		 */
		hide: function(keepCurrentModal) {
			var activeElement = document.activeElement;
			var hasFocus = this.$frameParent === activeElement || (this.$frameParent.compareDocumentPosition(activeElement) & 16) !== 0;
			var originalFocus = this.$originalFocus;
			if(!keepCurrentModal && modalDialogManager.dialog === this) {
				modalDialogManager.dialog = null;
			}
			if (typeof this._beforeHiding === "function") { //$NON-NLS-0$
				this._beforeHiding();
			}
			if (this._modalListener) {
				this.$frameParent.removeEventListener("focus", this._modalListener, true);  //$NON-NLS-0$
				this.$frameParent.removeEventListener("click", this._modalListener, true);  //$NON-NLS-0$
			}

			this.$frame.classList.remove("dialogShowing"); //$NON-NLS-0$
			lib.setFramesEnabled(true);
			if (typeof this._afterHiding === "function") { //$NON-NLS-0$
				this._afterHiding();
			}
			if (hasFocus && originalFocus && document.compareDocumentPosition(originalFocus) !== 1) {
				originalFocus.focus();
			}
			var self = this;
			if (!this.keepAlive) {
				window.setTimeout(function() { self.destroy(); }, 0);
			}
		}, 
		
		/*
		 * Internal.  Shows the dialog.  Clients should use the before and after
		 * hooks (_beforeShowing, _afterShowing) to do any work related to showing the dialog,
		 * such as setting initial focus.
		 */
		show: function(near) {
			if(this.modal){//Modal dialog should only appear once unless they are chain dialog
				this._makeModal();
				if(modalDialogManager.dialog) {//There is already modal dialog opened
					if(!modalDialogManager.dialog._inModalExclusion(this)) {//The dialog is NOT a child dialog of the exisitng dialog
						this.hide(true);
						return;
					}
				} else {
					modalDialogManager.dialog = this;
				}
			}
			if (typeof this._beforeShowing === "function") { //$NON-NLS-0$
				this._beforeShowing();
			}
			lib.setFramesEnabled(false);
			var rect = lib.bounds(this.$frame);
			var totalRect = lib.bounds(document.documentElement);
			var left, top;
			if (near) {
				var refRect = lib.bounds(near);
				top = refRect.top + refRect.height + 4;  // a little below
				left = refRect.left + 4; // a little offset from the left
				if (top + rect.height > totalRect.height) {
					top = Math.max(0, totalRect.height - rect.height - 4);  
				}
				if (left + rect.width > totalRect.width) {
					left = Math.max(0, totalRect.width - rect.width - 4);  
				}
			} else {
				// centered
				left = Math.max(0, (totalRect.width - rect.width) / 2);
				top = Math.max(0, (totalRect.height - rect.height) / 2);
			}
			this.$lastFocusedElement = this.$originalFocus = document.activeElement;
			this.$frame.style.top = top + "px"; //$NON-NLS-0$
			this.$frame.style.left = left + "px"; //$NON-NLS-0$ 
			this.$frame.classList.add("dialogShowing"); //$NON-NLS-0$
			if (typeof this._afterShowing === "function") { //$NON-NLS-0$
				this._afterShowing();
			}
			if (!this.customFocus) {
				// We should set the focus.  Pick the first tabbable content field, otherwise use default button.
				// If neither, find any button at all.
				var focusField = this._getFirstFocusField();
				focusField.focus();
			}
		},
		
		_getFirstFocusField: function() {
			return lib.firstTabbable(this.$parent) || 
				this._defaultButton ||
				lib.firstTabbable(this.$buttonContainer) ||
				this.$close;
		},
		
		/*
		 * Internal.  Cleanup and remove dom nodes.
		 */
		destroy: function() {
			if (!this.$frame) {
				return;
			}
			if(modalDialogManager.dialog === this) {
				modalDialogManager.dialog = null;
			}
			lib.setFramesEnabled(true);
			if (this._addedBackdrop && this._addedBackdrop.length > 0) {
				this._addedBackdrop.forEach(function(node) { //$NON-NLS-0$
					node.classList.remove("modalBackdrop"); //$NON-NLS-0$
				});
			}
			this.$frameParent.removeEventListener("focus", this._modalListener, true); //$NON-NLS-0$
			this.$frameParent.removeEventListener("click", this._modalListener, true); //$NON-NLS-0$
			this.$frameParent.removeChild(this.$frame);
			this.$frame = undefined;
			this.$parent = undefined;
		}
	};
	
	Dialog.prototype.constructor = Dialog;

	//return the module exports
	return {Dialog: Dialog};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/*global URL*/
define('orion/fileUtils',['require', 'orion/URL-shim'], function(require) {

	var tryParentRelative = true;
	function makeParentRelative(location) {
		var link = document.createElement('a'); //$NON-NLS-0$
		link.href = location;
		location = link.href;
		if (tryParentRelative) {
			try {
				if (window.location.host === parent.location.host && window.location.protocol === parent.location.protocol) {
					return location.substring(parent.location.href.indexOf(parent.location.host) + parent.location.host.length);
				} else {
					tryParentRelative = false;
				}
			} catch (e) {
				tryParentRelative = false;
			}
		}
		return location;
	}

	/**
	 * This class contains static utility methods. It is not intended to be instantiated.
	 * @class This class contains static utility methods.
	 * @name orion.fileUtils
	 */

	function makeRelative(location) {
		if (!location) {
			return location;
		}
		var hostName = window.location.protocol + "//" + window.location.host; //$NON-NLS-0$
		if (location.indexOf(hostName) === 0) {
			return location.substring(hostName.length);
		}
		return location;
	}

	//cache this
	var _workspaceUrlHref;
	if(!require.toUrl){
		_workspaceUrlHref =(new URL("/", window.location.href)).href;
	} else {
		_workspaceUrlHref =(new URL(require.toUrl("workspace"), window.location.href)).href;
	}
	/**
	 * Determines if the path represents the workspace root
	 * @name orion.util#isAtRoot
	 * @function
	 */
	function isAtRoot(path) {
		if (!path) {
			return false;
		}
		if (path === "/workspace") {
			return true; // sad but true
		}
		var pathUrl = new URL(path, window.location.href);
		return pathUrl.href.indexOf(_workspaceUrlHref) === 0; //$NON-NLS-0$
	}

	//return module exports
	return {
		makeParentRelative: makeParentRelative,
		makeRelative: makeRelative,
		isAtRoot: isAtRoot
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2009, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define('orion/explorers/explorer-table',[
	'i18n!orion/navigate/nls/messages',
	'orion/Deferred',
	'orion/webui/littlelib',
	'orion/i18nUtil',
	'orion/fileUtils',
	'orion/explorers/explorer',
	'orion/EventTarget',
	'orion/objects',
	'orion/util'
], function(messages, Deferred, lib, i18nUtil, mFileUtils, mExplorer, EventTarget, objects, util){

	/**
	 * Tree model used by the FileExplorer
	 */
	function FileModel(serviceRegistry, root, fileClient, idPrefix, excludeFiles, excludeFolders) {
		this.registry = serviceRegistry;
		this.root = root;
		this.fileClient = fileClient;
		this.idPrefix = idPrefix || "";
		this.excludeFiles = !!excludeFiles;
		this.excludeFolders = !!excludeFolders;
	}
	FileModel.prototype = new mExplorer.ExplorerModel(); 
	objects.mixin(FileModel.prototype, /** @lends orion.explorer.FileModel.prototype */ {
		getRoot: function(onItem){
			onItem(this.root);
		},
	
		/*
		 *	Process the parent and children, doing any filtering or sorting that may be necessary.
		 */
		processParent: function(parent, children) {
			// Note that the Parents property is not available for metadatas retrieved with fetchChildren().
			var parents = parent.Projects ? [] : [parent].concat(parent.Parents || []);
			if (this.excludeFiles || this.excludeFolders) {
				var filtered = [];
				for (var i in children) {
					var exclude = children[i].Directory ? this.excludeFolders : this.excludeFiles;
					if (!exclude) {
						filtered.push(children[i]);
						children[i].parent = parent;
						if (!children[i].Parents)
							children[i].Parents = parents;
					}
				}
				children = filtered;
			} else {
				for (var j in children) {
					children[j].parent = parent;
					if (!children[j].Parents)
						children[j].Parents = parents;
				}
			}
		
			//link the parent and children together
			parent.children = children;
	
			// not ideal, but for now, sort here so it's done in one place.
			// this should really be something pluggable that the UI defines
			parent.children.sort(this.sortChildren); 
			return children;
		},
		
		sortChildren: function(a, b) {
			var isDir1 = a.Directory;
			var isDir2 = b.Directory;
			if (isDir1 !== isDir2) {
				return isDir1 ? -1 : 1;
			}
			var n1 = a.Name && a.Name.toLowerCase();
			var n2 = b.Name && b.Name.toLowerCase();
			if (n1 < n2) { return -1; }
			if (n1 > n2) { return 1; }
			return 0;
		},
		
		getChildren: function(parentItem, /* function(items) */ onComplete) {
			var self = this;
			// the parent already has the children fetched
			if (parentItem.children) {
				onComplete(parentItem.children);
			} else if (parentItem.Directory!==undefined && parentItem.Directory===false) {
				onComplete([]);
			} else if (parentItem.Children) {
				onComplete(self.processParent(parentItem, parentItem.Children));
			} else if (parentItem.Location) {
				var progress = null;
				if(this.registry) {
					progress = this.registry.getService("orion.page.progress"); //$NON-NLS-0$
				}
				(progress ? progress.progress(this.fileClient.fetchChildren(parentItem.ChildrenLocation), messages["Fetching children of "] + parentItem.Name) : this.fileClient.fetchChildren(parentItem.ChildrenLocation)).then( //$NON-NLS-0$
					function(children) {
						if (self.destroyed) { return; }
						onComplete(self.processParent(parentItem, children));
					},
					function() {
						onComplete([]);
					}
				);
			} else {
				onComplete([]);
			}
		},
		
		hasChildren: function() {
			var result = false;
			if (this.root.Children) {
				result = this.root.Children.length > 0;
			}
			return result;
		}
	});
	
	FileModel.prototype.constructor = FileModel;


	/**
	 * Creates a new file explorer.
	 * @name orion.explorer.FileExplorer
	 * @class A user interface component that displays a table-oriented file explorer
	 * @extends orion.explorer.Explorer
	 *
	 * @param {Object} options.treeRoot an Object representing the root of the tree.
	 * @param {orion.selection.Selection} options.selection the selection service used to track selections.
	 * @param {orion.fileClient.FileClient} options.fileClient the file service used to retrieve file information
	 * @param {String|Element} options.parentId the id of the parent DOM element, or the parent DOM element itself.
	 * @param {Function} options.rendererFactory a factory that creates a renderer
	 * @param {Boolean} options.excludeFiles specifies that files should not be shown. Optional.
	 * @param {Boolean} options.excludeFolders specifies that folders should not be shown.  Optional.
	 * @param {Object} [options.navHandlerFactory] Optional factory to use for creating the explorer's nav handler. Must provide a function
	 * <code>createNavHandler(explorer, explorerNavDict, options)</code>.
	 * @param {orion.serviceregistry.ServiceRegistry} options.serviceRegistry  the service registry to use for retrieving other
	 *	Orion services.  Optional.  If not specified, then some features of the explorer will not be enabled, such as status reporting,
	 *  honoring preference settings, etc.
	 * @param {Boolean} [options.setFocus=true] Whether the explorer should steal keyboard focus when rendered. The default is to steal focus.
	 */
	/**
	 * Root model item of the tree.
	 * @name orion.explorer.FileExplorer#treeRoot
	 * @field
	 * @type Object
	 */
	/**
	 * Dispatches events describing model changes.
	 * @name orion.explorer.FileExplorer#modelEventDispatcher
	 * @type orion.EventTarget
	 */
	/**
	 * Handles model changes.
	 * @name orion.explorer.FileExplorer#modelHandler
	 * @type orion.explorer.FileExplorer.ModelHandler
	 */
	function FileExplorer(options) {
		EventTarget.attach(this);
		this.registry = options.serviceRegistry;
		this.treeRoot = options.treeRoot;
		this.selection = options.selection;
		this.fileClient = options.fileClient;
		this.excludeFiles = options.excludeFiles;
		this.excludeFolders = options.excludeFolders;
		this.navHandlerFactory = options.navHandlerFactory;
		this.parentId = options.parentId;
		this.renderer = options.rendererFactory(this);
		this.dragAndDrop = options.dragAndDrop;
		this.setFocus = options.setFocus;
		this.model = null;
		this.myTree = null;
		this.checkbox = false;
		this._hookedDrag = false;
		var modelEventDispatcher = options.modelEventDispatcher ? options.modelEventDispatcher : new EventTarget();
		this.modelEventDispatcher = modelEventDispatcher;

		// Listen to model changes from fileCommands
		var _self = this;
		this._modelListeners = {};
		["copy", "copyMultiple", "create", "delete", "deleteMultiple", "import", //$NON-NLS-5$//$NON-NLS-4$//$NON-NLS-3$//$NON-NLS-2$//$NON-NLS-1$//$NON-NLS-0$
		 "move", "moveMultiple"].forEach(function(eventType) { //$NON-NLS-1$//$NON-NLS-0$
				modelEventDispatcher.addEventListener(eventType, _self._modelListeners[eventType] = _self.modelHandler[eventType].bind(_self));
			});
			
		this._clickListener = function(evt) {
			if (evt.target.tagName === "A") { //$NON-NLS-0$
				var temp = evt.target;
				while (temp) {
					if (temp._item) {
						break;
					}
					temp = temp.parentNode;
				}
				if (temp && temp._item) {
					_self.onLinkClick({type: "linkClick", item: temp._item}); //$NON-NLS-0$
				}
			}
		};
		var parent = lib.node(this.parentId);
		if (parent) {
			parent.addEventListener("click", this._clickListener); //$NON-NLS-0$
		}
	}
	
	var dragStartTarget, dropEffect;

	FileExplorer.prototype = Object.create(mExplorer.Explorer.prototype);
	objects.mixin(FileExplorer.prototype, /** @lends orion.explorer.FileExplorer.prototype */ {
		destroy: function() {
			var _self = this;
			Object.keys(this._modelListeners).forEach(function(eventType) {
				_self.modelEventDispatcher.removeEventListener(eventType, _self._modelListeners[eventType]);
			});
			var parent = lib.node(this.parentId);
			if (parent) {
				parent.removeEventListener("click", this._clickListener); //$NON-NLS-0$
			}
			mExplorer.Explorer.prototype.destroy.call(this);
		},
		onLinkClick: function(clickEvent) {
			this.dispatchEvent(clickEvent);
		},
		onModelCreate: function(modelEvent) {
			return this.changedItem(modelEvent.parent, true);
		},
		onModelCopy: function(modelEvent) {
			var ex = this, changedLocations = {};
			(modelEvent.items || [modelEvent]).forEach(function(item) {
				var itemParent = item.parent;
				itemParent = itemParent || ex.treeRoot;
				changedLocations[itemParent.Location] = itemParent;
			});
			return Deferred.all(Object.keys(changedLocations).map(function(loc) {
				return ex.changedItem(changedLocations[loc], true);
			}));
		},
		onModelMove: function(modelEvent) {
			var ex = this, changedLocations = {};
			(modelEvent.items || [modelEvent]).forEach(function(item) {
				var treeRoot = ex.treeRoot;
				if ((treeRoot.Location || treeRoot.ContentLocation) === item.oldValue.Location) {
					// the treeRoot was moved
					var oldRoot = ex.treeRoot;
					var newItem = item.newValue;
					var realNewItem = newItem.ChildrenLocation ? newItem : this.fileClient.read(newItem.ContentLocation, true);
					return Deferred.when(realNewItem, function(newItem) {
						ex.dispatchEvent({ type: "rootMoved", oldValue: oldRoot, newValue: newItem }); //$NON-NLS-0$
						ex.loadResourceList(newItem);
					});
				}
				var itemParent = item.oldValue.parent;
				itemParent = itemParent || ex.treeRoot;
				changedLocations[itemParent.Location] = itemParent;
				
				itemParent = item.parent;
				itemParent = itemParent || ex.treeRoot;
				changedLocations[itemParent.Location] = itemParent;
				
				// If the renamed item was an expanded directory, force an expand.
				if (item.oldValue.Directory && item.newValue && ex.isExpanded(item.oldValue)) {
					changedLocations[item.newValue.Location] = item.newValue;
				}
			});
			return Deferred.all(Object.keys(changedLocations).map(function(loc) {
				return ex.changedItem(changedLocations[loc], true);
			}));
		},
		onModelDelete: function(modelEvent) {
			var items = modelEvent.items || [modelEvent];
			var ex = this, treeRoot = ex.treeRoot;
			var newRoot;
			var treeRootDeleted = items.some(function(item) {
				if (item.oldValue.Location === (treeRoot.Location || treeRoot.ContentLocation)) {
					if (item.oldValue.Location !== (item.parent.Location || item.parent.ContentLocation)) {
						newRoot = item.parent;
					}
					return true;
				}
				return false;
			});
			if (treeRootDeleted) {
				return this.loadResourceList(newRoot);
			} else {
				// Refresh every parent folder
				var changedLocations = {};
				items.forEach(function(item) {
					var parent = item.parent;
					changedLocations[parent.Location] = parent;
				});
				return Deferred.all(Object.keys(changedLocations).map(function(loc) {
					return ex.changedItem(changedLocations[loc], true);
				}));
			}
		},
	
		/**
		 * Handles model changes. Subclasses can override these methods to control how the FileExplorer reacts to various types of model changes.
		 * The default implementations generally just refresh the affected row(s) in the explorer.
		 * @name orion.explorer.FileExplorer.ModelHandler
		 * @class Handles model changes in a FileExplorer.
		 */
		modelHandler: /** @lends orion.explorer.FileExplorer.ModelHandler.prototype */ {
			copy: function(modelEvent) {
				if (modelEvent.count) {
					return; // Handled in copyMultiple
				}
				return this.onModelCopy(modelEvent);
			},
			copyMultiple: function(modelEvent) {
				return this.onModelCopy(modelEvent);
			},
			create: function(modelEvent) {
				// refresh the node
				return this.onModelCreate(modelEvent);
			},
			"delete": function(modelEvent) { //$NON-NLS-0$
				if (modelEvent.count) {
					return; //Handled in deleteMultiple
				}
				return this.onModelDelete(modelEvent);
			},
			deleteMultiple: function(modelEvent) {
				return this.onModelDelete(modelEvent);
			},
			"import": function(modelEvent) { //$NON-NLS-0$
				var target = modelEvent.target;
				return this.changedItem(target, true);
			},
			move: function(modelEvent) {
				if (modelEvent.count) {
					return; //Handled in moveMultiple
				}
				return this.onModelMove(modelEvent);
			},
			moveMultiple: function(modelEvent) {
				return this.onModelMove(modelEvent);
			}
		},
		
		/**
		 * @param {Object} parentItem The item in the model which represents the new item's parent
		 * @param {Object} child An object describing the child that a placeholder needs to be created for.
		 * 			child.Name {String} The name of the child artifact
		 * 			child.Directory {Boolean} true if the child is a directory, false otherwise
		 * @param {String} domId The prefix to use for the Id of the newly created DOM nodes
		 * @returns A deferred that resolves with the placeholder object (see explorer.js->makeNewItemPlaceholder())
		 */
		makeNewChildItemPlaceholder: function(parentItem, child, domId) {
			var deferred = new Deferred();
			
			this.model.getChildren(parentItem, function(children){
				var item = null;
				var insertAfter = false;
				if(children) {
					children.push(child);
					children.sort(this.model.sortChildren);
					var childIndex = children.indexOf(child);
					var nextIndex = childIndex + 1;
					if (children.length > nextIndex) {
						item = children[nextIndex];
					} else {
						var previousIndex = childIndex - 1;
						//should be placed last
						if (0 <= previousIndex) {
							item = children[previousIndex];
						} else {
							item = parentItem;
						}
						
						insertAfter = true;
					}
				} else {
					//place before parentItem
					item = parentItem;
				}
				
				var placeholder = this.makeNewItemPlaceholder(item, domId, insertAfter);
				deferred.resolve(placeholder);
			}.bind(this));
			
			return deferred;
		},

		_makeDropTarget: function(item, node, persistAndReplace) {
			if (this.dragAndDrop) {
				var explorer = this;
				var performDrop = this.dragAndDrop;
				
				var dragStart = function(evt) {
					dragStartTarget = evt.target;
				};
				if (persistAndReplace) {
					if (this._oldDragStart) {
						node.removeEventListener("dragstart", this._oldDragStart, false); //$NON-NLS-0$
					}
					this._oldDragStart = dragStart;
				}
				node.addEventListener("dragstart", dragStart, false); //$NON-NLS-0$
				
				
				var dragEnd = function(evt) {
					dragStartTarget = null;
				};
				if (persistAndReplace) {
					if (this._oldDragEnd) {
						node.removeEventListener("dragend", this._oldDragEnd, false); //$NON-NLS-0$
					}
					this._oldDragEnd = dragEnd;
				}
				node.addEventListener("dragend", dragEnd, false); //$NON-NLS-0$
				
				var dragLeave = function(evt) { //$NON-NLS-0$
					node.classList.remove("dragOver"); //$NON-NLS-0$
					evt.preventDefault();
					evt.stopPropagation();
				};
				// if we are rehooking listeners on a node, unhook old before hooking and remembering new
				if (persistAndReplace) {
					if (this._oldDragLeave) {
						node.removeEventListener("dragleave", this._oldDragLeave, false); //$NON-NLS-0$
					}
					this._oldDragLeave = dragLeave;
				}
				node.addEventListener("dragleave", dragLeave, false); //$NON-NLS-0$
	
				var dragEnter = function (evt) {
					if (dragStartTarget) {
						var copy = util.isMac ? evt.altKey : evt.ctrlKey;
						dropEffect = evt.dataTransfer.dropEffect = copy ? "copy" : "move"; //$NON-NLS-1$ //$NON-NLS-0$
					} else {
						/* accessing dataTransfer.effectAllowed here throws an error on IE */
						if (!util.isIE && (evt.dataTransfer.effectAllowed === "all" ||   //$NON-NLS-0$
							evt.dataTransfer.effectAllowed === "uninitialized" ||  //$NON-NLS-0$
							evt.dataTransfer.effectAllowed.indexOf("copy") >= 0)) {   //$NON-NLS-0$
								evt.dataTransfer.dropEffect = "copy";  //$NON-NLS-0$
						}
					}
					node.classList.add("dragOver"); //$NON-NLS-0$
					lib.stop(evt);
				};
				if (persistAndReplace) {
					if (this._oldDragEnter) {
						node.removeEventListener("dragenter", this._oldDragEnter, false); //$NON-NLS-0$
					}
					this._oldDragEnter = dragEnter;
				}
				node.addEventListener("dragenter", dragEnter, false); //$NON-NLS-0$
	
				// this listener is the same for any time, so we don't need to remove/rehook.
				var dragOver = function (evt) {
					if (dragStartTarget) {
						var copy = util.isMac ? evt.altKey : evt.ctrlKey;
						dropEffect = evt.dataTransfer.dropEffect = copy ? "copy" : "move"; //$NON-NLS-1$ //$NON-NLS-0$
					} else {
						// default behavior is to not trigger a drop, so we override the default
						// behavior in order to enable drop.  
						// we have to specify "copy" again here, even though we did in dragEnter
						/* accessing dataTransfer.effectAllowed here throws an error on IE */
						if (!util.isIE && (evt.dataTransfer.effectAllowed === "all" ||   //$NON-NLS-0$
							evt.dataTransfer.effectAllowed === "uninitialized" ||  //$NON-NLS-0$
							evt.dataTransfer.effectAllowed.indexOf("copy") >= 0)) {   //$NON-NLS-0$
								evt.dataTransfer.dropEffect = "copy";  //$NON-NLS-0$
						}   
					}
					lib.stop(evt);
				};
				if (persistAndReplace && !this._oldDragOver) {
					node.addEventListener("dragover", dragOver, false); //$NON-NLS-0$
					this._oldDragOver = dragOver;
				}
	
				var progress = null;
				var statusService = null;
				if(explorer.registry) {
					progress = explorer.registry.getService("orion.page.progress"); //$NON-NLS-0$
					statusService = explorer.registry.getService("orion.page.message");	 //$NON-NLS-0$
				}
				
				var errorHandler = function(error) {
					if (statusService) {
						var errorMessage = null;
						if ("string" === typeof error) {
							errorMessage = {Severity: "Error", Message: error};
						} else if (error && error.error) {
							errorMessage = {Severity: "Error", Message: error.error};
						} else {
							errorMessage = error;	
						}
						statusService.setProgressResult(errorMessage);	//$NON-NLS-0$ 
					} else {
						window.console.log(error);
					}
				};
						
				function dropFileEntry(entry, target, explorer, performDrop, fileClient, deferredWrapper) {
					var preventNotification = false;
					var targetIsRoot = mFileUtils.isAtRoot(target.Location);
					if (deferredWrapper) {
						//this is a recursive call
						preventNotification = true;
						deferredWrapper.entryCount++;
					} else if (entry.isDirectory) {
						preventNotification = true; //we don't want to notify for each item that is in the folder
						deferredWrapper = {entryCount: 1, deferred: new Deferred()};
						explorer._makeUploadNode(target, entry.name, true).then(function(uploadNodeContainer){
							var cleanup = function() {
								uploadNodeContainer.destroyFunction();
								if (targetIsRoot) {
									explorer.loadResourceList(explorer.treeRoot.Path, true);	
								} else {
									explorer.changedItem(target);	
								}						
							};
							deferredWrapper.deferred.then(cleanup, cleanup);
						});
					}
					
					var decrementEntryCount = function() {
						if (deferredWrapper) {
							deferredWrapper.entryCount--;
							if (0 === deferredWrapper.entryCount) {
								deferredWrapper.deferred.resolve();
							}
						}
					};
					
					var internalErrorHandler = function(error) {
						if (statusService) {
							var errorMessage = null;
							if ("string" === typeof error) {
								errorMessage = {Severity: "Error", Message: error};
							} else if (error && error.error) {
								errorMessage = {Severity: "Error", Message: error.error};
							} else {
								errorMessage = error;	
							}
							statusService.setProgressResult(errorMessage);	//$NON-NLS-0$ 
						} else {
							window.console.log(error);
						}
						decrementEntryCount();
					};
					
					if (!target.Location && target.fileMetadata) {
						target = target.fileMetadata;
					}
					if (entry.isFile) {
						// can't drop files directly into workspace.
						if (targetIsRoot){ //$NON-NLS-0$
							internalErrorHandler(messages["CreateFolderErr"]); //$NON-NLS-0$
						} else {
							entry.file(function(file) {
								if (deferredWrapper) {
									// this is part of a folder upload, upload the file directly without showing 
									// progress for it but call decrementEntryCount when the upload finishes
									var unzip = file.name.indexOf(".zip") === file.name.length-4 && window.confirm(i18nUtil.formatMessage(messages["Unzip ${0}?"], file.name)); //$NON-NLS-1$ //$NON-NLS-0$
									var handlers = {
										error: function(event) {
											var errorMessage = messages["UploadingFileErr"] + file.name;
											if (statusService) {
												statusService.setProgressResult({Severity: "Error", Message: errorMessage}); //$NON-NLS-0$ 
											} else {
												window.console.log(errorMessage);
											}
										},
										loadend: decrementEntryCount
									};
									performDrop(target, file, explorer, unzip, false, handlers, true);
								} else {
									explorer._uploadFile(item, file, true);
								}
							}.bind(this));
						}
					} else if (entry.isDirectory) {
						var dirReader = entry.createReader();
						var traverseChildren = function(folder) {
							dirReader.readEntries(function(entries) {
								for (var i=0; i<entries.length; i++) {
									dropFileEntry(entries[i], folder, explorer, performDrop, fileClient, deferredWrapper); //$NON-NLS-0$
								}
								decrementEntryCount();
							});
						};
						
						if (targetIsRoot){ //$NON-NLS-0$
							(progress ? progress.progress(fileClient.createProject(target.ChildrenLocation, entry.name), i18nUtil.formatMessage(messages["Creating ${0}"], entry.name)) : 
										fileClient.createProject(target.ChildrenLocation, entry.name)).then(function(project) {
								(progress ? progress.progress(fileClient.read(project.ContentLocation, true), messages["Loading "] + project.name) :
											fileClient.read(project.ContentLocation, true)).then(function(folder) {
										traverseChildren(folder);
									}, internalErrorHandler);
							}, internalErrorHandler);
						} else {
							(progress ? progress.progress(fileClient.createFolder(target.Location, entry.name), i18nUtil.formatMessage(messages["Creating ${0}"], entry.name)) :
										fileClient.createFolder(target.Location, entry.name)).then(function(subFolder) {
								var dispatcher = explorer.modelEventDispatcher;
								if (!preventNotification) {
									dispatcher.dispatchEvent({ type: "create", parent: item, newValue: subFolder }); //$NON-NLS-0$	
								}
								traverseChildren(subFolder);
							}, internalErrorHandler);
						}
					}
				}
				
				var drop = function(evt) {
					var i, deferred;
					node.classList.remove("dragOver"); //$NON-NLS-0$
					
					if (dragStartTarget) {
						var fileClient = explorer.fileClient;
						var tmp = dragStartTarget;
						var source;
						while (tmp) {
							if (tmp._item) {
								source = tmp._item;
								break;
							}
							tmp = tmp.parentNode;
						}
						if (!source) {
							return;
						}
						
						var isCopy = dropEffect === "copy"; //$NON-NLS-0$
						var func = isCopy ? fileClient.copyFile : fileClient.moveFile;
						deferred = func.apply(fileClient, [source.Location, item.Location, source.Name]);
						if (progress) {
							var message = i18nUtil.formatMessage(messages[isCopy ? "Copying ${0}" : "Moving ${0}"], source.Location); //$NON-NLS-1$ //$NON-NLS-0$
							deferred = progress.showWhile(deferred, message);
						}
						deferred.then(function(result) {
							var dispatcher = explorer.modelEventDispatcher;
							dispatcher.dispatchEvent({type: isCopy ? "copy" : "move", oldValue: source, newValue: result, parent: item}); //$NON-NLS-1$ //$NON-NLS-0$
						}, errorHandler);
						
					// webkit supports testing for and traversing directories
					// http://wiki.whatwg.org/wiki/DragAndDropEntries
					} else if (evt.dataTransfer.items && evt.dataTransfer.items.length > 0) {
						for (i=0; i<evt.dataTransfer.items.length; i++) {
							var entry = null;
							if (typeof evt.dataTransfer.items[i].getAsEntry === "function") { //$NON-NLS-0$
								entry = evt.dataTransfer.items[i].getAsEntry();
							} else if (typeof evt.dataTransfer.items[i].webkitGetAsEntry === "function") { //$NON-NLS-0$
								entry = evt.dataTransfer.items[i].webkitGetAsEntry();
							}
							if (entry) {
								dropFileEntry(entry, item, explorer, performDrop, explorer.fileClient);
							}
						}
					} else if (evt.dataTransfer.files && evt.dataTransfer.files.length > 0) {
						for (i=0; i<evt.dataTransfer.files.length; i++) {
							var file = evt.dataTransfer.files[i];
							// this test is reverse engineered as a way to figure out when a file entry is a directory.
							// The File API in HTML5 doesn't specify a way to check explicitly (when this code was written).
							// see http://www.w3.org/TR/FileAPI/#file
							if (!file.size && !file.type) {
								errorHandler(i18nUtil.formatMessage(messages["FolderDropNotSupported"], file.name)); //$NON-NLS-0$
							} else if (mFileUtils.isAtRoot(item.Location)){ //$NON-NLS-0$
								errorHandler(messages["CreateFolderErr"]); //$NON-NLS-0$ 
							} else {
								explorer._uploadFile(item, file, true);
							}
						}
					}
					lib.stop(evt);
				};
					
				if (persistAndReplace) {
					if (this._oldDrop) {
						node.removeEventListener("drop", this._oldDrop, false); //$NON-NLS-0$
					}
					this._oldDrop = drop;
				}
				node.addEventListener("drop", drop, false); //$NON-NLS-0$
			}
		},
		
		/**
		 * Uploads the specified file as a child of the specified parent item.
		 * 
		 * @param {Object} parentItem The item in the model representing the folder under which the file should be placed.
	 	 * @param {File} file The file to upload.
	 	 * @param {Boolean} expandParent Specifies whether or not the parentItem should be expanded after the upload completes.
		 */
		_uploadFile: function(parentItem, file, expandParent) {
			var targetItem = parentItem;
			if (!targetItem.Location && targetItem.fileMetadata) {
				targetItem = targetItem.fileMetadata;
			}
			var uploadImpl = function() {
				this._makeUploadNode(targetItem, file.name, false).then(function(uploadNodeContainer){
					var refNode = uploadNodeContainer.refNode; //td
					var progressBar = uploadNodeContainer.progressBar;
					var cancelButton = uploadNodeContainer.cancelButton;
					var destroy = uploadNodeContainer.destroyFunction;
					
					var statusService = this.registry.getService("orion.page.message");	 //$NON-NLS-0$
					
					var handlers = {
						progress: function(event) {
							var percentageText = ""; //$NON-NLS-0$
							if (event.lengthComputable) {
								percentageText = Math.floor((event.loaded / event.total) * 100) + "%"; //$NON-NLS-0$
								progressBar.style.width = percentageText;
								var loadedKB = Math.round(event.loaded / 1024);
								var totalKB = Math.round(event.total / 1024);
								progressBar.title = messages["Upload progress: "] + percentageText + ",  " + loadedKB + "/" + totalKB + " KB"; //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
								refNode.title = progressBar.title;
							}
						},
						loadend: function(event) {
							destroy();
							this.changedItem(targetItem);
						}.bind(this),
						error: function(event) {
							var errorMessage = messages["UploadingFileErr"] + file.name; //$NON-NLS-0$
							if (statusService) {
								statusService.setProgressResult({Severity: "Error", Message: errorMessage});	//$NON-NLS-0$ 
							} else {
								window.console.log(errorMessage);
							}
						}
					};
						
					var unzip = file.name.indexOf(".zip") === file.name.length-4 && window.confirm(i18nUtil.formatMessage(messages["Unzip ${0}?"], file.name)); //$NON-NLS-1$ //$NON-NLS-0$
					var req = this.dragAndDrop(targetItem, file, this, unzip, false, handlers, true); 
					
					cancelButton.addEventListener("click", function(){ //$NON-NLS-0$
						req.abort();
					});
				}.bind(this));
			}.bind(this);
			
			if (expandParent) {
				this.expandItem(targetItem, false).then(uploadImpl);
			} else {
				uploadImpl();
			}
			
		},
		
		/**
		 * Creates a placeholder node in the navigator which shows the name
		 * of the artifact being uploaded as well as progress and an option
		 * to cancel the upload (if possible).
		 * 
		 * @param {Object} parentItem The item in the model representing the folder under which the file should be placed. Workspace root is supported.
	 	 * @param {String} artifactName The name of the file or folder being uploaded.
	 	 * @param {Boolean} isDirectory true if the artifact is a directory, false otherwise
	 	 * 
	 	 * @returns {orion.Deferred.promise} which resolves with the following object:
	 	 * 		 {Object} nodeContainer An object containing the following:
	 	 * 			nodeContainer.refNode The td of the newly created DOM node
	 	 * 			nodeContainer.tempNode The tr of the newly created DOM node (this is the top-level DOM node)
	 	 * 			nodeContainer.progressBar The DOM node containing the progress bar
	 	 * 			nodeContainer.cancelButton The DOM node of the upload cancel button (only if isFile === true)
	 	 * 			nodeContainer.destroyFunction The function that should be called to remove the temporary upload node from the navigator
		 */
		_makeUploadNode: function(parentItem, artifactName, isDirectory) {
			
			var domId = this.getRow(parentItem).id;
			var child = {Name: artifactName, Directory: isDirectory};
			
			return this.makeNewChildItemPlaceholder(parentItem, child, domId).then(function(placeholder) {
				var nodeContainer = null;
				var refNode, wrapperNode;
				if (placeholder) {
					nodeContainer = {};
					refNode = placeholder.refNode;
					wrapperNode = placeholder.wrapperNode;
					refNode.classList.add("uploadNode"); //$NON-NLS-0$
					
					nodeContainer.refNode = refNode;
					nodeContainer.wrapperNode = wrapperNode;
					
					var textSpan = document.createElement("span");
					textSpan.classList.add("uploadNodeText");
					textSpan.appendChild(document.createTextNode(artifactName));
					refNode.appendChild(textSpan); //$NON-NLS-0$
					
					var progressBarWrapper = document.createElement("span"); //$NON-NLS-0$
					progressBarWrapper.classList.add("progressBarWrapper"); //$NON-NLS-0$
					
					var progressBar = document.createElement("span"); //$NON-NLS-0$
					progressBar.classList.add("progressBar"); //$NON-NLS-0$
					progressBarWrapper.appendChild(progressBar);
					refNode.appendChild(progressBarWrapper);
					
					nodeContainer.progressBar = progressBar;
					
					if (isDirectory) {
						progressBar.classList.add("continuous"); //$NON-NLS-0$
						refNode.title = messages["Uploading "] + artifactName; //$NON-NLS-0$
						progressBar.title = refNode.title; //$NON-NLS-0$
					} else {
						var cancelButton = document.createElement("button"); //$NON-NLS-0$
						cancelButton.classList.add("imageSprite"); //$NON-NLS-0$
						cancelButton.classList.add("core-sprite-delete"); //$NON-NLS-0$
						cancelButton.classList.add("uploadCancelButton"); //$NON-NLS-0$
						cancelButton.title = messages["Cancel upload"]; //$NON-NLS-0$
						refNode.appendChild(cancelButton);
						
						nodeContainer.cancelButton = cancelButton;
					}
					
					nodeContainer.destroyFunction = placeholder.destroyFunction;
				}
				
				return nodeContainer;
			}.bind(this));
		},

		/**
		 * @name orion.explorer.FileExplorer#createModel
		 * @function Creates the explorer model.
		 * @returns {orion.explorer.FileModel}
		 */
		createModel: function() {
			return new FileModel(this.registry, this.treeRoot, this.fileClient, this.parentId, this.excludeFiles, this.excludeFolders);
		},

		/**
		 * @name orion.explorer.FileExplorer#changedItem
		 * @function
		 * we have changed an item on the server at the specified parent node
		 * @param {Object} parent The parent item under which the change occurred.
		 * @param {Boolean} forceExpand
		 * @returns {orion.Promise}
		 */
		changedItem: function(parent, forceExpand) {
			if (this.treeRoot && this.treeRoot.Location === parent.Location) {
				return this.loadResourceList(this.treeRoot, forceExpand);
			}
			var that = this;
			var deferred = new Deferred();
			parent.children = parent.Children = null;
			this.model.getChildren(parent, function(children) {
				//If a key board navigator is hooked up, we need to sync up the model
				if(that.getNavHandler()){
					//that._initSelModel();
				}
				that.myTree.refresh.bind(that.myTree)(parent, children, forceExpand);
				deferred.resolve(children);
			});
			return deferred;
		},

		/**
		 * Shows the given item.
		 * @param {Object} The item to be shown.
		 * @param {Booelan} [reroot=true] whether the receiver should re-root the tree if the item is not displayable.
		 * @returns {orion.Promise}
		 */
		showItem: function(item, reroot) {
			var deferred = new Deferred();
			if (!item || !this.model || !this.myTree || (!this.myTree.showRoot && item.Location === this.treeRoot.Location)) {
				return deferred.reject();
			}
			var row = this.getRow(item);
			if (row) {
				deferred.resolve(row._item || item);
			} else if (item.Parents && item.Parents.length>0) {
				item.Parents[0].Parents = item.Parents.slice(1);
				return this.expandItem(item.Parents[0], reroot).then(function(parent) {
					// Handles model out of sync
					var row = this.getRow(item);
					if (!row) {
						return this.changedItem(parent, true).then(function() {
							var row = this.getRow(item);
							if (!row) {
								parent.children.unshift(item);
								this.myTree.refresh(parent, parent.children, false);
								row = this.getRow(item);	
							}
							return row ? row._item : new Deferred().reject();
						}.bind(this));
					}
					return row._item || item;
				}.bind(this));
			} else {
				// Handles file not in current tree
				if (reroot === undefined || reroot) {
					return this.reroot(item);
				}
				return deferred.reject();
			}
			return deferred;
		},

		/**
		 * Expands the given item.
		 * @param {Object} The item to be expanded.
		 * @param {Booelan} [reroot=true] whether the receiver should re-root the tree if the item is not displayable.
		 * @returns {orion.Promise}
		 */
		expandItem: function(item, reroot) {
			var deferred = new Deferred();
			this.showItem(item, reroot).then(function(result) {
				if (this.myTree.isExpanded(result)) {
					deferred.resolve(result);
				} else {
					this.myTree.expand(this.model.getId(result), function() {
						deferred.resolve(result);
					});
				}
			}.bind(this), deferred.reject);
			return deferred;
		},
		
		/**
		 * Create and return the row for the given item
		 * @param {Object} The parent of the row.
		 * @param {Object} The contents of the row.
		 */
		insertMissingItem: function(parent, item) {
			return null;
		},
		
		/**
		 * Shows and selects the given item.
		 * @param {Object} The item to be revealed.
		 * @param {Booelan} [reroot=true] whether the receiver should re-root the tree if the item is not displayable.
		 * @returns {orion.Promise}
		 */
		reveal: function(item, reroot) {
			return this.showItem(item, reroot).then(function(result) {
				this.select(result);
			}.bind(this));
		},

		/**
		 * Re-roots the tree so that the given item is displayable.
		 * @param {Object} The item to be expanded.
		 * @returns {orion.Promise}
		 */
		reroot: function(item) {
			// Do nothing by default
			return new Deferred().reject();
		},

		/**
		 * Returns whether the given item is expanded.
		 * @param {Object} The item to be expanded.
		 * @returns {orion.Promise}
		 */
		isExpanded: function(item) {
			var rowId = this.model.getId(item);
			return this.renderer.tableTree.isExpanded(rowId);
		},

		/**
		 * Returns the node that a rename text input box should appear over top of.
		 * @name orion.explorer.FileExplorer#getNameNode
		 * @function
		 * @param {Object} item Item being renamed
		 * @returns {Element}
		 */
		getNameNode: function(item) {
			var rowId = this.model.getId(item);
			if (rowId) {
				// I know this from my renderer below.
				// TODO This approach fails utterly for a custom renderer, better hope they override this method.
				return lib.node(rowId+"NameLink"); //$NON-NLS-0$
			}
		},

		/**
		 * The explorerNavHandler hooked up by the explorer will call this function when left arrow key is pressed on a 
		 * top level item that is aleady collapsed. The default implementation does nothing.
		 * @name orion.explorer.FileExplorer#scopeUp
		 * @function
		 */
		scopeUp: function() {
		},

		/**
		 * The explorerNavHandler hooked up by the explorer will call this function when the focus into command is clicked.
		 * The default implementation does nothing.
		 * @name orion.explorer.FileExplorer#scopeDown
		 * @function
		 */
		scopeDown: function(item) {
		},

		/**
		 * Load the resource at the given path.
		 * @name orion.explorer.FileExplorer#loadResourceList
		 * @function
		 * @param {String|Object} path The path of the resource to load, or an object with a ChildrenLocation or ContentLocation field giving the path.
		 * @param {Boolean} [force] If true, force reload even if the path is unchanged. Useful
		 * when the client knows the resource underlying the current path has changed.
		 * @param {Function} postLoad a function to call after loading the resource. <b>Deprecated</b>: use the returned promise instead.
		 * @returns {orion.Promise}
		 */
		loadResourceList: function(path, force, postLoad) {
			if (path && typeof path === "object") { //$NON-NLS-0$
				path = path.ChildrenLocation || path.ContentLocation;
			}
			path = mFileUtils.makeRelative(path);
			if (!force && path === this._lastPath) {
				return new Deferred().resolve(this.treeRoot);
			}			
			this._lastPath = path;
			var self = this;
			if (force || (path !== this.treeRoot.Path)) {
				return this.load(this.fileClient.loadWorkspace(path), messages["Loading "] + path, postLoad).then(function(p) {
					self.treeRoot.Path = path;
					return new Deferred().resolve(self.treeRoot);
				}, function(err) {
					self.treeRoot.Path = null;
					return new Deferred().reject(err);
				});
			}
			return new Deferred().resolve(self.treeRoot);
		},

		/**
		 * Load the explorer with the given root
		 * @name orion.explorer.FileExplorer#load
		 * @function
		 * @param {Object} root a root object or a deferred that will return the root of the FileModel
		 * @param {String} progress a string progress message describing the fetch of the root
		 * @returns {orion.Promise} A promise that resolves to the loaded <code>treeRoot</code>, or rejects with an error.
		 */
		load: function(root, progressMessage, postLoad) {
			var parent = lib.node(this.parentId);			
	
			// Progress indicator
			var progress = lib.node("progress");  //$NON-NLS-0$
			if(!progress){
				progress = document.createElement("div"); //$NON-NLS-0$
				progress.id = "progress"; //$NON-NLS-0$
				progress.classList.add("fileExplorerProgressDiv"); //$NON-NLS-0$
				lib.empty(parent);
				parent.appendChild(progress);
			}
			lib.empty(progress);
			
			var progressTimeout = setTimeout(function() {
				lib.empty(progress);
				progress.appendChild(document.createTextNode(progressMessage));
			}, 500); // wait 500ms before displaying
						
			var self = this;
			return Deferred.when(root,
				function(root) {
					clearTimeout(progressTimeout);
					if (self.destroyed) { return; }
					self.treeRoot = {};
					// copy properties from root json to our object
					for (var property in root) {
						self.treeRoot[property] = root[property];
					}
					self.model = self.createModel();
					if (self.dragAndDrop) {
						if (self._hookedDrag) {
							// rehook on the parent to indicate the new root location
							self._makeDropTarget(self.treeRoot, parent, true);
						} else {
							// uses two different techniques from Modernizr
							// first ascertain that drag and drop in general is supported
							var supportsDragAndDrop = parent && (('draggable' in parent) || ('ondragstart' in parent && 'ondrop' in parent));  //$NON-NLS-2$  //$NON-NLS-1$  //$NON-NLS-0$ 
							// then check that file transfer is actually supported, since this is what we will be doing.
							// For example IE9 has drag and drop but not file transfer
							supportsDragAndDrop = supportsDragAndDrop && !!(window.File && window.FileList && window.FileReader);
							self._hookedDrag = true;
							if (supportsDragAndDrop) {
								self._makeDropTarget(self.treeRoot, parent, true);
							} else {
								self.dragAndDrop = null;
								window.console.log("Local file drag and drop is not supported in this browser."); //$NON-NLS-0$
							}
						}
					}
					
					var deferred = new Deferred();
					self.createTree(self.parentId, self.model, {
						onComplete: function(tree) {
							deferred.resolve(tree);
						},
						navHandlerFactory: self.navHandlerFactory,
						showRoot: self.showRoot,
						setFocus: (typeof self.setFocus === "undefined" ? true : self.setFocus), //$NON-NLS-0$
						selectionPolicy: self.renderer.selectionPolicy, 
						onCollapse: function(model) {
							if(self.getNavHandler()){
								self.getNavHandler().onCollapse(model);
							}
						}
					});
					
					return deferred.then(function() {
						if (typeof postLoad === "function") { //$NON-NLS-0$
							try {
								postLoad();
							} catch(e){
								if (self.registry) {
									self.registry.getService("orion.page.message").setErrorMessage(e);	 //$NON-NLS-0$
								}
							}
						}				
						if (typeof self.onchange === "function") { //$NON-NLS-0$
							self.onchange(self.treeRoot);
						}
						self.dispatchEvent({ type: "rootChanged", root: self.treeRoot }); //$NON-NLS-0$
						return self.treeRoot;
					});
				},
				function(error) {
					clearTimeout(progressTimeout);
					// Show an error message when a problem happens during getting the workspace
					if (self.registry) {
						self.registry.getService("orion.page.message").setProgressResult(error); //$NON-NLS-0$
					}
					self.dispatchEvent({ type: "rootChanged", root: self.treeRoot }); //$NON-NLS-0$
					return new Deferred().reject(error);
				}
			);
		},
		/**
		 * Called when the root item changes. This can be overridden.
		 * @name orion.explorer.FileExplorer#onchange
		 * @function
		 * @param {Object} item
		 */
		onchange: function(item) {
		}
	});
	FileExplorer.prototype.constructor = FileExplorer;

	//return module exports
	return {
		FileExplorer: FileExplorer,
		FileModel: FileModel
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others. 
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/webui/dialogs/DirectoryPrompterDialog',['i18n!orion/widgets/nls/messages', 'orion/webui/dialog', 'orion/fileUtils', 'orion/selection', 'orion/explorers/explorer', 'orion/explorers/explorer-table'], 
function(messages, dialog, mFileUtils, mSelection, mExplorer, mExplorerTable) {

	function DirectoryPrompterRenderer (options, explorer) {
		this.explorer = explorer;
		this._init(options);
	}
	DirectoryPrompterRenderer.prototype = new mExplorer.SelectionRenderer(); 
	DirectoryPrompterRenderer.prototype.constructor = DirectoryPrompterRenderer;
	DirectoryPrompterRenderer.prototype.getLabelColumnIndex = function() {
		return 0;
	};
	DirectoryPrompterRenderer.prototype.getCellElement = function(col_no, item, tableRow){
		var col = document.createElement("td"); //$NON-NLS-0$
		tableRow.appendChild(col);
		var span = document.createElement("span"); //$NON-NLS-0$
		span.id = tableRow.id+"navSpan"; //$NON-NLS-0$
		col.appendChild(span);
		span.className = "mainNavColumn singleNavColumn"; //$NON-NLS-0$
		this.getExpandImage(tableRow, span);
		span.appendChild(document.createTextNode(item.Name)); 
	};

	/**
	* @param options {{
			func : function(item)     Function to be called with the selected item
			message : String          (Optional) Message to display in dialog.
			title : String            (Optional) Dialog title.
		}}
	 */
	 
	function DirectoryPrompterDialog(options) {
		this._init(options);
	}
	
	DirectoryPrompterDialog.prototype = new dialog.Dialog();


	DirectoryPrompterDialog.prototype.TEMPLATE = 
		'<div id="message" style="width: 25em; padding-bottom: 5px;"></div>' + //$NON-NLS-0$
		'<div id="directoryTree" class="explorerTreeClass" style="width:25em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>'; //$NON-NLS-0$

	DirectoryPrompterDialog.prototype._init = function(options) {
		this.title = options.title || messages['Choose a Folder'];
		this.modal = true;
		this.buttons = [{text: messages['OK'], isDefault: true, callback: this.done.bind(this)}]; 
		this.customFocus = true;
		this._fileClient = options.fileClient;
		this._serviceRegistry = options.serviceRegistry;
		this._message = options.message || "";
		this._func = options.func;
		this._initialize();
	};
	
	DirectoryPrompterDialog.prototype._bindToDom = function(parent) {
		// TODO this is assuming a particular file system
		this.loadFolderList("/");	// workspace root //$NON-NLS-0$
		if (this._message) {
			this.$message.appendChild(document.createTextNode(this._message));
		} else {
			this.$message.style.display = "none"; //$NON-NLS-0$
		}
		this.$directoryTree.focus();
	};
		
	DirectoryPrompterDialog.prototype.loadFolderList = function(path) {
		path = mFileUtils.makeRelative(path);
		this.selection = new mSelection.Selection(this._serviceRegistry, "orion.directoryPrompter.selection"); //$NON-NLS-0$

		this.explorer = new mExplorerTable.FileExplorer({treeRoot: {children:[]}, selection: this.selection, serviceRegistry: this._serviceRegistry,
				fileClient: this._fileClient, parentId: "directoryTree", excludeFiles: true, rendererFactory: function(explorer) {  //$NON-NLS-0$
					return new DirectoryPrompterRenderer({checkbox: false, singleSelection: true, treeTableClass: "directoryPrompter" }, explorer);   //$NON-NLS-0$
				}}); //$NON-NLS-0$
		this.explorer.loadResourceList(path, true, null);
	};
		
	DirectoryPrompterDialog.prototype.done = function() {
		this.selection.getSelection(function(selection) {
			this.hide();
			this._func(selection);
		}.bind(this));
	};
	
	DirectoryPrompterDialog.prototype.constructor = DirectoryPrompterDialog;
	//return the module exports
	return {DirectoryPrompterDialog: DirectoryPrompterDialog};

});

/*******************************************************************************
 * @license Copyright (c) 2010, 2014 IBM Corporation and others. All rights
 *          reserved. This program and the accompanying materials are made
 *          available under the terms of the Eclipse Public License v1.0
 *          (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse
 *          Distribution License v1.0
 *          (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/
/*eslint no-unused-params:0*/

define('orion/git/widgets/CloneGitRepositoryDialog',[ 'i18n!git/nls/gitmessages', 'orion/webui/dialogs/DirectoryPrompterDialog', 'orion/webui/dialog', 'orion/URITemplate', 'require' ], function(messages, DirPrompter, dialog, URITemplate, require) {

	var editTemplate = new URITemplate("edit/edit.html#{,resource,params*}"); //$NON-NLS-0$
	
	function CloneGitRepositoryDialog(options) {
		this._init(options);
	}

	CloneGitRepositoryDialog.prototype = new dialog.Dialog();

	CloneGitRepositoryDialog.prototype.TEMPLATE = '<span id="basicPane">' + '<div style="padding: 8px">' + '<label for="gitUrl">${Repository URL:}</label>'
			+ '<input id="gitUrl" style="width: 50em" value=""/>' + '</div>'

			+ '<div style="padding: 8px; text-align: right;">' + '<a id="advancedLink" href="javascript:">${Choose target location}</a>'
			+ '<a id="advancedLinkHide" href="javascript:" style="display: none">${Default target location}</a>' + '</div>' + '</span>'

			+ '<span id="advancedPane" style="display: none;">' + '<div style="padding: 8px">'
			+ '<input id="isNewProject" type="radio" name="isNewProject" checked value="new"/>'
			+ '<label for="gitName" style="padding: 0 8px">${New folder:}</label>' + '<input id="gitName" value="">' + '</div>'

			+ '<div style="padding: 8px">' + '<input id="isExistingProject" type="radio" name="isNewProject" value="existing"/>'
			+ '<label for="isExistingProject" style="padding: 0 8px">${Existing directory:}</label>' + '<input id="gitPath" type="hidden" value="">'
			+ '<span id="shownGitPath" style="padding-right: 24px"></span>' + '<a id="changeGitPath" href="javascript:">${Change...}</a>' + '</div>'

			+ '</span>';

	CloneGitRepositoryDialog.prototype._init = function(options) {
		var that = this;

		this.title = options.title ? options.title : messages["CloneGitRepositoryDialog"];
		this.modal = true;
		this.messages = messages;

		this.advancedShown = false;
		this.alwaysShowAdvanced = options.alwaysShowAdvanced;
		this.advancedOnly = options.advancedOnly;
		this.url = options.url;
		this.serviceRegistry = options.serviceRegistry;
		this.fileClient = options.fileClient;
		this.func = options.func;

		this.buttons = [];

		this.buttons.push({
			callback: function() {
				if (that.okbutton.disabled)
					return; // don't run if dialog is not valid

				that.destroy();
				that._execute();
			},
			text : messages['OK'],
			isDefault: true
		});

		// Initialize dialog & elements
		this._initialize();

		this.okbutton = this.$buttonContainer.querySelectorAll("button")[0]; //$NON-NLS-0$
		if (!this.advancedOnly) {
			this.okbutton.disabled = true;
			this.okbutton.classList.add("disabled"); //$NON-NLS-0$
		}
	};

	CloneGitRepositoryDialog.prototype._bindToDom = function(parent) {
		var that = this;

		if (this.url) {
			this.$gitUrl.value = this.url;
		}
		this.$gitUrl.addEventListener("input", function() { //$NON-NLS-0$
			var invalid = /^\s*$/.test(that.$gitUrl.value);
			that.okbutton.disabled = invalid;
			var cl = that.okbutton.classList;
			if (invalid)
				cl.add("disabled"); //$NON-NLS-0$
			else
				cl.remove("disabled"); //$NON-NLS-0$
		});

		if (this.advancedOnly) {
			this.$basicPane.style.display = "none"; //$NON-NLS-0$
			this.$advancedPane.style.display = "";
			setTimeout(function() {
				that.$gitName.focus();
			}, 400);
		}

		this.$changeGitPath.addEventListener("click", function(evt) { //$NON-NLS-0$
			that._openDirectoryPickerDialog();
		});

		this.$isExistingProject.addEventListener("click", function(evt) { //$NON-NLS-0$
			that._checkNewExisting();
		});

		this.$isNewProject.addEventListener("click", function(evt) { //$NON-NLS-0$
			that._checkNewExisting();
		});

		this.$gitName.addEventListener("focus", function(evt) { //$NON-NLS-0$
			that._showNewProject();
		});

		this.$advancedLink.addEventListener("click", function(evt) { //$NON-NLS-0$
			that._showAdvanced();
		});

		this.$advancedLinkHide.addEventListener("click", function(evt) { //$NON-NLS-0$
			that._hideAdvanced();
		});

		if (this.alwaysShowAdvanced) {
			this._showAdvanced();
		}
	};

	CloneGitRepositoryDialog.prototype._execute = function() {
		this.func && this.func(
			(this.advancedOnly ? undefined : this.$gitUrl.value),
			(this.advancedShown && this.$isNewProject.checked) ? undefined : this.$gitPath.value,
			(this.advancedShown && !this.$isNewProject.checked) ? undefined : this.$gitName.value
		);
	};

	CloneGitRepositoryDialog.prototype._showAdvanced = function() {
		this.advancedShown = true;
		this.$advancedPane.style.display = "";
		this.$advancedLink.style.display = "none"; //$NON-NLS-0$
		this.$advancedLinkHide.style.display = "";
	};

	CloneGitRepositoryDialog.prototype._hideAdvanced = function() {
		this.advancedShown = false;
		this.$advancedPane.style.display = "none"; //$NON-NLS-0$
		this.$advancedLink.style.display = "";
		this.$advancedLinkHide.style.display = "none"; //$NON-NLS-0$
	};

	CloneGitRepositoryDialog.prototype._checkNewExisting = function() {
		if (this.$isExistingProject.checked) {
			this._openDirectoryPickerDialog();
		} else {
			this.$gitName.focus();
		}
	};

	CloneGitRepositoryDialog.prototype._showNewProject = function() {
		this.$isNewProject.checked = true;
	};

	CloneGitRepositoryDialog.prototype._openDirectoryPickerDialog = function() {
		var that = this;

		function makePathSegment(folder) {
			var link = document.createElement("a"); //$NON-NLS-0$
			link.href = require.toUrl(editTemplate.expand({resource: folder.ChildrenLocation}));
			link.textContent = folder.Name;
			return link;
		}

		this.$isExistingProject.checked = true;

		var dialog = new DirPrompter.DirectoryPrompterDialog({ title : messages["ChooseFolderDialog"],
		serviceRegistry : this.serviceRegistry,
		fileClient : this.fileClient,
		func : function(targetFolder) {
			if (targetFolder && targetFolder.Location) {
				that.$gitPath.value = targetFolder.Location;
				while (that.$shownGitPath.hasChildNodes()) {
					that.$shownGitPath.removeChild(that.$shownGitPath.lastChild);
				}
				that.$shownGitPath.appendChild(makePathSegment(targetFolder));

				var currentFolder = targetFolder;
				while (currentFolder.parent && currentFolder.parent.Location !== "/") {
					that.$shownGitPath.insertBefore(document.createTextNode("/"), that.$shownGitPath.firstChild); //$NON-NLS-0$
					that.$shownGitPath.insertBefore(makePathSegment(currentFolder.parent), that.$shownGitPath.firstChild);
					currentFolder = currentFolder.parent;
				}
			}
		}
		});
		
		this._addChildDialog(dialog);
		dialog.show();
	};

	CloneGitRepositoryDialog.prototype.constructor = CloneGitRepositoryDialog;

	// return the module exports
	return { CloneGitRepositoryDialog : CloneGitRepositoryDialog
	};

});

/*******************************************************************************
 * @license Copyright (c) 2011, 2013 IBM Corporation and others. All rights
 *          reserved. This program and the accompanying materials are made
 *          available under the terms of the Eclipse Public License v1.0
 *          (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse
 *          Distribution License v1.0
 *          (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/

define('orion/git/widgets/ApplyPatchDialog',[ 'i18n!git/nls/gitmessages', 'orion/webui/dialog', 'orion/xsrfUtils' ], function(messages, dialog, xsrfUtils) {

	function ApplyPatchDialog(options) {
		this._init(options);
	}

	ApplyPatchDialog.prototype = new dialog.Dialog();

	ApplyPatchDialog.prototype.TEMPLATE =

	'<div style="padding:4px"><input type="radio" name="radio" value="urlRadio" id="urlRadio" checked/>' +
		messages["URL:"] + '<input type="text" name="url" id="url"/></div>' +
	'<div style="padding:4px"><input type="radio" name="radio" value="fileRadio" id="fileRadio"/>' +
		messages["File:"] + '<input type="file" name="selectedFile" id="selectedFile" class="uploadChooser" />' +
	'</div>';

	ApplyPatchDialog.prototype._init = function(options) {
		var that = this;

		this.title = messages["ApplyPatchDialog"];
		this.modal = true;
		this.messages = messages;
		this.options = options;

		this.buttons = [];

		this.buttons.push({ callback : function() {
			that._applyPatch();
		},
		text : messages["OK"]
		});
		

		// Start the dialog initialization.
		this._initialize();
	};

	ApplyPatchDialog.prototype._bindToDom = function(parent) {
		this.$selectedFile.onchange = function(event){
			this.$urlRadio.checked = false;
			this.$fileRadio.checked = "fileRadio";
		}.bind(this);
		this.$url.onchange = function(event){
			this.$urlRadio.checked = "urlRadio";
			this.$fileRadio.checked = false;
		}.bind(this);
	};

	ApplyPatchDialog.prototype._applyPatch = function(parent) {
		var formData = new FormData();
		formData.append("uploadedfile", this.$selectedFile.files[0]);
		formData.append("url", this.$url.value);
		formData.append("radio", this.$fileRadio.checked ? "fileRadio" : "urlRadio");

		this.req = new XMLHttpRequest();
		this.req.open('post', this.options.diffLocation);
		this.req.setRequestHeader("Orion-Version", "1");
		this.req.onreadystatechange = this.handleReadyState.bind(this);
		xsrfUtils.addCSRFNonce(this.req);
		this.req.send(formData);
	};

	ApplyPatchDialog.prototype.handleReadyState = function(state) {
		if (this.req.readyState === 4) {
			if(this.req.status === 200){
				if(this.options.deferred){
					this.options.deferred.resolve(this.req.responseText);
				}
			} else {
				if(this.options.deferred){
					this.options.deferred.reject(this.req.responseText);
				}
			}
			this.hide();
		}
	};

	ApplyPatchDialog.prototype.constructor = ApplyPatchDialog;

	// return the module exports
	return { ApplyPatchDialog : ApplyPatchDialog
	};

});

/*******************************************************************************
 * @license Copyright (c) 2010, 2013 IBM Corporation and others. All rights
 *          reserved. This program and the accompanying materials are made
 *          available under the terms of the Eclipse Public License v1.0
 *          (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse
 *          Distribution License v1.0
 *          (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
 
/*eslint-env browser, amd*/

define('orion/git/widgets/GitCredentialsDialog',[ 'i18n!git/nls/gitmessages', 'orion/git/gitPreferenceStorage', 'orion/webui/dialog', 'orion/git/util'],
 function(messages, GitPreferenceStorage, dialog, mGitUtil) {

	/**
	 * Usage: <code>new GitCredentialsDialog(options).show();</code>
	 * 
	 * @param options {{
	 *            title: string, //title of window ("Git Credentials" used if
	 *            not provided) func: function, //callback function
	 *            serviceRegistry: serviceRegistry, //to obtain ssh service that
	 *            provides known hosts errordata: json //detailed information
	 *            about failure returned by the server username: boolean, //ask
	 *            for username (enabled by default if nothing is enabled)
	 *            password: boolean, //ask for password (enabled by default if
	 *            nothing is enabled) privatekey: boolean, //ask for private key
	 *            passphrase: boolean //ask for passphrase }}
	 */
	function GitCredentialsDialog(options) {
		this._init(options);
	}

	GitCredentialsDialog.prototype = new dialog.Dialog();

	GitCredentialsDialog.prototype.TEMPLATE = '<div id="gitCredentialsLabel" style="padding: 8px">${Repository URL:}<strong id="url"></strong></div>'

	+ '<div id="gitSshUsernameRow" style="padding: 8px">' + '<label id="gitSshUsernameLabel" for="gitSshUsername">${Username:}</label>'
			+ '<input id="gitSshUsername" value="">' + '</div>'

			+ '<div id="gitSshPasswordRow" style="padding: 8px">' + '<input id="isSshPassword" type="radio" name="isSshPassword" checked value="password"/>'
			+ '<label id="gitSshPasswordLabel" for="gitSshPassword" style="padding: 0 8px">${Password:}</label>'
			+ '<input type="password" id="gitSshPassword" value="" style="width: 30em">' + '</div>'

			+ '<div style="padding: 8px">' + '<div id="gitPrivateKeyRow">'
			+ '<input id="isPrivateKey" type="radio" name="isSshPassword" value="privateKey" style="vertical-align: top"/>'
			+ '<label id="gitPrivateKeyLabel" for="gitPrivateKey" style="padding: 0 8px; vertical-align: top">${Private key:}</label>'
			+ '<textarea id="gitPrivateKey" value=""></textarea>' + '</div>'

			+ '<div id="gitPrivateKeyFileRow" style="padding-left: 8em">'
			+ '<label id="gitPrivateKeyFileLabel" for="gitPrivateKeyFile">${Private key file (optional):}</label><br>'
			+ '<input id="gitPrivateKeyFile" multiple="false" type="file" size="53" label="Browse...">' + '</div>'

			+ '<div id="gitPassphraseRow" style="padding-left: 8em">'
			+ '<label id="gitPassphraseLabel" for="gitPassphrase">${Passphrase (optional):}</label><br>'
			+ '<input type="password" id="gitPassphrase" value="" style="width: 30em">' + '</div>' + '</div>'

			+ '<div id="gitSaveCredentialsRow" style="padding: 8px">' + '<img id="gitSaveCredentialsInfo" src="/images/info.gif"">'
			+ '<input id="gitSaveCredentials" type="checkbox" name="gitSaveCredentials">'
			+ '<label id="gitSaveCredentialsLabel" for="gitSaveCredentials">${Don\'t prompt me again:}</label>' + '</div>';

	GitCredentialsDialog.prototype._init = function(options) {
		var that = this;

		this.title = options.title || messages["Git Credentials"];
		this.modal = true;
		this.messages = messages;
		this.options = options;
		this._afterHiding = options.closeCallback;

		if (!this.options.username && !this.options.password && !this.options.privatekey && !this.options.passphrase) {
			this.options.username = true;
			this.options.password = true;
			this.options.privatekey = true;
			this.options.passphrase = true;
		}

		if (options.serviceRegistry) {
			this._sshService = options.serviceRegistry.getService("orion.net.ssh"); //$NON-NLS-0$
			this._progressService = options.serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
		}

		this.buttons = [];

		this.buttons.push({ callback : function() {
			that.destroy();
			that._execute();
		},
		text : 'OK',
		isDefault: true
		});

		// Start the dialog initialization.
		this._initialize();
	};

	GitCredentialsDialog.prototype._bindToDom = function(parent) {
		var that = this;

		if (!this.options.username) {
			this.$gitSshUsernameRow.style.display = "none"; //$NON-NLS-0$
		}

		if (!this.options.password) {
			this.$gitSshPasswordRow.style.display = "none"; //$NON-NLS-0$
		}

		if (!this.options.privatekey) {
			this.$gitPrivateKeyRow.style.display = "none"; //$NON-NLS-0$		
			this.$gitPrivateKeyFileRow.style.display = "none"; //$NON-NLS-0$
		}

		if (!this.options.passphrase) {
			this.$gitPassphraseRow.style.display = "none"; //$NON-NLS-0$
		}

		if (this.options.errordata && this.options.errordata.Url) {
			this.$gitCredentialsLabel.style.display = "block"; //$NON-NLS-0$
			this.$url.textContent = this.options.errordata.Url;
		}

		if (this.options.errordata && this.options.errordata.User && this.options.errordata.User !== "") {
			this.$gitSshUsername.value = this.options.errordata.User;
			this.$gitSshUsernameRow.style.display = "none"; //$NON-NLS-0$
			setTimeout(function() {
				that.$gitSshPassword.focus();
			}, 400);
		}

		// display prompt checkbox only when it makes sense
		var gitPreferenceStorage = new GitPreferenceStorage(this.options.serviceRegistry);
		gitPreferenceStorage.isEnabled().then(function(isEnabled) {
			if (!isEnabled) {
				that.$gitSaveCredentials.style.display = "none";
				that.$gitSaveCredentialsLabel.style.display = "none";
				that.$gitSaveCredentialsInfo.style.display = "none";
			}
		});

		this.$gitSshPassword.addEventListener("focus", function(evt) {//$NON-NLS-0$
			that.$isSshPassword.checked = true;
		});

		this.$gitPrivateKey.addEventListener("focus", function(evt) {//$NON-NLS-0$
			that.$isPrivateKey.checked = true;
		});

		this.$gitPrivateKeyFile.addEventListener("focus", function(evt) {//$NON-NLS-0$
			that.$isPrivateKey.checked = true;
		});

		this.$gitPassphrase.addEventListener("focus", function(evt) {//$NON-NLS-0$
			that.$isPrivateKey.checked = true;
		});

		this.$gitPrivateKeyFile.addEventListener("change", function(evt) {//$NON-NLS-0$
			var file = evt.target.files[0];
			that.privateKeyFile = file;
		});

		// new Tooltip({ connectId : [ "gitSaveCredentialsInfo" ],
		// label : messages["Your private key will be saved in the browser for
		// further use"]
		// });
	};

	GitCredentialsDialog.prototype._execute = function() {
		var that = this;
		var loadedPrivateKey = this.$gitPrivateKey.value;
		var repository = this.$url.textContent;

		var process = function(pKey) {
			if (that._sshService) {
				var repositoryURL = mGitUtil.parseSshGitUrl(repository);
				that._sshService.getKnownHostCredentials(repositoryURL.host, repositoryURL.port).then(
						function(knownHosts) {
							if (that.options.func) {
								var failedOperation = typeof that.options.failedOperation === "undefined" ? that.options.errordata.failedOperation
										: that.options.failedOperation;
								if (failedOperation !== "undefined") {
									that._progressService.removeOperation(failedOperation);
								}
								that.options.func({ gitSshUsername : that.$gitSshUsername.value,
								gitSshPassword : that.$isSshPassword.checked ? that.$gitSshPassword.value : "",
								gitPrivateKey : that.$isPrivateKey.checked ? pKey : "",
								gitPassphrase : that.$isPrivateKey.checked ? that.$gitPassphrase.value : "", //$NON-NLS-0$
								knownHosts : knownHosts
								});
							}
						});
			} else {
				if (that.options.func) {
					var failedOperation = typeof that.options.failedOperation === "undefined" ? that.options.errordata.failedOperation
							: that.options.failedOperation;
					if (failedOperation !== "undefined") {
						that._progressService.removeOperation(failedOperation);
					}
					that.options.func({ gitSshUsername : that.$gitSshUsername.value,
					gitSshPassword : that.$gitSshPassword.value,
					gitPrivateKey : pKey,
					gitPassphrase : that.$gitPassphrase.value,
					knownHosts : that.$gitSshKnownHosts.value
					});
				}
			}
		};

		if (this.privateKeyFile) {
			// load private key from file
			var reader = new FileReader();
			reader.onload = (function(f) {
				return function(e) {
					loadedPrivateKey = e.target.result;

					var gitPreferenceStorage = new GitPreferenceStorage(that.options.serviceRegistry);
					if (that.$gitSaveCredentials.checked) {

						gitPreferenceStorage.put(repository, { gitPrivateKey : loadedPrivateKey,
						gitPassphrase : that.$gitPassphrase.value
						}).then(function() {
							process(loadedPrivateKey);
						});

					} else {
						process(loadedPrivateKey);
					}
				};
			}(this.privateKeyFile));

			reader.readAsText(this.privateKeyFile);
		} else if (loadedPrivateKey.length > 0) {
			// save key
			var gitPreferenceStorage = new GitPreferenceStorage(that.options.serviceRegistry);
			if (that.$gitSaveCredentials.checked) {

				gitPreferenceStorage.put(repository, { gitPrivateKey : loadedPrivateKey,
				gitPassphrase : that.$gitPassphrase.value
				}).then(function() {
					process(loadedPrivateKey);
				});

			} else {
				process(loadedPrivateKey);
			}
		} else {
			// save ssh username and password
			var gitPreferenceStorage = new GitPreferenceStorage(that.options.serviceRegistry);
			if (that.$gitSaveCredentials.checked) {

				gitPreferenceStorage.put(repository, { gitSshUsername : that.$gitSshUsername.value,
				gitSshPassword : that.$gitSshPassword.value
				}).then(function() {
					process(loadedPrivateKey);
				});

			} else {
				process(loadedPrivateKey);
			}
		}
	};

	GitCredentialsDialog.prototype.constructor = GitCredentialsDialog;

	// return the module exports
	return { GitCredentialsDialog : GitCredentialsDialog
	};

});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/**
 * Holds common functions that can be shared by various commands
 */

/*eslint-env browser, amd*/
/*global confirm */

define('orion/git/logic/gitCommon',['orion/git/util','orion/i18nUtil','orion/git/gitPreferenceStorage','orion/git/widgets/GitCredentialsDialog','orion/Deferred','i18n!git/nls/gitmessages'],
		function(mGitUtil,i18nUtil,GitPreferenceStorage,mGitCredentials,Deferred,messages) {
	
	
	function translateResponseToStatus(response) {
		var json;
		try {
			json = JSON.parse(response.responseText);
		} catch (e) {
			json = { 
				Message : messages["Problem while performing the action"]
			};
		}
		json.HttpCode = response.status;
		return json;
	}
	
	function translateGitStatusMessages(message){
		return messages[message] || message;
	}
	
	var handleKnownHostsError = function(serviceRegistry, errorData, options, func){
		if(confirm(i18nUtil.formatMessage(messages["AddKeyToHostContinueOp"],
				errorData.KeyType, errorData.Host, errorData.HostFingerprint))){
			
			var hostURL = mGitUtil.parseSshGitUrl(errorData.Url);
			var hostCredentials = {
					host : errorData.Host,
					keyType : errorData.KeyType,
					hostKey : errorData.HostKey,
					port : hostURL.port
				};
			
			var sshService = serviceRegistry.getService("orion.net.ssh"); //$NON-NLS-0$
			sshService.addKnownHost(hostCredentials).then(function(knownHosts){ //$NON-NLS-1$ //$NON-NLS-0$
				options.knownHosts = knownHosts;
				if(options.failedOperation !== undefined){
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					progress.removeOperation(options.failedOperation);
				}
				
				func(options);
			});
		}
	};
	
	var handleSshAuthenticationError = function(serviceRegistry, errorData, options, func, title, closeCallback){
		var repository = errorData ? errorData.Url : undefined;
		
		var failure = function(){
			var credentialsDialog = new mGitCredentials.GitCredentialsDialog({
				title: title,
				serviceRegistry: serviceRegistry,
				func: func,
				errordata: options.errordata,
				failedOperation: options.failedOperation,
				closeCallback : closeCallback
			});

			credentialsDialog.show();
		};
		
		if(options.gitSshUsername || options.gitSshPassword || options.gitPrivateKey){
			failure();
		} else {
			var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
			gitPreferenceStorage.get(repository).then(
				function(credentials){
					if(credentials.gitPrivateKey || credentials.gitSshUsername || credentials.gitSshPassword){
						if(options.failedOperation !== undefined){
							var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
							progress.removeOperation(options.failedOperation);
						}
						func({knownHosts: options.knownHosts, gitSshUsername: credentials.gitSshUsername, gitSshPassword: credentials.gitSshPassword, gitPrivateKey: credentials.gitPrivateKey, gitPassphrase: credentials.gitPassphrase});
						return;
					}
					
					failure();
				}, failure
			);
		}
	};
	
	var handleGitServiceResponse = function(jsonData, serviceRegistry, callback, sshCallback){

		if (jsonData && jsonData.status !== undefined) {
			jsonData = translateResponseToStatus(jsonData);
		}

		if (!jsonData || !jsonData.HttpCode) {
			if (callback) {
				callback(jsonData);
			}
			return;
		}
		
		switch (jsonData.HttpCode) {
			case 401:
				
				/* authentication error, clear remaining credentials */
				var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
				gitPreferenceStorage.isEnabled().then(function(isEnabled){
					if(isEnabled && jsonData.JsonData.Url !== undefined){
						gitPreferenceStorage.remove(jsonData.JsonData.Url).then(function(){
							sshCallback(jsonData);
						});
					} else {
						/* nothing to delete, proceed */
						sshCallback(jsonData);
					}
				});
				
				break;
			case 400:
				if(jsonData.JsonData && jsonData.JsonData.HostKey){
					sshCallback(jsonData);
					return;
				}
				//$FALLTHROUGH$
			default:
				var display = {};
				display.Severity = jsonData.Severity || "Error"; //$NON-NLS-0$
				display.HTML = false;
				display.Message = translateGitStatusMessages(jsonData.DetailedMessage ? jsonData.DetailedMessage : jsonData.Message);
				serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
				
				if (callback) {
					callback(jsonData);
				}
				break;
		}
			
	};
	
	var getGitUrl = function(item) {
		//TODO This should be somehow unified
		if (item.Remote) return item.Remote.GitUrl;
		if (item.LocalBranch) {
			item = item.LocalBranch;
		}
		else if (item.GitUrl) { return item.GitUrl; }
		else if (item.errorData) { return item.errorData.Url; }
		else if (item.RemoteLocation){ return item.RemoteLocation[0].GitUrl; }
		else if (item.toRef) { return item.toRef.RemoteLocation[0].GitUrl; }
		return null;
	};
	
	var getDefaultSshOptions = function(serviceRegistry, item, authParameters){
		var def = new Deferred();
		var sshService = serviceRegistry.getService("orion.net.ssh"); //$NON-NLS-0$
		var sshUser =  authParameters && !authParameters.optionsRequested ? authParameters.valueFor("sshuser") : ""; //$NON-NLS-0$
		var sshPassword = authParameters && !authParameters.optionsRequested ? authParameters.valueFor("sshpassword") : ""; //$NON-NLS-0$
		
		var repository = getGitUrl(item);
		if(!repository){
			def.resolve({
						knownHosts: "",
						gitSshUsername: sshUser,
						gitSshPassword: sshPassword,
						gitPrivateKey: "",
						gitPassphrase: ""
			});
			
			return def;
		}

		var repositoryURL = mGitUtil.parseSshGitUrl(repository);
		sshService.getKnownHostCredentials(repositoryURL.host, repositoryURL.port).then(function(knownHosts){
			def.resolve({
						knownHosts: knownHosts,
						gitSshUsername: sshUser,
						gitSshPassword: sshPassword,
						gitPrivateKey: "",
						gitPassphrase: ""
			});
		});
		
		return def;
	};
	
	var gatherSshCredentials = function(serviceRegistry, data, title, closeCallback){
		var def = new Deferred();
		var repository = getGitUrl(data.items);
		var sshService = serviceRegistry.getService("orion.net.ssh"); //$NON-NLS-0$
		var repositoryURL = mGitUtil.parseSshGitUrl(repository);

		var triggerCallback = function(sshObject){
			serviceRegistry.getService("orion.net.ssh").getKnownHostCredentials(repositoryURL.host, repositoryURL.port).then(function(knownHosts){ //$NON-NLS-0$
				data.sshObject = sshObject;
				def.resolve({
					knownHosts: knownHosts,
					gitSshUsername: sshObject.gitSshUsername,
					gitSshPassword: sshObject.gitSshPassword,
					gitPrivateKey: sshObject.gitPrivateKey,
					gitPassphrase: sshObject.gitPassphrase
				});
			});
		};
		
		var errorData = data.errorData;
		
		// if this is a known hosts error, show a prompt always
		if (errorData && errorData.HostKey) {
			if(confirm(i18nUtil.formatMessage(messages['AddKeyToHostContinueOp'],
					errorData.KeyType, errorData.Host, errorData.HostFingerprint))){
				
				var hostURL = mGitUtil.parseSshGitUrl(errorData.Url);
				var hostCredentials = {
						host : errorData.Host,
						keyType : errorData.KeyType,
						hostKey : errorData.HostKey,
						port : hostURL.port
					};
				
				sshService.addKnownHost(hostCredentials).then( //$NON-NLS-1$ //$NON-NLS-0$
					function(){
						if(data.sshObject && (data.sshObject.gitSshUsername || data.sshObject.gitSshPassword || data.sshObject.gitPrivateKey)){
							triggerCallback({
								gitSshUsername: "",
								gitSshPassword: "",
								gitPrivateKey: "",
								gitPassphrase: ""
							});
						} else {
							var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
							gitPreferenceStorage.get(repository).then(
								function(credentials){
									triggerCallback(credentials);
								},
								function(){
									triggerCallback({
										gitSshUsername: "",
										gitSshPassword: "",
										gitPrivateKey: "",
										gitPassphrase: ""
									});
								}
							);
						}
					}
				);
			} else {
				if (typeof(closeCallback) === 'function') closeCallback(); //$NON-NLS-0$
			}
			return def;
		}
		
		var failure = function(){
			if (!data.parameters && !data.optionsRequested){
				triggerCallback(data.sshObject || {gitSshUsername: "", gitSshPassword: "", gitPrivateKey: "", gitPassphrase: ""}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				return;
			}
		
			// try to gather creds from the slideout first
			if (data.parameters && !data.optionsRequested) {
				var sshUser = (data.parameters && data.parameters.valueFor("sshuser")) || data.errorData.User; //$NON-NLS-0$
				var sshPassword = data.parameters && data.parameters.valueFor("sshpassword") || "";	 //$NON-NLS-0$
				var saveCredentials = data.parameters && data.parameters.valueFor("saveCredentials"); //$NON-NLS-0$
				
				var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
				if(saveCredentials){
					gitPreferenceStorage.put(repository, {
						gitSshUsername : sshUser,
						gitSshPassword : sshPassword
					}).then(
						function(){
							triggerCallback({gitSshUsername: sshUser, gitSshPassword: sshPassword, gitPrivateKey: "", gitPassphrase: ""}); //$NON-NLS-0$
						}
					);
					return;
				} else {
					triggerCallback({gitSshUsername: sshUser, gitSshPassword: sshPassword, gitPrivateKey: "", gitPassphrase: ""}); //$NON-NLS-0$
					return;
				}
			}
				
			// use the old creds dialog
			var credentialsDialog = new mGitCredentials.GitCredentialsDialog({
				title: title,
				serviceRegistry: serviceRegistry,
				func: triggerCallback,
				errordata: errorData,
				closeCallback: closeCallback
			});
			
			credentialsDialog.show();
			return;
		};

		if(data.sshObject && (data.sshObject.gitSshUsername || data.sshObject.gitSshPassword || data.sshObject.gitPrivateKey)){
			failure();
		} else {
			var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
			gitPreferenceStorage.get(repository).then(
				function(credentials){
					if(credentials.gitPrivateKey || credentials.gitSshUsername || credentials.gitSshPassword){
						triggerCallback(credentials);
						return;
					}
					
					failure();
				}, failure
			);
		}
		
		return def;
	};
	
	var handleProgressServiceResponse = function(jsonData, options, serviceRegistry, callback, callee, title){

		if (jsonData && jsonData.status !== undefined) {
			jsonData = translateResponseToStatus(jsonData);
		}

		if (!jsonData || jsonData.HttpCode===undefined) {
			if (callback) {
				callback(jsonData);
			}
			return;
		}
		
		switch (jsonData.HttpCode) {
			case 401:
				if(jsonData.JsonData){
					options.errordata = jsonData.JsonData;
				}
				if(jsonData.failedOperation){
					options.failedOperation = jsonData.failedOperation;
				}
				handleSshAuthenticationError(serviceRegistry, jsonData.JsonData, options, callee, title);
				return;
			case 400:
				if(jsonData.JsonData && jsonData.JsonData.HostKey){
					if(jsonData.failedOperation){
						options.failedOperation = jsonData.failedOperation;
					}
					handleKnownHostsError(serviceRegistry, jsonData.JsonData, options, callee);
				} else if(jsonData.JsonData && jsonData.JsonData.Host){
					if(jsonData.JsonData){
						options.errordata = jsonData.JsonData;
					}
					if(jsonData.failedOperation){
						options.failedOperation = jsonData.failedOperation;
					}
					handleSshAuthenticationError(serviceRegistry, jsonData.JsonData, options, callee, title);
				}
				return;
			default:
				var display = {};
				display.Severity = jsonData.Severity || "Error"; //$NON-NLS-0$
				display.HTML = false;
				display.Message = jsonData.DetailedMessage ? jsonData.DetailedMessage : jsonData.Message;
				serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
				
				if (callback) {
					callback(jsonData);
				}
				break;
		}
	};
	
	return {
		handleGitServiceResponse : handleGitServiceResponse,
		handleProgressServiceResponse : handleProgressServiceResponse,
		gatherSshCredentials : gatherSshCredentials,
		getDefaultSshOptions : getDefaultSshOptions,
		handleSshAuthenticationError : handleSshAuthenticationError,
		handleKnownHostsError : handleKnownHostsError
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define('orion/git/logic/gitPush',[
	'i18n!git/nls/gitmessages',
	'orion/commandRegistry',
	'orion/git/gitPreferenceStorage',
	'orion/git/logic/gitCommon',
	'orion/Deferred',
	'orion/objects'
], function(messages,mCommandRegistry,GitPreferenceStorage, mGitCommon, Deferred, objects) {
	
	var handleGitServiceResponse = mGitCommon.handleGitServiceResponse;
	var gatherSshCredentials = mGitCommon.gatherSshCredentials;
	
	/**
	 * Acts as a factory for push related functions.
	 * @param dependencies All required objects and values to perform the command
	 */
	return function(dependencies) {
		
		var serviceRegistry = dependencies.serviceRegistry;
		var commandService = dependencies.commandService;
		var tags = dependencies.tags;
		var force = dependencies.force;

		//Callbacks
		var sshCredentialsCallback = dependencies.sshCredentialsDialogCloseCallback;
		var sshSlideoutCallback = dependencies.sshSlideoutCloseCallback;
		
		var perform = function(data) {
			var d = new Deferred();
				
			var sshCredentialsDialogCallback = function () {
				if (typeof(sshCredentialsCallback) === "function") sshCredentialsCallback(); //$NON-NLS-0$
				d.reject();
			};
				
			var sshSlideoutCloseCallback = function () {
				if (typeof(sshSlideoutCallback) === "function") sshSlideoutCallback(); //$NON-NLS-0$
				d.reject();
			};
				
			function command(data) {
				//previously saved target branch
				var itemTargetBranch = data.targetBranch;
				
				var confirmedWarnings = data.confirmedWarnings;
				if(force && !confirmedWarnings){
					if(!confirm(messages["OverrideContentOfRemoteBr"]+"\n\n"+messages['Are you sure?'])){ //$NON-NLS-0$
						d.reject();
						return;
					} else {
						data.confirmedWarnings = true;
						confirmedWarnings = true;
					}
				}
			
				var item = data.items;
				if (item.Remote) {
					itemTargetBranch = item.Remote;
				}
				if (item.LocalBranch) {
					item = item.LocalBranch;
				}
				if (item.toRef) {
					item = item.toRef;
				}
				var commandInvocation = data;
				if (!commandInvocation.command) {
					commandInvocation.command = {};
					commandInvocation.command.callback = command;
				}

				var handleResponse = function(jsonData, commandInvocation){
					if (jsonData.JsonData.HostKey){
						commandInvocation.parameters = null;
						commandInvocation.errorData = jsonData.JsonData;
						commandInvocation.errorData.failedOperation = jsonData.failedOperation;
						commandService.collectParameters(commandInvocation,sshSlideoutCloseCallback);
					} else if (!commandInvocation.optionsRequested){
						var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
						gitPreferenceStorage.isEnabled().then(
							function(isEnabled){
								if(isEnabled){
									if (jsonData.JsonData.User)
										commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:']), new mCommandRegistry.CommandParameter("saveCredentials", "boolean", messages["Don't prompt me again:"])], {hasOptionalParameters: true}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
									else
										commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshuser", "text", messages['User Name:']), new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:']), new mCommandRegistry.CommandParameter("saveCredentials", "boolean", messages["Don't prompt me again:"])], {hasOptionalParameters: true}); //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
								} else {
									if (jsonData.JsonData.User)
										commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:'])], {hasOptionalParameters: true}); //$NON-NLS-1$ //$NON-NLS-0$
									else
										commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshuser", "text", messages['User Name:']), new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:'])], {hasOptionalParameters: true}); //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-0$
								}
								
								commandInvocation.errorData = jsonData.JsonData;
								commandInvocation.errorData.failedOperation = jsonData.failedOperation;
								commandService.collectParameters(commandInvocation,sshSlideoutCloseCallback);
							}
						);
					} else {
						commandInvocation.errorData = jsonData.JsonData;
						commandInvocation.errorData.failedOperation = jsonData.failedOperation;
						commandService.collectParameters(commandInvocation,sshSlideoutCloseCallback);
					}
				};
				
				if (commandInvocation.parameters && commandInvocation.parameters.optionsRequested){
					commandInvocation.parameters = null;
					commandInvocation.optionsRequested = true;
					commandService.collectParameters(commandInvocation,sshSlideoutCloseCallback);
					return;
				}
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				if(commandInvocation.errorData && commandInvocation.errorData.failedOperation){
					progress.removeOperation(commandInvocation.errorData.failedOperation);
				}
				
				var handlePush = function(options, location, ref, name, force){
					var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
					var deferred = progress.progress(gitService.doPush(location, ref, tags, force, //$NON-NLS-0$
							options.gitSshUsername, options.gitSshPassword, options.knownHosts,
							options.gitPrivateKey, options.gitPassphrase), messages['Pushing remote: '] + name);
					progressService.createProgressMonitor(deferred, messages['Pushing remote: '] + name);
					deferred.then(
						function(jsonData){
							handleGitServiceResponse(jsonData, serviceRegistry, 
								function() {
									if (!jsonData.HttpCode) {
										var display = {};
										display.HTML = true;
										display.Severity = jsonData.Severity || "Error"; //$NON-NLS-0$
										var result = jsonData.Updates.length ? "<b>" +  messages["PushResult"] + "</b>\n" : ""; //$NON-NLS-0$ //$NON-NLS-1$
										result += "<table class=\"gitPushUpdates\">"; //$NON-NLS-0$
										jsonData.Updates.forEach(function (update) {
											var message = update.Message || messages["Push_" + update.Result] || "";
											result += "<tr>"; //$NON-NLS-0$
											result += "<td>[" +  update.Result +"]</td><td><b>" + update.LocalName + " => " + update.RemoteName + "</b></td><td>" + message + "</td>"; //$NON-NLS-0$ //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$ //$NON-NLS-4$
											result += "</tr>"; //$NON-NLS-0$
										});
										result += "</table>"; //$NON-NLS-0$
										if (jsonData.Message) {
											result +=  "<pre class=\"gitPushMessage\">" + jsonData.Message + "</pre>"|| ""; //$NON-NLS-0$ //$NON-NLS-1$
										}
										display.Message = "<span class=\"gitPushResult\">" + result + "</span>"; //$NON-NLS-0$ //$NON-NLS-1$
										serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
									} 
									
									if (itemTargetBranch && !itemTargetBranch.Id) {
										gitService.getGitBranch(itemTargetBranch.Location).then(function(remote) {
											objects.mixin(itemTargetBranch, remote);
											d.resolve();
										}, d.resolve);
									} else {
										d.resolve();
									}
								}, function (jsonData) {
									handleResponse(jsonData, commandInvocation);
								}
							);
						}, function(jsonData) {
							handleGitServiceResponse(jsonData, serviceRegistry, 
								function() {
									d.resolve();
								}, function (jsonData) {
									handleResponse(jsonData, commandInvocation);
								}
							);
						}
					);
				};

				gatherSshCredentials(serviceRegistry, commandInvocation,null,sshCredentialsDialogCallback).then(
					function(options) {
						if(itemTargetBranch){
							handlePush(options, itemTargetBranch.Location, "HEAD", itemTargetBranch.Name, force); //$NON-NLS-0$
							return;
						} else {
							d.reject();
						}
					}
				);
			} 
			command(data);
			return d;
		};
		return {
			perform:perform,
		};
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define('orion/git/logic/gitStash',[
	'i18n!git/nls/gitmessages',
	'orion/Deferred', 
	'orion/i18nUtil'
], function(
	messages, Deferred, i18nUtil) {
	
	/**
	 * Acts as a factory for stash related functions.
	 * @param dependencies All required objects and values to perform the command
	 */
	return function(dependencies) {
		
		var serviceRegistry = dependencies.serviceRegistry;
		
		var performStashAll = function(data) {
			
			var d = new Deferred();
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var item = data.items.status || data.handler.status || data.items;
			var gitStashLocation = item.Clone.StashLocation;
	
			var name = data.userData.name;
			if(name != null && (name.length === 0 || !name.trim())){
				/* in case of empty or blank commit message, assume 
				 * the default stash message */
				name = undefined;
			}

			var wip, index;
			wip = index = name;
			if (name && name.length > 0) {
				wip = i18nUtil.formatMessage(messages["WIPStash"], data.items.CurrentBranch.Name, name);
				index = i18nUtil.formatMessage(messages["IndexStash"], data.items.CurrentBranch.Name, name);
			}
			/* TODO: Distinguish between index and working directory messages */
			gitService.doStashCreate(gitStashLocation, index, wip, true).then(function(resp){
				d.resolve(data);
			}, function(error){
				d.reject(error);
			});
			
			return d;
		};
		
		var performDrop = function(data) {
			
			var d = new Deferred();
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var item = data.items.status || data.handler.status || data.items;
			var dropLocation = item.DropLocation;

			gitService.doStashDrop(dropLocation).then(function(resp){
				d.resolve(data);
			}, function(error){
				d.reject(error);
			});
			
			return d;
		};
		
		var performApply = function(data) {
			
			var d = new Deferred();
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var item = data.items.status || data.handler.status || data.items;
			var applyLocation = item.ApplyLocation;

			gitService.doStashApply(applyLocation).then(function(resp){
				d.resolve(data);
			}, function(error){
				d.reject(error);
			});
			
			return d;
		};
		
		var performPop = function(data) {
			
			var d = new Deferred();
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var item = data.items.status || data.handler.status || data.items;
			var gitStashLocation = item.Clone.StashLocation;

			gitService.doStashPop(gitStashLocation).then(function(resp){
				d.resolve(data);
			}, function(error){
				d.reject(error);
			});
			
			return d;
		};
		
		return {
			stashAll : performStashAll,
			drop : performDrop,
			apply : performApply,
			pop : performPop
		};
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define('orion/git/logic/gitCommit',[
	'i18n!git/nls/gitmessages',
	'orion/Deferred',
	'orion/git/logic/gitCommon',
	'orion/i18nUtil',
], 
function(messages, Deferred, mGitCommon, i18nUtil) {
	
	var handleProgressServiceResponse = mGitCommon.handleProgressServiceResponse;
	
	/**
	 * Acts as a factory for commit related functions.
	 * @param dependencies All required objects and values to perform the command
	 */
	return function(dependencies) {
		
		var serviceRegistry = dependencies.serviceRegistry;
		
		var getAmendMessage = function(location) {
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			var deferred = new Deferred();
			progress.progress(serviceRegistry.getService("orion.git.provider").doGitLog(location + "?page=1&pageSize=1"), messages["Fetching previous commit message"]).then(function(resp) { //$NON-NLS-1$ //$NON-NLS-0$ 
				deferred.resolve(resp.Children[0].Message);
			}, function(){
				deferred.resolve("");
			});
			return deferred;
		};
		
		var setGitCloneConfig = function(key,value,location) {
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var deferred = new Deferred();
			gitService.getGitCloneConfig(location).then(function(config){
				var found = false;
				if(config.Children){
					for(var i=0; i<config.Children.length; i++){
						if(config.Children[i].Key===key){
							found = true;
							var locationToUpdate = config.Children[i].Location;
							gitService.editCloneConfigurationProperty(locationToUpdate,value).then(deferred.resolve, deferred.reject);
							break;
						}
					}
				} 
				if (!found) {
					gitService.addCloneConfigurationProperty(location, key, value).then(deferred.resolve, deferred.reject);
				}
			}, deferred.reject);
			return deferred;
		};
		
		var getGitCloneConfig = function(config) {
			var result = {};
			for (var i=0; i < config.length; i++){
				if (config[i].Key === "user.name"){ //$NON-NLS-0$
					result.CommitterName = config[i].Value;
					result.AuthorName = config[i].Value;
				} else if (config[i].Key === "user.email"){ //$NON-NLS-0$
					result.CommitterEmail = config[i].Value;
					result.AuthorEmail = config[i].Value;
				}
			}
			return result;
		};
		
		var displayErrorOnStatus = function(error) {
			var display = {};
			display.Severity = "Error"; //$NON-NLS-0$
			display.HTML = false;
			
			try {
				var resp = JSON.parse(error.responseText);
				if (error.status === 401) {
					display.HTML = true;
					display.Message = "<span>"; //$NON-NLS-0$
					display.Message += i18nUtil.formatMessage(messages["AuthMsgLink"], resp.label, resp.SignInLocation, messages["Login"]); //$NON-NLS-0$
				} else {
					display.Message = resp.DetailedMessage ? resp.DetailedMessage : (resp.Message ? resp.Message : messages["Problem while performing the action"]);
				}
			} catch (Exception) {
				display.Message = messages["Problem while performing the action"];
			}
			
			serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
		};
		
		var perform = function(data) {
			var d = new Deferred();
				
			var item = data.items.status || data.handler.status;
			var location = item.Clone.ConfigLocation;
			var handleError = function(error){
				handleProgressServiceResponse(error, {}, serviceRegistry);
			};
			var commitFunction = function(body){
				if (body.persist) {
					setGitCloneConfig("user.name",body.CommitterName,location).then(function() { //$NON-NLS-0$
						setGitCloneConfig("user.email", body.CommitterEmail, location).then(function() { //$NON-NLS-0$
						}, function(err) {
							handleError(err);
							d.reject(err);
						});	
					}, function(err) {
						handleError(err);
						d.reject(err);
					});	
				}
				var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").commitAll(item.Clone.HeadLocation, null, JSON.stringify(body)), messages["Committing changes"]); //$NON-NLS-0$ //$NON-NLS-1$
				progressService.createProgressMonitor(
					deferred,
					messages["Committing changes"]); //$NON-NLS-0$
				deferred.then(
					function(){
						d.resolve();
					}, 
					function(err) {
						displayErrorOnStatus(err),
						d.reject(err);
					}
				);
			};
					
			var body = data.userData;
			if (body.Amend && !body.Message){
				getAmendMessage(item.CommitLocation).then(function(msg) {
					body.Message = msg;
					commitFunction(body);
				});
			} else {
				commitFunction(body);
			}
			return d;
		};
		return {
			perform:perform,
			displayErrorOnStatus:displayErrorOnStatus,
			getAmendMessage: getAmendMessage,
			getGitCloneConfig: getGitCloneConfig,
			setGitCloneConfig: setGitCloneConfig
		};
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
/*globals confirm*/

define('orion/git/gitCommands',[
	'i18n!git/nls/gitmessages',
	'require',
	'orion/EventTarget',
	'orion/Deferred',
	'orion/i18nUtil',
	'orion/webui/littlelib',
	'orion/commands',
	'orion/commandRegistry',
	'orion/git/util',
	'orion/git/gitPreferenceStorage',
	'orion/git/gitConfigPreference',
	'orion/git/widgets/CloneGitRepositoryDialog',
	'orion/git/widgets/ApplyPatchDialog',
	'orion/URITemplate',
	'orion/git/logic/gitCommon',
	'orion/git/logic/gitPush',
	'orion/git/logic/gitStash',
	'orion/git/logic/gitCommit',
	'orion/objects',
	'orion/URL-shim'
], function(
	messages, require, EventTarget, Deferred, i18nUtil, lib, mCommands, mCommandRegistry, mGitUtil, GitPreferenceStorage,
	GitConfigPreference, mCloneGitRepository, mApplyPatch, URITemplate, mGitCommonLogic, mGitPushLogic, 
	mGitStashLogic, mGitCommitLogic, objects) {

/**
 * @namespace The global container for eclipse APIs.
 */
var exports = {};
//this function is just a closure for the global "doOnce" flag
(function() {
	var doOnce = false;
	
	var editTemplate = new URITemplate("edit/edit.html#{,resource,params*}"); //$NON-NLS-0$
	
	var sharedModelEventDispatcher;
	exports.getModelEventDispatcher = function() {
		if (!sharedModelEventDispatcher) {
			sharedModelEventDispatcher = new EventTarget();
		}
		return sharedModelEventDispatcher;
	};
	
	function dispatchModelEventOn(event) {
		var dispatcher = sharedModelEventDispatcher;
		if (dispatcher && typeof dispatcher.dispatchEvent === "function") { //$NON-NLS-0$
			dispatcher.dispatchEvent(event);
		}
	}
	
	function preCallback(action, data) {
		var evt = {type: "stateChanging", action: action};
		dispatchModelEventOn(evt); //$NON-NLS-1$ //$NON-NLS-0$
		if(evt.preCallback) {
			return evt.preCallback();
		}
		return  new Deferred().resolve(true);
	}
	
	exports.preStateChanged = function() {
		return preCallback("selectionChanged");
	};
	
	exports.updateNavTools = function(registry, commandRegistry, explorer, toolbarId, selectionToolbarId, item, pageNavId) {
		var toolbar = lib.node(toolbarId);
		if (toolbar) {
			commandRegistry.destroy(toolbar);
		} else {
			throw new Error("could not find toolbar " + toolbarId); //$NON-NLS-0$
		}
		commandRegistry.renderCommands(toolbarId, toolbar, item, explorer, "button");  //$NON-NLS-0$
		
		if (pageNavId) {
			var pageNav = lib.node(pageNavId);
			if (pageNav) {
				commandRegistry.destroy(pageNav);
				commandRegistry.renderCommands(pageNavId, pageNav, item, explorer, "button");   //$NON-NLS-0$
			}
		}
		
		if (selectionToolbarId) {
			var selectionTools = lib.node(selectionToolbarId);
			if (selectionTools) {
				commandRegistry.destroy(selectionToolbarId);
				commandRegistry.renderCommands(selectionToolbarId, selectionTools, null, explorer, "button");  //$NON-NLS-0$
			}
		}

		// Stuff we do only the first time
		if (!doOnce) {
			doOnce = true;
			registry.getService("orion.page.selection").addEventListener("selectionChanged", function(event) { //$NON-NLS-1$ //$NON-NLS-0$
				var selectionTools = lib.node(selectionToolbarId);
				if (selectionTools) {
					commandRegistry.destroy(selectionTools);
					commandRegistry.renderCommands(selectionToolbarId, selectionTools, event.selections, explorer, "button"); //$NON-NLS-0$
				}
			});
		}
	};

	exports.handleKnownHostsError = mGitCommonLogic.handleKnownHostsError;

	exports.handleSshAuthenticationError = mGitCommonLogic.handleSshAuthenticationError;

	exports.handleProgressServiceResponse = mGitCommonLogic.handleProgressServiceResponse;

	exports.gatherSshCredentials = mGitCommonLogic.gatherSshCredentials;

	exports.getDefaultSshOptions = mGitCommonLogic.getDefaultSshOptions;
	
	exports.handleGitServiceResponse = mGitCommonLogic.handleGitServiceResponse;
	
	exports.createFileCommands = function(serviceRegistry, commandService, explorer, toolbarId) {

		function displayErrorOnStatus(error) {
			var display = {};
			display.Severity = "Error"; //$NON-NLS-0$
			display.HTML = false;
			
			try {
				var resp = JSON.parse(error.responseText);
				if (error.status === 401) {
					display.HTML = true;
					display.Message = "<span>"; //$NON-NLS-0$
					display.Message += i18nUtil.formatMessage(messages["AuthMsgLink"], resp.label, resp.SignInLocation, messages["Login"]); //$NON-NLS-0$
				} else {
					display.Message = resp.DetailedMessage ? resp.DetailedMessage : (resp.Message ? resp.Message : messages["Problem while performing the action"]);
				}
			} catch (Exception) {
				display.Message = messages["Problem while performing the action"];
			}
			
			serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
		}
		
		function checkoutCallback(data) {
			var item = data.items;
			var checkoutTagFunction = function(repositoryLocation, itemName, name){
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				progress.showWhile(serviceRegistry.getService("orion.git.provider").checkoutTag( //$NON-NLS-0$
						repositoryLocation, itemName, name), i18nUtil.formatMessage(messages["Checking out ${0}"], name)).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "checkout"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, displayErrorOnStatus);
			};
			var repositoryLocation = item.Repository ? item.Repository.Location : item.CloneLocation;
			if (data.parameters.valueFor("name") && !data.parameters.optionsRequested) { //$NON-NLS-0$
				checkoutTagFunction(repositoryLocation, item.Name, data.parameters.valueFor("name")); //$NON-NLS-0$
			}
		}

		var checkoutNameParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter('name', 'text', messages["Local Branch Name:"])]); //$NON-NLS-1$ //$NON-NLS-0$

		var checkoutTagCommand = new mCommands.Command({
			name: messages['Checkout'],
			tooltip: messages["CheckoutTagTooltip"],
			imageClass: "git-sprite-checkout", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.checkoutTag", //$NON-NLS-0$
			parameters: checkoutNameParameters,
			callback: checkoutCallback,
			visibleWhen: function(item){
				return item.Type === "Tag"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(checkoutTagCommand);

		var checkoutCommitCommand = new mCommands.Command({
			name: messages['Checkout'],
			tooltip: messages["CheckoutCommitTooltip"],
			imageClass: "git-sprite-checkout", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.checkoutCommit", //$NON-NLS-0$
			parameters: checkoutNameParameters,
			callback: checkoutCallback,
			visibleWhen: function(item){
				if (item.outgoing && item.top) {
					return false;
				}
				return item.Type === "Commit";	//$NON-NLS-0$
			}
		});
		commandService.addCommand(checkoutCommitCommand);

		var checkoutBranchCommand = new mCommands.Command({
			name: messages['Checkout'],
			tooltip: messages["CheckoutBranchMsg"],
			imageClass: "git-sprite-checkout", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.checkoutBranch", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var service = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var messageService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var progressService = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var msg = item.Name ? i18nUtil.formatMessage(messages["Checking out branch ${0}..."], item.Name) : messages["Checking out branch..."];
				messageService.setProgressMessage(msg);
					
				if (item.Type === "Branch") { //$NON-NLS-0$
					progressService.progress(service.checkoutBranch(item.CloneLocation, item.Name), msg).then(
						function(){
							messageService.setProgressResult(messages["Branch checked out."]);
							dispatchModelEventOn({type: "modelChanged", action: "checkout"}); //$NON-NLS-1$ //$NON-NLS-0$
						},
						 function(error){
							displayErrorOnStatus(error);
						 }
					);
				} else {
					var branchLocation;
					if (item.Repository) {
						branchLocation = item.Repository.BranchLocation;
					} else {
						branchLocation = item.parent.parent.repository.BranchLocation;
					}
					
					var addMsg = i18nUtil.formatMessage(messages["Adding branch ${0}..."], item.Name);
					progressService.progress(service.addBranch(branchLocation, null, item.Name), addMsg).then(
						function(branch){
							progressService.progress(service.checkoutBranch(branch.CloneLocation, branch.Name), msg).then(
								function(){
									messageService.setProgressResult(messages['Branch checked out.']);
									dispatchModelEventOn({type: "modelChanged", action: "checkout"}); //$NON-NLS-1$ //$NON-NLS-0$
								},
								function(error){
									displayErrorOnStatus(error);
								}
							);
						},
						function(error){
							displayErrorOnStatus(error);
						 }
					);
				}
			},
			visibleWhen: function(item) {
				return item.Type === "Branch" || (item.Type === "RemoteTrackingBranch" && item.Id); //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(checkoutBranchCommand);

		var branchNameParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter('name', 'text', messages['Name:'])]); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

		var addBranchCommand = new mCommands.Command({
			name: messages["New Branch"],
			tooltip: messages["Add a new local branch to the repository"],
			id: "eclipse.addBranch", //$NON-NLS-0$
			parameters: branchNameParameters,
			callback: function(data) {
				var item = data.items;
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var createBranchFunction = function(branchLocation, name) {
					var addMsg = i18nUtil.formatMessage(messages["Adding branch ${0}..."], name);
					progress.progress(serviceRegistry.getService("orion.git.provider").addBranch(branchLocation, name), addMsg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "addBranch", branch: name}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				};
				
				var branchLocation;
				if (item.Type === "Clone") { //$NON-NLS-0$
					branchLocation = item.BranchLocation;
				} else {
					branchLocation = item.Location;
				}
				
				if (data.parameters.valueFor("name") && !data.parameters.optionsRequested) { //$NON-NLS-0$
					createBranchFunction(branchLocation, data.parameters.valueFor("name")); //$NON-NLS-0$
				}
			},
			visibleWhen: function(item) {
				return (item.GroupNode && item.Name === "Branches") || (item.Type === "Clone" && explorer.parentId === "artifacts"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(addBranchCommand);

		var removeBranchCommand = new mCommands.Command({
			name: messages["Delete"], // "Delete Branch"
			tooltip: messages["Delete the local branch from the repository"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.removeBranch", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				commandService.confirm(data.domNode, i18nUtil.formatMessage(messages["DelBrConfirm"], item.Name), messages.OK, messages.Cancel, false, function(doit) {
					if (!doit) return;
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
 					var msg = i18nUtil.formatMessage(messages["Removing branch ${0}..."], item.Name);
					progress.progress(serviceRegistry.getService("orion.git.provider").removeBranch(item.Location), msg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "removeBranch", branch: item}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				});
			},
			visibleWhen: function(item) {
				return item.Type === "Branch" && !item.Current; //$NON-NLS-0$
			}
		});
		commandService.addCommand(removeBranchCommand);

		var removeRemoteBranchCommand = new mCommands.Command({
			name: messages['Delete'], // "Delete Remote Branch",
			tooltip: messages["Delete the remote tracking branch from the repository"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.removeRemoteBranch", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				commandService.confirm(data.domNode, i18nUtil.formatMessage(messages["RemoveRemoteBranchConfirm"], item.Name), messages.OK, messages.Cancel, false, function(doit) {
					if (!doit) return;
					exports.getDefaultSshOptions(serviceRegistry, item).then(function(options){
						var func = arguments.callee;
						var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
						var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
						var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
						var deferred = progress.progress(gitService.doPush(item.Location, "", false, false,
								options.gitSshUsername, options.gitSshPassword, options.knownHosts, options.gitPrivateKey,
								options.gitPassphrase), messages["Removing remote branch: "] + item.Name);
						progressService.createProgressMonitor(deferred, messages["Removing remote branch: "] + item.Name);
						deferred.then(function(remoteJsonData) {
							exports.handleProgressServiceResponse(remoteJsonData, options, serviceRegistry, function(jsonData) {
								if (!jsonData || jsonData.Result.Severity === "Ok") //$NON-NLS-0$
									dispatchModelEventOn({type: "modelChanged", action: "removeBranch", branch: item}); //$NON-NLS-1$ //$NON-NLS-0$
							}, func, messages["Delete Remote Branch"]);
						}, function(jsonData) {
							exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {}, func, messages['Removing remote branch: '] + item.Name);
						});
					});
				});
			},
			visibleWhen: function(item) {
				return item.Type === "RemoteTrackingBranch" && item.Id; //$NON-NLS-0$
			}
		});
		commandService.addCommand(removeRemoteBranchCommand);
	
		var addRemoteParameters = new mCommandRegistry.ParametersDescription([
			new mCommandRegistry.CommandParameter('name', 'text', messages['Name:'],null,null,null,function(name){  return !(name.indexOf(' ') >= 0);}),  //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			new mCommandRegistry.CommandParameter('url', 'url', messages['URL:'])
		]); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		
		var addRemoteCommand = new mCommands.Command({
			name: messages["New Remote"],
			tooltip: messages["Add a new remote to the repository"],
			id: "eclipse.addRemote", //$NON-NLS-0$
			parameters: addRemoteParameters,
			callback : function(data) {
				var item = data.items;
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var createRemoteFunction = function(remoteLocation, name, url) {
					var msg = i18nUtil.formatMessage(messages["Adding remote ${0}..."], remoteLocation);
					progress.progress(serviceRegistry.getService("orion.git.provider").addRemote(remoteLocation, name, url), msg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "addRemote", remote: name}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				};
				
				var remoteLocation;
				if (item.Type === "Clone") { //$NON-NLS-0$
					remoteLocation = item.RemoteLocation;
				} else {
					remoteLocation = item.Location;
				}
				
				if (data.parameters.valueFor("name") && data.parameters.valueFor("url")) { //$NON-NLS-1$ //$NON-NLS-0$
					createRemoteFunction(remoteLocation, data.parameters.valueFor("name"), data.parameters.valueFor("url")); //$NON-NLS-1$ //$NON-NLS-0$
				}
			},
			visibleWhen: function(item) {
				return (item.GroupNode && item.Name === "Remotes") ||  (item.Type === "Clone" && explorer.parentId === "artifacts"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(addRemoteCommand);

		var removeRemoteCommand = new mCommands.Command({
			name: messages['Delete'], // "Delete Remote",
			tooltip: messages["Delete the remote from the repository"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.removeRemote", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				commandService.confirm(data.domNode, i18nUtil.formatMessage(messages["Are you sure you want to delete remote ${0}?"], item.Name), messages.OK, messages.Cancel, false, function(doit) {
					if (!doit) return;
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					var msg = i18nUtil.formatMessage(messages["Removing remote ${0}..."], item.Name);
					progress.progress(serviceRegistry.getService("orion.git.provider").removeRemote(item.Location), msg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "removeRemote", remote: item}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				});
			},
			visibleWhen: function(item) {
				return item.Type === "Remote"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(removeRemoteCommand);

		var pullCommand = new mCommands.Command({
			name : messages["Pull"],
			tooltip: messages["Pull from the repository"],
			imageClass: "git-sprite-pull", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.pull", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var path = item.Location;
				var name = item.Name;
				exports.getDefaultSshOptions(serviceRegistry, item).then(function(options) {
					var func = arguments.callee;
					var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
					var statusService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					var pullDeferred = progress.progress(gitService.doPull(path, false,
							options.gitSshUsername,
							options.gitSshPassword,
							options.knownHosts,
							options.gitPrivateKey,
							options.gitPassphrase), messages["Pulling: "] + name);
 
					statusService.createProgressMonitor(pullDeferred, messages["Pulling: "] + name);
					var pullOperationLocation;
					pullDeferred.then(function(jsonData) {
						exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {
							if (item.Type === "Clone") { //$NON-NLS-0$
								dispatchModelEventOn({type: "modelChanged", action: "pull", item: item}); //$NON-NLS-1$ //$NON-NLS-0$
							}
						}, func, "Pull Git Repository"); //$NON-NLS-0$
					}, function(jsonData) {
						if(pullOperationLocation)
							jsonData.failedOperation = pullOperationLocation;
						exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, 
							function() {
								dispatchModelEventOn({type: "modelChanged", action: "pull", item: item}); //$NON-NLS-1$ //$NON-NLS-0$
							}, func, messages["Pull Git Repository"]);
					}, function(operation){
						pullOperationLocation = operation.Location;
					});
				});
			},
			visibleWhen : function(item) {
				return item.Type === "Clone"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(pullCommand);

		var openCloneContent = new mCommands.Command({
			name : messages["ShowInEditor"],
			tooltip: messages["ShowInEditorTooltip"],
			id : "eclipse.openCloneContent", //$NON-NLS-0$
			hrefCallback : function(data) {
				return require.toUrl(editTemplate.expand({resource: data.items.ContentLocation}));
			},
			visibleWhen : function(item) {
				if (!item.ContentLocation)
					return false;
				return true;
			}
		});
		commandService.addCommand(openCloneContent);

		var showDiffCommand = new mCommands.Command({ 
			name: messages["WorkingDirVer"],
			tooltip: messages["ViewWorkingDirVer"],
			id: "eclipse.orion.git.diff.showCurrent", //$NON-NLS-0$
			imageClass: "core-sprite-edit",  //$NON-NLS-0$
			hrefCallback: function(data) {
				return require.toUrl(editTemplate.expand({resource: data.items.ContentLocation || data.items.location}));
			},
			visibleWhen: function(item) {
				switch (item.type) {
				case "Modified": //$NON-NLS-0$
				case "Untracked": //$NON-NLS-0$
				case "Conflicting": //$NON-NLS-0$
				case "Added": //$NON-NLS-0$
				case "Changed": //$NON-NLS-0$
					return !!item.location;
				}
				
				return item.Type === "Diff" && !!item.ContentLocation; //$NON-NLS-0$
			}
		});
		commandService.addCommand(showDiffCommand);

		var openGitCommit = new mCommands.Command({
			name : messages["Open"],
			id : "eclipse.openGitCommit", //$NON-NLS-0$
			tooltip: messages["OpenGitCommitTip"], //$NON-NLS-0$
			imageClass: "core-sprite-outline", //$NON-NLS-0$
			hrefCallback: function(data) {
				return require.toUrl(editTemplate.expand({resource: data.items.TreeLocation}));
			},
			visibleWhen : function(item) {
				return item.Type === "Commit" && item.TreeLocation; //$NON-NLS-0$ 
			}
		});
		commandService.addCommand(openGitCommit);
		
		var openGitDiff = new mCommands.Command({
			name : messages["OpenCommitVersion"],  //$NON-NLS-0$
			id : "eclipse.openGitDiff", //$NON-NLS-0$
			tooltip: messages["ViewCommitVersionTip"], //$NON-NLS-0$
			imageClass: "core-sprite-outline",  //$NON-NLS-0$
			hrefCallback: function(data) {
				return require.toUrl(editTemplate.expand({resource: data.items.TreeLocation}));
			},
			visibleWhen : function(item) {
				return item.Type === "Diff" && item.TreeLocation; //$NON-NLS-0$ 
			}
		});
		commandService.addCommand(openGitDiff);
		
		var fetchCallback = function(data, force, confirmMsg) {
			var d = new Deferred();
			if (confirmMsg && !confirm(confirmMsg)) {
				d.reject();
				return d;
			}

			var item = data.items;
			var noAuth = false;
			if (item.LocalBranch && item.Remote) {
				noAuth = item.noAuth;
				item = item.Remote;
			}
			
			if (item.Remote) {
				noAuth = item.noAuth;
				item = item.Remote;
			}
			
			var path = item.Location;
			var name = item.Name;
			var commandInvocation = data;
			
			var handleResponse = function(jsonData, commandInvocation){
				if (jsonData.JsonData.HostKey){
					commandInvocation.parameters = null;
					commandInvocation.errorData = jsonData.JsonData;
					commandInvocation.errorData.failedOperation = jsonData.failedOperation;
					commandService.collectParameters(commandInvocation);
				} else if (!commandInvocation.optionsRequested){
					var gitPreferenceStorage = new GitPreferenceStorage(serviceRegistry);
					gitPreferenceStorage.isEnabled().then(
						function(isEnabled){
							if(isEnabled){
								if (jsonData.JsonData.User)
									commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:']), new mCommandRegistry.CommandParameter("saveCredentials", "boolean", messages["Don't prompt me again:"])], {hasOptionalParameters: true}); //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
								else
									commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshuser", "text", messages['User Name:']), new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:']), new mCommandRegistry.CommandParameter("saveCredentials", "boolean", messages["Don't prompt me again:"])], {hasOptionalParameters: true}); //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
							} else {
								if (jsonData.JsonData.User)
									commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:'])], {hasOptionalParameters: true}); //$NON-NLS-1$ //$NON-NLS-0$
								else
									commandInvocation.parameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("sshuser", "text", messages['User Name:']), new mCommandRegistry.CommandParameter("sshpassword", "password", messages['Password:'])], {hasOptionalParameters: true}); //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
							}
							
							commandInvocation.errorData = jsonData.JsonData;
							commandInvocation.errorData.failedOperation = jsonData.failedOperation;
							commandService.collectParameters(commandInvocation);
						}
					);
				} else {
					commandInvocation.errorData = jsonData.JsonData;
					commandInvocation.errorData.failedOperation = jsonData.failedOperation;
					commandService.collectParameters(commandInvocation);
				}
			};
			
			var fetchLogic = function(){
				if (commandInvocation.parameters && commandInvocation.parameters.optionsRequested){
					commandInvocation.parameters = null;
					commandInvocation.optionsRequested = true;
					commandService.collectParameters(commandInvocation);
					return;
				}
				
				if(commandInvocation.errorData && commandInvocation.errorData.failedOperation){
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					progress.removeOperation(commandInvocation.errorData.failedOperation);
				}
				
				exports.gatherSshCredentials(serviceRegistry, commandInvocation, null).then(
					function(options) {
						var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
						var statusService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
						var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
						var deferred = progress.progress(gitService.doFetch(path, force,
								options.gitSshUsername,
								options.gitSshPassword,
								options.knownHosts,
								options.gitPrivateKey,
								options.gitPassphrase), messages["Fetching remote: "] + name);
						statusService.createProgressMonitor(deferred, messages["Fetching remote: "] + name);
						deferred.then(
							function(jsonData) {
								exports.handleGitServiceResponse(jsonData, serviceRegistry, 
									function() {
										d.resolve();
									}, function (jsonData) {
										handleResponse(jsonData, commandInvocation);
									}
								);
							}, function(jsonData) {
								var code = jsonData.status || jsonData.HttpCode;
								if (noAuth && (code === 400 || code === 401)) {
									d.reject();
									return;
								}
								exports.handleGitServiceResponse(jsonData, serviceRegistry, 
									function() {
										d.resolve();
									}, function (jsonData) {
										handleResponse(jsonData, commandInvocation);
									}
								);
							}
						);
					},
					d.reject
				);
			};
			
			fetchLogic();
			return d;
		};
		var fetchVisibleWhen = function(item) {
			if (item.LocalBranch && item.Remote) {
				item = item.Remote;
			}
			if (item.Type === "RemoteTrackingBranch" && item.Id) //$NON-NLS-0$
				return true;
			if (item.Type === "Remote") //$NON-NLS-0$
				return true;
			if (item.Type === "Commit" && item.toRef && item.toRef.Type === "RemoteTrackingBranch") //$NON-NLS-1$ //$NON-NLS-0$
				return true;
			return false;
		};

		var fetchCommand = new mCommands.Command({
			name: messages["Fetch"],
			tooltip: messages["Fetch from the remote"],
			imageClass: "git-sprite-fetch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.orion.git.fetch", //$NON-NLS-0$
			callback: function(data) {
				return fetchCallback(data, false).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "fetch", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: fetchVisibleWhen
		});
		commandService.addCommand(fetchCommand);

		var fetchRemoteCommand = new mCommands.Command({
			name: messages["Fetch"],
			tooltip: messages["Fetch from the remote"],
			imageClass: "git-sprite-fetch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.orion.git.fetchRemote", //$NON-NLS-0$
			callback: function(data) {
				return fetchCallback(data, false).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "fetch", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: function(item) {
				if (item.LocalBranch && item.Remote) {
					item = item.Remote;
				}
				if (item.Remote) {
					item = item.Remote;
				}
				if (item.Type === "Remote") //$NON-NLS-0$
					return true;
				return false;
			}
		});
		commandService.addCommand(fetchRemoteCommand);

		var fetchForceCommand = new mCommands.Command({
			name : messages["Force Fetch"],
			imageClass: "git-sprite-fetch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip: messages["FetchRemoteBranch"],
			id : "eclipse.orion.git.fetchForce", //$NON-NLS-0$
			callback: function(data) {
				var confirm = messages["OverrideContentRemoteTrackingBr"]+"\n\n"+messages['Are you sure?']; //$NON-NLS-0$
				fetchCallback(data, true, confirm).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "fetch", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : fetchVisibleWhen
		});
		commandService.addCommand(fetchForceCommand);

		var mergeCommand = new mCommands.Command({
			name : messages["Merge"],
			tooltip: messages["MergeContentFrmBr"],
			imageClass: "git-sprite-merge", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.merge", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var msg = i18nUtil.formatMessage(messages["Merging ${0}"], item.Name);
				progress.progress(gitService.doMerge(item.HeadLocation, item.Name, false), msg).then(function(result){
					var display = {};

					if (result.Result === "FAST_FORWARD" || result.Result === "ALREADY_UP_TO_DATE"){ //$NON-NLS-1$ //$NON-NLS-0$
						display.Severity = "Ok"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = result.Result;
					} else if(result.Result){
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = true;
						display.Message = "<span>" + result.Result; //$NON-NLS-0$
						if(result.FailingPaths){
							var paths = "";
							var isFirstPath = true;
							for(var path in result.FailingPaths){
								if(!isFirstPath){
									paths+=", "; //$NON-NLS-0$
								}
								isFirstPath = false;
								paths+=path;
							}
							if(!isFirstPath){
								display.Severity = "Error"; //$NON-NLS-0$
								display.Message+= ". " + i18nUtil.formatMessage(messages['Failing paths: ${0}'], paths); //$NON-NLS-0$
							}
						}
						display.Message += "</span>"; //$NON-NLS-0$
					} else if(result.error) {
						display.Severity = "Error"; //$NON-NLS-0$
						if(result.error.responseText && JSON.parse(result.error.responseText)){
							var resp = JSON.parse(result.error.responseText);
							display.Message = resp.DetailedMessage ? resp.DetailedMessage : resp.Message;
						}else{
							display.Message = result.error.message;
						}
						display.HTML = true;
						display.Message ="<span>" + display.Message +"</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					}

					progressService.setProgressResult(display);
					dispatchModelEventOn({type: "modelChanged", action: "merge", item: item}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function (error, ioArgs) {
					error = null;//hide warning
					var display = {};
					display.Severity = "Error"; //$NON-NLS-0$
					display.HTML = true;
					display.Message = "<span>" + JSON.stringify(ioArgs.xhr.responseText).DetailedMessage  + "</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					dispatchModelEventOn({type: "modelChanged", action: "merge", item: item, failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : function(item) {
				if (item.Type === "RemoteTrackingBranch" && item.Id) //$NON-NLS-0$
					return true;
				if (item.Type === "Branch" && !item.Current) //$NON-NLS-0$
					return true;
				if (item.Type === "Commit" && item.toRef && item.toRef.Type === "RemoteTrackingBranch") //$NON-NLS-1$ //$NON-NLS-0$
					return true;
				return false;
			}
		});
		commandService.addCommand(mergeCommand);
		
		var mergeSquashCommand = new mCommands.Command({
			name : messages["Merge Squash"],
			tooltip: messages["Squash the content of the branch to the index"],
			imageClass: "git-sprite-merge-squash", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.mergeSquash", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var msg = i18nUtil.formatMessage(messages["Merging ${0}"], item.Name);
				progress.progress(gitService.doMerge(item.HeadLocation, item.Name, true), msg).then(function(result){
					var display = [];

					if (result.Result === "FAST_FORWARD_SQUASHED" || result.Result === "ALREADY_UP_TO_DATE"){ //$NON-NLS-1$ //$NON-NLS-0$
						display.Severity = "Ok"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = result.Result;
					} else if(result.Result){
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = true;
						display.Message = "<span>" + result.Result +"</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					} else if(result.error) {
						display.Severity = "Error"; //$NON-NLS-0$
						if(result.error.responseText && JSON.parse(result.error.responseText)){
							var resp = JSON.parse(result.error.responseText);
							display.Message = resp.DetailedMessage ? resp.DetailedMessage : resp.Message;
						}else{
							display.Message = result.error.message;
						}
						display.HTML = true;
						display.Message ="<span>" + display.Message +"</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					}

					progressService.setProgressResult(display);
					dispatchModelEventOn({type: "modelChanged", action: "mergeSquash", item: item}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function (error, ioArgs) {
					error = null;//hide warning
					var display = [];
					display.Severity = "Error"; //$NON-NLS-0$
					display.HTML = true;
					display.Message = "<span>" + JSON.stringify(ioArgs.xhr.responseText).DetailedMessage + ".</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					
					serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					dispatchModelEventOn({type: "modelChanged", action: "mergeSquash", item: item, failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : function(item) {
				if (item.Type === "RemoteTrackingBranch" && item.Id) //$NON-NLS-0$
					return true;
				if (item.Type === "Branch" && !item.Current) //$NON-NLS-0$
					return true;
				if (item.Type === "Commit" && item.toRef && item.toRef.Type === "RemoteTrackingBranch") //$NON-NLS-1$ //$NON-NLS-0$
					return true;
				return false;
			}
		});
		commandService.addCommand(mergeSquashCommand);
		
		var rebaseCallback = function(data) {
			var d = new Deferred();
			var item = data.items;
			if (item.LocalBranch && item.Remote) {
				item = item.Remote;
			}
			var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").doRebase(item.HeadLocation, item.Name, "BEGIN"), item.Name ? messages["Rebase on top of "] + item.Name: messages['Rebase']); //$NON-NLS-1$ //$NON-NLS-0$
			progressService.createProgressMonitor(deferred, 
			item.Name ? messages["Rebase on top of "] + item.Name: messages['Rebase']);
			deferred.then(
				function(jsonData){
					var display = {};
					switch (jsonData.Result) {
						case "OK": //$NON-NLS-0$
						case "FAST_FORWARD": //$NON-NLS-0$
						case "UP_TO_DATE": //$NON-NLS-0$
							display.Severity = "Ok"; //$NON-NLS-0$
							break;
						case "FAILED_WRONG_REPOSITORY_STATE": //$NON-NLS-0$
						case "FAILED_UNMERGED_PATHS": //$NON-NLS-0$
						case "FAILED_PENDING_CHANGES": //$NON-NLS-0$
						case "UNCOMMITTED_CHANGES": //$NON-NLS-0$
							display.Severity = "Error"; //$NON-NLS-0$
							break;
						case "STOPPED": //$NON-NLS-0$
						default:
							display.Severity = "Warning"; //$NON-NLS-0$
							break;
							
					}
					if (display.Severity === "Ok") { //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result;
						d.resolve(jsonData);
					} else {
						display.HTML = true;
						var msg = messages["Rebase" + jsonData.Result];
						display.Message = "<span>" + jsonData.Result + (msg ? msg : "") + "</span>"; //$NON-NLS-1$ //$NON-NLS-0$ 
						d.reject(jsonData);
					}
					serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
				}, function(error) {
					displayErrorOnStatus(error);
					d.reject();
				}
			);
			return d;
		};

		var rebaseCommand = new mCommands.Command({
			name : messages["Rebase"],
			tooltip: messages["RebaseCommitsMsg"] +
					"and applying each commit again to the updated active branch.", //$NON-NLS-0$
			id : "eclipse.orion.git.rebase", //$NON-NLS-0$
			imageClass: "git-sprite-rebase", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			callback: function(data) {
				rebaseCallback(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "rebase", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function() {
					dispatchModelEventOn({type: "modelChanged", action: "rebase", item: data.items, failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : function(item) {
				this.tooltip = i18nUtil.formatMessage(messages["RebaseTip"], item.Name);
				return (item.Type === "RemoteTrackingBranch" && item.Id) || (item.Type === "Branch" && !item.Current); //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(rebaseCommand);
		
		var pushOptions = {
			serviceRegistry : serviceRegistry,
			commandService : commandService,
			explorer : explorer,
			toolbarId : toolbarId,
		};
		var pushCallbackTags = mGitPushLogic(objects.mixin(pushOptions, {tags: true, force: false})).perform;
		var pushCallbackNoTags = mGitPushLogic(objects.mixin(pushOptions, {tags: false, force: false})).perform;
		var pushCallbackTagsForce = mGitPushLogic(objects.mixin(pushOptions, {tags: true, force: true})).perform;
		var pushCallbackNoTagsForce = mGitPushLogic(objects.mixin(pushOptions, {tags: false, force: true})).perform;
		var pushVisibleWhen = function(item) {
			if (item.LocalBranch && item.Remote) {
				if (item.Remote.Type !== "RemoteTrackingBranch") { //$NON-NLS-0$
					return false;
				}
				item = item.LocalBranch;
			}
			if (item.toRef)
				// for action in the git log
				return item.RepositoryPath === "" && item.toRef.Type === "Branch" && item.toRef.Current && item.toRef.RemoteLocation; //$NON-NLS-0$
			else
				// for action in the repo view
				return item.Type === "Branch" && item.Current && item.RemoteLocation; //$NON-NLS-0$
		};
		
		var syncCommand = new mCommands.Command({
			name : messages["Sync"],
			tooltip: messages["SyncTooltip"],
			extraClass: "primaryButton",  //$NON-NLS-0$
//			imageClass: "git-sprite-push", //$NON-NLS-0$
//			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.sync", //$NON-NLS-0$
			callback: function(data) {
				return fetchCallback(data).then(function() {
					return rebaseCallback(data).then(function() {
						var progressService = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
						var service = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
						var item = data.items;
						progressService.progress(service.getLog(item.Remote.CommitLocation, item.LocalBranch.Name), messages['Getting outgoing commits']).then(function(resp) {
							var done = function() {
								dispatchModelEventOn({type: "modelChanged", action: "sync", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
							};
							if (resp.Children.length > 0) {
								return pushCallbackTags(data).then(done);
							} else {
								done();
							}
						});
					}, function() {
						dispatchModelEventOn({type: "modelChanged", action: "rebase", item: data.items, failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
					});
				});
			},
			visibleWhen: pushVisibleWhen
		});
		commandService.addCommand(syncCommand);
		
		var pushCommand = new mCommands.Command({
			name : messages["Push All"],
			tooltip: messages["PushCommitsTagsFrmLocal"],
			imageClass: "git-sprite-push", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.push", //$NON-NLS-0$
			callback: function(data) {
				pushCallbackTags(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "push", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: pushVisibleWhen
		});
		commandService.addCommand(pushCommand);
		
		var pushBranchCommand = new mCommands.Command({
			name : messages["Push Branch"],
			tooltip: messages["PushCommitsWithoutTags"],
			imageClass: "git-sprite-push", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.pushBranch", //$NON-NLS-0$
			callback:  function(data) {
				pushCallbackNoTags(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "push", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: pushVisibleWhen
		});
		commandService.addCommand(pushBranchCommand);

		var pushForceCommand = new mCommands.Command({
			name : messages["Force Push All"],
			tooltip: messages["PushCommitsTagsFrmLocalBr"],
			imageClass: "git-sprite-push", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.pushForce", //$NON-NLS-0$
			callback: function(data) {
				pushCallbackTagsForce(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "push", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: pushVisibleWhen
		});
		commandService.addCommand(pushForceCommand);
		
		var pushBranchForceCommand = new mCommands.Command({
			name : messages["Force Push Branch"],
			tooltip: messages["PushCommitsWithoutTagsOverridingCurrentContent"],
			imageClass: "git-sprite-push", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.pushForceBranch", //$NON-NLS-0$
			callback: function(data) {
				pushCallbackNoTagsForce(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "push", item: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: pushVisibleWhen
		});
		commandService.addCommand(pushBranchForceCommand);

		var resetCallback = function(data, refId, mode) {
			var location = data.items.IndexLocation;
			if (!location) {
				var temp = data.items.parent;
				while (temp) {
					if (temp.repository) {
						location = temp.repository.IndexLocation;
					}
					temp = temp.parent;
				}
			}
				
			var service = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			var msg = i18nUtil.formatMessage(messages["Resetting git index for ${0}"], refId);
			var deferred = progress.progress(service.resetIndex(location, refId, mode), msg);
			progressService.createProgressMonitor(deferred, messages["Resetting index..."]);
			deferred.then(
				function(){
					var display = {};
					display.Severity = "Info"; //$NON-NLS-0$
					display.HTML = false;
					display.Message = messages["OK"];
					dispatchModelEventOn({type: "modelChanged", action: "reset", mode: mode}); //$NON-NLS-1$ //$NON-NLS-0$
					progressService.setProgressResult(display);
				}, function (error){
					var display = {};
					display.Severity = "Error"; //$NON-NLS-0$
					display.HTML = false;
					display.Message = error.message;
					progressService.setProgressResult(display);
				}
			);
		};

		var okCancelOptions = {getSubmitName: function(){return messages.OK;}, getCancelName: function(){return messages.Cancel;}};
		
		var resetParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter('soft', 'boolean', messages.KeepWorkDir)], objects.mixin({}, okCancelOptions)); //$NON-NLS-1$ //$NON-NLS-0$

		var resetIndexCommand = new mCommands.Command({
			name : messages['Reset'],
			tooltip: messages["ResetActiveBr"],
			id : "eclipse.orion.git.resetIndex", //$NON-NLS-0$
			imageClass: "git-sprite-reset", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			parameters: resetParameters,
			callback: function(data) {
				resetCallback(data, data.items.Name, data.parameters.valueFor("soft") ? "SOFT" : "HARD"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			},
			visibleWhen : function(item) {
				if (item.outgoing && item.top) {
					return false;
				}
				resetParameters.message = i18nUtil.formatMessage(messages.GitResetIndexConfirm, mGitUtil.shortenRefName(item), messages.KeepWorkDir);
				return (item.Type === "RemoteTrackingBranch"  && item.Id) || item.Type === "Branch" || item.Type === "Commit"; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(resetIndexCommand);

		var undoParameters = new mCommandRegistry.ParametersDescription([],objects.mixin({}, okCancelOptions)); //$NON-NLS-1$ //$NON-NLS-0$

		var undoCommand = new mCommands.Command({
			name : messages['Undo'],
			tooltip: messages["UndoTooltip"],
			imageClass: "git-sprite-undo-commit", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.undoCommit", //$NON-NLS-0$
			parameters: undoParameters,
			callback: function(data) {
				resetCallback(data, "HEAD^", "SOFT"); //$NON-NLS-1$ //$NON-NLS-0$
			},
			visibleWhen : function(item) {
				undoParameters.message  = i18nUtil.formatMessage(messages.UndoConfirm, mGitUtil.shortenRefName(item));
				return item.Type === "Commit" && item.parent && item.parent.Type === "Outgoing" && item.parent.children && item.parent.children[0].Name === item.Name; //$NON-NLS-1$ //$NON-NLS-0$
			}
		});
		commandService.addCommand(undoCommand);
		
		var tagNameParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter('name', 'text', messages['Name:'])]); //$NON-NLS-1$ //$NON-NLS-0$

		var addTagCommand = new mCommands.Command({
			name : messages["Tag"],
			tooltip: messages["Create a tag for the commit"],
			imageClass: "git-sprite-tag", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id : "eclipse.orion.git.addTag", //$NON-NLS-0$
			parameters: tagNameParameters,
			callback: function(data) {
				var item = data.items;
				
				var createTagFunction = function(commitLocation, tagName) {
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					var msg = i18nUtil.formatMessage(messages["Adding tag {$0}"], tagName);
					progress.progress(serviceRegistry.getService("orion.git.provider").doAddTag(commitLocation, tagName), msg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "addTag", commit: item, tag: tagName}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				};
				
				var commitLocation = item.Location;
				
				if (data.parameters.valueFor("name") && !data.parameters.optionsRequested) { //$NON-NLS-0$
					createTagFunction(commitLocation, data.parameters.valueFor("name")); //$NON-NLS-0$
				}
			},
			visibleWhen : function(item) {
				return item.Type === "Commit"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(addTagCommand);

		var removeTagCommand = new mCommands.Command({
			name: messages['Delete'],
			tooltip: messages["Delete the tag from the repository"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.removeTag", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				if (confirm(i18nUtil.formatMessage(messages["Are you sure you want to delete tag ${0}?"], item.Name))) {
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					var msg = i18nUtil.formatMessage(messages["Removing tag {$0}"], item.Name);
					progress.progress(serviceRegistry.getService("orion.git.provider").doRemoveTag(item.Location), msg).then(function() { //$NON-NLS-0$
						dispatchModelEventOn({type: "modelChanged", action: "removeTag", tag: item}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus);
				}
			},
			visibleWhen: function(item) {
				return item.Type === "Tag"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(removeTagCommand);
		
		var cherryPickCommand = new mCommands.Command({
			name : messages["Cherry-Pick"],
			tooltip: messages["Apply the change introduced by the commit to your active branch"],
			id : "eclipse.orion.git.cherryPick", //$NON-NLS-0$
			imageClass: "git-sprite-cherry-pick", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var service = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var headLocation = item.Location.replace(item.Name, "HEAD"); //$NON-NLS-0$
				var msg = i18nUtil.formatMessage(messages["CherryPicking"], item.Name);
				progress.progress(service.doCherryPick(headLocation, item.Name), msg).then(function(jsonData) {
					var display = {};
					if (jsonData.Result === "OK") { //$NON-NLS-0$
						// operation succeeded
						display.Severity = "Ok"; //$NON-NLS-0$
						if (jsonData.HeadUpdated) {
							display.HTML = false;
							display.Message = jsonData.Result;
						} else {
							display.HTML = true;
							display.Message = "<span>"+messages["Nothing changed."]+"</span>"; //$NON-NLS-1$ //$NON-NLS-0$
						}
					}
					// handle special cases
					else if (jsonData.Result === "CONFLICTING") { //$NON-NLS-0$
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = true;
						display.Message = "<span>" + jsonData.Result + messages[". Some conflicts occurred"] +"</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					} else if (jsonData.Result === "FAILED") { //$NON-NLS-0$
						display.Severity = "Error"; //$NON-NLS-0$
						display.HTML = true;
						display.Message = "<span>" + jsonData.Result;  //$NON-NLS-0$
						if(jsonData.FailingPaths){
							var paths = "";
							var isFirstPath = true;
							for(var path in jsonData.FailingPaths){
								if(!isFirstPath){
									paths+=", "; //$NON-NLS-0$
								}
								isFirstPath = false;
								paths +=path;
							}
							if(!isFirstPath){
								display.Message+= ". " + i18nUtil.formatMessage(messages['Failing paths: ${0}'], paths); //$NON-NLS-0$
							}
						}
						display.Message += "</span>"; //$NON-NLS-0$
					}
					// handle other cases
					else {
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result;
					}
					serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					dispatchModelEventOn({type: "modelChanged", action: "cherrypick"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, displayErrorOnStatus);

			},
			visibleWhen : function(item) {
				if (item.outgoing) {
					return false;
				}
				return item.Type === "Commit"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(cherryPickCommand);
		
		var revertCommand = new mCommands.Command({
			name : messages["Revert"],
			tooltip: messages["Revert changes introduced by the commit into your active branch"],
			id : "eclipse.orion.git.revert", //$NON-NLS-0$
			imageClass: "git-sprite-revert", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var service = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var headLocation = item.Location.replace(item.Name, "HEAD"); //$NON-NLS-0$
				var msg = i18nUtil.formatMessage(messages["RevertingCommit"], item.Name);
				progress.progress(service.doRevert(headLocation, item.Name), msg).then(function(jsonData) {
					var display = [];
					if (jsonData.Result === "OK") { //$NON-NLS-0$
						// operation succeeded
						display.Severity = "Ok"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result;
					}
					// handle special cases
					else if (jsonData.Result === "FAILURE") { //$NON-NLS-0$
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = true;
						display.Message = "<span>" + jsonData.Result + messages[". Could not revert into active branch"] + "</span>"; //$NON-NLS-1$ //$NON-NLS-0$
					} 
					// handle other cases
					else {
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result;
					}
					serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					dispatchModelEventOn({type: "modelChanged", action: "revert"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, displayErrorOnStatus);

			},
			visibleWhen : function(item) {
				if (item.outgoing && item.top) {
					return false;
				}
				return item.Type === "Commit"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(revertCommand);
	};
	

	exports.createGitClonesCommands = function(serviceRegistry, commandService, explorer, toolbarId, selectionTools, fileClient) {
		toolbarId = selectionTools = null;//make warning go away

		function displayErrorOnStatus(error) {
			var display = {};
			display.Severity = "Error"; //$NON-NLS-0$
			display.HTML = false;
			
			try {
				var resp = JSON.parse(error.responseText);
				display.Message = resp.DetailedMessage ? resp.DetailedMessage : 
					(resp.Message ? resp.Message : messages["Problem while performing the action"]);
			} catch (Exception) {
				display.Message = messages["Problem while performing the action"];
			}
			
			serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
		}
		
		// Git repository configuration
		
		var addConfigParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter('key', 'text', messages['Key:']),  //$NON-NLS-1$ //$NON-NLS-0$
		                                                               		new mCommandRegistry.CommandParameter('value', 'text', messages['Value:'])]); //$NON-NLS-1$ //$NON-NLS-0$
		
		var addConfigEntryCommand = new mCommands.Command({
			name: messages["New Configuration Entry"],
			tooltip: messages['NewConfigurationEntryTooltip'],
			id: "eclipse.orion.git.addConfigEntryCommand", //$NON-NLS-0$
			parameters: addConfigParameters,
			callback: function(data) {
				var item = data.items;
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var key = data.parameters.valueFor("key"); //$NON-NLS-0$
				var value = data.parameters.valueFor("value"); //$NON-NLS-0$
				if (key && value){
					var msg = i18nUtil.formatMessage(messages["AddingConfig"], key, value);
					progress.progress(gitService.addCloneConfigurationProperty(item.ConfigLocation, key, value), msg).then(
						function(){
							dispatchModelEventOn({type: "modelChanged", action: "addConfig", key: key, value: value}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus
					);
				}
			}
		});
		commandService.addCommand(addConfigEntryCommand);
		
		var editConfigParameters = new mCommandRegistry.ParametersDescription([], null, function(commandInvocation) {
			var items = commandInvocation.items;
			var val;
			if(items) {
				val = items.Value[items.index || 0];
			}
			return [new mCommandRegistry.CommandParameter('value', 'text', messages['Value:'], val)]; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		});
		
		var editConfigEntryCommand = new mCommands.Command({
			name: messages["Edit"],
			tooltip: messages["Edit the configuration entry"],
			imageClass: "core-sprite-edit", //$NON-NLS-0$
			id: "eclipse.orion.git.editConfigEntryCommand", //$NON-NLS-0$
			parameters: editConfigParameters,
			callback: function(data) {
				var item = data.items;
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var key = item.Key;
				var value = data.parameters.valueFor("value"); //$NON-NLS-0$
				if (value){ //$NON-NLS-0$
					var msg = i18nUtil.formatMessage(messages["EditingConfig"], key, value);
					item.Value[item.index || 0] = value;
					progress.progress(gitService.editCloneConfigurationProperty(item.Location, item.Value), msg).then(
						function(){
							dispatchModelEventOn({type: "modelChanged", action: "editConfig", key: key, value: value}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus
					);
				}
			},
			visibleWhen: function(item) {
				return (item.Key && item.Value && item.Location);
			}
		});
		commandService.addCommand(editConfigEntryCommand);
		
		var deleteConfigEntryCommand = new mCommands.Command({
			name: messages['Delete'],
			tooltip: messages["Delete the configuration entry"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.orion.git.deleteConfigEntryCommand", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				var key = item.Key;
				var value = item.Value;
				commandService.confirm(data.domNode, i18nUtil.formatMessage(messages["Are you sure you want to delete ${0}?"], key), messages.OK, messages.Cancel, false, function(doit) {
					if (!doit) return;
					var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
					var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
					var msg = i18nUtil.formatMessage(messages["DeletingConfig"], key);
					var query = item.index !== undefined ? "?index=" + item.index : ""; //$NON-NLS-0$
					progress.progress(gitService.deleteCloneConfigurationProperty(item.Location + query), msg).then(
						function() {
							dispatchModelEventOn({type: "modelChanged", action: "deleteConfig", key: key, value: value}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus
					);
				});
			},
			visibleWhen: function(item) {
				return (item.Key && item.Value && item.Location);
			}
		});
		commandService.addCommand(deleteConfigEntryCommand);
		
		var cloneParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("url", "url", messages['Repository URL:'])], {hasOptionalParameters: true}); //$NON-NLS-1$ //$NON-NLS-0$

		function forceSingleItem(item) {
			if (Array.isArray(item)) {
				if (item.length > 1) {
					item = {};
				} else {
					item = item[0];
				}
			}
			return item;
		}
		
		var createGitProjectCommand = new mCommands.Command({
			name : messages["Clone Repository"],
			tooltip : messages["Clone an existing Git repository to a folder"],
			id : "eclipse.createGitProject", //$NON-NLS-0$
			callback : function(data) {
				var item = data.items;
				
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var cloneFunction = function(gitUrl, path, name) {
					
					item.GitUrl = gitUrl;
					exports.getDefaultSshOptions(serviceRegistry, item).then(function(options) {
						var func = arguments.callee;
						var gitConfigPreference = new GitConfigPreference(serviceRegistry);
						
						serviceRegistry.getService("orion.page.message").setProgressMessage(messages.ProjectSetup); //$NON-NLS-0$
						gitConfigPreference.getConfig().then(function(userInfo){
							var msg = i18nUtil.formatMessage(messages["AddClone"], name);
							var deferred = progress.progress(gitService.cloneGitRepository(name, gitUrl, path, explorer.defaultPath, options.gitSshUsername, options.gitSshPassword, options.knownHosts,
									options.gitPrivateKey, options.gitPassphrase, userInfo, true), msg);
							deferred.then(function(jsonData) {
								exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function(jsonData) {
									gitService.getGitClone(jsonData.Location).then(
										function(repoJson){
											var pDescContent = "";
											for(var k in item.projectDescription){
												pDescContent += k + "=" + item.projectDescription[k] + "\n"; //$NON-NLS-1$ //$NON-NLS-0$
											}

											fileClient.write(repoJson.Children[0].ContentLocation + '.git/.projectInfo', pDescContent).then( //$NON-NLS-0$
												function(){
													var editLocation = require.toUrl(editTemplate.expand({resource: repoJson.Children[0].ContentLocation}));
													window.location = editLocation;
												}
											);
										}
									);
								}, func, messages['Clone Git Repository']);
							}, function(jsonData) {
								exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {}, func, messages['Clone Git Repository']);
							});
						});
					});
				};
				
				if (item.url && item.projectDescription.name){
					var msg = i18nUtil.formatMessage(messages["AddClone"], item.projectDescription.name);
					serviceRegistry.getService("orion.page.message").setProgressMessage(msg); //$NON-NLS-0$
					fileClient.loadWorkspace().then(function(projects){
						for(var i=0; i<projects.Children.length; ++i){
							var p = projects.Children[i];
							if(p.Name === item.projectDescription.name){
								if (p.Git){
									gitService.getGitClone(p.Git.CloneLocation).then(
										function(repoJson){
											if (repoJson.Children[0].GitUrl === item.url){
												window.location = require.toUrl(editTemplate.expand({
													resource: repoJson.Children[0].ContentLocation
												}));
											} else {
//												console.info("Folder project is used");
											}
										}
									);
								} else {
//									console.info("Folder project is used");
								}
								return;
							}
						}	
						
						cloneFunction(item.url, null, item.projectDescription.name);	
					});
				}
			},
			visibleWhen : function() {
				return true;
			}
		});
		commandService.addCommand(createGitProjectCommand);
		
		var cloneCallback = function(data) {
			var item = data.items;
			
			var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			var cloneFunction = function(gitUrl, path, name) {
				
				item.GitUrl = gitUrl;
				exports.getDefaultSshOptions(serviceRegistry, item).then(function(options) {
					var func = arguments.callee;
					var gitConfigPreference = new GitConfigPreference(serviceRegistry);
					gitConfigPreference.getConfig().then(function(userInfo){
						var msg = i18nUtil.formatMessage(messages["AddClone"], name);
						var deferred = progress.progress(gitService.cloneGitRepository(name, gitUrl, path, explorer.defaultPath, options.gitSshUsername, options.gitSshPassword, options.knownHosts, //$NON-NLS-0$
								options.gitPrivateKey, options.gitPassphrase, userInfo), msg);
						serviceRegistry.getService("orion.page.message").createProgressMonitor(deferred, //$NON-NLS-0$
								messages["Cloning repository: "] + gitUrl);
						deferred.then(function(jsonData) {
							exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {
								dispatchModelEventOn({type: "modelChanged", action: "addClone", name: name, gitUrl: gitUrl}); //$NON-NLS-1$ //$NON-NLS-0$
							}, func, messages['Clone Git Repository']);
						}, function(jsonData) {
							exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {}, func, messages['Clone Git Repository']);
						});
					});
				});
			};
			if (data.parameters.valueFor("url") && !data.parameters.optionsRequested) { //$NON-NLS-0$
				cloneFunction(data.parameters.valueFor("url")); //$NON-NLS-0$
			} else {
				var dialog = new mCloneGitRepository.CloneGitRepositoryDialog({
					serviceRegistry: serviceRegistry,
					fileClient: fileClient,
					url: data.parameters.valueFor("url"), //$NON-NLS-0$
					alwaysShowAdvanced: data.parameters.optionsRequested,
					func: cloneFunction
				});
						
				dialog.show();
			}
		};

		var cloneGitRepositoryCommand = new mCommands.Command({
			name : messages["Clone Repository"],
			tooltip : messages["Clone an existing Git repository to a folder"],
			id : "eclipse.cloneGitRepository", //$NON-NLS-0$
			parameters: cloneParameters,
			callback : cloneCallback,
			visibleWhen : function() {
				return true;
			}
		});
		commandService.addCommand(cloneGitRepositoryCommand);
		
		var initRepositoryParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("folderName", "text", messages['New folder:'])], {hasOptionalParameters: true}); //$NON-NLS-1$ //$NON-NLS-0$
		
		var initGitRepositoryCommand = new mCommands.Command({
			name : messages["Init Repository"],
			tooltip : messages["Create a new Git repository in a new folder"],
			id : "eclipse.initGitRepository", //$NON-NLS-0$
			parameters: initRepositoryParameters,
			callback : function(data) {
				var item = data.items;
				
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				var initRepositoryFunction = function(gitUrl, path, name) {
					
					item.GitUrl = gitUrl;
					exports.getDefaultSshOptions(serviceRegistry, item).then(function(options){
						var func = arguments.callee;
						var gitConfigPreference = new GitConfigPreference(serviceRegistry);
						gitConfigPreference.getConfig().then(function(userInfo){
							var deferred = progress.progress(gitService.cloneGitRepository(name, gitUrl, path, explorer.defaultPath, null, null, null, null, null, userInfo), messages["Initializing repository: "] + name); //$NON-NLS-0$
							serviceRegistry.getService("orion.page.message").createProgressMonitor(deferred, messages["Initializing repository: "] + name); //$NON-NLS-0$
							deferred.then(function(jsonData){
								exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function(){
									dispatchModelEventOn({type: "modelChanged", action: "addClone", name: name, gitUrl: gitUrl}); //$NON-NLS-1$ //$NON-NLS-0$
								}, func, messages["Init Git Repository"]);
							}, function(jsonData) {
								exports.handleProgressServiceResponse(jsonData, options, serviceRegistry, function() {}, func, messages['Init Git Repository']);
							});
						});
					});
				};
				
				if (data.parameters.valueFor("folderName") && !data.parameters.optionsRequested) { //$NON-NLS-0$
					initRepositoryFunction(null, null, data.parameters.valueFor("folderName")); //$NON-NLS-0$
				} else {
					var dialog = new mCloneGitRepository.CloneGitRepositoryDialog({
						serviceRegistry: serviceRegistry,
						title: messages['Init Git Repository'],
						fileClient: fileClient,
						advancedOnly: true,
						func: initRepositoryFunction
					});
							
					dialog.show();
				}
			},
			visibleWhen : function() {
				return true;
			}
		});
		commandService.addCommand(initGitRepositoryCommand);

		var deleteCommand = new mCommands.Command({
			name: messages['Delete'], // "Delete Repository"
			tooltip: messages["Delete the repository"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.git.deleteClone", //$NON-NLS-0$
			visibleWhen: function(item) {
				return item.Type === "Clone"; //$NON-NLS-0$
			},
			callback: function(data) {
				var item = data.items;
				var gitService = serviceRegistry.getService("orion.git.provider"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				if(Array.isArray(item)){
					commandService.confirm(data.domNode, i18nUtil.formatMessage(messages["Are you sure you want do delete ${0} repositories?"], item.length), messages.OK, messages.Cancel, false, function(doit) {
						if (!doit) return;
						var alreadyDeleted = 0;
						for(var i=0; i<item.length; i++){
							var msg = i18nUtil.formatMessage(messages["Removing repository ${0}"], item.Name);
							progress.progress(gitService.removeGitRepository(item[i].Location), msg).then(
									function(){
										alreadyDeleted++;
										if(alreadyDeleted >= item.length){
											dispatchModelEventOn({type: "modelChanged", action: "removeClone", items: item}); //$NON-NLS-1$ //$NON-NLS-0$
										}
									}, displayErrorOnStatus);
						}
					});
				} else {
					commandService.confirm(data.domNode, i18nUtil.formatMessage(messages['Are you sure you want to delete ${0}?'], item.Name), messages.OK, messages.Cancel, false, function(doit) {
						if (!doit) return;
						var msg1 = i18nUtil.formatMessage(messages["Removing repository ${0}"], item.Name);
						progress.progress(gitService.removeGitRepository(item.Location), msg1).then(
							function(){
								dispatchModelEventOn({type: "modelChanged", action: "removeClone", items: [item]}); //$NON-NLS-1$ //$NON-NLS-0$
							},
							displayErrorOnStatus);
					});
				}
			}
		});
		commandService.addCommand(deleteCommand);

		var applyPatchCommand = new mCommands.Command({
			name : messages['Apply Patch'],
			tooltip: messages["Apply a patch on the selected repository"],
			id : "eclipse.orion.git.applyPatch", //$NON-NLS-0$
			imageClass: "git-sprite-apply-patch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("applyPatch", data);
			},
			callback: function(data) {
				var item = forceSingleItem(data.items);
				var deferred = new Deferred();
				var dialog = new mApplyPatch.ApplyPatchDialog({
					title: messages['Apply Patch'],
					diffLocation: item.DiffLocation || item.repository.DiffLocation,
					deferred: deferred
				});
				dialog.show();
				var messageService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				deferred.then(function(result){
					var message;
					try{
						var jsonResult = JSON.parse(result);
						if(jsonResult.JsonData){
							var display = {};
							display.Severity = "Info"; //$NON-NLS-0$
							display.HTML = false;
							display.Message = messages["PatchApplied"];
							messageService.setProgressResult(display); //$NON-NLS-0$
							dispatchModelEventOn({type: "modelChanged", action: "applyPatch"});  //$NON-NLS-1$  //$NON-NLS-0$
							return;
						}
					} catch (e){
					}
					message = messages["PatchApplied"];
					messageService.setMessage(message);
				}, function(error){
					var jsonError = JSON.parse(error);
					var display = {};
					display.Severity = "Error"; //$NON-NLS-0$
					display.HTML = false;
					display.Message = i18nUtil.formatMessage(messages["PatchFailed"], jsonError.DetailedMessage || jsonError.Message || "");
					messageService.setProgressResult(display); //$NON-NLS-0$
				});
			},
			visibleWhen : function(item) {
				return item.Type === "Clone" || item.repository; //$NON-NLS-0$
			}
		});
		commandService.addCommand(applyPatchCommand);
	};

	exports.createGitStatusCommands = function(serviceRegistry, commandService) {
		var commitOptions = {
			serviceRegistry : serviceRegistry,
			commandService : commandService,
		};
		
		var logic = mGitCommitLogic(commitOptions);
		var commitCallback = logic.perform;
		var displayErrorOnStatus = logic.displayErrorOnStatus;
		
		function forceArray(item) {
			if (!Array.isArray(item)) {
				item = [item];
			}
			return item;
		}
		
		var stageCommand = new mCommands.Command({
			name: messages['Stage'],
			tooltip: messages['Stage the change'],
			imageClass: "git-sprite-stage", //$NON-NLS-0$ //$NON-NLS-1$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$ //$NON-NLS-1$
			id: "eclipse.orion.git.stageCommand", //$NON-NLS-0$
			callback: function(data) {
				var items = forceArray(data.items);
				
				var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var deferred;
				if (items.length === 1){
					deferred = progress.progress(serviceRegistry.getService("orion.git.provider").stage(items[0].indexURI), messages["Staging changes"]); //$NON-NLS-0$ 
					progressService.createProgressMonitor(
						deferred,
						messages["Staging changes"]);
					return deferred.then(
						function(){
							dispatchModelEventOn({type: "modelChanged", action: "stage", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus
					);
				} else {
					var paths = [];
					for (var i = 0; i < items.length; i++) {
						paths[i] = items[i].name;
					}
					
					deferred = progress.progress(serviceRegistry.getService("orion.git.provider").stageMultipleFiles(data.userData.Clone.IndexLocation, paths),  messages["Staging changes"]); //$NON-NLS-0$
					progressService.createProgressMonitor(
						deferred, //$NON-NLS-0$
						messages["Staging changes"]);
					return deferred.then(
						function(){
							dispatchModelEventOn({type: "modelChanged", action: "stage", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus
					);
				}			
			},
			visibleWhen: function(item) {
				var items = forceArray(item);
				if (items.length === 0)
					return false;

				for (var i = 0; i < items.length; i++) {
					if (!mGitUtil.isChange(items[i]) || mGitUtil.isStaged(items[i]))
						return false; 
				}
				return true;
			}
		});	
		
		commandService.addCommand(stageCommand);
		
		var doUnstage = function(data) {
			var items = forceArray(data.items);
				
			var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			var deferred;
			if (items.length === 1){				
				deferred = progress.progress(serviceRegistry.getService("orion.git.provider").unstage(items[0].indexURI, items[0].name), messages['Unstaging changes']); //$NON-NLS-0$
				progressService.createProgressMonitor(
					deferred, //$NON-NLS-0$
					messages['Staging changes']);
			} else {
				var paths = [];
				for (var i = 0; i < items.length; i++) {
					paths[i] = items[i].name;
				}
				
				deferred = progress.progress(serviceRegistry.getService("orion.git.provider").unstage(data.userData.Clone.IndexLocation, paths), messages['Unstaging changes']); //$NON-NLS-0$
				progressService.createProgressMonitor(
					deferred,
					messages['Staging changes']);
			}
			return deferred.then(function() {return items;});
		};
		
		var unstageCommand = new mCommands.Command({
			name: messages['Unstage'],
			tooltip: messages['Unstage the change'],
			imageClass: "git-sprite-unstage", //$NON-NLS-0$  //$NON-NLS-1$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$ //$NON-NLS-1$
			id: "eclipse.orion.git.unstageCommand", //$NON-NLS-0$
			callback: function(data) {
				return doUnstage(data).then(
					function(items){
						dispatchModelEventOn({type: "modelChanged", action: "unstage", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
					}, displayErrorOnStatus
				);
			},
			visibleWhen: function(item) {
				var items = forceArray(item);
				if (items.length === 0)
					return false;

				for (var i = 0; i < items.length; i++) {
					if (!mGitUtil.isChange(items[i]) || !mGitUtil.isStaged(items[i]))
						return false; 
				}
				return true;
			}
		});	
		
		commandService.addCommand(unstageCommand);
		
		var commitCommand = new mCommands.Command({
			name: messages["Commit"], //$NON-NLS-0$
			tooltip: messages["Commit"], //$NON-NLS-0$
			id: "eclipse.orion.git.commitCommand", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("commit", data);
			},
			callback: function(data) {
				commitCallback(data).then(function() {
					dispatchModelEventOn({type: "modelChanged", action: "commit"}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen: function() {
				return true;
			}
		});	

		commandService.addCommand(commitCommand);

		var resetCommand = new mCommands.Command({
			name: messages['Reset'],
			tooltip: messages['ResetBranchDiscardChanges'],
			imageClass: "core-sprite-refresh", //$NON-NLS-0$
			id: "eclipse.orion.git.resetCommand", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("reset", data);
			},
			callback: function(data) {
				var item = data.items;
				
				var dialog = serviceRegistry.getService("orion.page.dialog"); //$NON-NLS-0$
				dialog.confirm(messages['ResetConfirm'],
					function(doit) {
						if (!doit) {
							return;
						}
						var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
						var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
						var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").unstageAll(item.IndexLocation, "HARD"), messages["Resetting local changes"]); //$NON-NLS-1$ //$NON-NLS-0$ 
						progressService.createProgressMonitor(
							deferred,
							messages["Resetting local changes"]);
						deferred.then(
							function(){
								dispatchModelEventOn({type: "modelChanged", action: "reset", mode: "HARD"}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
							}, displayErrorOnStatus
						);		
					}
				);
			},
			
			visibleWhen: function(item) {
				if (item.Type !== "Status") { //$NON-NLS-0$
					return false;
				}
				return mGitUtil.hasStagedChanges(item) || mGitUtil.hasUnstagedChanges(item);
			}
		});

		commandService.addCommand(resetCommand);

		var checkoutCommand = new mCommands.Command({
			name: messages['Checkout'],
			tooltip: messages["CheckoutSelectedFiles"],
 			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.orion.git.checkoutCommand", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("checkoutFile", data);
			},
			callback: function(data) {				
				var items = forceArray(data.items);
				
				var dialog = serviceRegistry.getService("orion.page.dialog"); //$NON-NLS-0$
				dialog.confirm(messages["CheckoutConfirm"],
					function(doit) {
						if (!doit) {
							return;
						}
						
						var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
						var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
						
						var paths = [];
						for (var i = 0; i < items.length; i++) {
							paths[i] = items[i].name;
						}
						
						var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").checkoutPath(data.userData.Clone.Location, paths), messages['Resetting local changes']); //$NON-NLS-0$
						progressService.createProgressMonitor(
							deferred,
							messages['Resetting local changes']);
						deferred.then(
							function(){
								dispatchModelEventOn({type: "modelChanged", action: "checkoutFile", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
							}, displayErrorOnStatus
						);				
					}
				);
			},
			visibleWhen: function(item) {
				var items = forceArray(item);
				if (items.length === 0)
					return false;

				for (var i = 0; i < items.length; i++) {
					if (!mGitUtil.isChange(items[i]) || mGitUtil.isStaged(items[i]))
						return false; 
				}
				return true;
			}
		});

		commandService.addCommand(checkoutCommand);
		
		var checkoutStagedCommand = new mCommands.Command({
			name: messages['Discard'],
			tooltip: messages["CheckoutSelectedFiles"],
 			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			id: "eclipse.orion.git.checkoutStagedCommand", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("checkoutFile", data);
			},
			callback: function(data) {				
				commandService.confirm(data.domNode, messages["CheckoutConfirm"], messages.OK, messages.Cancel, false,
					function(doit) {
						if (!doit) {
							return;
						}
						
						doUnstage(data).then(function(items) {
							var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
							var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
							
							var paths = [];
							for (var i = 0; i < items.length; i++) {
								paths[i] = items[i].name;
							}
							
							var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").checkoutPath(data.userData.Clone.Location, paths), messages['Resetting local changes']); //$NON-NLS-0$
							progressService.createProgressMonitor(
								deferred,
								messages['Resetting local changes']);
							return deferred.then(
								function(){
									dispatchModelEventOn({type: "modelChanged", action: "checkoutFile", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
								}, displayErrorOnStatus
							);
						});				
					}
				);
			},
			visibleWhen: function() {
				return true;
			}
		});

		commandService.addCommand(checkoutStagedCommand);

		var ignoreCommand = new mCommands.Command({
			name: messages["Ignore"],
			tooltip: messages["AddFilesToGitignore"],
			imageClass: "git-sprite-checkout", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			id: "eclipse.orion.git.ignoreCommand", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("ignoreFile", data);
			},
			callback: function(data) {
				
				var items = data.items;
				var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
				var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
				
				var paths = [];
				for (var i = 0; i < items.length; i++) {
					paths[i] = items[i].name;
				}
				
				var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").ignorePath(data.userData.Clone.IgnoreLocation, paths), messages["Writing .gitignore rules"]); //$NON-NLS-0$ //$NON-NLS-1$
				progressService.createProgressMonitor(
					deferred,
					messages["Writing .gitignore rules"]);
				
				return deferred.then(
					function(){
						
						deferred = progress.progress(serviceRegistry.getService("orion.git.provider").unstage(data.userData.Clone.IndexLocation, paths), messages['Resetting local changes']); //$NON-NLS-0$ //$NON-NLS-1$
						progressService.createProgressMonitor(
							deferred,
							messages['Resetting local changes']);
						
						return deferred.then(function(){
							dispatchModelEventOn({type: "modelChanged", action: "ignoreFile", items: items}); //$NON-NLS-1$ //$NON-NLS-0$
						}, displayErrorOnStatus);
						
					}, displayErrorOnStatus
				);
			},
			visibleWhen: function() {
				return true;
			}
		});
		
		commandService.addCommand(ignoreCommand);
		
		var showPatchCommand = new mCommands.Command({
			name: messages["Show Patch"],
			imageClass: "git-sprite-save-patch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip: messages["Show workspace changes as a patch"],
			id: "eclipse.orion.git.showPatchCommand", //$NON-NLS-0$
			hrefCallback : function(data) {
				var items = forceArray(data.items);
				
				var url = data.userData.Clone.DiffLocation + "?parts=diff"; //$NON-NLS-0$
				for (var i = 0; i < items.length; i++) {
					url += "&Path="; //$NON-NLS-0$
					url += items[i].name;
				}
				return url;
			},
			visibleWhen: function(item) {
				var items = forceArray(item);
				if (items.length === 0)
					return false;

				for (var i = 0; i < items.length; i++) {
					if (mGitUtil.isStaged(items[i]))
						return false; 
				}
				return true;
			}
		});
		
		commandService.addCommand(showPatchCommand);
		
		var showPatchCallback = function(data) {
			var items = forceArray(data.items);
			var url, i;
			if (data.userData && data.userData.Clone && data.userData.Clone.DiffLocation) {
				url = data.userData.Clone.DiffLocation.replace("\/Default\/", "\/Cached\/") + "?parts=diff"; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				for (i = 0; i < items.length; i++) {
					url += "&Path="; //$NON-NLS-0$
					url += items[i].name;
				}
			} else if (data.items && data.items.Diffs && data.items.Diffs.Children) {
				var baseLocation = data.items.Diffs.Children[0].DiffLocation;
				var newPath = data.items.Diffs.Children[0].NewPath;
				url = baseLocation.substring(0, baseLocation.length - newPath.length);
				url += "?parts=diff";  //$NON-NLS-0$
				for (i = 0; i < data.items.Diffs.Children.length; i++) {
					url += "&Path="; //$NON-NLS-0$
					url += data.items.Diffs.Children[i].NewPath;
				}
			}
			window.open(url);
		};
			
		var showStagedPatchCommand = new mCommands.Command({
			name: messages["Show Patch"],
			imageClass: "git-sprite-save-patch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip: messages["Show checked changes as a patch"],
			id: "eclipse.orion.git.showStagedPatchCommand", //$NON-NLS-0$
			callback: showPatchCallback,
			visibleWhen: function() {
				return true;
			}
		});
		commandService.addCommand(showStagedPatchCommand);
		
		var showCommitPatchCommand = new mCommands.Command({
			name: messages["Show Patch"],
			imageClass: "git-sprite-save-patch", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip: messages["ShowCommitPatchTip"],
			id: "eclipse.orion.git.showCommitPatchCommand", //$NON-NLS-0$
			callback: showPatchCallback,
			visibleWhen: function() {
				return true;
			}
		});
		commandService.addCommand(showCommitPatchCommand);
		
		// Rebase commands
		
		function _rebase(HeadLocation, action){
			var progressService = serviceRegistry.getService("orion.page.message"); //$NON-NLS-0$
			var progress = serviceRegistry.getService("orion.page.progress"); //$NON-NLS-0$
			
			var deferred = progress.progress(serviceRegistry.getService("orion.git.provider").doRebase(HeadLocation, "", action), messages["RebasingRepo"]); //$NON-NLS-1$ //$NON-NLS-0$ 
			progressService.createProgressMonitor(
				deferred,
				action);
			deferred.then(
				function(jsonData){
					var display = {};
					if (jsonData.Result === "OK" || jsonData.Result === "ABORTED" || jsonData.Result === "FAST_FORWARD" || jsonData.Result === "UP_TO_DATE") { //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						display.Severity = "Ok"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result;
						serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					} else if (jsonData.Result === "STOPPED") { //$NON-NLS-0$
						display.Severity = "Warning"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result + messages['RepoConflict'];
 						serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					} else if (jsonData.Result === "FAILED_UNMERGED_PATHS") { //$NON-NLS-0$
						display.Severity = "Error"; //$NON-NLS-0$
						display.HTML = false;
						display.Message = jsonData.Result + messages['RepoUnmergedPathResolveConflict'];
 						serviceRegistry.getService("orion.page.message").setProgressResult(display); //$NON-NLS-0$
					}
					dispatchModelEventOn({type: "modelChanged", action: "rebase", rebaseAction: action, result: jsonData.Result, failed: display.Severity !== "Ok"}); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
					
				}, displayErrorOnStatus
			);
		}
		
		var rebaseContinueCommand = new mCommands.Command({
			name: messages["Continue"],
			tooltip: messages["Contibue Rebase"],
			id: "eclipse.orion.git.rebaseContinueCommand", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				return _rebase(item.Clone.HeadLocation, "CONTINUE"); //$NON-NLS-0$
			},
			
			visibleWhen: function(item) {
				return item.RepositoryState && item.RepositoryState.indexOf("REBASING") !== -1; //$NON-NLS-0$
			}
		});
		
		commandService.addCommand(rebaseContinueCommand);
		
		var rebaseSkipPatchCommand = new mCommands.Command({
			name: messages["Skip Patch"],
			tooltip: messages['Skip Patch'],
			id: "eclipse.orion.git.rebaseSkipPatchCommand", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				return _rebase(item.Clone.HeadLocation, "SKIP"); //$NON-NLS-0$
			},
			
			visibleWhen: function(item) {
				return item.RepositoryState && item.RepositoryState.indexOf("REBASING") !== -1; //$NON-NLS-0$
			}
		});
		
		commandService.addCommand(rebaseSkipPatchCommand);
		
		var rebaseAbortCommand = new mCommands.Command({
			name: messages["Abort"],
			tooltip: messages["Abort Rebase"],
			id: "eclipse.orion.git.rebaseAbortCommand", //$NON-NLS-0$
			callback: function(data) {
				var item = data.items;
				return _rebase(item.Clone.HeadLocation, "ABORT"); //$NON-NLS-0$
			},
			
			visibleWhen: function(item) {
				return item.RepositoryState && item.RepositoryState.indexOf("REBASING") !== -1; //$NON-NLS-0$
			}
		});
		
		commandService.addCommand(rebaseAbortCommand);	
	};
	
	exports.createSharedCommands = function(serviceRegistry, commandService, explorer, toolbarId) {
		
		//used both as confirm and remotePrompter dialogs callback
		var refresh = function(data) { 
			if (data && data.handler.changedItem) {
				data.handler.changedItem();
			} else { 
				explorer.changedItem(); 
			}
		};
		
		var pushOptions = {
			serviceRegistry : serviceRegistry,
			commandService : commandService,
			explorer : explorer,
			toolbarId : toolbarId,
			tags : true,
			sshCredentialsDialogCloseCallback : refresh,
			sshSlideoutCloseCallback : refresh,
		};
		
		var commitOptions = {
			serviceRegistry : serviceRegistry,
			commandService : commandService,
		};
		
		var pushLogic = mGitPushLogic(pushOptions);
		var stashLogic = mGitStashLogic(pushOptions);
		var commitLogic = mGitCommitLogic(commitOptions);
		
		var commitCallback = commitLogic.perform;
		var displayErrorOnStatus = commitLogic.displayErrorOnStatus;
		var pushCallback = pushLogic.perform;
		
		
		var commitAndPushCommand = new mCommands.Command({
			name: messages["CommitPush"],
			tooltip: messages["Commits and pushes files to the default remote"],
			id: "eclipse.orion.git.commitAndPushCommand", //$NON-NLS-0$
			callback: function(data) {
				commitCallback(data).then(function() {
					serviceRegistry.getService("orion.git.provider").getGitBranch(data.items.Clone.BranchLocation).then( //$NON-NLS-0$
							function(resp) { 
								var branches = resp.Children;
								var currentBranch;
								for (var i = 0; i < branches.length; i++) {
									if (branches[i].Current) {
										currentBranch = branches[i];
										break;
									}
								}
								//Stripping additional info
								data.command = undefined;
								data.targetBranch = undefined;
								data.parameters = undefined;
								
								data.items.LocalBranch = currentBranch;
								data.items.Remote = currentBranch.RemoteLocation[0].Children[0];
								
								pushCallback(data).then(function() {
									refresh();
								});
							},
							function(err) {
								displayErrorOnStatus(err);
								refresh();
							});
				},
				function(err) {
					displayErrorOnStatus(err);
				});
			},
			visibleWhen: function() {
				return true;
			}
		});
		commandService.addCommand(commitAndPushCommand);
		
		var createStashCommand = new mCommands.Command({
			name : messages["Stash"],
			imageClass: "git-sprite-stash-changes", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip : messages["Stash all current changes away"],
			id : "eclipse.orion.git.createStash", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("stash", data);
			},
			callback : function(data){
				stashLogic.stashAll(data).then(function(){
					dispatchModelEventOn({type: "modelChanged", action: "stash"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function(error){
					displayErrorOnStatus(error);
				});
			},
			visibleWhen : function(){
				return true;
			}
		});
		commandService.addCommand(createStashCommand);
		
		var dropStashCommand = new mCommands.Command({
			name : messages["Drop"],
			imageClass: "core-sprite-trashcan", //$NON-NLS-0$
			tooltip : messages["Drop the commit from the stash list"],
			id : "eclipse.orion.git.dropStash", //$NON-NLS-0$
			callback : function(data){
				stashLogic.drop(data).then(function(){
					dispatchModelEventOn({type: "modelChanged", action: "dropStash", stash: data.items}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function(error){
					displayErrorOnStatus(error);
				});
			},
			visibleWhen : function(item){
				return item.Type === "StashCommit"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(dropStashCommand);
		
		var applyStashCommand = new mCommands.Command({
			name : messages["Apply"],
			tooltip : messages["Apply the change introduced by the commit to your active branch"],
			id : "eclipse.orion.git.applyStash", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("applyStash", data);
			},
			callback : function(data){
				stashLogic.apply(data).then(function(){
					dispatchModelEventOn({type: "modelChanged", action: "applyStash"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function(error){
					displayErrorOnStatus(error);
					dispatchModelEventOn({type: "modelChanged", action: "applyStash", failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : function(item){
				return item.Type === "StashCommit"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(applyStashCommand);
		
		var popStashCommand = new mCommands.Command({
			name : messages["Pop Stash"],
			imageClass: "git-sprite-pop-changes", //$NON-NLS-0$
			spriteClass: "gitCommandSprite", //$NON-NLS-0$
			tooltip : messages["Apply the most recently stashed change to your active branch and drop it from the stashes"],
			id : "eclipse.orion.git.popStash", //$NON-NLS-0$
			preCallback: function(data) {
				return preCallback("popStash", data);
			},
			callback : function(data){
				stashLogic.pop(data).then(function(){
					dispatchModelEventOn({type: "modelChanged", action: "popStash"}); //$NON-NLS-1$ //$NON-NLS-0$
				}, function(error){
					displayErrorOnStatus(error);
					dispatchModelEventOn({type: "modelChanged", action: "popStash", failed: true}); //$NON-NLS-1$ //$NON-NLS-0$
				});
			},
			visibleWhen : function(item){
				return item.Type === "Clone"; //$NON-NLS-0$
			}
		});
		commandService.addCommand(popStashCommand);
	};

}());

return exports;	

});

/*******************************************************************************
 * @license Copyright (c) 2014 IBM Corporation and others. All rights
 *          reserved. This program and the accompanying materials are made
 *          available under the terms of the Eclipse Public License v1.0
 *          (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse
 *          Distribution License v1.0
 *          (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define('orion/git/widgets/gitChangeList',[
	'i18n!git/nls/gitmessages',
	'orion/i18nUtil',
	'orion/Deferred',
	'orion/explorers/explorer',
	'orion/git/uiUtil',
	'orion/git/util',
	'orion/webui/tooltip',
	'orion/selection',
	'orion/webui/littlelib',
	'orion/git/gitCommands',
	'orion/commands',
	'orion/commandRegistry',
	'orion/git/logic/gitCommit',
	'orion/git/gitConfigPreference',
	'orion/objects'
], function(messages, i18nUtil, Deferred, mExplorer, mGitUIUtil, mGitUtil, mTooltip, mSelection , lib, mGitCommands, mCommands, mCommandRegistry, gitCommit, gitConfigPreference, objects) {
	
	var pageQuery = "?pageSize=100&page=1"; //$NON-NLS-0$
	
	var interestedUnstagedGroup = [ "Missing", "Modified", "Untracked", "Conflicting" ]; //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	var interestedStagedGroup = [ "Added", "Changed", "Removed" ]; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	var allGroups = interestedUnstagedGroup.concat(interestedStagedGroup);
	var conflictType = "Conflicting"; //$NON-NLS-0$
	function isConflict(type) {
		return type === conflictType;
	}
	
	var statusTypeMap = {
		"Missing" : { imageClass: "gitImageSprite git-sprite-removal", tooltip: messages['Unstaged removal'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Removed" : { imageClass: "gitImageSprite git-sprite-removal", tooltip: messages['Staged removal'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Modified" : { imageClass: "gitImageSprite git-sprite-file", tooltip: messages['Unstaged change'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Changed" : { imageClass: "gitImageSprite git-sprite-file", tooltip: messages['Staged change'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Untracked" : { imageClass: "gitImageSprite git-sprite-addition", tooltip: messages["Unstaged addition"] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Added" : { imageClass: "gitImageSprite git-sprite-addition", tooltip: messages["Staged addition"] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Conflicting" : { imageClass: "gitImageSprite git-sprite-conflict-file", tooltip: messages['Conflicting'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

		"ADD" : { imageClass: "gitImageSprite git-sprite-addition", tooltip: messages['Addition'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"MODIFY" : { imageClass: "gitImageSprite git-sprite-file", tooltip: messages['Deletion'] }, //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"DELETE" : { imageClass: "gitImageSprite git-sprite-removal", tooltip: messages['Diffs'] } //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	};
			
	function GitChangeListModel(options) {
		this.changes = options.changes;
		this.registry = options.registry;
		this.prefix = options.prefix;
		this.location = options.location;
		this.commitName = options.commitName;
		this.repository = options.repository;
		this.handleError = options.handleError;
		this.gitClient = options.gitClient;
		this.progressService = options.progressService;
		this.section = options.section;
		this.root = this.changes || {Type: this.location ? "Diff" : "Root"}; //$NON-NLS-1$ //$NON-NLS-0$
	}
	GitChangeListModel.prototype = Object.create(mExplorer.ExplorerModel.prototype);
	objects.mixin(GitChangeListModel.prototype, /** @lends orion.git.GitChangeListModel.prototype */ {
		getRoot: function(onItem){
			onItem(this.root);
		},
		getGroups: function(prefix) {
			switch(prefix) {
				case "all": //$NON-NLS-0$
					return allGroups;
				case "staged": //$NON-NLS-0$
					return interestedStagedGroup;
				case "unstaged": //$NON-NLS-0$
					return interestedUnstagedGroup;
			}
		},
		processMoreChildren: function(parentItem, children, item) {
			var fullList = parentItem.children;
			
			children.forEach(function(item) {
				var path = item.OldPath;
				if (item.ChangeType === "ADD") { //$NON-NLS-0$
					path = item.NewPath;
				} 
				item.name = path;
				item.type = item.ChangeType;
			});
			
			if (fullList) {
				var args = [fullList.length - 1, 1].concat(children);
				Array.prototype.splice.apply(fullList, args);
			} else {
				fullList = children;
				if (children.length > 0) {
					children.unshift({Type: "ExplorerSelection", selectable: true}); //$NON-NLS-0$
				}
			}
			if (item.NextLocation) {
				fullList.push({Type: "MoreFiles", NextLocation: item.NextLocation, selectable: false, isNotSelectable: true}); //$NON-NLS-0$
			}
			return fullList;
		},
		processChildren: function(parentItem, children) {
			parentItem.children = children;
			children.forEach(function(child) {
				child.parent = parentItem;
			});
			return children;
		},
		getChildren: function(parentItem, onComplete){
			var that = this;
			var progressService = this.progressService;
			var gitClient = this.gitClient;
			var repository = that.repository;
			var progress, location;
			if (parentItem.children && !parentItem.more) {
				onComplete(parentItem.children);
			} else if (parentItem.Children) {
				onComplete(that.processChildren(parentItem, that.processMoreChildren(parentItem, parentItem.Children.slice(0), parentItem)));
			} else if (parentItem.Type === "Diff" && !parentItem.parent) { //$NON-NLS-0$
				progress = this.section.createProgressMonitor();
				progress.begin(messages["Getting changes"]);
				location = parentItem.more ? parentItem.location : (this.location ? this.location + pageQuery : "");
				if (!location) {
					progress.done();
					onComplete([]);
					return;
				}
				function doDiff(loc) {
					gitClient.doGitDiff(loc + "&parts=diffs").then(function(resp) { //$NON-NLS-0$
						progress.done();
						parentItem.Length = resp.Length;
						onComplete(that.processChildren(parentItem, that.processMoreChildren(parentItem, resp.Children, resp)));
					}, function(error) {
						progress.done();
						that.handleError(error);
					});
				}
				if (this.commitName && !parentItem.more) {
					gitClient.getDiff(location, this.commitName).then(function(resp) {
						doDiff(resp.Location + pageQuery);
					}, function(error) {
						progress.done();
						that.handleError(error);
					});
				} else {
					doDiff(location);
				}
			} else if (parentItem.Type === "Root") { //$NON-NLS-0$
				progress = this.section.createProgressMonitor();
				progress.begin(messages["Getting changes"]);
				location = repository.StatusLocation;
				Deferred.when(repository.status || (repository.status = progressService.progress(gitClient.getGitStatus(location), messages["Getting changes"])), function(resp) {//$NON-NLS-0$
					var status = that.status = that.items = resp;
					Deferred.when(that.repository || progressService.progress(gitClient.getGitClone(status.CloneLocation), messages["Getting git repository details"]), function(resp) {
						var repository = resp.Children ? resp.Children[0] : resp;
						repository.status = status;
						progressService.progress(gitClient.getGitCloneConfig(repository.ConfigLocation), "Getting repository configuration ", repository.Name).then(function(resp) { //$NON-NLS-0$
							var config = resp.Children;
												
							status.Clone = repository;
							status.Clone.Config = [];

							for (var i = 0; i < config.length; i++) {
								if (config[i].Key === "user.name" || config[i].Key === "user.email") //$NON-NLS-1$ //$NON-NLS-0$
									status.Clone.Config.push(config[i]);
							}
							var children = that._sortBlock(that.getGroups(that.prefix));
							parentItem.Length = children.length;
							if (that.prefix === "all") { //$NON-NLS-0$
								if (children.length > 0) {
									children.unshift({Type: "ExplorerSelection", selectable: true}); //$NON-NLS-0$
								}
								children.unshift({Type: "CommitMsg", selectable: false}); //$NON-NLS-0$
							}
							progress.done();
							onComplete(that.processChildren(parentItem, children));
						}, function(error) {
							progress.done();
							that.handleError(error);
						});
					}, function(error) {
						progress.done();
						that.handleError(error);
					});
				}, function(error) {
					progress.done();
					that.handleError(error);
				});
			} else if (mGitUIUtil.isChange(parentItem) || parentItem.Type === "Diff") { //$NON-NLS-0$
				// lazy creation, this is required for selection  model to be able to traverse into children
				if (!parentItem.children) {
					parentItem.children = [];
					parentItem.children.push({ DiffLocation : parentItem.DiffLocation, Type : "Compare", parent : parentItem, selectable: this.prefix !== "all"}); //$NON-NLS-1$ //$NON-NLS-0$
				}
				onComplete(parentItem.children);
			} else {
				onComplete([]);
			}
		},
		getId: function(/* item */ item){
			var prefix = this.prefix;
			if (item.Type === "Root") { //$NON-NLS-0$
				return prefix + "Root"; //$NON-NLS-0$
			} else if (mGitUIUtil.isChange(item)) {
				return  prefix + item.type + item.name; 
			} else if (item.Type === "ExplorerSelection" || item.Type === "CommitMsg") { //$NON-NLS-1$ //$NON-NLS-0$
				return prefix + item.Type;
			} else {
				return  prefix + item.type + item.DiffLocation;
			}
		},
		getModelType: function(groupItem, groupName) {
			return groupName;
		},
		_markConflict: function(conflictPattern) {
			// if git status server API response a file with "Modified"
			// ,"Added", "Changed","Missing" states , we treat it as a
			// conflicting file
			// And we add additional attribute to that groupItem :
			// groupItem.Conflicting = true;
			var baseGroup = this.getGroupData(conflictPattern[1]);
			if (!baseGroup)
				return;
			for (var i = 0; i < baseGroup.length; i++) {
				if (baseGroup[i].Conflicting)
					continue;
				var fileLocation = baseGroup[i].Location;
				var itemsInDetectGroup = [];

				for (var j = 2; j < conflictPattern.length; j++) {
					var groupName = conflictPattern[j];
					var groupData = this.getGroupData(groupName);
					if (!groupData)
						continue;
					var item = this._findSameFile(fileLocation, groupData);
					if (item) {
						itemsInDetectGroup.push(item);
					} else {
						continue;
					}
				}

				// we have the same file at "Modified" ,"Added",
				// "Changed","Missing" groups
				if (itemsInDetectGroup.length === Math.max(0, conflictPattern.length - 2)) {
					baseGroup[i].Conflicting = conflictPattern[0];
					for (var k = 0; k < itemsInDetectGroup.length; k++) {
						itemsInDetectGroup[k].Conflicting = "Hide"; //$NON-NLS-0$
					}
				}
			}
		},
		_findSameFile: function(fileLocation, groupData) {
			for (var j = 0; j < groupData.length; j++) {
				if (groupData[j].Conflicting)
					continue;
				if (fileLocation === groupData[j].Location)
					return groupData[j];
			}
			return undefined;
		},
		_sortBlock: function(interestedGroup) {
			var retValue = [];
			for (var i = 0; i < interestedGroup.length; i++) {
				var groupName = interestedGroup[i];
				var groupData = this.getGroupData(groupName);
				if (!groupData)
					continue;
				for (var j = 0; j < groupData.length; j++) {
					var renderType = this.getModelType(groupData[j], groupName);
					if (renderType) {
						retValue.push({
							name : groupData[j].Name,
							type : renderType,
							location : groupData[j].Location,
							path : groupData[j].Path,
							commitURI : groupData[j].Git.CommitLocation,
							indexURI : groupData[j].Git.IndexLocation,
							DiffLocation : groupData[j].Git.DiffLocation,
							CloneLocation : this.items.CloneLocation, //will die here
							conflicting : isConflict(renderType)
						});
					}
				}
			}
			retValue.sort(function(a, b) {
				var n1 = a.name && a.name.toLowerCase();
				var n2 = b.name && b.name.toLowerCase();
				if (n1 < n2) {
					return -1;
				}
				if (n1 > n2) {
					return 1;
				}
				return 0;
			});
			return retValue;
		},
		getGroupData: function(groupName) {
			return this.items[groupName];
		},
		isStaged: function(type) {
			for (var i = 0; i < interestedStagedGroup.length; i++) {
				if (type === interestedStagedGroup[i]) {
					return true;
				}
			}
			return false;
		},
		getClass: function(item) {
			return statusTypeMap[item.type].imageClass;
		},
		getTooltip: function(item) {
			return statusTypeMap[item.type].tooltip;
		}
	});
	
	/**
	 * @class orion.git.GitChangeListExplorer
	 * @extends orion.explorers.Explorer
	 */
	function GitChangeListExplorer(options) {
		this.checkbox = options.prefix === "all"; //$NON-NLS-0$
		var renderer = new GitChangeListRenderer({
			noRowHighlighting: true,
			registry: options.serviceRegistry,
			commandService: options.commandRegistry,
			actionScopeId: options.actionScopeId,
			cachePrefix: options.prefix + "Navigator", //$NON-NLS-0$
			checkbox: this.checkbox}, this);
		mExplorer.Explorer.call(this, options.serviceRegistry, options.selection, renderer, options.commandRegistry);	
		this.parentId = options.parentId;
		this.actionScopeId = options.actionScopeId;
		this.prefix = options.prefix;
		this.changes = options.changes;
		this.commit = options.commit;
		this.section = options.section;
		this.location = options.location;
		this.commitName = options.commitName;
		this.repository = options.repository;
		this.editableInComparePage = options.editableInComparePage;
		this.handleError = options.handleError;
		this.gitClient = options.gitClient;
		this.progressService = options.progressService;
		this.preferencesService = options.preferencesService;
		this.standAloneOptions = options.standAloneOptions;
		this.explorerSelectionScope = "explorerSelection";  //$NON-NLS-0$
		this.explorerSelectionStatus = "explorerSelectionStatus";  //$NON-NLS-0$
		this.createSelection();
		this.createCommands();
		if (this.prefix !== "all") { //$NON-NLS-0$
			this.updateCommands();
		}
		mGitCommands.getModelEventDispatcher().addEventListener("modelChanged", this._modelListener = function(event) { //$NON-NLS-0$
			switch (event.action) {
			case "commit": //$NON-NLS-0$
			case "stash": //$NON-NLS-0$
				if (this.messageTextArea) {
					this.messageTextArea.value = ""; //$FALLTHROUGH$
				}
			case "reset": //$NON-NLS-0$
			case "applyPatch":  //$NON-NLS-0$
			case "stage": //$NON-NLS-0$
			case "unstage": //$NON-NLS-0$
			case "checkoutFile": //$NON-NLS-0$
			case "applyStash": //$NON-NLS-0$
			case "popStash": //$NON-NLS-0$
			case "ignoreFile": //$NON-NLS-0$
				this.changedItem(event.items);
				break;
			case "mergeSquash": //$NON-NLS-0$
				this.changedItem();
				break;
			}
		}.bind(this));
		mGitCommands.getModelEventDispatcher().addEventListener("stateChanging", this._modelChangingListener = function(event) { //$NON-NLS-0$
			switch (event.action) {
			case "commit": //$NON-NLS-0$
			case "stash": //$NON-NLS-0$
			case "reset": //$NON-NLS-0$
			case "applyPatch":  //$NON-NLS-0$
			//case "stage": //$NON-NLS-0$
			//case "unstage": //$NON-NLS-0$
			case "checkoutFile": //$NON-NLS-0$
			case "applyStash": //$NON-NLS-0$
			case "popStash": //$NON-NLS-0$
			case "ignoreFile": //$NON-NLS-0$
			case "selectionChanged": //$NON-NLS-0$
				event.preCallback = this.unhookCompareWidget.bind(this);
				break;
			}
		}.bind(this));
	}
	GitChangeListExplorer.prototype = Object.create(mExplorer.Explorer.prototype);
	objects.mixin(GitChangeListExplorer.prototype, /** @lends orion.git.GitChangeListExplorer.prototype */ {
		changedItem: function(items) {
			this.model.repository.status = "";
			var deferred = new Deferred();
			var that = this;
			if (this.prefix === "all") { //$NON-NLS-0$
				var parent = this.model.root;
				var commitInfo = this.getCommitInfo();
				var moreVisible = this.getMoreVisible();
				parent.children = parent.Children = null;
				this.model.getChildren(parent, function(children) {
					parent.removeAll = true;
					that.myTree.refresh.bind(that.myTree)(parent, children, false);
					var selection = children.filter(function(item) {
						return that.model.isStaged(item.type);
					});
					that.selection.setSelections(selection);
					that.setMoreVisible(moreVisible);
					that.setCommitInfo(commitInfo);
					deferred.resolve(children);
				});
			} else if (this.prefix === "diff") { //$NON-NLS-0$
				var model = this.model;
				var item = items;
				if (!item) {
					model.getRoot(function(root) {
						item = root;
					});
				}
				if (!item.more) {
					item.children = null;
				}	
				item.Children = null;
				model.getChildren(item, function(children) {
					item.more = false;
					item.removeAll = true;
					that.myTree.refresh.bind(that.myTree)(item, children, false);
					deferred.resolve(children);
				});
			} else {
				deferred.resolve();
			}
			return deferred;
		},
		destroy: function() {
			if (this._modelListener) {
				mGitCommands.getModelEventDispatcher().removeEventListener("modelChanged", this._modelListener); //$NON-NLS-0$
				this._modelListener = null;
			}
			if (this._modelChangingListener) {
				mGitCommands.getModelEventDispatcher().removeEventListener("modelChanged", this._modelChangingListener); //$NON-NLS-0$
				this._modelChangingListener = null;
			}
			if (this._selectionListener) {
				this.selection.removeEventListener("selectionChanged", this._selectionListener); //$NON-NLS-0$
				this._selectionListener = null;
			}
			mExplorer.Explorer.prototype.destroy.call(this);
		},
		//This function is called when any of the compare widgets in the explorer are hooked up and need to be unhooked
		unhookCompareWidget: function() {
			if(!this.model.root) {
				return new Deferred().resolve(true);
			}
			var modelList = this.model.root.children || this.model.root.Children;
			if(!modelList) {
				return new Deferred().resolve(true);
			}
			var isDirty = modelList.some( function(child) {
				if(child.children && child.children.length === 1 && child.children[0].resourceComparer && child.children[0].resourceComparer.isDirty()) {
					return true;
				}
			});
			if(isDirty) {
				var doSave = window.confirm(messages.confirmUnsavedChanges);
				if(!doSave) {
					return new Deferred().resolve();
				}
				var promises = [];
				modelList.forEach( function(child) {
					if(child.children && child.children.length === 1 && child.children[0].resourceComparer && child.children[0].resourceComparer.isDirty() && child.children[0].resourceComparer.save) {
						promises.push(child.children[0].resourceComparer.save(doSave));
					}
				});				
				return Deferred.all(promises);
			} else {
				return new Deferred().resolve(true);
			}
		},
		//This function is called when the collapseAll command is excuted.
		preCollapseAll: function() {
			return this.unhookCompareWidget();
		},
		display: function() {
			var that = this;
			var deferred = new Deferred();
			var model =  new GitChangeListModel({
				registry: this.registry,
				progress: this.progressService,
				prefix: this.prefix,
				location: this.location,
				commitName: this.commitName,
				repository: this.repository,
				handleError: this.handleError,
				changes: this.changes,
				gitClient: this.gitClient,
				progressService: this.progressService,
				section: this.section
			});
			this.createTree(this.parentId, model, {
				setFocus: false, // do not steal focus on load
				preCollapse: function(rowItem) {
					if(rowItem && rowItem.children && rowItem.children.length === 1 && rowItem.children[0].resourceComparer) {
						if(!rowItem.children[0].resourceComparer.isDirty()) {
							return new Deferred().resolve(true);
						}
						var doSave = window.confirm(messages.confirmUnsavedChanges);
						return rowItem.children[0].resourceComparer.save(doSave);
					}
					return new Deferred().resolve(true);
				},
				onComplete: function(tree) {
					var model = that.model;
					var selectFunc = function() {
						if (that.prefix === "all") { //$NON-NLS-0$
							that.updateCommands();
							that.selection.setSelections(model._sortBlock(model.getGroups("staged"))); //$NON-NLS-0$
						}
						if (that.prefix === "diff") { //$NON-NLS-0$
							that.updateCommands();
						}
						that.status = model.status;
						if (that.getItemCount() === 1) {
							that.expandSections(tree, model.root.children).then(function() {
								deferred.resolve();
							});
							return;
						}
						deferred.resolve();
					};
					if (that.prefix === "all") { //$NON-NLS-0$
						var gitConfigPref = new gitConfigPreference(that.registry);
						gitConfigPref.getConfig().then(function(userInfo){
							if (userInfo && userInfo.GitSelectAll) {
								model.getRoot(function(root) {
									var selection = root.children.filter(function(item) {
										return !that.model.isStaged(item.type) && mGitUtil.isChange(item);
									});
									that.commandService.runCommand("eclipse.orion.git.stageCommand", selection, that, null, that.repository.status); //$NON-NLS-0$
									selectFunc();
								});
							} else {
								selectFunc();
							}
						});
					} else {
						selectFunc();
					}
				} 
			});
			return deferred;
		},
		expandSections: function(tree, children) {
			var deferreds = [];
			for (var i = 0; i < children.length; i++) {
				var deferred = new Deferred();
				deferreds.push(deferred);
				tree.expand(this.model.getId(children[i]), function (d) {
					d.resolve();
				}, [deferred]);
			}
			return Deferred.all(deferreds);
		},
		isRowSelectable: function(modelItem) {
			return this.prefix === "all" ? false : mGitUIUtil.isChange(modelItem); //$NON-NLS-0$
		},
		isRebasing: function() {
			var repository = this.model.repository;
			return repository && repository.status && repository.status.RepositoryState === "REBASING_INTERACTIVE"; //$NON-NLS-0$
		},
		getItemCount: function() {
			var result = 0;
			var model = this.model;
			if (model) {
				result = model.root.Length;
			}
			return result;
		},
		updateCommands: function() {
			mExplorer.createExplorerCommands(this.commandService);
			var actionsNodeScope = this.section.selectionNode.id;
			var selectionNodeScope = this.section.actionsNode.id;
			
			var commandRegistry = this.commandService;
			var explorerSelectionScope = this.prefix === "all" || this.prefix === "diff" ? this.explorerSelectionScope : actionsNodeScope; //$NON-NLS-1$ //$NON-NLS-0$
			commandRegistry.registerCommandContribution(explorerSelectionScope, "orion.explorer.expandAll", 200); //$NON-NLS-0$
			commandRegistry.registerCommandContribution(explorerSelectionScope, "orion.explorer.collapseAll", 300); //$NON-NLS-0$
			
			var node;
			node = lib.node(actionsNodeScope);
			if (node) {
				this.commandService.destroy(node);
			}
			node = lib.node(selectionNodeScope);
			if (node) {
				this.commandService.destroy(node);
			}

			commandRegistry.registerCommandContribution("itemLevelCommands", "eclipse.openGitDiff", 2000); //$NON-NLS-1$ //$NON-NLS-0$
			commandRegistry.registerCommandContribution("itemLevelCommands", "eclipse.orion.git.diff.showCurrent", 1000); //$NON-NLS-1$ //$NON-NLS-0$

			if (this.prefix === "staged") { //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.commitAndPushCommand", 200, "eclipse.gitCommitGroup"); //$NON-NLS-1$ //$NON-NLS-0$ 
				commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.unstageCommand", 100); //$NON-NLS-0$
				commandRegistry.registerCommandContribution("DefaultActionWrapper", "eclipse.orion.git.unstageCommand", 100); //$NON-NLS-1$ //$NON-NLS-0$
			} else if (this.prefix === "unstaged") { //$NON-NLS-0$
				commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.showPatchCommand", 100); //$NON-NLS-0$
				commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.stageCommand", 200); //$NON-NLS-0$
				commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.checkoutCommand", 300); //$NON-NLS-0$
				commandRegistry.registerCommandContribution("DefaultActionWrapper", "eclipse.orion.git.stageCommand", 100); //$NON-NLS-1$ //$NON-NLS-0$
			}  else if (this.prefix === "all") { //$NON-NLS-0$
				if (!this.isRebasing()) {
					commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.applyPatch", 300); //$NON-NLS-1$ //$NON-NLS-0$
					commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.popStash", 100); //$NON-NLS-1$ //$NON-NLS-0$
					commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.precreateStashCommand", 200); //$NON-NLS-0$
	
					commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.showStagedPatchCommand", 100); //$NON-NLS-0$
					commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.checkoutStagedCommand", 200); //$NON-NLS-0$
					
	//				commandRegistry.addCommandGroup(selectionNodeScope, "eclipse.gitCommitGroup", 1000, "Commit", null, null, null, "Commit", null, "eclipse.orion.git.precommitCommand", "primaryButton"); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$ 	549
	//				commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.precommitAndPushCommand", 200, "eclipse.gitCommitGroup"); //$NON-NLS-0$
					commandRegistry.registerCommandContribution(selectionNodeScope, "eclipse.orion.git.precommitCommand", 400); //$NON-NLS-0$
	
					commandRegistry.renderCommands(selectionNodeScope, selectionNodeScope, [], this, "tool", {Clone : this.model.repository}); //$NON-NLS-1$ //$NON-NLS-0$
					commandRegistry.renderCommands(actionsNodeScope, actionsNodeScope, this.model ? this.model.repository : this, this, "tool"); //$NON-NLS-0$	
				}
			} else if (this.prefix === "diff" && this.commit) { //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.checkoutCommit", 1); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.undoCommit", 2); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.resetIndex", 3); //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.addTag", 4); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.cherryPick", 5); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.revert", 6); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.openGitCommit", 7); //$NON-NLS-1$ //$NON-NLS-0$
				commandRegistry.registerCommandContribution(actionsNodeScope, "eclipse.orion.git.showCommitPatchCommand", 8); //$NON-NLS-1$ //$NON-NLS-0$

				commandRegistry.renderCommands(actionsNodeScope, actionsNodeScope, this.commit, this, "tool"); //$NON-NLS-0$
			}
			node = lib.node(explorerSelectionScope);
			if (node) {
				this.commandService.destroy(node);
				this.commandService.renderCommands(explorerSelectionScope, explorerSelectionScope, this, this, "button"); //$NON-NLS-0$	
			}
		},
		updateSelectionStatus: function(selections) {
			if (!this.explorerSelectionStatus) return;
			if (!selections) selections = this.selection.getSelections();
			var count = selections ? selections.length : 0;
			var msg = i18nUtil.formatMessage(messages[count === 1 ? "FileSelected" : "FilesSelected"], count);
			if (!count && this.messageTextArea.value && !this.amendCheck.checked) {
				this.explorerSelectionStatus.classList.add("invalidFileCount"); //$NON-NLS-0$
			} else {
				this.explorerSelectionStatus.classList.remove("invalidFileCount"); //$NON-NLS-0$
			}
			this.explorerSelectionStatus.textContent = msg;
		},
		createCommands: function(){
			if (this.prefix !== "all") { //$NON-NLS-0$
				return;
			}
			var that = this;
			var selectAllCommand = new mCommands.Command({
				tooltip : messages["Select all"],
				imageClass : "core-sprite-check", //$NON-NLS-0$
				id: "orion.explorer.selectAllCommandChangeList", //$NON-NLS-0$
				visibleWhen : function() {
					var result = false;
					that.model.getRoot(function(root) {
						if (root.children) {
							var selection = root.children.filter(function(item) {
								return !that.model.isStaged(item.type) && mGitUtil.isChange(item);
							});
							result = selection.length > 0;
						}
					});
					return result;
				},
				callback : function() {
					var deferred = new Deferred();
					that.model.getRoot(function(root) {
						var selection = root.children.filter(function(item) {
							return !that.model.isStaged(item.type) && mGitUtil.isChange(item);
						});
						that.commandService.runCommand("eclipse.orion.git.stageCommand", selection, that, null, that.status).then(deferred.resolve, deferred.reject); //$NON-NLS-0$
					});
					return deferred;
				}
			});
			
			var deselectAllCommand = new mCommands.Command({
				tooltip : messages["Deselect all"],
				imageClass : "core-sprite-check_on", //$NON-NLS-0$
				id: "orion.explorer.deselectAllCommandChangeList", //$NON-NLS-0$
				visibleWhen : function() {
					var result = false;
					that.model.getRoot(function(root) {
						if (root.children && root.children.length > 1) {
							var selection = root.children.filter(function(item) {
								return that.model.isStaged(item.type);
							});
							result = selection.length === Math.max(0, root.children.length - 2);
						}
					});
					return result;
				},
				callback : function() {
					var deferred = new Deferred();
					that.model.getRoot(function(root) {
						var selection = root.children.filter(function(item) {
							return that.model.isStaged(item.type);
						});
						that.commandService.runCommand("eclipse.orion.git.unstageCommand", selection, that, null, that.status).then(deferred.resolve, deferred.reject); //$NON-NLS-0$
					});
					return deferred;
				}
			});
			
			var toggleMaximizeCommand = new mCommands.Command({
				name: messages['MaximizeCmd'],
				tooltip: messages["MaximizeTip"],
				id: "eclipse.orion.git.toggleMaximizeCommand", //$NON-NLS-0$
				imageClass: "git-sprite-open", //$NON-NLS-0$
				spriteClass: "gitCommandSprite", //$NON-NLS-0$
				type: "toggle", //$NON-NLS-0$
				callback: function(data) {
					var diffContainer = lib.node(data.handler.options.parentDivId);
					diffContainer.style.height = ""; //$NON-NLS-0$
					var maximized = false;
					var div = diffContainer.parentNode;
					if (div.classList.contains("gitChangeListCompareMaximized")) { //$NON-NLS-0$
						div.classList.remove("gitChangeListCompareMaximized"); //$NON-NLS-0$
						diffContainer.classList.remove("gitChangeListCompareContainerMaximized"); //$NON-NLS-0$
					} else {
						div.classList.add("gitChangeListCompareMaximized"); //$NON-NLS-0$
						diffContainer.classList.add("gitChangeListCompareContainerMaximized"); //$NON-NLS-0$
						maximized = true;
					}
					data.handler.options.maximized = maximized;
					if(data.handler.options.titleIds && data.handler.options.titleIds.length === 2) {
						var dirtyIndicator = lib.node(data.handler.options.titleIds[1]); //$NON-NLS-0$
						if ( dirtyIndicator) {
							dirtyIndicator.textContent = data.handler.isDirty() && maximized ? "*" : "";
						}
					}
					(data.handler._editors || [data.handler._editor]).forEach(function(editor) {
						editor.resize();
					});
				},
				visibleWhen: function() {
					return true;
				}
			});
			
			var okCancelOptions = {getSubmitName: function(){return messages.OK;}, getCancelName: function(){return messages.Cancel;}};
			var listener = new mCommandRegistry.CommandEventListener("click", function(event, commandInvocation){ //$NON-NLS-0$
				var gitConfigPref = new gitConfigPreference(that.registry);
				lib.$$array(".core-sprite-check", lib.node(that.parentId)).forEach(function (check) { //$NON-NLS-0$
					check.classList.add("core-sprite-progress"); //$NON-NLS-0$
				});
				gitConfigPref.getConfig().then(function(userInfo){
					gitConfigPref.setConfig({
						GitMail: userInfo.GitMail,	
						GitName: userInfo.GitName,
						GitSelectAll: event.target.checked}).then(function(){
							if (event.target.checked) {
								commandInvocation.commandRegistry.runCommand("orion.explorer.selectAllCommandChangeList", that, that); //$NON-NLS-0$
							} else {
								commandInvocation.commandRegistry.runCommand("orion.explorer.deselectAllCommandChangeList", that, that); //$NON-NLS-0$
							}
					});
				});
				
				
			});
			var precommitParameters = new mCommandRegistry.ParametersDescription([new mCommandRegistry.CommandParameter("alwaysSelect", "boolean", messages.AlwaysSelectFiles, null, null, listener)], objects.mixin({}, okCancelOptions)); //$NON-NLS-1$ //$NON-NLS-0$
			precommitParameters.message = messages.EmptyCommitConfirm;
			
			var precommitCommand = new mCommands.Command({
				name: messages["Commit"],
				tooltip: messages["CommitTooltip"],
				id: "eclipse.orion.git.precommitCommand", //$NON-NLS-0$
				extraClass: "primaryButton", //$NON-NLS-0$
				parameters: precommitParameters,
				preCallback: function(data) {
					data.parameters.clientCollect = that.getCommitInfo(true) && (data.items.length !== 0)  || data.handler.amendCheck.checked;
					return new Deferred().resolve(that.getCommitInfo(true));
				},
				callback: function(data) {
					var info = that.getCommitInfo(true);
					if (!info) return;
					that.commandService.runCommand("eclipse.orion.git.commitCommand", data.items, data.handler, null, info); //$NON-NLS-0$
				},
				visibleWhen: function() {
					return true;
				}
			});
			
			var precreateStashCommand = new mCommands.Command({
				name: messages["Stash"],
				imageClass: "git-sprite-stash-changes", //$NON-NLS-0$
				spriteClass: "gitCommandSprite", //$NON-NLS-0$
				tooltip: messages["Stash all current changes away"],
				id: "eclipse.orion.git.precreateStashCommand", //$NON-NLS-0$
				callback: function(data) {
					var name = that.messageTextArea.value.trim();
					that.commandService.runCommand("eclipse.orion.git.createStash", data.items, data.handler, null, {name: name}); //$NON-NLS-0$
				},
				visibleWhen: function() {
					return true;
				}
			});
			
			var precommitAndPushCommand = new mCommands.Command({
				name: messages["CommitPush"],
				tooltip: messages["Commits and pushes files to the default remote"],
				id: "eclipse.orion.git.precommitAndPushCommand", //$NON-NLS-0$
				callback: function(data) {
					var info = that.getCommitInfo(true);
					if (!info) return;
					that.commandService.runCommand("eclipse.orion.git.commitAndPushCommand", data.items, data.handler, null, info); //$NON-NLS-0$
				},
				visibleWhen: function() {
					return true;
				}
			});

			this.commandService.addCommand(precommitCommand);
			this.commandService.addCommand(selectAllCommand);
			this.commandService.addCommand(deselectAllCommand);
			this.commandService.addCommand(toggleMaximizeCommand);
			this.commandService.addCommand(precommitAndPushCommand);
			this.commandService.addCommand(precreateStashCommand);
		},
		createSelection: function(){
			if (!this.selection) {
				var section = this.section;
				var selectionTools = section.actionsNode;
				this.selection = new mSelection.Selection(this.registry, "orion.selection." + this.prefix + "Section"); //$NON-NLS-1$ //$NON-NLS-0$
				this.commandService.registerSelectionService(selectionTools.id, this.selection);
				var commandService = this.commandService;
				var that = this;
				this.selection.addEventListener("selectionChanged", this._selectionListener =  function(event) { //$NON-NLS-1$ //$NON-NLS-0$
					if (selectionTools) {
						commandService.destroy(selectionTools);
						commandService.renderCommands(selectionTools.id, selectionTools, event.selections, that, "tool", {"Clone" : that.model.repository}); //$NON-NLS-1$ //$NON-NLS-0$
					}
					if (that.prefix === "all") { //$NON-NLS-0$
						var titleTools = section.titleActionsNode;
						if (titleTools) {
							commandService.destroy(titleTools);
						}
						commandService.renderCommands(titleTools.id, titleTools, that, that, "button"); //$NON-NLS-0$
					}
					if (that.explorerSelectionStatus) {
						that.updateSelectionStatus(event.selections);
					}
				});
				
			}
		},
		refreshSelection: function() {
			//Do nothing
		}
	});
	
	function GitChangeListRenderer(options) {
		options.cachePrefix = null; // do not persist table state
		mExplorer.SelectionRenderer.apply(this, arguments);
	}
	GitChangeListRenderer.prototype = Object.create(mExplorer.SelectionRenderer.prototype);
	objects.mixin(GitChangeListRenderer.prototype, {
		getCellElement: function(col_no, item, tableRow){
			var div, td, navGridHolder, itemLabel, diffActionWrapper;
			var explorer = this.explorer;
			switch (col_no) {
				case 0:
					td = document.createElement("td"); //$NON-NLS-0$
					div = document.createElement("div"); //$NON-NLS-0$
					div.className = "sectionTableItem"; //$NON-NLS-0$
					td.appendChild(div);
					
					if (item.Type === "MoreFiles") { //$NON-NLS-1$ //$NON-NLS-0$
						td.classList.add("gitListMore"); //$NON-NLS-0$
						var moreText = messages[item.Type];
						var moreButton = document.createElement("button"); //$NON-NLS-0$
						moreButton.className = "commandButton"; //$NON-NLS-0$
						moreButton.textContent = i18nUtil.formatMessage(messages[item.Type], moreText);
						td.appendChild(moreButton);
						var listener;
						moreButton.addEventListener("click", listener = function() { //$NON-NLS-0$
							moreButton.removeEventListener("click", listener); //$NON-NLS-0$
							moreButton.textContent = messages[item.Type + "Progress"];
							item.parent.location = item.NextLocation;
							item.parent.more = true;
							var offsetParent = lib.getOffsetParent(td);
							var scrollTop = offsetParent ? offsetParent.scrollTop : 0;
							explorer.changedItem(item.parent).then(function() {
								if (offsetParent) offsetParent.scrollTop = scrollTop;
								item.parent.more = false;
							});
						});
						return td;
					}
				
					if (item.Type === "CommitMsg") { //$NON-NLS-0$
						tableRow.classList.add("gitCommitMessageSection"); //$NON-NLS-0$
						var outerDiv = document.createElement("div"); //$NON-NLS-0$
						outerDiv.id = "gitCommitMessage"; //$NON-NLS-0$
						outerDiv.className = "gitCommitMessage toolComposite"; //$NON-NLS-0$
						td.colSpan = 2;
						tableRow.classList.remove("selectableNavRow"); //$NON-NLS-0$
						
						var topRow = document.createElement("div"); //$NON-NLS-0$
						topRow.className = "gitCommitMessageTopRow"; //$NON-NLS-0$
						
						var textArea = explorer.messageTextArea = document.createElement("textarea"); //$NON-NLS-0$
						textArea.rows = 2;
						textArea.type = "textarea"; //$NON-NLS-0$
						textArea.id = "nameparameterCollector"; //$NON-NLS-0$
						textArea.placeholder = messages["SmartCommit"];
						textArea.classList.add("parameterInput"); //$NON-NLS-0$
						textArea.addEventListener("keyup", function() { //$NON-NLS-0$
							textArea.parentNode.classList.remove("invalidParam"); //$NON-NLS-0$
							explorer.updateSelectionStatus();
						});
						topRow.appendChild(textArea);

						var bottomRow = document.createElement("div"); //$NON-NLS-0$
						bottomRow.className = "gitCommitMessageBottomRow"; //$NON-NLS-0$

						var bottomRight = document.createElement("span"); //$NON-NLS-0$
						bottomRight.className = "layoutRight"; //$NON-NLS-0$
						bottomRow.appendChild(bottomRight);

						var bottomLeft = document.createElement("span"); //$NON-NLS-0$
						bottomLeft.className = "layoutLeft"; //$NON-NLS-0$
						bottomRow.appendChild(bottomLeft);
						
						function createInput(parent, id, key, placeholderKey, value, isCheck) {
							var div = document.createElement("span"); //$NON-NLS-0$
							var label = document.createElement("label"); //$NON-NLS-0$
							label.classList.add(isCheck ? "gitChangeListCheckLabel" : "gitChangeListInputLabel"); //$NON-NLS-1$ //$NON-NLS-0$
							label.setAttribute("for", id); //$NON-NLS-0$
							label.textContent = messages[key];
							var input = document.createElement("input"); //$NON-NLS-0$
							if (isCheck) input.type = "checkbox"; //$NON-NLS-0$
							if (value) input.value = value;
							input.classList.add(isCheck ? "gitChangeListCheck" : "gitChangeListInput"); //$NON-NLS-1$ //$NON-NLS-0$
							if (placeholderKey) input.placeholder = messages[placeholderKey];
							input.id = id;
							input.addEventListener("input", function() { //$NON-NLS-0$
								if (input.value) input.classList.remove("invalidParam"); //$NON-NLS-0$
							});
							div.appendChild(!isCheck ? label : input);
							div.appendChild(isCheck ? label : input);
							parent.appendChild(div);
							return input;
						}
						
						function createGroup(parent, key) {
							var div = document.createElement("div"); //$NON-NLS-0$
							div.classList.add("gitChangeListGroup"); //$NON-NLS-0$
							var label = document.createElement("div"); //$NON-NLS-0$
							label.textContent = messages[key];
							label.classList.add("gitChangeListInputLabel"); //$NON-NLS-0$
							div.appendChild(label);
							var content = document.createElement("div"); //$NON-NLS-0$
							content.classList.add("gitChangeListGroupContent"); //$NON-NLS-0$
							div.appendChild(content);
							parent.appendChild(div);
							return content;
						}

						var commitLogic = gitCommit({serviceRegistry: explorer.registry, commandService: explorer.commandService});
						var config = commitLogic.getGitCloneConfig(explorer.model.status.Clone.Config);
						
						var amendCheck = explorer.amendCheck = createInput(bottomLeft, "amendCheck", "SmartAmend", null, null, true); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						explorer.changeIDCheck = createInput(bottomLeft, "changeIDCheck", 'SmartChangeId', null, null, true); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						amendCheck.addEventListener("change", function() { //$NON-NLS-0$
							if (amendCheck.checked) {
								var repository = explorer.model.repository;
								commitLogic.getAmendMessage(repository.ActiveBranch || repository.CommitLocation).then(function(msg) {
									textArea.value = msg;
									textArea.parentNode.classList.remove("invalidParam"); //$NON-NLS-0$
								});
							} else {
								textArea.value = "";
							}
							explorer.updateSelectionStatus();
						});
						
						var moreDiv = document.createElement("div"); //$NON-NLS-0$
						bottomLeft.appendChild(moreDiv);
						
						var div1Content = createGroup(moreDiv, "Author:"); //$NON-NLS-0$
						explorer.authorNameInput = createInput(div1Content, "authorNameInput", "Name:", "AuthorNamePlaceholder", config.AuthorName); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						explorer.authorEmailInput = createInput(div1Content, "authorEmailInput", "Email:", "AuthorEmailPlaceholder", config.AuthorEmail); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

						var div2Content = createGroup(moreDiv, "Committer:"); //$NON-NLS-0$
						explorer.committerNameInput = createInput(div2Content, "committerNameInput", "Name:", "CommitterNamePlaceholder", config.CommitterName); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						explorer.committerEmailInput = createInput(div2Content, "committerEmailInput", "Email:", "CommitterEmailPlaceholder", config.CommitterEmail); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						explorer.persistCheck = createInput(div2Content, "persitCheck", "Save", null, null, true); //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

						var more;
						explorer.setMoreVisible = function (visible) {
							if (visible) {
								moreDiv.style.display = "block"; //$NON-NLS-0$
								more.textContent = messages["less"];
							} else {
								moreDiv.style.display = "none"; //$NON-NLS-0$
								more.textContent = messages["more"];
							}
						};
						explorer.getMoreVisible = function() {
							return moreDiv.style.display !== "none"; //$NON-NLS-0$
						};
						explorer.getCommitInfo = function (check) {
							function checkParam (node, invalidNode, show) {
								if (!check) return true;
								if (!node.value.trim()) {
									(invalidNode || node).classList.add("invalidParam"); //$NON-NLS-0$
									if (show) explorer.setMoreVisible(true);
									node.select();
									return false;
								}
								(invalidNode || node).classList.remove("invalidParam"); //$NON-NLS-0$
								return true;
							}
							if (!checkParam(explorer.messageTextArea, explorer.messageTextArea.parentNode)) return null;
							if (!checkParam(explorer.authorNameInput, null, true)) return null;
							if (!checkParam(explorer.authorEmailInput, null, true)) return null;
							if (!checkParam(explorer.committerNameInput, null, true)) return null;
							if (!checkParam(explorer.committerEmailInput, null, true)) return null;
							return {
								Message: explorer.messageTextArea.value.trim(),
								Amend: explorer.amendCheck.checked,
								ChangeId: explorer.changeIDCheck.checked,
								AuthorName: explorer.authorNameInput.value.trim(),
								AuthorEmail: explorer.authorEmailInput.value.trim(),
								CommitterName: explorer.committerNameInput.value.trim(),
								CommitterEmail: explorer.committerEmailInput.value.trim(),
								persist: explorer.persistCheck.checked,
							};
						};
						explorer.setCommitInfo = function (info) {
							explorer.messageTextArea.value = info.Message;
							explorer.amendCheck.checked = info.Amend;
							explorer.changeIDCheck.checked = info.ChangeId;
							explorer.authorNameInput.value = info.AuthorName;
							explorer.authorEmailInput.value = info.AuthorEmail;
							explorer.committerNameInput.value = info.CommitterName;
							explorer.committerEmailInput.value = info.CommitterEmail;
							explorer.persistCheck.checked = info.persist;
						};
						
						more = document.createElement("button"); //$NON-NLS-0$
						more.classList.add("gitCommitMore"); //$NON-NLS-0$
						bottomRight.appendChild(more);
						more.addEventListener("click", function(){ //$NON-NLS-0$
							explorer.setMoreVisible(!explorer.getMoreVisible());
						});
						explorer.setMoreVisible(false);

						outerDiv.appendChild(topRow);
						outerDiv.appendChild(bottomRow);
						div.appendChild(outerDiv);
					}
					else if (mGitUIUtil.isChange(item) || item.Type === "Diff") { //$NON-NLS-0$
	
						this.getExpandImage(tableRow, div);
	
						navGridHolder = explorer.getNavDict() ? explorer.getNavDict().getGridNavHolder(item, true) : null;
						diffActionWrapper = document.createElement("span"); //$NON-NLS-0$
						diffActionWrapper.id = explorer.prefix + item.name + item.type + "DiffActionWrapper"; //$NON-NLS-0$
						diffActionWrapper.className = "sectionExplorerActions"; //$NON-NLS-0$
						div.appendChild(diffActionWrapper);
				
						explorer.commandService.destroy(diffActionWrapper);
						explorer.commandService.renderCommands(
							"DefaultActionWrapper", diffActionWrapper, item, explorer, "tool", null, navGridHolder); //$NON-NLS-1$ //$NON-NLS-0$
				
						var icon = document.createElement("span"); //$NON-NLS-0$
						icon.className = explorer.model.getClass(item);
						icon.commandTooltip = new mTooltip.Tooltip({
							node: icon,
							text: explorer.model.getTooltip(item),
							position: ["above", "below", "right", "left"] //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						});
						div.appendChild(icon);
	
						itemLabel = document.createElement("span"); //$NON-NLS-0$
						itemLabel.textContent = item.name;
						itemLabel.id = explorer.prefix + item.name + item.type + "FileItemId"; //$NON-NLS-0$
						div.appendChild(itemLabel);
					} else if (item.Type === "ExplorerSelection") { //$NON-NLS-0$
						td.colSpan = 2;
						
						if (explorer.prefix === "all") { //$NON-NLS-0$
							itemLabel = document.createElement("span"); //$NON-NLS-0$
							itemLabel.className = "gitChangeListSelectAll"; //$NON-NLS-0$
							itemLabel.textContent =  messages["SelectAll"];
							div.appendChild(itemLabel);
							
							var selectionLabel = explorer.explorerSelectionStatus = document.createElement("div"); //$NON-NLS-0$
							selectionLabel.className = "gitChangeListSelectionStatus"; //$NON-NLS-0$
							explorer.updateSelectionStatus();
							div.appendChild(selectionLabel);
						} else {
							var changedLabel = explorer.explorerChangedStatus = document.createElement("div"); //$NON-NLS-0$
							changedLabel.className = "gitChangeListChangedStatus"; //$NON-NLS-0$
							var changed = explorer.model.root.Length;
							changedLabel.textContent = i18nUtil.formatMessage(messages[changed === 1 ? 'FileChanged' : "FilesChanged"], changed);
							div.appendChild(changedLabel);
						}
						
						var actionsArea = document.createElement("div"); //$NON-NLS-0$
						actionsArea.className = "layoutRight commandList"; //$NON-NLS-0$
						actionsArea.id = explorer.explorerSelectionScope;
						div.appendChild(actionsArea);
						explorer.commandService.renderCommands(actionsArea.id, actionsArea, explorer, explorer, "button"); //$NON-NLS-0$	
					} else {
						tableRow.classList.remove("selectableNavRow"); //$NON-NLS-0$
						
						// render the compare widget
						td.colSpan = 2;
						var actionsWrapper = document.createElement("div"); //$NON-NLS-0$
						actionsWrapper.className = "gitChangeListCompareActions"; //$NON-NLS-0$LS-0$
						div.appendChild(actionsWrapper);

						var prefix = explorer.prefix + item.parent.name + item.parent.type;

						var compareWidgetActionWrapper = document.createElement("ul"); //$NON-NLS-0$
						compareWidgetActionWrapper.className = "layoutRight commandList"; //$NON-NLS-0$
						compareWidgetActionWrapper.id = prefix + "CompareWidgetActionWrapper"; //$NON-NLS-0$
						actionsWrapper.appendChild(compareWidgetActionWrapper);

						var compareWidgetLeftActionWrapper = document.createElement("ul"); //$NON-NLS-0$
						compareWidgetLeftActionWrapper.className = "layoutLeft commandList"; //$NON-NLS-0$
						compareWidgetLeftActionWrapper.id = prefix + "CompareWidgetLeftActionWrapper"; //$NON-NLS-0$
						actionsWrapper.appendChild(compareWidgetLeftActionWrapper);
						var dirtyindicator = document.createElement("span"); //$NON-NLS-0$
						dirtyindicator.className = "layoutLeft"; //$NON-NLS-0$
						dirtyindicator.id = prefix + "DirtyId"; //$NON-NLS-0$
						actionsWrapper.appendChild(dirtyindicator);
						
						diffActionWrapper = document.createElement("ul"); //$NON-NLS-0$
						diffActionWrapper.className = "layoutRight commandList"; //$NON-NLS-0$
						diffActionWrapper.id = prefix + "DiffActionWrapperChange"; //$NON-NLS-0$
						actionsWrapper.appendChild(diffActionWrapper);
						explorer.commandService.registerCommandContribution(prefix + "CompareWidgetLeftActionWrapper", "eclipse.orion.git.toggleMaximizeCommand", 1000); //$NON-NLS-1$ //$NON-NLS-0$

						var diffContainer = document.createElement("div"); //$NON-NLS-0$
						diffContainer.className = "gitChangeListCompare"; //$NON-NLS-0$
						diffContainer.id = "diffArea_" + item.DiffLocation; //$NON-NLS-0$
						div.appendChild(diffContainer);
	
						navGridHolder = this.explorer.getNavDict() ? this.explorer.getNavDict().getGridNavHolder(item, true) : null;
						var hasConflict = item.parent.type === "Conflicting"; //$NON-NLS-0$
						window.setTimeout(function() {
							mGitUIUtil.createCompareWidget(
								explorer.registry,
								explorer.commandService,
								item.DiffLocation,
								hasConflict,
								diffContainer,
								compareWidgetActionWrapper.id,
								explorer.editableInComparePage ? !this.explorer.model.isStaged(item.parent.type) : false,
								{
									navGridHolder : navGridHolder,
									additionalCmdRender : function(gridHolder) {
										explorer.commandService.destroy(diffActionWrapper.id);
										explorer.commandService.renderCommands("itemLevelCommands", diffActionWrapper.id, item.parent, explorer, "tool", false, gridHolder); //$NON-NLS-1$ //$NON-NLS-0$
										explorer.commandService.renderCommands(diffActionWrapper.id, diffActionWrapper.id, item.parent, explorer, "tool", false, gridHolder); //$NON-NLS-0$
									},
									before : true
								},
								undefined,
								compareWidgetLeftActionWrapper.id,
								explorer.preferencesService,
								item.parent.Type === "Diff" ? null : compareWidgetLeftActionWrapper.id, //saveCmdContainerId  //$NON-NLS-0$
								item.parent.Type === "Diff" ? null : "compare.save." + item.DiffLocation, //saveCmdId  //$NON-NLS-1$ //$NON-NLS-0$
								//We pass an array of two title Ids here in order for the resource comparer to render the dirty indicator optionally
								//If the widget is not maximized, the dirty indicator, if any, is rendered at the end of the file name
								//If the widget is maximized, as the file name is not visible, the "*" is rendered right beside the left hand action wrapper
								item.parent.Type === "Diff" ? null : [explorer.prefix + item.parent.name + item.parent.type + "FileItemId", dirtyindicator.id], //$NON-NLS-1$ //$NON-NLS-0$ //The compare widget title where the dirty indicator can be inserted
								//We need to attach the compare widget reference to the model. Also we need the widget to be destroy when the model is destroyed.
								item,
								this.explorer.standAloneOptions
							);
						}.bind(this), 0);
					}
					return td;
			}
		},
		onCheckedFunc: function(rowId, checked, manually, item) {
			var that = this;
			this.explorer.unhookCompareWidget().then(function(result) {
				if(!result) {
					return;
				}
				lib.node(that.getCheckBoxId(rowId)).classList.add("core-sprite-progress"); //$NON-NLS-0$
				if (item.Type === "ExplorerSelection") { //$NON-NLS-0$
					if (checked) {
						this.explorer.commandService.runCommand("orion.explorer.selectAllCommandChangeList", this.explorer, this.explorer); //$NON-NLS-0$
					} else {
						this.explorer.commandService.runCommand("orion.explorer.deselectAllCommandChangeList", this.explorer, this.explorer); //$NON-NLS-0$
					}
				} else {
					//stage or unstage
					if (checked) {
						this.explorer.commandService.runCommand("eclipse.orion.git.stageCommand", [item], this.explorer); //$NON-NLS-0$
					} else {
						this.explorer.commandService.runCommand("eclipse.orion.git.unstageCommand", [item], this.explorer); //$NON-NLS-0$
					}
				}
			}.bind(this));
		}, 
		getCheckedFunc: function(item){
			if (item.Type === "ExplorerSelection") { //$NON-NLS-0$
				return !this.explorer.commandService.findCommand("orion.explorer.selectAllCommandChangeList").visibleWhen(this.explorer); //$NON-NLS-0$
			}
			
			return this.explorer.model.isStaged(item.type);
		}
	});
	
	return {
		GitChangeListExplorer: GitChangeListExplorer,
		GitChangeListRenderer: GitChangeListRenderer,
		GitChangeListModel: GitChangeListModel
	};

});

define('text!orion/banner/CommandSlideout.html',[],function () { return '<div id="slideContainer" class="slideParameters slideContainer">\r\n\t<span id="pageCommandParameters" class="layoutLeft parameters"></span>\r\n\t<span id="pageCommandDismiss" class="layoutRight parametersDismiss"></span>\r\n</div>';});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/

define('orion/commonHTMLFragments',['orion/webui/littlelib', 'text!orion/banner/CommandSlideout.html'], 
        function(lib, CommandSlideoutTemplate){
        
	/**
	 * This module contains dynamic HTML fragments that depend on client information.
	 * @name orion.commonHTMLFragments
	 */

	function slideoutHTMLFragment(idPrefix) { 
		var tempDiv = document.createElement("div"); //$NON-NLS-0$
		tempDiv.innerHTML = CommandSlideoutTemplate;
		
		// replacing generic id's with prefixed id's
		var node = lib.$("#slideContainer", tempDiv); //$NON-NLS-0$
		node.id = idPrefix + node.id;
		node = lib.$("#pageCommandParameters", tempDiv); //$NON-NLS-0$
		node.id = idPrefix + node.id;
		node = lib.$("#pageCommandDismiss", tempDiv); //$NON-NLS-0$
		node.id = idPrefix + node.id;
		return tempDiv.innerHTML;
	}
		
	//return the module exports
	return {
		slideoutHTMLFragment: slideoutHTMLFragment
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('orion/section',['orion/EventTarget', 'orion/webui/littlelib', 'orion/commonHTMLFragments', 'orion/objects', 	'orion/selection'], function(EventTarget, lib, mHTMLFragments, objects, Selection){
	
	/**
	 * Generates a section
	 * 
	 * @name orion.widgets.Section
	 * @class Generates a section
	 * @param {DomNode} parent parent node
	 * @param {DomNode} sibling if specified, the section will be inserted after the sibling
	 * @param {String} options.id id of the section header
	 * @param {String} options.title title (in HTML) of the section
	 * @param {orion.preferences.PreferencesService} [options.preferenceService] used to store the hidden/shown state of the section if specified
	 * @param {String|Array} [options.headerClass] a class or array of classes to use in the section header, in addition to the default header classes
	 * @param {String|Array} [options.iconClass] a class or array of classes to use in the icon decorating section, no icon displayed if not provided
	 * @param {Function} [options.getItemCount] function to return the count of items in the section. If not provided, no count is shown.
	 * @param {String|DomNode} [options.content] HTML or DOM node giving the Section's initial contents. May be set later using {@link #setContent()}
	 * @param {Boolean} [options.slideout] if true section will contain generated slideout
	 * @param {Boolean} [options.canHide] if true section may be hidden
	 * @param {Boolean} [options.hidden] if true section will be hidden at first display
	 * @param {Boolean} [options.useAuxStyle] if true the section will be styled for an auxiliary pane
	 * @param {Boolean} [options.keepHeader] if true the embedded explorer will keep its header
	 * @param {Boolean} [options.noTwisties] if true the twisties will not be displayed
	 * @param {Boolean} [options.dropdown] if true the section is dropdown
	 * @param {Function} [options.onExpandCollapse] a function that will be called when the expanded/collapsed state changes
	 *
	 * @borrows orion.editor.EventTarget#addEventListener as #addEventListener
	 * @borrows orion.editor.EventTarget#removeEventListener as #removeEventListener
	 * @borrows orion.editor.EventTarget#dispatchEvent as #dispatchEvent
	 */
	function Section(parent, options) {
		EventTarget.attach(this);
		
		var that = this;
		
		this._expandImageClass = "core-sprite-openarrow"; //$NON-NLS-0$
		this._collapseImageClass = "core-sprite-closedarrow"; //$NON-NLS-0$
		this._progressImageClass = "core-sprite-progress"; //$NON-NLS-0$
		this._twistieSpriteClass = "modelDecorationSprite"; //$NON-NLS-0$
		
		// ...
		
		if (!options.id) {
			throw new Error("Missing required argument: id"); //$NON-NLS-0$
		}
		this.id = options.id;
				
		if (!options.title) {
			throw new Error("Missing required argument: title"); //$NON-NLS-0$
		}

		// setting up the section
		var wrapperClasses = options.useAuxStyle ? ["sectionWrapper", "sectionWrapperAux", "toolComposite"] : ["sectionWrapper", "toolComposite"]; //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		this.domNode = document.createElement("div"); //$NON-NLS-0$
		if (options.sibling) {
			parent.insertBefore(this.domNode, options.sibling);
		} else {
			parent.appendChild(this.domNode);
		}
		for(var i=0; i<wrapperClasses.length; i++) {
			this.domNode.classList.add(wrapperClasses[i]);
		}
		this.domNode.id = options.id;

		// if canHide, add twistie and stuff...
		this.canHide = options.canHide;
		if(options.canHide){
			this.domNode.style.cursor = "pointer"; //$NON-NLS-0$
			if (!options.noTwistie) {
				this.twistie = document.createElement("span"); //$NON-NLS-0$
				this.twistie.classList.add("modelDecorationSprite"); //$NON-NLS-0$
				this.twistie.classList.add("layoutLeft"); //$NON-NLS-0$
				this.twistie.classList.add("sectionTitleTwistie"); //$NON-NLS-0$
				this.domNode.appendChild(this.twistie);
			}
			this.domNode.tabIndex = 0; //$NON-NLS-0$
			this.domNode.addEventListener("click", function(evt) { //$NON-NLS-0$
				if (evt.target === that.titleNode || evt.target === that.twistie || evt.target === that.domNode || evt.target === that._iconNode || evt.target === that.dropdownArrow) {
					that._changeExpandedState();
				}
			}, false);
			this.domNode.addEventListener("keydown", function(evt) { //$NON-NLS-0$
				if (evt.target === that.domNode || evt.target === that.titleNode || evt.target === that.twistie) {
					if(evt.keyCode === lib.KEY.ENTER) {
						that._changeExpandedState();
					} else if(evt.keyCode === lib.KEY.DOWN && that.dropdown) {
						that.setHidden(false);
					} else if(evt.keyCode === lib.KEY.UP && that.dropdown) {
						that.setHidden(true);
					} else if(evt.keyCode === lib.KEY.ESCAPE) {
						that.setHidden(true);
					}
				}
			}, false);
		}
		var classes;
		if(options.iconClass){
			var icon = this._iconNode = document.createElement("span"); //$NON-NLS-0$
			icon.classList.add("sectionIcon"); //$NON-NLS-0$
			this.domNode.appendChild(icon);
			classes = Array.isArray(options.iconClass) ? options.iconClass : [options.iconClass];
			classes.forEach(function(aClass) {
				icon.classList.add(aClass);
			});
		}
		
		if(options.headerClass){
			classes = Array.isArray(options.headerClass) ? options.headerClass : [options.headerClass];
			classes.forEach(function(aClass) {
				this.domNode.classList.add(aClass);
			}.bind(this));
		}
		
		if(options.keepHeader){
			this._keepHeader = options.keepHeader;
		}

		this.titleActionsNode = document.createElement("div"); //$NON-NLS-0$
		this.titleActionsNode.id = options.id + "TitleActionsArea"; //$NON-NLS-0$
		this.titleActionsNode.classList.add("layoutLeft"); //$NON-NLS-0$
		this.titleActionsNode.classList.add("sectionActions"); //$NON-NLS-0$
		this.domNode.appendChild(this.titleActionsNode);

		this.titleNode = document.createElement("div"); //$NON-NLS-0$
		this.titleNode.id = options.id + "Title"; //$NON-NLS-0$
		this.titleNode.classList.add("sectionAnchor"); //$NON-NLS-0$
		this.titleNode.classList.add("sectionTitle"); //$NON-NLS-0$
		this.titleNode.classList.add("layoutLeft"); //$NON-NLS-0$
		this.domNode.appendChild(this.titleNode);
		this.titleNode.textContent = options.title;

		// Add item count
		if (typeof options.getItemCount === "function") { //$NON-NLS-0$
			var count = document.createElement("div"); //$NON-NLS-0$
			count.classList.add("layoutLeft"); //$NON-NLS-0$
			count.classList.add("sectionItemCount"); //$NON-NLS-0$
			this.domNode.appendChild(count);
			count.textContent = options.getItemCount(this);
		}

		this._progressNode = document.createElement("div"); //$NON-NLS-0$
		this._progressNode.id = options.id + "Progress"; //$NON-NLS-0$
		this._progressNode.classList.add("sectionProgress"); //$NON-NLS-0$
		this._progressNode.classList.add("sectionTitle"); //$NON-NLS-0$
		this._progressNode.classList.add("layoutLeft"); //$NON-NLS-0$
		this._progressNode.style.display = "none"; //$NON-NLS-0$
		this._progressNode.textContent = "..."; //$NON-NLS-0$ 
		this.domNode.appendChild(this._progressNode);
		
		this.titleLeftActionsNode = document.createElement("div"); //$NON-NLS-0$
		this.titleLeftActionsNode.id = options.id + "LeftTitleActionsArea"; //$NON-NLS-0$
		this.titleLeftActionsNode.classList.add("layoutLeft"); //$NON-NLS-0$
		this.titleLeftActionsNode.classList.add("sectionActions"); //$NON-NLS-0$
		this.domNode.appendChild(this.titleLeftActionsNode);
		
		if (options.dropdown && !options.noArrow) {
			this.dropdownArrow = document.createElement("div"); //$NON-NLS-0$
			this.dropdownArrow.classList.add("modelDecorationSprite"); //$NON-NLS-0$
			this.dropdownArrow.classList.add("layoutLeft"); //$NON-NLS-0$
			this.dropdownArrow.classList.add("sectionDropdownArrow"); //$NON-NLS-0$
			this.dropdownArrow.classList.add(this._expandImageClass);
			this.domNode.appendChild(this.dropdownArrow);
		}
		
		// add filter search box
		var searchbox = this.searchBox = document.createElement("div"); //$NON-NLS-0$
		searchbox.id = options.id + "FilterSearchBox"; //$NON-NLS-0$
		this.domNode.appendChild(searchbox);
		
		this._toolActionsNode = document.createElement("div"); //$NON-NLS-0$
		this._toolActionsNode.id = options.id + "ToolActionsArea"; //$NON-NLS-0$
		this._toolActionsNode.classList.add("layoutRight"); //$NON-NLS-0$
		this._toolActionsNode.classList.add("sectionActions"); //$NON-NLS-0$
		this.domNode.appendChild(this._toolActionsNode);
		this.actionsNode = document.createElement("ul"); //$NON-NLS-0$
		this.actionsNode.id = options.id + "ActionArea"; //$NON-NLS-0$
		this.actionsNode.classList.add("layoutRight"); //$NON-NLS-0$
		this.actionsNode.classList.add("commandList"); //$NON-NLS-0$
		this.actionsNode.classList.add("sectionActions"); //$NON-NLS-0$
		this.domNode.appendChild(this.actionsNode);
		this.selectionNode = document.createElement("ul"); //$NON-NLS-0$
		this.selectionNode.id = options.id + "SelectionArea"; //$NON-NLS-0$
		this.selectionNode.classList.add("layoutRight"); //$NON-NLS-0$
		this.selectionNode.classList.add("commandList"); //$NON-NLS-0$
		this.selectionNode.classList.add("sectionActions"); //$NON-NLS-0$
		this.domNode.appendChild(this.selectionNode);
		
		if(options.slideout){
			var slideoutFragment = mHTMLFragments.slideoutHTMLFragment(options.id);
			var range = document.createRange();
			range.selectNode(this.domNode);
			slideoutFragment = range.createContextualFragment(slideoutFragment);
			this.domNode.appendChild(slideoutFragment);
		}

		this._contentParent = document.createElement("div"); //$NON-NLS-0$
		this._contentParent.id = this.id + "Content"; //$NON-NLS-0$
		this._contentParent.role = "region"; //$NON-NLS-0$
		this._contentParent.classList.add("sectionTable"); //$NON-NLS-0$
		this._contentParent.setAttribute("aria-labelledby", this.titleNode.id); //$NON-NLS-0$
		if (options.sibling) {
			parent.insertBefore(this._contentParent, options.sibling);
		} else {
			parent.appendChild(this._contentParent);
		}

		if(options.content){
			this.setContent(options.content);
		}
		
		if (typeof(options.onExpandCollapse) === "function") { //$NON-NLS-0$
			this._onExpandCollapse = options.onExpandCollapse;
		}
		this._preferenceService = options.preferenceService;
		// initially style as hidden until we determine what needs to happen
		this._collapse();
		if (!options.dropdown) {
			// should we consult a preference?
			if (this._preferenceService) {
				var self = this;
				this._preferenceService.getPreferences("/window/views").then(function(prefs) {  //$NON-NLS-0$
					var isExpanded = prefs.get(self.id);
					
					if (isExpanded === undefined){
						// pref not found, check options
						if (!options.hidden) {
							self._expand();
						}
					} else if (isExpanded) {
						self._expand();
					}
					
					self._updateExpandedState(false);
				});
			} else {
				if (!options.hidden) {
					this._expand();
				}
				this._updateExpandedState(false);
			}
		} else {
			this._updateExpandedState(true);
			this.dropdown = true;
			this.positionNode = options.positionNode;
			lib.addAutoDismiss([this._contentParent, this.positionNode || this.domNode], function (event) {
				var temp = event.target;
				while (temp) {
					if (temp.classList && temp.classList.contains("tooltipContainer")) { //$NON-NLS-0$
						return;
					}
					temp = temp.parentNode;
				}
				this.setHidden(true);
			}.bind(this));
		}
		this._commandService = options.commandService;
		this._lastMonitor = 0;
		this._loading = {};
	}
	
	Section.prototype = /** @lends orion.widgets.Section.prototype */ {
		
		/**
		 * Destroy the section by removing the title and content from the parent.
		 */
		destroy: function() {
			var parent;
			if (this.domNode) {
				parent = this.domNode.parentNode;
				if (parent) parent.removeChild(this.domNode);
				this.domNode = null;
			}
			if (this._contentParent) {
				parent = this._contentParent.parentNode;
				if (parent) parent.removeChild(this._contentParent);
				this._contentParent = null;
			}
		},
			
		/**
		 * Changes the title of section
		 * @param title
		 */
		setTitle: function(title){
			this.titleNode.textContent = title;
		},
		
		/**
		 * Get the header DOM node
		 * @returns {DomNode} The dom node that holds the section header.
		 */
		getHeaderElement: function(title){
			return this.domNode;
		},
		
		/**
		 * Get the title DOM node
		 * @returns {DomNode} The dom node that holds the section title.
		 */
		getTitleElement: function(title){
			return this.titleNode;
		},
		
		/**
		 * Get the title DOM node
		 * @returns {DomNode} The dom node that holds the section title.
		 */
		getActionElement: function(title){
			return this._toolActionsNode;
		},
		
		/**
		 * Changes the contents of the section.
		 * @param {String|DomNode} content
		 */
		setContent: function(content){
			if (typeof content === 'string') {  //$NON-NLS-0$
				this._contentParent.innerHTML = content;
			} else {
				this._contentParent.innerHTML = ""; //NON-NLS-0$
				this._contentParent.appendChild(content);
			}
		},
		
		setHidden: function(hidden) {
			if (this.hidden === hidden) return;
			if (!this.canHide) return;
			this._changeExpandedState();
		},
		
		/**
		 * 
		 * @param {Function} func
		 */
		setOnExpandCollapse: function(func){
			this._onExpandCollapse = func;
		},

		/**
		 * @returns {DomNode} The dom node that holds the section contents.
		 */
		getContentElement: function() {
			return this._contentParent;
		},
		
		embedExplorer: function(explorer, parent, noSelection){
			this._contentParent.innerHTML = ""; //NON-NLS-0$
			if(!explorer.parent){
				explorer.parent = parent;
			}
			this._contentParent.appendChild(explorer.parent);
			explorer.section = this;
			objects.mixin(explorer, {
				createActionSections: function(){
					if(this.actionsSections)
					this.actionsSections.forEach(function(id) {
						if (!lib.node(id)) {
							var elem = document.createElement("ul"); //$NON-NLS-0$
							elem.id = id;
							elem.classList.add("commandList"); //$NON-NLS-0$
							elem.classList.add("layoutRight"); //$NON-NLS-0$
							this.section.actionsNode.appendChild(elem);
						}
					}.bind(this));
				},
				getCommandsVisible: function() {
					return this.section.actionsNode.style.visibility!=="hidden";
				},
				setCommandsVisible: function(visible, selectionPolicy) {
					this.section.actionsNode.style.visibility = visible ? "" : "hidden";
					if (undefined === selectionPolicy){
						selectionPolicy = visible ? null : "cursorOnly"; //$NON-NLS-0$	
					} 
					this.renderer.selectionPolicy = selectionPolicy;
					var navHandler = this.getNavHandler();
					if (navHandler) {
						navHandler.setSelectionPolicy(selectionPolicy);
					}
					if (visible) {
						this.updateCommands();
					} else {
						if(this.actionsSections)
						this.actionsSections.forEach(function(id) {
							if(lib.node(id)) this.commandRegistry.destroy(id);
						}.bind(this));
					}
				},
				destroy: function(){
					Object.getPrototypeOf(this).destroy.call(this);
					var _self = this;
					if(!this.actionsSections){
						return;
					}
					this.actionsSections.forEach(function(id) {
						delete _self[id];
					});
					delete this.actionsSections;
				},
				updateCommands: function(selections){
					if (!this.section.actionsNode || !this.getCommandsVisible()) {
						return;
					}
					this.createActionSections();
					Object.getPrototypeOf(this).updateCommands.call(this, selections);
				},
				loaded: function(){
					var self = this;
					if(!this.selection && !noSelection){
						if(this.serviceRegistry || this.registry){
							this.selection = new Selection.Selection(this.serviceRegistry || this.registry, this.parent.id + "Selection"); //$NON-NLS-0$
							this.selection.addEventListener("selectionChanged", function(event) { //$NON-NLS-0$
								self.updateCommands(event.selections);
							});
						} else {
							window.console.error("Could not create a Selection for the explorer because of lack of serviceRegistry");
						}
					}
					var commandsRegistered = this.registerCommands();
					if(!commandsRegistered || !commandsRegistered.then){
						self.updateCommands();
					} else {
						commandsRegistered.then(function() {
							self.updateCommands();
						});
					}
				}
			});
			if(explorer.renderer){
				explorer.renderer.section = this;
				if(!this._keepHeader){
					objects.mixin(explorer.renderer, {
						getCellHeaderElement: function(col_no){
							var firstHeader = Object.getPrototypeOf(this).getCellHeaderElement.call(this, col_no);
							if(firstHeader){
								this.section.setTitle(firstHeader.innerHTML);
							}
							return null;
						}
					});
				}
			}
		},

		createProgressMonitor: function(){
			return new ProgressMonitor(this);
		},
		
		_setMonitorMessage: function(monitorId, message){
			this._progressNode.style.display = "block"; //$NON-NLS-0$
			this._loading[monitorId] = message;
			var progressTitle = "";
			for(var loadingId in this._loading){
				if(progressTitle!==""){
					progressTitle+="\n"; //$NON-NLS-0$
				}
				progressTitle+=this._loading[loadingId];
			}
			this._progressNode.title = progressTitle;
			this._updateExpandedState(false);
		},
		
		_monitorDone: function(monitorId){
			delete this._loading[monitorId];
			var progressTitle = "";
			for(var loadingId in this._loading){
				if(progressTitle!==""){
					progressTitle+="\n"; //$NON-NLS-0$
				}
				progressTitle+=this._loading[loadingId];
			}
			this._progressNode.title = progressTitle;
			if(progressTitle===""){
				this._progressNode.style.display = "none"; //$NON-NLS-0$
			}
			this._updateExpandedState(false);
		},
		
		_changeExpandedState: function() {
			if (this.hidden){
				this._expand();
			} else {
				this._collapse();
			}
			
			this._updateExpandedState(true);
		},
		
		_updateExpandedState: function(storeValue) {
			var isExpanded = !this.hidden;
			var isProgress = this.working;
			var expandImage = this.twistie;
			var id = this.id;
			if (expandImage) {
				expandImage.classList.remove(this._expandImageClass);
				expandImage.classList.remove(this._collapseImageClass);
				expandImage.classList.remove(this._progressImageClass);
				expandImage.classList.add(isProgress ? this._progressImageClass : isExpanded ? this._expandImageClass : this._collapseImageClass); //$NON-NLS-0$
			}
			// if a preference service was specified, we remember the state.
			if (this._preferenceService && storeValue) {
				this._preferenceService.getPreferences("/window/views").then(function(prefs){ //$NON-NLS-0$
					prefs.put(id, isExpanded);
				}); 
			}
			
			// notify the client
			if (this._onExpandCollapse) {
				this._onExpandCollapse(isExpanded, this);
			}
			this.dispatchEvent({type: "toggle", isExpanded: isExpanded}); //$NON-NLS-0$
		},
		
		_expand: function() {
			this._positionDropdown();
			if (this._contentParent) {
				this._contentParent.classList.remove("sectionClosed"); //$NON-NLS-0$
				this._contentParent.classList.add("sectionOpened"); //$NON-NLS-0$
			}
			if (this.domNode) {
				this.domNode.classList.remove("sectionClosed"); //$NON-NLS-0$
				this.domNode.classList.add("sectionOpened"); //$NON-NLS-0$
			}
			this.hidden = false;
		},
		
		_positionDropdown: function() {
			if (!this.dropdown) return;
			var bounds = lib.bounds(this.positionNode || this.domNode);
			var parentBounds = lib.bounds(this._boundingNode(this.domNode));
			var bodyBounds = lib.bounds(document.body);
			var contentBounds = lib.bounds(this._contentParent);
			if (bounds.left + contentBounds.width > (bodyBounds.left + bodyBounds.width)) {
				this._contentParent.style.left = (bounds.left  - parentBounds.left - contentBounds.width + bounds.width) + "px"; //$NON-NLS-0$
			} else {
				this._contentParent.style.left = (bounds.left - parentBounds.left) + "px"; //$NON-NLS-0$
			}
			this._contentParent.style.top = (bounds.top + bounds.height - parentBounds.top) + "px"; //$NON-NLS-0$
		},
		
		_boundingNode: function(node) {
			var style = window.getComputedStyle(node, null);
			if (style === null) {
				return node;
			}
			var position = style.getPropertyValue("position"); //$NON-NLS-0$
			if (position === "absolute" || !node.parentNode || node === document.body) { //$NON-NLS-0$
				return node;
			}
			return this._boundingNode(node.parentNode);
		},
		
		_collapse: function() {
			this.hidden = true;
			if (this._contentParent) {
				this._contentParent.classList.add("sectionClosed"); //$NON-NLS-0$
				this._contentParent.classList.remove("sectionOpened"); //$NON-NLS-0$
			}
			if (this.domNode) {
				this.domNode.classList.add("sectionClosed"); //$NON-NLS-0$
				this.domNode.classList.remove("sectionOpened"); //$NON-NLS-0$
			}
		}
	};
	
	Section.prototype.constructor = Section;
	
	// ProgressMonitor
	
	function ProgressMonitor(section){
		this._section = section;
		this._id = ++section._lastMonitor;
	}
	
	ProgressMonitor.prototype = {
		begin: function(message){
			this._section.working = true;
			this.status = message;
			this._section._setMonitorMessage(this.id, message);
		},
		
		worked: function(message){
			this.status = message;
			this._section._setMonitorMessage(this.id, message);
		},
		
		done: function(status){
			this._section.working = false;
			this.status = status;
			this._section._monitorDone(this.id);
		}
	};
	
	ProgressMonitor.prototype.constructor = ProgressMonitor;

	return {Section: Section};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define("orion/editor/stylers/application_xml/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.xml", //$NON-NLS-0$
		contentTypes: ["application/xml", "application/xhtml+xml"], //$NON-NLS-1$ //$NON-NLS-0$
		patterns: [
			{include: "#comment"}, //$NON-NLS-0$
			{include: "#doctype"}, //$NON-NLS-0$
			{include: "#xmlDeclaration"}, //$NON-NLS-0$
			{include: "#tag"}, //$NON-NLS-0$
			{include: "#ampersandEscape"} //$NON-NLS-0$
		],
		repository: {
			ampersandEscape: {
				match: "&lt;|&gt;|&amp;", //$NON-NLS-0$
				name: "constant.character" //$NON-NLS-0$
			},
			comment: {
				begin: {match: "<!--", literal: "<!--"}, //$NON-NLS-0$
				end: {match: "-->", literal: "-->"}, //$NON-NLS-0$
				name: "comment.block.xml", //$NON-NLS-0$
				patterns: [
					{
						match: "(\\b)(TODO)(\\b)(((?!-->).)*)", //$NON-NLS-0$
						name: "meta.annotation.task.todo", //$NON-NLS-0$
						captures: {
							2: {name: "keyword.other.documentation.task"}, //$NON-NLS-0$
							4: {name: "comment.line"} //$NON-NLS-0$
						}
					}
				]
			},
			doctype: {
				begin: "<!(?:doctype|DOCTYPE)", //$NON-NLS-0$
				end: ">", //$NON-NLS-0$
				name: "meta.tag.doctype.xml", //$NON-NLS-0$
				captures: {
					0: {name: "meta.tag.doctype.xml"}, //$NON-NLS-0$
				},
				patterns: [
					{include: "#comment"}, //$NON-NLS-0$
					{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
					{include: "orion.lib#string_singleQuote"} //$NON-NLS-0$
				]
			},
			tag: {
				begin: "</?[A-Za-z0-9]+", //$NON-NLS-0$
				end: "/?>", //$NON-NLS-0$
				captures: {
					0: {name: "meta.tag.xml"}, //$NON-NLS-0$
				},
				name: "meta.tag.xml", //$NON-NLS-0$
				patterns: [
					{include: "#comment"}, //$NON-NLS-0$
					{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
					{include: "orion.lib#string_singleQuote"} //$NON-NLS-0$
				]	
			},
			xmlDeclaration: {
				begin: "<\\?xml", //$NON-NLS-0$
				end: "\\?>", //$NON-NLS-0$
				captures: {
					0: {name: "meta.tag.declaration.xml"}, //$NON-NLS-0$
				},
				patterns: [
					{include: "#comment"}, //$NON-NLS-0$
					{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
					{include: "orion.lib#string_singleQuote"} //$NON-NLS-0$
				],
				name: "meta.tag.declaration.xml" //$NON-NLS-0$
			}
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: []
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_html/syntax", ["orion/editor/stylers/application_javascript/syntax", "orion/editor/stylers/text_css/syntax", "orion/editor/stylers/application_xml/syntax"], //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	function(mJS, mCSS, mXML) {

	var grammars = [];
	grammars.push.apply(grammars, mJS.grammars);
	grammars.push.apply(grammars, mCSS.grammars);
	grammars.push.apply(grammars, mXML.grammars);
	grammars.push({
		id: "orion.html", //$NON-NLS-0$
		contentTypes: ["text/html"], //$NON-NLS-0$
		patterns: [
			{
				begin: "(?i)(<style)([^>]*)(>)", //$NON-NLS-0$
				end: "(?i)(</style>)", //$NON-NLS-0$
				captures: {
					1: {name: "meta.tag.html"}, //$NON-NLS-0$
					3: {name: "meta.tag.html"} //$NON-NLS-0$
				},
				contentName: "source.css.embedded.html", //$NON-NLS-0$
				patterns: [
					{include: "orion.css"} //$NON-NLS-0$
				]
			}, {
				begin: "(?i)<script\\s*>|<script\\s.*?(?:language\\s*=\\s*(['\"])javascript\\1|type\\s*=\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?>", //$NON-NLS-0$
				end: "(?i)</script>", //$NON-NLS-0$
				captures: {
					0: {name: "meta.tag.html"} //$NON-NLS-0$
				},
				contentName: "source.js.embedded.html", //$NON-NLS-0$
				patterns: [
					{include: "orion.js"} //$NON-NLS-0$
				]
			},
			{include: "orion.xml#comment"}, //$NON-NLS-0$
			{include: "orion.xml#doctype"}, //$NON-NLS-0$
			{include: "orion.xml#tag"}, //$NON-NLS-0$
			{include: "orion.xml#ampersandEscape"} //$NON-NLS-0$
		]
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: []
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define("orion/editor/stylers/application_json/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = ["false", "true"]; //$NON-NLS-1$ //$NON-NLS-0$

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.json", //$NON-NLS-0$
		contentTypes: ["application/json"], //$NON-NLS-0$
		patterns: [
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.json" //$NON-NLS-0$
			}
		]
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-php/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-0$
	var keywords = [
		"abstract", "and", "array", "as", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"break", //$NON-NLS-0$
		"callable", "case", "catch", "class", "clone", "const", "continue", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"declare", "default", "die", "do", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"echo", "else", "elseif", "empty", "enddeclare", "endfor", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"endforeach", "endif", "endswitch", "endwhile", "eval", "exit", "extends", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"false", "FALSE", "final", "finally", "for", "foreach", "function", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"global", "goto", //$NON-NLS-1$ //$NON-NLS-0$
		"if", "implements", "include", "include_once", "insteadof", "interface", "instanceof", "isset", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"list", //$NON-NLS-0$
		"namespace", "new", "null", "NULL", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"or", //$NON-NLS-0$
		"parent", "print", "private", "protected", "public", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"require", "require_once", "return", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"self", "static", "switch", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"throw", "trait", "try", "true", "TRUE", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"unset", "use", //$NON-NLS-1$ //$NON-NLS-0$
		"var", //$NON-NLS-0$
		"while", //$NON-NLS-0$
		"xor", //$NON-NLS-0$
		"yield", //$NON-NLS-0$
		"__halt_compiler", "__CLASS__", "__DIR__", "__FILE__", "__FUNCTION__",  //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"__LINE__", "__METHOD__", "__NAMESPACE__", "__TRAIT__"  //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.php", //$NON-NLS-0$
		contentTypes: ["text/x-php"], //$NON-NLS-0$
		patterns: [
			{
				begin: "(?i)<(\\?|%(?!php))(?:=|php)?(?:\\s|$)", //$NON-NLS-0$
				end: "[\\1]>", //$NON-NLS-0$
				captures: {
					0: {name: "entity.name.declaration.php"} //$NON-NLS-0$
				},
				contentName: "source.php.embedded", //$NON-NLS-0$
				patterns: [
					{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
					{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
					{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
					{include: "orion.lib#doc_block"}, //$NON-NLS-0$
					{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
					{
						match: {match: "#.*", literal: "#"}, //$NON-NLS-0$
						name: "comment.line.number-sign.php", //$NON-NLS-0$
						patterns: [
							{include: "orion.lib#todo_comment_singleLine"} //$NON-NLS-0$
						]
					}, {
						begin: "<<<(\\w+)$", //$NON-NLS-0$
						end: "^\\1;$", //$NON-NLS-0$
						name: "string.unquoted.heredoc.php" //$NON-NLS-0$
					}, {
						begin: "<<<'(\\w+)'$", //$NON-NLS-0$
						end: "^\\1;$", //$NON-NLS-0$
						name: "string.unquoted.heredoc.nowdoc.php" //$NON-NLS-0$
					},
					{include: "orion.lib#brace_open"}, //$NON-NLS-0$
					{include: "orion.lib#brace_close"}, //$NON-NLS-0$
					{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
					{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
					{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
					{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
					{
						match: "\\b0[bB][01]+\\b", //$NON-NLS-0$
						name: "constant.numeric.binary.php" //$NON-NLS-0$
					},
					{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
					{include: "orion.lib#number_hex"}, //$NON-NLS-0$
					{
						match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						name: "keyword.control.php" //$NON-NLS-0$
					}
				]
			}, {
				include: "orion.html" //$NON-NLS-0$
			}
		]
	});

	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-python/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-0$
	var keywords = [
		"and", "as", "assert", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"break", //$NON-NLS-0$
		"class", "continue", //$NON-NLS-1$ //$NON-NLS-0$
		"def", "del", //$NON-NLS-1$ //$NON-NLS-0$
		"exec", "elif", "else", "except", "Ellipsis", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"False", "finally", "for", "from", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"global", //$NON-NLS-0$
		"if", "import", "in", "is", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"lambda", //$NON-NLS-0$
		"not", "None", "NotImplemented", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"or", //$NON-NLS-0$
		"pass", "print", //$NON-NLS-1$ //$NON-NLS-0$
		"raise", "return", //$NON-NLS-1$ //$NON-NLS-0$
		"try", "True", //$NON-NLS-1$ //$NON-NLS-0$
		"while", "with", //$NON-NLS-1$ //$NON-NLS-0$
		"yield" //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.python", //$NON-NLS-0$
		contentTypes: ["text/x-python"], //$NON-NLS-0$
		patterns: [
			{
				begin: "(['\"])\\1\\1", //$NON-NLS-0$
				end: "\\1\\1\\1", //$NON-NLS-0$
				name: "string.quoted.triple.python" //$NON-NLS-0$
			}, 
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{
				begin: {match: "#", literal: "#"}, //$NON-NLS-0$
				end: {match: "$", literal: ""}, //$NON-NLS-0$
				name: "comment.line.number-sign.python", //$NON-NLS-0$
				patterns: [
					{
						include: "orion.lib#todo_comment_singleLine" //$NON-NLS-0$
					}
				]
			},
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$ 
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.python" //$NON-NLS-0$
			}
		],
		repository: {
			number_decimal: {
				match: "\\b-?(?:\\.\\d+|\\d+\\.?\\d*)[lL]?\\b", //$NON-NLS-0$
				name: "constant.numeric.number.python" //$NON-NLS-0$
			}
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-ruby/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"alias", "alias_method", "and", "attr_reader", "attr_writer", "attr_accessor", "attr", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"BEGIN", "begin", "break", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"case", "class", "catch", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"def", "defined?", "do", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"else", "elsif", "END", "end", "ensure", "extend", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"false", "for", "fail", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"gem", //$NON-NLS-0$
		"if", "in", "include", "initialize", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"load",  "loop", "lambda", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"module", "module_function", //$NON-NLS-1$ //$NON-NLS-0$
		"new", "next", "nil", "not", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"or", //$NON-NLS-0$
		"public", "prepend", "private", "protected", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"raise", "redo", "require", "require_relative", "rescue", "retry", "return", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"self", "super", //$NON-NLS-1$ //$NON-NLS-0$
		"then", "throw", "true", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"undef", "unless", "until", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"when", "while", //$NON-NLS-1$ //$NON-NLS-0$
		"yield", //$NON-NLS-0$
		"__ENCODING__", "__END__", "__FILE__", "__LINE__" //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.ruby", //$NON-NLS-0$
		contentTypes: ["text/x-ruby"], //$NON-NLS-0$
		patterns: [
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{
				match: "/(?![\\s])(?:\\\\.|[^/])+/(?:[ioxmuesn]\\b)?", //$NON-NLS-0$
				name: "string.regexp.ruby" //$NON-NLS-0$
			}, {
				match: {match: "#.*", literal: "#"}, //$NON-NLS-0$
				name: "comment.line.number-sign.ruby", //$NON-NLS-0$
				patterns: [
					{include: "orion.lib#todo_comment_singleLine"} //$NON-NLS-0$
				]
			}, {
				begin: {match: "^=begin\\b", literal: "=begin"}, //$NON-NLS-0$
				end: {match: "^=end\\b", literal: "=end"}, //$NON-NLS-0$
				name: "comment.block.ruby", //$NON-NLS-0$
				patterns: [
					{
						match: "(\\b)(TODO)(\\b)(((?!\\*/).)*)", //$NON-NLS-0$
						name: "meta.annotation.task.todo", //$NON-NLS-0$
						captures: {
							2: {name: "keyword.other.documentation.task"}, //$NON-NLS-0$
							4: {name: "comment.block"} //$NON-NLS-0$
						}
					}
				]
			},
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{include: "#symbol"}, //$NON-NLS-0$
			{include: "#variable"}, //$NON-NLS-0$
			{
				match: "\\b0[bB][01]+\\b", //$NON-NLS-0$
				name: "constant.numeric.binary.ruby" //$NON-NLS-0$
			}, {
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.ruby" //$NON-NLS-0$
			}
		],
		repository: {
			symbol: {
				match: ":\\w+", //$NON-NLS-0$
				name: "entity.name.symbol.ruby" //$NON-NLS-0$
			},
			variable: {
				match: "@\\w+", //$NON-NLS-0$
				name: "entity.name.variable.ruby" //$NON-NLS-0$
			}
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10/.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-go/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"break", //$NON-NLS-0$
		"case", "const", "continue", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"default", "defer", //$NON-NLS-1$ //$NON-NLS-0$
		"else", //$NON-NLS-0$
		"fallthrough", "false", "for", "func", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"goto", "go", //$NON-NLS-1$ //$NON-NLS-0$
		"if", "import", //$NON-NLS-1$ //$NON-NLS-0$
		"nil", //$NON-NLS-0$
		"package", //$NON-NLS-0$
		"range", "return", //$NON-NLS-1$ //$NON-NLS-0$
		"select", "switch", //$NON-NLS-1$ //$NON-NLS-0$
		"true", "type", //$NON-NLS-1$ //$NON-NLS-0$
		"var" //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.go", //$NON-NLS-0$
		contentTypes: ["text/x-go"], //$NON-NLS-0$
		patterns: [
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{
				begin: "`", //$NON-NLS-0$
				end: "`", //$NON-NLS-0$
				name: "string.quoted.raw.go", //$NON-NLS-0$
			},
			{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.go" //$NON-NLS-0$
			},
			{
				match: "\\b(?:len|cap|new|make|append|close|copy|delete|complex|real|imag|panic|recover)\\b", //$NON-NLS-0$
				name: "support.function.go" //$NON-NLS-0$
			},
			{
				match: "\\b(?:bool|chan|uint8|uint16|uint32|uint64|int8|int16|int32|int64|float32|float64|complex64|complex128|byte|map|rune|uint|interface|int|uintptr|string|struct|error)\\b", //$NON-NLS-0$
				name: "support.function.type" //$NON-NLS-0$
			}
		]
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-csrc/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"auto", //$NON-NLS-0$
		"break", //$NON-NLS-0$
		"case", "char", "const", "continue", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"default", "double", "do", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"else", "enum", "extern", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"float", "for", //$NON-NLS-1$ //$NON-NLS-0$
		"goto", //$NON-NLS-0$
		"if", "inline", "int", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"long", //$NON-NLS-0$
		"register", "return", //$NON-NLS-1$ //$NON-NLS-0$
		"short", "signed", "sizeof", "static", "struct", "switch", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"typedef", //$NON-NLS-0$
		"union", "unsigned", //$NON-NLS-1$ //$NON-NLS-0$
		"void", "volatile", //$NON-NLS-1$ //$NON-NLS-0$
		"while", //$NON-NLS-0$
		"_Bool", "_Complex", "_Imaginary" //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var directives = [
		"define", "elif", "else", "endif", "error", "ifdef", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"ifndef", "if", "include", "line", "pragma", "undef" //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.c", //$NON-NLS-0$
		contentTypes: ["text/x-csrc", "text/x-c"], //$NON-NLS-1$ //$NON-NLS-0$
		patterns: [
			{include: "orion.lib#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.lib#string_singleQuote"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
			{include: "orion.lib#doc_block"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_block"}, //$NON-NLS-0$
			{include: "#directive"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "orion.lib#number_decimal"}, //$NON-NLS-0$
			{include: "orion.lib#number_hex"}, //$NON-NLS-0$
			{
				match: "\\b(?:" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.c" //$NON-NLS-0$
			}
		],
		repository: {
			directive: {
				match: "(#\\s*(?:" + directives.join("|") + "))\\b",
				name: "keyword.control.directive.c"
			}
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords.concat(directives)
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-objective-c/syntax", ["orion/editor/stylers/text_x-csrc/syntax"], function(mC) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"atomic", //$NON-NLS-0$
		"BOOL", "bycopy", "byref", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"Class", //$NON-NLS-0$
		"id", "IMP", "inout", "in", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"nil", "nonatomic", "NO", "NULL", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"oneway", "out", //$NON-NLS-1$ //$NON-NLS-0$
		"Protocol", //$NON-NLS-0$
		"retain", //$NON-NLS-0$
		"SEL", "self", "super", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"YES" //$NON-NLS-0$
	];

	var atKeywords = [
		"@catch", "@class", //$NON-NLS-1$ //$NON-NLS-0$
		"@dynamic", //$NON-NLS-0$
		"@end", //$NON-NLS-0$
		"@finally", //$NON-NLS-0$
		"@implementation", "@interface", //$NON-NLS-1$ //$NON-NLS-0$
		"@private", "@property", "@protected", "@protocol", "@public", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"@selector", //$NON-NLS-0$
		"@synthesize", //$NON-NLS-0$
		"@throw", "@try" //$NON-NLS-1$ //$NON-NLS-0$
	];

	var directives = ["import"]; //$NON-NLS-0$

	var grammars = [];
	grammars.push.apply(grammars, mC.grammars);
	grammars.push({
		id: "orion.objectiveC", //$NON-NLS-0$
		contentTypes: ["text/x-objective-c"], //$NON-NLS-0$
		patterns: [
			{include: "#objectiveCString"}, //$NON-NLS-0$
			{include: "orion.c"}, //$NON-NLS-0$
			{include: "#objectiveCDirective"}, //$NON-NLS-0$
			{include: "#objectiveCKeyword"} //$NON-NLS-0$
		],
		repository: {
			objectiveCDirective: {
				match: "(#\\s*(?:" + directives.join("|") + "))\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.directive.objective-c" //$NON-NLS-0$
			},
			objectiveCKeyword: {
				match: "(\\b(?:" + keywords.join("|") + ")|(?:" + atKeywords.join("|") + "))\\b", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				name: "keyword.control.objective-c" //$NON-NLS-0$
			},
			objectiveCString: {
				match: '@"(?:\\\\.|[^"])*"?', //$NON-NLS-0$
				name: "string.quoted.double.objective-c" //$NON-NLS-0$
			},
		}
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: mC.keywords.concat(keywords).concat(directives).concat(atKeywords)
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-swift/syntax", ["orion/editor/stylers/lib/syntax"], function(mLib) { //$NON-NLS-1$ //$NON-NLS-0$
	var keywords = [
		"associativity", "as", //$NON-NLS-1$ //$NON-NLS-0$
		"break", //$NON-NLS-0$
		"case", "class", "continue", "convenience", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"default", "deinit", "didSet", "do", "dynamicType", "dynamic", //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"else", "enum", "extension", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"fallthrough", "false", "final", "for", "func", //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"get", //$NON-NLS-0$
		"if", "import", "infix", "init", "inout", "internal", "in", "is", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"lazy", "left", "let", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"mutating", //$NON-NLS-0$
		"nil", "none", "nonmutating", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"operator", "optional", "override", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"postfix", "precedence", "prefix", "private", "protocol", "Protocol", "public", //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"required", "return", "right", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"self", "Self", "set", "static", "struct", "subscript", "super", "switch", //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"true", "typealias", "Type", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"unowned", //$NON-NLS-0$
		"var", //$NON-NLS-0$
		"weak", "where", "while", "willSet", //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
		"@objc" //$NON-NLS-0$
	];
	var keywords2 = [
		"__COLUMN__", "__FILE__", "__FUNCTION__", "__LINE__" //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	];

	var grammars = [];
	grammars.push.apply(grammars, mLib.grammars);
	grammars.push({
		id: "orion.swift", //$NON-NLS-0$
		contentTypes: ["text/x-swift"], //$NON-NLS-0$
		patterns: [
			{include: "#string_doubleQuote"}, //$NON-NLS-0$
			{include: "orion.c-like#comment_singleLine"}, //$NON-NLS-0$
			{include: "#comment_block"}, //$NON-NLS-0$
			{include: "orion.lib#brace_open"}, //$NON-NLS-0$
			{include: "orion.lib#brace_close"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_open"}, //$NON-NLS-0$
			{include: "orion.lib#bracket_close"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_open"}, //$NON-NLS-0$
			{include: "orion.lib#parenthesis_close"}, //$NON-NLS-0$
			{include: "#number_binary"}, //$NON-NLS-0$
			{include: "#number_hex"}, //$NON-NLS-0$
			{include: "#number_octal"}, //$NON-NLS-0$
			{include: "#number_decimal"}, //$NON-NLS-0$
			{include: "#keywords"}, //$NON-NLS-0$
			{include: "#keywords2"}, //$NON-NLS-0$
		],
		repository: {
			comment_block: {
				begin: {match: "/\\*", literal: "/*"}, //$NON-NLS-1$ //$NON-NLS-0$
				end: {match: "\\*/", literal: "*/"}, //$NON-NLS-1$ //$NON-NLS-0$ 
				name: "comment.block.swift", //$NON-NLS-0$
				patterns: [
					{include: "#comment_block"}, //$NON-NLS-0$
					{
						match: "(\\b)(TODO)(\\b)(((?!\\*/).)*)", //$NON-NLS-0$
						name: "meta.annotation.task.todo", //$NON-NLS-0$
						captures: {
							2: {name: "keyword.other.documentation.task.swift"}, //$NON-NLS-0$
							4: {name: "comment.block.swift"} //$NON-NLS-0$
						}
					}
				]
			},
			keywords: {
				match: "(^|[^\\w`])(" + keywords.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				captures: {
					2: {name: "keyword.control.swift"} //$NON-NLS-0$
				}
			},
			keywords2: {
				match: "(^|[^\\w`])(" + keywords2.join("|") + ")(?:$|[^\\w])", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
				captures: {
					2: {name: "keyword.control.swift"} //$NON-NLS-0$
				}
			},
			number_binary: {
				match: "\\b0b[01]+\\b", //$NON-NLS-0$
				name: "constant.numeric.binary.swift" //$NON-NLS-0$
			},
			number_decimal: {
				match: "\\b-?(?:\\.\\d[\\d_]*|\\d[\\d_]*\\.?[\\d_]*)(?:[eE][+-]?\\d[\\d_]*)?\\b", //$NON-NLS-0$
				name: "constant.numeric.decimal.swift" //$NON-NLS-0$
			},
			number_hex: {
				match: "\\b0[xX](?:\\.[0-9A-Fa-f][0-9A-Fa-f_]*|[0-9A-Fa-f][0-9A-Fa-f_]*\\.?[0-9A-Fa-f_]*)(?:[pP][+-]?\\d[\\d_]*)?\\b", //$NON-NLS-0$
				name: "constant.numeric.hex.swift" //$NON-NLS-0$
			},
			number_octal: {
				match: "\\b0o[01234567][01234567_]*\\b", //$NON-NLS-0$
				name: "constant.numeric.octal.swift" //$NON-NLS-0$
			},
			segment: {
				begin: "\\(", //$NON-NLS-0$
				end: "\\)", //$NON-NLS-0$
				patterns: [
					{include: "#segment"}, //$NON-NLS-0$
					{include: "#comment_block"}, //$NON-NLS-0$
					{include: "#number_binary"}, //$NON-NLS-0$
					{include: "#number_hex"}, //$NON-NLS-0$
					{include: "#number_octal"}, //$NON-NLS-0$
					{include: "#number_decimal"}, //$NON-NLS-0$
					{include: "#keywords"}, //$NON-NLS-0$
					{include: "#keywords2"} //$NON-NLS-0$
				]
			},
			string_doubleQuote: {
				match: '"(?:\\\\.|[^"])*"?', //$NON-NLS-0$
				name: "string.quoted.double.swift", //$NON-NLS-0$
				patterns: [
					{
						begin: "\\\\\\(", //$NON-NLS-0$
						end: "\\)", //$NON-NLS-0$
						name: "none", //$NON-NLS-0$
						patterns: [
							{include: "#segment"}, //$NON-NLS-0$
							{include: "#comment_block"}, //$NON-NLS-0$
							{include: "#number_binary"}, //$NON-NLS-0$
							{include: "#number_hex"}, //$NON-NLS-0$
							{include: "#number_octal"}, //$NON-NLS-0$
							{include: "#number_decimal"}, //$NON-NLS-0$
							{include: "#keywords"}, //$NON-NLS-0$
							{include: "#keywords2"} //$NON-NLS-0$
						]
					}
				]
			}
		}
	});

	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: keywords.concat(keywords2)
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

define("orion/editor/stylers/application_x-ejs/syntax", ["orion/editor/stylers/application_javascript/syntax", "orion/editor/stylers/application_xml/syntax"], //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	function(mJS, mXML) {

	var grammars = [];
	grammars.push.apply(grammars, mJS.grammars);
	grammars.push.apply(grammars, mXML.grammars);
	grammars.push({
		id: "orion.ejs", //$NON-NLS-0$
		contentTypes: ["application/x-ejs"], //$NON-NLS-0$
		patterns: [
			{include: "orion.xml#comment"}, //$NON-NLS-0$
			{include: "orion.xml#doctype"}, //$NON-NLS-0$
			{
				begin: "<%=?(?:\\s|$)", //$NON-NLS-0$
				end: "%>", //$NON-NLS-0$
				captures: {
					0: {name: "entity.name.declaration.js"} //$NON-NLS-0$
				},
				contentName: "source.js.embedded.ejs", //$NON-NLS-0$
				patterns: [
					{include: "orion.js"} //$NON-NLS-0$
				]
			},
			{include: "orion.xml#tag"}, //$NON-NLS-0$
			{include: "orion.xml#ampersandEscape"} //$NON-NLS-0$
		]
	});
	return {
		id: grammars[grammars.length - 1].id,
		grammars: grammars,
		keywords: []
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/
define("orion/editor/stylers/text_x-yaml/syntax", [], function() { //$NON-NLS-0$
	var keywords = ["false", "null", "true"]; //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
	var casts = ["!!bool", "!!float", "!!int", "!!map", "!!null", "!!omap", "!!seq", "!!str"]; //$NON-NLS-7$ //$NON-NLS-6$ //$NON-NLS-5$ //$NON-NLS-4$ //$NON-NLS-3$ //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$

	var id = "orion.yaml"; //$NON-NLS-0$
	var grammar = {
		id: id,
		contentTypes: ["text/x-yaml"], //$NON-NLS-0$
		patterns: [
			{include: "#numberSignComment"}, //$NON-NLS-0$
			{
				match: "^%(?:YAML|TAG)\\s.*", //$NON-NLS-0$
				name: "meta.directive.yaml" //$NON-NLS-0$
			}, {
				begin: "^.*?:(?:[\\t ]|$)", //$NON-NLS-0$
				end: "$", //$NON-NLS-0$
				contentName: "string.unquoted.yaml", //$NON-NLS-0$
				beginCaptures: {
					0: {
						name: "entity.name.key.yaml"
					}
				},
				patterns: [
					{include: "#numberSignComment"}, //$NON-NLS-0$
					{
						match: "^\\s*[&*]\\s*$", //$NON-NLS-0$
						name: "entity.name.tag.yaml" //$NON-NLS-0$
					}, {
						match: "(?i)^\\s*(?:" + keywords.join("|") + ")\\s*$", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						name: "keyword.control.yaml" //$NON-NLS-0$
					}, {
						match: "(?i)^\\s*(?:" + casts.join("|") + ")\\b", //$NON-NLS-2$ //$NON-NLS-1$ //$NON-NLS-0$
						name: "keyword.control.yaml" //$NON-NLS-0$
					}, {
						match: "(?i)^\\s*(?:-?[0-9]*(?:\\.[0-9]+)?(?:e[-+][1-9][0-9]*)?)\\s*$", //$NON-NLS-0$
						name: "constant.numeric.yaml" //$NON-NLS-0$
					}, {
						match: "(?i)^\\s*(?:-?[1-9][0-9]*|0|-?\\.inf|\\.nan)\\s*$", //$NON-NLS-0$
						name: "constant.numeric.yaml" //$NON-NLS-0$
					}
				]
			}, {
				match: "---|\\.\\.\\.", //$NON-NLS-0$
				name: "meta.separator.yaml" //$NON-NLS-0$
			}
		],
		repository: {
			numberSignComment: {
				begin: {match: "(?:^|\\s)#", literal: "#"}, //$NON-NLS-0$
				end: {match: "$", literal: ""}, //$NON-NLS-0$
				name: "comment.line.number-sign.yaml", //$NON-NLS-0$
				patterns: [
					{include: "orion.lib#todo_comment_singleLine"} //$NON-NLS-0$
				]
			}
		}
	};

	return {
		id: id,
		grammars: [grammar],
		keywords: casts.concat(keywords)
	};
});

/*******************************************************************************
 *
 * @license
 * Copyright (c) 2010, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/widgets/browse/staticDataSource',[
	'orion/Deferred',
	"orion/editor/textStyler", 
	"orion/editor/stylers/application_javascript/syntax",
	"orion/editor/stylers/text_css/syntax",
	"orion/editor/stylers/text_html/syntax",
	"orion/editor/stylers/application_json/syntax",
	"orion/editor/stylers/text_x-php/syntax",
	"orion/editor/stylers/text_x-python/syntax",
	"orion/editor/stylers/text_x-ruby/syntax",
	"orion/editor/stylers/text_x-go/syntax",
	"orion/editor/stylers/text_x-objective-c/syntax",
	"orion/editor/stylers/text_x-swift/syntax",
	'orion/editor/stylers/application_x-ejs/syntax',
	'orion/editor/stylers/application_xml/syntax',
	'orion/editor/stylers/text_x-yaml/syntax',
], function(Deferred, mStyler, mJS, mCss, mHtml, mJson, mPhp, mPython, mRuby, mGo, mObjectiveC, mSwift, mEJS, mXml, mYaml) {
	var ContentTypes = [{	id: "text/plain",
			name: "Text",
			extension: ["txt"],
			imageClass: "file-sprite-text modelDecorationSprite"
		},
		{	id: "application/javascript",
			"extends": "text/plain",
			name: "JavaScript",
			extension: ["js"],
			imageClass: "file-sprite-javascript modelDecorationSprite"
		},
		{	id: "text/html",
			"extends": "text/plain",
			name: "HTML",
			extension: ["html", "htm"],
			imageClass: "file-sprite-html modelDecorationSprite"
		},
		{	id: "text/css",
			"extends": "text/plain",
			name: "CSS",
			extension: ["css"],
			imageClass: "file-sprite-css modelDecorationSprite"
		},
		{	id: "application/json",
			"extends": "text/plain",
			name: "JSON",
			extension: ["json"],
			imageClass: "file-sprite-text modelDecorationSprite"
		},
		{	id: "application/xml",
			"extends": "text/plain",
			name: "XML",
			extension: ["xml"],
			imageClass: "file-sprite-xml modelDecorationSprite"
		},
		{	id: "application/x-ejs",
			"extends": "text/plain",
			name: "Embedded Javascript",
			extension: ["ejs"],
			imageClass: "file-sprite-javascript modelDecorationSprite"
		},
		{	id: "text/x-java-source",
			"extends": "text/plain",
			name: "Java",
			extension: ["java"]
		},
		{	id: "text/x-python",
			"extends": "text/plain",
			name: "Python",
			extension: ["py", "rpy", "pyw", "cpy", "SConstruct", "Sconstruct", "sconstruct", "SConscript", "gyp", "gypi"]
		},
		{	id: "text/x-ruby",
			"extends": "text/plain",
			name: "Ruby",
			extension: ["rb", "rbx", "rjs", "Rakefile", "rake", "cgi", "fcgi", "gemspec", "irbrc", "capfile", "ru", "prawn", "Gemfile", "Guardfile", "Vagrantfile", "Appraisals", "Rantfile"]
		},
		{	id: "text/x-go",
			name: "Go",
			extension: ["go"],
			"extends": "text/plain"
		},
		{	id: "text/x-objective-c",
			"extends": "text/plain",
			name: "Objective-C",
			extension: ["m", "mm", "h"]
		},
		{	id: "text/x-php",
			"extends": "text/plain",
			name: "PHP",
			extension: ["php", "php3", "php4", "php5", "phpt", "phtml", "aw", "ctp"]
		},
		{	id: "text/x-swift",
			"extends": "text/plain",
			name: "Swift",
			extension: ["swift"]
		},
		{	id: "text/x-markdown",
			"extends": "text/plain",
			name: "Markdown",
			extension: ["md"]
		},
		{	id: "text/x-yaml",
			"extends": "text/plain",
			name: "YAML",
			extension: ["yaml", "yml"]
		},
		{	id: "text/conf",
			"extends": "text/plain",
			name: "Conf",
			extension: ["conf"]
		},
		{	id: "text/sh",
			"extends": "text/plain",
			name: "sh",
			extension: ["sh"]
		},
		{	id: "application/browser-renderable",
			name: "browser-renderable"
		},
		{	id: "application/pdf",
			"extends": "application/browser-renderable",
			name: "PDF",
			extension: ["pdf"]
		},
		{	id: "application/octet-stream",
			name: "octet-stream",
			extension: ["exe", "bin", "doc", "ppt"]
		},
		{	id: "application/zip",
			"extends": "application/octet-stream",
			name: "ZIP",
			extension: ["war", "jar", "zip", "rar"]
		},
		// Image types
		{	id: "image/gif",
			name: "GIF",
			extension: ["gif"],
			imageClass: "file-sprite-image modelDecorationSprite"
		},
		{	id: "image/jpeg",
			name: "JPG",
			extension: ["jpg", "jpeg", "jpe"],
			imageClass: "file-sprite-image modelDecorationSprite"
		},
		{	id: "image/ico",
			name: "ICO",
			extension: ["ico"],
			imageClass: "file-sprite-image modelDecorationSprite"
		},
		{	id: "image/png",
			name: "PNG",
			extension: ["png"],
			imageClass: "file-sprite-image modelDecorationSprite"
		},
		{	id: "image/tiff",
			name: "TIFF",
			extension: ["tif", "tiff"],
			imageClass: "file-sprite-image modelDecorationSprite"
		},
		{	id: "image/svg",
			name: "SVG",
			extension: ["svg"],
			imageClass: "file-sprite-image modelDecorationSprite"
	}];
	
	function SyntaxHighlighter() {
		this.styler = null;
	}
	
	SyntaxHighlighter.prototype = {
		setup: function(fileContentType, textView, annotationModel, fileName, allowAsync) {
			if (this.styler) {
				if (this.styler.destroy) {
					this.styler.destroy();
				}
				this.styler = null;
			}
			return this._highlight(fileContentType, textView, annotationModel);
		},
		highlight: function(fileName, contentType, editor) {
			var textView = editor.getTextView();
			var annotationModel = editor.getAnnotationModel();
			return this._highlight(contentType, textView, annotationModel);
		},
		_highlight: function(fileContentType, textView, annotationModel) {
			if (this.styler) {
				this.styler.destroy();
				this.styler = null;
			}
			var stylerAdapter = null;
			if (fileContentType) {
				switch(fileContentType.id) {
					case "application/javascript": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mJS.grammars, "orion.js", fileContentType.id); //$NON-NLS-0$
						break;
					case "application/x-ejs": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mEJS.grammars, "orion.ejs", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/css": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mCss.grammars, "orion.css", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/html": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mHtml.grammars, "orion.html", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-java-source": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mJS.grammars, "orion.java", fileContentType.id); //$NON-NLS-0$
						break;
					case "application/json": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mJson.grammars, "orion.json", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-python": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mPython.grammars, "orion.python", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-ruby": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mRuby.grammars, "orion.ruby", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-go": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mGo.grammars, "orion.go", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-objective-c": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mObjectiveC.grammars, "orion.objectiveC", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-php": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mPhp.grammars, "orion.php", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-swift": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mSwift.grammars, "orion.swift", fileContentType.id); //$NON-NLS-0$
						break;
					case "application/xml": //$NON-NLS-0$
					case "application/xhtml+xml": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mXml.grammars, "orion.xml", fileContentType.id); //$NON-NLS-0$
						break;
					case "text/x-yaml": //$NON-NLS-0$
						stylerAdapter = new mStyler.createPatternBasedAdapter(mYaml.grammars, "orion.yaml", fileContentType.id); //$NON-NLS-0$
						break;
				}
			}
			if(stylerAdapter) {
				this.styler = new mStyler.TextStyler(textView, annotationModel, stylerAdapter);
			}
			return new Deferred().resolve();
		},
		getStyler: function() {
			return this.styler;
		}
	};
	
	return {ContentTypes: ContentTypes,
			SyntaxHighlighter: SyntaxHighlighter};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
define('gitWidgets/helper/gitCommitHelper',[
	'i18n!git/nls/gitmessages',
	'orion/git/widgets/gitChangeList',
	'orion/section',
	'orion/webui/littlelib',
	'orion/commandRegistry',
	'orion/widgets/browse/staticDataSource',
	'orion/objects'
], function(
	messages,
	mGitChangeList, 
	mSection, 
	lib, 
	mCommandRegistry,
	mStaticDataSource,
	objects
) {
	function GitCommitHelper(options) {
		this.parentId = options.parentId;
		this._serviceRegistry = options.serviceRegistry;
		this.gitClient = options.gitClient;
		//this.linkService = options.linkService;
		this._commandRegistry = new mCommandRegistry.CommandRegistry({});
		//this.fileClient = options.fileClient;
		//this.progressService = options.progressService;
		//this.preferencesService = options.preferencesService;
		//this.statusService = options.statusService;
		this.pageNavId = options.pageNavId;
		this.actionScopeId = options.actionScopeId;
	}
	
	objects.mixin(GitCommitHelper.prototype, /** @lends orion.git.GitCommitHelper.prototype */ {
		handleError: function(error) {
			var display = {};
			display.Severity = "Error"; //$NON-NLS-0$
			display.HTML = false;
			try {
				var resp = JSON.parse(error.responseText);
				display.Message = resp.DetailedMessage ? resp.DetailedMessage : resp.Message;
			} catch (Exception) {
				display.Message = error.DetailedMessage || error.Message || error.message;
			}
			//this.statusService.setProgressResult(display);
			
		},
		destroy: function() {
			this.destroyDiffs();
			if (this._inner_node && this._inner_node.parentNode) {
				this._inner_node.parentNode.removeChild(this._inner_node);
			}
			this._inner_node = null;
		},
		destroyDiffs: function() {
			if (this.diffsNavigator) {
				this.diffsNavigator.destroy();
				this.diffsNavigator = null;
			}
			if (this.diffsSection) {
				this.diffsSection.destroy();
				this.diffsSection = null;
			}
		},
		displayDiffs: function(commit, location, commitName, title) {
			this.destroy();
			this._parent = lib.node(this.parentId);
			this._inner_node = document.createElement("div"); //$NON-NLS-0$
			this._inner_node.classList.add("commit_browse_inner_container"); //$NON-NLS-0$
			this._parent.appendChild(this._inner_node);
			var parent = this._inner_node;
			var section = this.diffsSection = new mSection.Section(parent, {
				id : "diffSection", //$NON-NLS-0$
				title : title || messages["CommitChanges"],
				content : '<div id="diffNode"></div>', //$NON-NLS-0$
				canHide : false,
				noTwistie: true,
				preferencesService : this.preferencesService
			});
	
			var explorer = this.diffsNavigator = new mGitChangeList.GitChangeListExplorer({
				serviceRegistry: this._serviceRegistry,
				commandRegistry: this._commandRegistry,
				selection: null,
				parentId:"diffNode", //$NON-NLS-0$
				actionScopeId: "diffSectionItemActionArea", //$NON-NLS-0$
				prefix: "diff", //$NON-NLS-0$
				//repository: repository,
				commit: commit,
				changes: commit ? commit.Diffs : null,
				location: location,
				commitName: commitName,
				section: section,
				gitClient: this.gitClient,
				progressService: this.progressService,
				preferencesService: this.preferencesService,
				standAloneOptions: {
					highlighters: [new mStaticDataSource.SyntaxHighlighter(), new mStaticDataSource.SyntaxHighlighter()] 
				},
				handleError: this.handleError.bind(this)
			});
			return explorer.display();
		}
	});
	
	return {
		GitCommitHelper: GitCommitHelper
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License v1.0
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
define('orion/serviceregistry',["orion/Deferred", "orion/EventTarget"], function(Deferred, EventTarget) {

	/**
	 * @name orion.serviceregistry.ServiceReference
	 * @description Creates a new service reference.
	 * @class A reference to a service in the Orion service registry
	 * @param {String} serviceId The symbolic id of this service instance
	 * @param {String} name The service name
	 * @param {Object} properties A JSON object containing the service's declarative properties
	 */
	function ServiceReference(serviceId, objectClass, properties) {
		this._properties = properties || {};
		this._properties["service.id"] = serviceId;
		this._properties.objectClass = objectClass;
		this._properties["service.names"] = objectClass;
	}

	ServiceReference.prototype = /** @lends orion.serviceregistry.ServiceReference.prototype */
	{
		/**
		 * @name getPropertyKeys
		 * @description Returns the names of the declarative properties of this service.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceReference.prototype
		 * @returns the names of the declarative properties of this service
		 */
		getPropertyKeys: function() {
			var result = [];
			var name;
			for (name in this._properties) {
				if (this._properties.hasOwnProperty(name)) {
					result.push(name);
				}
			}
			return result;
		},
		/**
		 * @name getProperty
		 * @description Returns the declarative service property with the given name, or <code>undefined</code>
		 * if this service does not have such a property.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceReference.prototype
		 * @param {String} propertyName The name of the service property to return
		 * @returns The {String} property with the given name or <code>undefined</code>
		 */
		getProperty: function(propertyName) {
			return this._properties[propertyName];
		}
	};
	ServiceReference.prototype.constructor = ServiceReference;

	/**
	 * @name orion.serviceregistry.ServiceRegistration
	 * @description Creates a new service registration. This constructor is private and should only be called by the service registry.
	 * @class A reference to a registered service in the Orion service registry
	 * @param {String} serviceId The symbolic id of this service
	 * @param {String} serviceReference A reference to the service
	 * @param {Object} internalRegistry A JSON object containing the service's declarative properties
	 */
	function ServiceRegistration(serviceId, serviceReference, internalRegistry) {
		this._serviceId = serviceId;
		this._serviceReference = serviceReference;
		this._internalRegistry = internalRegistry;
	}

	ServiceRegistration.prototype = /** @lends orion.serviceregistry.ServiceRegistration.prototype */
	{
		/**
		 * @name unregister
		 * @description Unregister this service registration. Clients registered for <code>unregistering</code> service events
		 * will be notified of this change.
		 * @function
		 * @private
		 * @memberof orion.serviceregistry.ServiceRegistration.prototype
		 */
		unregister: function() {
			this._internalRegistry.unregisterService(this._serviceId);
		},

		/**
		 * @name getReference
		 * @description Returns the {@link orion.serviceregistry.ServiceReference} in this registration
		 * @function
		 * @private
		 * @memberof orion.serviceregistry.ServiceRegistration.prototype
		 * @param properties
		 * @returns the {@link orion.serviceregistry.ServiceReference} in this registration
		 * @throws An error is the service has been unregistered
		 */
		getReference: function() {
			if (!this._internalRegistry.isRegistered(this._serviceId)) {
				throw new Error("Service has already been unregistered: "+this._serviceId);
			}
			return this._serviceReference;
		},
		/**
		 * @name setProperties
		 * @description Sets the properties of this registration to the new given properties. Clients registered for <code>modified</code> service events
		 * will be notified of the change.
		 * @function
		 * @private
		 * @memberof orion.serviceregistry.ServiceRegistration.prototype
		 * @param {Object} properties
		 */
		setProperties: function(properties) {
			var oldProperties = this._serviceReference._properties;
			this._serviceReference._properties = properties || {};
			properties["service.id"] = this._serviceId;
			properties.objectClass = oldProperties.objectClass;
			properties["service.names"] = oldProperties["service.names"];
			this._internalRegistry.modifyService(this._serviceId);
		}
	};
	ServiceRegistration.prototype.constructor = ServiceRegistration;

	/**
	 * @name orion.serviceregistry.DeferredService
	 * @description Creates a new service promise to resolve the service at a later time.
	 * @class A service that is resolved later
	 * @private
	 * @param {orion.serviceregistry.ServiceReference} implementation The implementation of the service
	 * @param {Function} isRegistered A function to call to know if the service is already registered
	 */
	function DeferredService(implementation, isRegistered) {

		function _createServiceCall(methodName) {
			return function() {
					var d;
					try {
						if (!isRegistered()) {
							throw new Error("Service was unregistered");
						}
						var result = implementation[methodName].apply(implementation, Array.prototype.slice.call(arguments));
						if (result && typeof result.then === "function") {
							return result;
						} else {
							d = new Deferred();
							d.resolve(result);
						}
					} catch (e) {
							d = new Deferred();
							d.reject(e);
					}
					return d.promise;
			};
		}

		var method;
		for (method in implementation) {
			if (typeof implementation[method] === 'function') {
				this[method] = _createServiceCall(method);
			}
		}
	}

	/**
	 * @name orion.serviceregistry.ServiceEvent
	 * @description An event that is fired from the service registry. Clients must register to listen to events using 
	 * the {@link orion.serviceregistry.ServiceRegistry#addEventListener} function.
	 * <br> 
	 * There are three types of events that this registry will send:
	 * <ul>
	 * <li>modified - the service has been modified</li> 
	 * <li>registered - the service has been registered</li> 
	 * <li>unregistering - the service is unregistering</li>
	 * </ul> 
	 * @class A service event
	 * @param {String} type The type of the event, one of <code>modified</code>, <code>registered</code> or <code>unregistered</code>
	 * @param {orion.serviceregistry.ServiceReference} serviceReference the service reference the event is for
	 */
	function ServiceEvent(type, serviceReference) {
		this.type = type;
		this.serviceReference = serviceReference;
	}

	/**
	 * @name orion.serviceregistry.ServiceRegistry
	 * @description Creates a new service registry
	 * @class The Orion service registry
	 */
	function ServiceRegistry() {
		this._entries = [];
		this._namedReferences = {};
		this._serviceEventTarget = new EventTarget();
		var _this = this;
		this._internalRegistry = {
			/**
			 * @name isRegistered
			 * @description Returns if the service with the given identifier is registered or not.
			 * @function
			 * @private
			 * @memberof orion.serviceregistry.ServiceRegistry
			 * @param {String} serviceId the identifier of the service
			 * @returns <code>true</code> if the service with the given identifier is registered, <code>false</code> otherwise
			 */
			isRegistered: function(serviceId) {
				return _this._entries[serviceId] ? true : false;
			},
			
			/**
			 * @name unregisterService
			 * @description Unregisters a service with the given identifier. This function will notify
			 * clients registered for <code>unregistering</code> service events.
			 * @function
			 * @private
			 * @memberof orion.serviceregistry.ServiceRegistry
			 * @param {String} serviceId the identifier of the service
			 * @throws An error if the service has already been unregistered
			 * @see orion.serviceregistry.ServiceEvent
			 */
			unregisterService: function(serviceId) {
				var entry = _this._entries[serviceId];
				if (!entry) {
					throw new Error("Service has already been unregistered: "+serviceId);
				}
				var reference = entry.reference;
				_this._serviceEventTarget.dispatchEvent(new ServiceEvent("unregistering", reference));
				_this._entries[serviceId] = null;
				var objectClass = reference.getProperty("objectClass");
				objectClass.forEach(function(type) {
					var namedReferences = _this._namedReferences[type];
					for (var i = 0; i < namedReferences.length; i++) {
						if (namedReferences[i] === reference) {
							if (namedReferences.length === 1) {
								delete _this._namedReferences[type];
							} else {
								namedReferences.splice(i, 1);
							}
							break;
						}
					}
				});
			},
			/**
			 * @name modifyService
			 * @description Notifies that the service with the given identifier has been modified. This function will notify clients
			 * registered for <code>modified</code> service events.
			 * @function
			 * @private
			 * @memberof orion.serviceregistry.ServiceRegistry
			 * @param {String} serviceId the identifier of the service
			 * @throws An error if the service for the given identifier does not exist
			 * @see orion.serviceregistry.ServiceEvent
			 */
			modifyService: function(serviceId) {
				var entry = _this._entries[serviceId];
				if (!entry) {
					throw new Error("Service not found while trying to send modified event: "+serviceId);
				}
				var reference = entry.reference;
				_this._serviceEventTarget.dispatchEvent(new ServiceEvent("modified", reference));
			}
		};
	}

	ServiceRegistry.prototype = /** @lends orion.serviceregistry.ServiceRegistry.prototype */
	{
		/**
		 * @name getService
		 * @description Returns the service with the given name or reference.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceRegistry.prototype
		 * @param {String|orion.serviceregistry.ServiceReference} nameOrServiceReference The service name or a service reference
		 * @returns {orion.serviceregistry.ServiceReference|null} The service implementation, or <code>null</code> if no such service was found.
		 */
		getService: function(typeOrServiceReference) {
			var service;
			if (typeof typeOrServiceReference === "string") {
				var references = this._namedReferences[typeOrServiceReference];
				if (references) {
					references.some(function(reference) {
						service = this._entries[reference.getProperty("service.id")].service;
						return !!service;
					}, this);
				}
			} else {
				var entry = this._entries[typeOrServiceReference.getProperty("service.id")];
				if (entry) {
					service = entry.service;
				}
			}
			return service || null;
		},

		/**
		 * @name getServiceReferences
		 * @description Returns all references to the service with the given name.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceRegistry.prototype
		 * @param {String} name The name of the service to return
		 * @returns {orion.serviceregistry.ServiceReference[]} An array of service references
		 */
		getServiceReferences: function(name) {
			if (name) {
				return this._namedReferences[name] ? this._namedReferences[name] : [];
			}
			var result = [];
			this._entries.forEach(function(entry) {
				if (entry) {
					result.push(entry.reference);
				}
			});
			return result;
		},
		
		/**
		 * @name registerService
		 * @description Registers a service with this registry. This function will notify clients registered
		 * for <code>registered</code> service events.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceRegistry.prototype
		 * @param {String|String[]} names the name or names of the service being registered
		 * @param {Object} service The service implementation
		 * @param {Object} properties A JSON collection of declarative service properties
		 * @returns {orion.serviceregistry.ServiceRegistration} A service registration object for the service.
		 * @see orion.serviceregistry.ServiceEvent
		 */
		registerService: function(names, service, properties) {
			if (typeof service === "undefined" ||  service === null) {
				throw new Error("invalid service");
			}

			if (typeof names === "string") {
				names = [names];
			} else if (!Array.isArray(names)) {
				names = [];
			}

			var serviceId = this._entries.length;
			var reference = new ServiceReference(serviceId, names, properties);
			var namedReferences = this._namedReferences;
			names.forEach(function(name) {
				namedReferences[name] = namedReferences[name] || [];
				namedReferences[name].push(reference);
			});
			var deferredService = new DeferredService(service, this._internalRegistry.isRegistered.bind(null, serviceId));
			this._entries.push({
				reference: reference,
				service: deferredService
			});
			var internalRegistry = this._internalRegistry;
			this._serviceEventTarget.dispatchEvent(new ServiceEvent("registered", reference));
			return new ServiceRegistration(serviceId, reference, internalRegistry);
		},

		/**
		 * @name addEventListener
		 * @description Adds a listener for events on this registry.
		 * <br> 
		 * The events that this registry notifies about:
		 * <ul>
		 * <li>modified - the service has been modified</li> 
		 * <li>registered - the service has been registered</li> 
		 * <li>unregistering - the service is unregistering</li> 
		 * </ul> 
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceRegistry.prototype
		 * @param {String} eventName The name of the event to be notified about.
		 * @param {Function} listener The listener to add
		 * @see orion.serviceregistry.ServiceEvent
		 */
		addEventListener: function(eventName, listener) {
			this._serviceEventTarget.addEventListener(eventName, listener);
		},

		/**
		 * @name removeEventListener
		 * @description Removes a listener for service events in this registry.
		 * @function
		 * @public
		 * @memberof orion.serviceregistry.ServiceRegistry.prototype
		 * @param {String} eventName The name of the event to stop listening for
		 * @param {Function} listener The listener to remove
		 * @see orion.serviceregistry.ServiceEvent
		 */
		removeEventListener: function(eventName, listener) {
			this._serviceEventTarget.removeEventListener(eventName, listener);
		}
	};
	ServiceRegistry.prototype.constructor = ServiceRegistry;

	//return the module exports
	return {
		ServiceRegistry: ServiceRegistry
	};
});

/*******************************************************************************
 * @license
 * Copyright (c) 2010, 2014 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/

/*eslint-env browser, amd*/
/*global URL*/
define('orion/pluginregistry',["orion/Deferred", "orion/EventTarget", "orion/URL-shim"], function(Deferred, EventTarget) {

    function _equal(obj1, obj2) {
        var keys1 = Object.keys(obj1);
        var keys2 = Object.keys(obj2);
        if (keys1.length !== keys2.length) {
            return false;
        }
        keys1.sort();
        keys2.sort();
        for (var i = 0, len = keys1.length; i < len; i++) {
            var key = keys1[i];
            if (key !== keys2[i]) {
                return false;
            }
            var value1 = obj1[key],
                value2 = obj2[key];
            if (value1 === value2) {
                continue;
            }
            if (JSON.stringify(value1) !== JSON.stringify(value2)) {
                return false;
            }
        }
        return true;
    }

    var httpOrHttps = new RegExp("^http[s]?", "i");

    function _normalizeURL(url) {
        if (url.indexOf("://") === -1) { //$NON-NLS-0$
            try {
                return new URL(url, location.href).href;
            } catch (e) {
                // URL SyntaxError, etc.
            }
        }
        return url;
    }

    function _asStorage(obj) {
        var _keys = null;

        function _getKeys() {
            return (_keys = _keys || Object.keys(obj));
        }

        var result = {
            key: function(index) {
                return _getKeys()[index];
            },
            getItem: function(key) {
                return obj[key];
            },
            setItem: function(key, value) {
                obj[key] = value;
                _keys = null;
            },
            removeItem: function(key) {
                delete obj[key];
                _keys = null;
            },
            clear: function() {
                _getKeys().forEach(function(key) {
                    delete obj[key];
                }.bind(this));
                _keys = null;
            }
        };
        Object.defineProperty(result, "length", {
            get: function() {
                return _getKeys().length;
            }
        });
        return result;
    }

    function _jsonXMLHttpRequestReplacer(name, value) {
        if (value && value instanceof XMLHttpRequest) {
            var status, statusText;
            try {
                status = value.status;
                statusText = value.statusText;
            } catch (e) {
                // https://bugs.webkit.org/show_bug.cgi?id=45994
                status = 0;
                statusText = ""; //$NON-NLS-0
            }
            return {
                status: status || 0,
                statusText: statusText
            };
        }
        return value;
    }

    function _serializeError(error) {
        var result = error ? JSON.parse(JSON.stringify(error, _jsonXMLHttpRequestReplacer)) : error; // sanitizing Error object
        if (error instanceof Error) {
            result.__isError = true;
            result.message = result.message || error.message;
            result.name = result.name || error.name;
        }
        return result;
    }

    function PluginEvent(type, plugin) {
        this.type = type;
        this.plugin = plugin;
    }

    function ObjectReference(objectId, methods) {
        this.__objectId = objectId;
        this.__methods = methods;
    }

    /**
     * Creates a new plugin. This constructor is private and should only be called by the plugin registry.
     * @class Represents a single plugin in the plugin registry.
     * @description
     * <p>At any given time, a plugin is in exactly one of the following six states:</p>
     *
     * <dl>
     *
     * <dt><code>"uninstalled"</code></dt>
     * <dd>The plugin has been uninstalled and may not be used.
     * <p>The <code>uninstalled</code> state is only visible after a plugin has been uninstalled; the plugin is unusable, but
     * references to its <code>Plugin</code> object may still be available and used for introspection.
     * </dd>
     *
     * <dt><code>"installed"</code></dt>
     * <dd>The plugin is installed, but not yet resolved.
     * <p></p>
     * </dd>
     *
     * <dt><code>"resolved"</code></dt>
     * <dd>The plugin is resolved and is able to be started.
     * <p>Note that the plugin is not active yet. A plugin must be in the <code>resolved</code> state before it can be started.</p>
     * <p>The <code>resolved</code> state is reserved for future use. Future versions of the framework may require successful
     * dependency resolution before moving a plugin to the <code>resolved</code> state.</p>
     * </dd>
     *
     * <dt><code>"starting"</code></dt>
     * <dd>The plugin is in the process of starting.
     * <p>A plugin is in the <code>starting</code> state when its {@link #start} method has been called but has not yet resolved.
     * Once the start call resolves, the plugin has successfully started and moves to the <code>active</code> state.</p>
     * <p>If the plugin has a lazy activation policy, it may remain in the <code>starting</code> state for some time until the
     * activation is triggered.</p>
     * </dd>
     *
     * <dt><code>"stopping"</code></dt>
     * <dd>The plugin is in the process of stopping. 
     * <p>A plugin is in the <code>stopping</code> state when its {@link #stop} method has been called but not yet resolved.
     * Once the stop call resolves, the plugin moves to the <code>resolved</code> state.</dd>
     *
     * <dt><code>"active"</code></dt>
     * <dd>The plugin is running. It has been successfully started and activated.
     * <p>In the <code>active</code> state, any services the plugin provides are available for use.</p></dd>
     *
     * </dl>
     *
     * @name orion.pluginregistry.Plugin
     */
    function Plugin(_url, _manifest, _internalRegistry) {
        var _this = this;
        _manifest = _manifest || {};
        var _created = _manifest.created || new Date().getTime();
        var _headers = _manifest.headers || {};
        var _services = _manifest.services || [];
        var _autostart = _manifest.autostart;
        var _lastModified = _manifest.lastModified || 0;

        var _state = "installed";

        var _deferredStateChange;
        var _deferredLoad;

        var _channel;
        var _parent;
        var _remoteServices = {};

        var _currentMessageId = 0;
        var _currentObjectId = 0;
        //var _currentServiceId = 0; not supported yet...

        var _requestReferences = {};
        var _responseReferences = {};
        var _objectReferences = {};
        var _serviceReferences = {};


        function _notify(message) {
            if (!_channel) {
                return;
            }
            _internalRegistry.postMessage(message, _channel);
        }

        function _request(message) {
            if (!_channel) {
                return new Deferred().reject(new Error("plugin not connected"));
            }

            message.id = String(_currentMessageId++);
            var d = new Deferred();
            _responseReferences[message.id] = d;
            d.then(null, function(error) {
                if (_state === "active" && error instanceof Error && error.name === "Cancel") {
                    _notify({
                        requestId: message.id,
                        method: "cancel",
                        params: error.message ? [error.message] : []
                    });
                }
            });

            var toString = Object.prototype.toString;
            message.params.forEach(function(param, i) {
                if (toString.call(param) === "[object Object]" && !(param instanceof ObjectReference)) {
                    var candidate, methods;
                    for (candidate in param) {
                        if (toString.call(param[candidate]) === "[object Function]") {
                            methods = methods || [];
                            methods.push(candidate);
                        }
                    }
                    if (methods) {
                        var objectId = _currentObjectId++;
                        _objectReferences[objectId] = param;
                        var removeReference = function() {
                            delete _objectReferences[objectId];
                        };
                        d.then(removeReference, removeReference);
                        message.params[i] = new ObjectReference(objectId, methods);
                    }
                }
            });
            _internalRegistry.postMessage(message, _channel);
            return d.promise;
        }

        function _throwError(messageId, error) {
            if (messageId || messageId === 0) {
                _notify({
                    id: messageId,
                    result: null,
                    error: error
                });
            } else {
                console.log(error);
            }

        }

        function _callMethod(messageId, implementation, method, params) {
            params.forEach(function(param, i) {
                if (param && typeof param.__objectId !== "undefined") {
                    var obj = {};
                    param.__methods.forEach(function(method) {
                        obj[method] = function() {
                            return _request({
                                objectId: param.__objectId,
                                method: method,
                                params: Array.prototype.slice.call(arguments)
                            });
                        };
                    });
                    params[i] = obj;
                }
            });

            var response = typeof messageId === undefined ? null : {
                id: messageId,
                result: null,
                error: null
            };
            try {
                var promiseOrResult = method.apply(implementation, params);
                if (!response) {
                    return;
                }

                if (promiseOrResult && typeof promiseOrResult.then === "function") { //$NON-NLS-0$
                    _requestReferences[messageId] = promiseOrResult;
                    promiseOrResult.then(function(result) {
                        delete _requestReferences[messageId];
                        response.result = result;
                        _notify(response);
                    }, function(error) {
                        if (_requestReferences[messageId]) {
                            delete _requestReferences[messageId];
                            response.error = _serializeError(error);
                            _notify(response);
                        }
                    }, function() {
                        _notify({
                            responseId: messageId,
                            method: "progress",
                            params: Array.prototype.slice.call(arguments)
                        }); //$NON-NLS-0$
                    });
                } else {
                    response.result = promiseOrResult;
                    _notify(response);
                }
            } catch (error) {
                if (response) {
                    response.error = _serializeError(error);
                    _notify(response);
                }
            }
        }


        var _update; // this is a forward reference to a function declared above this.update

        function _messageHandler(message) {
            try {
                if (message.method) { // request
                    var method = message.method,
                        params = message.params || [];
                    if ("serviceId" in message) {
                        var service = _serviceReferences[message.serviceId];
                        if (!service) {
                            _throwError(message.id, "service not found");
                        }
                        if (method in service) {
                            _callMethod(message.id, service, service[method], params);
                        } else {
                            _throwError(message.id, "method not found");
                        }
                    } else if ("objectId" in message) {
                        var object = _objectReferences[message.objectId];
                        if (!object) {
                            _throwError(message.id, "object not found");
                        }
                        if (method in object) {
                            _callMethod(message.id, object, object[method], params);
                        } else {
                            _throwError(message.id, "method not found");
                        }
                    } else if ("requestId" in message) {
                        var request = _requestReferences[message.requestId];
                        if (request && method === "cancel" && request.cancel) {
                            request.cancel.apply(request, params);
                        }
                    } else if ("responseId" in message) {
                        var response = _responseReferences[message.responseId];
                        if (response && method === "progress" && response.progress) {
                            response.progress.apply(response, params);
                        }
                    } else if ("loading" === message.method) {
                        _channel.loading();
                    } else {
                        if ("plugin" === message.method) { //$NON-NLS-0$
                        	_channel.connected();
                            var manifest = message.params[0];
                            _update({
                                headers: manifest.headers,
                                services: manifest.services
                            }).then(function() {
                            	if (_deferredLoad) {
                                	_deferredLoad.resolve(_this);
                                }
                            });
                        } else if ("timeout" === message.method) {
                            if (_deferredLoad) {
                                _deferredLoad.reject(message.error);
                            }
                        } else {
                            throw new Error("Bad method: " + message.method);
                        }
                    }
                } else {
                    var deferred = _responseReferences[String(message.id)];
                    delete _responseReferences[String(message.id)];
                    if (message.error) {
                        var error = _internalRegistry.handleServiceError(_this, message.error);
                        deferred.reject(error);
                    } else {
                        deferred.resolve(message.result);
                    }
                }
            } catch (e) {
                console.log("Plugin._messageHandler " + e);
            }
        }

        function _createServiceProxy(service) {
            var serviceProxy = {};
            if (service.methods) {
                service.methods.forEach(function(method) {
                    serviceProxy[method] = function() {
                        var message = {
                            serviceId: service.serviceId,
                            method: method,
                            params: Array.prototype.slice.call(arguments)
                        };
                        if (_state === "active") {
                            return _request(message);
                        } else {
                            return _this.start({
                                "transient": true
                            }).then(function() {
                                return _request(message);
                            });
                        }
                    };
                });

                if (serviceProxy.addEventListener && serviceProxy.removeEventListener) {
                    var eventTarget = new EventTarget();
                    var objectId = _currentObjectId++;
                    _objectReferences[objectId] = {
                        handleEvent: eventTarget.dispatchEvent.bind(eventTarget)
                    };
                    var listenerReference = new ObjectReference(objectId, ["handleEvent"]);

                    var _addEventListener = serviceProxy.addEventListener;
                    serviceProxy.addEventListener = function(type, listener) {
                        if (!eventTarget._namedListeners[type]) {
                            _addEventListener(type, listenerReference);
                        }
                        eventTarget.addEventListener(type, listener);
                    };
                    var _removeEventListener = serviceProxy.removeEventListener;
                    serviceProxy.removeEventListener = function(type, listener) {
                        eventTarget.removeEventListener(type, listener);
                        if (!eventTarget._namedListeners[type]) {
                            _removeEventListener(type, listenerReference);
                        }
                    };
                }
            }
            return serviceProxy;
        }

        function _createServiceProperties(service) {
            var properties = JSON.parse(JSON.stringify(service.properties));
            properties.__plugin__ = _url; //TODO: eliminate
            var objectClass = service.names || service.type || [];
            if (!Array.isArray(objectClass)) {
                objectClass = [objectClass];
            }
            properties.objectClass = objectClass;
            return properties;
        }

        function _registerService(service) {
            var serviceProxy = _createServiceProxy(service);
            var properties = _createServiceProperties(service);
            var registration = _internalRegistry.registerService(service.names || service.type, serviceProxy, properties);
            _remoteServices[service.serviceId] = {
                registration: registration,
                proxy: serviceProxy
            };
        }

        function _persist() {
            _internalRegistry.persist(_url, {
                created: _created,
                headers: _headers,
                services: _services,
                autostart: _autostart,
                lastModified: _lastModified
            });
        }
        
        this._default = false; // used to determine if a plugin is part of the configuration

        this._persist = _persist;

        this._resolve = function() {
            // check manifest dependencies when we support them
            _state = "resolved";
            _internalRegistry.dispatchEvent(new PluginEvent("resolved", _this));
        };

        this._getAutostart = function() {
            return _autostart;
        };

        this._getCreated = function() {
            return _created;
        };

        /**
         * Returns the URL location of this plugin.
         * @name orion.pluginregistry.Plugin#getLocation
         * @return {String} The URL of this plugin.
         * @function
         */
        this.getLocation = function() {
            return _url;
        };

        /**
         * Returns the headers of this plugin.
         * @name orion.pluginregistry.Plugin#getHeaders
         * @return {Object} The plugin headers.
         * @function
         */
        this.getHeaders = function() {
            return JSON.parse(JSON.stringify(_headers));
        };

        this.getName = function() {
            var headers = this.getHeaders();
            if (headers) {
                return headers.name || "";
            }
            return null;
        };

        this.getVersion = function() {
            var headers = this.getHeaders();
            if (headers) {
                return headers.version || "0.0.0";
            }
            return null;
        };

        this.getLastModified = function() {
            return _lastModified;
        };

        /**
         * Returns the service references provided by this plugin.
         * @name orion.pluginregistry.Plugin#getServiceReferences
         * @return {orion.serviceregistry.ServiceReference[]} The service references provided by this plugin.
         * @function 
         */
        this.getServiceReferences = function() {
            var result = [];
            Object.keys(_remoteServices).forEach(function(serviceId) {
                result.push(_remoteServices[serviceId].registration.getReference());
            });
            return result;
        };

        /**
         * Sets the parent of this plugin.
         * @name orion.pluginregistry.Plugin#setParent
         * @param {DOMElement} [parent=null] the plugin parent. <code>null</code> puts the plugin in the default parent of the plugin registry
         * @return {orion.Promise} A promise that will resolve when the plugin parent has been set.
         * @function 
         */
        this.setParent = function(parent) {
        	if (_parent !== parent) {
        		_parent = parent;
        		return _this.stop({
                    "transient": true
                }).then(function() {
					if ("started" === _autostart) {
		                return _this.start({
		                    "transient": true
		                });
					} else if ("lazy" === _autostart) {
                		return _this.start({	
                    		"lazy": true,
							"transient": true
						});
            		}
				});	
			}
			return new Deferred().resolve();
        };

        /**
         * Returns this plugin's current state.
         * @name orion.pluginregistry.Plugin#getState
         * @returns {String} This plugin's state.
         * @function
         */
        this.getState = function() {
            return _state;
        };
        
         /**
         * @name orion.pluginregistry.Plugin#getProblemLoading
         * @description Returns true if there was a problem loading this plug-in, false otherwise. This function is not API and may change in future releases.
         * @private
         * @function
         * @returns {String} Return an true if there was a problem loading this plug-in.
         */
        this.getProblemLoading = function() {
            if (_this._problemLoading){
            	return true;
            }
            return false;
        };

        this.start = function(optOptions) {
            if (_state === "uninstalled") {
                return new Deferred().reject(new Error("Plugin is uninstalled"));
            }

            if (_deferredStateChange) {
                return _deferredStateChange.promise.then(this.start.bind(this, optOptions));
            }

            if (_state === "active") {
                return new Deferred().resolve();
            }

            if (!optOptions || !optOptions.transient) {
                var autostart = optOptions && optOptions.lazy ? "lazy" : "started";
                if (autostart !== _autostart) {
                    _autostart = autostart;
                    _persist();
                }
            }

            var frameworkState = _internalRegistry.getState();
            if (frameworkState !== "starting" && frameworkState !== "active") {
                if (optOptions.transient) {
                    return new Deferred().reject(new Error("start transient error"));
                }
                return new Deferred().resolve();
            }

            if (_state === "installed") {
                try {
                    this._resolve();
                } catch (e) {
                    return new Deferred().reject(e);
                }
            }

            if (_state === "resolved") {
                _services.forEach(function(service) {
                    _registerService(service);
                });
            }

            if (optOptions && optOptions.lazy) {
                if (_state !== "starting") {
                    _state = "starting";
                    _internalRegistry.dispatchEvent(new PluginEvent("lazy activation", _this));
                }
                return new Deferred().resolve();
            }
            
            var deferredStateChange = new Deferred();
            _deferredStateChange = deferredStateChange;
            _state = "starting";
            _this._problemLoading = null;
            _internalRegistry.dispatchEvent(new PluginEvent("starting", _this));
            _deferredLoad = new Deferred();
            _channel = _internalRegistry.connect(_url, _messageHandler, _parent);
            _deferredLoad.then(function() {
                _deferredLoad = null;
                _state = "active";
                _internalRegistry.dispatchEvent(new PluginEvent("started", _this));
                _deferredStateChange = null;
                deferredStateChange.resolve();
            }, function() {
                _deferredLoad = null;
                _state = "stopping";
                _internalRegistry.dispatchEvent(new PluginEvent("stopping", _this));
                Object.keys(_remoteServices).forEach(function(serviceId) {
                    _remoteServices[serviceId].registration.unregister();
                    delete _remoteServices[serviceId];
                });
                _internalRegistry.disconnect(_channel);
                _channel = null;
                _state = "resolved";
                _deferredStateChange = null;
                _internalRegistry.dispatchEvent(new PluginEvent("stopped", _this));
                _this._problemLoading = true;
                deferredStateChange.reject(new Error("Failed to load plugin: " + _url));
                if (_this._default) {
                	_lastModified = 0;
                	_persist();
                }
            });
            return deferredStateChange.promise;
        };

        this.stop = function(optOptions) {
            if (_state === "uninstalled") {
                return new Deferred().reject(new Error("Plugin is uninstalled"));
            }

            if (_deferredStateChange) {
                return _deferredStateChange.promise.then(this.stop.bind(this, optOptions));
            }

            if (!optOptions || !optOptions.transient) {
                if ("stopped" !== _autostart) {
                    _autostart = "stopped";
                    _persist();
                }
            }

            if (_state !== "active" && _state !== "starting") {
                return new Deferred().resolve();
            }

            var deferredStateChange = new Deferred();
            _deferredStateChange = deferredStateChange;

            _state = "stopping";
            _internalRegistry.dispatchEvent(new PluginEvent("stopping", _this));
            Object.keys(_remoteServices).forEach(function(serviceId) {
                _remoteServices[serviceId].registration.unregister();
                delete _remoteServices[serviceId];
            });
            if (_channel) {
                _internalRegistry.disconnect(_channel);
                _channel = null;
            }
            _state = "resolved";
            _deferredStateChange = null;
            _internalRegistry.dispatchEvent(new PluginEvent("stopped", _this));
            deferredStateChange.resolve();

            return deferredStateChange.promise;
        };

        _update = function(input) {
        	_this.problemLoading = null;
        	
            if (_state === "uninstalled") {
                return new Deferred().reject(new Error("Plugin is uninstalled"));
            }

            if (!input) {
                if (_lastModified === 0) {
                    _lastModified = new Date().getTime();
                    _persist();
                }
                return _internalRegistry.loadManifest(_url).then(_update, function() {
                	_this._problemLoading = true;
                	if (_this._default) {
                		_lastModified = 0;
                		_persist();
                	}
                	console.log("Failed to load plugin: " + _url);
                });
            }

            var oldHeaders = _headers;
            var oldServices = _services;
            var oldAutostart = _autostart;
            _headers = input.headers || {};
            _services = input.services || [];
            _autostart = input.autostart || _autostart;

            if (input.lastModified) {
                _lastModified = input.lastModified;
            } else {
                _lastModified = new Date().getTime();
                _persist();
            }

            if (_equal(_headers, oldHeaders) && _equal(_services, oldServices) && _autostart === oldAutostart) {
                return new Deferred().resolve();
            }

            if (_state === "active" || _state === "starting") {
                var serviceIds = [];
                Object.keys(_services).forEach(function(serviceId) {
                    var service = _services[serviceId];
                    serviceIds.push(serviceId);
                    var remoteService = _remoteServices[serviceId];
                    if (remoteService) {
                        if (_equal(service.methods, Object.keys(remoteService.proxy))) {
                            var properties = _createServiceProperties(service);
                            var reference = remoteService.registration.getReference();
                            var currentProperties = {};
                            reference.getPropertyKeys().forEach(function(name) {
                                currentProperties[name] = reference.getProperty(name);
                            });
                            if (!_equal(properties, currentProperties)) {
                                remoteService.registration.setProperties(properties);
                            }
                            return;
                        }
                        remoteService.registration.unregister();
                        delete _remoteServices[serviceId];
                    }
                    _registerService(service);
                });
                Object.keys(_remoteServices).forEach(function(serviceId) {
                    if (serviceIds.indexOf(serviceId) === -1) {
                        _remoteServices[serviceId].registration.unregister();
                        delete _remoteServices[serviceId];
                    }
                });
            }

            if (_state === "active") {
                _internalRegistry.disconnect(_channel);
                _deferredLoad = new Deferred();
                _channel = _internalRegistry.connect(_url, _messageHandler, _parent);
                _deferredLoad.then(function() {
                    _deferredLoad = null;
                }, function() {
                    _deferredLoad = null;
                    _state = "stopping";
                    _internalRegistry.dispatchEvent(new PluginEvent("stopping"), _this);
                    Object.keys(_remoteServices).forEach(function(serviceId) {
                        _remoteServices[serviceId].registration.unregister();
                        delete _remoteServices[serviceId];
                    });
                    _internalRegistry.disconnect(_channel);
                    _channel = null;
                    _state = "resolved";
                    _internalRegistry.dispatchEvent(new PluginEvent("stopped", _this));
                });
            }
            return new Deferred().resolve();
        };

        this.update = function(input) {
            return _update(input).then(function() {
                _internalRegistry.dispatchEvent(new PluginEvent("updated", _this));
            });
        };

        /**
         * Uninstalls this plugin.
         * @name orion.pluginregistry.Plugin#uninstall
         * @return {orion.Promise} A promise that will resolve when the plugin has been uninstalled.
         * @function
         */
        this.uninstall = function() {
            if (_state === "uninstalled") {
                return new Deferred().reject(new Error("Plugin is uninstalled"));
            }

            if (_state === "active" || _state === "starting" || _state === "stopping") {
                return this.stop().then(this.uninstall.bind(this), this.uninstall.bind(this));
            }

            _internalRegistry.removePlugin(this);
            _state = "uninstalled";
            _internalRegistry.dispatchEvent(new PluginEvent("uninstalled", _this));
            return new Deferred().resolve();
        };
    }

    /**
     * Dispatched when a plugin has been installed. The type of this event is <code>"installed"</code>.
     * @name orion.pluginregistry.PluginRegistry#installed
     * @event
     */
    /**
     * Dispatched when a plugin has been resolved. The type of this event is <code>"resolved"</code>.
     * @name orion.pluginregistry.PluginRegistry#resolved
     * @event
     */
    /**
     * Dispatched when a plugin is starting due to a lazy activation. The type of this event is <code>"lazy activation"</code>.
     * @name orion.pluginregistry.PluginRegistry#lazy_activation
     * @event
     */
    /**
     * Dispatched when a plugin is starting. The type of this event is <code>"starting"</code>.
     * @name orion.pluginregistry.PluginRegistry#starting
     * @event
     */
    /**
     * Dispatched when a plugin is started. The type of this event is <code>"started"</code>.
     * @name orion.pluginregistry.PluginRegistry#started
     * @event
     */
    /**
     * Dispatched when a plugin is stopping. The type of this event is <code>"stopping"</code>.
     * @name orion.pluginregistry.PluginRegistry#stopping
     * @event
     */
    /**
     * Dispatched when a plugin is stopped. The type of this event is <code>"stopped"</code>.
     * @name orion.pluginregistry.PluginRegistry#stopped
     * @event
     */
    /**
     * Dispatched when a plugin has been updated. The type of this event is <code>"updated"</code>.
     * @name orion.pluginregistry.PluginRegistry#updated
     * @event
     */
    /**
     * Dispatched when a plugin has been uninstalled. The type of this event is <code>"uninstalled"</code>.
     * @name orion.pluginregistry.PluginRegistry#uninstalled
     * @event
     */

    /**
     * Creates a new plugin registry.
     * @class The Orion plugin registry
     * @name orion.pluginregistry.PluginRegistry
     * @description The plugin registry maintains a list of {@link orion.pluginregistry.Plugin}s, which can provide services
     * to the given <code>serviceRegistry</code>.
     *
     * <p>The plugin registry dispatches plugin events when one of its plugins changes state. Each such event contains a
     * <code>plugin</code> field giving the affected {@link orion.pluginregistry.Plugin}.
     * </p>
     *
     * @param {orion.serviceregistry.ServiceRegistry} serviceRegistry The service registry to register plugin-provided services with.
     * @param {Object} [opt_storage=localStorage] Target object to read and write plugin metadata from.
     * @param {Boolean} [opt_visible=false] Whether a loaded plugin's iframe will be displayed. By default it is not displayed.
     * @borrows orion.serviceregistry.EventTarget#addEventListener as #addEventListener
     * @borrows orion.serviceregistry.EventTarget#removeEventListener as #removeEventListener
     */
    function PluginRegistry(serviceRegistry, configuration) {
        configuration = configuration || {};
        var _storage = configuration.storage || localStorage;
        if (!_storage.getItem) {
            _storage = _asStorage(_storage);
        }
        var _state = "installed";
        var _parent;
        var _plugins = [];
        var _channels = [];
        var _pluginEventTarget = new EventTarget();
        var _installing = {};

        var internalRegistry = {
            registerService: serviceRegistry.registerService.bind(serviceRegistry),
            connect: function(url, handler, parent, timeout) {
                var channel = {
                    handler: handler,
                    url: url
                };

                function sendTimeout(message) {
                    var error = new Error(message);
                    error.name = "timeout";
                    handler({
                        method: "timeout",
                        error: error
                    });
                }

                var loadTimeout = setTimeout(sendTimeout.bind(null, "Load timeout for: " + url), timeout || 15000);
                var iframe = document.createElement("iframe"); //$NON-NLS-0$
                iframe.name = url + "_" + new Date().getTime();
                iframe.src = url;
                iframe.onload = function() {
                    clearTimeout(loadTimeout);
                    loadTimeout = setTimeout(sendTimeout.bind(null, "Plugin handshake timeout for: " + url), 5000);
                };
                iframe.sandbox = "allow-scripts allow-same-origin allow-forms"; //$NON-NLS-0$
        		iframe.style.width = iframe.style.height = "100%"; //$NON-NLS-0$
	        	iframe.frameBorder = 0;
                (parent || _parent).appendChild(iframe);
                channel.target = iframe.contentWindow;
                channel.connected = function() {
                	clearTimeout(loadTimeout);
                };
                channel.loading = function() {
                	clearTimeout(loadTimeout);
                	loadTimeout = setTimeout(sendTimeout.bind(null, "Plugin handshake timeout for: " + url), 60000);
                };
                channel.close = function() {
                    clearTimeout(loadTimeout);
                    if (iframe) {
                    	var parent = iframe.parentNode;
                        if (parent) {
                        	parent.removeChild(iframe);
                        }
                        iframe = null;
                    }
                };
                _channels.push(channel);
                return channel;
            },
            disconnect: function(channel) {
                for (var i = 0; i < _channels.length; i++) {
                    if (channel === _channels[i]) {
                        _channels.splice(i, 1);
                        try {
                            channel.close();
                        } catch (e) {
                            // best effort
                        }
                        break;
                    }
                }
            },
            removePlugin: function(plugin) {
                for (var i = 0; i < _plugins.length; i++) {
                    if (plugin === _plugins[i]) {
                        _plugins.splice(i, 1);
                        break;
                    }
                }
                _storage.removeItem("plugin." + plugin.getLocation());
            },
            persist: function(url, manifest) {
                _storage.setItem("plugin." + url, JSON.stringify(manifest)); //$NON-NLS-0$
            },
            postMessage: function(message, channel) {
                channel.target.postMessage((channel.useStructuredClone ? message : JSON.stringify(message)), channel.url);
            },
            dispatchEvent: function(event) {
                try {
                    _pluginEventTarget.dispatchEvent(event);
                } catch (e) {
                    if (console) {
                        console.log("PluginRegistry.dispatchEvent " + e);
                    }
                }
            },
            loadManifest: function(url) {
                var d = new Deferred();
                var channel = internalRegistry.connect(url, function(message) {
                    if (!channel || !message.method) {
                        return;
                    }
                    if ("manifest" === message.method || "plugin" === message.method) { //$NON-NLS-0$
                        var manifest = message.params[0];
                        internalRegistry.disconnect(channel);
                        channel = null;
                        d.resolve(manifest);
                    } else if ("timeout" === message.method) {
                        internalRegistry.disconnect(channel);
                        channel = null;
                        d.reject(message.error);
                    }
                });
                return d.promise;
            },
            getState: function() {
                return _state;
            },
            handleServiceError: function(plugin, error) {
                if (error && error.status === 401) {
                    var headers = plugin.getHeaders();
                    var name = plugin.getName() || plugin.getLocation();
                    var span = document.createElement("span");
                    span.appendChild(document.createTextNode("Authentication required for: " + name + "."));
                    if (headers.login) {
                        span.appendChild(document.createTextNode(" "));
                        var anchor = document.createElement("a");
                        anchor.target = "_blank";
                        anchor.textContent = "Login";
                        anchor.href = headers.login;
                        if (!httpOrHttps.test(anchor.href)) {
                            console.log("Illegal Login URL: " + headers.login);
                        } else {
                            span.appendChild(anchor);
                            span.appendChild(document.createTextNode(" and re-try the request."));
                        }
                    }
                    var serializer = new XMLSerializer();
                    return {
                        Severity: "Error",
                        HTML: true,
                        Message: serializer.serializeToString(span)
                    };
                }
                if (error.__isError) {
                    var original = error;
                    error = new Error(original.message);
                    Object.keys(original).forEach(function(key) {
                        error[key] = original[key];
                    });
                    delete error.__isError;
                }
                return error;
            }
        };

        this.getLocation = function() {
            return "System";
        };

        this.getHeaders = function() {
            return {};
        };

        this.getName = function() {
            return "System";
        };

        this.getVersion = function() {
            return "0.0.0";
        };

        this.getLastModified = function() {
            return 0;
        };

        this.getState = internalRegistry.getState;


        function _messageHandler(event) { //$NON-NLS-0$
            var source = event.source;
            _channels.some(function(channel) {
                if (source === channel.target) {
                    try {
                        var message;
                        if (typeof channel.useStructuredClone === "undefined") {
                            var useStructuredClone = typeof event.data !== "string"; //$NON-NLS-0$
                            message = useStructuredClone ? event.data : JSON.parse(event.data);
                            channel.useStructuredClone = useStructuredClone;
                        } else {
                            message = channel.useStructuredClone ? event.data : JSON.parse(event.data);
                        }
                        channel.handler(message);
                    } catch (e) {
                        // not a valid message -- ignore it
                    }
                    return true; // e.g. break
                }
            });
        }


        this.init = function() {
            if (_state === "starting" || _state === "active" || _state === "stopping") {
                return;
            }
            addEventListener("message", _messageHandler, false);
            var storageKeys = [];
            for (var i = 0, length = _storage.length; i < length; i++) {
                storageKeys.push(_storage.key(i));
            }
            storageKeys.forEach(function(key) {
                if (key.indexOf("plugin.") === 0) {
                    var url = key.substring("plugin.".length);
                    var manifest = JSON.parse(_storage.getItem(key));
                    if (manifest.created) {
                        _plugins.push(new Plugin(url, manifest, internalRegistry));
                    }
                }
            });
            _plugins.sort(function(a, b) {
                return a._getCreated() < b._getCreated() ? -1 : 1;
            });
            
            if (configuration.parent) {
            	_parent = configuration.parent;
            } else {
	            _parent = document.createElement("div"); //$NON-NLS-0$
	            if (!configuration.visible) {
                    _parent.style.display = "none"; //$NON-NLS-0$
                    _parent.style.visibility = "hidden"; //$NON-NLS-0$
                }
	            document.body.appendChild(_parent);
            }

            if (configuration.plugins) {
                Object.keys(configuration.plugins).forEach(function(url) {
                    url = _normalizeURL(url);
                    //					if (!httpOrHttps.test(url)) {
                    //						console.log("Illegal Plugin URL: " + url);
                    //						return;
                    //					}
                    var plugin = this.getPlugin(url);
                    if (!plugin) {
                        var manifest = configuration.plugins[url];
                        if (typeof manifest !== "object") {
                        	manifest = {};
                        }
                        manifest.autostart = manifest.autostart || configuration.defaultAutostart || "lazy";
                        plugin = new Plugin(url, manifest, internalRegistry);
                        plugin._default = true;
                        _plugins.push(plugin);
                    } else {
                    	plugin._default = true;
                    }
                }.bind(this));
            }
            _state = "starting";
        };

        /**
         * Starts the plugin registry.
         * @name orion.pluginregistry.PluginRegistry#start
         * @return {orion.Promise} A promise that will resolve when the registry has been fully started.
         * @function 
         */
        this.start = function() {
            if (_state !== "starting") {
                this.init();
            }
            if (_state !== "starting") {
                return new Deferred().reject("Cannot start framework. Framework is already " + _state + ".");
            }
            var deferreds = [];
            var now = new Date().getTime();
            _plugins.forEach(function(plugin) {
                var autostart = plugin._getAutostart();
                if (plugin.getLastModified() === 0) {
                    deferreds.push(plugin.update().then(function() {
                        if ("started" === autostart) {
                            return plugin.start({
                                "transient": true
                            });
                        }
                        if ("lazy" === autostart) {
                            return plugin.start({
                                "lazy": true,
                                    "transient": true
                            });
                        }
                        plugin._resolve();
                    }));
                    return;
                }

                if ("started" === autostart) {
                    deferreds.push(plugin.start({
                        "transient": true
                    }));
                } else if ("lazy" === autostart) {
                    deferreds.push(plugin.start({
                        "lazy": true,
                            "transient": true
                    }));
                    if (now > plugin.getLastModified() + 86400000) { // 24 hours
                        plugin.update();
                    }
                } else {
                    plugin._resolve();
                }
            });
            return Deferred.all(deferreds, function(e) {
                console.log("PluginRegistry.stop " + e);
            }).then(function() {
                _state = "active";
            });
        };

        /**
         * Shuts down the plugin registry.
         * @name orion.pluginregistry.PluginRegistry#stop
         * @function 
         * @returns {orion.Promise} A promise that will resolve when the registry has been stopped.
         */
        this.stop = function() {
            if (_state !== "starting" && _state !== "active") {
                return new Deferred().reject("Cannot stop registry. Registry is already " + _state + ".");
            }
            _state = "stopping";
            var deferreds = [];
            _plugins.forEach(function(plugin) {
                deferreds.push(plugin.stop({
                    "transient": true
                }));
            });
            return Deferred.all(deferreds, function(e) {
                console.log("PluginRegistry.stop " + e);
            }).then(function() {
				if (!configuration.parent) {
            		var parentNode = _parent.parentNode;
            		if (parentNode) {
		            	parentNode.removeChild(_parent);
            		}
            	}
            	_parent = null;
                removeEventListener("message", _messageHandler);
                _state = "resolved";
            });
        };

        this.update = function() {
            this.stop().then(this.start.bind(this));
        };

        this.uninstall = function() {
            return new Deferred().reject("Cannot uninstall registry");
        };


        /**
         * Installs the plugin at the given location into the plugin registry.
         * @name orion.pluginregistry.PluginRegistry#installPlugin
         * @param {String} url The location of the plugin.
         * @param {Object} [optManifest] The plugin metadata.
         * @returns {orion.Promise} A promise that will resolve when the plugin has been installed.
         * @function 
         */
        this.installPlugin = function(url, optManifest) {
            url = _normalizeURL(url);
            //			if (!httpOrHttps.test(url)) {
            //				return new Deferred().reject("Illegal Plugin URL: " + url);
            //			}
            var plugin = this.getPlugin(url);
            if (plugin) {
                return new Deferred().resolve(plugin);
            }

            if (_installing[url]) {
                return _installing[url];
            }

            if (optManifest) {
                plugin = new Plugin(url, optManifest, internalRegistry);
                _plugins.push(plugin);
                plugin._persist();
                internalRegistry.dispatchEvent(new PluginEvent("installed", plugin));
                return new Deferred().resolve(plugin);
            }

            var promise = internalRegistry.loadManifest(url).then(function(manifest) {
                plugin = new Plugin(url, manifest, internalRegistry);
                _plugins.push(plugin);
                plugin._persist();
                delete _installing[url];
                internalRegistry.dispatchEvent(new PluginEvent("installed", plugin));
                return plugin;
            }, function(error) {
                delete _installing[url];
                throw error;
            });
            _installing[url] = promise;
            return promise;
        };

        /**
         * Returns all installed plugins.
         * @name orion.pluginregistry.PluginRegistry#getPlugins
         * @return {orion.pluginregistry.Plugin[]} An array of all installed plugins.
         * @function 
         */
        this.getPlugins = function() {
            return _plugins.slice();
        };

        /**
         * Returns the installed plugin with the given URL.
         * @name orion.pluginregistry.PluginRegistry#getPlugin
         * @return {orion.pluginregistry.Plugin} The installed plugin matching the given URL, or <code>null</code>
         * if no such plugin is installed.
         * @function 
         */
        this.getPlugin = function(url) {
            var result = null;
            url = _normalizeURL(url);
            _plugins.some(function(plugin) {
                if (url === plugin.getLocation()) {
                    result = plugin;
                    return true;
                }
            });
            return result;
        };

        this.addEventListener = _pluginEventTarget.addEventListener.bind(_pluginEventTarget);

        this.removeEventListener = _pluginEventTarget.removeEventListener.bind(_pluginEventTarget);

        this.resolvePlugins = function() {
            var allResolved = true;
            _plugins.forEach(function(plugin) {
                allResolved = allResolved && plugin._resolve();
            });
            return allResolved;
        };
    }
    return {
        Plugin: Plugin,
        PluginRegistry: PluginRegistry
    };
});

/*******************************************************************************
 * @license
 * Copyright (c) 2012 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
/*eslint-env browser, amd*/
/**
 * @name orion.operation
 * @namespace Provides an API for handling long running operations as promises.
 */
define('orion/operation',["orion/xhr", "orion/Deferred"], function(xhr, Deferred) {

	function _isRunning(operationType) {
		if (!operationType) {
			return true;
		}
		if (operationType === "loadstart" || operationType === "progress") {
			return true;
		}
		return false;
	}

	function _deleteTempOperation(operationLocation) {
		xhr("DELETE", operationLocation, {
			headers: {
				"Orion-Version": "1"
			},
			timeout: 15000
		});
	}

	function _cancelOperation(operationLocation) {
		xhr("PUT", operationLocation, {
			headers: {
				"Orion-Version": "1"
			},
			data: JSON.stringify({
				abort: true
			}),
			timeout: 15000
		});
	}

	function _getOperation(operation, deferred, onResolve, onReject) {
		xhr("GET", operation.location, {
			headers: {
				"Orion-Version": "1"
			},
			timeout: 15000
		}).then(function(result) {
			var operationJson = result.response ? JSON.parse(result.response) : null;
			deferred.progress(operationJson);
			if (_isRunning(operationJson.type)) {
				setTimeout(function() {
					_getOperation(operation	, deferred, onResolve, onReject);
				}, operation.timeout);
				operation.timeout = Math.min(operation.timeout * 2, 2000);
				return;
			}
			if (operationJson.type === "error" || operationJson.type === "abort") {
				deferred.reject(onReject ? onReject(operationJson) : operationJson.Result);
			} else {
				deferred.resolve(onResolve ? onResolve(operationJson) : operationJson.Result.JsonData);
			}
			if (!operationJson.Location) {
				_deleteTempOperation(operation.location); //This operation should not be kept 
			}
		}, function(error) {
			var errorMessage = error;
			if (error.responseText !== undefined) {
				errorMessage = error.responseText;
				try {
					errorMessage = JSON.parse(error.responseText);
				} catch (e) {
					//ignore
				}
			}
			if (errorMessage.Message !== undefined) {
				errorMessage.HttpCode = errorMessage.HttpCode === undefined ? error.status : errorMessage.HttpCode;
				errorMessage.Severity = errorMessage.Severity === undefined ? "Error" : errorMessage.Severity;
				deferred.reject(errorMessage);
			} else {
				deferred.reject({
					Severity: "Error",
					Message: errorMessage,
					HttpCode: error.status
				});
			}
		});
	}

	function _trackCancel(operationLocation, deferred) {
		deferred.then(null, function(error) {
			if (error instanceof Error && error.name === "Cancel") {
				_cancelOperation(operationLocation);
			}
		});
	}

	/**
	 * Handles a long-running operation as a promise.
	 * @name orion.operation.handle
	 * @function
	 * @param {String} operationLocation
	 * @param {Function} [onSuccess] If provided, will be called to transform a successful operation into the resolve value of the 
	 * returned promise.
	 * @param {Function} [onError] If provided, will be called to trasnform a failed operation into the reject value of the 
	 * returned promise.
	 * @returns {orion.Promise}
	 */
	function handle(operationLocation, onSuccess, onError) {
		var def = new Deferred();
		_trackCancel(operationLocation, def);
		_getOperation({location: operationLocation, timeout: 100}, def, onSuccess, onError);
		return def;
	}

	return {
		handle: handle
	};
});

/******************************************************************************* 
 * @license
 * Copyright (c) 2011, 2013 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/

/*eslint-env browser, amd*/

/** @namespace The global container for eclipse APIs. */

define('orion/git/gitClient',['require', "orion/xhr", "orion/Deferred", 'orion/operation'], function(require, xhr, Deferred, operation) {

var eclipse = eclipse || {};

eclipse.GitService = (function() {
	
	var contentType = "application/json; charset=UTF-8";
	
	/**
	 * Creates a new Git service.
	 * @class Provides operations for browsing and manipulating Git repositories.
	 * @name orion.git.GitService
	 */
	function GitService(serviceRegistry) {
		if (serviceRegistry) {
			this._serviceRegistry = serviceRegistry;
			this._serviceRegistration = serviceRegistry.registerService(
					"orion.git.provider", this); //$NON-NLS-0$
		}
	}

	GitService.prototype = /** @lends eclipse.GitService.prototype */
	{
		checkGitService : function() {
		},
		
		cloneGitRepository : function(gitName, gitRepoUrl, targetPath, repoLocation, gitSshUsername, gitSshPassword, gitSshKnownHost, privateKey, passphrase, userInfo, initProject) {
			var service = this;
			var postData = {};
			if(gitName){
				postData.Name = gitName;
			}
			if(targetPath){
				postData.Path = targetPath;
			}
			if(gitRepoUrl){
				postData.GitUrl=gitRepoUrl;
			}
			postData.Location = repoLocation;
			if(gitSshUsername){
				postData.GitSshUsername = gitSshUsername;
			}
			if(gitSshPassword){
				postData.GitSshPassword = gitSshPassword;
			}
			if(gitSshKnownHost){
				postData.GitSshKnownHost = gitSshKnownHost;
			}
			if(privateKey) {
				postData.GitSshPrivateKey=privateKey;
			}
			if(passphrase) {
				postData.GitSshPassphrase=passphrase;
			}
			if(userInfo){
				if( userInfo.GitMail ){
					postData.GitMail = userInfo.GitMail;
				}
				if( userInfo.GitName ){
					postData.GitName = userInfo.GitName;
				}
			}
			if(initProject){
				postData.initProject = initProject;
			}
			//NOTE: require.toURL needs special logic here to handle "gitapi/clone"
			var gitapiCloneUrl = require.toUrl("gitapi/clone/._"); //$NON-NLS-0$
			gitapiCloneUrl = gitapiCloneUrl.substring(0,gitapiCloneUrl.length-2);
			
			var clientDeferred = new Deferred();
			xhr("POST", gitapiCloneUrl, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify(postData)
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		removeGitRepository : function(repositoryLocation){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", repositoryLocation, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
	
		getGitStatus: function(url){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", url, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		stage: function(location){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		stageMultipleFiles: function(gitCloneURI, paths){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Path" : paths //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		unstageAll: function(location , resetParam){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Reset" : resetParam //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		unstage: function(location , paths){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$,
				data: JSON.stringify({
					"Path" : paths //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		checkoutPath: function(gitCloneURI, paths){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Path" : paths, //$NON-NLS-0$
					"RemoveUntracked" : "true" //$NON-NLS-1$ //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		ignorePath: function(gitIgnoreURI, paths){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitIgnoreURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Path" : paths, //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		commitAll: function(location , message , body){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: body
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		getGitClone : function(gitCloneURI) {
			var service = this;

			var clientDeferred = new Deferred();
			xhr("GET", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		getGitCloneConfig : function(gitCloneConfigURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitCloneConfigURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		getGitBranch : function(gitBranchURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitBranchURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		getGitRemote : function(gitRemoteURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitRemoteURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		checkoutBranch : function(gitCloneURI, branchName) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Branch" : branchName //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		resetIndex : function(gitIndexURI, refId, mode) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitIndexURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Commit" : refId, //$NON-NLS-0$
					"Reset" : mode ? mode : "HARD" //$NON-NLS-1$ //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		addBranch : function(gitBranchParentURI, branchName, startPoint) {
			var service = this;
			
			var postData = {};
			if (branchName) postData.Name = branchName;
			if (startPoint) postData.Branch = startPoint;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitBranchParentURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify(postData)
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		removeBranch : function(gitBranchURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", gitBranchURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		addRemote : function(gitRemoteParentURI, remoteName, remoteURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitRemoteParentURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Remote" : remoteName, //$NON-NLS-0$
					"RemoteURI" : remoteURI //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		removeRemote : function(gitRemoteURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", gitRemoteURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doGitLog : function(gitLogURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitLogURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		getDiff : function(gitDiffURI, commitName) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitDiffURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"New" : commitName //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doGitDiff : function(gitDiffURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitDiffURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});

			return clientDeferred;
		},
		
		doFetch : function(gitRemoteBranchURI, force, gitSshUsername, gitSshPassword, gitSshKnownHost, gitPrivateKey, gitPassphrase) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitRemoteBranchURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Fetch" : "true", //$NON-NLS-1$ //$NON-NLS-0$
					"Force" : force, //$NON-NLS-0$
					"GitSshUsername" : gitSshUsername, //$NON-NLS-0$
					"GitSshPassword" : gitSshPassword, //$NON-NLS-0$
					"GitSshKnownHost" : gitSshKnownHost, //$NON-NLS-0$
					"GitSshPrivateKey" : gitPrivateKey, //$NON-NLS-0$
					"GitSshPassphrase" : gitPassphrase //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doPull : function(gitCloneURI, force, gitSshUsername, gitSshPassword, gitSshKnownHost, gitPrivateKey, gitPassphrase) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Pull" : "true", //$NON-NLS-1$ //$NON-NLS-0$
					"Force" : force, //$NON-NLS-0$
					"GitSshUsername" : gitSshUsername, //$NON-NLS-0$
					"GitSshPassword" : gitSshPassword, //$NON-NLS-0$
					"GitSshKnownHost" : gitSshKnownHost, //$NON-NLS-0$
					"GitSshPrivateKey" : gitPrivateKey, //$NON-NLS-0$
					"GitSshPassphrase" : gitPassphrase //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doMerge : function(gitHeadURI, commitName, squash) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitHeadURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Merge" : commitName, //$NON-NLS-0$
					"Squash" : squash
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doCherryPick : function(gitHeadURI, commitName) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitHeadURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Cherry-Pick" : commitName //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doRevert : function(gitHeadURI, commitName) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitHeadURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Revert" : commitName //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doRebase : function(gitHeadURI, commitName, operation) {
			var service = this;
			var postData = {};
			postData.Rebase = commitName;
			if (operation) postData.Operation = operation;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitHeadURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify(postData)
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doPush : function(gitBranchURI, srcRef, tags, force, gitSshUsername, gitSshPassword, gitSshKnownHost, gitPrivateKey, gitPassphrase) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitBranchURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"PushSrcRef" : srcRef, //$NON-NLS-0$
					"PushTags" : tags, //$NON-NLS-0$
					"Force" : force, //$NON-NLS-0$
					"GitSshUsername" : gitSshUsername, //$NON-NLS-0$
					"GitSshPassword" : gitSshPassword, //$NON-NLS-0$
					"GitSshKnownHost" : gitSshKnownHost, //$NON-NLS-0$
					"GitSshPrivateKey" : gitPrivateKey, //$NON-NLS-0$
					"GitSshPassphrase" : gitPassphrase //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		getLog : function(gitCommitURI, commitName) {
			var service = this;
			var clientDeferred = new Deferred();
			var clientDeferred1 = new Deferred();
			
			xhr("POST", gitCommitURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"New" : commitName //$NON-NLS-0$
				})
			}).then(function(result) {
				clientDeferred1.resolve(result.xhr.getResponseHeader("Location")); //TODO bug 367344 //$NON-NLS-0$
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			clientDeferred1.then(function(scopedGitCommitURI){
				xhr("GET", scopedGitCommitURI, { 
					headers : { 
						"Orion-Version" : "1",
						"Content-Type" : contentType
					},
					timeout : 15000,
					handleAs : "json" //$NON-NLS-0$
				}).then(function(result) {
					service._getGitServiceResponse(clientDeferred, result);
				}, function(error){
					service._handleGitServiceResponseError(clientDeferred, error);
				});
			});	
			
			return clientDeferred;			
		},
		
		getDefaultRemoteBranch : function(gitRemoteURI) {
			var service = this;
			var clientDeferred = new Deferred();
			var clientDeferred1 = new Deferred();
			
			xhr("GET", gitRemoteURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred1, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			clientDeferred1.then(function(remoteJsonData){
				xhr("GET", remoteJsonData.Children[0].Location, { 
					headers : { 
						"Orion-Version" : "1",
						"Content-Type" : contentType
					},
					timeout : 15000,
					handleAs : "json" //$NON-NLS-0$
				}).then(function(result) {
					service._getGitServiceResponse(clientDeferred, result);
				}, function(error){
					service._handleGitServiceResponseError(clientDeferred, error);
				});
			});	

			return clientDeferred;
		},
		
		doAddTag : function(gitCommitURI, tagName) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitCommitURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Name" : tagName  //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		doRemoveTag : function(gitTagURI) {
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", gitTagURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		checkoutTag : function(gitCloneURI, tag, branchName){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitCloneURI, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Tag" : tag, //$NON-NLS-0$
					"Branch" : branchName //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		/**
		 * Performs git stash create
		 * @param gitStashLocation
		 * @param indexMessage [optional)
		 * @param workingDirectoryMessage [optional]
		 * @param includeUntracked [optional]
		 * @returns {Deferred}
		 */
		doStashCreate : function(gitStashLocation, indexMessage, workingDirectoryMessage, includeUntracked){
			var service = this;
			
			var payload = {};
			if(indexMessage != null) /* note that undefined == null */
				payload.IndexMessage = indexMessage;
			
			if(workingDirectoryMessage != null) /* note that undefined == null */
				payload.WorkingDirectoryMessage = workingDirectoryMessage;
			
			if(includeUntracked === true)
				payload.IncludeUntracked = true;
			
			var clientDeferred = new Deferred();
			xhr("POST", gitStashLocation, {
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify(payload)
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		/**
		 * Performs git stash pop
		 * @param gitStashLocation
		 * @returns {Deferred}
		 */
		doStashPop : function(gitStashLocation){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitStashLocation, {
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		/**
		 * Performs git stash apply on the given change
		 * @param gitStashApplyLocation /gitapi/stash/<changeRev>/(..)
		 * @returns {Deferred}
		 */
		doStashApply : function(gitStashApplyLocation){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", gitStashApplyLocation, {
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		/**
		 * Performs git stash list
		 * @param gitStashLocation
		 * @returns {Deferred}
		 */
		doStashList : function(gitStashLocation){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("GET", gitStashLocation, {
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		/**
		 * Performs git stash drop on the given change
		 * @param gitStashDropLocation /gitapi/stash/<changeRev>/(..)
		 * @returns {Deferred}
		 */
		doStashDrop : function(gitStashDropLocation){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", gitStashDropLocation, {
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		addCloneConfigurationProperty: function(location, newKey, newValue){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Key" : newKey, //$NON-NLS-0$
					"Value" : newValue //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		editCloneConfigurationProperty: function(location, newValue){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("PUT", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"Value" : newValue //$NON-NLS-0$
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		deleteCloneConfigurationProperty: function(location){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("DELETE", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json" //$NON-NLS-0$
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},
		
		sendCommitReviewRequest: function(commit, location, login, url, authorName, message){
			var service = this;
			
			var clientDeferred = new Deferred();
			xhr("POST", location, { 
				headers : { 
					"Orion-Version" : "1",
					"Content-Type" : contentType
				},
				timeout : 15000,
				handleAs : "json", //$NON-NLS-0$
				data: JSON.stringify({
					"ReviewReqCommit": commit,
					"ReviewReqUrl" : url, //$NON-NLS-0$
					"ReviewReqNotifyLogin" : login, //$NON-NLS-0$	
					"ReviewReqAuthorName" : authorName,
					"ReviewMessage" : message
				})
			}).then(function(result) {
				service._getGitServiceResponse(clientDeferred, result);
			}, function(error){
				service._handleGitServiceResponseError(clientDeferred, error);
			});
			
			return clientDeferred;
		},

		_getGitServiceResponse : function(deferred, result) {
			var response =  result.response ? JSON.parse(result.response) : null;
			
			if (result.xhr && result.xhr.status === 202) {
				var def = operation.handle(response.Location);
				def.then(deferred.resolve, function(data) {
					data.failedOperation = response.Location;
					deferred.reject(data);
				}, deferred.progress);
				deferred.then(null, function(error){def.reject(error);});
				return;
			}
			deferred.resolve(response);
			return;
		},
		
		_handleGitServiceResponseError: function(deferred, error){
			deferred.reject(error);
		}
	};
	return GitService;
}());

return eclipse;
});

/*******************************************************************************
 * @license
 * Copyright (c) 2011, 2012 IBM Corporation and others. All rights reserved. This
 * program and the accompanying materials are made available under the terms of
 * the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 * and the Eclipse Distribution License v1.0
 * (http://www.eclipse.org/org/documents/edl-v10.html).
 * 
 * Contributors: IBM Corporation - initial API and implementation
 ******************************************************************************/
/*eslint-env browser, amd*/
/*global URL*/
var _browser_script_source = null; //We need to know where the browser script lives
var _all_script = document.getElementsByTagName('script');
if (_all_script && _all_script.length && _all_script.length > 0) {
	for (var j = 0; j < 2; j++) { // try twice in all the script tags
		for (var i = 0; i < _all_script.length; i++) {
			if (j === 0) { //First try: if the script id is ""orion.browse.browser""
				if (_all_script[i].id === "orion.git.commitBrowser") {
					_browser_script_source = _all_script[i].src;
					break;
				}
			} else {
				var regex = /.*built-commitBrowser.*.js/;
				if (_all_script[i].src && regex.exec(_all_script[i].src)) {
					_browser_script_source = _all_script[i].src;
					break;
				}
			}
		}
		if (_browser_script_source) {
			break;
		}
	}
	if (!_browser_script_source) {
		_browser_script_source = _all_script[_all_script.length - 1].src;
	}
}
define('gitWidgets/builder/commitBrowser',[
	'gitWidgets/helper/gitCommitHelper',
	'orion/widgets/browse/staticDataSource',
	'orion/contentTypes',
	'orion/serviceregistry',
	'orion/pluginregistry',
	'orion/git/gitClient',
	'orion/objects',
	'orion/Deferred',
	'orion/URL-shim'
], function(
	mGitCommitHelper, 
	mStaticDataSource,
	mContentTypes,
	mServiceRegistry, 
	mPluginRegistry,
	mGitClient,
	objects,
	Deferred
) {
	function Browser(params) { // parentId, repo, base
		if (typeof params === "string") {
			params = {
				parentId: arguments[0]
				//repo: arguments[1]
			};
		} else {
			params = params || {};
		}
		var serviceRegistry = this.serviceRegistry = new mServiceRegistry.ServiceRegistry();
		var gitClient = this.gitClient = new mGitClient.GitService(serviceRegistry);
		this._contentTypeService =  new mContentTypes.ContentTypeRegistry(mStaticDataSource.ContentTypes);
		serviceRegistry.registerService("orion.core.contentTypeRegistry", this._contentTypeService); //$NON-NLS-0$
		var pluginURL = new URL("../../git/plugins/gitPlugin.html", _browser_script_source);
		var plugins = {};
		plugins[pluginURL.href] = {autostart: "started", lastModified: -1};
		this.pluginRegistry = new mPluginRegistry.PluginRegistry(serviceRegistry, {
			storage: {},
			plugins: plugins
		});
		this.commitHelper = new mGitCommitHelper.GitCommitHelper({
			parentId: params.parentId,
			serviceRegistry: serviceRegistry,
			gitClient: gitClient
		});
	}

	objects.mixin(Browser.prototype, {
		startup: function() {
			if(this.started) {
				return new Deferred().resolve();
			} else {
				this.started = true;
				return this.pluginRegistry.start();
			}
		},
		displayCommit: function(commit, location, commitName, title) {
			this.commitHelper.displayDiffs(commit, location, commitName, title);
		}
	});
	return Browser;
});
		orion = this.orion || (this.orion = {});
		var git = orion.git || (orion.git = {});
		git.commitBrowser = require('gitWidgets/builder/commitBrowser');
